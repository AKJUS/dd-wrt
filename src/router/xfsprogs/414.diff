diff -urpN xfsprogs-4.9.0/.gitcensus xfsprogs-4.14.0/.gitcensus
--- xfsprogs-4.9.0/.gitcensus	2017-01-05 23:35:19.000000000 +0100
+++ xfsprogs-4.14.0/.gitcensus	2017-11-27 17:59:21.000000000 +0100
@@ -31,6 +31,7 @@ db/bmroot.c
 db/bmroot.h
 db/btblock.c
 db/btblock.h
+db/btdump.c
 db/check.c
 db/check.h
 db/command.c
@@ -63,6 +64,8 @@ db/freesp.c
 db/freesp.h
 db/fsmap.c
 db/fsmap.h
+db/fuzz.c
+db/fuzz.h
 db/hash.c
 db/hash.h
 db/help.c
@@ -120,8 +123,6 @@ doc/Makefile
 doc/sparse.txt
 estimate/Makefile
 estimate/xfs_estimate.c
-fs/xfs/xfs_rmap_item.c
-fs/xfs/xfs_rmap_item.h
 fsck/Makefile
 fsck/xfs_fsck.sh
 fsr/Makefile
@@ -144,7 +145,6 @@ include/handle.h
 include/hlist.h
 include/input.h
 include/install-sh
-include/irix.h
 include/jdm.h
 include/kmem.h
 include/libxcmd.h
@@ -173,10 +173,12 @@ io/attr.c
 io/bmap.c
 io/copy_file_range.c
 io/cowextsize.c
+io/encrypt.c
 io/fadvise.c
 io/fiemap.c
 io/file.c
 io/freeze.c
+io/fsmap.c
 io/fsync.c
 io/getrusage.c
 io/imap.c
@@ -199,9 +201,12 @@ io/resblks.c
 io/seek.c
 io/sendfile.c
 io/shutdown.c
+io/stat.c
+io/statx.h
 io/sync.c
 io/sync_file_range.c
 io/truncate.c
+io/utimes.c
 io/xfs_bmap.sh
 io/xfs_freeze.sh
 io/xfs_mkfile.sh
@@ -326,6 +331,7 @@ m4/package_globals.m4
 m4/package_libcdev.m4
 m4/package_pthread.m4
 m4/package_rt.m4
+m4/package_sanitizer.m4
 m4/package_types.m4
 m4/package_utilies.m4
 m4/package_uuiddev.m4
@@ -357,6 +363,7 @@ man/man8/xfs_ncheck.8
 man/man8/xfs_quota.8
 man/man8/xfs_repair.8
 man/man8/xfs_rtcp.8
+man/man8/xfs_spaceman.8
 mdrestore/Makefile
 mdrestore/xfs_mdrestore.c
 mkfs/Makefile
@@ -442,6 +449,15 @@ repair/versions.h
 repair/xfs_repair.c
 rtcp/Makefile
 rtcp/xfs_rtcp.c
+spaceman/Makefile
+spaceman/file.c
+spaceman/freesp.c
+spaceman/init.c
+spaceman/init.h
+spaceman/prealloc.c
+spaceman/space.h
+spaceman/trim.c
 tools/find-api-violations.sh
 tools/libxfs-apply
+tools/libxfs-diff
 tools/xfsbuflock.py
diff -urpN xfsprogs-4.9.0/.gitignore xfsprogs-4.14.0/.gitignore
--- xfsprogs-4.9.0/.gitignore	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/.gitignore	2017-11-27 17:57:55.000000000 +0100
@@ -67,6 +67,7 @@ cscope.*
 /quota/xfs_quota
 /repair/xfs_repair
 /rtcp/xfs_rtcp
+/spaceman/xfs_spaceman
 
 # generated crc files
 /libxfs/crc32selftest
diff -urpN xfsprogs-4.9.0/Makefile xfsprogs-4.14.0/Makefile
--- xfsprogs-4.9.0/Makefile	2016-12-21 06:36:07.000000000 +0100
+++ xfsprogs-4.14.0/Makefile	2017-11-20 01:14:14.000000000 +0100
@@ -26,18 +26,19 @@ endif
 
 SRCDIR = $(PKG_NAME)-$(PKG_VERSION)
 SRCTAR = $(PKG_NAME)-$(PKG_VERSION).tar.gz
+SRCTARXZ = $(PKG_NAME)-$(PKG_VERSION).tar.xz
 
 CONFIGURE = aclocal.m4 configure config.guess config.sub install-sh ltmain.sh
 LSRCFILES = configure.ac release.sh README VERSION $(CONFIGURE)
 SRCTARINC = m4/libtool.m4 m4/lt~obsolete.m4 m4/ltoptions.m4 m4/ltsugar.m4 \
            m4/ltversion.m4 po/xfsprogs.pot .gitcensus $(CONFIGURE)
 LDIRT = config.log .ltdep .dep config.status config.cache confdefs.h \
-	conftest* built .census install.* install-dev.* *.gz \
+	conftest* built .census install.* install-dev.* *.gz *.xz \
 	autom4te.cache/* libtool include/builddefs include/platform_defs.h
 
 ifeq ($(HAVE_BUILDDEFS), yes)
 LDIRDIRT = $(SRCDIR)
-LDIRT += $(SRCTAR)
+LDIRT += $(SRCTAR) $(SRCTARXZ)
 endif
 
 # header install rules to populate include/xfs correctly
@@ -46,7 +47,7 @@ HDR_SUBDIRS = include libxfs
 DLIB_SUBDIRS = libxlog libxcmd libhandle
 LIB_SUBDIRS = libxfs $(DLIB_SUBDIRS)
 TOOL_SUBDIRS = copy db estimate fsck growfs io logprint mkfs quota \
-		mdrestore repair rtcp m4 man doc debian
+		mdrestore repair rtcp m4 man doc debian spaceman
 
 ifneq ("$(PKG_PLATFORM)","darwin")
 TOOL_SUBDIRS += fsr
@@ -87,6 +88,7 @@ quota: libxcmd
 repair: libxlog libxcmd
 copy: libxlog
 mkfs: libxcmd
+spaceman: libxcmd
 
 ifeq ($(HAVE_BUILDDEFS), yes)
 include $(BUILDRULES)
@@ -100,7 +102,7 @@ endif
 # versions will copy those files anyway, and don't understand -i.
 LIBTOOLIZE_INSTALL = `$(LIBTOOLIZE_BIN) -n -i >/dev/null 2>/dev/null && echo -i`
 
-configure:
+configure: configure.ac
 	$(LIBTOOLIZE_BIN) -c $(LIBTOOLIZE_INSTALL) -f
 	cp include/install-sh .
 	aclocal -I m4
@@ -165,6 +167,11 @@ $(SRCTAR) : default $(SRCTARINC) .gitcen
 	   `cat .gitcensus` $(SRCTARINC)
 	echo Wrote: $@
 
+$(SRCTARXZ) : default $(SRCTARINC) .gitcensus
+	$(Q)$(TAR) --transform "s,^,$(SRCDIR)/," -Jcf $(SRCDIR).tar.xz  \
+	   `cat .gitcensus` $(SRCTARINC)
+	echo Wrote: $@
+
 .gitcensus: $(_FORCE)
 	$(Q)if test -d .git; then \
 	  git ls-files > .gitcensus && echo "new .gitcensus"; \
diff -urpN xfsprogs-4.9.0/VERSION xfsprogs-4.14.0/VERSION
--- xfsprogs-4.9.0/VERSION	2017-01-05 23:27:21.000000000 +0100
+++ xfsprogs-4.14.0/VERSION	2017-11-27 17:57:55.000000000 +0100
@@ -2,6 +2,6 @@
 # This file is used by configure to get version information
 #
 PKG_MAJOR=4
-PKG_MINOR=9
+PKG_MINOR=14
 PKG_REVISION=0
 PKG_BUILD=1
diff -urpN xfsprogs-4.9.0/aclocal.m4 xfsprogs-4.14.0/aclocal.m4
--- xfsprogs-4.9.0/aclocal.m4	2017-01-05 23:33:47.000000000 +0100
+++ xfsprogs-4.14.0/aclocal.m4	2017-11-27 17:58:19.000000000 +0100
@@ -1,7 +1,7 @@
-# generated automatically by aclocal 1.11.1 -*- Autoconf -*-
+# generated automatically by aclocal 1.13.4 -*- Autoconf -*-
+
+# Copyright (C) 1996-2013 Free Software Foundation, Inc.
 
-# Copyright (C) 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004,
-# 2005, 2006, 2007, 2008, 2009  Free Software Foundation, Inc.
 # This file is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -11,6 +11,7 @@
 # even the implied warranty of MERCHANTABILITY or FITNESS FOR A
 # PARTICULAR PURPOSE.
 
+m4_ifndef([AC_CONFIG_MACRO_DIRS], [m4_defun([_AM_CONFIG_MACRO_DIRS], [])m4_defun([AC_CONFIG_MACRO_DIRS], [_AM_CONFIG_MACRO_DIRS($@)])])
 m4_include([m4/libtool.m4])
 m4_include([m4/ltoptions.m4])
 m4_include([m4/ltsugar.m4])
@@ -23,6 +24,7 @@ m4_include([m4/package_globals.m4])
 m4_include([m4/package_libcdev.m4])
 m4_include([m4/package_pthread.m4])
 m4_include([m4/package_rt.m4])
+m4_include([m4/package_sanitizer.m4])
 m4_include([m4/package_types.m4])
 m4_include([m4/package_utilies.m4])
 m4_include([m4/package_uuiddev.m4])
diff -urpN xfsprogs-4.9.0/config.guess xfsprogs-4.14.0/config.guess
--- xfsprogs-4.9.0/config.guess	2017-01-05 23:33:45.000000000 +0100
+++ xfsprogs-4.14.0/config.guess	2017-11-27 17:58:08.000000000 +0100
@@ -1,14 +1,12 @@
 #! /bin/sh
 # Attempt to guess a canonical system name.
-#   Copyright (C) 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999,
-#   2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009
-#   Free Software Foundation, Inc.
+#   Copyright 1992-2013 Free Software Foundation, Inc.
 
-timestamp='2009-11-20'
+timestamp='2013-06-10'
 
 # This file is free software; you can redistribute it and/or modify it
 # under the terms of the GNU General Public License as published by
-# the Free Software Foundation; either version 2 of the License, or
+# the Free Software Foundation; either version 3 of the License, or
 # (at your option) any later version.
 #
 # This program is distributed in the hope that it will be useful, but
@@ -17,26 +15,22 @@ timestamp='2009-11-20'
 # General Public License for more details.
 #
 # You should have received a copy of the GNU General Public License
-# along with this program; if not, write to the Free Software
-# Foundation, Inc., 51 Franklin Street - Fifth Floor, Boston, MA
-# 02110-1301, USA.
+# along with this program; if not, see <http://www.gnu.org/licenses/>.
 #
 # As a special exception to the GNU General Public License, if you
 # distribute this file as part of a program that contains a
 # configuration script generated by Autoconf, you may include it under
-# the same distribution terms that you use for the rest of that program.
-
-
-# Originally written by Per Bothner.  Please send patches (context
-# diff format) to <config-patches@gnu.org> and include a ChangeLog
-# entry.
+# the same distribution terms that you use for the rest of that
+# program.  This Exception is an additional permission under section 7
+# of the GNU General Public License, version 3 ("GPLv3").
 #
-# This script attempts to guess a canonical system name similar to
-# config.sub.  If it succeeds, it prints the system name on stdout, and
-# exits with 0.  Otherwise, it exits with 1.
+# Originally written by Per Bothner.
 #
 # You can get the latest version of this script from:
 # http://git.savannah.gnu.org/gitweb/?p=config.git;a=blob_plain;f=config.guess;hb=HEAD
+#
+# Please send patches with a ChangeLog entry to config-patches@gnu.org.
+
 
 me=`echo "$0" | sed -e 's,.*/,,'`
 
@@ -56,8 +50,7 @@ version="\
 GNU config.guess ($timestamp)
 
 Originally written by Per Bothner.
-Copyright (C) 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001,
-2002, 2003, 2004, 2005, 2006, 2007, 2008 Free Software Foundation, Inc.
+Copyright 1992-2013 Free Software Foundation, Inc.
 
 This is free software; see the source for copying conditions.  There is NO
 warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE."
@@ -139,12 +132,33 @@ UNAME_RELEASE=`(uname -r) 2>/dev/null` |
 UNAME_SYSTEM=`(uname -s) 2>/dev/null`  || UNAME_SYSTEM=unknown
 UNAME_VERSION=`(uname -v) 2>/dev/null` || UNAME_VERSION=unknown
 
+case "${UNAME_SYSTEM}" in
+Linux|GNU|GNU/*)
+	# If the system lacks a compiler, then just pick glibc.
+	# We could probably try harder.
+	LIBC=gnu
+
+	eval $set_cc_for_build
+	cat <<-EOF > $dummy.c
+	#include <features.h>
+	#if defined(__UCLIBC__)
+	LIBC=uclibc
+	#elif defined(__dietlibc__)
+	LIBC=dietlibc
+	#else
+	LIBC=gnu
+	#endif
+	EOF
+	eval `$CC_FOR_BUILD -E $dummy.c 2>/dev/null | grep '^LIBC'`
+	;;
+esac
+
 # Note: order is significant - the case branches are not exclusive.
 
 case "${UNAME_MACHINE}:${UNAME_SYSTEM}:${UNAME_RELEASE}:${UNAME_VERSION}" in
     *:NetBSD:*:*)
 	# NetBSD (nbsd) targets should (where applicable) match one or
-	# more of the tupples: *-*-netbsdelf*, *-*-netbsdaout*,
+	# more of the tuples: *-*-netbsdelf*, *-*-netbsdaout*,
 	# *-*-netbsdecoff* and *-*-netbsd*.  For targets that recently
 	# switched to ELF, *-*-netbsd* would select the old
 	# object file format.  This provides both forward
@@ -180,7 +194,7 @@ case "${UNAME_MACHINE}:${UNAME_SYSTEM}:$
 		fi
 		;;
 	    *)
-	        os=netbsd
+		os=netbsd
 		;;
 	esac
 	# The OS release
@@ -201,6 +215,10 @@ case "${UNAME_MACHINE}:${UNAME_SYSTEM}:$
 	# CPU_TYPE-MANUFACTURER-OPERATING_SYSTEM is used.
 	echo "${machine}-${os}${release}"
 	exit ;;
+    *:Bitrig:*:*)
+	UNAME_MACHINE_ARCH=`arch | sed 's/Bitrig.//'`
+	echo ${UNAME_MACHINE_ARCH}-unknown-bitrig${UNAME_RELEASE}
+	exit ;;
     *:OpenBSD:*:*)
 	UNAME_MACHINE_ARCH=`arch | sed 's/OpenBSD.//'`
 	echo ${UNAME_MACHINE_ARCH}-unknown-openbsd${UNAME_RELEASE}
@@ -223,7 +241,7 @@ case "${UNAME_MACHINE}:${UNAME_SYSTEM}:$
 		UNAME_RELEASE=`/usr/sbin/sizer -v | awk '{print $3}'`
 		;;
 	*5.*)
-	        UNAME_RELEASE=`/usr/sbin/sizer -v | awk '{print $4}'`
+		UNAME_RELEASE=`/usr/sbin/sizer -v | awk '{print $4}'`
 		;;
 	esac
 	# According to Compaq, /usr/sbin/psrinfo has been available on
@@ -269,7 +287,10 @@ case "${UNAME_MACHINE}:${UNAME_SYSTEM}:$
 	# A Xn.n version is an unreleased experimental baselevel.
 	# 1.2 uses "1.2" for uname -r.
 	echo ${UNAME_MACHINE}-dec-osf`echo ${UNAME_RELEASE} | sed -e 's/^[PVTX]//' | tr 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' 'abcdefghijklmnopqrstuvwxyz'`
-	exit ;;
+	# Reset EXIT trap before exiting to avoid spurious non-zero exit code.
+	exitcode=$?
+	trap '' 0
+	exit $exitcode ;;
     Alpha\ *:Windows_NT*:*)
 	# How do we know it's Interix rather than the generic POSIX subsystem?
 	# Should we change UNAME_MACHINE based on the output of uname instead
@@ -295,12 +316,12 @@ case "${UNAME_MACHINE}:${UNAME_SYSTEM}:$
 	echo s390-ibm-zvmoe
 	exit ;;
     *:OS400:*:*)
-        echo powerpc-ibm-os400
+	echo powerpc-ibm-os400
 	exit ;;
     arm:RISC*:1.[012]*:*|arm:riscix:1.[012]*:*)
 	echo arm-acorn-riscix${UNAME_RELEASE}
 	exit ;;
-    arm:riscos:*:*|arm:RISCOS:*:*)
+    arm*:riscos:*:*|arm*:RISCOS:*:*)
 	echo arm-unknown-riscos
 	exit ;;
     SR2?01:HI-UX/MPP:*:* | SR8000:HI-UX/MPP:*:*)
@@ -394,23 +415,23 @@ case "${UNAME_MACHINE}:${UNAME_SYSTEM}:$
     # MiNT.  But MiNT is downward compatible to TOS, so this should
     # be no problem.
     atarist[e]:*MiNT:*:* | atarist[e]:*mint:*:* | atarist[e]:*TOS:*:*)
-        echo m68k-atari-mint${UNAME_RELEASE}
+	echo m68k-atari-mint${UNAME_RELEASE}
 	exit ;;
     atari*:*MiNT:*:* | atari*:*mint:*:* | atarist[e]:*TOS:*:*)
 	echo m68k-atari-mint${UNAME_RELEASE}
-        exit ;;
+	exit ;;
     *falcon*:*MiNT:*:* | *falcon*:*mint:*:* | *falcon*:*TOS:*:*)
-        echo m68k-atari-mint${UNAME_RELEASE}
+	echo m68k-atari-mint${UNAME_RELEASE}
 	exit ;;
     milan*:*MiNT:*:* | milan*:*mint:*:* | *milan*:*TOS:*:*)
-        echo m68k-milan-mint${UNAME_RELEASE}
-        exit ;;
+	echo m68k-milan-mint${UNAME_RELEASE}
+	exit ;;
     hades*:*MiNT:*:* | hades*:*mint:*:* | *hades*:*TOS:*:*)
-        echo m68k-hades-mint${UNAME_RELEASE}
-        exit ;;
+	echo m68k-hades-mint${UNAME_RELEASE}
+	exit ;;
     *:*MiNT:*:* | *:*mint:*:* | *:*TOS:*:*)
-        echo m68k-unknown-mint${UNAME_RELEASE}
-        exit ;;
+	echo m68k-unknown-mint${UNAME_RELEASE}
+	exit ;;
     m68k:machten:*:*)
 	echo m68k-apple-machten${UNAME_RELEASE}
 	exit ;;
@@ -480,8 +501,8 @@ EOF
 	echo m88k-motorola-sysv3
 	exit ;;
     AViiON:dgux:*:*)
-        # DG/UX returns AViiON for all architectures
-        UNAME_PROCESSOR=`/usr/bin/uname -p`
+	# DG/UX returns AViiON for all architectures
+	UNAME_PROCESSOR=`/usr/bin/uname -p`
 	if [ $UNAME_PROCESSOR = mc88100 ] || [ $UNAME_PROCESSOR = mc88110 ]
 	then
 	    if [ ${TARGET_BINARY_INTERFACE}x = m88kdguxelfx ] || \
@@ -494,7 +515,7 @@ EOF
 	else
 	    echo i586-dg-dgux${UNAME_RELEASE}
 	fi
- 	exit ;;
+	exit ;;
     M88*:DolphinOS:*:*)	# DolphinOS (SVR3)
 	echo m88k-dolphin-sysv3
 	exit ;;
@@ -551,7 +572,7 @@ EOF
 		echo rs6000-ibm-aix3.2
 	fi
 	exit ;;
-    *:AIX:*:[456])
+    *:AIX:*:[4567])
 	IBM_CPU_ID=`/usr/sbin/lsdev -C -c processor -S available | sed 1q | awk '{ print $1 }'`
 	if /usr/sbin/lsattr -El ${IBM_CPU_ID} | grep ' POWER' >/dev/null 2>&1; then
 		IBM_ARCH=rs6000
@@ -594,52 +615,52 @@ EOF
 	    9000/[678][0-9][0-9])
 		if [ -x /usr/bin/getconf ]; then
 		    sc_cpu_version=`/usr/bin/getconf SC_CPU_VERSION 2>/dev/null`
-                    sc_kernel_bits=`/usr/bin/getconf SC_KERNEL_BITS 2>/dev/null`
-                    case "${sc_cpu_version}" in
-                      523) HP_ARCH="hppa1.0" ;; # CPU_PA_RISC1_0
-                      528) HP_ARCH="hppa1.1" ;; # CPU_PA_RISC1_1
-                      532)                      # CPU_PA_RISC2_0
-                        case "${sc_kernel_bits}" in
-                          32) HP_ARCH="hppa2.0n" ;;
-                          64) HP_ARCH="hppa2.0w" ;;
+		    sc_kernel_bits=`/usr/bin/getconf SC_KERNEL_BITS 2>/dev/null`
+		    case "${sc_cpu_version}" in
+		      523) HP_ARCH="hppa1.0" ;; # CPU_PA_RISC1_0
+		      528) HP_ARCH="hppa1.1" ;; # CPU_PA_RISC1_1
+		      532)                      # CPU_PA_RISC2_0
+			case "${sc_kernel_bits}" in
+			  32) HP_ARCH="hppa2.0n" ;;
+			  64) HP_ARCH="hppa2.0w" ;;
 			  '') HP_ARCH="hppa2.0" ;;   # HP-UX 10.20
-                        esac ;;
-                    esac
+			esac ;;
+		    esac
 		fi
 		if [ "${HP_ARCH}" = "" ]; then
 		    eval $set_cc_for_build
-		    sed 's/^              //' << EOF >$dummy.c
+		    sed 's/^		//' << EOF >$dummy.c
+
+		#define _HPUX_SOURCE
+		#include <stdlib.h>
+		#include <unistd.h>
 
-              #define _HPUX_SOURCE
-              #include <stdlib.h>
-              #include <unistd.h>
-
-              int main ()
-              {
-              #if defined(_SC_KERNEL_BITS)
-                  long bits = sysconf(_SC_KERNEL_BITS);
-              #endif
-                  long cpu  = sysconf (_SC_CPU_VERSION);
-
-                  switch (cpu)
-              	{
-              	case CPU_PA_RISC1_0: puts ("hppa1.0"); break;
-              	case CPU_PA_RISC1_1: puts ("hppa1.1"); break;
-              	case CPU_PA_RISC2_0:
-              #if defined(_SC_KERNEL_BITS)
-              	    switch (bits)
-              		{
-              		case 64: puts ("hppa2.0w"); break;
-              		case 32: puts ("hppa2.0n"); break;
-              		default: puts ("hppa2.0"); break;
-              		} break;
-              #else  /* !defined(_SC_KERNEL_BITS) */
-              	    puts ("hppa2.0"); break;
-              #endif
-              	default: puts ("hppa1.0"); break;
-              	}
-                  exit (0);
-              }
+		int main ()
+		{
+		#if defined(_SC_KERNEL_BITS)
+		    long bits = sysconf(_SC_KERNEL_BITS);
+		#endif
+		    long cpu  = sysconf (_SC_CPU_VERSION);
+
+		    switch (cpu)
+			{
+			case CPU_PA_RISC1_0: puts ("hppa1.0"); break;
+			case CPU_PA_RISC1_1: puts ("hppa1.1"); break;
+			case CPU_PA_RISC2_0:
+		#if defined(_SC_KERNEL_BITS)
+			    switch (bits)
+				{
+				case 64: puts ("hppa2.0w"); break;
+				case 32: puts ("hppa2.0n"); break;
+				default: puts ("hppa2.0"); break;
+				} break;
+		#else  /* !defined(_SC_KERNEL_BITS) */
+			    puts ("hppa2.0"); break;
+		#endif
+			default: puts ("hppa1.0"); break;
+			}
+		    exit (0);
+		}
 EOF
 		    (CCOPTS= $CC_FOR_BUILD -o $dummy $dummy.c 2>/dev/null) && HP_ARCH=`$dummy`
 		    test -z "$HP_ARCH" && HP_ARCH=hppa
@@ -730,22 +751,22 @@ EOF
 	exit ;;
     C1*:ConvexOS:*:* | convex:ConvexOS:C1*:*)
 	echo c1-convex-bsd
-        exit ;;
+	exit ;;
     C2*:ConvexOS:*:* | convex:ConvexOS:C2*:*)
 	if getsysinfo -f scalar_acc
 	then echo c32-convex-bsd
 	else echo c2-convex-bsd
 	fi
-        exit ;;
+	exit ;;
     C34*:ConvexOS:*:* | convex:ConvexOS:C34*:*)
 	echo c34-convex-bsd
-        exit ;;
+	exit ;;
     C38*:ConvexOS:*:* | convex:ConvexOS:C38*:*)
 	echo c38-convex-bsd
-        exit ;;
+	exit ;;
     C4*:ConvexOS:*:* | convex:ConvexOS:C4*:*)
 	echo c4-convex-bsd
-        exit ;;
+	exit ;;
     CRAY*Y-MP:*:*:*)
 	echo ymp-cray-unicos${UNAME_RELEASE} | sed -e 's/\.[^.]*$/.X/'
 	exit ;;
@@ -769,14 +790,14 @@ EOF
 	exit ;;
     F30[01]:UNIX_System_V:*:* | F700:UNIX_System_V:*:*)
 	FUJITSU_PROC=`uname -m | tr 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' 'abcdefghijklmnopqrstuvwxyz'`
-        FUJITSU_SYS=`uname -p | tr 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' 'abcdefghijklmnopqrstuvwxyz' | sed -e 's/\///'`
-        FUJITSU_REL=`echo ${UNAME_RELEASE} | sed -e 's/ /_/'`
-        echo "${FUJITSU_PROC}-fujitsu-${FUJITSU_SYS}${FUJITSU_REL}"
-        exit ;;
+	FUJITSU_SYS=`uname -p | tr 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' 'abcdefghijklmnopqrstuvwxyz' | sed -e 's/\///'`
+	FUJITSU_REL=`echo ${UNAME_RELEASE} | sed -e 's/ /_/'`
+	echo "${FUJITSU_PROC}-fujitsu-${FUJITSU_SYS}${FUJITSU_REL}"
+	exit ;;
     5000:UNIX_System_V:4.*:*)
-        FUJITSU_SYS=`uname -p | tr 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' 'abcdefghijklmnopqrstuvwxyz' | sed -e 's/\///'`
-        FUJITSU_REL=`echo ${UNAME_RELEASE} | tr 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' 'abcdefghijklmnopqrstuvwxyz' | sed -e 's/ /_/'`
-        echo "sparc-fujitsu-${FUJITSU_SYS}${FUJITSU_REL}"
+	FUJITSU_SYS=`uname -p | tr 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' 'abcdefghijklmnopqrstuvwxyz' | sed -e 's/\///'`
+	FUJITSU_REL=`echo ${UNAME_RELEASE} | tr 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' 'abcdefghijklmnopqrstuvwxyz' | sed -e 's/ /_/'`
+	echo "sparc-fujitsu-${FUJITSU_SYS}${FUJITSU_REL}"
 	exit ;;
     i*86:BSD/386:*:* | i*86:BSD/OS:*:* | *:Ascend\ Embedded/OS:*:*)
 	echo ${UNAME_MACHINE}-pc-bsdi${UNAME_RELEASE}
@@ -788,30 +809,35 @@ EOF
 	echo ${UNAME_MACHINE}-unknown-bsdi${UNAME_RELEASE}
 	exit ;;
     *:FreeBSD:*:*)
-	case ${UNAME_MACHINE} in
-	    pc98)
-		echo i386-unknown-freebsd`echo ${UNAME_RELEASE}|sed -e 's/[-(].*//'` ;;
+	UNAME_PROCESSOR=`/usr/bin/uname -p`
+	case ${UNAME_PROCESSOR} in
 	    amd64)
 		echo x86_64-unknown-freebsd`echo ${UNAME_RELEASE}|sed -e 's/[-(].*//'` ;;
 	    *)
-		echo ${UNAME_MACHINE}-unknown-freebsd`echo ${UNAME_RELEASE}|sed -e 's/[-(].*//'` ;;
+		echo ${UNAME_PROCESSOR}-unknown-freebsd`echo ${UNAME_RELEASE}|sed -e 's/[-(].*//'` ;;
 	esac
 	exit ;;
     i*:CYGWIN*:*)
 	echo ${UNAME_MACHINE}-pc-cygwin
 	exit ;;
+    *:MINGW64*:*)
+	echo ${UNAME_MACHINE}-pc-mingw64
+	exit ;;
     *:MINGW*:*)
 	echo ${UNAME_MACHINE}-pc-mingw32
 	exit ;;
+    i*:MSYS*:*)
+	echo ${UNAME_MACHINE}-pc-msys
+	exit ;;
     i*:windows32*:*)
-    	# uname -m includes "-pc" on this system.
-    	echo ${UNAME_MACHINE}-mingw32
+	# uname -m includes "-pc" on this system.
+	echo ${UNAME_MACHINE}-mingw32
 	exit ;;
     i*:PW*:*)
 	echo ${UNAME_MACHINE}-pc-pw32
 	exit ;;
     *:Interix*:*)
-    	case ${UNAME_MACHINE} in
+	case ${UNAME_MACHINE} in
 	    x86)
 		echo i586-pc-interix${UNAME_RELEASE}
 		exit ;;
@@ -848,15 +874,22 @@ EOF
 	exit ;;
     *:GNU:*:*)
 	# the GNU system
-	echo `echo ${UNAME_MACHINE}|sed -e 's,[-/].*$,,'`-unknown-gnu`echo ${UNAME_RELEASE}|sed -e 's,/.*$,,'`
+	echo `echo ${UNAME_MACHINE}|sed -e 's,[-/].*$,,'`-unknown-${LIBC}`echo ${UNAME_RELEASE}|sed -e 's,/.*$,,'`
 	exit ;;
     *:GNU/*:*:*)
 	# other systems with GNU libc and userland
-	echo ${UNAME_MACHINE}-unknown-`echo ${UNAME_SYSTEM} | sed 's,^[^/]*/,,' | tr '[A-Z]' '[a-z]'``echo ${UNAME_RELEASE}|sed -e 's/[-(].*//'`-gnu
+	echo ${UNAME_MACHINE}-unknown-`echo ${UNAME_SYSTEM} | sed 's,^[^/]*/,,' | tr '[A-Z]' '[a-z]'``echo ${UNAME_RELEASE}|sed -e 's/[-(].*//'`-${LIBC}
 	exit ;;
     i*86:Minix:*:*)
 	echo ${UNAME_MACHINE}-pc-minix
 	exit ;;
+    aarch64:Linux:*:*)
+	echo ${UNAME_MACHINE}-unknown-linux-${LIBC}
+	exit ;;
+    aarch64_be:Linux:*:*)
+	UNAME_MACHINE=aarch64_be
+	echo ${UNAME_MACHINE}-unknown-linux-${LIBC}
+	exit ;;
     alpha:Linux:*:*)
 	case `sed -n '/^cpu model/s/^.*: \(.*\)/\1/p' < /proc/cpuinfo` in
 	  EV5)   UNAME_MACHINE=alphaev5 ;;
@@ -866,52 +899,56 @@ EOF
 	  EV6)   UNAME_MACHINE=alphaev6 ;;
 	  EV67)  UNAME_MACHINE=alphaev67 ;;
 	  EV68*) UNAME_MACHINE=alphaev68 ;;
-        esac
+	esac
 	objdump --private-headers /bin/sh | grep -q ld.so.1
-	if test "$?" = 0 ; then LIBC="libc1" ; else LIBC="" ; fi
-	echo ${UNAME_MACHINE}-unknown-linux-gnu${LIBC}
+	if test "$?" = 0 ; then LIBC="gnulibc1" ; fi
+	echo ${UNAME_MACHINE}-unknown-linux-${LIBC}
+	exit ;;
+    arc:Linux:*:* | arceb:Linux:*:*)
+	echo ${UNAME_MACHINE}-unknown-linux-${LIBC}
 	exit ;;
     arm*:Linux:*:*)
 	eval $set_cc_for_build
 	if echo __ARM_EABI__ | $CC_FOR_BUILD -E - 2>/dev/null \
 	    | grep -q __ARM_EABI__
 	then
-	    echo ${UNAME_MACHINE}-unknown-linux-gnu
+	    echo ${UNAME_MACHINE}-unknown-linux-${LIBC}
 	else
-	    echo ${UNAME_MACHINE}-unknown-linux-gnueabi
+	    if echo __ARM_PCS_VFP | $CC_FOR_BUILD -E - 2>/dev/null \
+		| grep -q __ARM_PCS_VFP
+	    then
+		echo ${UNAME_MACHINE}-unknown-linux-${LIBC}eabi
+	    else
+		echo ${UNAME_MACHINE}-unknown-linux-${LIBC}eabihf
+	    fi
 	fi
 	exit ;;
     avr32*:Linux:*:*)
-	echo ${UNAME_MACHINE}-unknown-linux-gnu
+	echo ${UNAME_MACHINE}-unknown-linux-${LIBC}
 	exit ;;
     cris:Linux:*:*)
-	echo cris-axis-linux-gnu
+	echo ${UNAME_MACHINE}-axis-linux-${LIBC}
 	exit ;;
     crisv32:Linux:*:*)
-	echo crisv32-axis-linux-gnu
+	echo ${UNAME_MACHINE}-axis-linux-${LIBC}
 	exit ;;
     frv:Linux:*:*)
-    	echo frv-unknown-linux-gnu
+	echo ${UNAME_MACHINE}-unknown-linux-${LIBC}
+	exit ;;
+    hexagon:Linux:*:*)
+	echo ${UNAME_MACHINE}-unknown-linux-${LIBC}
 	exit ;;
     i*86:Linux:*:*)
-	LIBC=gnu
-	eval $set_cc_for_build
-	sed 's/^	//' << EOF >$dummy.c
-	#ifdef __dietlibc__
-	LIBC=dietlibc
-	#endif
-EOF
-	eval `$CC_FOR_BUILD -E $dummy.c 2>/dev/null | grep '^LIBC'`
-	echo "${UNAME_MACHINE}-pc-linux-${LIBC}"
+	echo ${UNAME_MACHINE}-pc-linux-${LIBC}
 	exit ;;
     ia64:Linux:*:*)
-	echo ${UNAME_MACHINE}-unknown-linux-gnu
+	echo ${UNAME_MACHINE}-unknown-linux-${LIBC}
 	exit ;;
     m32r*:Linux:*:*)
-	echo ${UNAME_MACHINE}-unknown-linux-gnu
+	echo ${UNAME_MACHINE}-unknown-linux-${LIBC}
 	exit ;;
     m68*:Linux:*:*)
-	echo ${UNAME_MACHINE}-unknown-linux-gnu
+	echo ${UNAME_MACHINE}-unknown-linux-${LIBC}
 	exit ;;
     mips:Linux:*:* | mips64:Linux:*:*)
 	eval $set_cc_for_build
@@ -930,51 +967,63 @@ EOF
 	#endif
 EOF
 	eval `$CC_FOR_BUILD -E $dummy.c 2>/dev/null | grep '^CPU'`
-	test x"${CPU}" != x && { echo "${CPU}-unknown-linux-gnu"; exit; }
+	test x"${CPU}" != x && { echo "${CPU}-unknown-linux-${LIBC}"; exit; }
 	;;
+    or1k:Linux:*:*)
+	echo ${UNAME_MACHINE}-unknown-linux-${LIBC}
+	exit ;;
     or32:Linux:*:*)
-	echo or32-unknown-linux-gnu
+	echo ${UNAME_MACHINE}-unknown-linux-${LIBC}
 	exit ;;
     padre:Linux:*:*)
-	echo sparc-unknown-linux-gnu
+	echo sparc-unknown-linux-${LIBC}
 	exit ;;
     parisc64:Linux:*:* | hppa64:Linux:*:*)
-	echo hppa64-unknown-linux-gnu
+	echo hppa64-unknown-linux-${LIBC}
 	exit ;;
     parisc:Linux:*:* | hppa:Linux:*:*)
 	# Look for CPU level
 	case `grep '^cpu[^a-z]*:' /proc/cpuinfo 2>/dev/null | cut -d' ' -f2` in
-	  PA7*) echo hppa1.1-unknown-linux-gnu ;;
-	  PA8*) echo hppa2.0-unknown-linux-gnu ;;
-	  *)    echo hppa-unknown-linux-gnu ;;
+	  PA7*) echo hppa1.1-unknown-linux-${LIBC} ;;
+	  PA8*) echo hppa2.0-unknown-linux-${LIBC} ;;
+	  *)    echo hppa-unknown-linux-${LIBC} ;;
 	esac
 	exit ;;
     ppc64:Linux:*:*)
-	echo powerpc64-unknown-linux-gnu
+	echo powerpc64-unknown-linux-${LIBC}
 	exit ;;
     ppc:Linux:*:*)
-	echo powerpc-unknown-linux-gnu
+	echo powerpc-unknown-linux-${LIBC}
+	exit ;;
+    ppc64le:Linux:*:*)
+	echo powerpc64le-unknown-linux-${LIBC}
+	exit ;;
+    ppcle:Linux:*:*)
+	echo powerpcle-unknown-linux-${LIBC}
 	exit ;;
     s390:Linux:*:* | s390x:Linux:*:*)
-	echo ${UNAME_MACHINE}-ibm-linux
+	echo ${UNAME_MACHINE}-ibm-linux-${LIBC}
 	exit ;;
     sh64*:Linux:*:*)
-    	echo ${UNAME_MACHINE}-unknown-linux-gnu
+	echo ${UNAME_MACHINE}-unknown-linux-${LIBC}
 	exit ;;
     sh*:Linux:*:*)
-	echo ${UNAME_MACHINE}-unknown-linux-gnu
+	echo ${UNAME_MACHINE}-unknown-linux-${LIBC}
 	exit ;;
     sparc:Linux:*:* | sparc64:Linux:*:*)
-	echo ${UNAME_MACHINE}-unknown-linux-gnu
+	echo ${UNAME_MACHINE}-unknown-linux-${LIBC}
+	exit ;;
+    tile*:Linux:*:*)
+	echo ${UNAME_MACHINE}-unknown-linux-${LIBC}
 	exit ;;
     vax:Linux:*:*)
-	echo ${UNAME_MACHINE}-dec-linux-gnu
+	echo ${UNAME_MACHINE}-dec-linux-${LIBC}
 	exit ;;
     x86_64:Linux:*:*)
-	echo x86_64-unknown-linux-gnu
+	echo ${UNAME_MACHINE}-unknown-linux-${LIBC}
 	exit ;;
     xtensa*:Linux:*:*)
-    	echo ${UNAME_MACHINE}-unknown-linux-gnu
+	echo ${UNAME_MACHINE}-unknown-linux-${LIBC}
 	exit ;;
     i*86:DYNIX/ptx:4*:*)
 	# ptx 4.0 does uname -s correctly, with DYNIX/ptx in there.
@@ -983,11 +1032,11 @@ EOF
 	echo i386-sequent-sysv4
 	exit ;;
     i*86:UNIX_SV:4.2MP:2.*)
-        # Unixware is an offshoot of SVR4, but it has its own version
-        # number series starting with 2...
-        # I am not positive that other SVR4 systems won't match this,
+	# Unixware is an offshoot of SVR4, but it has its own version
+	# number series starting with 2...
+	# I am not positive that other SVR4 systems won't match this,
 	# I just have to hope.  -- rms.
-        # Use sysv4.2uw... so that sysv4* matches it.
+	# Use sysv4.2uw... so that sysv4* matches it.
 	echo ${UNAME_MACHINE}-pc-sysv4.2uw${UNAME_VERSION}
 	exit ;;
     i*86:OS/2:*:*)
@@ -1019,7 +1068,7 @@ EOF
 	fi
 	exit ;;
     i*86:*:5:[678]*)
-    	# UnixWare 7.x, OpenUNIX and OpenServer 6.
+	# UnixWare 7.x, OpenUNIX and OpenServer 6.
 	case `/bin/uname -X | grep "^Machine"` in
 	    *486*)	     UNAME_MACHINE=i486 ;;
 	    *Pentium)	     UNAME_MACHINE=i586 ;;
@@ -1047,13 +1096,13 @@ EOF
 	exit ;;
     pc:*:*:*)
 	# Left here for compatibility:
-        # uname -m prints for DJGPP always 'pc', but it prints nothing about
-        # the processor, so we play safe by assuming i586.
+	# uname -m prints for DJGPP always 'pc', but it prints nothing about
+	# the processor, so we play safe by assuming i586.
 	# Note: whatever this is, it MUST be the same as what config.sub
 	# prints for the "djgpp" host, or else GDB configury will decide that
 	# this is a cross-build.
 	echo i586-pc-msdosdjgpp
-        exit ;;
+	exit ;;
     Intel:Mach:3*:*)
 	echo i386-pc-mach3
 	exit ;;
@@ -1088,8 +1137,8 @@ EOF
 	/bin/uname -p 2>/dev/null | /bin/grep entium >/dev/null \
 	  && { echo i586-ncr-sysv4.3${OS_REL}; exit; } ;;
     3[34]??:*:4.0:* | 3[34]??,*:*:4.0:*)
-        /bin/uname -p 2>/dev/null | grep 86 >/dev/null \
-          && { echo i486-ncr-sysv4; exit; } ;;
+	/bin/uname -p 2>/dev/null | grep 86 >/dev/null \
+	  && { echo i486-ncr-sysv4; exit; } ;;
     NCR*:*:4.2:* | MPRAS*:*:4.2:*)
 	OS_REL='.3'
 	test -r /etc/.relid \
@@ -1132,10 +1181,10 @@ EOF
 		echo ns32k-sni-sysv
 	fi
 	exit ;;
-    PENTIUM:*:4.0*:*) # Unisys `ClearPath HMP IX 4000' SVR4/MP effort
-                      # says <Richard.M.Bartel@ccMail.Census.GOV>
-        echo i586-unisys-sysv4
-        exit ;;
+    PENTIUM:*:4.0*:*)	# Unisys `ClearPath HMP IX 4000' SVR4/MP effort
+			# says <Richard.M.Bartel@ccMail.Census.GOV>
+	echo i586-unisys-sysv4
+	exit ;;
     *:UNIX_System_V:4*:FTX*)
 	# From Gerald Hewes <hewes@openmarket.com>.
 	# How about differentiating between stratus architectures? -djm
@@ -1161,11 +1210,11 @@ EOF
 	exit ;;
     R[34]000:*System_V*:*:* | R4000:UNIX_SYSV:*:* | R*000:UNIX_SV:*:*)
 	if [ -d /usr/nec ]; then
-	        echo mips-nec-sysv${UNAME_RELEASE}
+		echo mips-nec-sysv${UNAME_RELEASE}
 	else
-	        echo mips-unknown-sysv${UNAME_RELEASE}
+		echo mips-unknown-sysv${UNAME_RELEASE}
 	fi
-        exit ;;
+	exit ;;
     BeBox:BeOS:*:*)	# BeOS running on hardware made by Be, PPC only.
 	echo powerpc-be-beos
 	exit ;;
@@ -1178,6 +1227,9 @@ EOF
     BePC:Haiku:*:*)	# Haiku running on Intel PC compatible.
 	echo i586-pc-haiku
 	exit ;;
+    x86_64:Haiku:*:*)
+	echo x86_64-unknown-haiku
+	exit ;;
     SX-4:SUPER-UX:*:*)
 	echo sx4-nec-superux${UNAME_RELEASE}
 	exit ;;
@@ -1204,19 +1256,21 @@ EOF
 	exit ;;
     *:Darwin:*:*)
 	UNAME_PROCESSOR=`uname -p` || UNAME_PROCESSOR=unknown
-	case $UNAME_PROCESSOR in
-	    i386)
-		eval $set_cc_for_build
-		if [ "$CC_FOR_BUILD" != 'no_compiler_found' ]; then
-		  if (echo '#ifdef __LP64__'; echo IS_64BIT_ARCH; echo '#endif') | \
-		      (CCOPTS= $CC_FOR_BUILD -E - 2>/dev/null) | \
-		      grep IS_64BIT_ARCH >/dev/null
-		  then
-		      UNAME_PROCESSOR="x86_64"
-		  fi
-		fi ;;
-	    unknown) UNAME_PROCESSOR=powerpc ;;
-	esac
+	eval $set_cc_for_build
+	if test "$UNAME_PROCESSOR" = unknown ; then
+	    UNAME_PROCESSOR=powerpc
+	fi
+	if [ "$CC_FOR_BUILD" != 'no_compiler_found' ]; then
+	    if (echo '#ifdef __LP64__'; echo IS_64BIT_ARCH; echo '#endif') | \
+		(CCOPTS= $CC_FOR_BUILD -E - 2>/dev/null) | \
+		grep IS_64BIT_ARCH >/dev/null
+	    then
+		case $UNAME_PROCESSOR in
+		    i386) UNAME_PROCESSOR=x86_64 ;;
+		    powerpc) UNAME_PROCESSOR=powerpc64 ;;
+		esac
+	    fi
+	fi
 	echo ${UNAME_PROCESSOR}-apple-darwin${UNAME_RELEASE}
 	exit ;;
     *:procnto*:*:* | *:QNX:[0123456789]*:*)
@@ -1230,7 +1284,10 @@ EOF
     *:QNX:*:4*)
 	echo i386-pc-qnx
 	exit ;;
-    NSE-?:NONSTOP_KERNEL:*:*)
+    NEO-?:NONSTOP_KERNEL:*:*)
+	echo neo-tandem-nsk${UNAME_RELEASE}
+	exit ;;
+    NSE-*:NONSTOP_KERNEL:*:*)
 	echo nse-tandem-nsk${UNAME_RELEASE}
 	exit ;;
     NSR-?:NONSTOP_KERNEL:*:*)
@@ -1275,13 +1332,13 @@ EOF
 	echo pdp10-unknown-its
 	exit ;;
     SEI:*:*:SEIUX)
-        echo mips-sei-seiux${UNAME_RELEASE}
+	echo mips-sei-seiux${UNAME_RELEASE}
 	exit ;;
     *:DragonFly:*:*)
 	echo ${UNAME_MACHINE}-unknown-dragonfly`echo ${UNAME_RELEASE}|sed -e 's/[-(].*//'`
 	exit ;;
     *:*VMS:*:*)
-    	UNAME_MACHINE=`(uname -p) 2>/dev/null`
+	UNAME_MACHINE=`(uname -p) 2>/dev/null`
 	case "${UNAME_MACHINE}" in
 	    A*) echo alpha-dec-vms ; exit ;;
 	    I*) echo ia64-dec-vms ; exit ;;
@@ -1299,11 +1356,11 @@ EOF
     i*86:AROS:*:*)
 	echo ${UNAME_MACHINE}-pc-aros
 	exit ;;
+    x86_64:VMkernel:*:*)
+	echo ${UNAME_MACHINE}-unknown-esx
+	exit ;;
 esac
 
-#echo '(No uname command or uname output not recognized.)' 1>&2
-#echo "${UNAME_MACHINE}:${UNAME_SYSTEM}:${UNAME_RELEASE}:${UNAME_VERSION}" 1>&2
-
 eval $set_cc_for_build
 cat >$dummy.c <<EOF
 #ifdef _SEQUENT_
@@ -1321,11 +1378,11 @@ main ()
 #include <sys/param.h>
   printf ("m68k-sony-newsos%s\n",
 #ifdef NEWSOS4
-          "4"
+	"4"
 #else
-	  ""
+	""
 #endif
-         ); exit (0);
+	); exit (0);
 #endif
 #endif
 
diff -urpN xfsprogs-4.9.0/config.sub xfsprogs-4.14.0/config.sub
--- xfsprogs-4.9.0/config.sub	2017-01-05 23:33:45.000000000 +0100
+++ xfsprogs-4.14.0/config.sub	2017-11-27 17:58:08.000000000 +0100
@@ -1,38 +1,31 @@
 #! /bin/sh
 # Configuration validation subroutine script.
-#   Copyright (C) 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999,
-#   2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009
-#   Free Software Foundation, Inc.
-
-timestamp='2009-11-20'
-
-# This file is (in principle) common to ALL GNU software.
-# The presence of a machine in this file suggests that SOME GNU software
-# can handle that machine.  It does not imply ALL GNU software can.
-#
-# This file is free software; you can redistribute it and/or modify
-# it under the terms of the GNU General Public License as published by
-# the Free Software Foundation; either version 2 of the License, or
+#   Copyright 1992-2013 Free Software Foundation, Inc.
+
+timestamp='2013-08-10'
+
+# This file is free software; you can redistribute it and/or modify it
+# under the terms of the GNU General Public License as published by
+# the Free Software Foundation; either version 3 of the License, or
 # (at your option) any later version.
 #
-# This program is distributed in the hope that it will be useful,
-# but WITHOUT ANY WARRANTY; without even the implied warranty of
-# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-# GNU General Public License for more details.
+# This program is distributed in the hope that it will be useful, but
+# WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+# General Public License for more details.
 #
 # You should have received a copy of the GNU General Public License
-# along with this program; if not, write to the Free Software
-# Foundation, Inc., 51 Franklin Street - Fifth Floor, Boston, MA
-# 02110-1301, USA.
+# along with this program; if not, see <http://www.gnu.org/licenses/>.
 #
 # As a special exception to the GNU General Public License, if you
 # distribute this file as part of a program that contains a
 # configuration script generated by Autoconf, you may include it under
-# the same distribution terms that you use for the rest of that program.
+# the same distribution terms that you use for the rest of that
+# program.  This Exception is an additional permission under section 7
+# of the GNU General Public License, version 3 ("GPLv3").
 
 
-# Please send patches to <config-patches@gnu.org>.  Submit a context
-# diff and a properly formatted GNU ChangeLog entry.
+# Please send patches with a ChangeLog entry to config-patches@gnu.org.
 #
 # Configuration subroutine to validate and canonicalize a configuration type.
 # Supply the specified configuration type as an argument.
@@ -75,8 +68,7 @@ Report bugs and patches to <config-patch
 version="\
 GNU config.sub ($timestamp)
 
-Copyright (C) 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001,
-2002, 2003, 2004, 2005, 2006, 2007, 2008 Free Software Foundation, Inc.
+Copyright 1992-2013 Free Software Foundation, Inc.
 
 This is free software; see the source for copying conditions.  There is NO
 warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE."
@@ -123,13 +115,18 @@ esac
 # Here we must recognize all the valid KERNEL-OS combinations.
 maybe_os=`echo $1 | sed 's/^\(.*\)-\([^-]*-[^-]*\)$/\2/'`
 case $maybe_os in
-  nto-qnx* | linux-gnu* | linux-dietlibc | linux-newlib* | linux-uclibc* | \
-  uclinux-uclibc* | uclinux-gnu* | kfreebsd*-gnu* | knetbsd*-gnu* | netbsd*-gnu* | \
+  nto-qnx* | linux-gnu* | linux-android* | linux-dietlibc | linux-newlib* | \
+  linux-musl* | linux-uclibc* | uclinux-uclibc* | uclinux-gnu* | kfreebsd*-gnu* | \
+  knetbsd*-gnu* | netbsd*-gnu* | \
   kopensolaris*-gnu* | \
   storm-chaos* | os2-emx* | rtmk-nova*)
     os=-$maybe_os
     basic_machine=`echo $1 | sed 's/^\(.*\)-\([^-]*-[^-]*\)$/\1/'`
     ;;
+  android-linux)
+    os=-linux-android
+    basic_machine=`echo $1 | sed 's/^\(.*\)-\([^-]*-[^-]*\)$/\1/'`-unknown
+    ;;
   *)
     basic_machine=`echo $1 | sed 's/-[^-]*$//'`
     if [ $basic_machine != $1 ]
@@ -152,12 +149,12 @@ case $os in
 	-convergent* | -ncr* | -news | -32* | -3600* | -3100* | -hitachi* |\
 	-c[123]* | -convex* | -sun | -crds | -omron* | -dg | -ultra | -tti* | \
 	-harris | -dolphin | -highlevel | -gould | -cbm | -ns | -masscomp | \
-	-apple | -axis | -knuth | -cray | -microblaze)
+	-apple | -axis | -knuth | -cray | -microblaze*)
 		os=
 		basic_machine=$1
 		;;
-        -bluegene*)
-	        os=-cnk
+	-bluegene*)
+		os=-cnk
 		;;
 	-sim | -cisco | -oki | -wec | -winbond)
 		os=
@@ -173,10 +170,10 @@ case $os in
 		os=-chorusos
 		basic_machine=$1
 		;;
- 	-chorusrdb)
- 		os=-chorusrdb
+	-chorusrdb)
+		os=-chorusrdb
 		basic_machine=$1
- 		;;
+		;;
 	-hiux*)
 		os=-hiuxwe2
 		;;
@@ -221,6 +218,12 @@ case $os in
 	-isc*)
 		basic_machine=`echo $1 | sed -e 's/86-.*/86-pc/'`
 		;;
+	-lynx*178)
+		os=-lynxos178
+		;;
+	-lynx*5)
+		os=-lynxos5
+		;;
 	-lynx*)
 		os=-lynxos
 		;;
@@ -245,20 +248,27 @@ case $basic_machine in
 	# Some are omitted here because they have special meanings below.
 	1750a | 580 \
 	| a29k \
+	| aarch64 | aarch64_be \
 	| alpha | alphaev[4-8] | alphaev56 | alphaev6[78] | alphapca5[67] \
 	| alpha64 | alpha64ev[4-8] | alpha64ev56 | alpha64ev6[78] | alpha64pca5[67] \
 	| am33_2.0 \
-	| arc | arm | arm[bl]e | arme[lb] | armv[2345] | armv[345][lb] | avr | avr32 \
+	| arc | arceb \
+	| arm | arm[bl]e | arme[lb] | armv[2-8] | armv[3-8][lb] | armv7[arm] \
+	| avr | avr32 \
+	| be32 | be64 \
 	| bfin \
-	| c4x | clipper \
+	| c4x | c8051 | clipper \
 	| d10v | d30v | dlx | dsp16xx \
+	| epiphany \
 	| fido | fr30 | frv \
 	| h8300 | h8500 | hppa | hppa1.[01] | hppa2.0 | hppa2.0[nw] | hppa64 \
+	| hexagon \
 	| i370 | i860 | i960 | ia64 \
 	| ip2k | iq2000 \
+	| le32 | le64 \
 	| lm32 \
 	| m32c | m32r | m32rle | m68000 | m68k | m88k \
-	| maxq | mb | microblaze | mcore | mep | metag \
+	| maxq | mb | microblaze | microblazeel | mcore | mep | metag \
 	| mips | mipsbe | mipseb | mipsel | mipsle \
 	| mips16 \
 	| mips64 | mips64el \
@@ -276,34 +286,45 @@ case $basic_machine in
 	| mipsisa64r2 | mipsisa64r2el \
 	| mipsisa64sb1 | mipsisa64sb1el \
 	| mipsisa64sr71k | mipsisa64sr71kel \
+	| mipsr5900 | mipsr5900el \
 	| mipstx39 | mipstx39el \
 	| mn10200 | mn10300 \
 	| moxie \
 	| mt \
 	| msp430 \
-	| nios | nios2 \
+	| nds32 | nds32le | nds32be \
+	| nios | nios2 | nios2eb | nios2el \
 	| ns16k | ns32k \
-	| or32 \
+	| open8 \
+	| or1k | or32 \
 	| pdp10 | pdp11 | pj | pjl \
-	| powerpc | powerpc64 | powerpc64le | powerpcle | ppcbe \
+	| powerpc | powerpc64 | powerpc64le | powerpcle \
 	| pyramid \
-	| rx \
+	| rl78 | rx \
 	| score \
 	| sh | sh[1234] | sh[24]a | sh[24]aeb | sh[23]e | sh[34]eb | sheb | shbe | shle | sh[1234]le | sh3ele \
 	| sh64 | sh64le \
 	| sparc | sparc64 | sparc64b | sparc64v | sparc86x | sparclet | sparclite \
 	| sparcv8 | sparcv9 | sparcv9b | sparcv9v \
-	| spu | strongarm \
-	| tahoe | thumb | tic4x | tic80 | tron \
+	| spu \
+	| tahoe | tic4x | tic54x | tic55x | tic6x | tic80 | tron \
 	| ubicom32 \
-	| v850 | v850e \
+	| v850 | v850e | v850e1 | v850e2 | v850es | v850e2v3 \
 	| we32k \
-	| x86 | xc16x | xscale | xscalee[bl] | xstormy16 | xtensa \
+	| x86 | xc16x | xstormy16 | xtensa \
 	| z8k | z80)
 		basic_machine=$basic_machine-unknown
 		;;
-	m6811 | m68hc11 | m6812 | m68hc12 | picochip)
-		# Motorola 68HC11/12.
+	c54x)
+		basic_machine=tic54x-unknown
+		;;
+	c55x)
+		basic_machine=tic55x-unknown
+		;;
+	c6x)
+		basic_machine=tic6x-unknown
+		;;
+	m6811 | m68hc11 | m6812 | m68hc12 | m68hcs12x | picochip)
 		basic_machine=$basic_machine-unknown
 		os=-none
 		;;
@@ -313,6 +334,21 @@ case $basic_machine in
 		basic_machine=mt-unknown
 		;;
 
+	strongarm | thumb | xscale)
+		basic_machine=arm-unknown
+		;;
+	xgate)
+		basic_machine=$basic_machine-unknown
+		os=-none
+		;;
+	xscaleeb)
+		basic_machine=armeb-unknown
+		;;
+
+	xscaleel)
+		basic_machine=armel-unknown
+		;;
+
 	# We use `pc' rather than `unknown'
 	# because (1) that's what they normally are, and
 	# (2) the word "unknown" tends to confuse beginning users.
@@ -327,25 +363,30 @@ case $basic_machine in
 	# Recognize the basic CPU types with company name.
 	580-* \
 	| a29k-* \
+	| aarch64-* | aarch64_be-* \
 	| alpha-* | alphaev[4-8]-* | alphaev56-* | alphaev6[78]-* \
 	| alpha64-* | alpha64ev[4-8]-* | alpha64ev56-* | alpha64ev6[78]-* \
-	| alphapca5[67]-* | alpha64pca5[67]-* | arc-* \
+	| alphapca5[67]-* | alpha64pca5[67]-* | arc-* | arceb-* \
 	| arm-*  | armbe-* | armle-* | armeb-* | armv*-* \
 	| avr-* | avr32-* \
+	| be32-* | be64-* \
 	| bfin-* | bs2000-* \
-	| c[123]* | c30-* | [cjt]90-* | c4x-* | c54x-* | c55x-* | c6x-* \
-	| clipper-* | craynv-* | cydra-* \
+	| c[123]* | c30-* | [cjt]90-* | c4x-* \
+	| c8051-* | clipper-* | craynv-* | cydra-* \
 	| d10v-* | d30v-* | dlx-* \
 	| elxsi-* \
 	| f30[01]-* | f700-* | fido-* | fr30-* | frv-* | fx80-* \
 	| h8300-* | h8500-* \
 	| hppa-* | hppa1.[01]-* | hppa2.0-* | hppa2.0[nw]-* | hppa64-* \
+	| hexagon-* \
 	| i*86-* | i860-* | i960-* | ia64-* \
 	| ip2k-* | iq2000-* \
+	| le32-* | le64-* \
 	| lm32-* \
 	| m32c-* | m32r-* | m32rle-* \
 	| m68000-* | m680[012346]0-* | m68360-* | m683?2-* | m68k-* \
-	| m88110-* | m88k-* | maxq-* | mcore-* | metag-* | microblaze-* \
+	| m88110-* | m88k-* | maxq-* | mcore-* | metag-* \
+	| microblaze-* | microblazeel-* \
 	| mips-* | mipsbe-* | mipseb-* | mipsel-* | mipsle-* \
 	| mips16-* \
 	| mips64-* | mips64el-* \
@@ -363,29 +404,34 @@ case $basic_machine in
 	| mipsisa64r2-* | mipsisa64r2el-* \
 	| mipsisa64sb1-* | mipsisa64sb1el-* \
 	| mipsisa64sr71k-* | mipsisa64sr71kel-* \
+	| mipsr5900-* | mipsr5900el-* \
 	| mipstx39-* | mipstx39el-* \
 	| mmix-* \
 	| mt-* \
 	| msp430-* \
-	| nios-* | nios2-* \
+	| nds32-* | nds32le-* | nds32be-* \
+	| nios-* | nios2-* | nios2eb-* | nios2el-* \
 	| none-* | np1-* | ns16k-* | ns32k-* \
+	| open8-* \
 	| orion-* \
 	| pdp10-* | pdp11-* | pj-* | pjl-* | pn-* | power-* \
-	| powerpc-* | powerpc64-* | powerpc64le-* | powerpcle-* | ppcbe-* \
+	| powerpc-* | powerpc64-* | powerpc64le-* | powerpcle-* \
 	| pyramid-* \
-	| romp-* | rs6000-* | rx-* \
+	| rl78-* | romp-* | rs6000-* | rx-* \
 	| sh-* | sh[1234]-* | sh[24]a-* | sh[24]aeb-* | sh[23]e-* | sh[34]eb-* | sheb-* | shbe-* \
 	| shle-* | sh[1234]le-* | sh3ele-* | sh64-* | sh64le-* \
 	| sparc-* | sparc64-* | sparc64b-* | sparc64v-* | sparc86x-* | sparclet-* \
 	| sparclite-* \
-	| sparcv8-* | sparcv9-* | sparcv9b-* | sparcv9v-* | strongarm-* | sv1-* | sx?-* \
-	| tahoe-* | thumb-* \
-	| tic30-* | tic4x-* | tic54x-* | tic55x-* | tic6x-* | tic80-* | tile-* \
+	| sparcv8-* | sparcv9-* | sparcv9b-* | sparcv9v-* | sv1-* | sx?-* \
+	| tahoe-* \
+	| tic30-* | tic4x-* | tic54x-* | tic55x-* | tic6x-* | tic80-* \
+	| tile*-* \
 	| tron-* \
 	| ubicom32-* \
-	| v850-* | v850e-* | vax-* \
+	| v850-* | v850e-* | v850e1-* | v850es-* | v850e2-* | v850e2v3-* \
+	| vax-* \
 	| we32k-* \
-	| x86-* | x86_64-* | xc16x-* | xps100-* | xscale-* | xscalee[bl]-* \
+	| x86-* | x86_64-* | xc16x-* | xps100-* \
 	| xstormy16-* | xtensa*-* \
 	| ymp-* \
 	| z8k-* | z80-*)
@@ -410,7 +456,7 @@ case $basic_machine in
 		basic_machine=a29k-amd
 		os=-udi
 		;;
-    	abacus)
+	abacus)
 		basic_machine=abacus-unknown
 		;;
 	adobe68k)
@@ -480,11 +526,20 @@ case $basic_machine in
 		basic_machine=powerpc-ibm
 		os=-cnk
 		;;
+	c54x-*)
+		basic_machine=tic54x-`echo $basic_machine | sed 's/^[^-]*-//'`
+		;;
+	c55x-*)
+		basic_machine=tic55x-`echo $basic_machine | sed 's/^[^-]*-//'`
+		;;
+	c6x-*)
+		basic_machine=tic6x-`echo $basic_machine | sed 's/^[^-]*-//'`
+		;;
 	c90)
 		basic_machine=c90-cray
 		os=-unicos
 		;;
-        cegcc)
+	cegcc)
 		basic_machine=arm-unknown
 		os=-cegcc
 		;;
@@ -516,7 +571,7 @@ case $basic_machine in
 		basic_machine=craynv-cray
 		os=-unicosmp
 		;;
-	cr16)
+	cr16 | cr16-*)
 		basic_machine=cr16-unknown
 		os=-elf
 		;;
@@ -674,7 +729,6 @@ case $basic_machine in
 	i370-ibm* | ibm*)
 		basic_machine=i370-ibm
 		;;
-# I'm not sure what "Sysv32" means.  Should this be sysv3.2?
 	i*86v32)
 		basic_machine=`echo $1 | sed -e 's/86.*/86-pc/'`
 		os=-sysv32
@@ -732,11 +786,15 @@ case $basic_machine in
 		basic_machine=ns32k-utek
 		os=-sysv
 		;;
-        microblaze)
+	microblaze*)
 		basic_machine=microblaze-xilinx
 		;;
+	mingw64)
+		basic_machine=x86_64-pc
+		os=-mingw64
+		;;
 	mingw32)
-		basic_machine=i386-pc
+		basic_machine=i686-pc
 		os=-mingw32
 		;;
 	mingw32ce)
@@ -771,10 +829,18 @@ case $basic_machine in
 	ms1-*)
 		basic_machine=`echo $basic_machine | sed -e 's/ms1-/mt-/'`
 		;;
+	msys)
+		basic_machine=i686-pc
+		os=-msys
+		;;
 	mvs)
 		basic_machine=i370-ibm
 		os=-mvs
 		;;
+	nacl)
+		basic_machine=le32-unknown
+		os=-nacl
+		;;
 	ncr3000)
 		basic_machine=i486-ncr
 		os=-sysv4
@@ -839,6 +905,12 @@ case $basic_machine in
 	np1)
 		basic_machine=np1-gould
 		;;
+	neo-tandem)
+		basic_machine=neo-tandem
+		;;
+	nse-tandem)
+		basic_machine=nse-tandem
+		;;
 	nsr-tandem)
 		basic_machine=nsr-tandem
 		;;
@@ -921,9 +993,10 @@ case $basic_machine in
 		;;
 	power)	basic_machine=power-ibm
 		;;
-	ppc)	basic_machine=powerpc-unknown
+	ppc | ppcbe)	basic_machine=powerpc-unknown
 		;;
-	ppc-*)	basic_machine=powerpc-`echo $basic_machine | sed 's/^[^-]*-//'`
+	ppc-* | ppcbe-*)
+		basic_machine=powerpc-`echo $basic_machine | sed 's/^[^-]*-//'`
 		;;
 	ppcle | powerpclittle | ppc-le | powerpc-little)
 		basic_machine=powerpcle-unknown
@@ -933,7 +1006,7 @@ case $basic_machine in
 		;;
 	ppc64)	basic_machine=powerpc64-unknown
 		;;
-	ppc64-*) basic_machine=powerpc64-`echo $basic_machine | sed 's/^[^-]*-//'`
+	ppc64-* | ppc64p7-*) basic_machine=powerpc64-`echo $basic_machine | sed 's/^[^-]*-//'`
 		;;
 	ppc64le | powerpc64little | ppc64-le | powerpc64-little)
 		basic_machine=powerpc64le-unknown
@@ -948,7 +1021,11 @@ case $basic_machine in
 		basic_machine=i586-unknown
 		os=-pw32
 		;;
-	rdos)
+	rdos | rdos64)
+		basic_machine=x86_64-pc
+		os=-rdos
+		;;
+	rdos32)
 		basic_machine=i386-pc
 		os=-rdos
 		;;
@@ -1017,6 +1094,9 @@ case $basic_machine in
 		basic_machine=i860-stratus
 		os=-sysv4
 		;;
+	strongarm-* | thumb-*)
+		basic_machine=arm-`echo $basic_machine | sed 's/^[^-]*-//'`
+		;;
 	sun2)
 		basic_machine=m68000-sun
 		;;
@@ -1073,20 +1153,8 @@ case $basic_machine in
 		basic_machine=t90-cray
 		os=-unicos
 		;;
-	tic54x | c54x*)
-		basic_machine=tic54x-unknown
-		os=-coff
-		;;
-	tic55x | c55x*)
-		basic_machine=tic55x-unknown
-		os=-coff
-		;;
-	tic6x | c6x*)
-		basic_machine=tic6x-unknown
-		os=-coff
-		;;
 	tile*)
-		basic_machine=tile-unknown
+		basic_machine=$basic_machine-unknown
 		os=-linux-gnu
 		;;
 	tx39)
@@ -1156,6 +1224,9 @@ case $basic_machine in
 	xps | xps100)
 		basic_machine=xps100-honeywell
 		;;
+	xscale-* | xscalee[bl]-*)
+		basic_machine=`echo $basic_machine | sed 's/^xscale/arm/'`
+		;;
 	ymp)
 		basic_machine=ymp-cray
 		os=-unicos
@@ -1253,11 +1324,11 @@ esac
 if [ x"$os" != x"" ]
 then
 case $os in
-        # First match some system type aliases
-        # that might get confused with valid system types.
+	# First match some system type aliases
+	# that might get confused with valid system types.
 	# -solaris* is a basic system type, with this one exception.
-        -auroraux)
-	        os=-auroraux
+	-auroraux)
+		os=-auroraux
 		;;
 	-solaris1 | -solaris1.*)
 		os=`echo $os | sed -e 's|solaris1|sunos4|'`
@@ -1281,20 +1352,21 @@ case $os in
 	-gnu* | -bsd* | -mach* | -minix* | -genix* | -ultrix* | -irix* \
 	      | -*vms* | -sco* | -esix* | -isc* | -aix* | -cnk* | -sunos | -sunos[34]*\
 	      | -hpux* | -unos* | -osf* | -luna* | -dgux* | -auroraux* | -solaris* \
-	      | -sym* | -kopensolaris* \
+	      | -sym* | -kopensolaris* | -plan9* \
 	      | -amigaos* | -amigados* | -msdos* | -newsos* | -unicos* | -aof* \
 	      | -aos* | -aros* \
 	      | -nindy* | -vxsim* | -vxworks* | -ebmon* | -hms* | -mvs* \
 	      | -clix* | -riscos* | -uniplus* | -iris* | -rtu* | -xenix* \
 	      | -hiux* | -386bsd* | -knetbsd* | -mirbsd* | -netbsd* \
-	      | -openbsd* | -solidbsd* \
+	      | -bitrig* | -openbsd* | -solidbsd* \
 	      | -ekkobsd* | -kfreebsd* | -freebsd* | -riscix* | -lynxos* \
 	      | -bosx* | -nextstep* | -cxux* | -aout* | -elf* | -oabi* \
 	      | -ptx* | -coff* | -ecoff* | -winnt* | -domain* | -vsta* \
 	      | -udi* | -eabi* | -lites* | -ieee* | -go32* | -aux* \
 	      | -chorusos* | -chorusrdb* | -cegcc* \
-	      | -cygwin* | -pe* | -psos* | -moss* | -proelf* | -rtems* \
-	      | -mingw32* | -linux-gnu* | -linux-newlib* | -linux-uclibc* \
+	      | -cygwin* | -msys* | -pe* | -psos* | -moss* | -proelf* | -rtems* \
+	      | -mingw32* | -mingw64* | -linux-gnu* | -linux-android* \
+	      | -linux-newlib* | -linux-musl* | -linux-uclibc* \
 	      | -uxpv* | -beos* | -mpeix* | -udk* \
 	      | -interix* | -uwin* | -mks* | -rhapsody* | -darwin* | -opened* \
 	      | -openstep* | -oskit* | -conix* | -pw32* | -nonstopux* \
@@ -1341,7 +1413,7 @@ case $os in
 	-opened*)
 		os=-openedition
 		;;
-        -os400*)
+	-os400*)
 		os=-os400
 		;;
 	-wince*)
@@ -1390,7 +1462,7 @@ case $os in
 	-sinix*)
 		os=-sysv4
 		;;
-        -tpf*)
+	-tpf*)
 		os=-tpf
 		;;
 	-triton*)
@@ -1426,15 +1498,14 @@ case $os in
 	-aros*)
 		os=-aros
 		;;
-	-kaos*)
-		os=-kaos
-		;;
 	-zvmoe)
 		os=-zvmoe
 		;;
 	-dicos*)
 		os=-dicos
 		;;
+	-nacl*)
+		;;
 	-none)
 		;;
 	*)
@@ -1457,10 +1528,10 @@ else
 # system, and we'll never get to this point.
 
 case $basic_machine in
-        score-*)
+	score-*)
 		os=-elf
 		;;
-        spu-*)
+	spu-*)
 		os=-elf
 		;;
 	*-acorn)
@@ -1472,8 +1543,23 @@ case $basic_machine in
 	arm*-semi)
 		os=-aout
 		;;
-        c4x-* | tic4x-*)
-        	os=-coff
+	c4x-* | tic4x-*)
+		os=-coff
+		;;
+	c8051-*)
+		os=-elf
+		;;
+	hexagon-*)
+		os=-elf
+		;;
+	tic54x-*)
+		os=-coff
+		;;
+	tic55x-*)
+		os=-coff
+		;;
+	tic6x-*)
+		os=-coff
 		;;
 	# This must come before the *-dec entry.
 	pdp10-*)
@@ -1493,14 +1579,11 @@ case $basic_machine in
 		;;
 	m68000-sun)
 		os=-sunos3
-		# This also exists in the configure program, but was not the
-		# default.
-		# os=-sunos4
 		;;
 	m68*-cisco)
 		os=-aout
 		;;
-        mep-*)
+	mep-*)
 		os=-elf
 		;;
 	mips*-cisco)
@@ -1509,6 +1592,9 @@ case $basic_machine in
 	mips*-*)
 		os=-elf
 		;;
+	or1k-*)
+		os=-elf
+		;;
 	or32-*)
 		os=-coff
 		;;
@@ -1527,7 +1613,7 @@ case $basic_machine in
 	*-ibm)
 		os=-aix
 		;;
-    	*-knuth)
+	*-knuth)
 		os=-mmixware
 		;;
 	*-wec)
diff -urpN xfsprogs-4.9.0/configure xfsprogs-4.14.0/configure
--- xfsprogs-4.9.0/configure	2017-01-05 23:33:48.000000000 +0100
+++ xfsprogs-4.14.0/configure	2017-11-27 17:58:21.000000000 +0100
@@ -1,20 +1,22 @@
 #! /bin/sh
 # Guess values for system-dependent variables and create Makefiles.
-# Generated by GNU Autoconf 2.63 for xfsprogs 4.9.0.
+# Generated by GNU Autoconf 2.69 for xfsprogs 4.14.0.
 #
 # Report bugs to <linux-xfs@vger.kernel.org>.
 #
-# Copyright (C) 1992, 1993, 1994, 1995, 1996, 1998, 1999, 2000, 2001,
-# 2002, 2003, 2004, 2005, 2006, 2007, 2008 Free Software Foundation, Inc.
+#
+# Copyright (C) 1992-1996, 1998-2012 Free Software Foundation, Inc.
+#
+#
 # This configure script is free software; the Free Software Foundation
 # gives unlimited permission to copy, distribute and modify it.
-## --------------------- ##
-## M4sh Initialization.  ##
-## --------------------- ##
+## -------------------- ##
+## M4sh Initialization. ##
+## -------------------- ##
 
 # Be more Bourne compatible
 DUALCASE=1; export DUALCASE # for MKS sh
-if test -n "${ZSH_VERSION+set}" && (emulate sh) >/dev/null 2>&1; then
+if test -n "${ZSH_VERSION+set}" && (emulate sh) >/dev/null 2>&1; then :
   emulate sh
   NULLCMD=:
   # Pre-4.2 versions of Zsh do word splitting on ${1+"$@"}, which
@@ -22,23 +24,15 @@ if test -n "${ZSH_VERSION+set}" && (emul
   alias -g '${1+"$@"}'='"$@"'
   setopt NO_GLOB_SUBST
 else
-  case `(set -o) 2>/dev/null` in
-  *posix*) set -o posix ;;
+  case `(set -o) 2>/dev/null` in #(
+  *posix*) :
+    set -o posix ;; #(
+  *) :
+     ;;
 esac
-
 fi
 
 
-
-
-# PATH needs CR
-# Avoid depending upon Character Ranges.
-as_cr_letters='abcdefghijklmnopqrstuvwxyz'
-as_cr_LETTERS='ABCDEFGHIJKLMNOPQRSTUVWXYZ'
-as_cr_Letters=$as_cr_letters$as_cr_LETTERS
-as_cr_digits='0123456789'
-as_cr_alnum=$as_cr_Letters$as_cr_digits
-
 as_nl='
 '
 export as_nl
@@ -46,7 +40,13 @@ export as_nl
 as_echo='\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\'
 as_echo=$as_echo$as_echo$as_echo$as_echo$as_echo
 as_echo=$as_echo$as_echo$as_echo$as_echo$as_echo$as_echo
-if (test "X`printf %s $as_echo`" = "X$as_echo") 2>/dev/null; then
+# Prefer a ksh shell builtin over an external printf program on Solaris,
+# but without wasting forks for bash or zsh.
+if test -z "$BASH_VERSION$ZSH_VERSION" \
+    && (test "X`print -r -- $as_echo`" = "X$as_echo") 2>/dev/null; then
+  as_echo='print -r --'
+  as_echo_n='print -rn --'
+elif (test "X`printf %s $as_echo`" = "X$as_echo") 2>/dev/null; then
   as_echo='printf %s\n'
   as_echo_n='printf %s'
 else
@@ -57,7 +57,7 @@ else
     as_echo_body='eval expr "X$1" : "X\\(.*\\)"'
     as_echo_n_body='eval
       arg=$1;
-      case $arg in
+      case $arg in #(
       *"$as_nl"*)
 	expr "X$arg" : "X\\(.*\\)$as_nl";
 	arg=`expr "X$arg" : ".*$as_nl\\(.*\\)"`;;
@@ -80,13 +80,6 @@ if test "${PATH_SEPARATOR+set}" != set;
   }
 fi
 
-# Support unset when possible.
-if ( (MAIL=60; unset MAIL) || exit) >/dev/null 2>&1; then
-  as_unset=unset
-else
-  as_unset=false
-fi
-
 
 # IFS
 # We need space, tab and new line, in precisely that order.  Quoting is
@@ -96,15 +89,16 @@ fi
 IFS=" ""	$as_nl"
 
 # Find who we are.  Look in the path if we contain no directory separator.
-case $0 in
+as_myself=
+case $0 in #((
   *[\\/]* ) as_myself=$0 ;;
   *) as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
 for as_dir in $PATH
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  test -r "$as_dir/$0" && as_myself=$as_dir/$0 && break
-done
+    test -r "$as_dir/$0" && as_myself=$as_dir/$0 && break
+  done
 IFS=$as_save_IFS
 
      ;;
@@ -116,12 +110,16 @@ if test "x$as_myself" = x; then
 fi
 if test ! -f "$as_myself"; then
   $as_echo "$as_myself: error: cannot find myself; rerun with an absolute file name" >&2
-  { (exit 1); exit 1; }
+  exit 1
 fi
 
-# Work around bugs in pre-3.0 UWIN ksh.
-for as_var in ENV MAIL MAILPATH
-do ($as_unset $as_var) >/dev/null 2>&1 && $as_unset $as_var
+# Unset variables that we do not need and which cause bugs (e.g. in
+# pre-3.0 UWIN ksh).  But do not cause bugs in bash 2.01; the "|| exit 1"
+# suppresses any "Segmentation fault" message there.  '((' could
+# trigger a bug in pdksh 5.2.14.
+for as_var in BASH_ENV ENV MAIL MAILPATH
+do eval test x\${$as_var+set} = xset \
+  && ( (unset $as_var) || exit 1) >/dev/null 2>&1 && unset $as_var || :
 done
 PS1='$ '
 PS2='> '
@@ -133,330 +131,353 @@ export LC_ALL
 LANGUAGE=C
 export LANGUAGE
 
-# Required to use basename.
-if expr a : '\(a\)' >/dev/null 2>&1 &&
-   test "X`expr 00001 : '.*\(...\)'`" = X001; then
-  as_expr=expr
-else
-  as_expr=false
-fi
-
-if (basename -- /) >/dev/null 2>&1 && test "X`basename -- / 2>&1`" = "X/"; then
-  as_basename=basename
-else
-  as_basename=false
-fi
-
-
-# Name of the executable.
-as_me=`$as_basename -- "$0" ||
-$as_expr X/"$0" : '.*/\([^/][^/]*\)/*$' \| \
-	 X"$0" : 'X\(//\)$' \| \
-	 X"$0" : 'X\(/\)' \| . 2>/dev/null ||
-$as_echo X/"$0" |
-    sed '/^.*\/\([^/][^/]*\)\/*$/{
-	    s//\1/
-	    q
-	  }
-	  /^X\/\(\/\/\)$/{
-	    s//\1/
-	    q
-	  }
-	  /^X\/\(\/\).*/{
-	    s//\1/
-	    q
-	  }
-	  s/.*/./; q'`
-
 # CDPATH.
-$as_unset CDPATH
-
+(unset CDPATH) >/dev/null 2>&1 && unset CDPATH
 
+# Use a proper internal environment variable to ensure we don't fall
+  # into an infinite loop, continuously re-executing ourselves.
+  if test x"${_as_can_reexec}" != xno && test "x$CONFIG_SHELL" != x; then
+    _as_can_reexec=no; export _as_can_reexec;
+    # We cannot yet assume a decent shell, so we have to provide a
+# neutralization value for shells without unset; and this also
+# works around shells that cannot unset nonexistent variables.
+# Preserve -v and -x to the replacement shell.
+BASH_ENV=/dev/null
+ENV=/dev/null
+(unset BASH_ENV) >/dev/null 2>&1 && unset BASH_ENV ENV
+case $- in # ((((
+  *v*x* | *x*v* ) as_opts=-vx ;;
+  *v* ) as_opts=-v ;;
+  *x* ) as_opts=-x ;;
+  * ) as_opts= ;;
+esac
+exec $CONFIG_SHELL $as_opts "$as_myself" ${1+"$@"}
+# Admittedly, this is quite paranoid, since all the known shells bail
+# out after a failed `exec'.
+$as_echo "$0: could not re-execute with $CONFIG_SHELL" >&2
+as_fn_exit 255
+  fi
+  # We don't want this to propagate to other subprocesses.
+          { _as_can_reexec=; unset _as_can_reexec;}
 if test "x$CONFIG_SHELL" = x; then
-  if (eval ":") 2>/dev/null; then
-  as_have_required=yes
+  as_bourne_compatible="if test -n \"\${ZSH_VERSION+set}\" && (emulate sh) >/dev/null 2>&1; then :
+  emulate sh
+  NULLCMD=:
+  # Pre-4.2 versions of Zsh do word splitting on \${1+\"\$@\"}, which
+  # is contrary to our usage.  Disable this feature.
+  alias -g '\${1+\"\$@\"}'='\"\$@\"'
+  setopt NO_GLOB_SUBST
 else
-  as_have_required=no
+  case \`(set -o) 2>/dev/null\` in #(
+  *posix*) :
+    set -o posix ;; #(
+  *) :
+     ;;
+esac
 fi
-
-  if test $as_have_required = yes &&	 (eval ":
-(as_func_return () {
-  (exit \$1)
-}
-as_func_success () {
-  as_func_return 0
-}
-as_func_failure () {
-  as_func_return 1
-}
-as_func_ret_success () {
-  return 0
-}
-as_func_ret_failure () {
-  return 1
-}
+"
+  as_required="as_fn_return () { (exit \$1); }
+as_fn_success () { as_fn_return 0; }
+as_fn_failure () { as_fn_return 1; }
+as_fn_ret_success () { return 0; }
+as_fn_ret_failure () { return 1; }
 
 exitcode=0
-if as_func_success; then
-  :
-else
-  exitcode=1
-  echo as_func_success failed.
-fi
-
-if as_func_failure; then
-  exitcode=1
-  echo as_func_failure succeeded.
-fi
-
-if as_func_ret_success; then
-  :
-else
-  exitcode=1
-  echo as_func_ret_success failed.
-fi
-
-if as_func_ret_failure; then
-  exitcode=1
-  echo as_func_ret_failure succeeded.
-fi
-
-if ( set x; as_func_ret_success y && test x = \"\$1\" ); then
-  :
+as_fn_success || { exitcode=1; echo as_fn_success failed.; }
+as_fn_failure && { exitcode=1; echo as_fn_failure succeeded.; }
+as_fn_ret_success || { exitcode=1; echo as_fn_ret_success failed.; }
+as_fn_ret_failure && { exitcode=1; echo as_fn_ret_failure succeeded.; }
+if ( set x; as_fn_ret_success y && test x = \"\$1\" ); then :
+
+else
+  exitcode=1; echo positional parameters were not saved.
+fi
+test x\$exitcode = x0 || exit 1
+test -x / || exit 1"
+  as_suggested="  as_lineno_1=";as_suggested=$as_suggested$LINENO;as_suggested=$as_suggested" as_lineno_1a=\$LINENO
+  as_lineno_2=";as_suggested=$as_suggested$LINENO;as_suggested=$as_suggested" as_lineno_2a=\$LINENO
+  eval 'test \"x\$as_lineno_1'\$as_run'\" != \"x\$as_lineno_2'\$as_run'\" &&
+  test \"x\`expr \$as_lineno_1'\$as_run' + 1\`\" = \"x\$as_lineno_2'\$as_run'\"' || exit 1
+
+  test -n \"\${ZSH_VERSION+set}\${BASH_VERSION+set}\" || (
+    ECHO='\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\'
+    ECHO=\$ECHO\$ECHO\$ECHO\$ECHO\$ECHO
+    ECHO=\$ECHO\$ECHO\$ECHO\$ECHO\$ECHO\$ECHO
+    PATH=/empty FPATH=/empty; export PATH FPATH
+    test \"X\`printf %s \$ECHO\`\" = \"X\$ECHO\" \\
+      || test \"X\`print -r -- \$ECHO\`\" = \"X\$ECHO\" ) || exit 1
+test \$(( 1 + 1 )) = 2 || exit 1"
+  if (eval "$as_required") 2>/dev/null; then :
+  as_have_required=yes
 else
-  exitcode=1
-  echo positional parameters were not saved.
+  as_have_required=no
 fi
+  if test x$as_have_required = xyes && (eval "$as_suggested") 2>/dev/null; then :
 
-test \$exitcode = 0) || { (exit 1); exit 1; }
-
-(
-  as_lineno_1=\$LINENO
-  as_lineno_2=\$LINENO
-  test \"x\$as_lineno_1\" != \"x\$as_lineno_2\" &&
-  test \"x\`expr \$as_lineno_1 + 1\`\" = \"x\$as_lineno_2\") || { (exit 1); exit 1; }
-") 2> /dev/null; then
-  :
 else
-  as_candidate_shells=
-    as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+as_found=false
 for as_dir in /bin$PATH_SEPARATOR/usr/bin$PATH_SEPARATOR$PATH
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  case $as_dir in
+  as_found=:
+  case $as_dir in #(
 	 /*)
 	   for as_base in sh bash ksh sh5; do
-	     as_candidate_shells="$as_candidate_shells $as_dir/$as_base"
+	     # Try only shells that exist, to save several forks.
+	     as_shell=$as_dir/$as_base
+	     if { test -f "$as_shell" || test -f "$as_shell.exe"; } &&
+		    { $as_echo "$as_bourne_compatible""$as_required" | as_run=a "$as_shell"; } 2>/dev/null; then :
+  CONFIG_SHELL=$as_shell as_have_required=yes
+		   if { $as_echo "$as_bourne_compatible""$as_suggested" | as_run=a "$as_shell"; } 2>/dev/null; then :
+  break 2
+fi
+fi
 	   done;;
        esac
+  as_found=false
 done
+$as_found || { if { test -f "$SHELL" || test -f "$SHELL.exe"; } &&
+	      { $as_echo "$as_bourne_compatible""$as_required" | as_run=a "$SHELL"; } 2>/dev/null; then :
+  CONFIG_SHELL=$SHELL as_have_required=yes
+fi; }
 IFS=$as_save_IFS
 
 
-      for as_shell in $as_candidate_shells $SHELL; do
-	 # Try only shells that exist, to save several forks.
-	 if { test -f "$as_shell" || test -f "$as_shell.exe"; } &&
-		{ ("$as_shell") 2> /dev/null <<\_ASEOF
-if test -n "${ZSH_VERSION+set}" && (emulate sh) >/dev/null 2>&1; then
-  emulate sh
-  NULLCMD=:
-  # Pre-4.2 versions of Zsh do word splitting on ${1+"$@"}, which
-  # is contrary to our usage.  Disable this feature.
-  alias -g '${1+"$@"}'='"$@"'
-  setopt NO_GLOB_SUBST
-else
-  case `(set -o) 2>/dev/null` in
-  *posix*) set -o posix ;;
-esac
-
+      if test "x$CONFIG_SHELL" != x; then :
+  export CONFIG_SHELL
+             # We cannot yet assume a decent shell, so we have to provide a
+# neutralization value for shells without unset; and this also
+# works around shells that cannot unset nonexistent variables.
+# Preserve -v and -x to the replacement shell.
+BASH_ENV=/dev/null
+ENV=/dev/null
+(unset BASH_ENV) >/dev/null 2>&1 && unset BASH_ENV ENV
+case $- in # ((((
+  *v*x* | *x*v* ) as_opts=-vx ;;
+  *v* ) as_opts=-v ;;
+  *x* ) as_opts=-x ;;
+  * ) as_opts= ;;
+esac
+exec $CONFIG_SHELL $as_opts "$as_myself" ${1+"$@"}
+# Admittedly, this is quite paranoid, since all the known shells bail
+# out after a failed `exec'.
+$as_echo "$0: could not re-execute with $CONFIG_SHELL" >&2
+exit 255
+fi
+
+    if test x$as_have_required = xno; then :
+  $as_echo "$0: This script requires a shell more modern than all"
+  $as_echo "$0: the shells that I found on your system."
+  if test x${ZSH_VERSION+set} = xset ; then
+    $as_echo "$0: In particular, zsh $ZSH_VERSION has bugs and should"
+    $as_echo "$0: be upgraded to zsh 4.3.4 or later."
+  else
+    $as_echo "$0: Please tell bug-autoconf@gnu.org and
+$0: linux-xfs@vger.kernel.org about your system, including
+$0: any error possibly output before this message. Then
+$0: install a modern shell, or manually run the script
+$0: under such a shell if you do have one."
+  fi
+  exit 1
+fi
 fi
-
-
-:
-_ASEOF
-}; then
-  CONFIG_SHELL=$as_shell
-	       as_have_required=yes
-	       if { "$as_shell" 2> /dev/null <<\_ASEOF
-if test -n "${ZSH_VERSION+set}" && (emulate sh) >/dev/null 2>&1; then
-  emulate sh
-  NULLCMD=:
-  # Pre-4.2 versions of Zsh do word splitting on ${1+"$@"}, which
-  # is contrary to our usage.  Disable this feature.
-  alias -g '${1+"$@"}'='"$@"'
-  setopt NO_GLOB_SUBST
-else
-  case `(set -o) 2>/dev/null` in
-  *posix*) set -o posix ;;
-esac
-
 fi
+SHELL=${CONFIG_SHELL-/bin/sh}
+export SHELL
+# Unset more variables known to interfere with behavior of common tools.
+CLICOLOR_FORCE= GREP_OPTIONS=
+unset CLICOLOR_FORCE GREP_OPTIONS
 
+## --------------------- ##
+## M4sh Shell Functions. ##
+## --------------------- ##
+# as_fn_unset VAR
+# ---------------
+# Portably unset VAR.
+as_fn_unset ()
+{
+  { eval $1=; unset $1;}
+}
+as_unset=as_fn_unset
+
+# as_fn_set_status STATUS
+# -----------------------
+# Set $? to STATUS, without forking.
+as_fn_set_status ()
+{
+  return $1
+} # as_fn_set_status
+
+# as_fn_exit STATUS
+# -----------------
+# Exit the shell with STATUS, even in a "trap 0" or "set -e" context.
+as_fn_exit ()
+{
+  set +e
+  as_fn_set_status $1
+  exit $1
+} # as_fn_exit
+
+# as_fn_mkdir_p
+# -------------
+# Create "$as_dir" as a directory, including parents if necessary.
+as_fn_mkdir_p ()
+{
 
-:
-(as_func_return () {
-  (exit $1)
-}
-as_func_success () {
-  as_func_return 0
-}
-as_func_failure () {
-  as_func_return 1
-}
-as_func_ret_success () {
-  return 0
-}
-as_func_ret_failure () {
-  return 1
-}
+  case $as_dir in #(
+  -*) as_dir=./$as_dir;;
+  esac
+  test -d "$as_dir" || eval $as_mkdir_p || {
+    as_dirs=
+    while :; do
+      case $as_dir in #(
+      *\'*) as_qdir=`$as_echo "$as_dir" | sed "s/'/'\\\\\\\\''/g"`;; #'(
+      *) as_qdir=$as_dir;;
+      esac
+      as_dirs="'$as_qdir' $as_dirs"
+      as_dir=`$as_dirname -- "$as_dir" ||
+$as_expr X"$as_dir" : 'X\(.*[^/]\)//*[^/][^/]*/*$' \| \
+	 X"$as_dir" : 'X\(//\)[^/]' \| \
+	 X"$as_dir" : 'X\(//\)$' \| \
+	 X"$as_dir" : 'X\(/\)' \| . 2>/dev/null ||
+$as_echo X"$as_dir" |
+    sed '/^X\(.*[^/]\)\/\/*[^/][^/]*\/*$/{
+	    s//\1/
+	    q
+	  }
+	  /^X\(\/\/\)[^/].*/{
+	    s//\1/
+	    q
+	  }
+	  /^X\(\/\/\)$/{
+	    s//\1/
+	    q
+	  }
+	  /^X\(\/\).*/{
+	    s//\1/
+	    q
+	  }
+	  s/.*/./; q'`
+      test -d "$as_dir" && break
+    done
+    test -z "$as_dirs" || eval "mkdir $as_dirs"
+  } || test -d "$as_dir" || as_fn_error $? "cannot create directory $as_dir"
 
-exitcode=0
-if as_func_success; then
-  :
-else
-  exitcode=1
-  echo as_func_success failed.
-fi
 
-if as_func_failure; then
-  exitcode=1
-  echo as_func_failure succeeded.
-fi
+} # as_fn_mkdir_p
 
-if as_func_ret_success; then
-  :
+# as_fn_executable_p FILE
+# -----------------------
+# Test if FILE is an executable regular file.
+as_fn_executable_p ()
+{
+  test -f "$1" && test -x "$1"
+} # as_fn_executable_p
+# as_fn_append VAR VALUE
+# ----------------------
+# Append the text in VALUE to the end of the definition contained in VAR. Take
+# advantage of any shell optimizations that allow amortized linear growth over
+# repeated appends, instead of the typical quadratic growth present in naive
+# implementations.
+if (eval "as_var=1; as_var+=2; test x\$as_var = x12") 2>/dev/null; then :
+  eval 'as_fn_append ()
+  {
+    eval $1+=\$2
+  }'
 else
-  exitcode=1
-  echo as_func_ret_success failed.
-fi
-
-if as_func_ret_failure; then
-  exitcode=1
-  echo as_func_ret_failure succeeded.
-fi
+  as_fn_append ()
+  {
+    eval $1=\$$1\$2
+  }
+fi # as_fn_append
 
-if ( set x; as_func_ret_success y && test x = "$1" ); then
-  :
+# as_fn_arith ARG...
+# ------------------
+# Perform arithmetic evaluation on the ARGs, and store the result in the
+# global $as_val. Take advantage of shells that can avoid forks. The arguments
+# must be portable across $(()) and expr.
+if (eval "test \$(( 1 + 1 )) = 2") 2>/dev/null; then :
+  eval 'as_fn_arith ()
+  {
+    as_val=$(( $* ))
+  }'
 else
-  exitcode=1
-  echo positional parameters were not saved.
-fi
-
-test $exitcode = 0) || { (exit 1); exit 1; }
-
-(
-  as_lineno_1=$LINENO
-  as_lineno_2=$LINENO
-  test "x$as_lineno_1" != "x$as_lineno_2" &&
-  test "x`expr $as_lineno_1 + 1`" = "x$as_lineno_2") || { (exit 1); exit 1; }
-
-_ASEOF
-}; then
-  break
-fi
-
-fi
-
-      done
-
-      if test "x$CONFIG_SHELL" != x; then
-  for as_var in BASH_ENV ENV
-	do ($as_unset $as_var) >/dev/null 2>&1 && $as_unset $as_var
-	done
-	export CONFIG_SHELL
-	exec "$CONFIG_SHELL" "$as_myself" ${1+"$@"}
-fi
-
-
-    if test $as_have_required = no; then
-  echo This script requires a shell more modern than all the
-      echo shells that I found on your system.  Please install a
-      echo modern shell, or manually run the script under such a
-      echo shell if you do have one.
-      { (exit 1); exit 1; }
-fi
-
-
-fi
-
-fi
-
+  as_fn_arith ()
+  {
+    as_val=`expr "$@" || test $? -eq 1`
+  }
+fi # as_fn_arith
 
 
-(eval "as_func_return () {
-  (exit \$1)
-}
-as_func_success () {
-  as_func_return 0
-}
-as_func_failure () {
-  as_func_return 1
-}
-as_func_ret_success () {
-  return 0
-}
-as_func_ret_failure () {
-  return 1
-}
+# as_fn_error STATUS ERROR [LINENO LOG_FD]
+# ----------------------------------------
+# Output "`basename $0`: error: ERROR" to stderr. If LINENO and LOG_FD are
+# provided, also output the error to LOG_FD, referencing LINENO. Then exit the
+# script with STATUS, using 1 if that was 0.
+as_fn_error ()
+{
+  as_status=$1; test $as_status -eq 0 && as_status=1
+  if test "$4"; then
+    as_lineno=${as_lineno-"$3"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+    $as_echo "$as_me:${as_lineno-$LINENO}: error: $2" >&$4
+  fi
+  $as_echo "$as_me: error: $2" >&2
+  as_fn_exit $as_status
+} # as_fn_error
 
-exitcode=0
-if as_func_success; then
-  :
+if expr a : '\(a\)' >/dev/null 2>&1 &&
+   test "X`expr 00001 : '.*\(...\)'`" = X001; then
+  as_expr=expr
 else
-  exitcode=1
-  echo as_func_success failed.
-fi
-
-if as_func_failure; then
-  exitcode=1
-  echo as_func_failure succeeded.
+  as_expr=false
 fi
 
-if as_func_ret_success; then
-  :
+if (basename -- /) >/dev/null 2>&1 && test "X`basename -- / 2>&1`" = "X/"; then
+  as_basename=basename
 else
-  exitcode=1
-  echo as_func_ret_success failed.
-fi
-
-if as_func_ret_failure; then
-  exitcode=1
-  echo as_func_ret_failure succeeded.
+  as_basename=false
 fi
 
-if ( set x; as_func_ret_success y && test x = \"\$1\" ); then
-  :
+if (as_dir=`dirname -- /` && test "X$as_dir" = X/) >/dev/null 2>&1; then
+  as_dirname=dirname
 else
-  exitcode=1
-  echo positional parameters were not saved.
+  as_dirname=false
 fi
 
-test \$exitcode = 0") || {
-  echo No shell found that supports shell functions.
-  echo Please tell bug-autoconf@gnu.org about your system,
-  echo including any error possibly output before this message.
-  echo This can help us improve future autoconf versions.
-  echo Configuration will now proceed without shell functions.
-}
+as_me=`$as_basename -- "$0" ||
+$as_expr X/"$0" : '.*/\([^/][^/]*\)/*$' \| \
+	 X"$0" : 'X\(//\)$' \| \
+	 X"$0" : 'X\(/\)' \| . 2>/dev/null ||
+$as_echo X/"$0" |
+    sed '/^.*\/\([^/][^/]*\)\/*$/{
+	    s//\1/
+	    q
+	  }
+	  /^X\/\(\/\/\)$/{
+	    s//\1/
+	    q
+	  }
+	  /^X\/\(\/\).*/{
+	    s//\1/
+	    q
+	  }
+	  s/.*/./; q'`
 
+# Avoid depending upon Character Ranges.
+as_cr_letters='abcdefghijklmnopqrstuvwxyz'
+as_cr_LETTERS='ABCDEFGHIJKLMNOPQRSTUVWXYZ'
+as_cr_Letters=$as_cr_letters$as_cr_LETTERS
+as_cr_digits='0123456789'
+as_cr_alnum=$as_cr_Letters$as_cr_digits
 
 
-  as_lineno_1=$LINENO
-  as_lineno_2=$LINENO
-  test "x$as_lineno_1" != "x$as_lineno_2" &&
-  test "x`expr $as_lineno_1 + 1`" = "x$as_lineno_2" || {
-
-  # Create $as_me.lineno as a copy of $as_myself, but with $LINENO
-  # uniformly replaced by the line number.  The first 'sed' inserts a
-  # line-number line after each line using $LINENO; the second 'sed'
-  # does the real work.  The second script uses 'N' to pair each
-  # line-number line with the line containing $LINENO, and appends
-  # trailing '-' during substitution so that $LINENO is not a special
-  # case at line end.
-  # (Raja R Harinath suggested sed '=', and Paul Eggert wrote the
-  # scripts with optimization help from Paolo Bonzini.  Blame Lee
-  # E. McMahon (1931-1989) for sed's syntax.  :-)
+  as_lineno_1=$LINENO as_lineno_1a=$LINENO
+  as_lineno_2=$LINENO as_lineno_2a=$LINENO
+  eval 'test "x$as_lineno_1'$as_run'" != "x$as_lineno_2'$as_run'" &&
+  test "x`expr $as_lineno_1'$as_run' + 1`" = "x$as_lineno_2'$as_run'"' || {
+  # Blame Lee E. McMahon (1931-1989) for sed's syntax.  :-)
   sed -n '
     p
     /[$]LINENO/=
@@ -473,9 +494,12 @@ test \$exitcode = 0") || {
       s/-\n.*//
     ' >$as_me.lineno &&
   chmod +x "$as_me.lineno" ||
-    { $as_echo "$as_me: error: cannot create $as_me.lineno; rerun with a POSIX shell" >&2
-   { (exit 1); exit 1; }; }
+    { $as_echo "$as_me: error: cannot create $as_me.lineno; rerun with a POSIX shell" >&2; as_fn_exit 1; }
 
+  # If we had to re-execute with $CONFIG_SHELL, we're ensured to have
+  # already done that, so ensure we don't try to do so again and fall
+  # in an infinite loop.  This has already happened in practice.
+  _as_can_reexec=no; export _as_can_reexec
   # Don't try to exec as it changes $[0], causing all sort of problems
   # (the dirname of $[0] is not the place where we might find the
   # original and so on.  Autoconf is especially sensitive to this).
@@ -484,29 +508,18 @@ test \$exitcode = 0") || {
   exit
 }
 
-
-if (as_dir=`dirname -- /` && test "X$as_dir" = X/) >/dev/null 2>&1; then
-  as_dirname=dirname
-else
-  as_dirname=false
-fi
-
 ECHO_C= ECHO_N= ECHO_T=
-case `echo -n x` in
+case `echo -n x` in #(((((
 -n*)
-  case `echo 'x\c'` in
+  case `echo 'xy\c'` in
   *c*) ECHO_T='	';;	# ECHO_T is single tab character.
-  *)   ECHO_C='\c';;
+  xy)  ECHO_C='\c';;
+  *)   echo `echo ksh88 bug on AIX 6.1` > /dev/null
+       ECHO_T='	';;
   esac;;
 *)
   ECHO_N='-n';;
 esac
-if expr a : '\(a\)' >/dev/null 2>&1 &&
-   test "X`expr 00001 : '.*\(...\)'`" = X001; then
-  as_expr=expr
-else
-  as_expr=false
-fi
 
 rm -f conf$$ conf$$.exe conf$$.file
 if test -d conf$$.dir; then
@@ -521,49 +534,29 @@ if (echo >conf$$.file) 2>/dev/null; then
     # ... but there are two gotchas:
     # 1) On MSYS, both `ln -s file dir' and `ln file dir' fail.
     # 2) DJGPP < 2.04 has no symlinks; `ln -s' creates a wrapper executable.
-    # In both cases, we have to default to `cp -p'.
+    # In both cases, we have to default to `cp -pR'.
     ln -s conf$$.file conf$$.dir 2>/dev/null && test ! -f conf$$.exe ||
-      as_ln_s='cp -p'
+      as_ln_s='cp -pR'
   elif ln conf$$.file conf$$ 2>/dev/null; then
     as_ln_s=ln
   else
-    as_ln_s='cp -p'
+    as_ln_s='cp -pR'
   fi
 else
-  as_ln_s='cp -p'
+  as_ln_s='cp -pR'
 fi
 rm -f conf$$ conf$$.exe conf$$.dir/conf$$.file conf$$.file
 rmdir conf$$.dir 2>/dev/null
 
 if mkdir -p . 2>/dev/null; then
-  as_mkdir_p=:
+  as_mkdir_p='mkdir -p "$as_dir"'
 else
   test -d ./-p && rmdir ./-p
   as_mkdir_p=false
 fi
 
-if test -x / >/dev/null 2>&1; then
-  as_test_x='test -x'
-else
-  if ls -dL / >/dev/null 2>&1; then
-    as_ls_L_option=L
-  else
-    as_ls_L_option=
-  fi
-  as_test_x='
-    eval sh -c '\''
-      if test -d "$1"; then
-	test -d "$1/.";
-      else
-	case $1 in
-	-*)set "./$1";;
-	esac;
-	case `ls -ld'$as_ls_L_option' "$1" 2>/dev/null` in
-	???[sx]*):;;*)false;;esac;fi
-    '\'' sh
-  '
-fi
-as_executable_p=$as_test_x
+as_test_x='test -x'
+as_executable_p=as_fn_executable_p
 
 # Sed expression to map a string onto a valid CPP name.
 as_tr_cpp="eval sed 'y%*$as_cr_letters%P$as_cr_LETTERS%;s%[^_$as_cr_alnum]%_%g'"
@@ -571,161 +564,14 @@ as_tr_cpp="eval sed 'y%*$as_cr_letters%P
 # Sed expression to map a string onto a valid variable name.
 as_tr_sh="eval sed 'y%*+%pp%;s%[^_$as_cr_alnum]%_%g'"
 
-
-
-
-# Check that we are running under the correct shell.
 SHELL=${CONFIG_SHELL-/bin/sh}
 
-case X$lt_ECHO in
-X*--fallback-echo)
-  # Remove one level of quotation (which was required for Make).
-  ECHO=`echo "$lt_ECHO" | sed 's,\\\\\$\\$0,'$0','`
-  ;;
-esac
-
-ECHO=${lt_ECHO-echo}
-if test "X$1" = X--no-reexec; then
-  # Discard the --no-reexec flag, and continue.
-  shift
-elif test "X$1" = X--fallback-echo; then
-  # Avoid inline document here, it may be left over
-  :
-elif test "X`{ $ECHO '\t'; } 2>/dev/null`" = 'X\t' ; then
-  # Yippee, $ECHO works!
-  :
-else
-  # Restart under the correct shell.
-  exec $SHELL "$0" --no-reexec ${1+"$@"}
-fi
-
-if test "X$1" = X--fallback-echo; then
-  # used as fallback echo
-  shift
-  cat <<_LT_EOF
-$*
-_LT_EOF
-  exit 0
-fi
-
-# The HP-UX ksh and POSIX shell print the target directory to stdout
-# if CDPATH is set.
-(unset CDPATH) >/dev/null 2>&1 && unset CDPATH
-
-if test -z "$lt_ECHO"; then
-  if test "X${echo_test_string+set}" != Xset; then
-    # find a string as large as possible, as long as the shell can cope with it
-    for cmd in 'sed 50q "$0"' 'sed 20q "$0"' 'sed 10q "$0"' 'sed 2q "$0"' 'echo test'; do
-      # expected sizes: less than 2Kb, 1Kb, 512 bytes, 16 bytes, ...
-      if { echo_test_string=`eval $cmd`; } 2>/dev/null &&
-	 { test "X$echo_test_string" = "X$echo_test_string"; } 2>/dev/null
-      then
-        break
-      fi
-    done
-  fi
-
-  if test "X`{ $ECHO '\t'; } 2>/dev/null`" = 'X\t' &&
-     echo_testing_string=`{ $ECHO "$echo_test_string"; } 2>/dev/null` &&
-     test "X$echo_testing_string" = "X$echo_test_string"; then
-    :
-  else
-    # The Solaris, AIX, and Digital Unix default echo programs unquote
-    # backslashes.  This makes it impossible to quote backslashes using
-    #   echo "$something" | sed 's/\\/\\\\/g'
-    #
-    # So, first we look for a working echo in the user's PATH.
-
-    lt_save_ifs="$IFS"; IFS=$PATH_SEPARATOR
-    for dir in $PATH /usr/ucb; do
-      IFS="$lt_save_ifs"
-      if (test -f $dir/echo || test -f $dir/echo$ac_exeext) &&
-         test "X`($dir/echo '\t') 2>/dev/null`" = 'X\t' &&
-         echo_testing_string=`($dir/echo "$echo_test_string") 2>/dev/null` &&
-         test "X$echo_testing_string" = "X$echo_test_string"; then
-        ECHO="$dir/echo"
-        break
-      fi
-    done
-    IFS="$lt_save_ifs"
-
-    if test "X$ECHO" = Xecho; then
-      # We didn't find a better echo, so look for alternatives.
-      if test "X`{ print -r '\t'; } 2>/dev/null`" = 'X\t' &&
-         echo_testing_string=`{ print -r "$echo_test_string"; } 2>/dev/null` &&
-         test "X$echo_testing_string" = "X$echo_test_string"; then
-        # This shell has a builtin print -r that does the trick.
-        ECHO='print -r'
-      elif { test -f /bin/ksh || test -f /bin/ksh$ac_exeext; } &&
-	   test "X$CONFIG_SHELL" != X/bin/ksh; then
-        # If we have ksh, try running configure again with it.
-        ORIGINAL_CONFIG_SHELL=${CONFIG_SHELL-/bin/sh}
-        export ORIGINAL_CONFIG_SHELL
-        CONFIG_SHELL=/bin/ksh
-        export CONFIG_SHELL
-        exec $CONFIG_SHELL "$0" --no-reexec ${1+"$@"}
-      else
-        # Try using printf.
-        ECHO='printf %s\n'
-        if test "X`{ $ECHO '\t'; } 2>/dev/null`" = 'X\t' &&
-	   echo_testing_string=`{ $ECHO "$echo_test_string"; } 2>/dev/null` &&
-	   test "X$echo_testing_string" = "X$echo_test_string"; then
-	  # Cool, printf works
-	  :
-        elif echo_testing_string=`($ORIGINAL_CONFIG_SHELL "$0" --fallback-echo '\t') 2>/dev/null` &&
-	     test "X$echo_testing_string" = 'X\t' &&
-	     echo_testing_string=`($ORIGINAL_CONFIG_SHELL "$0" --fallback-echo "$echo_test_string") 2>/dev/null` &&
-	     test "X$echo_testing_string" = "X$echo_test_string"; then
-	  CONFIG_SHELL=$ORIGINAL_CONFIG_SHELL
-	  export CONFIG_SHELL
-	  SHELL="$CONFIG_SHELL"
-	  export SHELL
-	  ECHO="$CONFIG_SHELL $0 --fallback-echo"
-        elif echo_testing_string=`($CONFIG_SHELL "$0" --fallback-echo '\t') 2>/dev/null` &&
-	     test "X$echo_testing_string" = 'X\t' &&
-	     echo_testing_string=`($CONFIG_SHELL "$0" --fallback-echo "$echo_test_string") 2>/dev/null` &&
-	     test "X$echo_testing_string" = "X$echo_test_string"; then
-	  ECHO="$CONFIG_SHELL $0 --fallback-echo"
-        else
-	  # maybe with a smaller string...
-	  prev=:
-
-	  for cmd in 'echo test' 'sed 2q "$0"' 'sed 10q "$0"' 'sed 20q "$0"' 'sed 50q "$0"'; do
-	    if { test "X$echo_test_string" = "X`eval $cmd`"; } 2>/dev/null
-	    then
-	      break
-	    fi
-	    prev="$cmd"
-	  done
-
-	  if test "$prev" != 'sed 50q "$0"'; then
-	    echo_test_string=`eval $prev`
-	    export echo_test_string
-	    exec ${ORIGINAL_CONFIG_SHELL-${CONFIG_SHELL-/bin/sh}} "$0" ${1+"$@"}
-	  else
-	    # Oops.  We lost completely, so just stick with echo.
-	    ECHO=echo
-	  fi
-        fi
-      fi
-    fi
-  fi
-fi
-
-# Copy echo and quote the copy suitably for passing to libtool from
-# the Makefile, instead of quoting the original, which is used later.
-lt_ECHO=$ECHO
-if test "X$lt_ECHO" = "X$CONFIG_SHELL $0 --fallback-echo"; then
-   lt_ECHO="$CONFIG_SHELL \\\$\$0 --fallback-echo"
-fi
-
-
-
 
-exec 7<&0 </dev/null 6>&1
+test -n "$DJDIR" || exec 7<&0 </dev/null
+exec 6>&1
 
 # Name of the host.
-# hostname on some systems (SVR3.2, Linux) returns a bogus exit status,
+# hostname on some systems (SVR3.2, old GNU/Linux) returns a bogus exit status,
 # so uname gets run too.
 ac_hostname=`(hostname || uname -n) 2>/dev/null | sed 1q`
 
@@ -740,14 +586,14 @@ cross_compiling=no
 subdirs=
 MFLAGS=
 MAKEFLAGS=
-SHELL=${CONFIG_SHELL-/bin/sh}
 
 # Identity of this package.
 PACKAGE_NAME='xfsprogs'
 PACKAGE_TARNAME='xfsprogs'
-PACKAGE_VERSION='4.9.0'
-PACKAGE_STRING='xfsprogs 4.9.0'
+PACKAGE_VERSION='4.14.0'
+PACKAGE_STRING='xfsprogs 4.14.0'
 PACKAGE_BUGREPORT='linux-xfs@vger.kernel.org'
+PACKAGE_URL=''
 
 ac_unique_file="include/libxfs.h"
 ac_default_prefix=/usr
@@ -790,16 +636,29 @@ ac_includes_default="\
 ac_subst_vars='LTLIBOBJS
 LIBOBJS
 have_zipped_manpages
+threadsan_ldflags
+threadsan_cflags
+have_threadsan
+addrsan_ldflags
+addrsan_cflags
+have_addrsan
+ubsan_ldflags
+ubsan_cflags
+have_ubsan
 libblkid
+have_statfs_flags
+have_getfsmap
 need_internal_fsxattr
 have_mremap
 have_fsetxattr
 have_readdir
 have_fls
 have_mntent
+have_syncfs
 have_sync_file_range
 have_copy_file_range
 have_preadv
+have_pwritev2
 have_fiemap
 have_fallocate
 have_getmntinfo
@@ -829,7 +688,6 @@ echo
 ECHO
 sed
 awk
-AWK
 makedepend
 zip
 ZIP
@@ -851,6 +709,9 @@ pkg_name
 LOCALIZED_FILES
 root_libdir
 root_sbindir
+enable_threadsan
+enable_addrsan
+enable_ubsan
 enable_librt
 enable_lib64
 libtermcap
@@ -861,6 +722,7 @@ libreadline
 enable_blkid
 enable_gettext
 enable_shared
+BUILD_CFLAGS
 BUILD_CC
 CPP
 OTOOL64
@@ -868,10 +730,13 @@ OTOOL
 LIPO
 NMEDIT
 DSYMUTIL
-lt_ECHO
+MANIFEST_TOOL
+AWK
 RANLIB
 STRIP
+ac_ct_AR
 AR
+DLLTOOL
 OBJDUMP
 LN_S
 NM
@@ -898,6 +763,9 @@ build_vendor
 build_cpu
 build
 LIBTOOL
+INSTALL_DATA
+INSTALL_SCRIPT
+INSTALL_PROGRAM
 target_alias
 host_alias
 build_alias
@@ -928,6 +796,7 @@ bindir
 program_transform_name
 prefix
 exec_prefix
+PACKAGE_URL
 PACKAGE_BUGREPORT
 PACKAGE_STRING
 PACKAGE_VERSION
@@ -943,6 +812,7 @@ enable_static
 with_pic
 enable_fast_install
 with_gnu_ld
+with_sysroot
 enable_libtool_lock
 enable_gettext
 enable_blkid
@@ -951,6 +821,9 @@ enable_editline
 enable_termcap
 enable_lib64
 enable_librt
+enable_ubsan
+enable_addrsan
+enable_threadsan
 '
       ac_precious_vars='build_alias
 host_alias
@@ -960,7 +833,9 @@ CFLAGS
 LDFLAGS
 LIBS
 CPPFLAGS
-CPP'
+CPP
+BUILD_CC
+BUILD_CFLAGS'
 
 
 # Initialize some variables set by options.
@@ -1023,8 +898,9 @@ do
   fi
 
   case $ac_option in
-  *=*)	ac_optarg=`expr "X$ac_option" : '[^=]*=\(.*\)'` ;;
-  *)	ac_optarg=yes ;;
+  *=?*) ac_optarg=`expr "X$ac_option" : '[^=]*=\(.*\)'` ;;
+  *=)   ac_optarg= ;;
+  *)    ac_optarg=yes ;;
   esac
 
   # Accept the important Cygnus configure options, so we can diagnose typos.
@@ -1069,8 +945,7 @@ do
     ac_useropt=`expr "x$ac_option" : 'x-*disable-\(.*\)'`
     # Reject names that are not valid shell variable names.
     expr "x$ac_useropt" : ".*[^-+._$as_cr_alnum]" >/dev/null &&
-      { $as_echo "$as_me: error: invalid feature name: $ac_useropt" >&2
-   { (exit 1); exit 1; }; }
+      as_fn_error $? "invalid feature name: $ac_useropt"
     ac_useropt_orig=$ac_useropt
     ac_useropt=`$as_echo "$ac_useropt" | sed 's/[-+.]/_/g'`
     case $ac_user_opts in
@@ -1096,8 +971,7 @@ do
     ac_useropt=`expr "x$ac_option" : 'x-*enable-\([^=]*\)'`
     # Reject names that are not valid shell variable names.
     expr "x$ac_useropt" : ".*[^-+._$as_cr_alnum]" >/dev/null &&
-      { $as_echo "$as_me: error: invalid feature name: $ac_useropt" >&2
-   { (exit 1); exit 1; }; }
+      as_fn_error $? "invalid feature name: $ac_useropt"
     ac_useropt_orig=$ac_useropt
     ac_useropt=`$as_echo "$ac_useropt" | sed 's/[-+.]/_/g'`
     case $ac_user_opts in
@@ -1301,8 +1175,7 @@ do
     ac_useropt=`expr "x$ac_option" : 'x-*with-\([^=]*\)'`
     # Reject names that are not valid shell variable names.
     expr "x$ac_useropt" : ".*[^-+._$as_cr_alnum]" >/dev/null &&
-      { $as_echo "$as_me: error: invalid package name: $ac_useropt" >&2
-   { (exit 1); exit 1; }; }
+      as_fn_error $? "invalid package name: $ac_useropt"
     ac_useropt_orig=$ac_useropt
     ac_useropt=`$as_echo "$ac_useropt" | sed 's/[-+.]/_/g'`
     case $ac_user_opts in
@@ -1318,8 +1191,7 @@ do
     ac_useropt=`expr "x$ac_option" : 'x-*without-\(.*\)'`
     # Reject names that are not valid shell variable names.
     expr "x$ac_useropt" : ".*[^-+._$as_cr_alnum]" >/dev/null &&
-      { $as_echo "$as_me: error: invalid package name: $ac_useropt" >&2
-   { (exit 1); exit 1; }; }
+      as_fn_error $? "invalid package name: $ac_useropt"
     ac_useropt_orig=$ac_useropt
     ac_useropt=`$as_echo "$ac_useropt" | sed 's/[-+.]/_/g'`
     case $ac_user_opts in
@@ -1349,17 +1221,17 @@ do
   | --x-librar=* | --x-libra=* | --x-libr=* | --x-lib=* | --x-li=* | --x-l=*)
     x_libraries=$ac_optarg ;;
 
-  -*) { $as_echo "$as_me: error: unrecognized option: $ac_option
-Try \`$0 --help' for more information." >&2
-   { (exit 1); exit 1; }; }
+  -*) as_fn_error $? "unrecognized option: \`$ac_option'
+Try \`$0 --help' for more information"
     ;;
 
   *=*)
     ac_envvar=`expr "x$ac_option" : 'x\([^=]*\)='`
     # Reject names that are not valid shell variable names.
-    expr "x$ac_envvar" : ".*[^_$as_cr_alnum]" >/dev/null &&
-      { $as_echo "$as_me: error: invalid variable name: $ac_envvar" >&2
-   { (exit 1); exit 1; }; }
+    case $ac_envvar in #(
+      '' | [0-9]* | *[!_$as_cr_alnum]* )
+      as_fn_error $? "invalid variable name: \`$ac_envvar'" ;;
+    esac
     eval $ac_envvar=\$ac_optarg
     export $ac_envvar ;;
 
@@ -1368,7 +1240,7 @@ Try \`$0 --help' for more information."
     $as_echo "$as_me: WARNING: you should use --build, --host, --target" >&2
     expr "x$ac_option" : ".*[^-._$as_cr_alnum]" >/dev/null &&
       $as_echo "$as_me: WARNING: invalid host type: $ac_option" >&2
-    : ${build_alias=$ac_option} ${host_alias=$ac_option} ${target_alias=$ac_option}
+    : "${build_alias=$ac_option} ${host_alias=$ac_option} ${target_alias=$ac_option}"
     ;;
 
   esac
@@ -1376,15 +1248,13 @@ done
 
 if test -n "$ac_prev"; then
   ac_option=--`echo $ac_prev | sed 's/_/-/g'`
-  { $as_echo "$as_me: error: missing argument to $ac_option" >&2
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "missing argument to $ac_option"
 fi
 
 if test -n "$ac_unrecognized_opts"; then
   case $enable_option_checking in
     no) ;;
-    fatal) { $as_echo "$as_me: error: unrecognized options: $ac_unrecognized_opts" >&2
-   { (exit 1); exit 1; }; } ;;
+    fatal) as_fn_error $? "unrecognized options: $ac_unrecognized_opts" ;;
     *)     $as_echo "$as_me: WARNING: unrecognized options: $ac_unrecognized_opts" >&2 ;;
   esac
 fi
@@ -1407,8 +1277,7 @@ do
     [\\/$]* | ?:[\\/]* )  continue;;
     NONE | '' ) case $ac_var in *prefix ) continue;; esac;;
   esac
-  { $as_echo "$as_me: error: expected an absolute directory name for --$ac_var: $ac_val" >&2
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "expected an absolute directory name for --$ac_var: $ac_val"
 done
 
 # There might be people who depend on the old broken behavior: `$host'
@@ -1422,8 +1291,6 @@ target=$target_alias
 if test "x$host_alias" != x; then
   if test "x$build_alias" = x; then
     cross_compiling=maybe
-    $as_echo "$as_me: WARNING: If you wanted to set the --build type, don't use --host.
-    If a cross compiler is detected then cross compile mode will be used." >&2
   elif test "x$build_alias" != "x$host_alias"; then
     cross_compiling=yes
   fi
@@ -1438,11 +1305,9 @@ test "$silent" = yes && exec 6>/dev/null
 ac_pwd=`pwd` && test -n "$ac_pwd" &&
 ac_ls_di=`ls -di .` &&
 ac_pwd_ls_di=`cd "$ac_pwd" && ls -di .` ||
-  { $as_echo "$as_me: error: working directory cannot be determined" >&2
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "working directory cannot be determined"
 test "X$ac_ls_di" = "X$ac_pwd_ls_di" ||
-  { $as_echo "$as_me: error: pwd does not report name of working directory" >&2
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "pwd does not report name of working directory"
 
 
 # Find the source files, if location was not specified.
@@ -1481,13 +1346,11 @@ else
 fi
 if test ! -r "$srcdir/$ac_unique_file"; then
   test "$ac_srcdir_defaulted" = yes && srcdir="$ac_confdir or .."
-  { $as_echo "$as_me: error: cannot find sources ($ac_unique_file) in $srcdir" >&2
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "cannot find sources ($ac_unique_file) in $srcdir"
 fi
 ac_msg="sources are in $srcdir, but \`cd $srcdir' does not work"
 ac_abs_confdir=`(
-	cd "$srcdir" && test -r "./$ac_unique_file" || { $as_echo "$as_me: error: $ac_msg" >&2
-   { (exit 1); exit 1; }; }
+	cd "$srcdir" && test -r "./$ac_unique_file" || as_fn_error $? "$ac_msg"
 	pwd)`
 # When building in place, set srcdir=.
 if test "$ac_abs_confdir" = "$ac_pwd"; then
@@ -1513,7 +1376,7 @@ if test "$ac_init_help" = "long"; then
   # Omit some internal or obsolete options to make the list less imposing.
   # This message is too long to be a string in the A/UX 3.1 sh.
   cat <<_ACEOF
-\`configure' configures xfsprogs 4.9.0 to adapt to many kinds of systems.
+\`configure' configures xfsprogs 4.14.0 to adapt to many kinds of systems.
 
 Usage: $0 [OPTION]... [VAR=VALUE]...
 
@@ -1527,7 +1390,7 @@ Configuration:
       --help=short        display options specific to this package
       --help=recursive    display the short help of all the included packages
   -V, --version           display version information and exit
-  -q, --quiet, --silent   do not print \`checking...' messages
+  -q, --quiet, --silent   do not print \`checking ...' messages
       --cache-file=FILE   cache test results in FILE [disabled]
   -C, --config-cache      alias for \`--cache-file=config.cache'
   -n, --no-create         do not create output files
@@ -1578,7 +1441,7 @@ fi
 
 if test -n "$ac_init_help"; then
   case $ac_init_help in
-     short | recursive ) echo "Configuration of xfsprogs 4.9.0:";;
+     short | recursive ) echo "Configuration of xfsprogs 4.14.0:";;
    esac
   cat <<\_ACEOF
 
@@ -1599,13 +1462,18 @@ Optional Features:
  --enable-termcap=yes/no Enable terminal capabilities library default=no
  --enable-lib64=yes/no Enable lib64 support default=yes
  --enable-librt=yes/no Enable librt support default=yes
+ --enable-ubsan=yes/no Enable Undefined Behavior Sanitizer (UBSAN) default=no
+ --enable-addrsan=yes/no Enable Address Sanitizer (ADDRSAN) default=no
+ --enable-threadsan=yes/no Enable Thread Sanitizer (THREADSAN) default=no
 
 Optional Packages:
   --with-PACKAGE[=ARG]    use PACKAGE [ARG=yes]
   --without-PACKAGE       do not use PACKAGE (same as --with-PACKAGE=no)
-  --with-pic              try to use only PIC/non-PIC objects [default=use
+  --with-pic[=PKGS]       try to use only PIC/non-PIC objects [default=use
                           both]
   --with-gnu-ld           assume the C compiler uses GNU ld [default=no]
+  --with-sysroot=DIR Search for dependent libraries within DIR
+                        (or the compiler's sysroot if not specified).
 
 Some influential environment variables:
   CC          C compiler command
@@ -1613,9 +1481,12 @@ Some influential environment variables:
   LDFLAGS     linker flags, e.g. -L<lib dir> if you have libraries in a
               nonstandard directory <lib dir>
   LIBS        libraries to pass to the linker, e.g. -l<library>
-  CPPFLAGS    C/C++/Objective C preprocessor flags, e.g. -I<include dir> if
+  CPPFLAGS    (Objective) C/C++ preprocessor flags, e.g. -I<include dir> if
               you have headers in a nonstandard directory <include dir>
   CPP         C preprocessor
+  BUILD_CC    C compiler for build tools
+  BUILD_CFLAGS
+              C compiler flags for build tools
 
 Use these variables to override the choices made by `configure' or to help
 it to find libraries and programs with nonstandard names/locations.
@@ -1683,2305 +1554,1208 @@ fi
 test -n "$ac_init_help" && exit $ac_status
 if $ac_init_version; then
   cat <<\_ACEOF
-xfsprogs configure 4.9.0
-generated by GNU Autoconf 2.63
+xfsprogs configure 4.14.0
+generated by GNU Autoconf 2.69
 
-Copyright (C) 1992, 1993, 1994, 1995, 1996, 1998, 1999, 2000, 2001,
-2002, 2003, 2004, 2005, 2006, 2007, 2008 Free Software Foundation, Inc.
+Copyright (C) 2012 Free Software Foundation, Inc.
 This configure script is free software; the Free Software Foundation
 gives unlimited permission to copy, distribute and modify it.
 _ACEOF
   exit
 fi
-cat >config.log <<_ACEOF
-This file contains any messages produced by compilers while
-running configure, to aid debugging if configure makes a mistake.
 
-It was created by xfsprogs $as_me 4.9.0, which was
-generated by GNU Autoconf 2.63.  Invocation command line was
+## ------------------------ ##
+## Autoconf initialization. ##
+## ------------------------ ##
+
+# ac_fn_c_try_compile LINENO
+# --------------------------
+# Try to compile conftest.$ac_ext, and return whether this succeeded.
+ac_fn_c_try_compile ()
+{
+  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+  rm -f conftest.$ac_objext
+  if { { ac_try="$ac_compile"
+case "(($ac_try" in
+  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_compile") 2>conftest.err
+  ac_status=$?
+  if test -s conftest.err; then
+    grep -v '^ *+' conftest.err >conftest.er1
+    cat conftest.er1 >&5
+    mv -f conftest.er1 conftest.err
+  fi
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; } && {
+	 test -z "$ac_c_werror_flag" ||
+	 test ! -s conftest.err
+       } && test -s conftest.$ac_objext; then :
+  ac_retval=0
+else
+  $as_echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
+
+	ac_retval=1
+fi
+  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
+  as_fn_set_status $ac_retval
 
-  $ $0 $@
+} # ac_fn_c_try_compile
 
-_ACEOF
-exec 5>>config.log
+# ac_fn_c_try_link LINENO
+# -----------------------
+# Try to link conftest.$ac_ext, and return whether this succeeded.
+ac_fn_c_try_link ()
 {
-cat <<_ASUNAME
-## --------- ##
-## Platform. ##
-## --------- ##
+  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+  rm -f conftest.$ac_objext conftest$ac_exeext
+  if { { ac_try="$ac_link"
+case "(($ac_try" in
+  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_link") 2>conftest.err
+  ac_status=$?
+  if test -s conftest.err; then
+    grep -v '^ *+' conftest.err >conftest.er1
+    cat conftest.er1 >&5
+    mv -f conftest.er1 conftest.err
+  fi
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; } && {
+	 test -z "$ac_c_werror_flag" ||
+	 test ! -s conftest.err
+       } && test -s conftest$ac_exeext && {
+	 test "$cross_compiling" = yes ||
+	 test -x conftest$ac_exeext
+       }; then :
+  ac_retval=0
+else
+  $as_echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
 
-hostname = `(hostname || uname -n) 2>/dev/null | sed 1q`
-uname -m = `(uname -m) 2>/dev/null || echo unknown`
-uname -r = `(uname -r) 2>/dev/null || echo unknown`
-uname -s = `(uname -s) 2>/dev/null || echo unknown`
-uname -v = `(uname -v) 2>/dev/null || echo unknown`
+	ac_retval=1
+fi
+  # Delete the IPA/IPO (Inter Procedural Analysis/Optimization) information
+  # created by the PGI compiler (conftest_ipa8_conftest.oo), as it would
+  # interfere with the next link command; also delete a directory that is
+  # left behind by Apple's compiler.  We do this before executing the actions.
+  rm -rf conftest.dSYM conftest_ipa8_conftest.oo
+  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
+  as_fn_set_status $ac_retval
 
-/usr/bin/uname -p = `(/usr/bin/uname -p) 2>/dev/null || echo unknown`
-/bin/uname -X     = `(/bin/uname -X) 2>/dev/null     || echo unknown`
+} # ac_fn_c_try_link
 
-/bin/arch              = `(/bin/arch) 2>/dev/null              || echo unknown`
-/usr/bin/arch -k       = `(/usr/bin/arch -k) 2>/dev/null       || echo unknown`
-/usr/convex/getsysinfo = `(/usr/convex/getsysinfo) 2>/dev/null || echo unknown`
-/usr/bin/hostinfo      = `(/usr/bin/hostinfo) 2>/dev/null      || echo unknown`
-/bin/machine           = `(/bin/machine) 2>/dev/null           || echo unknown`
-/usr/bin/oslevel       = `(/usr/bin/oslevel) 2>/dev/null       || echo unknown`
-/bin/universe          = `(/bin/universe) 2>/dev/null          || echo unknown`
+# ac_fn_c_check_header_compile LINENO HEADER VAR INCLUDES
+# -------------------------------------------------------
+# Tests whether HEADER exists and can be compiled using the include files in
+# INCLUDES, setting the cache variable VAR accordingly.
+ac_fn_c_check_header_compile ()
+{
+  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $2" >&5
+$as_echo_n "checking for $2... " >&6; }
+if eval \${$3+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+$4
+#include <$2>
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  eval "$3=yes"
+else
+  eval "$3=no"
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+fi
+eval ac_res=\$$3
+	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
+$as_echo "$ac_res" >&6; }
+  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
 
-_ASUNAME
+} # ac_fn_c_check_header_compile
 
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-  $as_echo "PATH: $as_dir"
-done
-IFS=$as_save_IFS
+# ac_fn_c_try_cpp LINENO
+# ----------------------
+# Try to preprocess conftest.$ac_ext, and return whether this succeeded.
+ac_fn_c_try_cpp ()
+{
+  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+  if { { ac_try="$ac_cpp conftest.$ac_ext"
+case "(($ac_try" in
+  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_cpp conftest.$ac_ext") 2>conftest.err
+  ac_status=$?
+  if test -s conftest.err; then
+    grep -v '^ *+' conftest.err >conftest.er1
+    cat conftest.er1 >&5
+    mv -f conftest.er1 conftest.err
+  fi
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; } > conftest.i && {
+	 test -z "$ac_c_preproc_warn_flag$ac_c_werror_flag" ||
+	 test ! -s conftest.err
+       }; then :
+  ac_retval=0
+else
+  $as_echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
 
-} >&5
+    ac_retval=1
+fi
+  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
+  as_fn_set_status $ac_retval
 
-cat >&5 <<_ACEOF
+} # ac_fn_c_try_cpp
 
+# ac_fn_c_try_run LINENO
+# ----------------------
+# Try to link conftest.$ac_ext, and return whether this succeeded. Assumes
+# that executables *can* be run.
+ac_fn_c_try_run ()
+{
+  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+  if { { ac_try="$ac_link"
+case "(($ac_try" in
+  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_link") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; } && { ac_try='./conftest$ac_exeext'
+  { { case "(($ac_try" in
+  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_try") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; }; then :
+  ac_retval=0
+else
+  $as_echo "$as_me: program exited with status $ac_status" >&5
+       $as_echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
 
-## ----------- ##
-## Core tests. ##
-## ----------- ##
+       ac_retval=$ac_status
+fi
+  rm -rf conftest.dSYM conftest_ipa8_conftest.oo
+  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
+  as_fn_set_status $ac_retval
 
-_ACEOF
+} # ac_fn_c_try_run
 
+# ac_fn_c_check_func LINENO FUNC VAR
+# ----------------------------------
+# Tests whether FUNC exists, setting the cache variable VAR accordingly
+ac_fn_c_check_func ()
+{
+  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $2" >&5
+$as_echo_n "checking for $2... " >&6; }
+if eval \${$3+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+/* Define $2 to an innocuous variant, in case <limits.h> declares $2.
+   For example, HP-UX 11i <limits.h> declares gettimeofday.  */
+#define $2 innocuous_$2
 
-# Keep a trace of the command line.
-# Strip out --no-create and --no-recursion so they do not pile up.
-# Strip out --silent because we don't want to record it for future runs.
-# Also quote any args containing shell meta-characters.
-# Make two passes to allow for proper duplicate-argument suppression.
-ac_configure_args=
-ac_configure_args0=
-ac_configure_args1=
-ac_must_keep_next=false
-for ac_pass in 1 2
-do
-  for ac_arg
-  do
-    case $ac_arg in
-    -no-create | --no-c* | -n | -no-recursion | --no-r*) continue ;;
-    -q | -quiet | --quiet | --quie | --qui | --qu | --q \
-    | -silent | --silent | --silen | --sile | --sil)
-      continue ;;
-    *\'*)
-      ac_arg=`$as_echo "$ac_arg" | sed "s/'/'\\\\\\\\''/g"` ;;
-    esac
-    case $ac_pass in
-    1) ac_configure_args0="$ac_configure_args0 '$ac_arg'" ;;
-    2)
-      ac_configure_args1="$ac_configure_args1 '$ac_arg'"
-      if test $ac_must_keep_next = true; then
-	ac_must_keep_next=false # Got value, back to normal.
-      else
-	case $ac_arg in
-	  *=* | --config-cache | -C | -disable-* | --disable-* \
-	  | -enable-* | --enable-* | -gas | --g* | -nfp | --nf* \
-	  | -q | -quiet | --q* | -silent | --sil* | -v | -verb* \
-	  | -with-* | --with-* | -without-* | --without-* | --x)
-	    case "$ac_configure_args0 " in
-	      "$ac_configure_args1"*" '$ac_arg' "* ) continue ;;
-	    esac
-	    ;;
-	  -* ) ac_must_keep_next=true ;;
-	esac
-      fi
-      ac_configure_args="$ac_configure_args '$ac_arg'"
-      ;;
-    esac
-  done
-done
-$as_unset ac_configure_args0 || test "${ac_configure_args0+set}" != set || { ac_configure_args0=; export ac_configure_args0; }
-$as_unset ac_configure_args1 || test "${ac_configure_args1+set}" != set || { ac_configure_args1=; export ac_configure_args1; }
+/* System header to define __stub macros and hopefully few prototypes,
+    which can conflict with char $2 (); below.
+    Prefer <limits.h> to <assert.h> if __STDC__ is defined, since
+    <limits.h> exists even on freestanding compilers.  */
 
-# When interrupted or exit'd, cleanup temporary files, and complete
-# config.log.  We remove comments because anyway the quotes in there
-# would cause problems or look ugly.
-# WARNING: Use '\'' to represent an apostrophe within the trap.
-# WARNING: Do not start the trap code with a newline, due to a FreeBSD 4.0 bug.
-trap 'exit_status=$?
-  # Save into config.log some information that might help in debugging.
-  {
-    echo
+#ifdef __STDC__
+# include <limits.h>
+#else
+# include <assert.h>
+#endif
 
-    cat <<\_ASBOX
-## ---------------- ##
-## Cache variables. ##
-## ---------------- ##
-_ASBOX
-    echo
-    # The following way of writing the cache mishandles newlines in values,
-(
-  for ac_var in `(set) 2>&1 | sed -n '\''s/^\([a-zA-Z_][a-zA-Z0-9_]*\)=.*/\1/p'\''`; do
-    eval ac_val=\$$ac_var
-    case $ac_val in #(
-    *${as_nl}*)
-      case $ac_var in #(
-      *_cv_*) { $as_echo "$as_me:$LINENO: WARNING: cache variable $ac_var contains a newline" >&5
-$as_echo "$as_me: WARNING: cache variable $ac_var contains a newline" >&2;} ;;
-      esac
-      case $ac_var in #(
-      _ | IFS | as_nl) ;; #(
-      BASH_ARGV | BASH_SOURCE) eval $ac_var= ;; #(
-      *) $as_unset $ac_var ;;
-      esac ;;
-    esac
-  done
-  (set) 2>&1 |
-    case $as_nl`(ac_space='\'' '\''; set) 2>&1` in #(
-    *${as_nl}ac_space=\ *)
-      sed -n \
-	"s/'\''/'\''\\\\'\'''\''/g;
-	  s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1='\''\\2'\''/p"
-      ;; #(
-    *)
-      sed -n "/^[_$as_cr_alnum]*_cv_[_$as_cr_alnum]*=/p"
-      ;;
-    esac |
-    sort
-)
-    echo
-
-    cat <<\_ASBOX
-## ----------------- ##
-## Output variables. ##
-## ----------------- ##
-_ASBOX
-    echo
-    for ac_var in $ac_subst_vars
-    do
-      eval ac_val=\$$ac_var
-      case $ac_val in
-      *\'\''*) ac_val=`$as_echo "$ac_val" | sed "s/'\''/'\''\\\\\\\\'\'''\''/g"`;;
-      esac
-      $as_echo "$ac_var='\''$ac_val'\''"
-    done | sort
-    echo
-
-    if test -n "$ac_subst_files"; then
-      cat <<\_ASBOX
-## ------------------- ##
-## File substitutions. ##
-## ------------------- ##
-_ASBOX
-      echo
-      for ac_var in $ac_subst_files
-      do
-	eval ac_val=\$$ac_var
-	case $ac_val in
-	*\'\''*) ac_val=`$as_echo "$ac_val" | sed "s/'\''/'\''\\\\\\\\'\'''\''/g"`;;
-	esac
-	$as_echo "$ac_var='\''$ac_val'\''"
-      done | sort
-      echo
-    fi
-
-    if test -s confdefs.h; then
-      cat <<\_ASBOX
-## ----------- ##
-## confdefs.h. ##
-## ----------- ##
-_ASBOX
-      echo
-      cat confdefs.h
-      echo
-    fi
-    test "$ac_signal" != 0 &&
-      $as_echo "$as_me: caught signal $ac_signal"
-    $as_echo "$as_me: exit $exit_status"
-  } >&5
-  rm -f core *.core core.conftest.* &&
-    rm -f -r conftest* confdefs* conf$$* $ac_clean_files &&
-    exit $exit_status
-' 0
-for ac_signal in 1 2 13 15; do
-  trap 'ac_signal='$ac_signal'; { (exit 1); exit 1; }' $ac_signal
-done
-ac_signal=0
-
-# confdefs.h avoids OS command line length limits that DEFS can exceed.
-rm -f -r conftest* confdefs.h
+#undef $2
 
-# Predefined preprocessor variables.
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+char $2 ();
+/* The GNU C library defines this for functions which it implements
+    to always fail with ENOSYS.  Some functions are actually named
+    something starting with __ and the normal name is an alias.  */
+#if defined __stub_$2 || defined __stub___$2
+choke me
+#endif
 
-cat >>confdefs.h <<_ACEOF
-#define PACKAGE_NAME "$PACKAGE_NAME"
+int
+main ()
+{
+return $2 ();
+  ;
+  return 0;
+}
 _ACEOF
+if ac_fn_c_try_link "$LINENO"; then :
+  eval "$3=yes"
+else
+  eval "$3=no"
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+fi
+eval ac_res=\$$3
+	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
+$as_echo "$ac_res" >&6; }
+  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
 
+} # ac_fn_c_check_func
 
-cat >>confdefs.h <<_ACEOF
-#define PACKAGE_TARNAME "$PACKAGE_TARNAME"
+# ac_fn_c_check_header_mongrel LINENO HEADER VAR INCLUDES
+# -------------------------------------------------------
+# Tests whether HEADER exists, giving a warning if it cannot be compiled using
+# the include files in INCLUDES and setting the cache variable VAR
+# accordingly.
+ac_fn_c_check_header_mongrel ()
+{
+  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+  if eval \${$3+:} false; then :
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $2" >&5
+$as_echo_n "checking for $2... " >&6; }
+if eval \${$3+:} false; then :
+  $as_echo_n "(cached) " >&6
+fi
+eval ac_res=\$$3
+	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
+$as_echo "$ac_res" >&6; }
+else
+  # Is the header compilable?
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking $2 usability" >&5
+$as_echo_n "checking $2 usability... " >&6; }
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+$4
+#include <$2>
 _ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ac_header_compiler=yes
+else
+  ac_header_compiler=no
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_header_compiler" >&5
+$as_echo "$ac_header_compiler" >&6; }
 
-
-cat >>confdefs.h <<_ACEOF
-#define PACKAGE_VERSION "$PACKAGE_VERSION"
+# Is the header present?
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking $2 presence" >&5
+$as_echo_n "checking $2 presence... " >&6; }
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <$2>
 _ACEOF
+if ac_fn_c_try_cpp "$LINENO"; then :
+  ac_header_preproc=yes
+else
+  ac_header_preproc=no
+fi
+rm -f conftest.err conftest.i conftest.$ac_ext
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_header_preproc" >&5
+$as_echo "$ac_header_preproc" >&6; }
 
+# So?  What about this header?
+case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in #((
+  yes:no: )
+    { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: $2: accepted by the compiler, rejected by the preprocessor!" >&5
+$as_echo "$as_me: WARNING: $2: accepted by the compiler, rejected by the preprocessor!" >&2;}
+    { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: $2: proceeding with the compiler's result" >&5
+$as_echo "$as_me: WARNING: $2: proceeding with the compiler's result" >&2;}
+    ;;
+  no:yes:* )
+    { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: $2: present but cannot be compiled" >&5
+$as_echo "$as_me: WARNING: $2: present but cannot be compiled" >&2;}
+    { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: $2:     check for missing prerequisite headers?" >&5
+$as_echo "$as_me: WARNING: $2:     check for missing prerequisite headers?" >&2;}
+    { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: $2: see the Autoconf documentation" >&5
+$as_echo "$as_me: WARNING: $2: see the Autoconf documentation" >&2;}
+    { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: $2:     section \"Present But Cannot Be Compiled\"" >&5
+$as_echo "$as_me: WARNING: $2:     section \"Present But Cannot Be Compiled\"" >&2;}
+    { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: $2: proceeding with the compiler's result" >&5
+$as_echo "$as_me: WARNING: $2: proceeding with the compiler's result" >&2;}
+( $as_echo "## ---------------------------------------- ##
+## Report this to linux-xfs@vger.kernel.org ##
+## ---------------------------------------- ##"
+     ) | sed "s/^/$as_me: WARNING:     /" >&2
+    ;;
+esac
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $2" >&5
+$as_echo_n "checking for $2... " >&6; }
+if eval \${$3+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  eval "$3=\$ac_header_compiler"
+fi
+eval ac_res=\$$3
+	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
+$as_echo "$ac_res" >&6; }
+fi
+  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
 
-cat >>confdefs.h <<_ACEOF
-#define PACKAGE_STRING "$PACKAGE_STRING"
-_ACEOF
+} # ac_fn_c_check_header_mongrel
 
+# ac_fn_c_check_decl LINENO SYMBOL VAR INCLUDES
+# ---------------------------------------------
+# Tests whether SYMBOL is declared in INCLUDES, setting cache variable VAR
+# accordingly.
+ac_fn_c_check_decl ()
+{
+  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+  as_decl_name=`echo $2|sed 's/ *(.*//'`
+  as_decl_use=`echo $2|sed -e 's/(/((/' -e 's/)/) 0&/' -e 's/,/) 0& (/g'`
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether $as_decl_name is declared" >&5
+$as_echo_n "checking whether $as_decl_name is declared... " >&6; }
+if eval \${$3+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+$4
+int
+main ()
+{
+#ifndef $as_decl_name
+#ifdef __cplusplus
+  (void) $as_decl_use;
+#else
+  (void) $as_decl_name;
+#endif
+#endif
 
-cat >>confdefs.h <<_ACEOF
-#define PACKAGE_BUGREPORT "$PACKAGE_BUGREPORT"
+  ;
+  return 0;
+}
 _ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  eval "$3=yes"
+else
+  eval "$3=no"
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+fi
+eval ac_res=\$$3
+	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
+$as_echo "$ac_res" >&6; }
+  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
 
+} # ac_fn_c_check_decl
 
-# Let the site file select an alternate cache file if it wants to.
-# Prefer an explicitly selected file to automatically selected ones.
-ac_site_file1=NONE
-ac_site_file2=NONE
-if test -n "$CONFIG_SITE"; then
-  ac_site_file1=$CONFIG_SITE
-elif test "x$prefix" != xNONE; then
-  ac_site_file1=$prefix/share/config.site
-  ac_site_file2=$prefix/etc/config.site
+# ac_fn_c_check_type LINENO TYPE VAR INCLUDES
+# -------------------------------------------
+# Tests whether TYPE exists after having included INCLUDES, setting cache
+# variable VAR accordingly.
+ac_fn_c_check_type ()
+{
+  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $2" >&5
+$as_echo_n "checking for $2... " >&6; }
+if eval \${$3+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
-  ac_site_file1=$ac_default_prefix/share/config.site
-  ac_site_file2=$ac_default_prefix/etc/config.site
-fi
-for ac_site_file in "$ac_site_file1" "$ac_site_file2"
-do
-  test "x$ac_site_file" = xNONE && continue
-  if test -r "$ac_site_file"; then
-    { $as_echo "$as_me:$LINENO: loading site script $ac_site_file" >&5
-$as_echo "$as_me: loading site script $ac_site_file" >&6;}
-    sed 's/^/| /' "$ac_site_file" >&5
-    . "$ac_site_file"
-  fi
-done
+  eval "$3=no"
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+$4
+int
+main ()
+{
+if (sizeof ($2))
+	 return 0;
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+$4
+int
+main ()
+{
+if (sizeof (($2)))
+	    return 0;
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
 
-if test -r "$cache_file"; then
-  # Some versions of bash will fail to source /dev/null (special
-  # files actually), so we avoid doing that.
-  if test -f "$cache_file"; then
-    { $as_echo "$as_me:$LINENO: loading cache $cache_file" >&5
-$as_echo "$as_me: loading cache $cache_file" >&6;}
-    case $cache_file in
-      [\\/]* | ?:[\\/]* ) . "$cache_file";;
-      *)                      . "./$cache_file";;
-    esac
-  fi
 else
-  { $as_echo "$as_me:$LINENO: creating cache $cache_file" >&5
-$as_echo "$as_me: creating cache $cache_file" >&6;}
-  >$cache_file
+  eval "$3=yes"
 fi
-
-# Check that the precious variables saved in the cache have kept the same
-# value.
-ac_cache_corrupted=false
-for ac_var in $ac_precious_vars; do
-  eval ac_old_set=\$ac_cv_env_${ac_var}_set
-  eval ac_new_set=\$ac_env_${ac_var}_set
-  eval ac_old_val=\$ac_cv_env_${ac_var}_value
-  eval ac_new_val=\$ac_env_${ac_var}_value
-  case $ac_old_set,$ac_new_set in
-    set,)
-      { $as_echo "$as_me:$LINENO: error: \`$ac_var' was set to \`$ac_old_val' in the previous run" >&5
-$as_echo "$as_me: error: \`$ac_var' was set to \`$ac_old_val' in the previous run" >&2;}
-      ac_cache_corrupted=: ;;
-    ,set)
-      { $as_echo "$as_me:$LINENO: error: \`$ac_var' was not set in the previous run" >&5
-$as_echo "$as_me: error: \`$ac_var' was not set in the previous run" >&2;}
-      ac_cache_corrupted=: ;;
-    ,);;
-    *)
-      if test "x$ac_old_val" != "x$ac_new_val"; then
-	# differences in whitespace do not lead to failure.
-	ac_old_val_w=`echo x $ac_old_val`
-	ac_new_val_w=`echo x $ac_new_val`
-	if test "$ac_old_val_w" != "$ac_new_val_w"; then
-	  { $as_echo "$as_me:$LINENO: error: \`$ac_var' has changed since the previous run:" >&5
-$as_echo "$as_me: error: \`$ac_var' has changed since the previous run:" >&2;}
-	  ac_cache_corrupted=:
-	else
-	  { $as_echo "$as_me:$LINENO: warning: ignoring whitespace changes in \`$ac_var' since the previous run:" >&5
-$as_echo "$as_me: warning: ignoring whitespace changes in \`$ac_var' since the previous run:" >&2;}
-	  eval $ac_var=\$ac_old_val
-	fi
-	{ $as_echo "$as_me:$LINENO:   former value:  \`$ac_old_val'" >&5
-$as_echo "$as_me:   former value:  \`$ac_old_val'" >&2;}
-	{ $as_echo "$as_me:$LINENO:   current value: \`$ac_new_val'" >&5
-$as_echo "$as_me:   current value: \`$ac_new_val'" >&2;}
-      fi;;
-  esac
-  # Pass precious variables to config.status.
-  if test "$ac_new_set" = set; then
-    case $ac_new_val in
-    *\'*) ac_arg=$ac_var=`$as_echo "$ac_new_val" | sed "s/'/'\\\\\\\\''/g"` ;;
-    *) ac_arg=$ac_var=$ac_new_val ;;
-    esac
-    case " $ac_configure_args " in
-      *" '$ac_arg' "*) ;; # Avoid dups.  Use of quotes ensures accuracy.
-      *) ac_configure_args="$ac_configure_args '$ac_arg'" ;;
-    esac
-  fi
-done
-if $ac_cache_corrupted; then
-  { $as_echo "$as_me:$LINENO: error: in \`$ac_pwd':" >&5
-$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-  { $as_echo "$as_me:$LINENO: error: changes in the environment can compromise the build" >&5
-$as_echo "$as_me: error: changes in the environment can compromise the build" >&2;}
-  { { $as_echo "$as_me:$LINENO: error: run \`make distclean' and/or \`rm $cache_file' and start over" >&5
-$as_echo "$as_me: error: run \`make distclean' and/or \`rm $cache_file' and start over" >&2;}
-   { (exit 1); exit 1; }; }
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+fi
+eval ac_res=\$$3
+	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
+$as_echo "$ac_res" >&6; }
+  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
 
+} # ac_fn_c_check_type
 
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-ac_ext=c
-ac_cpp='$CPP $CPPFLAGS'
-ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
-ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
-ac_compiler_gnu=$ac_cv_c_compiler_gnu
-
-
-
-ac_aux_dir=
-for ac_dir in . "$srcdir"/.; do
-  if test -f "$ac_dir/install-sh"; then
-    ac_aux_dir=$ac_dir
-    ac_install_sh="$ac_aux_dir/install-sh -c"
-    break
-  elif test -f "$ac_dir/install.sh"; then
-    ac_aux_dir=$ac_dir
-    ac_install_sh="$ac_aux_dir/install.sh -c"
-    break
-  elif test -f "$ac_dir/shtool"; then
-    ac_aux_dir=$ac_dir
-    ac_install_sh="$ac_aux_dir/shtool install -c"
-    break
-  fi
-done
-if test -z "$ac_aux_dir"; then
-  { { $as_echo "$as_me:$LINENO: error: cannot find install-sh or install.sh in . \"$srcdir\"/." >&5
-$as_echo "$as_me: error: cannot find install-sh or install.sh in . \"$srcdir\"/." >&2;}
-   { (exit 1); exit 1; }; }
+# ac_fn_c_check_member LINENO AGGR MEMBER VAR INCLUDES
+# ----------------------------------------------------
+# Tries to find if the field MEMBER exists in type AGGR, after including
+# INCLUDES, setting cache variable VAR accordingly.
+ac_fn_c_check_member ()
+{
+  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $2.$3" >&5
+$as_echo_n "checking for $2.$3... " >&6; }
+if eval \${$4+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+$5
+int
+main ()
+{
+static $2 ac_aggr;
+if (ac_aggr.$3)
+return 0;
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  eval "$4=yes"
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+$5
+int
+main ()
+{
+static $2 ac_aggr;
+if (sizeof ac_aggr.$3)
+return 0;
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  eval "$4=yes"
+else
+  eval "$4=no"
 fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+fi
+eval ac_res=\$$4
+	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
+$as_echo "$ac_res" >&6; }
+  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
 
-# These three variables are undocumented and unsupported,
-# and are intended to be withdrawn in a future Autoconf release.
-# They can cause serious problems if a builder's source tree is in a directory
-# whose full name contains unusual characters.
-ac_config_guess="$SHELL $ac_aux_dir/config.guess"  # Please don't use this var.
-ac_config_sub="$SHELL $ac_aux_dir/config.sub"  # Please don't use this var.
-ac_configure="$SHELL $ac_aux_dir/configure"  # Please don't use this var.
-
+} # ac_fn_c_check_member
 
+# ac_fn_c_compute_int LINENO EXPR VAR INCLUDES
+# --------------------------------------------
+# Tries to find the compile-time value of EXPR in a program that includes
+# INCLUDES, setting VAR accordingly. Returns whether the value could be
+# computed
+ac_fn_c_compute_int ()
+{
+  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+  if test "$cross_compiling" = yes; then
+    # Depending upon the size, compute the lo and hi bounds.
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+$4
+int
+main ()
+{
+static int test_array [1 - 2 * !(($2) >= 0)];
+test_array [0] = 0;
+return test_array [0];
 
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ac_lo=0 ac_mid=0
+  while :; do
+    cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+$4
+int
+main ()
+{
+static int test_array [1 - 2 * !(($2) <= $ac_mid)];
+test_array [0] = 0;
+return test_array [0];
 
-ac_config_headers="$ac_config_headers include/platform_defs.h"
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ac_hi=$ac_mid; break
+else
+  as_fn_arith $ac_mid + 1 && ac_lo=$as_val
+			if test $ac_lo -le $ac_mid; then
+			  ac_lo= ac_hi=
+			  break
+			fi
+			as_fn_arith 2 '*' $ac_mid + 1 && ac_mid=$as_val
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+  done
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+$4
+int
+main ()
+{
+static int test_array [1 - 2 * !(($2) < 0)];
+test_array [0] = 0;
+return test_array [0];
 
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ac_hi=-1 ac_mid=-1
+  while :; do
+    cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+$4
+int
+main ()
+{
+static int test_array [1 - 2 * !(($2) >= $ac_mid)];
+test_array [0] = 0;
+return test_array [0];
 
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ac_lo=$ac_mid; break
+else
+  as_fn_arith '(' $ac_mid ')' - 1 && ac_hi=$as_val
+			if test $ac_mid -le $ac_hi; then
+			  ac_lo= ac_hi=
+			  break
+			fi
+			as_fn_arith 2 '*' $ac_mid && ac_mid=$as_val
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+  done
+else
+  ac_lo= ac_hi=
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+# Binary search between lo and hi bounds.
+while test "x$ac_lo" != "x$ac_hi"; do
+  as_fn_arith '(' $ac_hi - $ac_lo ')' / 2 + $ac_lo && ac_mid=$as_val
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+$4
+int
+main ()
+{
+static int test_array [1 - 2 * !(($2) <= $ac_mid)];
+test_array [0] = 0;
+return test_array [0];
 
-case `pwd` in
-  *\ * | *\	*)
-    { $as_echo "$as_me:$LINENO: WARNING: Libtool does not cope well with whitespace in \`pwd\`" >&5
-$as_echo "$as_me: WARNING: Libtool does not cope well with whitespace in \`pwd\`" >&2;} ;;
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ac_hi=$ac_mid
+else
+  as_fn_arith '(' $ac_mid ')' + 1 && ac_lo=$as_val
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+done
+case $ac_lo in #((
+?*) eval "$3=\$ac_lo"; ac_retval=0 ;;
+'') ac_retval=1 ;;
 esac
+  else
+    cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+$4
+static long int longval () { return $2; }
+static unsigned long int ulongval () { return $2; }
+#include <stdio.h>
+#include <stdlib.h>
+int
+main ()
+{
 
+  FILE *f = fopen ("conftest.val", "w");
+  if (! f)
+    return 1;
+  if (($2) < 0)
+    {
+      long int i = longval ();
+      if (i != ($2))
+	return 1;
+      fprintf (f, "%ld", i);
+    }
+  else
+    {
+      unsigned long int i = ulongval ();
+      if (i != ($2))
+	return 1;
+      fprintf (f, "%lu", i);
+    }
+  /* Do not output a trailing newline, as this causes \r\n confusion
+     on some platforms.  */
+  return ferror (f) || fclose (f) != 0;
 
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_run "$LINENO"; then :
+  echo >>conftest.val; read $3 <conftest.val; ac_retval=0
+else
+  ac_retval=1
+fi
+rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext \
+  conftest.$ac_objext conftest.beam conftest.$ac_ext
+rm -f conftest.val
 
-macro_version='2.2.6b'
-macro_revision='1.3017'
+  fi
+  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
+  as_fn_set_status $ac_retval
 
+} # ac_fn_c_compute_int
+cat >config.log <<_ACEOF
+This file contains any messages produced by compilers while
+running configure, to aid debugging if configure makes a mistake.
 
+It was created by xfsprogs $as_me 4.14.0, which was
+generated by GNU Autoconf 2.69.  Invocation command line was
 
+  $ $0 $@
 
+_ACEOF
+exec 5>>config.log
+{
+cat <<_ASUNAME
+## --------- ##
+## Platform. ##
+## --------- ##
 
+hostname = `(hostname || uname -n) 2>/dev/null | sed 1q`
+uname -m = `(uname -m) 2>/dev/null || echo unknown`
+uname -r = `(uname -r) 2>/dev/null || echo unknown`
+uname -s = `(uname -s) 2>/dev/null || echo unknown`
+uname -v = `(uname -v) 2>/dev/null || echo unknown`
 
+/usr/bin/uname -p = `(/usr/bin/uname -p) 2>/dev/null || echo unknown`
+/bin/uname -X     = `(/bin/uname -X) 2>/dev/null     || echo unknown`
 
+/bin/arch              = `(/bin/arch) 2>/dev/null              || echo unknown`
+/usr/bin/arch -k       = `(/usr/bin/arch -k) 2>/dev/null       || echo unknown`
+/usr/convex/getsysinfo = `(/usr/convex/getsysinfo) 2>/dev/null || echo unknown`
+/usr/bin/hostinfo      = `(/usr/bin/hostinfo) 2>/dev/null      || echo unknown`
+/bin/machine           = `(/bin/machine) 2>/dev/null           || echo unknown`
+/usr/bin/oslevel       = `(/usr/bin/oslevel) 2>/dev/null       || echo unknown`
+/bin/universe          = `(/bin/universe) 2>/dev/null          || echo unknown`
 
+_ASUNAME
 
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    $as_echo "PATH: $as_dir"
+  done
+IFS=$as_save_IFS
 
+} >&5
 
+cat >&5 <<_ACEOF
 
 
-ltmain="$ac_aux_dir/ltmain.sh"
+## ----------- ##
+## Core tests. ##
+## ----------- ##
 
-# Make sure we can run config.sub.
-$SHELL "$ac_aux_dir/config.sub" sun4 >/dev/null 2>&1 ||
-  { { $as_echo "$as_me:$LINENO: error: cannot run $SHELL $ac_aux_dir/config.sub" >&5
-$as_echo "$as_me: error: cannot run $SHELL $ac_aux_dir/config.sub" >&2;}
-   { (exit 1); exit 1; }; }
+_ACEOF
 
-{ $as_echo "$as_me:$LINENO: checking build system type" >&5
-$as_echo_n "checking build system type... " >&6; }
-if test "${ac_cv_build+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  ac_build_alias=$build_alias
-test "x$ac_build_alias" = x &&
-  ac_build_alias=`$SHELL "$ac_aux_dir/config.guess"`
-test "x$ac_build_alias" = x &&
-  { { $as_echo "$as_me:$LINENO: error: cannot guess build type; you must specify one" >&5
-$as_echo "$as_me: error: cannot guess build type; you must specify one" >&2;}
-   { (exit 1); exit 1; }; }
-ac_cv_build=`$SHELL "$ac_aux_dir/config.sub" $ac_build_alias` ||
-  { { $as_echo "$as_me:$LINENO: error: $SHELL $ac_aux_dir/config.sub $ac_build_alias failed" >&5
-$as_echo "$as_me: error: $SHELL $ac_aux_dir/config.sub $ac_build_alias failed" >&2;}
-   { (exit 1); exit 1; }; }
 
-fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_build" >&5
-$as_echo "$ac_cv_build" >&6; }
-case $ac_cv_build in
-*-*-*) ;;
-*) { { $as_echo "$as_me:$LINENO: error: invalid value of canonical build" >&5
-$as_echo "$as_me: error: invalid value of canonical build" >&2;}
-   { (exit 1); exit 1; }; };;
-esac
-build=$ac_cv_build
-ac_save_IFS=$IFS; IFS='-'
-set x $ac_cv_build
-shift
-build_cpu=$1
-build_vendor=$2
-shift; shift
-# Remember, the first character of IFS is used to create $*,
-# except with old shells:
-build_os=$*
-IFS=$ac_save_IFS
-case $build_os in *\ *) build_os=`echo "$build_os" | sed 's/ /-/g'`;; esac
-
-
-{ $as_echo "$as_me:$LINENO: checking host system type" >&5
-$as_echo_n "checking host system type... " >&6; }
-if test "${ac_cv_host+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  if test "x$host_alias" = x; then
-  ac_cv_host=$ac_cv_build
-else
-  ac_cv_host=`$SHELL "$ac_aux_dir/config.sub" $host_alias` ||
-    { { $as_echo "$as_me:$LINENO: error: $SHELL $ac_aux_dir/config.sub $host_alias failed" >&5
-$as_echo "$as_me: error: $SHELL $ac_aux_dir/config.sub $host_alias failed" >&2;}
-   { (exit 1); exit 1; }; }
-fi
-
-fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_host" >&5
-$as_echo "$ac_cv_host" >&6; }
-case $ac_cv_host in
-*-*-*) ;;
-*) { { $as_echo "$as_me:$LINENO: error: invalid value of canonical host" >&5
-$as_echo "$as_me: error: invalid value of canonical host" >&2;}
-   { (exit 1); exit 1; }; };;
-esac
-host=$ac_cv_host
-ac_save_IFS=$IFS; IFS='-'
-set x $ac_cv_host
-shift
-host_cpu=$1
-host_vendor=$2
-shift; shift
-# Remember, the first character of IFS is used to create $*,
-# except with old shells:
-host_os=$*
-IFS=$ac_save_IFS
-case $host_os in *\ *) host_os=`echo "$host_os" | sed 's/ /-/g'`;; esac
-
-
-ac_ext=c
-ac_cpp='$CPP $CPPFLAGS'
-ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
-ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
-ac_compiler_gnu=$ac_cv_c_compiler_gnu
-if test -n "$ac_tool_prefix"; then
-  # Extract the first word of "${ac_tool_prefix}gcc", so it can be a program name with args.
-set dummy ${ac_tool_prefix}gcc; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
-$as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_CC+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  if test -n "$CC"; then
-  ac_cv_prog_CC="$CC" # Let the user override the test.
-else
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
-    ac_cv_prog_CC="${ac_tool_prefix}gcc"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
-  fi
-done
-done
-IFS=$as_save_IFS
-
-fi
-fi
-CC=$ac_cv_prog_CC
-if test -n "$CC"; then
-  { $as_echo "$as_me:$LINENO: result: $CC" >&5
-$as_echo "$CC" >&6; }
-else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
-$as_echo "no" >&6; }
-fi
-
-
-fi
-if test -z "$ac_cv_prog_CC"; then
-  ac_ct_CC=$CC
-  # Extract the first word of "gcc", so it can be a program name with args.
-set dummy gcc; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
-$as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_ac_ct_CC+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  if test -n "$ac_ct_CC"; then
-  ac_cv_prog_ac_ct_CC="$ac_ct_CC" # Let the user override the test.
-else
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
-    ac_cv_prog_ac_ct_CC="gcc"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
-  fi
-done
-done
-IFS=$as_save_IFS
-
-fi
-fi
-ac_ct_CC=$ac_cv_prog_ac_ct_CC
-if test -n "$ac_ct_CC"; then
-  { $as_echo "$as_me:$LINENO: result: $ac_ct_CC" >&5
-$as_echo "$ac_ct_CC" >&6; }
-else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
-$as_echo "no" >&6; }
-fi
-
-  if test "x$ac_ct_CC" = x; then
-    CC=""
-  else
-    case $cross_compiling:$ac_tool_warned in
-yes:)
-{ $as_echo "$as_me:$LINENO: WARNING: using cross tools not prefixed with host triplet" >&5
-$as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
-ac_tool_warned=yes ;;
-esac
-    CC=$ac_ct_CC
-  fi
-else
-  CC="$ac_cv_prog_CC"
-fi
-
-if test -z "$CC"; then
-          if test -n "$ac_tool_prefix"; then
-    # Extract the first word of "${ac_tool_prefix}cc", so it can be a program name with args.
-set dummy ${ac_tool_prefix}cc; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
-$as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_CC+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  if test -n "$CC"; then
-  ac_cv_prog_CC="$CC" # Let the user override the test.
-else
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
-    ac_cv_prog_CC="${ac_tool_prefix}cc"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
-  fi
-done
-done
-IFS=$as_save_IFS
-
-fi
-fi
-CC=$ac_cv_prog_CC
-if test -n "$CC"; then
-  { $as_echo "$as_me:$LINENO: result: $CC" >&5
-$as_echo "$CC" >&6; }
-else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
-$as_echo "no" >&6; }
-fi
-
-
-  fi
-fi
-if test -z "$CC"; then
-  # Extract the first word of "cc", so it can be a program name with args.
-set dummy cc; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
-$as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_CC+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  if test -n "$CC"; then
-  ac_cv_prog_CC="$CC" # Let the user override the test.
-else
-  ac_prog_rejected=no
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
-    if test "$as_dir/$ac_word$ac_exec_ext" = "/usr/ucb/cc"; then
-       ac_prog_rejected=yes
-       continue
-     fi
-    ac_cv_prog_CC="cc"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
-  fi
-done
-done
-IFS=$as_save_IFS
-
-if test $ac_prog_rejected = yes; then
-  # We found a bogon in the path, so make sure we never use it.
-  set dummy $ac_cv_prog_CC
-  shift
-  if test $# != 0; then
-    # We chose a different compiler from the bogus one.
-    # However, it has the same basename, so the bogon will be chosen
-    # first if we set CC to just the basename; use the full file name.
-    shift
-    ac_cv_prog_CC="$as_dir/$ac_word${1+' '}$@"
-  fi
-fi
-fi
-fi
-CC=$ac_cv_prog_CC
-if test -n "$CC"; then
-  { $as_echo "$as_me:$LINENO: result: $CC" >&5
-$as_echo "$CC" >&6; }
-else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
-$as_echo "no" >&6; }
-fi
-
-
-fi
-if test -z "$CC"; then
-  if test -n "$ac_tool_prefix"; then
-  for ac_prog in cl.exe
-  do
-    # Extract the first word of "$ac_tool_prefix$ac_prog", so it can be a program name with args.
-set dummy $ac_tool_prefix$ac_prog; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
-$as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_CC+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  if test -n "$CC"; then
-  ac_cv_prog_CC="$CC" # Let the user override the test.
-else
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
-    ac_cv_prog_CC="$ac_tool_prefix$ac_prog"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
-  fi
-done
-done
-IFS=$as_save_IFS
-
-fi
-fi
-CC=$ac_cv_prog_CC
-if test -n "$CC"; then
-  { $as_echo "$as_me:$LINENO: result: $CC" >&5
-$as_echo "$CC" >&6; }
-else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
-$as_echo "no" >&6; }
-fi
-
-
-    test -n "$CC" && break
-  done
-fi
-if test -z "$CC"; then
-  ac_ct_CC=$CC
-  for ac_prog in cl.exe
-do
-  # Extract the first word of "$ac_prog", so it can be a program name with args.
-set dummy $ac_prog; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
-$as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_ac_ct_CC+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  if test -n "$ac_ct_CC"; then
-  ac_cv_prog_ac_ct_CC="$ac_ct_CC" # Let the user override the test.
-else
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
-    ac_cv_prog_ac_ct_CC="$ac_prog"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
-  fi
-done
-done
-IFS=$as_save_IFS
-
-fi
-fi
-ac_ct_CC=$ac_cv_prog_ac_ct_CC
-if test -n "$ac_ct_CC"; then
-  { $as_echo "$as_me:$LINENO: result: $ac_ct_CC" >&5
-$as_echo "$ac_ct_CC" >&6; }
-else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
-$as_echo "no" >&6; }
-fi
-
-
-  test -n "$ac_ct_CC" && break
-done
-
-  if test "x$ac_ct_CC" = x; then
-    CC=""
-  else
-    case $cross_compiling:$ac_tool_warned in
-yes:)
-{ $as_echo "$as_me:$LINENO: WARNING: using cross tools not prefixed with host triplet" >&5
-$as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
-ac_tool_warned=yes ;;
-esac
-    CC=$ac_ct_CC
-  fi
-fi
-
-fi
-
-
-test -z "$CC" && { { $as_echo "$as_me:$LINENO: error: in \`$ac_pwd':" >&5
-$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-{ { $as_echo "$as_me:$LINENO: error: no acceptable C compiler found in \$PATH
-See \`config.log' for more details." >&5
-$as_echo "$as_me: error: no acceptable C compiler found in \$PATH
-See \`config.log' for more details." >&2;}
-   { (exit 1); exit 1; }; }; }
-
-# Provide some information about the compiler.
-$as_echo "$as_me:$LINENO: checking for C compiler version" >&5
-set X $ac_compile
-ac_compiler=$2
-{ (ac_try="$ac_compiler --version >&5"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compiler --version >&5") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }
-{ (ac_try="$ac_compiler -v >&5"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compiler -v >&5") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }
-{ (ac_try="$ac_compiler -V >&5"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compiler -V >&5") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }
-
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-
-int
-main ()
-{
-
-  ;
-  return 0;
-}
-_ACEOF
-ac_clean_files_save=$ac_clean_files
-ac_clean_files="$ac_clean_files a.out a.out.dSYM a.exe b.out"
-# Try to create an executable without -o first, disregard a.out.
-# It will help us diagnose broken compilers, and finding out an intuition
-# of exeext.
-{ $as_echo "$as_me:$LINENO: checking for C compiler default output file name" >&5
-$as_echo_n "checking for C compiler default output file name... " >&6; }
-ac_link_default=`$as_echo "$ac_link" | sed 's/ -o *conftest[^ ]*//'`
-
-# The possible output files:
-ac_files="a.out conftest.exe conftest a.exe a_out.exe b.out conftest.*"
-
-ac_rmfiles=
-for ac_file in $ac_files
-do
-  case $ac_file in
-    *.$ac_ext | *.xcoff | *.tds | *.d | *.pdb | *.xSYM | *.bb | *.bbg | *.map | *.inf | *.dSYM | *.o | *.obj ) ;;
-    * ) ac_rmfiles="$ac_rmfiles $ac_file";;
-  esac
-done
-rm -f $ac_rmfiles
-
-if { (ac_try="$ac_link_default"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link_default") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; then
-  # Autoconf-2.13 could set the ac_cv_exeext variable to `no'.
-# So ignore a value of `no', otherwise this would lead to `EXEEXT = no'
-# in a Makefile.  We should not override ac_cv_exeext if it was cached,
-# so that the user can short-circuit this test for compilers unknown to
-# Autoconf.
-for ac_file in $ac_files ''
-do
-  test -f "$ac_file" || continue
-  case $ac_file in
-    *.$ac_ext | *.xcoff | *.tds | *.d | *.pdb | *.xSYM | *.bb | *.bbg | *.map | *.inf | *.dSYM | *.o | *.obj )
-	;;
-    [ab].out )
-	# We found the default executable, but exeext='' is most
-	# certainly right.
-	break;;
-    *.* )
-        if test "${ac_cv_exeext+set}" = set && test "$ac_cv_exeext" != no;
-	then :; else
-	   ac_cv_exeext=`expr "$ac_file" : '[^.]*\(\..*\)'`
-	fi
-	# We set ac_cv_exeext here because the later test for it is not
-	# safe: cross compilers may not add the suffix if given an `-o'
-	# argument, so we may need to know it at that point already.
-	# Even if this section looks crufty: it has the advantage of
-	# actually working.
-	break;;
-    * )
-	break;;
-  esac
-done
-test "$ac_cv_exeext" = no && ac_cv_exeext=
-
-else
-  ac_file=''
-fi
-
-{ $as_echo "$as_me:$LINENO: result: $ac_file" >&5
-$as_echo "$ac_file" >&6; }
-if test -z "$ac_file"; then
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-{ { $as_echo "$as_me:$LINENO: error: in \`$ac_pwd':" >&5
-$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-{ { $as_echo "$as_me:$LINENO: error: C compiler cannot create executables
-See \`config.log' for more details." >&5
-$as_echo "$as_me: error: C compiler cannot create executables
-See \`config.log' for more details." >&2;}
-   { (exit 77); exit 77; }; }; }
-fi
-
-ac_exeext=$ac_cv_exeext
-
-# Check that the compiler produces executables we can run.  If not, either
-# the compiler is broken, or we cross compile.
-{ $as_echo "$as_me:$LINENO: checking whether the C compiler works" >&5
-$as_echo_n "checking whether the C compiler works... " >&6; }
-# FIXME: These cross compiler hacks should be removed for Autoconf 3.0
-# If not cross compiling, check that we can run a simple program.
-if test "$cross_compiling" != yes; then
-  if { ac_try='./$ac_file'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
-    cross_compiling=no
-  else
-    if test "$cross_compiling" = maybe; then
-	cross_compiling=yes
-    else
-	{ { $as_echo "$as_me:$LINENO: error: in \`$ac_pwd':" >&5
-$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-{ { $as_echo "$as_me:$LINENO: error: cannot run C compiled programs.
-If you meant to cross compile, use \`--host'.
-See \`config.log' for more details." >&5
-$as_echo "$as_me: error: cannot run C compiled programs.
-If you meant to cross compile, use \`--host'.
-See \`config.log' for more details." >&2;}
-   { (exit 1); exit 1; }; }; }
-    fi
-  fi
-fi
-{ $as_echo "$as_me:$LINENO: result: yes" >&5
-$as_echo "yes" >&6; }
-
-rm -f -r a.out a.out.dSYM a.exe conftest$ac_cv_exeext b.out
-ac_clean_files=$ac_clean_files_save
-# Check that the compiler produces executables we can run.  If not, either
-# the compiler is broken, or we cross compile.
-{ $as_echo "$as_me:$LINENO: checking whether we are cross compiling" >&5
-$as_echo_n "checking whether we are cross compiling... " >&6; }
-{ $as_echo "$as_me:$LINENO: result: $cross_compiling" >&5
-$as_echo "$cross_compiling" >&6; }
-
-{ $as_echo "$as_me:$LINENO: checking for suffix of executables" >&5
-$as_echo_n "checking for suffix of executables... " >&6; }
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; then
-  # If both `conftest.exe' and `conftest' are `present' (well, observable)
-# catch `conftest.exe'.  For instance with Cygwin, `ls conftest' will
-# work properly (i.e., refer to `conftest.exe'), while it won't with
-# `rm'.
-for ac_file in conftest.exe conftest conftest.*; do
-  test -f "$ac_file" || continue
-  case $ac_file in
-    *.$ac_ext | *.xcoff | *.tds | *.d | *.pdb | *.xSYM | *.bb | *.bbg | *.map | *.inf | *.dSYM | *.o | *.obj ) ;;
-    *.* ) ac_cv_exeext=`expr "$ac_file" : '[^.]*\(\..*\)'`
-	  break;;
-    * ) break;;
-  esac
-done
-else
-  { { $as_echo "$as_me:$LINENO: error: in \`$ac_pwd':" >&5
-$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-{ { $as_echo "$as_me:$LINENO: error: cannot compute suffix of executables: cannot compile and link
-See \`config.log' for more details." >&5
-$as_echo "$as_me: error: cannot compute suffix of executables: cannot compile and link
-See \`config.log' for more details." >&2;}
-   { (exit 1); exit 1; }; }; }
-fi
-
-rm -f conftest$ac_cv_exeext
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_exeext" >&5
-$as_echo "$ac_cv_exeext" >&6; }
-
-rm -f conftest.$ac_ext
-EXEEXT=$ac_cv_exeext
-ac_exeext=$EXEEXT
-{ $as_echo "$as_me:$LINENO: checking for suffix of object files" >&5
-$as_echo_n "checking for suffix of object files... " >&6; }
-if test "${ac_cv_objext+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-
-int
-main ()
-{
-
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.o conftest.obj
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; then
-  for ac_file in conftest.o conftest.obj conftest.*; do
-  test -f "$ac_file" || continue;
-  case $ac_file in
-    *.$ac_ext | *.xcoff | *.tds | *.d | *.pdb | *.xSYM | *.bb | *.bbg | *.map | *.inf | *.dSYM ) ;;
-    *) ac_cv_objext=`expr "$ac_file" : '.*\.\(.*\)'`
-       break;;
-  esac
-done
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-{ { $as_echo "$as_me:$LINENO: error: in \`$ac_pwd':" >&5
-$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-{ { $as_echo "$as_me:$LINENO: error: cannot compute suffix of object files: cannot compile
-See \`config.log' for more details." >&5
-$as_echo "$as_me: error: cannot compute suffix of object files: cannot compile
-See \`config.log' for more details." >&2;}
-   { (exit 1); exit 1; }; }; }
-fi
-
-rm -f conftest.$ac_cv_objext conftest.$ac_ext
-fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_objext" >&5
-$as_echo "$ac_cv_objext" >&6; }
-OBJEXT=$ac_cv_objext
-ac_objext=$OBJEXT
-{ $as_echo "$as_me:$LINENO: checking whether we are using the GNU C compiler" >&5
-$as_echo_n "checking whether we are using the GNU C compiler... " >&6; }
-if test "${ac_cv_c_compiler_gnu+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-
-int
-main ()
-{
-#ifndef __GNUC__
-       choke me
-#endif
-
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_compiler_gnu=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_compiler_gnu=no
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-ac_cv_c_compiler_gnu=$ac_compiler_gnu
-
-fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_c_compiler_gnu" >&5
-$as_echo "$ac_cv_c_compiler_gnu" >&6; }
-if test $ac_compiler_gnu = yes; then
-  GCC=yes
-else
-  GCC=
-fi
-ac_test_CFLAGS=${CFLAGS+set}
-ac_save_CFLAGS=$CFLAGS
-{ $as_echo "$as_me:$LINENO: checking whether $CC accepts -g" >&5
-$as_echo_n "checking whether $CC accepts -g... " >&6; }
-if test "${ac_cv_prog_cc_g+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  ac_save_c_werror_flag=$ac_c_werror_flag
-   ac_c_werror_flag=yes
-   ac_cv_prog_cc_g=no
-   CFLAGS="-g"
-   cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-
-int
-main ()
-{
-
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_cv_prog_cc_g=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CFLAGS=""
-      cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-
-int
-main ()
-{
-
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  :
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_c_werror_flag=$ac_save_c_werror_flag
-	 CFLAGS="-g"
-	 cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-
-int
-main ()
-{
-
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_cv_prog_cc_g=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-   ac_c_werror_flag=$ac_save_c_werror_flag
-fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_prog_cc_g" >&5
-$as_echo "$ac_cv_prog_cc_g" >&6; }
-if test "$ac_test_CFLAGS" = set; then
-  CFLAGS=$ac_save_CFLAGS
-elif test $ac_cv_prog_cc_g = yes; then
-  if test "$GCC" = yes; then
-    CFLAGS="-g -O2"
-  else
-    CFLAGS="-g"
-  fi
-else
-  if test "$GCC" = yes; then
-    CFLAGS="-O2"
-  else
-    CFLAGS=
-  fi
-fi
-{ $as_echo "$as_me:$LINENO: checking for $CC option to accept ISO C89" >&5
-$as_echo_n "checking for $CC option to accept ISO C89... " >&6; }
-if test "${ac_cv_prog_cc_c89+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  ac_cv_prog_cc_c89=no
-ac_save_CC=$CC
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <stdarg.h>
-#include <stdio.h>
-#include <sys/types.h>
-#include <sys/stat.h>
-/* Most of the following tests are stolen from RCS 5.7's src/conf.sh.  */
-struct buf { int x; };
-FILE * (*rcsopen) (struct buf *, struct stat *, int);
-static char *e (p, i)
-     char **p;
-     int i;
-{
-  return p[i];
-}
-static char *f (char * (*g) (char **, int), char **p, ...)
-{
-  char *s;
-  va_list v;
-  va_start (v,p);
-  s = g (p, va_arg (v,int));
-  va_end (v);
-  return s;
-}
-
-/* OSF 4.0 Compaq cc is some sort of almost-ANSI by default.  It has
-   function prototypes and stuff, but not '\xHH' hex character constants.
-   These don't provoke an error unfortunately, instead are silently treated
-   as 'x'.  The following induces an error, until -std is added to get
-   proper ANSI mode.  Curiously '\x00'!='x' always comes out true, for an
-   array size at least.  It's necessary to write '\x00'==0 to get something
-   that's true only with -std.  */
-int osf4_cc_array ['\x00' == 0 ? 1 : -1];
-
-/* IBM C 6 for AIX is almost-ANSI by default, but it replaces macro parameters
-   inside strings and character constants.  */
-#define FOO(x) 'x'
-int xlc6_cc_array[FOO(a) == 'x' ? 1 : -1];
-
-int test (int i, double x);
-struct s1 {int (*f) (int a);};
-struct s2 {int (*f) (double a);};
-int pairnames (int, char **, FILE *(*)(struct buf *, struct stat *, int), int, int);
-int argc;
-char **argv;
-int
-main ()
-{
-return f (e, argv, 0) != argv[0]  ||  f (e, argv, 1) != argv[1];
-  ;
-  return 0;
-}
-_ACEOF
-for ac_arg in '' -qlanglvl=extc89 -qlanglvl=ansi -std \
-	-Ae "-Aa -D_HPUX_SOURCE" "-Xc -D__EXTENSIONS__"
-do
-  CC="$ac_save_CC $ac_arg"
-  rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_cv_prog_cc_c89=$ac_arg
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-
-fi
-
-rm -f core conftest.err conftest.$ac_objext
-  test "x$ac_cv_prog_cc_c89" != "xno" && break
-done
-rm -f conftest.$ac_ext
-CC=$ac_save_CC
-
-fi
-# AC_CACHE_VAL
-case "x$ac_cv_prog_cc_c89" in
-  x)
-    { $as_echo "$as_me:$LINENO: result: none needed" >&5
-$as_echo "none needed" >&6; } ;;
-  xno)
-    { $as_echo "$as_me:$LINENO: result: unsupported" >&5
-$as_echo "unsupported" >&6; } ;;
-  *)
-    CC="$CC $ac_cv_prog_cc_c89"
-    { $as_echo "$as_me:$LINENO: result: $ac_cv_prog_cc_c89" >&5
-$as_echo "$ac_cv_prog_cc_c89" >&6; } ;;
-esac
-
-
-ac_ext=c
-ac_cpp='$CPP $CPPFLAGS'
-ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
-ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
-ac_compiler_gnu=$ac_cv_c_compiler_gnu
-
-{ $as_echo "$as_me:$LINENO: checking for a sed that does not truncate output" >&5
-$as_echo_n "checking for a sed that does not truncate output... " >&6; }
-if test "${ac_cv_path_SED+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-            ac_script=s/aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa/bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb/
-     for ac_i in 1 2 3 4 5 6 7; do
-       ac_script="$ac_script$as_nl$ac_script"
-     done
-     echo "$ac_script" 2>/dev/null | sed 99q >conftest.sed
-     $as_unset ac_script || ac_script=
-     if test -z "$SED"; then
-  ac_path_SED_found=false
-  # Loop through the user's path and test for each of PROGNAME-LIST
-  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-  for ac_prog in sed gsed; do
-    for ac_exec_ext in '' $ac_executable_extensions; do
-      ac_path_SED="$as_dir/$ac_prog$ac_exec_ext"
-      { test -f "$ac_path_SED" && $as_test_x "$ac_path_SED"; } || continue
-# Check for GNU ac_path_SED and select it if it is found.
-  # Check for GNU $ac_path_SED
-case `"$ac_path_SED" --version 2>&1` in
-*GNU*)
-  ac_cv_path_SED="$ac_path_SED" ac_path_SED_found=:;;
-*)
-  ac_count=0
-  $as_echo_n 0123456789 >"conftest.in"
-  while :
-  do
-    cat "conftest.in" "conftest.in" >"conftest.tmp"
-    mv "conftest.tmp" "conftest.in"
-    cp "conftest.in" "conftest.nl"
-    $as_echo '' >> "conftest.nl"
-    "$ac_path_SED" -f conftest.sed < "conftest.nl" >"conftest.out" 2>/dev/null || break
-    diff "conftest.out" "conftest.nl" >/dev/null 2>&1 || break
-    ac_count=`expr $ac_count + 1`
-    if test $ac_count -gt ${ac_path_SED_max-0}; then
-      # Best one so far, save it but keep looking for a better one
-      ac_cv_path_SED="$ac_path_SED"
-      ac_path_SED_max=$ac_count
-    fi
-    # 10*(2^10) chars as input seems more than enough
-    test $ac_count -gt 10 && break
-  done
-  rm -f conftest.in conftest.tmp conftest.nl conftest.out;;
-esac
-
-      $ac_path_SED_found && break 3
-    done
-  done
-done
-IFS=$as_save_IFS
-  if test -z "$ac_cv_path_SED"; then
-    { { $as_echo "$as_me:$LINENO: error: no acceptable sed could be found in \$PATH" >&5
-$as_echo "$as_me: error: no acceptable sed could be found in \$PATH" >&2;}
-   { (exit 1); exit 1; }; }
-  fi
-else
-  ac_cv_path_SED=$SED
-fi
-
-fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_path_SED" >&5
-$as_echo "$ac_cv_path_SED" >&6; }
- SED="$ac_cv_path_SED"
-  rm -f conftest.sed
-
-test -z "$SED" && SED=sed
-Xsed="$SED -e 1s/^X//"
-
-
-
-
-
-
-
-
-
-
-
-{ $as_echo "$as_me:$LINENO: checking for grep that handles long lines and -e" >&5
-$as_echo_n "checking for grep that handles long lines and -e... " >&6; }
-if test "${ac_cv_path_GREP+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  if test -z "$GREP"; then
-  ac_path_GREP_found=false
-  # Loop through the user's path and test for each of PROGNAME-LIST
-  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH$PATH_SEPARATOR/usr/xpg4/bin
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-  for ac_prog in grep ggrep; do
-    for ac_exec_ext in '' $ac_executable_extensions; do
-      ac_path_GREP="$as_dir/$ac_prog$ac_exec_ext"
-      { test -f "$ac_path_GREP" && $as_test_x "$ac_path_GREP"; } || continue
-# Check for GNU ac_path_GREP and select it if it is found.
-  # Check for GNU $ac_path_GREP
-case `"$ac_path_GREP" --version 2>&1` in
-*GNU*)
-  ac_cv_path_GREP="$ac_path_GREP" ac_path_GREP_found=:;;
-*)
-  ac_count=0
-  $as_echo_n 0123456789 >"conftest.in"
-  while :
-  do
-    cat "conftest.in" "conftest.in" >"conftest.tmp"
-    mv "conftest.tmp" "conftest.in"
-    cp "conftest.in" "conftest.nl"
-    $as_echo 'GREP' >> "conftest.nl"
-    "$ac_path_GREP" -e 'GREP$' -e '-(cannot match)-' < "conftest.nl" >"conftest.out" 2>/dev/null || break
-    diff "conftest.out" "conftest.nl" >/dev/null 2>&1 || break
-    ac_count=`expr $ac_count + 1`
-    if test $ac_count -gt ${ac_path_GREP_max-0}; then
-      # Best one so far, save it but keep looking for a better one
-      ac_cv_path_GREP="$ac_path_GREP"
-      ac_path_GREP_max=$ac_count
-    fi
-    # 10*(2^10) chars as input seems more than enough
-    test $ac_count -gt 10 && break
-  done
-  rm -f conftest.in conftest.tmp conftest.nl conftest.out;;
-esac
-
-      $ac_path_GREP_found && break 3
-    done
-  done
-done
-IFS=$as_save_IFS
-  if test -z "$ac_cv_path_GREP"; then
-    { { $as_echo "$as_me:$LINENO: error: no acceptable grep could be found in $PATH$PATH_SEPARATOR/usr/xpg4/bin" >&5
-$as_echo "$as_me: error: no acceptable grep could be found in $PATH$PATH_SEPARATOR/usr/xpg4/bin" >&2;}
-   { (exit 1); exit 1; }; }
-  fi
-else
-  ac_cv_path_GREP=$GREP
-fi
-
-fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_path_GREP" >&5
-$as_echo "$ac_cv_path_GREP" >&6; }
- GREP="$ac_cv_path_GREP"
-
-
-{ $as_echo "$as_me:$LINENO: checking for egrep" >&5
-$as_echo_n "checking for egrep... " >&6; }
-if test "${ac_cv_path_EGREP+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  if echo a | $GREP -E '(a|b)' >/dev/null 2>&1
-   then ac_cv_path_EGREP="$GREP -E"
-   else
-     if test -z "$EGREP"; then
-  ac_path_EGREP_found=false
-  # Loop through the user's path and test for each of PROGNAME-LIST
-  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH$PATH_SEPARATOR/usr/xpg4/bin
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-  for ac_prog in egrep; do
-    for ac_exec_ext in '' $ac_executable_extensions; do
-      ac_path_EGREP="$as_dir/$ac_prog$ac_exec_ext"
-      { test -f "$ac_path_EGREP" && $as_test_x "$ac_path_EGREP"; } || continue
-# Check for GNU ac_path_EGREP and select it if it is found.
-  # Check for GNU $ac_path_EGREP
-case `"$ac_path_EGREP" --version 2>&1` in
-*GNU*)
-  ac_cv_path_EGREP="$ac_path_EGREP" ac_path_EGREP_found=:;;
-*)
-  ac_count=0
-  $as_echo_n 0123456789 >"conftest.in"
-  while :
-  do
-    cat "conftest.in" "conftest.in" >"conftest.tmp"
-    mv "conftest.tmp" "conftest.in"
-    cp "conftest.in" "conftest.nl"
-    $as_echo 'EGREP' >> "conftest.nl"
-    "$ac_path_EGREP" 'EGREP$' < "conftest.nl" >"conftest.out" 2>/dev/null || break
-    diff "conftest.out" "conftest.nl" >/dev/null 2>&1 || break
-    ac_count=`expr $ac_count + 1`
-    if test $ac_count -gt ${ac_path_EGREP_max-0}; then
-      # Best one so far, save it but keep looking for a better one
-      ac_cv_path_EGREP="$ac_path_EGREP"
-      ac_path_EGREP_max=$ac_count
-    fi
-    # 10*(2^10) chars as input seems more than enough
-    test $ac_count -gt 10 && break
-  done
-  rm -f conftest.in conftest.tmp conftest.nl conftest.out;;
-esac
-
-      $ac_path_EGREP_found && break 3
-    done
-  done
-done
-IFS=$as_save_IFS
-  if test -z "$ac_cv_path_EGREP"; then
-    { { $as_echo "$as_me:$LINENO: error: no acceptable egrep could be found in $PATH$PATH_SEPARATOR/usr/xpg4/bin" >&5
-$as_echo "$as_me: error: no acceptable egrep could be found in $PATH$PATH_SEPARATOR/usr/xpg4/bin" >&2;}
-   { (exit 1); exit 1; }; }
-  fi
-else
-  ac_cv_path_EGREP=$EGREP
-fi
-
-   fi
-fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_path_EGREP" >&5
-$as_echo "$ac_cv_path_EGREP" >&6; }
- EGREP="$ac_cv_path_EGREP"
-
-
-{ $as_echo "$as_me:$LINENO: checking for fgrep" >&5
-$as_echo_n "checking for fgrep... " >&6; }
-if test "${ac_cv_path_FGREP+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  if echo 'ab*c' | $GREP -F 'ab*c' >/dev/null 2>&1
-   then ac_cv_path_FGREP="$GREP -F"
-   else
-     if test -z "$FGREP"; then
-  ac_path_FGREP_found=false
-  # Loop through the user's path and test for each of PROGNAME-LIST
-  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH$PATH_SEPARATOR/usr/xpg4/bin
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-  for ac_prog in fgrep; do
-    for ac_exec_ext in '' $ac_executable_extensions; do
-      ac_path_FGREP="$as_dir/$ac_prog$ac_exec_ext"
-      { test -f "$ac_path_FGREP" && $as_test_x "$ac_path_FGREP"; } || continue
-# Check for GNU ac_path_FGREP and select it if it is found.
-  # Check for GNU $ac_path_FGREP
-case `"$ac_path_FGREP" --version 2>&1` in
-*GNU*)
-  ac_cv_path_FGREP="$ac_path_FGREP" ac_path_FGREP_found=:;;
-*)
-  ac_count=0
-  $as_echo_n 0123456789 >"conftest.in"
-  while :
-  do
-    cat "conftest.in" "conftest.in" >"conftest.tmp"
-    mv "conftest.tmp" "conftest.in"
-    cp "conftest.in" "conftest.nl"
-    $as_echo 'FGREP' >> "conftest.nl"
-    "$ac_path_FGREP" FGREP < "conftest.nl" >"conftest.out" 2>/dev/null || break
-    diff "conftest.out" "conftest.nl" >/dev/null 2>&1 || break
-    ac_count=`expr $ac_count + 1`
-    if test $ac_count -gt ${ac_path_FGREP_max-0}; then
-      # Best one so far, save it but keep looking for a better one
-      ac_cv_path_FGREP="$ac_path_FGREP"
-      ac_path_FGREP_max=$ac_count
-    fi
-    # 10*(2^10) chars as input seems more than enough
-    test $ac_count -gt 10 && break
-  done
-  rm -f conftest.in conftest.tmp conftest.nl conftest.out;;
-esac
-
-      $ac_path_FGREP_found && break 3
-    done
-  done
-done
-IFS=$as_save_IFS
-  if test -z "$ac_cv_path_FGREP"; then
-    { { $as_echo "$as_me:$LINENO: error: no acceptable fgrep could be found in $PATH$PATH_SEPARATOR/usr/xpg4/bin" >&5
-$as_echo "$as_me: error: no acceptable fgrep could be found in $PATH$PATH_SEPARATOR/usr/xpg4/bin" >&2;}
-   { (exit 1); exit 1; }; }
-  fi
-else
-  ac_cv_path_FGREP=$FGREP
-fi
-
-   fi
-fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_path_FGREP" >&5
-$as_echo "$ac_cv_path_FGREP" >&6; }
- FGREP="$ac_cv_path_FGREP"
-
-
-test -z "$GREP" && GREP=grep
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-# Check whether --with-gnu-ld was given.
-if test "${with_gnu_ld+set}" = set; then
-  withval=$with_gnu_ld; test "$withval" = no || with_gnu_ld=yes
-else
-  with_gnu_ld=no
-fi
-
-ac_prog=ld
-if test "$GCC" = yes; then
-  # Check if gcc -print-prog-name=ld gives a path.
-  { $as_echo "$as_me:$LINENO: checking for ld used by $CC" >&5
-$as_echo_n "checking for ld used by $CC... " >&6; }
-  case $host in
-  *-*-mingw*)
-    # gcc leaves a trailing carriage return which upsets mingw
-    ac_prog=`($CC -print-prog-name=ld) 2>&5 | tr -d '\015'` ;;
-  *)
-    ac_prog=`($CC -print-prog-name=ld) 2>&5` ;;
-  esac
-  case $ac_prog in
-    # Accept absolute paths.
-    [\\/]* | ?:[\\/]*)
-      re_direlt='/[^/][^/]*/\.\./'
-      # Canonicalize the pathname of ld
-      ac_prog=`$ECHO "$ac_prog"| $SED 's%\\\\%/%g'`
-      while $ECHO "$ac_prog" | $GREP "$re_direlt" > /dev/null 2>&1; do
-	ac_prog=`$ECHO $ac_prog| $SED "s%$re_direlt%/%"`
-      done
-      test -z "$LD" && LD="$ac_prog"
-      ;;
-  "")
-    # If it fails, then pretend we aren't using GCC.
-    ac_prog=ld
-    ;;
-  *)
-    # If it is relative, then search for the first ld in PATH.
-    with_gnu_ld=unknown
-    ;;
-  esac
-elif test "$with_gnu_ld" = yes; then
-  { $as_echo "$as_me:$LINENO: checking for GNU ld" >&5
-$as_echo_n "checking for GNU ld... " >&6; }
-else
-  { $as_echo "$as_me:$LINENO: checking for non-GNU ld" >&5
-$as_echo_n "checking for non-GNU ld... " >&6; }
-fi
-if test "${lt_cv_path_LD+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  if test -z "$LD"; then
-  lt_save_ifs="$IFS"; IFS=$PATH_SEPARATOR
-  for ac_dir in $PATH; do
-    IFS="$lt_save_ifs"
-    test -z "$ac_dir" && ac_dir=.
-    if test -f "$ac_dir/$ac_prog" || test -f "$ac_dir/$ac_prog$ac_exeext"; then
-      lt_cv_path_LD="$ac_dir/$ac_prog"
-      # Check to see if the program is GNU ld.  I'd rather use --version,
-      # but apparently some variants of GNU ld only accept -v.
-      # Break only if it was the GNU/non-GNU ld that we prefer.
-      case `"$lt_cv_path_LD" -v 2>&1 </dev/null` in
-      *GNU* | *'with BFD'*)
-	test "$with_gnu_ld" != no && break
-	;;
-      *)
-	test "$with_gnu_ld" != yes && break
-	;;
-      esac
-    fi
-  done
-  IFS="$lt_save_ifs"
-else
-  lt_cv_path_LD="$LD" # Let the user override the test with a path.
-fi
-fi
-
-LD="$lt_cv_path_LD"
-if test -n "$LD"; then
-  { $as_echo "$as_me:$LINENO: result: $LD" >&5
-$as_echo "$LD" >&6; }
-else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
-$as_echo "no" >&6; }
-fi
-test -z "$LD" && { { $as_echo "$as_me:$LINENO: error: no acceptable ld found in \$PATH" >&5
-$as_echo "$as_me: error: no acceptable ld found in \$PATH" >&2;}
-   { (exit 1); exit 1; }; }
-{ $as_echo "$as_me:$LINENO: checking if the linker ($LD) is GNU ld" >&5
-$as_echo_n "checking if the linker ($LD) is GNU ld... " >&6; }
-if test "${lt_cv_prog_gnu_ld+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  # I'd rather use --version here, but apparently some GNU lds only accept -v.
-case `$LD -v 2>&1 </dev/null` in
-*GNU* | *'with BFD'*)
-  lt_cv_prog_gnu_ld=yes
-  ;;
-*)
-  lt_cv_prog_gnu_ld=no
-  ;;
-esac
-fi
-{ $as_echo "$as_me:$LINENO: result: $lt_cv_prog_gnu_ld" >&5
-$as_echo "$lt_cv_prog_gnu_ld" >&6; }
-with_gnu_ld=$lt_cv_prog_gnu_ld
-
-
-
-
-
-
-
-
-
-{ $as_echo "$as_me:$LINENO: checking for BSD- or MS-compatible name lister (nm)" >&5
-$as_echo_n "checking for BSD- or MS-compatible name lister (nm)... " >&6; }
-if test "${lt_cv_path_NM+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  if test -n "$NM"; then
-  # Let the user override the test.
-  lt_cv_path_NM="$NM"
-else
-  lt_nm_to_check="${ac_tool_prefix}nm"
-  if test -n "$ac_tool_prefix" && test "$build" = "$host"; then
-    lt_nm_to_check="$lt_nm_to_check nm"
-  fi
-  for lt_tmp_nm in $lt_nm_to_check; do
-    lt_save_ifs="$IFS"; IFS=$PATH_SEPARATOR
-    for ac_dir in $PATH /usr/ccs/bin/elf /usr/ccs/bin /usr/ucb /bin; do
-      IFS="$lt_save_ifs"
-      test -z "$ac_dir" && ac_dir=.
-      tmp_nm="$ac_dir/$lt_tmp_nm"
-      if test -f "$tmp_nm" || test -f "$tmp_nm$ac_exeext" ; then
-	# Check to see if the nm accepts a BSD-compat flag.
-	# Adding the `sed 1q' prevents false positives on HP-UX, which says:
-	#   nm: unknown option "B" ignored
-	# Tru64's nm complains that /dev/null is an invalid object file
-	case `"$tmp_nm" -B /dev/null 2>&1 | sed '1q'` in
-	*/dev/null* | *'Invalid file or object type'*)
-	  lt_cv_path_NM="$tmp_nm -B"
-	  break
-	  ;;
-	*)
-	  case `"$tmp_nm" -p /dev/null 2>&1 | sed '1q'` in
-	  */dev/null*)
-	    lt_cv_path_NM="$tmp_nm -p"
-	    break
-	    ;;
-	  *)
-	    lt_cv_path_NM=${lt_cv_path_NM="$tmp_nm"} # keep the first match, but
-	    continue # so that we can try to find one that supports BSD flags
+# Keep a trace of the command line.
+# Strip out --no-create and --no-recursion so they do not pile up.
+# Strip out --silent because we don't want to record it for future runs.
+# Also quote any args containing shell meta-characters.
+# Make two passes to allow for proper duplicate-argument suppression.
+ac_configure_args=
+ac_configure_args0=
+ac_configure_args1=
+ac_must_keep_next=false
+for ac_pass in 1 2
+do
+  for ac_arg
+  do
+    case $ac_arg in
+    -no-create | --no-c* | -n | -no-recursion | --no-r*) continue ;;
+    -q | -quiet | --quiet | --quie | --qui | --qu | --q \
+    | -silent | --silent | --silen | --sile | --sil)
+      continue ;;
+    *\'*)
+      ac_arg=`$as_echo "$ac_arg" | sed "s/'/'\\\\\\\\''/g"` ;;
+    esac
+    case $ac_pass in
+    1) as_fn_append ac_configure_args0 " '$ac_arg'" ;;
+    2)
+      as_fn_append ac_configure_args1 " '$ac_arg'"
+      if test $ac_must_keep_next = true; then
+	ac_must_keep_next=false # Got value, back to normal.
+      else
+	case $ac_arg in
+	  *=* | --config-cache | -C | -disable-* | --disable-* \
+	  | -enable-* | --enable-* | -gas | --g* | -nfp | --nf* \
+	  | -q | -quiet | --q* | -silent | --sil* | -v | -verb* \
+	  | -with-* | --with-* | -without-* | --without-* | --x)
+	    case "$ac_configure_args0 " in
+	      "$ac_configure_args1"*" '$ac_arg' "* ) continue ;;
+	    esac
 	    ;;
-	  esac
-	  ;;
+	  -* ) ac_must_keep_next=true ;;
 	esac
       fi
-    done
-    IFS="$lt_save_ifs"
+      as_fn_append ac_configure_args " '$ac_arg'"
+      ;;
+    esac
   done
-  : ${lt_cv_path_NM=no}
-fi
-fi
-{ $as_echo "$as_me:$LINENO: result: $lt_cv_path_NM" >&5
-$as_echo "$lt_cv_path_NM" >&6; }
-if test "$lt_cv_path_NM" != "no"; then
-  NM="$lt_cv_path_NM"
-else
-  # Didn't find any BSD compatible name lister, look for dumpbin.
-  if test -n "$ac_tool_prefix"; then
-  for ac_prog in "dumpbin -symbols" "link -dump -symbols"
-  do
-    # Extract the first word of "$ac_tool_prefix$ac_prog", so it can be a program name with args.
-set dummy $ac_tool_prefix$ac_prog; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
-$as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_DUMPBIN+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  if test -n "$DUMPBIN"; then
-  ac_cv_prog_DUMPBIN="$DUMPBIN" # Let the user override the test.
-else
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
-    ac_cv_prog_DUMPBIN="$ac_tool_prefix$ac_prog"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
-  fi
-done
 done
-IFS=$as_save_IFS
-
-fi
-fi
-DUMPBIN=$ac_cv_prog_DUMPBIN
-if test -n "$DUMPBIN"; then
-  { $as_echo "$as_me:$LINENO: result: $DUMPBIN" >&5
-$as_echo "$DUMPBIN" >&6; }
-else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
-$as_echo "no" >&6; }
-fi
+{ ac_configure_args0=; unset ac_configure_args0;}
+{ ac_configure_args1=; unset ac_configure_args1;}
 
+# When interrupted or exit'd, cleanup temporary files, and complete
+# config.log.  We remove comments because anyway the quotes in there
+# would cause problems or look ugly.
+# WARNING: Use '\'' to represent an apostrophe within the trap.
+# WARNING: Do not start the trap code with a newline, due to a FreeBSD 4.0 bug.
+trap 'exit_status=$?
+  # Save into config.log some information that might help in debugging.
+  {
+    echo
 
-    test -n "$DUMPBIN" && break
+    $as_echo "## ---------------- ##
+## Cache variables. ##
+## ---------------- ##"
+    echo
+    # The following way of writing the cache mishandles newlines in values,
+(
+  for ac_var in `(set) 2>&1 | sed -n '\''s/^\([a-zA-Z_][a-zA-Z0-9_]*\)=.*/\1/p'\''`; do
+    eval ac_val=\$$ac_var
+    case $ac_val in #(
+    *${as_nl}*)
+      case $ac_var in #(
+      *_cv_*) { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: cache variable $ac_var contains a newline" >&5
+$as_echo "$as_me: WARNING: cache variable $ac_var contains a newline" >&2;} ;;
+      esac
+      case $ac_var in #(
+      _ | IFS | as_nl) ;; #(
+      BASH_ARGV | BASH_SOURCE) eval $ac_var= ;; #(
+      *) { eval $ac_var=; unset $ac_var;} ;;
+      esac ;;
+    esac
   done
-fi
-if test -z "$DUMPBIN"; then
-  ac_ct_DUMPBIN=$DUMPBIN
-  for ac_prog in "dumpbin -symbols" "link -dump -symbols"
-do
-  # Extract the first word of "$ac_prog", so it can be a program name with args.
-set dummy $ac_prog; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
-$as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_ac_ct_DUMPBIN+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  if test -n "$ac_ct_DUMPBIN"; then
-  ac_cv_prog_ac_ct_DUMPBIN="$ac_ct_DUMPBIN" # Let the user override the test.
-else
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
-    ac_cv_prog_ac_ct_DUMPBIN="$ac_prog"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
-  fi
-done
-done
-IFS=$as_save_IFS
+  (set) 2>&1 |
+    case $as_nl`(ac_space='\'' '\''; set) 2>&1` in #(
+    *${as_nl}ac_space=\ *)
+      sed -n \
+	"s/'\''/'\''\\\\'\'''\''/g;
+	  s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1='\''\\2'\''/p"
+      ;; #(
+    *)
+      sed -n "/^[_$as_cr_alnum]*_cv_[_$as_cr_alnum]*=/p"
+      ;;
+    esac |
+    sort
+)
+    echo
 
-fi
-fi
-ac_ct_DUMPBIN=$ac_cv_prog_ac_ct_DUMPBIN
-if test -n "$ac_ct_DUMPBIN"; then
-  { $as_echo "$as_me:$LINENO: result: $ac_ct_DUMPBIN" >&5
-$as_echo "$ac_ct_DUMPBIN" >&6; }
-else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
-$as_echo "no" >&6; }
-fi
+    $as_echo "## ----------------- ##
+## Output variables. ##
+## ----------------- ##"
+    echo
+    for ac_var in $ac_subst_vars
+    do
+      eval ac_val=\$$ac_var
+      case $ac_val in
+      *\'\''*) ac_val=`$as_echo "$ac_val" | sed "s/'\''/'\''\\\\\\\\'\'''\''/g"`;;
+      esac
+      $as_echo "$ac_var='\''$ac_val'\''"
+    done | sort
+    echo
 
+    if test -n "$ac_subst_files"; then
+      $as_echo "## ------------------- ##
+## File substitutions. ##
+## ------------------- ##"
+      echo
+      for ac_var in $ac_subst_files
+      do
+	eval ac_val=\$$ac_var
+	case $ac_val in
+	*\'\''*) ac_val=`$as_echo "$ac_val" | sed "s/'\''/'\''\\\\\\\\'\'''\''/g"`;;
+	esac
+	$as_echo "$ac_var='\''$ac_val'\''"
+      done | sort
+      echo
+    fi
 
-  test -n "$ac_ct_DUMPBIN" && break
+    if test -s confdefs.h; then
+      $as_echo "## ----------- ##
+## confdefs.h. ##
+## ----------- ##"
+      echo
+      cat confdefs.h
+      echo
+    fi
+    test "$ac_signal" != 0 &&
+      $as_echo "$as_me: caught signal $ac_signal"
+    $as_echo "$as_me: exit $exit_status"
+  } >&5
+  rm -f core *.core core.conftest.* &&
+    rm -f -r conftest* confdefs* conf$$* $ac_clean_files &&
+    exit $exit_status
+' 0
+for ac_signal in 1 2 13 15; do
+  trap 'ac_signal='$ac_signal'; as_fn_exit 1' $ac_signal
 done
+ac_signal=0
 
-  if test "x$ac_ct_DUMPBIN" = x; then
-    DUMPBIN=":"
-  else
-    case $cross_compiling:$ac_tool_warned in
-yes:)
-{ $as_echo "$as_me:$LINENO: WARNING: using cross tools not prefixed with host triplet" >&5
-$as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
-ac_tool_warned=yes ;;
-esac
-    DUMPBIN=$ac_ct_DUMPBIN
-  fi
-fi
-
-
-  if test "$DUMPBIN" != ":"; then
-    NM="$DUMPBIN"
-  fi
-fi
-test -z "$NM" && NM=nm
-
-
-
-
-
-
-{ $as_echo "$as_me:$LINENO: checking the name lister ($NM) interface" >&5
-$as_echo_n "checking the name lister ($NM) interface... " >&6; }
-if test "${lt_cv_nm_interface+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  lt_cv_nm_interface="BSD nm"
-  echo "int some_variable = 0;" > conftest.$ac_ext
-  (eval echo "\"\$as_me:3741: $ac_compile\"" >&5)
-  (eval "$ac_compile" 2>conftest.err)
-  cat conftest.err >&5
-  (eval echo "\"\$as_me:3744: $NM \\\"conftest.$ac_objext\\\"\"" >&5)
-  (eval "$NM \"conftest.$ac_objext\"" 2>conftest.err > conftest.out)
-  cat conftest.err >&5
-  (eval echo "\"\$as_me:3747: output\"" >&5)
-  cat conftest.out >&5
-  if $GREP 'External.*some_variable' conftest.out > /dev/null; then
-    lt_cv_nm_interface="MS dumpbin"
-  fi
-  rm -f conftest*
-fi
-{ $as_echo "$as_me:$LINENO: result: $lt_cv_nm_interface" >&5
-$as_echo "$lt_cv_nm_interface" >&6; }
+# confdefs.h avoids OS command line length limits that DEFS can exceed.
+rm -f -r conftest* confdefs.h
 
-{ $as_echo "$as_me:$LINENO: checking whether ln -s works" >&5
-$as_echo_n "checking whether ln -s works... " >&6; }
-LN_S=$as_ln_s
-if test "$LN_S" = "ln -s"; then
-  { $as_echo "$as_me:$LINENO: result: yes" >&5
-$as_echo "yes" >&6; }
-else
-  { $as_echo "$as_me:$LINENO: result: no, using $LN_S" >&5
-$as_echo "no, using $LN_S" >&6; }
-fi
+$as_echo "/* confdefs.h */" > confdefs.h
 
-# find the maximum length of command line arguments
-{ $as_echo "$as_me:$LINENO: checking the maximum length of command line arguments" >&5
-$as_echo_n "checking the maximum length of command line arguments... " >&6; }
-if test "${lt_cv_sys_max_cmd_len+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-    i=0
-  teststring="ABCD"
+# Predefined preprocessor variables.
 
-  case $build_os in
-  msdosdjgpp*)
-    # On DJGPP, this test can blow up pretty badly due to problems in libc
-    # (any single argument exceeding 2000 bytes causes a buffer overrun
-    # during glob expansion).  Even if it were fixed, the result of this
-    # check would be larger than it should be.
-    lt_cv_sys_max_cmd_len=12288;    # 12K is about right
-    ;;
+cat >>confdefs.h <<_ACEOF
+#define PACKAGE_NAME "$PACKAGE_NAME"
+_ACEOF
 
-  gnu*)
-    # Under GNU Hurd, this test is not required because there is
-    # no limit to the length of command line arguments.
-    # Libtool will interpret -1 as no limit whatsoever
-    lt_cv_sys_max_cmd_len=-1;
-    ;;
+cat >>confdefs.h <<_ACEOF
+#define PACKAGE_TARNAME "$PACKAGE_TARNAME"
+_ACEOF
 
-  cygwin* | mingw* | cegcc*)
-    # On Win9x/ME, this test blows up -- it succeeds, but takes
-    # about 5 minutes as the teststring grows exponentially.
-    # Worse, since 9x/ME are not pre-emptively multitasking,
-    # you end up with a "frozen" computer, even though with patience
-    # the test eventually succeeds (with a max line length of 256k).
-    # Instead, let's just punt: use the minimum linelength reported by
-    # all of the supported platforms: 8192 (on NT/2K/XP).
-    lt_cv_sys_max_cmd_len=8192;
-    ;;
+cat >>confdefs.h <<_ACEOF
+#define PACKAGE_VERSION "$PACKAGE_VERSION"
+_ACEOF
 
-  amigaos*)
-    # On AmigaOS with pdksh, this test takes hours, literally.
-    # So we just punt and use a minimum line length of 8192.
-    lt_cv_sys_max_cmd_len=8192;
-    ;;
+cat >>confdefs.h <<_ACEOF
+#define PACKAGE_STRING "$PACKAGE_STRING"
+_ACEOF
 
-  netbsd* | freebsd* | openbsd* | darwin* | dragonfly*)
-    # This has been around since 386BSD, at least.  Likely further.
-    if test -x /sbin/sysctl; then
-      lt_cv_sys_max_cmd_len=`/sbin/sysctl -n kern.argmax`
-    elif test -x /usr/sbin/sysctl; then
-      lt_cv_sys_max_cmd_len=`/usr/sbin/sysctl -n kern.argmax`
-    else
-      lt_cv_sys_max_cmd_len=65536	# usable default for all BSDs
-    fi
-    # And add a safety zone
-    lt_cv_sys_max_cmd_len=`expr $lt_cv_sys_max_cmd_len \/ 4`
-    lt_cv_sys_max_cmd_len=`expr $lt_cv_sys_max_cmd_len \* 3`
-    ;;
+cat >>confdefs.h <<_ACEOF
+#define PACKAGE_BUGREPORT "$PACKAGE_BUGREPORT"
+_ACEOF
 
-  interix*)
-    # We know the value 262144 and hardcode it with a safety zone (like BSD)
-    lt_cv_sys_max_cmd_len=196608
-    ;;
+cat >>confdefs.h <<_ACEOF
+#define PACKAGE_URL "$PACKAGE_URL"
+_ACEOF
 
-  osf*)
-    # Dr. Hans Ekkehard Plesser reports seeing a kernel panic running configure
-    # due to this test when exec_disable_arg_limit is 1 on Tru64. It is not
-    # nice to cause kernel panics so lets avoid the loop below.
-    # First set a reasonable default.
-    lt_cv_sys_max_cmd_len=16384
-    #
-    if test -x /sbin/sysconfig; then
-      case `/sbin/sysconfig -q proc exec_disable_arg_limit` in
-        *1*) lt_cv_sys_max_cmd_len=-1 ;;
-      esac
-    fi
-    ;;
-  sco3.2v5*)
-    lt_cv_sys_max_cmd_len=102400
-    ;;
-  sysv5* | sco5v6* | sysv4.2uw2*)
-    kargmax=`grep ARG_MAX /etc/conf/cf.d/stune 2>/dev/null`
-    if test -n "$kargmax"; then
-      lt_cv_sys_max_cmd_len=`echo $kargmax | sed 's/.*[	 ]//'`
-    else
-      lt_cv_sys_max_cmd_len=32768
-    fi
-    ;;
-  *)
-    lt_cv_sys_max_cmd_len=`(getconf ARG_MAX) 2> /dev/null`
-    if test -n "$lt_cv_sys_max_cmd_len"; then
-      lt_cv_sys_max_cmd_len=`expr $lt_cv_sys_max_cmd_len \/ 4`
-      lt_cv_sys_max_cmd_len=`expr $lt_cv_sys_max_cmd_len \* 3`
-    else
-      # Make teststring a little bigger before we do anything with it.
-      # a 1K string should be a reasonable start.
-      for i in 1 2 3 4 5 6 7 8 ; do
-        teststring=$teststring$teststring
-      done
-      SHELL=${SHELL-${CONFIG_SHELL-/bin/sh}}
-      # If test is not a shell built-in, we'll probably end up computing a
-      # maximum length that is only half of the actual maximum length, but
-      # we can't tell.
-      while { test "X"`$SHELL $0 --fallback-echo "X$teststring$teststring" 2>/dev/null` \
-	         = "XX$teststring$teststring"; } >/dev/null 2>&1 &&
-	      test $i != 17 # 1/2 MB should be enough
-      do
-        i=`expr $i + 1`
-        teststring=$teststring$teststring
-      done
-      # Only check the string length outside the loop.
-      lt_cv_sys_max_cmd_len=`expr "X$teststring" : ".*" 2>&1`
-      teststring=
-      # Add a significant safety factor because C++ compilers can tack on
-      # massive amounts of additional arguments before passing them to the
-      # linker.  It appears as though 1/2 is a usable value.
-      lt_cv_sys_max_cmd_len=`expr $lt_cv_sys_max_cmd_len \/ 2`
-    fi
-    ;;
-  esac
 
+# Let the site file select an alternate cache file if it wants to.
+# Prefer an explicitly selected file to automatically selected ones.
+ac_site_file1=NONE
+ac_site_file2=NONE
+if test -n "$CONFIG_SITE"; then
+  # We do not want a PATH search for config.site.
+  case $CONFIG_SITE in #((
+    -*)  ac_site_file1=./$CONFIG_SITE;;
+    */*) ac_site_file1=$CONFIG_SITE;;
+    *)   ac_site_file1=./$CONFIG_SITE;;
+  esac
+elif test "x$prefix" != xNONE; then
+  ac_site_file1=$prefix/share/config.site
+  ac_site_file2=$prefix/etc/config.site
+else
+  ac_site_file1=$ac_default_prefix/share/config.site
+  ac_site_file2=$ac_default_prefix/etc/config.site
 fi
+for ac_site_file in "$ac_site_file1" "$ac_site_file2"
+do
+  test "x$ac_site_file" = xNONE && continue
+  if test /dev/null != "$ac_site_file" && test -r "$ac_site_file"; then
+    { $as_echo "$as_me:${as_lineno-$LINENO}: loading site script $ac_site_file" >&5
+$as_echo "$as_me: loading site script $ac_site_file" >&6;}
+    sed 's/^/| /' "$ac_site_file" >&5
+    . "$ac_site_file" \
+      || { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
+$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
+as_fn_error $? "failed to load site script $ac_site_file
+See \`config.log' for more details" "$LINENO" 5; }
+  fi
+done
 
-if test -n $lt_cv_sys_max_cmd_len ; then
-  { $as_echo "$as_me:$LINENO: result: $lt_cv_sys_max_cmd_len" >&5
-$as_echo "$lt_cv_sys_max_cmd_len" >&6; }
+if test -r "$cache_file"; then
+  # Some versions of bash will fail to source /dev/null (special files
+  # actually), so we avoid doing that.  DJGPP emulates it as a regular file.
+  if test /dev/null != "$cache_file" && test -f "$cache_file"; then
+    { $as_echo "$as_me:${as_lineno-$LINENO}: loading cache $cache_file" >&5
+$as_echo "$as_me: loading cache $cache_file" >&6;}
+    case $cache_file in
+      [\\/]* | ?:[\\/]* ) . "$cache_file";;
+      *)                      . "./$cache_file";;
+    esac
+  fi
 else
-  { $as_echo "$as_me:$LINENO: result: none" >&5
-$as_echo "none" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: creating cache $cache_file" >&5
+$as_echo "$as_me: creating cache $cache_file" >&6;}
+  >$cache_file
+fi
+
+# Check that the precious variables saved in the cache have kept the same
+# value.
+ac_cache_corrupted=false
+for ac_var in $ac_precious_vars; do
+  eval ac_old_set=\$ac_cv_env_${ac_var}_set
+  eval ac_new_set=\$ac_env_${ac_var}_set
+  eval ac_old_val=\$ac_cv_env_${ac_var}_value
+  eval ac_new_val=\$ac_env_${ac_var}_value
+  case $ac_old_set,$ac_new_set in
+    set,)
+      { $as_echo "$as_me:${as_lineno-$LINENO}: error: \`$ac_var' was set to \`$ac_old_val' in the previous run" >&5
+$as_echo "$as_me: error: \`$ac_var' was set to \`$ac_old_val' in the previous run" >&2;}
+      ac_cache_corrupted=: ;;
+    ,set)
+      { $as_echo "$as_me:${as_lineno-$LINENO}: error: \`$ac_var' was not set in the previous run" >&5
+$as_echo "$as_me: error: \`$ac_var' was not set in the previous run" >&2;}
+      ac_cache_corrupted=: ;;
+    ,);;
+    *)
+      if test "x$ac_old_val" != "x$ac_new_val"; then
+	# differences in whitespace do not lead to failure.
+	ac_old_val_w=`echo x $ac_old_val`
+	ac_new_val_w=`echo x $ac_new_val`
+	if test "$ac_old_val_w" != "$ac_new_val_w"; then
+	  { $as_echo "$as_me:${as_lineno-$LINENO}: error: \`$ac_var' has changed since the previous run:" >&5
+$as_echo "$as_me: error: \`$ac_var' has changed since the previous run:" >&2;}
+	  ac_cache_corrupted=:
+	else
+	  { $as_echo "$as_me:${as_lineno-$LINENO}: warning: ignoring whitespace changes in \`$ac_var' since the previous run:" >&5
+$as_echo "$as_me: warning: ignoring whitespace changes in \`$ac_var' since the previous run:" >&2;}
+	  eval $ac_var=\$ac_old_val
+	fi
+	{ $as_echo "$as_me:${as_lineno-$LINENO}:   former value:  \`$ac_old_val'" >&5
+$as_echo "$as_me:   former value:  \`$ac_old_val'" >&2;}
+	{ $as_echo "$as_me:${as_lineno-$LINENO}:   current value: \`$ac_new_val'" >&5
+$as_echo "$as_me:   current value: \`$ac_new_val'" >&2;}
+      fi;;
+  esac
+  # Pass precious variables to config.status.
+  if test "$ac_new_set" = set; then
+    case $ac_new_val in
+    *\'*) ac_arg=$ac_var=`$as_echo "$ac_new_val" | sed "s/'/'\\\\\\\\''/g"` ;;
+    *) ac_arg=$ac_var=$ac_new_val ;;
+    esac
+    case " $ac_configure_args " in
+      *" '$ac_arg' "*) ;; # Avoid dups.  Use of quotes ensures accuracy.
+      *) as_fn_append ac_configure_args " '$ac_arg'" ;;
+    esac
+  fi
+done
+if $ac_cache_corrupted; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
+$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
+  { $as_echo "$as_me:${as_lineno-$LINENO}: error: changes in the environment can compromise the build" >&5
+$as_echo "$as_me: error: changes in the environment can compromise the build" >&2;}
+  as_fn_error $? "run \`make distclean' and/or \`rm $cache_file' and start over" "$LINENO" 5
+fi
+## -------------------- ##
+## Main body of script. ##
+## -------------------- ##
+
+ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+
+
+
+ac_aux_dir=
+for ac_dir in . "$srcdir"/.; do
+  if test -f "$ac_dir/install-sh"; then
+    ac_aux_dir=$ac_dir
+    ac_install_sh="$ac_aux_dir/install-sh -c"
+    break
+  elif test -f "$ac_dir/install.sh"; then
+    ac_aux_dir=$ac_dir
+    ac_install_sh="$ac_aux_dir/install.sh -c"
+    break
+  elif test -f "$ac_dir/shtool"; then
+    ac_aux_dir=$ac_dir
+    ac_install_sh="$ac_aux_dir/shtool install -c"
+    break
+  fi
+done
+if test -z "$ac_aux_dir"; then
+  as_fn_error $? "cannot find install-sh, install.sh, or shtool in . \"$srcdir\"/." "$LINENO" 5
 fi
-max_cmd_len=$lt_cv_sys_max_cmd_len
 
+# These three variables are undocumented and unsupported,
+# and are intended to be withdrawn in a future Autoconf release.
+# They can cause serious problems if a builder's source tree is in a directory
+# whose full name contains unusual characters.
+ac_config_guess="$SHELL $ac_aux_dir/config.guess"  # Please don't use this var.
+ac_config_sub="$SHELL $ac_aux_dir/config.sub"  # Please don't use this var.
+ac_configure="$SHELL $ac_aux_dir/configure"  # Please don't use this var.
 
 
 
 
+ac_config_headers="$ac_config_headers include/platform_defs.h"
 
-: ${CP="cp -f"}
-: ${MV="mv -f"}
-: ${RM="rm -f"}
 
-{ $as_echo "$as_me:$LINENO: checking whether the shell understands some XSI constructs" >&5
-$as_echo_n "checking whether the shell understands some XSI constructs... " >&6; }
-# Try some XSI features
-xsi_shell=no
-( _lt_dummy="a/b/c"
-  test "${_lt_dummy##*/},${_lt_dummy%/*},"${_lt_dummy%"$_lt_dummy"}, \
-      = c,a/b,, \
-    && eval 'test $(( 1 + 1 )) -eq 2 \
-    && test "${#_lt_dummy}" -eq 5' ) >/dev/null 2>&1 \
-  && xsi_shell=yes
-{ $as_echo "$as_me:$LINENO: result: $xsi_shell" >&5
-$as_echo "$xsi_shell" >&6; }
 
+# Find a good install program.  We prefer a C program (faster),
+# so one script is as good as another.  But avoid the broken or
+# incompatible versions:
+# SysV /etc/install, /usr/sbin/install
+# SunOS /usr/etc/install
+# IRIX /sbin/install
+# AIX /bin/install
+# AmigaOS /C/install, which installs bootblocks on floppy discs
+# AIX 4 /usr/bin/installbsd, which doesn't work without a -g flag
+# AFS /usr/afsws/bin/install, which mishandles nonexistent args
+# SVR4 /usr/ucb/install, which tries to use the nonexistent group "staff"
+# OS/2's system install, which has a completely different semantic
+# ./install, which can be erroneously created by make from ./install.sh.
+# Reject install programs that cannot install multiple files.
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for a BSD-compatible install" >&5
+$as_echo_n "checking for a BSD-compatible install... " >&6; }
+if test -z "$INSTALL"; then
+if ${ac_cv_path_install+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    # Account for people who put trailing slashes in PATH elements.
+case $as_dir/ in #((
+  ./ | .// | /[cC]/* | \
+  /etc/* | /usr/sbin/* | /usr/etc/* | /sbin/* | /usr/afsws/bin/* | \
+  ?:[\\/]os2[\\/]install[\\/]* | ?:[\\/]OS2[\\/]INSTALL[\\/]* | \
+  /usr/ucb/* ) ;;
+  *)
+    # OSF1 and SCO ODT 3.0 have their own names for install.
+    # Don't use installbsd from OSF since it installs stuff as root
+    # by default.
+    for ac_prog in ginstall scoinst install; do
+      for ac_exec_ext in '' $ac_executable_extensions; do
+	if as_fn_executable_p "$as_dir/$ac_prog$ac_exec_ext"; then
+	  if test $ac_prog = install &&
+	    grep dspmsg "$as_dir/$ac_prog$ac_exec_ext" >/dev/null 2>&1; then
+	    # AIX install.  It has an incompatible calling convention.
+	    :
+	  elif test $ac_prog = install &&
+	    grep pwplus "$as_dir/$ac_prog$ac_exec_ext" >/dev/null 2>&1; then
+	    # program-specific install script used by HP pwplus--don't use.
+	    :
+	  else
+	    rm -rf conftest.one conftest.two conftest.dir
+	    echo one > conftest.one
+	    echo two > conftest.two
+	    mkdir conftest.dir
+	    if "$as_dir/$ac_prog$ac_exec_ext" -c conftest.one conftest.two "`pwd`/conftest.dir" &&
+	      test -s conftest.one && test -s conftest.two &&
+	      test -s conftest.dir/conftest.one &&
+	      test -s conftest.dir/conftest.two
+	    then
+	      ac_cv_path_install="$as_dir/$ac_prog$ac_exec_ext -c"
+	      break 3
+	    fi
+	  fi
+	fi
+      done
+    done
+    ;;
+esac
 
-{ $as_echo "$as_me:$LINENO: checking whether the shell understands \"+=\"" >&5
-$as_echo_n "checking whether the shell understands \"+=\"... " >&6; }
-lt_shell_append=no
-( foo=bar; set foo baz; eval "$1+=\$2" && test "$foo" = barbaz ) \
-    >/dev/null 2>&1 \
-  && lt_shell_append=yes
-{ $as_echo "$as_me:$LINENO: result: $lt_shell_append" >&5
-$as_echo "$lt_shell_append" >&6; }
+  done
+IFS=$as_save_IFS
 
+rm -rf conftest.one conftest.two conftest.dir
 
-if ( (MAIL=60; unset MAIL) || exit) >/dev/null 2>&1; then
-  lt_unset=unset
-else
-  lt_unset=false
 fi
+  if test "${ac_cv_path_install+set}" = set; then
+    INSTALL=$ac_cv_path_install
+  else
+    # As a last resort, use the slow shell script.  Don't cache a
+    # value for INSTALL within a source directory, because that will
+    # break other packages using the cache if that directory is
+    # removed, or if the value is a relative name.
+    INSTALL=$ac_install_sh
+  fi
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $INSTALL" >&5
+$as_echo "$INSTALL" >&6; }
 
+# Use test -z because SunOS4 sh mishandles braces in ${var-val}.
+# It thinks the first close brace ends the variable substitution.
+test -z "$INSTALL_PROGRAM" && INSTALL_PROGRAM='${INSTALL}'
 
+test -z "$INSTALL_SCRIPT" && INSTALL_SCRIPT='${INSTALL}'
 
+test -z "$INSTALL_DATA" && INSTALL_DATA='${INSTALL} -m 644'
 
-
-# test EBCDIC or ASCII
-case `echo X|tr X '\101'` in
- A) # ASCII based system
-    # \n is not interpreted correctly by Solaris 8 /usr/ucb/tr
-  lt_SP2NL='tr \040 \012'
-  lt_NL2SP='tr \015\012 \040\040'
-  ;;
- *) # EBCDIC based system
-  lt_SP2NL='tr \100 \n'
-  lt_NL2SP='tr \r\n \100\100'
-  ;;
+case `pwd` in
+  *\ * | *\	*)
+    { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: Libtool does not cope well with whitespace in \`pwd\`" >&5
+$as_echo "$as_me: WARNING: Libtool does not cope well with whitespace in \`pwd\`" >&2;} ;;
 esac
 
 
 
+macro_version='2.4.2'
+macro_revision='1.3337'
 
 
 
 
 
 
-{ $as_echo "$as_me:$LINENO: checking for $LD option to reload object files" >&5
-$as_echo_n "checking for $LD option to reload object files... " >&6; }
-if test "${lt_cv_ld_reload_flag+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  lt_cv_ld_reload_flag='-r'
-fi
-{ $as_echo "$as_me:$LINENO: result: $lt_cv_ld_reload_flag" >&5
-$as_echo "$lt_cv_ld_reload_flag" >&6; }
-reload_flag=$lt_cv_ld_reload_flag
-case $reload_flag in
-"" | " "*) ;;
-*) reload_flag=" $reload_flag" ;;
-esac
-reload_cmds='$LD$reload_flag -o $output$reload_objs'
-case $host_os in
-  darwin*)
-    if test "$GCC" = yes; then
-      reload_cmds='$LTCC $LTCFLAGS -nostdlib ${wl}-r -o $output$reload_objs'
-    else
-      reload_cmds='$LD$reload_flag -o $output$reload_objs'
-    fi
-    ;;
-esac
 
 
 
@@ -3989,643 +2763,1008 @@ esac
 
 
 
+ltmain="$ac_aux_dir/ltmain.sh"
 
+# Make sure we can run config.sub.
+$SHELL "$ac_aux_dir/config.sub" sun4 >/dev/null 2>&1 ||
+  as_fn_error $? "cannot run $SHELL $ac_aux_dir/config.sub" "$LINENO" 5
 
-if test -n "$ac_tool_prefix"; then
-  # Extract the first word of "${ac_tool_prefix}objdump", so it can be a program name with args.
-set dummy ${ac_tool_prefix}objdump; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
-$as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_OBJDUMP+set}" = set; then
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking build system type" >&5
+$as_echo_n "checking build system type... " >&6; }
+if ${ac_cv_build+:} false; then :
   $as_echo_n "(cached) " >&6
 else
-  if test -n "$OBJDUMP"; then
-  ac_cv_prog_OBJDUMP="$OBJDUMP" # Let the user override the test.
-else
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
-    ac_cv_prog_OBJDUMP="${ac_tool_prefix}objdump"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
-  fi
-done
-done
-IFS=$as_save_IFS
+  ac_build_alias=$build_alias
+test "x$ac_build_alias" = x &&
+  ac_build_alias=`$SHELL "$ac_aux_dir/config.guess"`
+test "x$ac_build_alias" = x &&
+  as_fn_error $? "cannot guess build type; you must specify one" "$LINENO" 5
+ac_cv_build=`$SHELL "$ac_aux_dir/config.sub" $ac_build_alias` ||
+  as_fn_error $? "$SHELL $ac_aux_dir/config.sub $ac_build_alias failed" "$LINENO" 5
 
 fi
-fi
-OBJDUMP=$ac_cv_prog_OBJDUMP
-if test -n "$OBJDUMP"; then
-  { $as_echo "$as_me:$LINENO: result: $OBJDUMP" >&5
-$as_echo "$OBJDUMP" >&6; }
-else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
-$as_echo "no" >&6; }
-fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_build" >&5
+$as_echo "$ac_cv_build" >&6; }
+case $ac_cv_build in
+*-*-*) ;;
+*) as_fn_error $? "invalid value of canonical build" "$LINENO" 5;;
+esac
+build=$ac_cv_build
+ac_save_IFS=$IFS; IFS='-'
+set x $ac_cv_build
+shift
+build_cpu=$1
+build_vendor=$2
+shift; shift
+# Remember, the first character of IFS is used to create $*,
+# except with old shells:
+build_os=$*
+IFS=$ac_save_IFS
+case $build_os in *\ *) build_os=`echo "$build_os" | sed 's/ /-/g'`;; esac
 
 
-fi
-if test -z "$ac_cv_prog_OBJDUMP"; then
-  ac_ct_OBJDUMP=$OBJDUMP
-  # Extract the first word of "objdump", so it can be a program name with args.
-set dummy objdump; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
-$as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_ac_ct_OBJDUMP+set}" = set; then
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking host system type" >&5
+$as_echo_n "checking host system type... " >&6; }
+if ${ac_cv_host+:} false; then :
   $as_echo_n "(cached) " >&6
 else
-  if test -n "$ac_ct_OBJDUMP"; then
-  ac_cv_prog_ac_ct_OBJDUMP="$ac_ct_OBJDUMP" # Let the user override the test.
-else
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
-    ac_cv_prog_ac_ct_OBJDUMP="objdump"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
-  fi
-done
-done
-IFS=$as_save_IFS
-
-fi
-fi
-ac_ct_OBJDUMP=$ac_cv_prog_ac_ct_OBJDUMP
-if test -n "$ac_ct_OBJDUMP"; then
-  { $as_echo "$as_me:$LINENO: result: $ac_ct_OBJDUMP" >&5
-$as_echo "$ac_ct_OBJDUMP" >&6; }
+  if test "x$host_alias" = x; then
+  ac_cv_host=$ac_cv_build
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
-$as_echo "no" >&6; }
+  ac_cv_host=`$SHELL "$ac_aux_dir/config.sub" $host_alias` ||
+    as_fn_error $? "$SHELL $ac_aux_dir/config.sub $host_alias failed" "$LINENO" 5
 fi
 
-  if test "x$ac_ct_OBJDUMP" = x; then
-    OBJDUMP="false"
-  else
-    case $cross_compiling:$ac_tool_warned in
-yes:)
-{ $as_echo "$as_me:$LINENO: WARNING: using cross tools not prefixed with host triplet" >&5
-$as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
-ac_tool_warned=yes ;;
-esac
-    OBJDUMP=$ac_ct_OBJDUMP
-  fi
-else
-  OBJDUMP="$ac_cv_prog_OBJDUMP"
 fi
-
-test -z "$OBJDUMP" && OBJDUMP=objdump
-
-
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_host" >&5
+$as_echo "$ac_cv_host" >&6; }
+case $ac_cv_host in
+*-*-*) ;;
+*) as_fn_error $? "invalid value of canonical host" "$LINENO" 5;;
+esac
+host=$ac_cv_host
+ac_save_IFS=$IFS; IFS='-'
+set x $ac_cv_host
+shift
+host_cpu=$1
+host_vendor=$2
+shift; shift
+# Remember, the first character of IFS is used to create $*,
+# except with old shells:
+host_os=$*
+IFS=$ac_save_IFS
+case $host_os in *\ *) host_os=`echo "$host_os" | sed 's/ /-/g'`;; esac
 
 
+# Backslashify metacharacters that are still active within
+# double-quoted strings.
+sed_quote_subst='s/\(["`$\\]\)/\\\1/g'
 
+# Same as above, but do not quote variable references.
+double_quote_subst='s/\(["`\\]\)/\\\1/g'
 
+# Sed substitution to delay expansion of an escaped shell variable in a
+# double_quote_subst'ed string.
+delay_variable_subst='s/\\\\\\\\\\\$/\\\\\\$/g'
 
+# Sed substitution to delay expansion of an escaped single quote.
+delay_single_quote_subst='s/'\''/'\'\\\\\\\'\''/g'
 
+# Sed substitution to avoid accidental globbing in evaled expressions
+no_glob_subst='s/\*/\\\*/g'
 
-{ $as_echo "$as_me:$LINENO: checking how to recognize dependent libraries" >&5
-$as_echo_n "checking how to recognize dependent libraries... " >&6; }
-if test "${lt_cv_deplibs_check_method+set}" = set; then
-  $as_echo_n "(cached) " >&6
+ECHO='\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\'
+ECHO=$ECHO$ECHO$ECHO$ECHO$ECHO
+ECHO=$ECHO$ECHO$ECHO$ECHO$ECHO$ECHO
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking how to print strings" >&5
+$as_echo_n "checking how to print strings... " >&6; }
+# Test print first, because it will be a builtin if present.
+if test "X`( print -r -- -n ) 2>/dev/null`" = X-n && \
+   test "X`print -r -- $ECHO 2>/dev/null`" = "X$ECHO"; then
+  ECHO='print -r --'
+elif test "X`printf %s $ECHO 2>/dev/null`" = "X$ECHO"; then
+  ECHO='printf %s\n'
 else
-  lt_cv_file_magic_cmd='$MAGIC_CMD'
-lt_cv_file_magic_test_file=
-lt_cv_deplibs_check_method='unknown'
-# Need to set the preceding variable on all platforms that support
-# interlibrary dependencies.
-# 'none' -- dependencies not supported.
-# `unknown' -- same as none, but documents that we really don't know.
-# 'pass_all' -- all dependencies passed with no checks.
-# 'test_compile' -- check by making test program.
-# 'file_magic [[regex]]' -- check by looking for files in library path
-# which responds to the $file_magic_cmd with a given extended regex.
-# If you have `file' or equivalent on your system and you're not sure
-# whether `pass_all' will *always* work, you probably want this one.
-
-case $host_os in
-aix[4-9]*)
-  lt_cv_deplibs_check_method=pass_all
-  ;;
-
-beos*)
-  lt_cv_deplibs_check_method=pass_all
-  ;;
-
-bsdi[45]*)
-  lt_cv_deplibs_check_method='file_magic ELF [0-9][0-9]*-bit [ML]SB (shared object|dynamic lib)'
-  lt_cv_file_magic_cmd='/usr/bin/file -L'
-  lt_cv_file_magic_test_file=/shlib/libc.so
-  ;;
-
-cygwin*)
-  # func_win32_libid is a shell function defined in ltmain.sh
-  lt_cv_deplibs_check_method='file_magic ^x86 archive import|^x86 DLL'
-  lt_cv_file_magic_cmd='func_win32_libid'
-  ;;
-
-mingw* | pw32*)
-  # Base MSYS/MinGW do not provide the 'file' command needed by
-  # func_win32_libid shell function, so use a weaker test based on 'objdump',
-  # unless we find 'file', for example because we are cross-compiling.
-  if ( file / ) >/dev/null 2>&1; then
-    lt_cv_deplibs_check_method='file_magic ^x86 archive import|^x86 DLL'
-    lt_cv_file_magic_cmd='func_win32_libid'
-  else
-    lt_cv_deplibs_check_method='file_magic file format pei*-i386(.*architecture: i386)?'
-    lt_cv_file_magic_cmd='$OBJDUMP -f'
-  fi
-  ;;
-
-cegcc)
-  # use the weaker test based on 'objdump'. See mingw*.
-  lt_cv_deplibs_check_method='file_magic file format pe-arm-.*little(.*architecture: arm)?'
-  lt_cv_file_magic_cmd='$OBJDUMP -f'
-  ;;
-
-darwin* | rhapsody*)
-  lt_cv_deplibs_check_method=pass_all
-  ;;
-
-freebsd* | dragonfly*)
-  if echo __ELF__ | $CC -E - | $GREP __ELF__ > /dev/null; then
-    case $host_cpu in
-    i*86 )
-      # Not sure whether the presence of OpenBSD here was a mistake.
-      # Let's accept both of them until this is cleared up.
-      lt_cv_deplibs_check_method='file_magic (FreeBSD|OpenBSD|DragonFly)/i[3-9]86 (compact )?demand paged shared library'
-      lt_cv_file_magic_cmd=/usr/bin/file
-      lt_cv_file_magic_test_file=`echo /usr/lib/libc.so.*`
-      ;;
-    esac
-  else
-    lt_cv_deplibs_check_method=pass_all
-  fi
-  ;;
+  # Use this function as a fallback that always works.
+  func_fallback_echo ()
+  {
+    eval 'cat <<_LTECHO_EOF
+$1
+_LTECHO_EOF'
+  }
+  ECHO='func_fallback_echo'
+fi
 
-gnu*)
-  lt_cv_deplibs_check_method=pass_all
-  ;;
+# func_echo_all arg...
+# Invoke $ECHO with all args, space-separated.
+func_echo_all ()
+{
+    $ECHO ""
+}
 
-hpux10.20* | hpux11*)
-  lt_cv_file_magic_cmd=/usr/bin/file
-  case $host_cpu in
-  ia64*)
-    lt_cv_deplibs_check_method='file_magic (s[0-9][0-9][0-9]|ELF-[0-9][0-9]) shared object file - IA64'
-    lt_cv_file_magic_test_file=/usr/lib/hpux32/libc.so
-    ;;
-  hppa*64*)
-    lt_cv_deplibs_check_method='file_magic (s[0-9][0-9][0-9]|ELF-[0-9][0-9]) shared object file - PA-RISC [0-9].[0-9]'
-    lt_cv_file_magic_test_file=/usr/lib/pa20_64/libc.sl
-    ;;
-  *)
-    lt_cv_deplibs_check_method='file_magic (s[0-9][0-9][0-9]|PA-RISC[0-9].[0-9]) shared library'
-    lt_cv_file_magic_test_file=/usr/lib/libc.sl
-    ;;
-  esac
-  ;;
+case "$ECHO" in
+  printf*) { $as_echo "$as_me:${as_lineno-$LINENO}: result: printf" >&5
+$as_echo "printf" >&6; } ;;
+  print*) { $as_echo "$as_me:${as_lineno-$LINENO}: result: print -r" >&5
+$as_echo "print -r" >&6; } ;;
+  *) { $as_echo "$as_me:${as_lineno-$LINENO}: result: cat" >&5
+$as_echo "cat" >&6; } ;;
+esac
 
-interix[3-9]*)
-  # PIC code is broken on Interix 3.x, that's why |\.a not |_pic\.a here
-  lt_cv_deplibs_check_method='match_pattern /lib[^/]+(\.so|\.a)$'
-  ;;
 
-irix5* | irix6* | nonstopux*)
-  case $LD in
-  *-32|*"-32 ") libmagic=32-bit;;
-  *-n32|*"-n32 ") libmagic=N32;;
-  *-64|*"-64 ") libmagic=64-bit;;
-  *) libmagic=never-match;;
-  esac
-  lt_cv_deplibs_check_method=pass_all
-  ;;
 
-# This must be Linux ELF.
-linux* | k*bsd*-gnu)
-  lt_cv_deplibs_check_method=pass_all
-  ;;
 
-netbsd*)
-  if echo __ELF__ | $CC -E - | $GREP __ELF__ > /dev/null; then
-    lt_cv_deplibs_check_method='match_pattern /lib[^/]+(\.so\.[0-9]+\.[0-9]+|_pic\.a)$'
-  else
-    lt_cv_deplibs_check_method='match_pattern /lib[^/]+(\.so|_pic\.a)$'
-  fi
-  ;;
 
-newos6*)
-  lt_cv_deplibs_check_method='file_magic ELF [0-9][0-9]*-bit [ML]SB (executable|dynamic lib)'
-  lt_cv_file_magic_cmd=/usr/bin/file
-  lt_cv_file_magic_test_file=/usr/lib/libnls.so
-  ;;
 
-*nto* | *qnx*)
-  lt_cv_deplibs_check_method=pass_all
-  ;;
 
-openbsd*)
-  if test -z "`echo __ELF__ | $CC -E - | $GREP __ELF__`" || test "$host_os-$host_cpu" = "openbsd2.8-powerpc"; then
-    lt_cv_deplibs_check_method='match_pattern /lib[^/]+(\.so\.[0-9]+\.[0-9]+|\.so|_pic\.a)$'
-  else
-    lt_cv_deplibs_check_method='match_pattern /lib[^/]+(\.so\.[0-9]+\.[0-9]+|_pic\.a)$'
-  fi
-  ;;
 
-osf3* | osf4* | osf5*)
-  lt_cv_deplibs_check_method=pass_all
-  ;;
 
-rdos*)
-  lt_cv_deplibs_check_method=pass_all
-  ;;
 
-solaris*)
-  lt_cv_deplibs_check_method=pass_all
-  ;;
 
-sysv5* | sco3.2v5* | sco5v6* | unixware* | OpenUNIX* | sysv4*uw2*)
-  lt_cv_deplibs_check_method=pass_all
-  ;;
 
-sysv4 | sysv4.3*)
-  case $host_vendor in
-  motorola)
-    lt_cv_deplibs_check_method='file_magic ELF [0-9][0-9]*-bit [ML]SB (shared object|dynamic lib) M[0-9][0-9]* Version [0-9]'
-    lt_cv_file_magic_test_file=`echo /usr/lib/libc.so*`
-    ;;
-  ncr)
-    lt_cv_deplibs_check_method=pass_all
-    ;;
-  sequent)
-    lt_cv_file_magic_cmd='/bin/file'
-    lt_cv_deplibs_check_method='file_magic ELF [0-9][0-9]*-bit [LM]SB (shared object|dynamic lib )'
-    ;;
-  sni)
-    lt_cv_file_magic_cmd='/bin/file'
-    lt_cv_deplibs_check_method="file_magic ELF [0-9][0-9]*-bit [LM]SB dynamic lib"
-    lt_cv_file_magic_test_file=/lib/libc.so
-    ;;
-  siemens)
-    lt_cv_deplibs_check_method=pass_all
-    ;;
-  pc)
-    lt_cv_deplibs_check_method=pass_all
-    ;;
-  esac
-  ;;
 
-tpf*)
-  lt_cv_deplibs_check_method=pass_all
-  ;;
-esac
 
-fi
-{ $as_echo "$as_me:$LINENO: result: $lt_cv_deplibs_check_method" >&5
-$as_echo "$lt_cv_deplibs_check_method" >&6; }
-file_magic_cmd=$lt_cv_file_magic_cmd
-deplibs_check_method=$lt_cv_deplibs_check_method
-test -z "$deplibs_check_method" && deplibs_check_method=unknown
+ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+if test -n "$ac_tool_prefix"; then
+  # Extract the first word of "${ac_tool_prefix}gcc", so it can be a program name with args.
+set dummy ${ac_tool_prefix}gcc; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_CC+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if test -n "$CC"; then
+  ac_cv_prog_CC="$CC" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_CC="${ac_tool_prefix}gcc"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
 
+fi
+fi
+CC=$ac_cv_prog_CC
+if test -n "$CC"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $CC" >&5
+$as_echo "$CC" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
 
 
+fi
+if test -z "$ac_cv_prog_CC"; then
+  ac_ct_CC=$CC
+  # Extract the first word of "gcc", so it can be a program name with args.
+set dummy gcc; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_ac_ct_CC+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if test -n "$ac_ct_CC"; then
+  ac_cv_prog_ac_ct_CC="$ac_ct_CC" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_ac_ct_CC="gcc"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
 
+fi
+fi
+ac_ct_CC=$ac_cv_prog_ac_ct_CC
+if test -n "$ac_ct_CC"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_CC" >&5
+$as_echo "$ac_ct_CC" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
 
+  if test "x$ac_ct_CC" = x; then
+    CC=""
+  else
+    case $cross_compiling:$ac_tool_warned in
+yes:)
+{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
+$as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
+ac_tool_warned=yes ;;
+esac
+    CC=$ac_ct_CC
+  fi
+else
+  CC="$ac_cv_prog_CC"
+fi
 
+if test -z "$CC"; then
+          if test -n "$ac_tool_prefix"; then
+    # Extract the first word of "${ac_tool_prefix}cc", so it can be a program name with args.
+set dummy ${ac_tool_prefix}cc; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_CC+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if test -n "$CC"; then
+  ac_cv_prog_CC="$CC" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_CC="${ac_tool_prefix}cc"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
 
+fi
+fi
+CC=$ac_cv_prog_CC
+if test -n "$CC"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $CC" >&5
+$as_echo "$CC" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
 
 
+  fi
+fi
+if test -z "$CC"; then
+  # Extract the first word of "cc", so it can be a program name with args.
+set dummy cc; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_CC+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if test -n "$CC"; then
+  ac_cv_prog_CC="$CC" # Let the user override the test.
+else
+  ac_prog_rejected=no
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    if test "$as_dir/$ac_word$ac_exec_ext" = "/usr/ucb/cc"; then
+       ac_prog_rejected=yes
+       continue
+     fi
+    ac_cv_prog_CC="cc"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
 
+if test $ac_prog_rejected = yes; then
+  # We found a bogon in the path, so make sure we never use it.
+  set dummy $ac_cv_prog_CC
+  shift
+  if test $# != 0; then
+    # We chose a different compiler from the bogus one.
+    # However, it has the same basename, so the bogon will be chosen
+    # first if we set CC to just the basename; use the full file name.
+    shift
+    ac_cv_prog_CC="$as_dir/$ac_word${1+' '}$@"
+  fi
+fi
+fi
+fi
+CC=$ac_cv_prog_CC
+if test -n "$CC"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $CC" >&5
+$as_echo "$CC" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
 
 
-if test -n "$ac_tool_prefix"; then
-  # Extract the first word of "${ac_tool_prefix}ar", so it can be a program name with args.
-set dummy ${ac_tool_prefix}ar; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+fi
+if test -z "$CC"; then
+  if test -n "$ac_tool_prefix"; then
+  for ac_prog in cl.exe
+  do
+    # Extract the first word of "$ac_tool_prefix$ac_prog", so it can be a program name with args.
+set dummy $ac_tool_prefix$ac_prog; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_AR+set}" = set; then
+if ${ac_cv_prog_CC+:} false; then :
   $as_echo_n "(cached) " >&6
 else
-  if test -n "$AR"; then
-  ac_cv_prog_AR="$AR" # Let the user override the test.
+  if test -n "$CC"; then
+  ac_cv_prog_CC="$CC" # Let the user override the test.
 else
 as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
 for as_dir in $PATH
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
-    ac_cv_prog_AR="${ac_tool_prefix}ar"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_CC="$ac_tool_prefix$ac_prog"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
-AR=$ac_cv_prog_AR
-if test -n "$AR"; then
-  { $as_echo "$as_me:$LINENO: result: $AR" >&5
-$as_echo "$AR" >&6; }
+CC=$ac_cv_prog_CC
+if test -n "$CC"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $CC" >&5
+$as_echo "$CC" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
 
+    test -n "$CC" && break
+  done
 fi
-if test -z "$ac_cv_prog_AR"; then
-  ac_ct_AR=$AR
-  # Extract the first word of "ar", so it can be a program name with args.
-set dummy ar; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+if test -z "$CC"; then
+  ac_ct_CC=$CC
+  for ac_prog in cl.exe
+do
+  # Extract the first word of "$ac_prog", so it can be a program name with args.
+set dummy $ac_prog; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_ac_ct_AR+set}" = set; then
+if ${ac_cv_prog_ac_ct_CC+:} false; then :
   $as_echo_n "(cached) " >&6
 else
-  if test -n "$ac_ct_AR"; then
-  ac_cv_prog_ac_ct_AR="$ac_ct_AR" # Let the user override the test.
+  if test -n "$ac_ct_CC"; then
+  ac_cv_prog_ac_ct_CC="$ac_ct_CC" # Let the user override the test.
 else
 as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
 for as_dir in $PATH
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
-    ac_cv_prog_ac_ct_AR="ar"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_ac_ct_CC="$ac_prog"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
-ac_ct_AR=$ac_cv_prog_ac_ct_AR
-if test -n "$ac_ct_AR"; then
-  { $as_echo "$as_me:$LINENO: result: $ac_ct_AR" >&5
-$as_echo "$ac_ct_AR" >&6; }
+ac_ct_CC=$ac_cv_prog_ac_ct_CC
+if test -n "$ac_ct_CC"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_CC" >&5
+$as_echo "$ac_ct_CC" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
-  if test "x$ac_ct_AR" = x; then
-    AR="false"
+
+  test -n "$ac_ct_CC" && break
+done
+
+  if test "x$ac_ct_CC" = x; then
+    CC=""
   else
     case $cross_compiling:$ac_tool_warned in
 yes:)
-{ $as_echo "$as_me:$LINENO: WARNING: using cross tools not prefixed with host triplet" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
 $as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
 ac_tool_warned=yes ;;
 esac
-    AR=$ac_ct_AR
+    CC=$ac_ct_CC
   fi
-else
-  AR="$ac_cv_prog_AR"
 fi
 
-test -z "$AR" && AR=ar
-test -z "$AR_FLAGS" && AR_FLAGS=cru
+fi
 
 
+test -z "$CC" && { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
+$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
+as_fn_error $? "no acceptable C compiler found in \$PATH
+See \`config.log' for more details" "$LINENO" 5; }
 
+# Provide some information about the compiler.
+$as_echo "$as_me:${as_lineno-$LINENO}: checking for C compiler version" >&5
+set X $ac_compile
+ac_compiler=$2
+for ac_option in --version -v -V -qversion; do
+  { { ac_try="$ac_compiler $ac_option >&5"
+case "(($ac_try" in
+  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_compiler $ac_option >&5") 2>conftest.err
+  ac_status=$?
+  if test -s conftest.err; then
+    sed '10a\
+... rest of stderr output deleted ...
+         10q' conftest.err >conftest.er1
+    cat conftest.er1 >&5
+  fi
+  rm -f conftest.er1 conftest.err
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+done
 
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
 
+int
+main ()
+{
 
+  ;
+  return 0;
+}
+_ACEOF
+ac_clean_files_save=$ac_clean_files
+ac_clean_files="$ac_clean_files a.out a.out.dSYM a.exe b.out"
+# Try to create an executable without -o first, disregard a.out.
+# It will help us diagnose broken compilers, and finding out an intuition
+# of exeext.
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether the C compiler works" >&5
+$as_echo_n "checking whether the C compiler works... " >&6; }
+ac_link_default=`$as_echo "$ac_link" | sed 's/ -o *conftest[^ ]*//'`
 
+# The possible output files:
+ac_files="a.out conftest.exe conftest a.exe a_out.exe b.out conftest.*"
 
+ac_rmfiles=
+for ac_file in $ac_files
+do
+  case $ac_file in
+    *.$ac_ext | *.xcoff | *.tds | *.d | *.pdb | *.xSYM | *.bb | *.bbg | *.map | *.inf | *.dSYM | *.o | *.obj ) ;;
+    * ) ac_rmfiles="$ac_rmfiles $ac_file";;
+  esac
+done
+rm -f $ac_rmfiles
 
+if { { ac_try="$ac_link_default"
+case "(($ac_try" in
+  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_link_default") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then :
+  # Autoconf-2.13 could set the ac_cv_exeext variable to `no'.
+# So ignore a value of `no', otherwise this would lead to `EXEEXT = no'
+# in a Makefile.  We should not override ac_cv_exeext if it was cached,
+# so that the user can short-circuit this test for compilers unknown to
+# Autoconf.
+for ac_file in $ac_files ''
+do
+  test -f "$ac_file" || continue
+  case $ac_file in
+    *.$ac_ext | *.xcoff | *.tds | *.d | *.pdb | *.xSYM | *.bb | *.bbg | *.map | *.inf | *.dSYM | *.o | *.obj )
+	;;
+    [ab].out )
+	# We found the default executable, but exeext='' is most
+	# certainly right.
+	break;;
+    *.* )
+	if test "${ac_cv_exeext+set}" = set && test "$ac_cv_exeext" != no;
+	then :; else
+	   ac_cv_exeext=`expr "$ac_file" : '[^.]*\(\..*\)'`
+	fi
+	# We set ac_cv_exeext here because the later test for it is not
+	# safe: cross compilers may not add the suffix if given an `-o'
+	# argument, so we may need to know it at that point already.
+	# Even if this section looks crufty: it has the advantage of
+	# actually working.
+	break;;
+    * )
+	break;;
+  esac
+done
+test "$ac_cv_exeext" = no && ac_cv_exeext=
 
+else
+  ac_file=''
+fi
+if test -z "$ac_file"; then :
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+$as_echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
 
-if test -n "$ac_tool_prefix"; then
-  # Extract the first word of "${ac_tool_prefix}strip", so it can be a program name with args.
-set dummy ${ac_tool_prefix}strip; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
-$as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_STRIP+set}" = set; then
-  $as_echo_n "(cached) " >&6
+{ { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
+$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
+as_fn_error 77 "C compiler cannot create executables
+See \`config.log' for more details" "$LINENO" 5; }
 else
-  if test -n "$STRIP"; then
-  ac_cv_prog_STRIP="$STRIP" # Let the user override the test.
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for C compiler default output file name" >&5
+$as_echo_n "checking for C compiler default output file name... " >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_file" >&5
+$as_echo "$ac_file" >&6; }
+ac_exeext=$ac_cv_exeext
+
+rm -f -r a.out a.out.dSYM a.exe conftest$ac_cv_exeext b.out
+ac_clean_files=$ac_clean_files_save
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for suffix of executables" >&5
+$as_echo_n "checking for suffix of executables... " >&6; }
+if { { ac_try="$ac_link"
+case "(($ac_try" in
+  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_link") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then :
+  # If both `conftest.exe' and `conftest' are `present' (well, observable)
+# catch `conftest.exe'.  For instance with Cygwin, `ls conftest' will
+# work properly (i.e., refer to `conftest.exe'), while it won't with
+# `rm'.
+for ac_file in conftest.exe conftest conftest.*; do
+  test -f "$ac_file" || continue
+  case $ac_file in
+    *.$ac_ext | *.xcoff | *.tds | *.d | *.pdb | *.xSYM | *.bb | *.bbg | *.map | *.inf | *.dSYM | *.o | *.obj ) ;;
+    *.* ) ac_cv_exeext=`expr "$ac_file" : '[^.]*\(\..*\)'`
+	  break;;
+    * ) break;;
+  esac
+done
 else
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
-    ac_cv_prog_STRIP="${ac_tool_prefix}strip"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
+  { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
+$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
+as_fn_error $? "cannot compute suffix of executables: cannot compile and link
+See \`config.log' for more details" "$LINENO" 5; }
+fi
+rm -f conftest conftest$ac_cv_exeext
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_exeext" >&5
+$as_echo "$ac_cv_exeext" >&6; }
+
+rm -f conftest.$ac_ext
+EXEEXT=$ac_cv_exeext
+ac_exeext=$EXEEXT
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <stdio.h>
+int
+main ()
+{
+FILE *f = fopen ("conftest.out", "w");
+ return ferror (f) || fclose (f) != 0;
+
+  ;
+  return 0;
+}
+_ACEOF
+ac_clean_files="$ac_clean_files conftest.out"
+# Check that the compiler produces executables we can run.  If not, either
+# the compiler is broken, or we cross compile.
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether we are cross compiling" >&5
+$as_echo_n "checking whether we are cross compiling... " >&6; }
+if test "$cross_compiling" != yes; then
+  { { ac_try="$ac_link"
+case "(($ac_try" in
+  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_link") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+  if { ac_try='./conftest$ac_cv_exeext'
+  { { case "(($ac_try" in
+  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_try") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; }; then
+    cross_compiling=no
+  else
+    if test "$cross_compiling" = maybe; then
+	cross_compiling=yes
+    else
+	{ { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
+$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
+as_fn_error $? "cannot run C compiled programs.
+If you meant to cross compile, use \`--host'.
+See \`config.log' for more details" "$LINENO" 5; }
+    fi
   fi
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $cross_compiling" >&5
+$as_echo "$cross_compiling" >&6; }
+
+rm -f conftest.$ac_ext conftest$ac_cv_exeext conftest.out
+ac_clean_files=$ac_clean_files_save
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for suffix of object files" >&5
+$as_echo_n "checking for suffix of object files... " >&6; }
+if ${ac_cv_objext+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+int
+main ()
+{
+
+  ;
+  return 0;
+}
+_ACEOF
+rm -f conftest.o conftest.obj
+if { { ac_try="$ac_compile"
+case "(($ac_try" in
+  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_compile") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then :
+  for ac_file in conftest.o conftest.obj conftest.*; do
+  test -f "$ac_file" || continue;
+  case $ac_file in
+    *.$ac_ext | *.xcoff | *.tds | *.d | *.pdb | *.xSYM | *.bb | *.bbg | *.map | *.inf | *.dSYM ) ;;
+    *) ac_cv_objext=`expr "$ac_file" : '.*\.\(.*\)'`
+       break;;
+  esac
 done
-done
-IFS=$as_save_IFS
+else
+  $as_echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
 
+{ { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
+$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
+as_fn_error $? "cannot compute suffix of object files: cannot compile
+See \`config.log' for more details" "$LINENO" 5; }
 fi
+rm -f conftest.$ac_cv_objext conftest.$ac_ext
 fi
-STRIP=$ac_cv_prog_STRIP
-if test -n "$STRIP"; then
-  { $as_echo "$as_me:$LINENO: result: $STRIP" >&5
-$as_echo "$STRIP" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_objext" >&5
+$as_echo "$ac_cv_objext" >&6; }
+OBJEXT=$ac_cv_objext
+ac_objext=$OBJEXT
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether we are using the GNU C compiler" >&5
+$as_echo_n "checking whether we are using the GNU C compiler... " >&6; }
+if ${ac_cv_c_compiler_gnu+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
-$as_echo "no" >&6; }
-fi
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
 
+int
+main ()
+{
+#ifndef __GNUC__
+       choke me
+#endif
 
-fi
-if test -z "$ac_cv_prog_STRIP"; then
-  ac_ct_STRIP=$STRIP
-  # Extract the first word of "strip", so it can be a program name with args.
-set dummy strip; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
-$as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_ac_ct_STRIP+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  if test -n "$ac_ct_STRIP"; then
-  ac_cv_prog_ac_ct_STRIP="$ac_ct_STRIP" # Let the user override the test.
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ac_compiler_gnu=yes
 else
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
-    ac_cv_prog_ac_ct_STRIP="strip"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
-  fi
-done
-done
-IFS=$as_save_IFS
-
+  ac_compiler_gnu=no
 fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+ac_cv_c_compiler_gnu=$ac_compiler_gnu
+
 fi
-ac_ct_STRIP=$ac_cv_prog_ac_ct_STRIP
-if test -n "$ac_ct_STRIP"; then
-  { $as_echo "$as_me:$LINENO: result: $ac_ct_STRIP" >&5
-$as_echo "$ac_ct_STRIP" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_c_compiler_gnu" >&5
+$as_echo "$ac_cv_c_compiler_gnu" >&6; }
+if test $ac_compiler_gnu = yes; then
+  GCC=yes
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
-$as_echo "no" >&6; }
+  GCC=
 fi
-
-  if test "x$ac_ct_STRIP" = x; then
-    STRIP=":"
-  else
-    case $cross_compiling:$ac_tool_warned in
-yes:)
-{ $as_echo "$as_me:$LINENO: WARNING: using cross tools not prefixed with host triplet" >&5
-$as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
-ac_tool_warned=yes ;;
-esac
-    STRIP=$ac_ct_STRIP
-  fi
+ac_test_CFLAGS=${CFLAGS+set}
+ac_save_CFLAGS=$CFLAGS
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether $CC accepts -g" >&5
+$as_echo_n "checking whether $CC accepts -g... " >&6; }
+if ${ac_cv_prog_cc_g+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
-  STRIP="$ac_cv_prog_STRIP"
-fi
+  ac_save_c_werror_flag=$ac_c_werror_flag
+   ac_c_werror_flag=yes
+   ac_cv_prog_cc_g=no
+   CFLAGS="-g"
+   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
 
-test -z "$STRIP" && STRIP=:
+int
+main ()
+{
 
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ac_cv_prog_cc_g=yes
+else
+  CFLAGS=""
+      cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
 
+int
+main ()
+{
 
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
 
+else
+  ac_c_werror_flag=$ac_save_c_werror_flag
+	 CFLAGS="-g"
+	 cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
 
+int
+main ()
+{
 
-if test -n "$ac_tool_prefix"; then
-  # Extract the first word of "${ac_tool_prefix}ranlib", so it can be a program name with args.
-set dummy ${ac_tool_prefix}ranlib; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
-$as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_RANLIB+set}" = set; then
-  $as_echo_n "(cached) " >&6
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ac_cv_prog_cc_g=yes
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+   ac_c_werror_flag=$ac_save_c_werror_flag
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_prog_cc_g" >&5
+$as_echo "$ac_cv_prog_cc_g" >&6; }
+if test "$ac_test_CFLAGS" = set; then
+  CFLAGS=$ac_save_CFLAGS
+elif test $ac_cv_prog_cc_g = yes; then
+  if test "$GCC" = yes; then
+    CFLAGS="-g -O2"
+  else
+    CFLAGS="-g"
+  fi
 else
-  if test -n "$RANLIB"; then
-  ac_cv_prog_RANLIB="$RANLIB" # Let the user override the test.
+  if test "$GCC" = yes; then
+    CFLAGS="-O2"
+  else
+    CFLAGS=
+  fi
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $CC option to accept ISO C89" >&5
+$as_echo_n "checking for $CC option to accept ISO C89... " >&6; }
+if ${ac_cv_prog_cc_c89+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
+  ac_cv_prog_cc_c89=no
+ac_save_CC=$CC
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <stdarg.h>
+#include <stdio.h>
+struct stat;
+/* Most of the following tests are stolen from RCS 5.7's src/conf.sh.  */
+struct buf { int x; };
+FILE * (*rcsopen) (struct buf *, struct stat *, int);
+static char *e (p, i)
+     char **p;
+     int i;
+{
+  return p[i];
+}
+static char *f (char * (*g) (char **, int), char **p, ...)
+{
+  char *s;
+  va_list v;
+  va_start (v,p);
+  s = g (p, va_arg (v,int));
+  va_end (v);
+  return s;
+}
+
+/* OSF 4.0 Compaq cc is some sort of almost-ANSI by default.  It has
+   function prototypes and stuff, but not '\xHH' hex character constants.
+   These don't provoke an error unfortunately, instead are silently treated
+   as 'x'.  The following induces an error, until -std is added to get
+   proper ANSI mode.  Curiously '\x00'!='x' always comes out true, for an
+   array size at least.  It's necessary to write '\x00'==0 to get something
+   that's true only with -std.  */
+int osf4_cc_array ['\x00' == 0 ? 1 : -1];
+
+/* IBM C 6 for AIX is almost-ANSI by default, but it replaces macro parameters
+   inside strings and character constants.  */
+#define FOO(x) 'x'
+int xlc6_cc_array[FOO(a) == 'x' ? 1 : -1];
+
+int test (int i, double x);
+struct s1 {int (*f) (int a);};
+struct s2 {int (*f) (double a);};
+int pairnames (int, char **, FILE *(*)(struct buf *, struct stat *, int), int, int);
+int argc;
+char **argv;
+int
+main ()
+{
+return f (e, argv, 0) != argv[0]  ||  f (e, argv, 1) != argv[1];
+  ;
+  return 0;
+}
+_ACEOF
+for ac_arg in '' -qlanglvl=extc89 -qlanglvl=ansi -std \
+	-Ae "-Aa -D_HPUX_SOURCE" "-Xc -D__EXTENSIONS__"
 do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
-    ac_cv_prog_RANLIB="${ac_tool_prefix}ranlib"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
-  fi
-done
+  CC="$ac_save_CC $ac_arg"
+  if ac_fn_c_try_compile "$LINENO"; then :
+  ac_cv_prog_cc_c89=$ac_arg
+fi
+rm -f core conftest.err conftest.$ac_objext
+  test "x$ac_cv_prog_cc_c89" != "xno" && break
 done
-IFS=$as_save_IFS
+rm -f conftest.$ac_ext
+CC=$ac_save_CC
 
 fi
-fi
-RANLIB=$ac_cv_prog_RANLIB
-if test -n "$RANLIB"; then
-  { $as_echo "$as_me:$LINENO: result: $RANLIB" >&5
-$as_echo "$RANLIB" >&6; }
-else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
-$as_echo "no" >&6; }
+# AC_CACHE_VAL
+case "x$ac_cv_prog_cc_c89" in
+  x)
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: none needed" >&5
+$as_echo "none needed" >&6; } ;;
+  xno)
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: unsupported" >&5
+$as_echo "unsupported" >&6; } ;;
+  *)
+    CC="$CC $ac_cv_prog_cc_c89"
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_prog_cc_c89" >&5
+$as_echo "$ac_cv_prog_cc_c89" >&6; } ;;
+esac
+if test "x$ac_cv_prog_cc_c89" != xno; then :
+
 fi
 
+ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
 
-fi
-if test -z "$ac_cv_prog_RANLIB"; then
-  ac_ct_RANLIB=$RANLIB
-  # Extract the first word of "ranlib", so it can be a program name with args.
-set dummy ranlib; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
-$as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_ac_ct_RANLIB+set}" = set; then
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for a sed that does not truncate output" >&5
+$as_echo_n "checking for a sed that does not truncate output... " >&6; }
+if ${ac_cv_path_SED+:} false; then :
   $as_echo_n "(cached) " >&6
 else
-  if test -n "$ac_ct_RANLIB"; then
-  ac_cv_prog_ac_ct_RANLIB="$ac_ct_RANLIB" # Let the user override the test.
-else
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+            ac_script=s/aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa/bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb/
+     for ac_i in 1 2 3 4 5 6 7; do
+       ac_script="$ac_script$as_nl$ac_script"
+     done
+     echo "$ac_script" 2>/dev/null | sed 99q >conftest.sed
+     { ac_script=; unset ac_script;}
+     if test -z "$SED"; then
+  ac_path_SED_found=false
+  # Loop through the user's path and test for each of PROGNAME-LIST
+  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
 for as_dir in $PATH
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
-    ac_cv_prog_ac_ct_RANLIB="ranlib"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
-  fi
-done
-done
-IFS=$as_save_IFS
-
-fi
-fi
-ac_ct_RANLIB=$ac_cv_prog_ac_ct_RANLIB
-if test -n "$ac_ct_RANLIB"; then
-  { $as_echo "$as_me:$LINENO: result: $ac_ct_RANLIB" >&5
-$as_echo "$ac_ct_RANLIB" >&6; }
-else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
-$as_echo "no" >&6; }
-fi
-
-  if test "x$ac_ct_RANLIB" = x; then
-    RANLIB=":"
-  else
-    case $cross_compiling:$ac_tool_warned in
-yes:)
-{ $as_echo "$as_me:$LINENO: WARNING: using cross tools not prefixed with host triplet" >&5
-$as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
-ac_tool_warned=yes ;;
+    for ac_prog in sed gsed; do
+    for ac_exec_ext in '' $ac_executable_extensions; do
+      ac_path_SED="$as_dir/$ac_prog$ac_exec_ext"
+      as_fn_executable_p "$ac_path_SED" || continue
+# Check for GNU ac_path_SED and select it if it is found.
+  # Check for GNU $ac_path_SED
+case `"$ac_path_SED" --version 2>&1` in
+*GNU*)
+  ac_cv_path_SED="$ac_path_SED" ac_path_SED_found=:;;
+*)
+  ac_count=0
+  $as_echo_n 0123456789 >"conftest.in"
+  while :
+  do
+    cat "conftest.in" "conftest.in" >"conftest.tmp"
+    mv "conftest.tmp" "conftest.in"
+    cp "conftest.in" "conftest.nl"
+    $as_echo '' >> "conftest.nl"
+    "$ac_path_SED" -f conftest.sed < "conftest.nl" >"conftest.out" 2>/dev/null || break
+    diff "conftest.out" "conftest.nl" >/dev/null 2>&1 || break
+    as_fn_arith $ac_count + 1 && ac_count=$as_val
+    if test $ac_count -gt ${ac_path_SED_max-0}; then
+      # Best one so far, save it but keep looking for a better one
+      ac_cv_path_SED="$ac_path_SED"
+      ac_path_SED_max=$ac_count
+    fi
+    # 10*(2^10) chars as input seems more than enough
+    test $ac_count -gt 10 && break
+  done
+  rm -f conftest.in conftest.tmp conftest.nl conftest.out;;
 esac
-    RANLIB=$ac_ct_RANLIB
+
+      $ac_path_SED_found && break 3
+    done
+  done
+  done
+IFS=$as_save_IFS
+  if test -z "$ac_cv_path_SED"; then
+    as_fn_error $? "no acceptable sed could be found in \$PATH" "$LINENO" 5
   fi
 else
-  RANLIB="$ac_cv_prog_RANLIB"
+  ac_cv_path_SED=$SED
 fi
 
-test -z "$RANLIB" && RANLIB=:
-
-
-
-
-
-
-# Determine commands to create old-style static archives.
-old_archive_cmds='$AR $AR_FLAGS $oldlib$oldobjs'
-old_postinstall_cmds='chmod 644 $oldlib'
-old_postuninstall_cmds=
-
-if test -n "$RANLIB"; then
-  case $host_os in
-  openbsd*)
-    old_postinstall_cmds="$old_postinstall_cmds~\$RANLIB -t \$oldlib"
-    ;;
-  *)
-    old_postinstall_cmds="$old_postinstall_cmds~\$RANLIB \$oldlib"
-    ;;
-  esac
-  old_archive_cmds="$old_archive_cmds~\$RANLIB \$oldlib"
 fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_path_SED" >&5
+$as_echo "$ac_cv_path_SED" >&6; }
+ SED="$ac_cv_path_SED"
+  rm -f conftest.sed
 
+test -z "$SED" && SED=sed
+Xsed="$SED -e 1s/^X//"
 
 
 
@@ -4637,18 +3776,204 @@ fi
 
 
 
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for grep that handles long lines and -e" >&5
+$as_echo_n "checking for grep that handles long lines and -e... " >&6; }
+if ${ac_cv_path_GREP+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if test -z "$GREP"; then
+  ac_path_GREP_found=false
+  # Loop through the user's path and test for each of PROGNAME-LIST
+  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH$PATH_SEPARATOR/usr/xpg4/bin
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_prog in grep ggrep; do
+    for ac_exec_ext in '' $ac_executable_extensions; do
+      ac_path_GREP="$as_dir/$ac_prog$ac_exec_ext"
+      as_fn_executable_p "$ac_path_GREP" || continue
+# Check for GNU ac_path_GREP and select it if it is found.
+  # Check for GNU $ac_path_GREP
+case `"$ac_path_GREP" --version 2>&1` in
+*GNU*)
+  ac_cv_path_GREP="$ac_path_GREP" ac_path_GREP_found=:;;
+*)
+  ac_count=0
+  $as_echo_n 0123456789 >"conftest.in"
+  while :
+  do
+    cat "conftest.in" "conftest.in" >"conftest.tmp"
+    mv "conftest.tmp" "conftest.in"
+    cp "conftest.in" "conftest.nl"
+    $as_echo 'GREP' >> "conftest.nl"
+    "$ac_path_GREP" -e 'GREP$' -e '-(cannot match)-' < "conftest.nl" >"conftest.out" 2>/dev/null || break
+    diff "conftest.out" "conftest.nl" >/dev/null 2>&1 || break
+    as_fn_arith $ac_count + 1 && ac_count=$as_val
+    if test $ac_count -gt ${ac_path_GREP_max-0}; then
+      # Best one so far, save it but keep looking for a better one
+      ac_cv_path_GREP="$ac_path_GREP"
+      ac_path_GREP_max=$ac_count
+    fi
+    # 10*(2^10) chars as input seems more than enough
+    test $ac_count -gt 10 && break
+  done
+  rm -f conftest.in conftest.tmp conftest.nl conftest.out;;
+esac
 
+      $ac_path_GREP_found && break 3
+    done
+  done
+  done
+IFS=$as_save_IFS
+  if test -z "$ac_cv_path_GREP"; then
+    as_fn_error $? "no acceptable grep could be found in $PATH$PATH_SEPARATOR/usr/xpg4/bin" "$LINENO" 5
+  fi
+else
+  ac_cv_path_GREP=$GREP
+fi
 
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_path_GREP" >&5
+$as_echo "$ac_cv_path_GREP" >&6; }
+ GREP="$ac_cv_path_GREP"
 
 
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for egrep" >&5
+$as_echo_n "checking for egrep... " >&6; }
+if ${ac_cv_path_EGREP+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if echo a | $GREP -E '(a|b)' >/dev/null 2>&1
+   then ac_cv_path_EGREP="$GREP -E"
+   else
+     if test -z "$EGREP"; then
+  ac_path_EGREP_found=false
+  # Loop through the user's path and test for each of PROGNAME-LIST
+  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH$PATH_SEPARATOR/usr/xpg4/bin
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_prog in egrep; do
+    for ac_exec_ext in '' $ac_executable_extensions; do
+      ac_path_EGREP="$as_dir/$ac_prog$ac_exec_ext"
+      as_fn_executable_p "$ac_path_EGREP" || continue
+# Check for GNU ac_path_EGREP and select it if it is found.
+  # Check for GNU $ac_path_EGREP
+case `"$ac_path_EGREP" --version 2>&1` in
+*GNU*)
+  ac_cv_path_EGREP="$ac_path_EGREP" ac_path_EGREP_found=:;;
+*)
+  ac_count=0
+  $as_echo_n 0123456789 >"conftest.in"
+  while :
+  do
+    cat "conftest.in" "conftest.in" >"conftest.tmp"
+    mv "conftest.tmp" "conftest.in"
+    cp "conftest.in" "conftest.nl"
+    $as_echo 'EGREP' >> "conftest.nl"
+    "$ac_path_EGREP" 'EGREP$' < "conftest.nl" >"conftest.out" 2>/dev/null || break
+    diff "conftest.out" "conftest.nl" >/dev/null 2>&1 || break
+    as_fn_arith $ac_count + 1 && ac_count=$as_val
+    if test $ac_count -gt ${ac_path_EGREP_max-0}; then
+      # Best one so far, save it but keep looking for a better one
+      ac_cv_path_EGREP="$ac_path_EGREP"
+      ac_path_EGREP_max=$ac_count
+    fi
+    # 10*(2^10) chars as input seems more than enough
+    test $ac_count -gt 10 && break
+  done
+  rm -f conftest.in conftest.tmp conftest.nl conftest.out;;
+esac
 
+      $ac_path_EGREP_found && break 3
+    done
+  done
+  done
+IFS=$as_save_IFS
+  if test -z "$ac_cv_path_EGREP"; then
+    as_fn_error $? "no acceptable egrep could be found in $PATH$PATH_SEPARATOR/usr/xpg4/bin" "$LINENO" 5
+  fi
+else
+  ac_cv_path_EGREP=$EGREP
+fi
 
+   fi
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_path_EGREP" >&5
+$as_echo "$ac_cv_path_EGREP" >&6; }
+ EGREP="$ac_cv_path_EGREP"
 
 
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for fgrep" >&5
+$as_echo_n "checking for fgrep... " >&6; }
+if ${ac_cv_path_FGREP+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if echo 'ab*c' | $GREP -F 'ab*c' >/dev/null 2>&1
+   then ac_cv_path_FGREP="$GREP -F"
+   else
+     if test -z "$FGREP"; then
+  ac_path_FGREP_found=false
+  # Loop through the user's path and test for each of PROGNAME-LIST
+  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH$PATH_SEPARATOR/usr/xpg4/bin
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_prog in fgrep; do
+    for ac_exec_ext in '' $ac_executable_extensions; do
+      ac_path_FGREP="$as_dir/$ac_prog$ac_exec_ext"
+      as_fn_executable_p "$ac_path_FGREP" || continue
+# Check for GNU ac_path_FGREP and select it if it is found.
+  # Check for GNU $ac_path_FGREP
+case `"$ac_path_FGREP" --version 2>&1` in
+*GNU*)
+  ac_cv_path_FGREP="$ac_path_FGREP" ac_path_FGREP_found=:;;
+*)
+  ac_count=0
+  $as_echo_n 0123456789 >"conftest.in"
+  while :
+  do
+    cat "conftest.in" "conftest.in" >"conftest.tmp"
+    mv "conftest.tmp" "conftest.in"
+    cp "conftest.in" "conftest.nl"
+    $as_echo 'FGREP' >> "conftest.nl"
+    "$ac_path_FGREP" FGREP < "conftest.nl" >"conftest.out" 2>/dev/null || break
+    diff "conftest.out" "conftest.nl" >/dev/null 2>&1 || break
+    as_fn_arith $ac_count + 1 && ac_count=$as_val
+    if test $ac_count -gt ${ac_path_FGREP_max-0}; then
+      # Best one so far, save it but keep looking for a better one
+      ac_cv_path_FGREP="$ac_path_FGREP"
+      ac_path_FGREP_max=$ac_count
+    fi
+    # 10*(2^10) chars as input seems more than enough
+    test $ac_count -gt 10 && break
+  done
+  rm -f conftest.in conftest.tmp conftest.nl conftest.out;;
+esac
 
+      $ac_path_FGREP_found && break 3
+    done
+  done
+  done
+IFS=$as_save_IFS
+  if test -z "$ac_cv_path_FGREP"; then
+    as_fn_error $? "no acceptable fgrep could be found in $PATH$PATH_SEPARATOR/usr/xpg4/bin" "$LINENO" 5
+  fi
+else
+  ac_cv_path_FGREP=$FGREP
+fi
 
+   fi
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_path_FGREP" >&5
+$as_echo "$ac_cv_path_FGREP" >&6; }
+ FGREP="$ac_cv_path_FGREP"
 
 
+test -z "$GREP" && GREP=grep
 
 
 
@@ -4659,243 +3984,117 @@ fi
 
 
 
-# If no C compiler was specified, use CC.
-LTCC=${LTCC-"$CC"}
-
-# If no C compiler flags were specified, use CFLAGS.
-LTCFLAGS=${LTCFLAGS-"$CFLAGS"}
-
-# Allow CC to be a program name with arguments.
-compiler=$CC
-
-
-# Check for command to grab the raw symbol name followed by C symbol from nm.
-{ $as_echo "$as_me:$LINENO: checking command to parse $NM output from $compiler object" >&5
-$as_echo_n "checking command to parse $NM output from $compiler object... " >&6; }
-if test "${lt_cv_sys_global_symbol_pipe+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-
-# These are sane defaults that work on at least a few old systems.
-# [They come from Ultrix.  What could be older than Ultrix?!! ;)]
-
-# Character class describing NM global symbol codes.
-symcode='[BCDEGRST]'
-
-# Regexp to match symbols that can be accessed directly from C.
-sympat='\([_A-Za-z][_A-Za-z0-9]*\)'
-
-# Define system-specific variables.
-case $host_os in
-aix*)
-  symcode='[BCDT]'
-  ;;
-cygwin* | mingw* | pw32* | cegcc*)
-  symcode='[ABCDGISTW]'
-  ;;
-hpux*)
-  if test "$host_cpu" = ia64; then
-    symcode='[ABCDEGRST]'
-  fi
-  ;;
-irix* | nonstopux*)
-  symcode='[BCDEGRST]'
-  ;;
-osf*)
-  symcode='[BCDEGQRST]'
-  ;;
-solaris*)
-  symcode='[BDRT]'
-  ;;
-sco3.2v5*)
-  symcode='[DT]'
-  ;;
-sysv4.2uw2*)
-  symcode='[DT]'
-  ;;
-sysv5* | sco5v6* | unixware* | OpenUNIX*)
-  symcode='[ABDT]'
-  ;;
-sysv4)
-  symcode='[DFNSTU]'
-  ;;
-esac
-
-# If we're using GNU nm, then use its standard symbol codes.
-case `$NM -V 2>&1` in
-*GNU* | *'with BFD'*)
-  symcode='[ABCDGIRSTW]' ;;
-esac
-
-# Transform an extracted symbol line into a proper C declaration.
-# Some systems (esp. on ia64) link data and code symbols differently,
-# so use this general approach.
-lt_cv_sys_global_symbol_to_cdecl="sed -n -e 's/^T .* \(.*\)$/extern int \1();/p' -e 's/^$symcode* .* \(.*\)$/extern char \1;/p'"
-
-# Transform an extracted symbol line into symbol name and symbol address
-lt_cv_sys_global_symbol_to_c_name_address="sed -n -e 's/^: \([^ ]*\) $/  {\\\"\1\\\", (void *) 0},/p' -e 's/^$symcode* \([^ ]*\) \([^ ]*\)$/  {\"\2\", (void *) \&\2},/p'"
-lt_cv_sys_global_symbol_to_c_name_address_lib_prefix="sed -n -e 's/^: \([^ ]*\) $/  {\\\"\1\\\", (void *) 0},/p' -e 's/^$symcode* \([^ ]*\) \(lib[^ ]*\)$/  {\"\2\", (void *) \&\2},/p' -e 's/^$symcode* \([^ ]*\) \([^ ]*\)$/  {\"lib\2\", (void *) \&\2},/p'"
-
-# Handle CRLF in mingw tool chain
-opt_cr=
-case $build_os in
-mingw*)
-  opt_cr=`$ECHO 'x\{0,1\}' | tr x '\015'` # option cr in regexp
-  ;;
-esac
-
-# Try without a prefix underscore, then with it.
-for ac_symprfx in "" "_"; do
-
-  # Transform symcode, sympat, and symprfx into a raw symbol and a C symbol.
-  symxfrm="\\1 $ac_symprfx\\2 \\2"
 
-  # Write the raw and C identifiers.
-  if test "$lt_cv_nm_interface" = "MS dumpbin"; then
-    # Fake it for dumpbin and say T for any non-static function
-    # and D for any global variable.
-    # Also find C++ and __fastcall symbols from MSVC++,
-    # which start with @ or ?.
-    lt_cv_sys_global_symbol_pipe="$AWK '"\
-"     {last_section=section; section=\$ 3};"\
-"     /Section length .*#relocs.*(pick any)/{hide[last_section]=1};"\
-"     \$ 0!~/External *\|/{next};"\
-"     / 0+ UNDEF /{next}; / UNDEF \([^|]\)*()/{next};"\
-"     {if(hide[section]) next};"\
-"     {f=0}; \$ 0~/\(\).*\|/{f=1}; {printf f ? \"T \" : \"D \"};"\
-"     {split(\$ 0, a, /\||\r/); split(a[2], s)};"\
-"     s[1]~/^[@?]/{print s[1], s[1]; next};"\
-"     s[1]~prfx {split(s[1],t,\"@\"); print t[1], substr(t[1],length(prfx))}"\
-"     ' prfx=^$ac_symprfx"
-  else
-    lt_cv_sys_global_symbol_pipe="sed -n -e 's/^.*[	 ]\($symcode$symcode*\)[	 ][	 ]*$ac_symprfx$sympat$opt_cr$/$symxfrm/p'"
-  fi
 
-  # Check to see that the pipe works correctly.
-  pipe_works=no
 
-  rm -f conftest*
-  cat > conftest.$ac_ext <<_LT_EOF
-#ifdef __cplusplus
-extern "C" {
-#endif
-char nm_test_var;
-void nm_test_func(void);
-void nm_test_func(void){}
-#ifdef __cplusplus
-}
-#endif
-int main(){nm_test_var='a';nm_test_func();return(0);}
-_LT_EOF
 
-  if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
-  (eval $ac_compile) 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; then
-    # Now try to grab the symbols.
-    nlist=conftest.nm
-    if { (eval echo "$as_me:$LINENO: \"$NM conftest.$ac_objext \| $lt_cv_sys_global_symbol_pipe \> $nlist\"") >&5
-  (eval $NM conftest.$ac_objext \| $lt_cv_sys_global_symbol_pipe \> $nlist) 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && test -s "$nlist"; then
-      # Try sorting and uniquifying the output.
-      if sort "$nlist" | uniq > "$nlist"T; then
-	mv -f "$nlist"T "$nlist"
-      else
-	rm -f "$nlist"T
-      fi
 
-      # Make sure that we snagged all the symbols we need.
-      if $GREP ' nm_test_var$' "$nlist" >/dev/null; then
-	if $GREP ' nm_test_func$' "$nlist" >/dev/null; then
-	  cat <<_LT_EOF > conftest.$ac_ext
-#ifdef __cplusplus
-extern "C" {
-#endif
 
-_LT_EOF
-	  # Now generate the symbol file.
-	  eval "$lt_cv_sys_global_symbol_to_cdecl"' < "$nlist" | $GREP -v main >> conftest.$ac_ext'
 
-	  cat <<_LT_EOF >> conftest.$ac_ext
 
-/* The mapping between symbol names and symbols.  */
-const struct {
-  const char *name;
-  void       *address;
-}
-lt__PROGRAM__LTX_preloaded_symbols[] =
-{
-  { "@PROGRAM@", (void *) 0 },
-_LT_EOF
-	  $SED "s/^$symcode$symcode* \(.*\) \(.*\)$/  {\"\2\", (void *) \&\2},/" < "$nlist" | $GREP -v main >> conftest.$ac_ext
-	  cat <<\_LT_EOF >> conftest.$ac_ext
-  {0, (void *) 0}
-};
 
-/* This works around a problem in FreeBSD linker */
-#ifdef FREEBSD_WORKAROUND
-static const void *lt_preloaded_setup() {
-  return lt__PROGRAM__LTX_preloaded_symbols;
-}
-#endif
+# Check whether --with-gnu-ld was given.
+if test "${with_gnu_ld+set}" = set; then :
+  withval=$with_gnu_ld; test "$withval" = no || with_gnu_ld=yes
+else
+  with_gnu_ld=no
+fi
 
-#ifdef __cplusplus
-}
-#endif
-_LT_EOF
-	  # Now try linking the two files.
-	  mv conftest.$ac_objext conftstm.$ac_objext
-	  lt_save_LIBS="$LIBS"
-	  lt_save_CFLAGS="$CFLAGS"
-	  LIBS="conftstm.$ac_objext"
-	  CFLAGS="$CFLAGS$lt_prog_compiler_no_builtin_flag"
-	  if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
-  (eval $ac_link) 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && test -s conftest${ac_exeext}; then
-	    pipe_works=yes
-	  fi
-	  LIBS="$lt_save_LIBS"
-	  CFLAGS="$lt_save_CFLAGS"
-	else
-	  echo "cannot find nm_test_func in $nlist" >&5
-	fi
-      else
-	echo "cannot find nm_test_var in $nlist" >&5
-      fi
-    else
-      echo "cannot run $lt_cv_sys_global_symbol_pipe" >&5
+ac_prog=ld
+if test "$GCC" = yes; then
+  # Check if gcc -print-prog-name=ld gives a path.
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for ld used by $CC" >&5
+$as_echo_n "checking for ld used by $CC... " >&6; }
+  case $host in
+  *-*-mingw*)
+    # gcc leaves a trailing carriage return which upsets mingw
+    ac_prog=`($CC -print-prog-name=ld) 2>&5 | tr -d '\015'` ;;
+  *)
+    ac_prog=`($CC -print-prog-name=ld) 2>&5` ;;
+  esac
+  case $ac_prog in
+    # Accept absolute paths.
+    [\\/]* | ?:[\\/]*)
+      re_direlt='/[^/][^/]*/\.\./'
+      # Canonicalize the pathname of ld
+      ac_prog=`$ECHO "$ac_prog"| $SED 's%\\\\%/%g'`
+      while $ECHO "$ac_prog" | $GREP "$re_direlt" > /dev/null 2>&1; do
+	ac_prog=`$ECHO $ac_prog| $SED "s%$re_direlt%/%"`
+      done
+      test -z "$LD" && LD="$ac_prog"
+      ;;
+  "")
+    # If it fails, then pretend we aren't using GCC.
+    ac_prog=ld
+    ;;
+  *)
+    # If it is relative, then search for the first ld in PATH.
+    with_gnu_ld=unknown
+    ;;
+  esac
+elif test "$with_gnu_ld" = yes; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for GNU ld" >&5
+$as_echo_n "checking for GNU ld... " >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for non-GNU ld" >&5
+$as_echo_n "checking for non-GNU ld... " >&6; }
+fi
+if ${lt_cv_path_LD+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if test -z "$LD"; then
+  lt_save_ifs="$IFS"; IFS=$PATH_SEPARATOR
+  for ac_dir in $PATH; do
+    IFS="$lt_save_ifs"
+    test -z "$ac_dir" && ac_dir=.
+    if test -f "$ac_dir/$ac_prog" || test -f "$ac_dir/$ac_prog$ac_exeext"; then
+      lt_cv_path_LD="$ac_dir/$ac_prog"
+      # Check to see if the program is GNU ld.  I'd rather use --version,
+      # but apparently some variants of GNU ld only accept -v.
+      # Break only if it was the GNU/non-GNU ld that we prefer.
+      case `"$lt_cv_path_LD" -v 2>&1 </dev/null` in
+      *GNU* | *'with BFD'*)
+	test "$with_gnu_ld" != no && break
+	;;
+      *)
+	test "$with_gnu_ld" != yes && break
+	;;
+      esac
     fi
-  else
-    echo "$progname: failed program was:" >&5
-    cat conftest.$ac_ext >&5
-  fi
-  rm -rf conftest* conftst*
-
-  # Do not use the global_symbol_pipe unless it works.
-  if test "$pipe_works" = yes; then
-    break
-  else
-    lt_cv_sys_global_symbol_pipe=
-  fi
-done
-
+  done
+  IFS="$lt_save_ifs"
+else
+  lt_cv_path_LD="$LD" # Let the user override the test with a path.
+fi
 fi
 
-if test -z "$lt_cv_sys_global_symbol_pipe"; then
-  lt_cv_sys_global_symbol_to_cdecl=
+LD="$lt_cv_path_LD"
+if test -n "$LD"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $LD" >&5
+$as_echo "$LD" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 fi
-if test -z "$lt_cv_sys_global_symbol_pipe$lt_cv_sys_global_symbol_to_cdecl"; then
-  { $as_echo "$as_me:$LINENO: result: failed" >&5
-$as_echo "failed" >&6; }
+test -z "$LD" && as_fn_error $? "no acceptable ld found in \$PATH" "$LINENO" 5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking if the linker ($LD) is GNU ld" >&5
+$as_echo_n "checking if the linker ($LD) is GNU ld... " >&6; }
+if ${lt_cv_prog_gnu_ld+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
-  { $as_echo "$as_me:$LINENO: result: ok" >&5
-$as_echo "ok" >&6; }
+  # I'd rather use --version here, but apparently some GNU lds only accept -v.
+case `$LD -v 2>&1 </dev/null` in
+*GNU* | *'with BFD'*)
+  lt_cv_prog_gnu_ld=yes
+  ;;
+*)
+  lt_cv_prog_gnu_ld=no
+  ;;
+esac
 fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_prog_gnu_ld" >&5
+$as_echo "$lt_cv_prog_gnu_ld" >&6; }
+with_gnu_ld=$lt_cv_prog_gnu_ld
 
 
 
@@ -4905,709 +4104,858 @@ fi
 
 
 
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-# Check whether --enable-libtool-lock was given.
-if test "${enable_libtool_lock+set}" = set; then
-  enableval=$enable_libtool_lock;
-fi
-
-test "x$enable_libtool_lock" != xno && enable_libtool_lock=yes
-
-# Some flags need to be propagated to the compiler or linker for good
-# libtool support.
-case $host in
-ia64-*-hpux*)
-  # Find out which ABI we are using.
-  echo 'int i;' > conftest.$ac_ext
-  if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
-  (eval $ac_compile) 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; then
-    case `/usr/bin/file conftest.$ac_objext` in
-      *ELF-32*)
-	HPUX_IA64_MODE="32"
-	;;
-      *ELF-64*)
-	HPUX_IA64_MODE="64"
-	;;
-    esac
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for BSD- or MS-compatible name lister (nm)" >&5
+$as_echo_n "checking for BSD- or MS-compatible name lister (nm)... " >&6; }
+if ${lt_cv_path_NM+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if test -n "$NM"; then
+  # Let the user override the test.
+  lt_cv_path_NM="$NM"
+else
+  lt_nm_to_check="${ac_tool_prefix}nm"
+  if test -n "$ac_tool_prefix" && test "$build" = "$host"; then
+    lt_nm_to_check="$lt_nm_to_check nm"
   fi
-  rm -rf conftest*
-  ;;
-*-*-irix6*)
-  # Find out which ABI we are using.
-  echo '#line 4953 "configure"' > conftest.$ac_ext
-  if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
-  (eval $ac_compile) 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; then
-    if test "$lt_cv_prog_gnu_ld" = yes; then
-      case `/usr/bin/file conftest.$ac_objext` in
-	*32-bit*)
-	  LD="${LD-ld} -melf32bsmip"
-	  ;;
-	*N32*)
-	  LD="${LD-ld} -melf32bmipn32"
-	  ;;
-	*64-bit*)
-	  LD="${LD-ld} -melf64bmip"
-	;;
-      esac
-    else
-      case `/usr/bin/file conftest.$ac_objext` in
-	*32-bit*)
-	  LD="${LD-ld} -32"
-	  ;;
-	*N32*)
-	  LD="${LD-ld} -n32"
-	  ;;
-	*64-bit*)
-	  LD="${LD-ld} -64"
+  for lt_tmp_nm in $lt_nm_to_check; do
+    lt_save_ifs="$IFS"; IFS=$PATH_SEPARATOR
+    for ac_dir in $PATH /usr/ccs/bin/elf /usr/ccs/bin /usr/ucb /bin; do
+      IFS="$lt_save_ifs"
+      test -z "$ac_dir" && ac_dir=.
+      tmp_nm="$ac_dir/$lt_tmp_nm"
+      if test -f "$tmp_nm" || test -f "$tmp_nm$ac_exeext" ; then
+	# Check to see if the nm accepts a BSD-compat flag.
+	# Adding the `sed 1q' prevents false positives on HP-UX, which says:
+	#   nm: unknown option "B" ignored
+	# Tru64's nm complains that /dev/null is an invalid object file
+	case `"$tmp_nm" -B /dev/null 2>&1 | sed '1q'` in
+	*/dev/null* | *'Invalid file or object type'*)
+	  lt_cv_path_NM="$tmp_nm -B"
+	  break
 	  ;;
-      esac
-    fi
-  fi
-  rm -rf conftest*
-  ;;
-
-x86_64-*kfreebsd*-gnu|x86_64-*linux*|ppc*-*linux*|powerpc*-*linux*| \
-s390*-*linux*|s390*-*tpf*|sparc*-*linux*)
-  # Find out which ABI we are using.
-  echo 'int i;' > conftest.$ac_ext
-  if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
-  (eval $ac_compile) 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; then
-    case `/usr/bin/file conftest.o` in
-      *32-bit*)
-	case $host in
-	  x86_64-*kfreebsd*-gnu)
-	    LD="${LD-ld} -m elf_i386_fbsd"
-	    ;;
-	  x86_64-*linux*)
-	    LD="${LD-ld} -m elf_i386"
-	    ;;
-	  ppc64-*linux*|powerpc64-*linux*)
-	    LD="${LD-ld} -m elf32ppclinux"
-	    ;;
-	  s390x-*linux*)
-	    LD="${LD-ld} -m elf_s390"
-	    ;;
-	  sparc64-*linux*)
-	    LD="${LD-ld} -m elf32_sparc"
-	    ;;
-	esac
-	;;
-      *64-bit*)
-	case $host in
-	  x86_64-*kfreebsd*-gnu)
-	    LD="${LD-ld} -m elf_x86_64_fbsd"
-	    ;;
-	  x86_64-*linux*)
-	    LD="${LD-ld} -m elf_x86_64"
-	    ;;
-	  ppc*-*linux*|powerpc*-*linux*)
-	    LD="${LD-ld} -m elf64ppc"
-	    ;;
-	  s390*-*linux*|s390*-*tpf*)
-	    LD="${LD-ld} -m elf64_s390"
+	*)
+	  case `"$tmp_nm" -p /dev/null 2>&1 | sed '1q'` in
+	  */dev/null*)
+	    lt_cv_path_NM="$tmp_nm -p"
+	    break
 	    ;;
-	  sparc*-*linux*)
-	    LD="${LD-ld} -m elf64_sparc"
+	  *)
+	    lt_cv_path_NM=${lt_cv_path_NM="$tmp_nm"} # keep the first match, but
+	    continue # so that we can try to find one that supports BSD flags
 	    ;;
+	  esac
+	  ;;
 	esac
-	;;
-    esac
-  fi
-  rm -rf conftest*
-  ;;
-
-*-*-sco3.2v5*)
-  # On SCO OpenServer 5, we need -belf to get full-featured binaries.
-  SAVE_CFLAGS="$CFLAGS"
-  CFLAGS="$CFLAGS -belf"
-  { $as_echo "$as_me:$LINENO: checking whether the C compiler needs -belf" >&5
-$as_echo_n "checking whether the C compiler needs -belf... " >&6; }
-if test "${lt_cv_cc_needs_belf+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  ac_ext=c
-ac_cpp='$CPP $CPPFLAGS'
-ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
-ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
-ac_compiler_gnu=$ac_cv_c_compiler_gnu
-
-     cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-
-int
-main ()
-{
-
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest$ac_exeext && {
-	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
-       }; then
-  lt_cv_cc_needs_belf=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	lt_cv_cc_needs_belf=no
+      fi
+    done
+    IFS="$lt_save_ifs"
+  done
+  : ${lt_cv_path_NM=no}
 fi
-
-rm -rf conftest.dSYM
-rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
-      conftest$ac_exeext conftest.$ac_ext
-     ac_ext=c
-ac_cpp='$CPP $CPPFLAGS'
-ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
-ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
-ac_compiler_gnu=$ac_cv_c_compiler_gnu
-
 fi
-{ $as_echo "$as_me:$LINENO: result: $lt_cv_cc_needs_belf" >&5
-$as_echo "$lt_cv_cc_needs_belf" >&6; }
-  if test x"$lt_cv_cc_needs_belf" != x"yes"; then
-    # this is probably gcc 2.8.0, egcs 1.0 or newer; no need for -belf
-    CFLAGS="$SAVE_CFLAGS"
-  fi
-  ;;
-sparc*-*solaris*)
-  # Find out which ABI we are using.
-  echo 'int i;' > conftest.$ac_ext
-  if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
-  (eval $ac_compile) 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; then
-    case `/usr/bin/file conftest.o` in
-    *64-bit*)
-      case $lt_cv_prog_gnu_ld in
-      yes*) LD="${LD-ld} -m elf64_sparc" ;;
-      *)
-	if ${LD-ld} -64 -r -o conftest2.o conftest.o >/dev/null 2>&1; then
-	  LD="${LD-ld} -64"
-	fi
-	;;
-      esac
-      ;;
-    esac
-  fi
-  rm -rf conftest*
-  ;;
-esac
-
-need_locks="$enable_libtool_lock"
-
-
-  case $host_os in
-    rhapsody* | darwin*)
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_path_NM" >&5
+$as_echo "$lt_cv_path_NM" >&6; }
+if test "$lt_cv_path_NM" != "no"; then
+  NM="$lt_cv_path_NM"
+else
+  # Didn't find any BSD compatible name lister, look for dumpbin.
+  if test -n "$DUMPBIN"; then :
+    # Let the user override the test.
+  else
     if test -n "$ac_tool_prefix"; then
-  # Extract the first word of "${ac_tool_prefix}dsymutil", so it can be a program name with args.
-set dummy ${ac_tool_prefix}dsymutil; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+  for ac_prog in dumpbin "link -dump"
+  do
+    # Extract the first word of "$ac_tool_prefix$ac_prog", so it can be a program name with args.
+set dummy $ac_tool_prefix$ac_prog; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_DSYMUTIL+set}" = set; then
+if ${ac_cv_prog_DUMPBIN+:} false; then :
   $as_echo_n "(cached) " >&6
 else
-  if test -n "$DSYMUTIL"; then
-  ac_cv_prog_DSYMUTIL="$DSYMUTIL" # Let the user override the test.
+  if test -n "$DUMPBIN"; then
+  ac_cv_prog_DUMPBIN="$DUMPBIN" # Let the user override the test.
 else
 as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
 for as_dir in $PATH
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
-    ac_cv_prog_DSYMUTIL="${ac_tool_prefix}dsymutil"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_DUMPBIN="$ac_tool_prefix$ac_prog"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
-DSYMUTIL=$ac_cv_prog_DSYMUTIL
-if test -n "$DSYMUTIL"; then
-  { $as_echo "$as_me:$LINENO: result: $DSYMUTIL" >&5
-$as_echo "$DSYMUTIL" >&6; }
+DUMPBIN=$ac_cv_prog_DUMPBIN
+if test -n "$DUMPBIN"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $DUMPBIN" >&5
+$as_echo "$DUMPBIN" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
 
+    test -n "$DUMPBIN" && break
+  done
 fi
-if test -z "$ac_cv_prog_DSYMUTIL"; then
-  ac_ct_DSYMUTIL=$DSYMUTIL
-  # Extract the first word of "dsymutil", so it can be a program name with args.
-set dummy dsymutil; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+if test -z "$DUMPBIN"; then
+  ac_ct_DUMPBIN=$DUMPBIN
+  for ac_prog in dumpbin "link -dump"
+do
+  # Extract the first word of "$ac_prog", so it can be a program name with args.
+set dummy $ac_prog; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_ac_ct_DSYMUTIL+set}" = set; then
+if ${ac_cv_prog_ac_ct_DUMPBIN+:} false; then :
   $as_echo_n "(cached) " >&6
 else
-  if test -n "$ac_ct_DSYMUTIL"; then
-  ac_cv_prog_ac_ct_DSYMUTIL="$ac_ct_DSYMUTIL" # Let the user override the test.
+  if test -n "$ac_ct_DUMPBIN"; then
+  ac_cv_prog_ac_ct_DUMPBIN="$ac_ct_DUMPBIN" # Let the user override the test.
 else
 as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
 for as_dir in $PATH
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
-    ac_cv_prog_ac_ct_DSYMUTIL="dsymutil"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_ac_ct_DUMPBIN="$ac_prog"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
-ac_ct_DSYMUTIL=$ac_cv_prog_ac_ct_DSYMUTIL
-if test -n "$ac_ct_DSYMUTIL"; then
-  { $as_echo "$as_me:$LINENO: result: $ac_ct_DSYMUTIL" >&5
-$as_echo "$ac_ct_DSYMUTIL" >&6; }
+ac_ct_DUMPBIN=$ac_cv_prog_ac_ct_DUMPBIN
+if test -n "$ac_ct_DUMPBIN"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_DUMPBIN" >&5
+$as_echo "$ac_ct_DUMPBIN" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
-  if test "x$ac_ct_DSYMUTIL" = x; then
-    DSYMUTIL=":"
+
+  test -n "$ac_ct_DUMPBIN" && break
+done
+
+  if test "x$ac_ct_DUMPBIN" = x; then
+    DUMPBIN=":"
   else
     case $cross_compiling:$ac_tool_warned in
 yes:)
-{ $as_echo "$as_me:$LINENO: WARNING: using cross tools not prefixed with host triplet" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
 $as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
 ac_tool_warned=yes ;;
 esac
-    DSYMUTIL=$ac_ct_DSYMUTIL
+    DUMPBIN=$ac_ct_DUMPBIN
   fi
-else
-  DSYMUTIL="$ac_cv_prog_DSYMUTIL"
 fi
 
-    if test -n "$ac_tool_prefix"; then
-  # Extract the first word of "${ac_tool_prefix}nmedit", so it can be a program name with args.
-set dummy ${ac_tool_prefix}nmedit; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
-$as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_NMEDIT+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  if test -n "$NMEDIT"; then
-  ac_cv_prog_NMEDIT="$NMEDIT" # Let the user override the test.
-else
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
-    ac_cv_prog_NMEDIT="${ac_tool_prefix}nmedit"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
+    case `$DUMPBIN -symbols /dev/null 2>&1 | sed '1q'` in
+    *COFF*)
+      DUMPBIN="$DUMPBIN -symbols"
+      ;;
+    *)
+      DUMPBIN=:
+      ;;
+    esac
   fi
-done
-done
-IFS=$as_save_IFS
 
+  if test "$DUMPBIN" != ":"; then
+    NM="$DUMPBIN"
+  fi
 fi
-fi
-NMEDIT=$ac_cv_prog_NMEDIT
-if test -n "$NMEDIT"; then
-  { $as_echo "$as_me:$LINENO: result: $NMEDIT" >&5
-$as_echo "$NMEDIT" >&6; }
+test -z "$NM" && NM=nm
+
+
+
+
+
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking the name lister ($NM) interface" >&5
+$as_echo_n "checking the name lister ($NM) interface... " >&6; }
+if ${lt_cv_nm_interface+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
-$as_echo "no" >&6; }
+  lt_cv_nm_interface="BSD nm"
+  echo "int some_variable = 0;" > conftest.$ac_ext
+  (eval echo "\"\$as_me:$LINENO: $ac_compile\"" >&5)
+  (eval "$ac_compile" 2>conftest.err)
+  cat conftest.err >&5
+  (eval echo "\"\$as_me:$LINENO: $NM \\\"conftest.$ac_objext\\\"\"" >&5)
+  (eval "$NM \"conftest.$ac_objext\"" 2>conftest.err > conftest.out)
+  cat conftest.err >&5
+  (eval echo "\"\$as_me:$LINENO: output\"" >&5)
+  cat conftest.out >&5
+  if $GREP 'External.*some_variable' conftest.out > /dev/null; then
+    lt_cv_nm_interface="MS dumpbin"
+  fi
+  rm -f conftest*
 fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_nm_interface" >&5
+$as_echo "$lt_cv_nm_interface" >&6; }
 
-
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether ln -s works" >&5
+$as_echo_n "checking whether ln -s works... " >&6; }
+LN_S=$as_ln_s
+if test "$LN_S" = "ln -s"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no, using $LN_S" >&5
+$as_echo "no, using $LN_S" >&6; }
 fi
-if test -z "$ac_cv_prog_NMEDIT"; then
-  ac_ct_NMEDIT=$NMEDIT
-  # Extract the first word of "nmedit", so it can be a program name with args.
-set dummy nmedit; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
-$as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_ac_ct_NMEDIT+set}" = set; then
+
+# find the maximum length of command line arguments
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking the maximum length of command line arguments" >&5
+$as_echo_n "checking the maximum length of command line arguments... " >&6; }
+if ${lt_cv_sys_max_cmd_len+:} false; then :
   $as_echo_n "(cached) " >&6
 else
-  if test -n "$ac_ct_NMEDIT"; then
-  ac_cv_prog_ac_ct_NMEDIT="$ac_ct_NMEDIT" # Let the user override the test.
-else
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
-    ac_cv_prog_ac_ct_NMEDIT="nmedit"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
-  fi
-done
-done
-IFS=$as_save_IFS
+    i=0
+  teststring="ABCD"
+
+  case $build_os in
+  msdosdjgpp*)
+    # On DJGPP, this test can blow up pretty badly due to problems in libc
+    # (any single argument exceeding 2000 bytes causes a buffer overrun
+    # during glob expansion).  Even if it were fixed, the result of this
+    # check would be larger than it should be.
+    lt_cv_sys_max_cmd_len=12288;    # 12K is about right
+    ;;
+
+  gnu*)
+    # Under GNU Hurd, this test is not required because there is
+    # no limit to the length of command line arguments.
+    # Libtool will interpret -1 as no limit whatsoever
+    lt_cv_sys_max_cmd_len=-1;
+    ;;
+
+  cygwin* | mingw* | cegcc*)
+    # On Win9x/ME, this test blows up -- it succeeds, but takes
+    # about 5 minutes as the teststring grows exponentially.
+    # Worse, since 9x/ME are not pre-emptively multitasking,
+    # you end up with a "frozen" computer, even though with patience
+    # the test eventually succeeds (with a max line length of 256k).
+    # Instead, let's just punt: use the minimum linelength reported by
+    # all of the supported platforms: 8192 (on NT/2K/XP).
+    lt_cv_sys_max_cmd_len=8192;
+    ;;
+
+  mint*)
+    # On MiNT this can take a long time and run out of memory.
+    lt_cv_sys_max_cmd_len=8192;
+    ;;
+
+  amigaos*)
+    # On AmigaOS with pdksh, this test takes hours, literally.
+    # So we just punt and use a minimum line length of 8192.
+    lt_cv_sys_max_cmd_len=8192;
+    ;;
+
+  netbsd* | freebsd* | openbsd* | darwin* | dragonfly*)
+    # This has been around since 386BSD, at least.  Likely further.
+    if test -x /sbin/sysctl; then
+      lt_cv_sys_max_cmd_len=`/sbin/sysctl -n kern.argmax`
+    elif test -x /usr/sbin/sysctl; then
+      lt_cv_sys_max_cmd_len=`/usr/sbin/sysctl -n kern.argmax`
+    else
+      lt_cv_sys_max_cmd_len=65536	# usable default for all BSDs
+    fi
+    # And add a safety zone
+    lt_cv_sys_max_cmd_len=`expr $lt_cv_sys_max_cmd_len \/ 4`
+    lt_cv_sys_max_cmd_len=`expr $lt_cv_sys_max_cmd_len \* 3`
+    ;;
+
+  interix*)
+    # We know the value 262144 and hardcode it with a safety zone (like BSD)
+    lt_cv_sys_max_cmd_len=196608
+    ;;
+
+  os2*)
+    # The test takes a long time on OS/2.
+    lt_cv_sys_max_cmd_len=8192
+    ;;
+
+  osf*)
+    # Dr. Hans Ekkehard Plesser reports seeing a kernel panic running configure
+    # due to this test when exec_disable_arg_limit is 1 on Tru64. It is not
+    # nice to cause kernel panics so lets avoid the loop below.
+    # First set a reasonable default.
+    lt_cv_sys_max_cmd_len=16384
+    #
+    if test -x /sbin/sysconfig; then
+      case `/sbin/sysconfig -q proc exec_disable_arg_limit` in
+        *1*) lt_cv_sys_max_cmd_len=-1 ;;
+      esac
+    fi
+    ;;
+  sco3.2v5*)
+    lt_cv_sys_max_cmd_len=102400
+    ;;
+  sysv5* | sco5v6* | sysv4.2uw2*)
+    kargmax=`grep ARG_MAX /etc/conf/cf.d/stune 2>/dev/null`
+    if test -n "$kargmax"; then
+      lt_cv_sys_max_cmd_len=`echo $kargmax | sed 's/.*[	 ]//'`
+    else
+      lt_cv_sys_max_cmd_len=32768
+    fi
+    ;;
+  *)
+    lt_cv_sys_max_cmd_len=`(getconf ARG_MAX) 2> /dev/null`
+    if test -n "$lt_cv_sys_max_cmd_len"; then
+      lt_cv_sys_max_cmd_len=`expr $lt_cv_sys_max_cmd_len \/ 4`
+      lt_cv_sys_max_cmd_len=`expr $lt_cv_sys_max_cmd_len \* 3`
+    else
+      # Make teststring a little bigger before we do anything with it.
+      # a 1K string should be a reasonable start.
+      for i in 1 2 3 4 5 6 7 8 ; do
+        teststring=$teststring$teststring
+      done
+      SHELL=${SHELL-${CONFIG_SHELL-/bin/sh}}
+      # If test is not a shell built-in, we'll probably end up computing a
+      # maximum length that is only half of the actual maximum length, but
+      # we can't tell.
+      while { test "X"`env echo "$teststring$teststring" 2>/dev/null` \
+	         = "X$teststring$teststring"; } >/dev/null 2>&1 &&
+	      test $i != 17 # 1/2 MB should be enough
+      do
+        i=`expr $i + 1`
+        teststring=$teststring$teststring
+      done
+      # Only check the string length outside the loop.
+      lt_cv_sys_max_cmd_len=`expr "X$teststring" : ".*" 2>&1`
+      teststring=
+      # Add a significant safety factor because C++ compilers can tack on
+      # massive amounts of additional arguments before passing them to the
+      # linker.  It appears as though 1/2 is a usable value.
+      lt_cv_sys_max_cmd_len=`expr $lt_cv_sys_max_cmd_len \/ 2`
+    fi
+    ;;
+  esac
 
 fi
-fi
-ac_ct_NMEDIT=$ac_cv_prog_ac_ct_NMEDIT
-if test -n "$ac_ct_NMEDIT"; then
-  { $as_echo "$as_me:$LINENO: result: $ac_ct_NMEDIT" >&5
-$as_echo "$ac_ct_NMEDIT" >&6; }
-else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
-$as_echo "no" >&6; }
-fi
 
-  if test "x$ac_ct_NMEDIT" = x; then
-    NMEDIT=":"
-  else
-    case $cross_compiling:$ac_tool_warned in
-yes:)
-{ $as_echo "$as_me:$LINENO: WARNING: using cross tools not prefixed with host triplet" >&5
-$as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
-ac_tool_warned=yes ;;
-esac
-    NMEDIT=$ac_ct_NMEDIT
-  fi
+if test -n $lt_cv_sys_max_cmd_len ; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_sys_max_cmd_len" >&5
+$as_echo "$lt_cv_sys_max_cmd_len" >&6; }
 else
-  NMEDIT="$ac_cv_prog_NMEDIT"
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: none" >&5
+$as_echo "none" >&6; }
 fi
+max_cmd_len=$lt_cv_sys_max_cmd_len
 
-    if test -n "$ac_tool_prefix"; then
-  # Extract the first word of "${ac_tool_prefix}lipo", so it can be a program name with args.
-set dummy ${ac_tool_prefix}lipo; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
-$as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_LIPO+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  if test -n "$LIPO"; then
-  ac_cv_prog_LIPO="$LIPO" # Let the user override the test.
-else
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
-    ac_cv_prog_LIPO="${ac_tool_prefix}lipo"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
-  fi
-done
-done
-IFS=$as_save_IFS
 
-fi
-fi
-LIPO=$ac_cv_prog_LIPO
-if test -n "$LIPO"; then
-  { $as_echo "$as_me:$LINENO: result: $LIPO" >&5
-$as_echo "$LIPO" >&6; }
-else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
-$as_echo "no" >&6; }
-fi
 
 
-fi
-if test -z "$ac_cv_prog_LIPO"; then
-  ac_ct_LIPO=$LIPO
-  # Extract the first word of "lipo", so it can be a program name with args.
-set dummy lipo; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
-$as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_ac_ct_LIPO+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  if test -n "$ac_ct_LIPO"; then
-  ac_cv_prog_ac_ct_LIPO="$ac_ct_LIPO" # Let the user override the test.
-else
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
-    ac_cv_prog_ac_ct_LIPO="lipo"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
-  fi
-done
-done
-IFS=$as_save_IFS
 
-fi
-fi
-ac_ct_LIPO=$ac_cv_prog_ac_ct_LIPO
-if test -n "$ac_ct_LIPO"; then
-  { $as_echo "$as_me:$LINENO: result: $ac_ct_LIPO" >&5
-$as_echo "$ac_ct_LIPO" >&6; }
+
+: ${CP="cp -f"}
+: ${MV="mv -f"}
+: ${RM="rm -f"}
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether the shell understands some XSI constructs" >&5
+$as_echo_n "checking whether the shell understands some XSI constructs... " >&6; }
+# Try some XSI features
+xsi_shell=no
+( _lt_dummy="a/b/c"
+  test "${_lt_dummy##*/},${_lt_dummy%/*},${_lt_dummy#??}"${_lt_dummy%"$_lt_dummy"}, \
+      = c,a/b,b/c, \
+    && eval 'test $(( 1 + 1 )) -eq 2 \
+    && test "${#_lt_dummy}" -eq 5' ) >/dev/null 2>&1 \
+  && xsi_shell=yes
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $xsi_shell" >&5
+$as_echo "$xsi_shell" >&6; }
+
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether the shell understands \"+=\"" >&5
+$as_echo_n "checking whether the shell understands \"+=\"... " >&6; }
+lt_shell_append=no
+( foo=bar; set foo baz; eval "$1+=\$2" && test "$foo" = barbaz ) \
+    >/dev/null 2>&1 \
+  && lt_shell_append=yes
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_shell_append" >&5
+$as_echo "$lt_shell_append" >&6; }
+
+
+if ( (MAIL=60; unset MAIL) || exit) >/dev/null 2>&1; then
+  lt_unset=unset
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
-$as_echo "no" >&6; }
+  lt_unset=false
 fi
 
-  if test "x$ac_ct_LIPO" = x; then
-    LIPO=":"
-  else
-    case $cross_compiling:$ac_tool_warned in
-yes:)
-{ $as_echo "$as_me:$LINENO: WARNING: using cross tools not prefixed with host triplet" >&5
-$as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
-ac_tool_warned=yes ;;
+
+
+
+
+# test EBCDIC or ASCII
+case `echo X|tr X '\101'` in
+ A) # ASCII based system
+    # \n is not interpreted correctly by Solaris 8 /usr/ucb/tr
+  lt_SP2NL='tr \040 \012'
+  lt_NL2SP='tr \015\012 \040\040'
+  ;;
+ *) # EBCDIC based system
+  lt_SP2NL='tr \100 \n'
+  lt_NL2SP='tr \r\n \100\100'
+  ;;
 esac
-    LIPO=$ac_ct_LIPO
-  fi
-else
-  LIPO="$ac_cv_prog_LIPO"
-fi
 
-    if test -n "$ac_tool_prefix"; then
-  # Extract the first word of "${ac_tool_prefix}otool", so it can be a program name with args.
-set dummy ${ac_tool_prefix}otool; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
-$as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_OTOOL+set}" = set; then
+
+
+
+
+
+
+
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking how to convert $build file names to $host format" >&5
+$as_echo_n "checking how to convert $build file names to $host format... " >&6; }
+if ${lt_cv_to_host_file_cmd+:} false; then :
   $as_echo_n "(cached) " >&6
 else
-  if test -n "$OTOOL"; then
-  ac_cv_prog_OTOOL="$OTOOL" # Let the user override the test.
-else
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
-    ac_cv_prog_OTOOL="${ac_tool_prefix}otool"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
-  fi
-done
-done
-IFS=$as_save_IFS
+  case $host in
+  *-*-mingw* )
+    case $build in
+      *-*-mingw* ) # actually msys
+        lt_cv_to_host_file_cmd=func_convert_file_msys_to_w32
+        ;;
+      *-*-cygwin* )
+        lt_cv_to_host_file_cmd=func_convert_file_cygwin_to_w32
+        ;;
+      * ) # otherwise, assume *nix
+        lt_cv_to_host_file_cmd=func_convert_file_nix_to_w32
+        ;;
+    esac
+    ;;
+  *-*-cygwin* )
+    case $build in
+      *-*-mingw* ) # actually msys
+        lt_cv_to_host_file_cmd=func_convert_file_msys_to_cygwin
+        ;;
+      *-*-cygwin* )
+        lt_cv_to_host_file_cmd=func_convert_file_noop
+        ;;
+      * ) # otherwise, assume *nix
+        lt_cv_to_host_file_cmd=func_convert_file_nix_to_cygwin
+        ;;
+    esac
+    ;;
+  * ) # unhandled hosts (and "normal" native builds)
+    lt_cv_to_host_file_cmd=func_convert_file_noop
+    ;;
+esac
 
 fi
-fi
-OTOOL=$ac_cv_prog_OTOOL
-if test -n "$OTOOL"; then
-  { $as_echo "$as_me:$LINENO: result: $OTOOL" >&5
-$as_echo "$OTOOL" >&6; }
-else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
-$as_echo "no" >&6; }
-fi
 
+to_host_file_cmd=$lt_cv_to_host_file_cmd
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_to_host_file_cmd" >&5
+$as_echo "$lt_cv_to_host_file_cmd" >&6; }
 
-fi
-if test -z "$ac_cv_prog_OTOOL"; then
-  ac_ct_OTOOL=$OTOOL
-  # Extract the first word of "otool", so it can be a program name with args.
-set dummy otool; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
-$as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_ac_ct_OTOOL+set}" = set; then
+
+
+
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking how to convert $build file names to toolchain format" >&5
+$as_echo_n "checking how to convert $build file names to toolchain format... " >&6; }
+if ${lt_cv_to_tool_file_cmd+:} false; then :
   $as_echo_n "(cached) " >&6
 else
-  if test -n "$ac_ct_OTOOL"; then
-  ac_cv_prog_ac_ct_OTOOL="$ac_ct_OTOOL" # Let the user override the test.
-else
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
-    ac_cv_prog_ac_ct_OTOOL="otool"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
-  fi
-done
-done
-IFS=$as_save_IFS
+  #assume ordinary cross tools, or native build.
+lt_cv_to_tool_file_cmd=func_convert_file_noop
+case $host in
+  *-*-mingw* )
+    case $build in
+      *-*-mingw* ) # actually msys
+        lt_cv_to_tool_file_cmd=func_convert_file_msys_to_w32
+        ;;
+    esac
+    ;;
+esac
 
 fi
-fi
-ac_ct_OTOOL=$ac_cv_prog_ac_ct_OTOOL
-if test -n "$ac_ct_OTOOL"; then
-  { $as_echo "$as_me:$LINENO: result: $ac_ct_OTOOL" >&5
-$as_echo "$ac_ct_OTOOL" >&6; }
-else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
-$as_echo "no" >&6; }
-fi
 
-  if test "x$ac_ct_OTOOL" = x; then
-    OTOOL=":"
-  else
-    case $cross_compiling:$ac_tool_warned in
-yes:)
-{ $as_echo "$as_me:$LINENO: WARNING: using cross tools not prefixed with host triplet" >&5
-$as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
-ac_tool_warned=yes ;;
-esac
-    OTOOL=$ac_ct_OTOOL
-  fi
+to_tool_file_cmd=$lt_cv_to_tool_file_cmd
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_to_tool_file_cmd" >&5
+$as_echo "$lt_cv_to_tool_file_cmd" >&6; }
+
+
+
+
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $LD option to reload object files" >&5
+$as_echo_n "checking for $LD option to reload object files... " >&6; }
+if ${lt_cv_ld_reload_flag+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
-  OTOOL="$ac_cv_prog_OTOOL"
+  lt_cv_ld_reload_flag='-r'
 fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_ld_reload_flag" >&5
+$as_echo "$lt_cv_ld_reload_flag" >&6; }
+reload_flag=$lt_cv_ld_reload_flag
+case $reload_flag in
+"" | " "*) ;;
+*) reload_flag=" $reload_flag" ;;
+esac
+reload_cmds='$LD$reload_flag -o $output$reload_objs'
+case $host_os in
+  cygwin* | mingw* | pw32* | cegcc*)
+    if test "$GCC" != yes; then
+      reload_cmds=false
+    fi
+    ;;
+  darwin*)
+    if test "$GCC" = yes; then
+      reload_cmds='$LTCC $LTCFLAGS -nostdlib ${wl}-r -o $output$reload_objs'
+    else
+      reload_cmds='$LD$reload_flag -o $output$reload_objs'
+    fi
+    ;;
+esac
+
+
 
-    if test -n "$ac_tool_prefix"; then
-  # Extract the first word of "${ac_tool_prefix}otool64", so it can be a program name with args.
-set dummy ${ac_tool_prefix}otool64; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+
+
+
+
+
+
+if test -n "$ac_tool_prefix"; then
+  # Extract the first word of "${ac_tool_prefix}objdump", so it can be a program name with args.
+set dummy ${ac_tool_prefix}objdump; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_OTOOL64+set}" = set; then
+if ${ac_cv_prog_OBJDUMP+:} false; then :
   $as_echo_n "(cached) " >&6
 else
-  if test -n "$OTOOL64"; then
-  ac_cv_prog_OTOOL64="$OTOOL64" # Let the user override the test.
+  if test -n "$OBJDUMP"; then
+  ac_cv_prog_OBJDUMP="$OBJDUMP" # Let the user override the test.
 else
 as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
 for as_dir in $PATH
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
-    ac_cv_prog_OTOOL64="${ac_tool_prefix}otool64"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_OBJDUMP="${ac_tool_prefix}objdump"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
-OTOOL64=$ac_cv_prog_OTOOL64
-if test -n "$OTOOL64"; then
-  { $as_echo "$as_me:$LINENO: result: $OTOOL64" >&5
-$as_echo "$OTOOL64" >&6; }
+OBJDUMP=$ac_cv_prog_OBJDUMP
+if test -n "$OBJDUMP"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $OBJDUMP" >&5
+$as_echo "$OBJDUMP" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
 
 fi
-if test -z "$ac_cv_prog_OTOOL64"; then
-  ac_ct_OTOOL64=$OTOOL64
-  # Extract the first word of "otool64", so it can be a program name with args.
-set dummy otool64; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+if test -z "$ac_cv_prog_OBJDUMP"; then
+  ac_ct_OBJDUMP=$OBJDUMP
+  # Extract the first word of "objdump", so it can be a program name with args.
+set dummy objdump; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_ac_ct_OTOOL64+set}" = set; then
+if ${ac_cv_prog_ac_ct_OBJDUMP+:} false; then :
   $as_echo_n "(cached) " >&6
 else
-  if test -n "$ac_ct_OTOOL64"; then
-  ac_cv_prog_ac_ct_OTOOL64="$ac_ct_OTOOL64" # Let the user override the test.
+  if test -n "$ac_ct_OBJDUMP"; then
+  ac_cv_prog_ac_ct_OBJDUMP="$ac_ct_OBJDUMP" # Let the user override the test.
 else
 as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
 for as_dir in $PATH
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
-    ac_cv_prog_ac_ct_OTOOL64="otool64"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_ac_ct_OBJDUMP="objdump"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
-ac_ct_OTOOL64=$ac_cv_prog_ac_ct_OTOOL64
-if test -n "$ac_ct_OTOOL64"; then
-  { $as_echo "$as_me:$LINENO: result: $ac_ct_OTOOL64" >&5
-$as_echo "$ac_ct_OTOOL64" >&6; }
+ac_ct_OBJDUMP=$ac_cv_prog_ac_ct_OBJDUMP
+if test -n "$ac_ct_OBJDUMP"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_OBJDUMP" >&5
+$as_echo "$ac_ct_OBJDUMP" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
-  if test "x$ac_ct_OTOOL64" = x; then
-    OTOOL64=":"
-  else
-    case $cross_compiling:$ac_tool_warned in
-yes:)
-{ $as_echo "$as_me:$LINENO: WARNING: using cross tools not prefixed with host triplet" >&5
-$as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
-ac_tool_warned=yes ;;
+  if test "x$ac_ct_OBJDUMP" = x; then
+    OBJDUMP="false"
+  else
+    case $cross_compiling:$ac_tool_warned in
+yes:)
+{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
+$as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
+ac_tool_warned=yes ;;
+esac
+    OBJDUMP=$ac_ct_OBJDUMP
+  fi
+else
+  OBJDUMP="$ac_cv_prog_OBJDUMP"
+fi
+
+test -z "$OBJDUMP" && OBJDUMP=objdump
+
+
+
+
+
+
+
+
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking how to recognize dependent libraries" >&5
+$as_echo_n "checking how to recognize dependent libraries... " >&6; }
+if ${lt_cv_deplibs_check_method+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  lt_cv_file_magic_cmd='$MAGIC_CMD'
+lt_cv_file_magic_test_file=
+lt_cv_deplibs_check_method='unknown'
+# Need to set the preceding variable on all platforms that support
+# interlibrary dependencies.
+# 'none' -- dependencies not supported.
+# `unknown' -- same as none, but documents that we really don't know.
+# 'pass_all' -- all dependencies passed with no checks.
+# 'test_compile' -- check by making test program.
+# 'file_magic [[regex]]' -- check by looking for files in library path
+# which responds to the $file_magic_cmd with a given extended regex.
+# If you have `file' or equivalent on your system and you're not sure
+# whether `pass_all' will *always* work, you probably want this one.
+
+case $host_os in
+aix[4-9]*)
+  lt_cv_deplibs_check_method=pass_all
+  ;;
+
+beos*)
+  lt_cv_deplibs_check_method=pass_all
+  ;;
+
+bsdi[45]*)
+  lt_cv_deplibs_check_method='file_magic ELF [0-9][0-9]*-bit [ML]SB (shared object|dynamic lib)'
+  lt_cv_file_magic_cmd='/usr/bin/file -L'
+  lt_cv_file_magic_test_file=/shlib/libc.so
+  ;;
+
+cygwin*)
+  # func_win32_libid is a shell function defined in ltmain.sh
+  lt_cv_deplibs_check_method='file_magic ^x86 archive import|^x86 DLL'
+  lt_cv_file_magic_cmd='func_win32_libid'
+  ;;
+
+mingw* | pw32*)
+  # Base MSYS/MinGW do not provide the 'file' command needed by
+  # func_win32_libid shell function, so use a weaker test based on 'objdump',
+  # unless we find 'file', for example because we are cross-compiling.
+  # func_win32_libid assumes BSD nm, so disallow it if using MS dumpbin.
+  if ( test "$lt_cv_nm_interface" = "BSD nm" && file / ) >/dev/null 2>&1; then
+    lt_cv_deplibs_check_method='file_magic ^x86 archive import|^x86 DLL'
+    lt_cv_file_magic_cmd='func_win32_libid'
+  else
+    # Keep this pattern in sync with the one in func_win32_libid.
+    lt_cv_deplibs_check_method='file_magic file format (pei*-i386(.*architecture: i386)?|pe-arm-wince|pe-x86-64)'
+    lt_cv_file_magic_cmd='$OBJDUMP -f'
+  fi
+  ;;
+
+cegcc*)
+  # use the weaker test based on 'objdump'. See mingw*.
+  lt_cv_deplibs_check_method='file_magic file format pe-arm-.*little(.*architecture: arm)?'
+  lt_cv_file_magic_cmd='$OBJDUMP -f'
+  ;;
+
+darwin* | rhapsody*)
+  lt_cv_deplibs_check_method=pass_all
+  ;;
+
+freebsd* | dragonfly*)
+  if echo __ELF__ | $CC -E - | $GREP __ELF__ > /dev/null; then
+    case $host_cpu in
+    i*86 )
+      # Not sure whether the presence of OpenBSD here was a mistake.
+      # Let's accept both of them until this is cleared up.
+      lt_cv_deplibs_check_method='file_magic (FreeBSD|OpenBSD|DragonFly)/i[3-9]86 (compact )?demand paged shared library'
+      lt_cv_file_magic_cmd=/usr/bin/file
+      lt_cv_file_magic_test_file=`echo /usr/lib/libc.so.*`
+      ;;
+    esac
+  else
+    lt_cv_deplibs_check_method=pass_all
+  fi
+  ;;
+
+gnu*)
+  lt_cv_deplibs_check_method=pass_all
+  ;;
+
+haiku*)
+  lt_cv_deplibs_check_method=pass_all
+  ;;
+
+hpux10.20* | hpux11*)
+  lt_cv_file_magic_cmd=/usr/bin/file
+  case $host_cpu in
+  ia64*)
+    lt_cv_deplibs_check_method='file_magic (s[0-9][0-9][0-9]|ELF-[0-9][0-9]) shared object file - IA64'
+    lt_cv_file_magic_test_file=/usr/lib/hpux32/libc.so
+    ;;
+  hppa*64*)
+    lt_cv_deplibs_check_method='file_magic (s[0-9][0-9][0-9]|ELF[ -][0-9][0-9])(-bit)?( [LM]SB)? shared object( file)?[, -]* PA-RISC [0-9]\.[0-9]'
+    lt_cv_file_magic_test_file=/usr/lib/pa20_64/libc.sl
+    ;;
+  *)
+    lt_cv_deplibs_check_method='file_magic (s[0-9][0-9][0-9]|PA-RISC[0-9]\.[0-9]) shared library'
+    lt_cv_file_magic_test_file=/usr/lib/libc.sl
+    ;;
+  esac
+  ;;
+
+interix[3-9]*)
+  # PIC code is broken on Interix 3.x, that's why |\.a not |_pic\.a here
+  lt_cv_deplibs_check_method='match_pattern /lib[^/]+(\.so|\.a)$'
+  ;;
+
+irix5* | irix6* | nonstopux*)
+  case $LD in
+  *-32|*"-32 ") libmagic=32-bit;;
+  *-n32|*"-n32 ") libmagic=N32;;
+  *-64|*"-64 ") libmagic=64-bit;;
+  *) libmagic=never-match;;
+  esac
+  lt_cv_deplibs_check_method=pass_all
+  ;;
+
+# This must be glibc/ELF.
+linux* | k*bsd*-gnu | kopensolaris*-gnu)
+  lt_cv_deplibs_check_method=pass_all
+  ;;
+
+netbsd*)
+  if echo __ELF__ | $CC -E - | $GREP __ELF__ > /dev/null; then
+    lt_cv_deplibs_check_method='match_pattern /lib[^/]+(\.so\.[0-9]+\.[0-9]+|_pic\.a)$'
+  else
+    lt_cv_deplibs_check_method='match_pattern /lib[^/]+(\.so|_pic\.a)$'
+  fi
+  ;;
+
+newos6*)
+  lt_cv_deplibs_check_method='file_magic ELF [0-9][0-9]*-bit [ML]SB (executable|dynamic lib)'
+  lt_cv_file_magic_cmd=/usr/bin/file
+  lt_cv_file_magic_test_file=/usr/lib/libnls.so
+  ;;
+
+*nto* | *qnx*)
+  lt_cv_deplibs_check_method=pass_all
+  ;;
+
+openbsd*)
+  if test -z "`echo __ELF__ | $CC -E - | $GREP __ELF__`" || test "$host_os-$host_cpu" = "openbsd2.8-powerpc"; then
+    lt_cv_deplibs_check_method='match_pattern /lib[^/]+(\.so\.[0-9]+\.[0-9]+|\.so|_pic\.a)$'
+  else
+    lt_cv_deplibs_check_method='match_pattern /lib[^/]+(\.so\.[0-9]+\.[0-9]+|_pic\.a)$'
+  fi
+  ;;
+
+osf3* | osf4* | osf5*)
+  lt_cv_deplibs_check_method=pass_all
+  ;;
+
+rdos*)
+  lt_cv_deplibs_check_method=pass_all
+  ;;
+
+solaris*)
+  lt_cv_deplibs_check_method=pass_all
+  ;;
+
+sysv5* | sco3.2v5* | sco5v6* | unixware* | OpenUNIX* | sysv4*uw2*)
+  lt_cv_deplibs_check_method=pass_all
+  ;;
+
+sysv4 | sysv4.3*)
+  case $host_vendor in
+  motorola)
+    lt_cv_deplibs_check_method='file_magic ELF [0-9][0-9]*-bit [ML]SB (shared object|dynamic lib) M[0-9][0-9]* Version [0-9]'
+    lt_cv_file_magic_test_file=`echo /usr/lib/libc.so*`
+    ;;
+  ncr)
+    lt_cv_deplibs_check_method=pass_all
+    ;;
+  sequent)
+    lt_cv_file_magic_cmd='/bin/file'
+    lt_cv_deplibs_check_method='file_magic ELF [0-9][0-9]*-bit [LM]SB (shared object|dynamic lib )'
+    ;;
+  sni)
+    lt_cv_file_magic_cmd='/bin/file'
+    lt_cv_deplibs_check_method="file_magic ELF [0-9][0-9]*-bit [LM]SB dynamic lib"
+    lt_cv_file_magic_test_file=/lib/libc.so
+    ;;
+  siemens)
+    lt_cv_deplibs_check_method=pass_all
+    ;;
+  pc)
+    lt_cv_deplibs_check_method=pass_all
+    ;;
+  esac
+  ;;
+
+tpf*)
+  lt_cv_deplibs_check_method=pass_all
+  ;;
 esac
-    OTOOL64=$ac_ct_OTOOL64
-  fi
-else
-  OTOOL64="$ac_cv_prog_OTOOL64"
-fi
-
-
 
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_deplibs_check_method" >&5
+$as_echo "$lt_cv_deplibs_check_method" >&6; }
 
+file_magic_glob=
+want_nocaseglob=no
+if test "$build" = "$host"; then
+  case $host_os in
+  mingw* | pw32*)
+    if ( shopt | grep nocaseglob ) >/dev/null 2>&1; then
+      want_nocaseglob=yes
+    else
+      file_magic_glob=`echo aAbBcCdDeEfFgGhHiIjJkKlLmMnNoOpPqQrRsStTuUvVwWxXyYzZ | $SED -e "s/\(..\)/s\/[\1]\/[\1]\/g;/g"`
+    fi
+    ;;
+  esac
+fi
 
+file_magic_cmd=$lt_cv_file_magic_cmd
+deplibs_check_method=$lt_cv_deplibs_check_method
+test -z "$deplibs_check_method" && deplibs_check_method=unknown
 
 
 
@@ -5630,549 +4978,312 @@ fi
 
 
 
-    { $as_echo "$as_me:$LINENO: checking for -single_module linker flag" >&5
-$as_echo_n "checking for -single_module linker flag... " >&6; }
-if test "${lt_cv_apple_cc_single_mod+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  lt_cv_apple_cc_single_mod=no
-      if test -z "${LT_MULTI_MODULE}"; then
-	# By default we will add the -single_module flag. You can override
-	# by either setting the environment variable LT_MULTI_MODULE
-	# non-empty at configure time, or by adding -multi_module to the
-	# link flags.
-	rm -rf libconftest.dylib*
-	echo "int foo(void){return 1;}" > conftest.c
-	echo "$LTCC $LTCFLAGS $LDFLAGS -o libconftest.dylib \
--dynamiclib -Wl,-single_module conftest.c" >&5
-	$LTCC $LTCFLAGS $LDFLAGS -o libconftest.dylib \
-	  -dynamiclib -Wl,-single_module conftest.c 2>conftest.err
-        _lt_result=$?
-	if test -f libconftest.dylib && test ! -s conftest.err && test $_lt_result = 0; then
-	  lt_cv_apple_cc_single_mod=yes
-	else
-	  cat conftest.err >&5
-	fi
-	rm -rf libconftest.dylib*
-	rm -f conftest.*
-      fi
-fi
-{ $as_echo "$as_me:$LINENO: result: $lt_cv_apple_cc_single_mod" >&5
-$as_echo "$lt_cv_apple_cc_single_mod" >&6; }
-    { $as_echo "$as_me:$LINENO: checking for -exported_symbols_list linker flag" >&5
-$as_echo_n "checking for -exported_symbols_list linker flag... " >&6; }
-if test "${lt_cv_ld_exported_symbols_list+set}" = set; then
+if test -n "$ac_tool_prefix"; then
+  # Extract the first word of "${ac_tool_prefix}dlltool", so it can be a program name with args.
+set dummy ${ac_tool_prefix}dlltool; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_DLLTOOL+:} false; then :
   $as_echo_n "(cached) " >&6
 else
-  lt_cv_ld_exported_symbols_list=no
-      save_LDFLAGS=$LDFLAGS
-      echo "_main" > conftest.sym
-      LDFLAGS="$LDFLAGS -Wl,-exported_symbols_list,conftest.sym"
-      cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-
-int
-main ()
-{
-
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest$ac_exeext && {
-	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
-       }; then
-  lt_cv_ld_exported_symbols_list=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	lt_cv_ld_exported_symbols_list=no
-fi
-
-rm -rf conftest.dSYM
-rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
-      conftest$ac_exeext conftest.$ac_ext
-	LDFLAGS="$save_LDFLAGS"
-
-fi
-{ $as_echo "$as_me:$LINENO: result: $lt_cv_ld_exported_symbols_list" >&5
-$as_echo "$lt_cv_ld_exported_symbols_list" >&6; }
-    case $host_os in
-    rhapsody* | darwin1.[012])
-      _lt_dar_allow_undefined='${wl}-undefined ${wl}suppress' ;;
-    darwin1.*)
-      _lt_dar_allow_undefined='${wl}-flat_namespace ${wl}-undefined ${wl}suppress' ;;
-    darwin*) # darwin 5.x on
-      # if running on 10.5 or later, the deployment target defaults
-      # to the OS version, if on x86, and 10.4, the deployment
-      # target defaults to 10.4. Don't you love it?
-      case ${MACOSX_DEPLOYMENT_TARGET-10.0},$host in
-	10.0,*86*-darwin8*|10.0,*-darwin[91]*)
-	  _lt_dar_allow_undefined='${wl}-undefined ${wl}dynamic_lookup' ;;
-	10.[012]*)
-	  _lt_dar_allow_undefined='${wl}-flat_namespace ${wl}-undefined ${wl}suppress' ;;
-	10.*)
-	  _lt_dar_allow_undefined='${wl}-undefined ${wl}dynamic_lookup' ;;
-      esac
-    ;;
-  esac
-    if test "$lt_cv_apple_cc_single_mod" = "yes"; then
-      _lt_dar_single_mod='$single_module'
-    fi
-    if test "$lt_cv_ld_exported_symbols_list" = "yes"; then
-      _lt_dar_export_syms=' ${wl}-exported_symbols_list,$output_objdir/${libname}-symbols.expsym'
-    else
-      _lt_dar_export_syms='~$NMEDIT -s $output_objdir/${libname}-symbols.expsym ${lib}'
-    fi
-    if test "$DSYMUTIL" != ":"; then
-      _lt_dsymutil='~$DSYMUTIL $lib || :'
-    else
-      _lt_dsymutil=
-    fi
-    ;;
-  esac
-
-ac_ext=c
-ac_cpp='$CPP $CPPFLAGS'
-ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
-ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
-ac_compiler_gnu=$ac_cv_c_compiler_gnu
-{ $as_echo "$as_me:$LINENO: checking how to run the C preprocessor" >&5
-$as_echo_n "checking how to run the C preprocessor... " >&6; }
-# On Suns, sometimes $CPP names a directory.
-if test -n "$CPP" && test -d "$CPP"; then
-  CPP=
-fi
-if test -z "$CPP"; then
-  if test "${ac_cv_prog_CPP+set}" = set; then
-  $as_echo_n "(cached) " >&6
+  if test -n "$DLLTOOL"; then
+  ac_cv_prog_DLLTOOL="$DLLTOOL" # Let the user override the test.
 else
-      # Double quotes because CPP needs to be expanded
-    for CPP in "$CC -E" "$CC -E -traditional-cpp" "/lib/cpp"
-    do
-      ac_preproc_ok=false
-for ac_c_preproc_warn_flag in '' yes
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
 do
-  # Use a header file that comes with gcc, so configuring glibc
-  # with a fresh cross-compiler works.
-  # Prefer <limits.h> to <assert.h> if __STDC__ is defined, since
-  # <limits.h> exists even on freestanding compilers.
-  # On the NeXT, cc -E runs the code through the compiler's parser,
-  # not just through cpp. "Syntax error" is here to catch this case.
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#ifdef __STDC__
-# include <limits.h>
-#else
-# include <assert.h>
-#endif
-		     Syntax error
-_ACEOF
-if { (ac_try="$ac_cpp conftest.$ac_ext"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_cpp conftest.$ac_ext") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } >/dev/null && {
-	 test -z "$ac_c_preproc_warn_flag$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       }; then
-  :
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-  # Broken: fails on valid input.
-continue
-fi
-
-rm -f conftest.err conftest.$ac_ext
-
-  # OK, works on sane cases.  Now check whether nonexistent headers
-  # can be detected and how.
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <ac_nonexistent.h>
-_ACEOF
-if { (ac_try="$ac_cpp conftest.$ac_ext"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_cpp conftest.$ac_ext") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } >/dev/null && {
-	 test -z "$ac_c_preproc_warn_flag$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       }; then
-  # Broken: success on invalid input.
-continue
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-  # Passes both tests.
-ac_preproc_ok=:
-break
-fi
-
-rm -f conftest.err conftest.$ac_ext
-
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_DLLTOOL="${ac_tool_prefix}dlltool"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
 done
-# Because of `break', _AC_PREPROC_IFELSE's cleaning code was skipped.
-rm -f conftest.err conftest.$ac_ext
-if $ac_preproc_ok; then
-  break
-fi
-
-    done
-    ac_cv_prog_CPP=$CPP
+  done
+IFS=$as_save_IFS
 
 fi
-  CPP=$ac_cv_prog_CPP
-else
-  ac_cv_prog_CPP=$CPP
 fi
-{ $as_echo "$as_me:$LINENO: result: $CPP" >&5
-$as_echo "$CPP" >&6; }
-ac_preproc_ok=false
-for ac_c_preproc_warn_flag in '' yes
-do
-  # Use a header file that comes with gcc, so configuring glibc
-  # with a fresh cross-compiler works.
-  # Prefer <limits.h> to <assert.h> if __STDC__ is defined, since
-  # <limits.h> exists even on freestanding compilers.
-  # On the NeXT, cc -E runs the code through the compiler's parser,
-  # not just through cpp. "Syntax error" is here to catch this case.
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#ifdef __STDC__
-# include <limits.h>
-#else
-# include <assert.h>
-#endif
-		     Syntax error
-_ACEOF
-if { (ac_try="$ac_cpp conftest.$ac_ext"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_cpp conftest.$ac_ext") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } >/dev/null && {
-	 test -z "$ac_c_preproc_warn_flag$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       }; then
-  :
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-  # Broken: fails on valid input.
-continue
+DLLTOOL=$ac_cv_prog_DLLTOOL
+if test -n "$DLLTOOL"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $DLLTOOL" >&5
+$as_echo "$DLLTOOL" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 fi
 
-rm -f conftest.err conftest.$ac_ext
 
-  # OK, works on sane cases.  Now check whether nonexistent headers
-  # can be detected and how.
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <ac_nonexistent.h>
-_ACEOF
-if { (ac_try="$ac_cpp conftest.$ac_ext"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_cpp conftest.$ac_ext") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } >/dev/null && {
-	 test -z "$ac_c_preproc_warn_flag$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       }; then
-  # Broken: success on invalid input.
-continue
+fi
+if test -z "$ac_cv_prog_DLLTOOL"; then
+  ac_ct_DLLTOOL=$DLLTOOL
+  # Extract the first word of "dlltool", so it can be a program name with args.
+set dummy dlltool; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_ac_ct_DLLTOOL+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+  if test -n "$ac_ct_DLLTOOL"; then
+  ac_cv_prog_ac_ct_DLLTOOL="$ac_ct_DLLTOOL" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_ac_ct_DLLTOOL="dlltool"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
 
-  # Passes both tests.
-ac_preproc_ok=:
-break
+fi
+fi
+ac_ct_DLLTOOL=$ac_cv_prog_ac_ct_DLLTOOL
+if test -n "$ac_ct_DLLTOOL"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_DLLTOOL" >&5
+$as_echo "$ac_ct_DLLTOOL" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 fi
 
-rm -f conftest.err conftest.$ac_ext
-
-done
-# Because of `break', _AC_PREPROC_IFELSE's cleaning code was skipped.
-rm -f conftest.err conftest.$ac_ext
-if $ac_preproc_ok; then
-  :
+  if test "x$ac_ct_DLLTOOL" = x; then
+    DLLTOOL="false"
+  else
+    case $cross_compiling:$ac_tool_warned in
+yes:)
+{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
+$as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
+ac_tool_warned=yes ;;
+esac
+    DLLTOOL=$ac_ct_DLLTOOL
+  fi
 else
-  { { $as_echo "$as_me:$LINENO: error: in \`$ac_pwd':" >&5
-$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-{ { $as_echo "$as_me:$LINENO: error: C preprocessor \"$CPP\" fails sanity check
-See \`config.log' for more details." >&5
-$as_echo "$as_me: error: C preprocessor \"$CPP\" fails sanity check
-See \`config.log' for more details." >&2;}
-   { (exit 1); exit 1; }; }; }
+  DLLTOOL="$ac_cv_prog_DLLTOOL"
 fi
 
-ac_ext=c
-ac_cpp='$CPP $CPPFLAGS'
-ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
-ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
-ac_compiler_gnu=$ac_cv_c_compiler_gnu
+test -z "$DLLTOOL" && DLLTOOL=dlltool
 
 
-{ $as_echo "$as_me:$LINENO: checking for ANSI C header files" >&5
-$as_echo_n "checking for ANSI C header files... " >&6; }
-if test "${ac_cv_header_stdc+set}" = set; then
+
+
+
+
+
+
+
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking how to associate runtime and link libraries" >&5
+$as_echo_n "checking how to associate runtime and link libraries... " >&6; }
+if ${lt_cv_sharedlib_from_linklib_cmd+:} false; then :
   $as_echo_n "(cached) " >&6
 else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <stdlib.h>
-#include <stdarg.h>
-#include <string.h>
-#include <float.h>
-
-int
-main ()
-{
+  lt_cv_sharedlib_from_linklib_cmd='unknown'
 
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
+case $host_os in
+cygwin* | mingw* | pw32* | cegcc*)
+  # two different shell functions defined in ltmain.sh
+  # decide which to use based on capabilities of $DLLTOOL
+  case `$DLLTOOL --help 2>&1` in
+  *--identify-strict*)
+    lt_cv_sharedlib_from_linklib_cmd=func_cygming_dll_for_implib
+    ;;
+  *)
+    lt_cv_sharedlib_from_linklib_cmd=func_cygming_dll_for_implib_fallback
+    ;;
+  esac
+  ;;
+*)
+  # fallback: assume linklib IS sharedlib
+  lt_cv_sharedlib_from_linklib_cmd="$ECHO"
+  ;;
 esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_cv_header_stdc=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
 
-	ac_cv_header_stdc=no
 fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_sharedlib_from_linklib_cmd" >&5
+$as_echo "$lt_cv_sharedlib_from_linklib_cmd" >&6; }
+sharedlib_from_linklib_cmd=$lt_cv_sharedlib_from_linklib_cmd
+test -z "$sharedlib_from_linklib_cmd" && sharedlib_from_linklib_cmd=$ECHO
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
-if test $ac_cv_header_stdc = yes; then
-  # SunOS 4.x string.h does not declare mem*, contrary to ANSI.
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <string.h>
 
-_ACEOF
-if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
-  $EGREP "memchr" >/dev/null 2>&1; then
-  :
-else
-  ac_cv_header_stdc=no
-fi
-rm -f conftest*
 
-fi
 
-if test $ac_cv_header_stdc = yes; then
-  # ISC 2.0.2 stdlib.h does not declare free, contrary to ANSI.
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <stdlib.h>
 
-_ACEOF
-if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
-  $EGREP "free" >/dev/null 2>&1; then
-  :
+
+
+if test -n "$ac_tool_prefix"; then
+  for ac_prog in ar
+  do
+    # Extract the first word of "$ac_tool_prefix$ac_prog", so it can be a program name with args.
+set dummy $ac_tool_prefix$ac_prog; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_AR+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
-  ac_cv_header_stdc=no
-fi
-rm -f conftest*
+  if test -n "$AR"; then
+  ac_cv_prog_AR="$AR" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_AR="$ac_tool_prefix$ac_prog"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
 
 fi
-
-if test $ac_cv_header_stdc = yes; then
-  # /bin/cc in Irix-4.0.5 gets non-ANSI ctype macros unless using -ansi.
-  if test "$cross_compiling" = yes; then
-  :
+fi
+AR=$ac_cv_prog_AR
+if test -n "$AR"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $AR" >&5
+$as_echo "$AR" >&6; }
 else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <ctype.h>
-#include <stdlib.h>
-#if ((' ' & 0x0FF) == 0x020)
-# define ISLOWER(c) ('a' <= (c) && (c) <= 'z')
-# define TOUPPER(c) (ISLOWER(c) ? 'A' + ((c) - 'a') : (c))
-#else
-# define ISLOWER(c) \
-		   (('a' <= (c) && (c) <= 'i') \
-		     || ('j' <= (c) && (c) <= 'r') \
-		     || ('s' <= (c) && (c) <= 'z'))
-# define TOUPPER(c) (ISLOWER(c) ? ((c) | 0x40) : (c))
-#endif
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
 
-#define XOR(e, f) (((e) && !(f)) || (!(e) && (f)))
-int
-main ()
-{
-  int i;
-  for (i = 0; i < 256; i++)
-    if (XOR (islower (i), ISLOWER (i))
-	|| toupper (i) != TOUPPER (i))
-      return 2;
-  return 0;
-}
-_ACEOF
-rm -f conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
-  :
+
+    test -n "$AR" && break
+  done
+fi
+if test -z "$AR"; then
+  ac_ct_AR=$AR
+  for ac_prog in ar
+do
+  # Extract the first word of "$ac_prog", so it can be a program name with args.
+set dummy $ac_prog; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_ac_ct_AR+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
-  $as_echo "$as_me: program exited with status $ac_status" >&5
-$as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+  if test -n "$ac_ct_AR"; then
+  ac_cv_prog_ac_ct_AR="$ac_ct_AR" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_ac_ct_AR="$ac_prog"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
 
-( exit $ac_status )
-ac_cv_header_stdc=no
 fi
-rm -rf conftest.dSYM
-rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
 fi
+ac_ct_AR=$ac_cv_prog_ac_ct_AR
+if test -n "$ac_ct_AR"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_AR" >&5
+$as_echo "$ac_ct_AR" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
+
+
+  test -n "$ac_ct_AR" && break
+done
+
+  if test "x$ac_ct_AR" = x; then
+    AR="false"
+  else
+    case $cross_compiling:$ac_tool_warned in
+yes:)
+{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
+$as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
+ac_tool_warned=yes ;;
+esac
+    AR=$ac_ct_AR
+  fi
+fi
+
+: ${AR=ar}
+: ${AR_FLAGS=cru}
+
+
+
+
+
+
+
+
+
+
 
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for archiver @FILE support" >&5
+$as_echo_n "checking for archiver @FILE support... " >&6; }
+if ${lt_cv_ar_at_file+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  lt_cv_ar_at_file=no
+   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
 
-fi
-fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_header_stdc" >&5
-$as_echo "$ac_cv_header_stdc" >&6; }
-if test $ac_cv_header_stdc = yes; then
+int
+main ()
+{
 
-cat >>confdefs.h <<\_ACEOF
-#define STDC_HEADERS 1
+  ;
+  return 0;
+}
 _ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  echo conftest.$ac_objext > conftest.lst
+      lt_ar_try='$AR $AR_FLAGS libconftest.a @conftest.lst >&5'
+      { { eval echo "\"\$as_me\":${as_lineno-$LINENO}: \"$lt_ar_try\""; } >&5
+  (eval $lt_ar_try) 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+      if test "$ac_status" -eq 0; then
+	# Ensure the archiver fails upon bogus file names.
+	rm -f conftest.$ac_objext libconftest.a
+	{ { eval echo "\"\$as_me\":${as_lineno-$LINENO}: \"$lt_ar_try\""; } >&5
+  (eval $lt_ar_try) 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+	if test "$ac_status" -ne 0; then
+          lt_cv_ar_at_file=@
+        fi
+      fi
+      rm -f conftest.* libconftest.a
 
 fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
-# On IRIX 5.3, sys/types and inttypes.h are conflicting.
-
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_ar_at_file" >&5
+$as_echo "$lt_cv_ar_at_file" >&6; }
 
+if test "x$lt_cv_ar_at_file" = xno; then
+  archiver_list_spec=
+else
+  archiver_list_spec=$lt_cv_ar_at_file
+fi
 
 
 
@@ -6180,165 +5291,240 @@ fi
 
 
 
-for ac_header in sys/types.h sys/stat.h stdlib.h string.h memory.h strings.h \
-		  inttypes.h stdint.h unistd.h
-do
-as_ac_Header=`$as_echo "ac_cv_header_$ac_header" | $as_tr_sh`
-{ $as_echo "$as_me:$LINENO: checking for $ac_header" >&5
-$as_echo_n "checking for $ac_header... " >&6; }
-if { as_var=$as_ac_Header; eval "test \"\${$as_var+set}\" = set"; }; then
+if test -n "$ac_tool_prefix"; then
+  # Extract the first word of "${ac_tool_prefix}strip", so it can be a program name with args.
+set dummy ${ac_tool_prefix}strip; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_STRIP+:} false; then :
   $as_echo_n "(cached) " >&6
 else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-$ac_includes_default
+  if test -n "$STRIP"; then
+  ac_cv_prog_STRIP="$STRIP" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_STRIP="${ac_tool_prefix}strip"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
 
-#include <$ac_header>
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  eval "$as_ac_Header=yes"
+fi
+fi
+STRIP=$ac_cv_prog_STRIP
+if test -n "$STRIP"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $STRIP" >&5
+$as_echo "$STRIP" >&6; }
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
+
 
-	eval "$as_ac_Header=no"
 fi
+if test -z "$ac_cv_prog_STRIP"; then
+  ac_ct_STRIP=$STRIP
+  # Extract the first word of "strip", so it can be a program name with args.
+set dummy strip; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_ac_ct_STRIP+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if test -n "$ac_ct_STRIP"; then
+  ac_cv_prog_ac_ct_STRIP="$ac_ct_STRIP" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_ac_ct_STRIP="strip"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 fi
-ac_res=`eval 'as_val=${'$as_ac_Header'}
-		 $as_echo "$as_val"'`
-	       { $as_echo "$as_me:$LINENO: result: $ac_res" >&5
-$as_echo "$ac_res" >&6; }
-as_val=`eval 'as_val=${'$as_ac_Header'}
-		 $as_echo "$as_val"'`
-   if test "x$as_val" = x""yes; then
-  cat >>confdefs.h <<_ACEOF
-#define `$as_echo "HAVE_$ac_header" | $as_tr_cpp` 1
-_ACEOF
+fi
+ac_ct_STRIP=$ac_cv_prog_ac_ct_STRIP
+if test -n "$ac_ct_STRIP"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_STRIP" >&5
+$as_echo "$ac_ct_STRIP" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
 
+  if test "x$ac_ct_STRIP" = x; then
+    STRIP=":"
+  else
+    case $cross_compiling:$ac_tool_warned in
+yes:)
+{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
+$as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
+ac_tool_warned=yes ;;
+esac
+    STRIP=$ac_ct_STRIP
+  fi
+else
+  STRIP="$ac_cv_prog_STRIP"
 fi
 
-done
+test -z "$STRIP" && STRIP=:
 
 
 
-for ac_header in dlfcn.h
-do
-as_ac_Header=`$as_echo "ac_cv_header_$ac_header" | $as_tr_sh`
-{ $as_echo "$as_me:$LINENO: checking for $ac_header" >&5
-$as_echo_n "checking for $ac_header... " >&6; }
-if { as_var=$as_ac_Header; eval "test \"\${$as_var+set}\" = set"; }; then
+
+
+
+if test -n "$ac_tool_prefix"; then
+  # Extract the first word of "${ac_tool_prefix}ranlib", so it can be a program name with args.
+set dummy ${ac_tool_prefix}ranlib; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_RANLIB+:} false; then :
   $as_echo_n "(cached) " >&6
 else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-$ac_includes_default
+  if test -n "$RANLIB"; then
+  ac_cv_prog_RANLIB="$RANLIB" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_RANLIB="${ac_tool_prefix}ranlib"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
 
-#include <$ac_header>
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  eval "$as_ac_Header=yes"
+fi
+fi
+RANLIB=$ac_cv_prog_RANLIB
+if test -n "$RANLIB"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $RANLIB" >&5
+$as_echo "$RANLIB" >&6; }
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
+
 
-	eval "$as_ac_Header=no"
 fi
+if test -z "$ac_cv_prog_RANLIB"; then
+  ac_ct_RANLIB=$RANLIB
+  # Extract the first word of "ranlib", so it can be a program name with args.
+set dummy ranlib; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_ac_ct_RANLIB+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if test -n "$ac_ct_RANLIB"; then
+  ac_cv_prog_ac_ct_RANLIB="$ac_ct_RANLIB" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_ac_ct_RANLIB="ranlib"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 fi
-ac_res=`eval 'as_val=${'$as_ac_Header'}
-		 $as_echo "$as_val"'`
-	       { $as_echo "$as_me:$LINENO: result: $ac_res" >&5
-$as_echo "$ac_res" >&6; }
-as_val=`eval 'as_val=${'$as_ac_Header'}
-		 $as_echo "$as_val"'`
-   if test "x$as_val" = x""yes; then
-  cat >>confdefs.h <<_ACEOF
-#define `$as_echo "HAVE_$ac_header" | $as_tr_cpp` 1
-_ACEOF
+fi
+ac_ct_RANLIB=$ac_cv_prog_ac_ct_RANLIB
+if test -n "$ac_ct_RANLIB"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_RANLIB" >&5
+$as_echo "$ac_ct_RANLIB" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
+
+  if test "x$ac_ct_RANLIB" = x; then
+    RANLIB=":"
+  else
+    case $cross_compiling:$ac_tool_warned in
+yes:)
+{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
+$as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
+ac_tool_warned=yes ;;
+esac
+    RANLIB=$ac_ct_RANLIB
+  fi
+else
+  RANLIB="$ac_cv_prog_RANLIB"
+fi
+
+test -z "$RANLIB" && RANLIB=:
+
 
+
+
+
+
+# Determine commands to create old-style static archives.
+old_archive_cmds='$AR $AR_FLAGS $oldlib$oldobjs'
+old_postinstall_cmds='chmod 644 $oldlib'
+old_postuninstall_cmds=
+
+if test -n "$RANLIB"; then
+  case $host_os in
+  openbsd*)
+    old_postinstall_cmds="$old_postinstall_cmds~\$RANLIB -t \$tool_oldlib"
+    ;;
+  *)
+    old_postinstall_cmds="$old_postinstall_cmds~\$RANLIB \$tool_oldlib"
+    ;;
+  esac
+  old_archive_cmds="$old_archive_cmds~\$RANLIB \$tool_oldlib"
 fi
 
-done
+case $host_os in
+  darwin*)
+    lock_old_archive_extraction=yes ;;
+  *)
+    lock_old_archive_extraction=no ;;
+esac
+
+
+
 
 
 
-# Set options
 
 
 
-        enable_dlopen=no
 
 
-  enable_win32_dll=no
 
 
-            # Check whether --enable-shared was given.
-if test "${enable_shared+set}" = set; then
-  enableval=$enable_shared; p=${PACKAGE-default}
-    case $enableval in
-    yes) enable_shared=yes ;;
-    no) enable_shared=no ;;
-    *)
-      enable_shared=no
-      # Look at the argument we got.  We use all the common list separators.
-      lt_save_ifs="$IFS"; IFS="${IFS}$PATH_SEPARATOR,"
-      for pkg in $enableval; do
-	IFS="$lt_save_ifs"
-	if test "X$pkg" = "X$p"; then
-	  enable_shared=yes
-	fi
-      done
-      IFS="$lt_save_ifs"
-      ;;
-    esac
-else
-  enable_shared=yes
-fi
 
 
 
@@ -6347,31 +5533,47 @@ fi
 
 
 
+for ac_prog in gawk mawk nawk awk
+do
+  # Extract the first word of "$ac_prog", so it can be a program name with args.
+set dummy $ac_prog; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_AWK+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if test -n "$AWK"; then
+  ac_cv_prog_AWK="$AWK" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_AWK="$ac_prog"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
 
-  # Check whether --enable-static was given.
-if test "${enable_static+set}" = set; then
-  enableval=$enable_static; p=${PACKAGE-default}
-    case $enableval in
-    yes) enable_static=yes ;;
-    no) enable_static=no ;;
-    *)
-     enable_static=no
-      # Look at the argument we got.  We use all the common list separators.
-      lt_save_ifs="$IFS"; IFS="${IFS}$PATH_SEPARATOR,"
-      for pkg in $enableval; do
-	IFS="$lt_save_ifs"
-	if test "X$pkg" = "X$p"; then
-	  enable_static=yes
-	fi
-      done
-      IFS="$lt_save_ifs"
-      ;;
-    esac
+fi
+fi
+AWK=$ac_cv_prog_AWK
+if test -n "$AWK"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $AWK" >&5
+$as_echo "$AWK" >&6; }
 else
-  enable_static=yes
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 fi
 
 
+  test -n "$AWK" && break
+done
 
 
 
@@ -6380,15 +5582,8 @@ fi
 
 
 
-# Check whether --with-pic was given.
-if test "${with_pic+set}" = set; then
-  withval=$with_pic; pic_mode="$withval"
-else
-  pic_mode=default
-fi
 
 
-test -z "$pic_mode" && pic_mode=default
 
 
 
@@ -6396,56 +5591,266 @@ test -z "$pic_mode" && pic_mode=default
 
 
 
-  # Check whether --enable-fast-install was given.
-if test "${enable_fast_install+set}" = set; then
-  enableval=$enable_fast_install; p=${PACKAGE-default}
-    case $enableval in
-    yes) enable_fast_install=yes ;;
-    no) enable_fast_install=no ;;
-    *)
-      enable_fast_install=no
-      # Look at the argument we got.  We use all the common list separators.
-      lt_save_ifs="$IFS"; IFS="${IFS}$PATH_SEPARATOR,"
-      for pkg in $enableval; do
-	IFS="$lt_save_ifs"
-	if test "X$pkg" = "X$p"; then
-	  enable_fast_install=yes
-	fi
-      done
-      IFS="$lt_save_ifs"
-      ;;
-    esac
+
+
+# If no C compiler was specified, use CC.
+LTCC=${LTCC-"$CC"}
+
+# If no C compiler flags were specified, use CFLAGS.
+LTCFLAGS=${LTCFLAGS-"$CFLAGS"}
+
+# Allow CC to be a program name with arguments.
+compiler=$CC
+
+
+# Check for command to grab the raw symbol name followed by C symbol from nm.
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking command to parse $NM output from $compiler object" >&5
+$as_echo_n "checking command to parse $NM output from $compiler object... " >&6; }
+if ${lt_cv_sys_global_symbol_pipe+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
-  enable_fast_install=yes
-fi
 
+# These are sane defaults that work on at least a few old systems.
+# [They come from Ultrix.  What could be older than Ultrix?!! ;)]
+
+# Character class describing NM global symbol codes.
+symcode='[BCDEGRST]'
 
+# Regexp to match symbols that can be accessed directly from C.
+sympat='\([_A-Za-z][_A-Za-z0-9]*\)'
 
+# Define system-specific variables.
+case $host_os in
+aix*)
+  symcode='[BCDT]'
+  ;;
+cygwin* | mingw* | pw32* | cegcc*)
+  symcode='[ABCDGISTW]'
+  ;;
+hpux*)
+  if test "$host_cpu" = ia64; then
+    symcode='[ABCDEGRST]'
+  fi
+  ;;
+irix* | nonstopux*)
+  symcode='[BCDEGRST]'
+  ;;
+osf*)
+  symcode='[BCDEGQRST]'
+  ;;
+solaris*)
+  symcode='[BDRT]'
+  ;;
+sco3.2v5*)
+  symcode='[DT]'
+  ;;
+sysv4.2uw2*)
+  symcode='[DT]'
+  ;;
+sysv5* | sco5v6* | unixware* | OpenUNIX*)
+  symcode='[ABDT]'
+  ;;
+sysv4)
+  symcode='[DFNSTU]'
+  ;;
+esac
 
+# If we're using GNU nm, then use its standard symbol codes.
+case `$NM -V 2>&1` in
+*GNU* | *'with BFD'*)
+  symcode='[ABCDGIRSTW]' ;;
+esac
 
+# Transform an extracted symbol line into a proper C declaration.
+# Some systems (esp. on ia64) link data and code symbols differently,
+# so use this general approach.
+lt_cv_sys_global_symbol_to_cdecl="sed -n -e 's/^T .* \(.*\)$/extern int \1();/p' -e 's/^$symcode* .* \(.*\)$/extern char \1;/p'"
 
+# Transform an extracted symbol line into symbol name and symbol address
+lt_cv_sys_global_symbol_to_c_name_address="sed -n -e 's/^: \([^ ]*\)[ ]*$/  {\\\"\1\\\", (void *) 0},/p' -e 's/^$symcode* \([^ ]*\) \([^ ]*\)$/  {\"\2\", (void *) \&\2},/p'"
+lt_cv_sys_global_symbol_to_c_name_address_lib_prefix="sed -n -e 's/^: \([^ ]*\)[ ]*$/  {\\\"\1\\\", (void *) 0},/p' -e 's/^$symcode* \([^ ]*\) \(lib[^ ]*\)$/  {\"\2\", (void *) \&\2},/p' -e 's/^$symcode* \([^ ]*\) \([^ ]*\)$/  {\"lib\2\", (void *) \&\2},/p'"
 
+# Handle CRLF in mingw tool chain
+opt_cr=
+case $build_os in
+mingw*)
+  opt_cr=`$ECHO 'x\{0,1\}' | tr x '\015'` # option cr in regexp
+  ;;
+esac
 
+# Try without a prefix underscore, then with it.
+for ac_symprfx in "" "_"; do
 
+  # Transform symcode, sympat, and symprfx into a raw symbol and a C symbol.
+  symxfrm="\\1 $ac_symprfx\\2 \\2"
 
+  # Write the raw and C identifiers.
+  if test "$lt_cv_nm_interface" = "MS dumpbin"; then
+    # Fake it for dumpbin and say T for any non-static function
+    # and D for any global variable.
+    # Also find C++ and __fastcall symbols from MSVC++,
+    # which start with @ or ?.
+    lt_cv_sys_global_symbol_pipe="$AWK '"\
+"     {last_section=section; section=\$ 3};"\
+"     /^COFF SYMBOL TABLE/{for(i in hide) delete hide[i]};"\
+"     /Section length .*#relocs.*(pick any)/{hide[last_section]=1};"\
+"     \$ 0!~/External *\|/{next};"\
+"     / 0+ UNDEF /{next}; / UNDEF \([^|]\)*()/{next};"\
+"     {if(hide[section]) next};"\
+"     {f=0}; \$ 0~/\(\).*\|/{f=1}; {printf f ? \"T \" : \"D \"};"\
+"     {split(\$ 0, a, /\||\r/); split(a[2], s)};"\
+"     s[1]~/^[@?]/{print s[1], s[1]; next};"\
+"     s[1]~prfx {split(s[1],t,\"@\"); print t[1], substr(t[1],length(prfx))}"\
+"     ' prfx=^$ac_symprfx"
+  else
+    lt_cv_sys_global_symbol_pipe="sed -n -e 's/^.*[	 ]\($symcode$symcode*\)[	 ][	 ]*$ac_symprfx$sympat$opt_cr$/$symxfrm/p'"
+  fi
+  lt_cv_sys_global_symbol_pipe="$lt_cv_sys_global_symbol_pipe | sed '/ __gnu_lto/d'"
 
-# This can be used to rebuild libtool when needed
-LIBTOOL_DEPS="$ltmain"
+  # Check to see that the pipe works correctly.
+  pipe_works=no
 
-# Always use our own libtool.
-LIBTOOL='$(SHELL) $(top_builddir)/libtool'
+  rm -f conftest*
+  cat > conftest.$ac_ext <<_LT_EOF
+#ifdef __cplusplus
+extern "C" {
+#endif
+char nm_test_var;
+void nm_test_func(void);
+void nm_test_func(void){}
+#ifdef __cplusplus
+}
+#endif
+int main(){nm_test_var='a';nm_test_func();return(0);}
+_LT_EOF
 
+  if { { eval echo "\"\$as_me\":${as_lineno-$LINENO}: \"$ac_compile\""; } >&5
+  (eval $ac_compile) 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+    # Now try to grab the symbols.
+    nlist=conftest.nm
+    if { { eval echo "\"\$as_me\":${as_lineno-$LINENO}: \"$NM conftest.$ac_objext \| "$lt_cv_sys_global_symbol_pipe" \> $nlist\""; } >&5
+  (eval $NM conftest.$ac_objext \| "$lt_cv_sys_global_symbol_pipe" \> $nlist) 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; } && test -s "$nlist"; then
+      # Try sorting and uniquifying the output.
+      if sort "$nlist" | uniq > "$nlist"T; then
+	mv -f "$nlist"T "$nlist"
+      else
+	rm -f "$nlist"T
+      fi
 
+      # Make sure that we snagged all the symbols we need.
+      if $GREP ' nm_test_var$' "$nlist" >/dev/null; then
+	if $GREP ' nm_test_func$' "$nlist" >/dev/null; then
+	  cat <<_LT_EOF > conftest.$ac_ext
+/* Keep this code in sync between libtool.m4, ltmain, lt_system.h, and tests.  */
+#if defined(_WIN32) || defined(__CYGWIN__) || defined(_WIN32_WCE)
+/* DATA imports from DLLs on WIN32 con't be const, because runtime
+   relocations are performed -- see ld's documentation on pseudo-relocs.  */
+# define LT_DLSYM_CONST
+#elif defined(__osf__)
+/* This system does not cope well with relocations in const data.  */
+# define LT_DLSYM_CONST
+#else
+# define LT_DLSYM_CONST const
+#endif
 
+#ifdef __cplusplus
+extern "C" {
+#endif
 
+_LT_EOF
+	  # Now generate the symbol file.
+	  eval "$lt_cv_sys_global_symbol_to_cdecl"' < "$nlist" | $GREP -v main >> conftest.$ac_ext'
 
+	  cat <<_LT_EOF >> conftest.$ac_ext
 
+/* The mapping between symbol names and symbols.  */
+LT_DLSYM_CONST struct {
+  const char *name;
+  void       *address;
+}
+lt__PROGRAM__LTX_preloaded_symbols[] =
+{
+  { "@PROGRAM@", (void *) 0 },
+_LT_EOF
+	  $SED "s/^$symcode$symcode* \(.*\) \(.*\)$/  {\"\2\", (void *) \&\2},/" < "$nlist" | $GREP -v main >> conftest.$ac_ext
+	  cat <<\_LT_EOF >> conftest.$ac_ext
+  {0, (void *) 0}
+};
 
+/* This works around a problem in FreeBSD linker */
+#ifdef FREEBSD_WORKAROUND
+static const void *lt_preloaded_setup() {
+  return lt__PROGRAM__LTX_preloaded_symbols;
+}
+#endif
 
+#ifdef __cplusplus
+}
+#endif
+_LT_EOF
+	  # Now try linking the two files.
+	  mv conftest.$ac_objext conftstm.$ac_objext
+	  lt_globsym_save_LIBS=$LIBS
+	  lt_globsym_save_CFLAGS=$CFLAGS
+	  LIBS="conftstm.$ac_objext"
+	  CFLAGS="$CFLAGS$lt_prog_compiler_no_builtin_flag"
+	  if { { eval echo "\"\$as_me\":${as_lineno-$LINENO}: \"$ac_link\""; } >&5
+  (eval $ac_link) 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; } && test -s conftest${ac_exeext}; then
+	    pipe_works=yes
+	  fi
+	  LIBS=$lt_globsym_save_LIBS
+	  CFLAGS=$lt_globsym_save_CFLAGS
+	else
+	  echo "cannot find nm_test_func in $nlist" >&5
+	fi
+      else
+	echo "cannot find nm_test_var in $nlist" >&5
+      fi
+    else
+      echo "cannot run $lt_cv_sys_global_symbol_pipe" >&5
+    fi
+  else
+    echo "$progname: failed program was:" >&5
+    cat conftest.$ac_ext >&5
+  fi
+  rm -rf conftest* conftst*
 
+  # Do not use the global_symbol_pipe unless it works.
+  if test "$pipe_works" = yes; then
+    break
+  else
+    lt_cv_sys_global_symbol_pipe=
+  fi
+done
 
+fi
 
+if test -z "$lt_cv_sys_global_symbol_pipe"; then
+  lt_cv_sys_global_symbol_to_cdecl=
+fi
+if test -z "$lt_cv_sys_global_symbol_pipe$lt_cv_sys_global_symbol_to_cdecl"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: failed" >&5
+$as_echo "failed" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: ok" >&5
+$as_echo "ok" >&6; }
+fi
 
+# Response file support.
+if test "$lt_cv_nm_interface" = "MS dumpbin"; then
+  nm_file_list_spec='@'
+elif $NM --help 2>/dev/null | grep '[@]FILE' >/dev/null; then
+  nm_file_list_spec='@'
+fi
 
 
 
@@ -6459,7 +5864,6 @@ LIBTOOL='$(SHELL) $(top_builddir)/libtoo
 
 
 
-test -z "$LN_S" && LN_S="ln -s"
 
 
 
@@ -6474,365 +5878,827 @@ test -z "$LN_S" && LN_S="ln -s"
 
 
 
-if test -n "${ZSH_VERSION+set}" ; then
-   setopt NO_GLOB_SUBST
-fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for sysroot" >&5
+$as_echo_n "checking for sysroot... " >&6; }
 
-{ $as_echo "$as_me:$LINENO: checking for objdir" >&5
-$as_echo_n "checking for objdir... " >&6; }
-if test "${lt_cv_objdir+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  rm -f .libs 2>/dev/null
-mkdir .libs 2>/dev/null
-if test -d .libs; then
-  lt_cv_objdir=.libs
+# Check whether --with-sysroot was given.
+if test "${with_sysroot+set}" = set; then :
+  withval=$with_sysroot;
 else
-  # MS-DOS does not allow filenames that begin with a dot.
-  lt_cv_objdir=_libs
-fi
-rmdir .libs 2>/dev/null
+  with_sysroot=no
 fi
-{ $as_echo "$as_me:$LINENO: result: $lt_cv_objdir" >&5
-$as_echo "$lt_cv_objdir" >&6; }
-objdir=$lt_cv_objdir
-
 
 
+lt_sysroot=
+case ${with_sysroot} in #(
+ yes)
+   if test "$GCC" = yes; then
+     lt_sysroot=`$CC --print-sysroot 2>/dev/null`
+   fi
+   ;; #(
+ /*)
+   lt_sysroot=`echo "$with_sysroot" | sed -e "$sed_quote_subst"`
+   ;; #(
+ no|'')
+   ;; #(
+ *)
+   { $as_echo "$as_me:${as_lineno-$LINENO}: result: ${with_sysroot}" >&5
+$as_echo "${with_sysroot}" >&6; }
+   as_fn_error $? "The sysroot must be an absolute path." "$LINENO" 5
+   ;;
+esac
 
+ { $as_echo "$as_me:${as_lineno-$LINENO}: result: ${lt_sysroot:-no}" >&5
+$as_echo "${lt_sysroot:-no}" >&6; }
 
-cat >>confdefs.h <<_ACEOF
-#define LT_OBJDIR "$lt_cv_objdir/"
-_ACEOF
 
 
 
 
+# Check whether --enable-libtool-lock was given.
+if test "${enable_libtool_lock+set}" = set; then :
+  enableval=$enable_libtool_lock;
+fi
 
+test "x$enable_libtool_lock" != xno && enable_libtool_lock=yes
 
+# Some flags need to be propagated to the compiler or linker for good
+# libtool support.
+case $host in
+ia64-*-hpux*)
+  # Find out which ABI we are using.
+  echo 'int i;' > conftest.$ac_ext
+  if { { eval echo "\"\$as_me\":${as_lineno-$LINENO}: \"$ac_compile\""; } >&5
+  (eval $ac_compile) 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+    case `/usr/bin/file conftest.$ac_objext` in
+      *ELF-32*)
+	HPUX_IA64_MODE="32"
+	;;
+      *ELF-64*)
+	HPUX_IA64_MODE="64"
+	;;
+    esac
+  fi
+  rm -rf conftest*
+  ;;
+*-*-irix6*)
+  # Find out which ABI we are using.
+  echo '#line '$LINENO' "configure"' > conftest.$ac_ext
+  if { { eval echo "\"\$as_me\":${as_lineno-$LINENO}: \"$ac_compile\""; } >&5
+  (eval $ac_compile) 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+    if test "$lt_cv_prog_gnu_ld" = yes; then
+      case `/usr/bin/file conftest.$ac_objext` in
+	*32-bit*)
+	  LD="${LD-ld} -melf32bsmip"
+	  ;;
+	*N32*)
+	  LD="${LD-ld} -melf32bmipn32"
+	  ;;
+	*64-bit*)
+	  LD="${LD-ld} -melf64bmip"
+	;;
+      esac
+    else
+      case `/usr/bin/file conftest.$ac_objext` in
+	*32-bit*)
+	  LD="${LD-ld} -32"
+	  ;;
+	*N32*)
+	  LD="${LD-ld} -n32"
+	  ;;
+	*64-bit*)
+	  LD="${LD-ld} -64"
+	  ;;
+      esac
+    fi
+  fi
+  rm -rf conftest*
+  ;;
 
+x86_64-*kfreebsd*-gnu|x86_64-*linux*|ppc*-*linux*|powerpc*-*linux*| \
+s390*-*linux*|s390*-*tpf*|sparc*-*linux*)
+  # Find out which ABI we are using.
+  echo 'int i;' > conftest.$ac_ext
+  if { { eval echo "\"\$as_me\":${as_lineno-$LINENO}: \"$ac_compile\""; } >&5
+  (eval $ac_compile) 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+    case `/usr/bin/file conftest.o` in
+      *32-bit*)
+	case $host in
+	  x86_64-*kfreebsd*-gnu)
+	    LD="${LD-ld} -m elf_i386_fbsd"
+	    ;;
+	  x86_64-*linux*)
+	    LD="${LD-ld} -m elf_i386"
+	    ;;
+	  ppc64-*linux*|powerpc64-*linux*)
+	    LD="${LD-ld} -m elf32ppclinux"
+	    ;;
+	  s390x-*linux*)
+	    LD="${LD-ld} -m elf_s390"
+	    ;;
+	  sparc64-*linux*)
+	    LD="${LD-ld} -m elf32_sparc"
+	    ;;
+	esac
+	;;
+      *64-bit*)
+	case $host in
+	  x86_64-*kfreebsd*-gnu)
+	    LD="${LD-ld} -m elf_x86_64_fbsd"
+	    ;;
+	  x86_64-*linux*)
+	    LD="${LD-ld} -m elf_x86_64"
+	    ;;
+	  ppc*-*linux*|powerpc*-*linux*)
+	    LD="${LD-ld} -m elf64ppc"
+	    ;;
+	  s390*-*linux*|s390*-*tpf*)
+	    LD="${LD-ld} -m elf64_s390"
+	    ;;
+	  sparc*-*linux*)
+	    LD="${LD-ld} -m elf64_sparc"
+	    ;;
+	esac
+	;;
+    esac
+  fi
+  rm -rf conftest*
+  ;;
 
+*-*-sco3.2v5*)
+  # On SCO OpenServer 5, we need -belf to get full-featured binaries.
+  SAVE_CFLAGS="$CFLAGS"
+  CFLAGS="$CFLAGS -belf"
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether the C compiler needs -belf" >&5
+$as_echo_n "checking whether the C compiler needs -belf... " >&6; }
+if ${lt_cv_cc_needs_belf+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
 
+     cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
 
+int
+main ()
+{
 
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_link "$LINENO"; then :
+  lt_cv_cc_needs_belf=yes
+else
+  lt_cv_cc_needs_belf=no
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+     ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
 
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_cc_needs_belf" >&5
+$as_echo "$lt_cv_cc_needs_belf" >&6; }
+  if test x"$lt_cv_cc_needs_belf" != x"yes"; then
+    # this is probably gcc 2.8.0, egcs 1.0 or newer; no need for -belf
+    CFLAGS="$SAVE_CFLAGS"
+  fi
+  ;;
+*-*solaris*)
+  # Find out which ABI we are using.
+  echo 'int i;' > conftest.$ac_ext
+  if { { eval echo "\"\$as_me\":${as_lineno-$LINENO}: \"$ac_compile\""; } >&5
+  (eval $ac_compile) 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+    case `/usr/bin/file conftest.o` in
+    *64-bit*)
+      case $lt_cv_prog_gnu_ld in
+      yes*)
+        case $host in
+        i?86-*-solaris*)
+          LD="${LD-ld} -m elf_x86_64"
+          ;;
+        sparc*-*-solaris*)
+          LD="${LD-ld} -m elf64_sparc"
+          ;;
+        esac
+        # GNU ld 2.21 introduced _sol2 emulations.  Use them if available.
+        if ${LD-ld} -V | grep _sol2 >/dev/null 2>&1; then
+          LD="${LD-ld}_sol2"
+        fi
+        ;;
+      *)
+	if ${LD-ld} -64 -r -o conftest2.o conftest.o >/dev/null 2>&1; then
+	  LD="${LD-ld} -64"
+	fi
+	;;
+      esac
+      ;;
+    esac
+  fi
+  rm -rf conftest*
+  ;;
+esac
 
+need_locks="$enable_libtool_lock"
 
+if test -n "$ac_tool_prefix"; then
+  # Extract the first word of "${ac_tool_prefix}mt", so it can be a program name with args.
+set dummy ${ac_tool_prefix}mt; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_MANIFEST_TOOL+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if test -n "$MANIFEST_TOOL"; then
+  ac_cv_prog_MANIFEST_TOOL="$MANIFEST_TOOL" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_MANIFEST_TOOL="${ac_tool_prefix}mt"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
 
+fi
+fi
+MANIFEST_TOOL=$ac_cv_prog_MANIFEST_TOOL
+if test -n "$MANIFEST_TOOL"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $MANIFEST_TOOL" >&5
+$as_echo "$MANIFEST_TOOL" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
 
 
-case $host_os in
-aix3*)
-  # AIX sometimes has problems with the GCC collect2 program.  For some
-  # reason, if we set the COLLECT_NAMES environment variable, the problems
-  # vanish in a puff of smoke.
-  if test "X${COLLECT_NAMES+set}" != Xset; then
-    COLLECT_NAMES=
-    export COLLECT_NAMES
+fi
+if test -z "$ac_cv_prog_MANIFEST_TOOL"; then
+  ac_ct_MANIFEST_TOOL=$MANIFEST_TOOL
+  # Extract the first word of "mt", so it can be a program name with args.
+set dummy mt; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_ac_ct_MANIFEST_TOOL+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if test -n "$ac_ct_MANIFEST_TOOL"; then
+  ac_cv_prog_ac_ct_MANIFEST_TOOL="$ac_ct_MANIFEST_TOOL" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_ac_ct_MANIFEST_TOOL="mt"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
   fi
-  ;;
+done
+  done
+IFS=$as_save_IFS
+
+fi
+fi
+ac_ct_MANIFEST_TOOL=$ac_cv_prog_ac_ct_MANIFEST_TOOL
+if test -n "$ac_ct_MANIFEST_TOOL"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_MANIFEST_TOOL" >&5
+$as_echo "$ac_ct_MANIFEST_TOOL" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
+
+  if test "x$ac_ct_MANIFEST_TOOL" = x; then
+    MANIFEST_TOOL=":"
+  else
+    case $cross_compiling:$ac_tool_warned in
+yes:)
+{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
+$as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
+ac_tool_warned=yes ;;
 esac
+    MANIFEST_TOOL=$ac_ct_MANIFEST_TOOL
+  fi
+else
+  MANIFEST_TOOL="$ac_cv_prog_MANIFEST_TOOL"
+fi
 
-# Sed substitution that helps us do robust quoting.  It backslashifies
-# metacharacters that are still active within double-quoted strings.
-sed_quote_subst='s/\(["`$\\]\)/\\\1/g'
-
-# Same as above, but do not quote variable references.
-double_quote_subst='s/\(["`\\]\)/\\\1/g'
+test -z "$MANIFEST_TOOL" && MANIFEST_TOOL=mt
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking if $MANIFEST_TOOL is a manifest tool" >&5
+$as_echo_n "checking if $MANIFEST_TOOL is a manifest tool... " >&6; }
+if ${lt_cv_path_mainfest_tool+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  lt_cv_path_mainfest_tool=no
+  echo "$as_me:$LINENO: $MANIFEST_TOOL '-?'" >&5
+  $MANIFEST_TOOL '-?' 2>conftest.err > conftest.out
+  cat conftest.err >&5
+  if $GREP 'Manifest Tool' conftest.out > /dev/null; then
+    lt_cv_path_mainfest_tool=yes
+  fi
+  rm -f conftest*
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_path_mainfest_tool" >&5
+$as_echo "$lt_cv_path_mainfest_tool" >&6; }
+if test "x$lt_cv_path_mainfest_tool" != xyes; then
+  MANIFEST_TOOL=:
+fi
 
-# Sed substitution to delay expansion of an escaped shell variable in a
-# double_quote_subst'ed string.
-delay_variable_subst='s/\\\\\\\\\\\$/\\\\\\$/g'
 
-# Sed substitution to delay expansion of an escaped single quote.
-delay_single_quote_subst='s/'\''/'\'\\\\\\\'\''/g'
 
-# Sed substitution to avoid accidental globbing in evaled expressions
-no_glob_subst='s/\*/\\\*/g'
 
-# Global variables:
-ofile=libtool
-can_build_shared=yes
 
-# All known linkers require a `.a' archive for static linking (except MSVC,
-# which needs '.lib').
-libext=a
 
-with_gnu_ld="$lt_cv_prog_gnu_ld"
+  case $host_os in
+    rhapsody* | darwin*)
+    if test -n "$ac_tool_prefix"; then
+  # Extract the first word of "${ac_tool_prefix}dsymutil", so it can be a program name with args.
+set dummy ${ac_tool_prefix}dsymutil; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_DSYMUTIL+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if test -n "$DSYMUTIL"; then
+  ac_cv_prog_DSYMUTIL="$DSYMUTIL" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_DSYMUTIL="${ac_tool_prefix}dsymutil"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
 
-old_CC="$CC"
-old_CFLAGS="$CFLAGS"
+fi
+fi
+DSYMUTIL=$ac_cv_prog_DSYMUTIL
+if test -n "$DSYMUTIL"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $DSYMUTIL" >&5
+$as_echo "$DSYMUTIL" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
 
-# Set sane defaults for various variables
-test -z "$CC" && CC=cc
-test -z "$LTCC" && LTCC=$CC
-test -z "$LTCFLAGS" && LTCFLAGS=$CFLAGS
-test -z "$LD" && LD=ld
-test -z "$ac_objext" && ac_objext=o
 
-for cc_temp in $compiler""; do
-  case $cc_temp in
-    compile | *[\\/]compile | ccache | *[\\/]ccache ) ;;
-    distcc | *[\\/]distcc | purify | *[\\/]purify ) ;;
-    \-*) ;;
-    *) break;;
-  esac
+fi
+if test -z "$ac_cv_prog_DSYMUTIL"; then
+  ac_ct_DSYMUTIL=$DSYMUTIL
+  # Extract the first word of "dsymutil", so it can be a program name with args.
+set dummy dsymutil; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_ac_ct_DSYMUTIL+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if test -n "$ac_ct_DSYMUTIL"; then
+  ac_cv_prog_ac_ct_DSYMUTIL="$ac_ct_DSYMUTIL" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_ac_ct_DSYMUTIL="dsymutil"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
 done
-cc_basename=`$ECHO "X$cc_temp" | $Xsed -e 's%.*/%%' -e "s%^$host_alias-%%"`
+  done
+IFS=$as_save_IFS
 
+fi
+fi
+ac_ct_DSYMUTIL=$ac_cv_prog_ac_ct_DSYMUTIL
+if test -n "$ac_ct_DSYMUTIL"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_DSYMUTIL" >&5
+$as_echo "$ac_ct_DSYMUTIL" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
 
-# Only perform the check for file, if the check method requires it
-test -z "$MAGIC_CMD" && MAGIC_CMD=file
-case $deplibs_check_method in
-file_magic*)
-  if test "$file_magic_cmd" = '$MAGIC_CMD'; then
-    { $as_echo "$as_me:$LINENO: checking for ${ac_tool_prefix}file" >&5
-$as_echo_n "checking for ${ac_tool_prefix}file... " >&6; }
-if test "${lt_cv_path_MAGIC_CMD+set}" = set; then
+  if test "x$ac_ct_DSYMUTIL" = x; then
+    DSYMUTIL=":"
+  else
+    case $cross_compiling:$ac_tool_warned in
+yes:)
+{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
+$as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
+ac_tool_warned=yes ;;
+esac
+    DSYMUTIL=$ac_ct_DSYMUTIL
+  fi
+else
+  DSYMUTIL="$ac_cv_prog_DSYMUTIL"
+fi
+
+    if test -n "$ac_tool_prefix"; then
+  # Extract the first word of "${ac_tool_prefix}nmedit", so it can be a program name with args.
+set dummy ${ac_tool_prefix}nmedit; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_NMEDIT+:} false; then :
   $as_echo_n "(cached) " >&6
 else
-  case $MAGIC_CMD in
-[\\/*] |  ?:[\\/]*)
-  lt_cv_path_MAGIC_CMD="$MAGIC_CMD" # Let the user override the test with a path.
-  ;;
-*)
-  lt_save_MAGIC_CMD="$MAGIC_CMD"
-  lt_save_ifs="$IFS"; IFS=$PATH_SEPARATOR
-  ac_dummy="/usr/bin$PATH_SEPARATOR$PATH"
-  for ac_dir in $ac_dummy; do
-    IFS="$lt_save_ifs"
-    test -z "$ac_dir" && ac_dir=.
-    if test -f $ac_dir/${ac_tool_prefix}file; then
-      lt_cv_path_MAGIC_CMD="$ac_dir/${ac_tool_prefix}file"
-      if test -n "$file_magic_test_file"; then
-	case $deplibs_check_method in
-	"file_magic "*)
-	  file_magic_regex=`expr "$deplibs_check_method" : "file_magic \(.*\)"`
-	  MAGIC_CMD="$lt_cv_path_MAGIC_CMD"
-	  if eval $file_magic_cmd \$file_magic_test_file 2> /dev/null |
-	    $EGREP "$file_magic_regex" > /dev/null; then
-	    :
-	  else
-	    cat <<_LT_EOF 1>&2
+  if test -n "$NMEDIT"; then
+  ac_cv_prog_NMEDIT="$NMEDIT" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_NMEDIT="${ac_tool_prefix}nmedit"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
 
-*** Warning: the command libtool uses to detect shared libraries,
-*** $file_magic_cmd, produces output that libtool cannot recognize.
-*** The result is that libtool may fail to recognize shared libraries
-*** as such.  This will affect the creation of libtool libraries that
-*** depend on shared libraries, but programs linked with such libtool
-*** libraries will work regardless of this problem.  Nevertheless, you
-*** may want to report the problem to your system manager and/or to
-*** bug-libtool@gnu.org
+fi
+fi
+NMEDIT=$ac_cv_prog_NMEDIT
+if test -n "$NMEDIT"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $NMEDIT" >&5
+$as_echo "$NMEDIT" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
 
-_LT_EOF
-	  fi ;;
-	esac
-      fi
-      break
-    fi
+
+fi
+if test -z "$ac_cv_prog_NMEDIT"; then
+  ac_ct_NMEDIT=$NMEDIT
+  # Extract the first word of "nmedit", so it can be a program name with args.
+set dummy nmedit; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_ac_ct_NMEDIT+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if test -n "$ac_ct_NMEDIT"; then
+  ac_cv_prog_ac_ct_NMEDIT="$ac_ct_NMEDIT" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_ac_ct_NMEDIT="nmedit"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
   done
-  IFS="$lt_save_ifs"
-  MAGIC_CMD="$lt_save_MAGIC_CMD"
-  ;;
+IFS=$as_save_IFS
+
+fi
+fi
+ac_ct_NMEDIT=$ac_cv_prog_ac_ct_NMEDIT
+if test -n "$ac_ct_NMEDIT"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_NMEDIT" >&5
+$as_echo "$ac_ct_NMEDIT" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
+
+  if test "x$ac_ct_NMEDIT" = x; then
+    NMEDIT=":"
+  else
+    case $cross_compiling:$ac_tool_warned in
+yes:)
+{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
+$as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
+ac_tool_warned=yes ;;
 esac
+    NMEDIT=$ac_ct_NMEDIT
+  fi
+else
+  NMEDIT="$ac_cv_prog_NMEDIT"
 fi
 
-MAGIC_CMD="$lt_cv_path_MAGIC_CMD"
-if test -n "$MAGIC_CMD"; then
-  { $as_echo "$as_me:$LINENO: result: $MAGIC_CMD" >&5
-$as_echo "$MAGIC_CMD" >&6; }
+    if test -n "$ac_tool_prefix"; then
+  # Extract the first word of "${ac_tool_prefix}lipo", so it can be a program name with args.
+set dummy ${ac_tool_prefix}lipo; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_LIPO+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if test -n "$LIPO"; then
+  ac_cv_prog_LIPO="$LIPO" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_LIPO="${ac_tool_prefix}lipo"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
+
+fi
+fi
+LIPO=$ac_cv_prog_LIPO
+if test -n "$LIPO"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $LIPO" >&5
+$as_echo "$LIPO" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
 
-
-
-
-if test -z "$lt_cv_path_MAGIC_CMD"; then
-  if test -n "$ac_tool_prefix"; then
-    { $as_echo "$as_me:$LINENO: checking for file" >&5
-$as_echo_n "checking for file... " >&6; }
-if test "${lt_cv_path_MAGIC_CMD+set}" = set; then
+fi
+if test -z "$ac_cv_prog_LIPO"; then
+  ac_ct_LIPO=$LIPO
+  # Extract the first word of "lipo", so it can be a program name with args.
+set dummy lipo; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_ac_ct_LIPO+:} false; then :
   $as_echo_n "(cached) " >&6
 else
-  case $MAGIC_CMD in
-[\\/*] |  ?:[\\/]*)
-  lt_cv_path_MAGIC_CMD="$MAGIC_CMD" # Let the user override the test with a path.
-  ;;
-*)
-  lt_save_MAGIC_CMD="$MAGIC_CMD"
-  lt_save_ifs="$IFS"; IFS=$PATH_SEPARATOR
-  ac_dummy="/usr/bin$PATH_SEPARATOR$PATH"
-  for ac_dir in $ac_dummy; do
-    IFS="$lt_save_ifs"
-    test -z "$ac_dir" && ac_dir=.
-    if test -f $ac_dir/file; then
-      lt_cv_path_MAGIC_CMD="$ac_dir/file"
-      if test -n "$file_magic_test_file"; then
-	case $deplibs_check_method in
-	"file_magic "*)
-	  file_magic_regex=`expr "$deplibs_check_method" : "file_magic \(.*\)"`
-	  MAGIC_CMD="$lt_cv_path_MAGIC_CMD"
-	  if eval $file_magic_cmd \$file_magic_test_file 2> /dev/null |
-	    $EGREP "$file_magic_regex" > /dev/null; then
-	    :
-	  else
-	    cat <<_LT_EOF 1>&2
-
-*** Warning: the command libtool uses to detect shared libraries,
-*** $file_magic_cmd, produces output that libtool cannot recognize.
-*** The result is that libtool may fail to recognize shared libraries
-*** as such.  This will affect the creation of libtool libraries that
-*** depend on shared libraries, but programs linked with such libtool
-*** libraries will work regardless of this problem.  Nevertheless, you
-*** may want to report the problem to your system manager and/or to
-*** bug-libtool@gnu.org
-
-_LT_EOF
-	  fi ;;
-	esac
-      fi
-      break
-    fi
+  if test -n "$ac_ct_LIPO"; then
+  ac_cv_prog_ac_ct_LIPO="$ac_ct_LIPO" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_ac_ct_LIPO="lipo"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
   done
-  IFS="$lt_save_ifs"
-  MAGIC_CMD="$lt_save_MAGIC_CMD"
-  ;;
-esac
-fi
+IFS=$as_save_IFS
 
-MAGIC_CMD="$lt_cv_path_MAGIC_CMD"
-if test -n "$MAGIC_CMD"; then
-  { $as_echo "$as_me:$LINENO: result: $MAGIC_CMD" >&5
-$as_echo "$MAGIC_CMD" >&6; }
+fi
+fi
+ac_ct_LIPO=$ac_cv_prog_ac_ct_LIPO
+if test -n "$ac_ct_LIPO"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_LIPO" >&5
+$as_echo "$ac_ct_LIPO" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
-
+  if test "x$ac_ct_LIPO" = x; then
+    LIPO=":"
   else
-    MAGIC_CMD=:
+    case $cross_compiling:$ac_tool_warned in
+yes:)
+{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
+$as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
+ac_tool_warned=yes ;;
+esac
+    LIPO=$ac_ct_LIPO
   fi
+else
+  LIPO="$ac_cv_prog_LIPO"
 fi
 
+    if test -n "$ac_tool_prefix"; then
+  # Extract the first word of "${ac_tool_prefix}otool", so it can be a program name with args.
+set dummy ${ac_tool_prefix}otool; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_OTOOL+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if test -n "$OTOOL"; then
+  ac_cv_prog_OTOOL="$OTOOL" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_OTOOL="${ac_tool_prefix}otool"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
   fi
-  ;;
-esac
-
-# Use C for the default configuration in the libtool script
-
-lt_save_CC="$CC"
-ac_ext=c
-ac_cpp='$CPP $CPPFLAGS'
-ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
-ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
-ac_compiler_gnu=$ac_cv_c_compiler_gnu
-
-
-# Source file extension for C test sources.
-ac_ext=c
-
-# Object file extension for compiled C test sources.
-objext=o
-objext=$objext
-
-# Code to be used in simple compile tests
-lt_simple_compile_test_code="int some_variable = 0;"
-
-# Code to be used in simple link tests
-lt_simple_link_test_code='int main(){return(0);}'
-
-
-
-
-
-
-
-# If no C compiler was specified, use CC.
-LTCC=${LTCC-"$CC"}
-
-# If no C compiler flags were specified, use CFLAGS.
-LTCFLAGS=${LTCFLAGS-"$CFLAGS"}
+done
+  done
+IFS=$as_save_IFS
 
-# Allow CC to be a program name with arguments.
-compiler=$CC
+fi
+fi
+OTOOL=$ac_cv_prog_OTOOL
+if test -n "$OTOOL"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $OTOOL" >&5
+$as_echo "$OTOOL" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
 
-# Save the default compiler, since it gets overwritten when the other
-# tags are being tested, and _LT_TAGVAR(compiler, []) is a NOP.
-compiler_DEFAULT=$CC
 
-# save warnings/boilerplate of simple test code
-ac_outfile=conftest.$ac_objext
-echo "$lt_simple_compile_test_code" >conftest.$ac_ext
-eval "$ac_compile" 2>&1 >/dev/null | $SED '/^$/d; /^ *+/d' >conftest.err
-_lt_compiler_boilerplate=`cat conftest.err`
-$RM conftest*
+fi
+if test -z "$ac_cv_prog_OTOOL"; then
+  ac_ct_OTOOL=$OTOOL
+  # Extract the first word of "otool", so it can be a program name with args.
+set dummy otool; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_ac_ct_OTOOL+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if test -n "$ac_ct_OTOOL"; then
+  ac_cv_prog_ac_ct_OTOOL="$ac_ct_OTOOL" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_ac_ct_OTOOL="otool"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
 
-ac_outfile=conftest.$ac_objext
-echo "$lt_simple_link_test_code" >conftest.$ac_ext
-eval "$ac_link" 2>&1 >/dev/null | $SED '/^$/d; /^ *+/d' >conftest.err
-_lt_linker_boilerplate=`cat conftest.err`
-$RM -r conftest*
+fi
+fi
+ac_ct_OTOOL=$ac_cv_prog_ac_ct_OTOOL
+if test -n "$ac_ct_OTOOL"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_OTOOL" >&5
+$as_echo "$ac_ct_OTOOL" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
 
+  if test "x$ac_ct_OTOOL" = x; then
+    OTOOL=":"
+  else
+    case $cross_compiling:$ac_tool_warned in
+yes:)
+{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
+$as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
+ac_tool_warned=yes ;;
+esac
+    OTOOL=$ac_ct_OTOOL
+  fi
+else
+  OTOOL="$ac_cv_prog_OTOOL"
+fi
 
-## CAVEAT EMPTOR:
-## There is no encapsulation within the following macros, do not change
-## the running order or otherwise move them around unless you know exactly
-## what you are doing...
-if test -n "$compiler"; then
+    if test -n "$ac_tool_prefix"; then
+  # Extract the first word of "${ac_tool_prefix}otool64", so it can be a program name with args.
+set dummy ${ac_tool_prefix}otool64; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_OTOOL64+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if test -n "$OTOOL64"; then
+  ac_cv_prog_OTOOL64="$OTOOL64" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_OTOOL64="${ac_tool_prefix}otool64"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
 
-lt_prog_compiler_no_builtin_flag=
+fi
+fi
+OTOOL64=$ac_cv_prog_OTOOL64
+if test -n "$OTOOL64"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $OTOOL64" >&5
+$as_echo "$OTOOL64" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
 
-if test "$GCC" = yes; then
-  lt_prog_compiler_no_builtin_flag=' -fno-builtin'
 
-  { $as_echo "$as_me:$LINENO: checking if $compiler supports -fno-rtti -fno-exceptions" >&5
-$as_echo_n "checking if $compiler supports -fno-rtti -fno-exceptions... " >&6; }
-if test "${lt_cv_prog_compiler_rtti_exceptions+set}" = set; then
+fi
+if test -z "$ac_cv_prog_OTOOL64"; then
+  ac_ct_OTOOL64=$OTOOL64
+  # Extract the first word of "otool64", so it can be a program name with args.
+set dummy otool64; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_ac_ct_OTOOL64+:} false; then :
   $as_echo_n "(cached) " >&6
 else
-  lt_cv_prog_compiler_rtti_exceptions=no
-   ac_outfile=conftest.$ac_objext
-   echo "$lt_simple_compile_test_code" > conftest.$ac_ext
-   lt_compiler_flag="-fno-rtti -fno-exceptions"
-   # Insert the option either (1) after the last *FLAGS variable, or
-   # (2) before a word containing "conftest.", or (3) at the end.
-   # Note that $ac_compile itself does not contain backslashes and begins
-   # with a dollar sign (not a hyphen), so the echo should work correctly.
-   # The option is referenced via a variable to avoid confusing sed.
-   lt_compile=`echo "$ac_compile" | $SED \
-   -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
-   -e 's: [^ ]*conftest\.: $lt_compiler_flag&:; t' \
-   -e 's:$: $lt_compiler_flag:'`
-   (eval echo "\"\$as_me:6810: $lt_compile\"" >&5)
-   (eval "$lt_compile" 2>conftest.err)
-   ac_status=$?
-   cat conftest.err >&5
-   echo "$as_me:6814: \$? = $ac_status" >&5
-   if (exit $ac_status) && test -s "$ac_outfile"; then
-     # The compiler can only warn and ignore the option if not recognized
-     # So say no if there are warnings other than the usual output.
-     $ECHO "X$_lt_compiler_boilerplate" | $Xsed -e '/^$/d' >conftest.exp
-     $SED '/^$/d; /^ *+/d' conftest.err >conftest.er2
-     if test ! -s conftest.er2 || diff conftest.exp conftest.er2 >/dev/null; then
-       lt_cv_prog_compiler_rtti_exceptions=yes
-     fi
-   fi
-   $RM conftest*
+  if test -n "$ac_ct_OTOOL64"; then
+  ac_cv_prog_ac_ct_OTOOL64="$ac_ct_OTOOL64" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_ac_ct_OTOOL64="otool64"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
 
 fi
-{ $as_echo "$as_me:$LINENO: result: $lt_cv_prog_compiler_rtti_exceptions" >&5
-$as_echo "$lt_cv_prog_compiler_rtti_exceptions" >&6; }
-
-if test x"$lt_cv_prog_compiler_rtti_exceptions" = xyes; then
-    lt_prog_compiler_no_builtin_flag="$lt_prog_compiler_no_builtin_flag -fno-rtti -fno-exceptions"
+fi
+ac_ct_OTOOL64=$ac_cv_prog_ac_ct_OTOOL64
+if test -n "$ac_ct_OTOOL64"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_OTOOL64" >&5
+$as_echo "$ac_ct_OTOOL64" >&6; }
 else
-    :
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 fi
 
+  if test "x$ac_ct_OTOOL64" = x; then
+    OTOOL64=":"
+  else
+    case $cross_compiling:$ac_tool_warned in
+yes:)
+{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
+$as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
+ac_tool_warned=yes ;;
+esac
+    OTOOL64=$ac_ct_OTOOL64
+  fi
+else
+  OTOOL64="$ac_cv_prog_OTOOL64"
 fi
 
 
@@ -6840,1698 +6706,876 @@ fi
 
 
 
-  lt_prog_compiler_wl=
-lt_prog_compiler_pic=
-lt_prog_compiler_static=
-
-{ $as_echo "$as_me:$LINENO: checking for $compiler option to produce PIC" >&5
-$as_echo_n "checking for $compiler option to produce PIC... " >&6; }
-
-  if test "$GCC" = yes; then
-    lt_prog_compiler_wl='-Wl,'
-    lt_prog_compiler_static='-static'
-
-    case $host_os in
-      aix*)
-      # All AIX code is PIC.
-      if test "$host_cpu" = ia64; then
-	# AIX 5 now supports IA64 processor
-	lt_prog_compiler_static='-Bstatic'
-      fi
-      ;;
-
-    amigaos*)
-      case $host_cpu in
-      powerpc)
-            # see comment about AmigaOS4 .so support
-            lt_prog_compiler_pic='-fPIC'
-        ;;
-      m68k)
-            # FIXME: we need at least 68020 code to build shared libraries, but
-            # adding the `-m68020' flag to GCC prevents building anything better,
-            # like `-m68040'.
-            lt_prog_compiler_pic='-m68020 -resident32 -malways-restore-a4'
-        ;;
-      esac
-      ;;
-
-    beos* | irix5* | irix6* | nonstopux* | osf3* | osf4* | osf5*)
-      # PIC is the default for these OSes.
-      ;;
-
-    mingw* | cygwin* | pw32* | os2* | cegcc*)
-      # This hack is so that the source file can tell whether it is being
-      # built for inclusion in a dll (and should export symbols for example).
-      # Although the cygwin gcc ignores -fPIC, still need this for old-style
-      # (--disable-auto-import) libraries
-      lt_prog_compiler_pic='-DDLL_EXPORT'
-      ;;
-
-    darwin* | rhapsody*)
-      # PIC is the default on this platform
-      # Common symbols not allowed in MH_DYLIB files
-      lt_prog_compiler_pic='-fno-common'
-      ;;
-
-    hpux*)
-      # PIC is the default for 64-bit PA HP-UX, but not for 32-bit
-      # PA HP-UX.  On IA64 HP-UX, PIC is the default but the pic flag
-      # sets the default TLS model and affects inlining.
-      case $host_cpu in
-      hppa*64*)
-	# +Z the default
-	;;
-      *)
-	lt_prog_compiler_pic='-fPIC'
-	;;
-      esac
-      ;;
-
-    interix[3-9]*)
-      # Interix 3.x gcc -fpic/-fPIC options generate broken code.
-      # Instead, we relocate shared libraries at runtime.
-      ;;
-
-    msdosdjgpp*)
-      # Just because we use GCC doesn't mean we suddenly get shared libraries
-      # on systems that don't support them.
-      lt_prog_compiler_can_build_shared=no
-      enable_shared=no
-      ;;
-
-    *nto* | *qnx*)
-      # QNX uses GNU C++, but need to define -shared option too, otherwise
-      # it will coredump.
-      lt_prog_compiler_pic='-fPIC -shared'
-      ;;
-
-    sysv4*MP*)
-      if test -d /usr/nec; then
-	lt_prog_compiler_pic=-Kconform_pic
-      fi
-      ;;
-
-    *)
-      lt_prog_compiler_pic='-fPIC'
-      ;;
-    esac
-  else
-    # PORTME Check for flag to pass linker flags through the system compiler.
-    case $host_os in
-    aix*)
-      lt_prog_compiler_wl='-Wl,'
-      if test "$host_cpu" = ia64; then
-	# AIX 5 now supports IA64 processor
-	lt_prog_compiler_static='-Bstatic'
-      else
-	lt_prog_compiler_static='-bnso -bI:/lib/syscalls.exp'
-      fi
-      ;;
 
-    mingw* | cygwin* | pw32* | os2* | cegcc*)
-      # This hack is so that the source file can tell whether it is being
-      # built for inclusion in a dll (and should export symbols for example).
-      lt_prog_compiler_pic='-DDLL_EXPORT'
-      ;;
 
-    hpux9* | hpux10* | hpux11*)
-      lt_prog_compiler_wl='-Wl,'
-      # PIC is the default for IA64 HP-UX and 64-bit HP-UX, but
-      # not for PA HP-UX.
-      case $host_cpu in
-      hppa*64*|ia64*)
-	# +Z the default
-	;;
-      *)
-	lt_prog_compiler_pic='+Z'
-	;;
-      esac
-      # Is there a better lt_prog_compiler_static that works with the bundled CC?
-      lt_prog_compiler_static='${wl}-a ${wl}archive'
-      ;;
 
-    irix5* | irix6* | nonstopux*)
-      lt_prog_compiler_wl='-Wl,'
-      # PIC (with -KPIC) is the default.
-      lt_prog_compiler_static='-non_shared'
-      ;;
 
-    linux* | k*bsd*-gnu)
-      case $cc_basename in
-      # old Intel for x86_64 which still supported -KPIC.
-      ecc*)
-	lt_prog_compiler_wl='-Wl,'
-	lt_prog_compiler_pic='-KPIC'
-	lt_prog_compiler_static='-static'
-        ;;
-      # icc used to be incompatible with GCC.
-      # ICC 10 doesn't accept -KPIC any more.
-      icc* | ifort*)
-	lt_prog_compiler_wl='-Wl,'
-	lt_prog_compiler_pic='-fPIC'
-	lt_prog_compiler_static='-static'
-        ;;
-      # Lahey Fortran 8.1.
-      lf95*)
-	lt_prog_compiler_wl='-Wl,'
-	lt_prog_compiler_pic='--shared'
-	lt_prog_compiler_static='--static'
-	;;
-      pgcc* | pgf77* | pgf90* | pgf95*)
-        # Portland Group compilers (*not* the Pentium gcc compiler,
-	# which looks to be a dead project)
-	lt_prog_compiler_wl='-Wl,'
-	lt_prog_compiler_pic='-fpic'
-	lt_prog_compiler_static='-Bstatic'
-        ;;
-      ccc*)
-        lt_prog_compiler_wl='-Wl,'
-        # All Alpha code is PIC.
-        lt_prog_compiler_static='-non_shared'
-        ;;
-      xl*)
-	# IBM XL C 8.0/Fortran 10.1 on PPC
-	lt_prog_compiler_wl='-Wl,'
-	lt_prog_compiler_pic='-qpic'
-	lt_prog_compiler_static='-qstaticlink'
-	;;
-      *)
-	case `$CC -V 2>&1 | sed 5q` in
-	*Sun\ C*)
-	  # Sun C 5.9
-	  lt_prog_compiler_pic='-KPIC'
-	  lt_prog_compiler_static='-Bstatic'
-	  lt_prog_compiler_wl='-Wl,'
-	  ;;
-	*Sun\ F*)
-	  # Sun Fortran 8.3 passes all unrecognized flags to the linker
-	  lt_prog_compiler_pic='-KPIC'
-	  lt_prog_compiler_static='-Bstatic'
-	  lt_prog_compiler_wl=''
-	  ;;
-	esac
-	;;
-      esac
-      ;;
 
-    newsos6)
-      lt_prog_compiler_pic='-KPIC'
-      lt_prog_compiler_static='-Bstatic'
-      ;;
 
-    *nto* | *qnx*)
-      # QNX uses GNU C++, but need to define -shared option too, otherwise
-      # it will coredump.
-      lt_prog_compiler_pic='-fPIC -shared'
-      ;;
 
-    osf3* | osf4* | osf5*)
-      lt_prog_compiler_wl='-Wl,'
-      # All OSF/1 code is PIC.
-      lt_prog_compiler_static='-non_shared'
-      ;;
 
-    rdos*)
-      lt_prog_compiler_static='-non_shared'
-      ;;
 
-    solaris*)
-      lt_prog_compiler_pic='-KPIC'
-      lt_prog_compiler_static='-Bstatic'
-      case $cc_basename in
-      f77* | f90* | f95*)
-	lt_prog_compiler_wl='-Qoption ld ';;
-      *)
-	lt_prog_compiler_wl='-Wl,';;
-      esac
-      ;;
 
-    sunos4*)
-      lt_prog_compiler_wl='-Qoption ld '
-      lt_prog_compiler_pic='-PIC'
-      lt_prog_compiler_static='-Bstatic'
-      ;;
 
-    sysv4 | sysv4.2uw2* | sysv4.3*)
-      lt_prog_compiler_wl='-Wl,'
-      lt_prog_compiler_pic='-KPIC'
-      lt_prog_compiler_static='-Bstatic'
-      ;;
 
-    sysv4*MP*)
-      if test -d /usr/nec ;then
-	lt_prog_compiler_pic='-Kconform_pic'
-	lt_prog_compiler_static='-Bstatic'
+
+
+
+
+
+
+
+
+
+    { $as_echo "$as_me:${as_lineno-$LINENO}: checking for -single_module linker flag" >&5
+$as_echo_n "checking for -single_module linker flag... " >&6; }
+if ${lt_cv_apple_cc_single_mod+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  lt_cv_apple_cc_single_mod=no
+      if test -z "${LT_MULTI_MODULE}"; then
+	# By default we will add the -single_module flag. You can override
+	# by either setting the environment variable LT_MULTI_MODULE
+	# non-empty at configure time, or by adding -multi_module to the
+	# link flags.
+	rm -rf libconftest.dylib*
+	echo "int foo(void){return 1;}" > conftest.c
+	echo "$LTCC $LTCFLAGS $LDFLAGS -o libconftest.dylib \
+-dynamiclib -Wl,-single_module conftest.c" >&5
+	$LTCC $LTCFLAGS $LDFLAGS -o libconftest.dylib \
+	  -dynamiclib -Wl,-single_module conftest.c 2>conftest.err
+        _lt_result=$?
+	# If there is a non-empty error log, and "single_module"
+	# appears in it, assume the flag caused a linker warning
+        if test -s conftest.err && $GREP single_module conftest.err; then
+	  cat conftest.err >&5
+	# Otherwise, if the output was created with a 0 exit code from
+	# the compiler, it worked.
+	elif test -f libconftest.dylib && test $_lt_result -eq 0; then
+	  lt_cv_apple_cc_single_mod=yes
+	else
+	  cat conftest.err >&5
+	fi
+	rm -rf libconftest.dylib*
+	rm -f conftest.*
       fi
-      ;;
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_apple_cc_single_mod" >&5
+$as_echo "$lt_cv_apple_cc_single_mod" >&6; }
 
-    sysv5* | unixware* | sco3.2v5* | sco5v6* | OpenUNIX*)
-      lt_prog_compiler_wl='-Wl,'
-      lt_prog_compiler_pic='-KPIC'
-      lt_prog_compiler_static='-Bstatic'
-      ;;
+    { $as_echo "$as_me:${as_lineno-$LINENO}: checking for -exported_symbols_list linker flag" >&5
+$as_echo_n "checking for -exported_symbols_list linker flag... " >&6; }
+if ${lt_cv_ld_exported_symbols_list+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  lt_cv_ld_exported_symbols_list=no
+      save_LDFLAGS=$LDFLAGS
+      echo "_main" > conftest.sym
+      LDFLAGS="$LDFLAGS -Wl,-exported_symbols_list,conftest.sym"
+      cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
 
-    unicos*)
-      lt_prog_compiler_wl='-Wl,'
-      lt_prog_compiler_can_build_shared=no
-      ;;
+int
+main ()
+{
 
-    uts4*)
-      lt_prog_compiler_pic='-pic'
-      lt_prog_compiler_static='-Bstatic'
-      ;;
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_link "$LINENO"; then :
+  lt_cv_ld_exported_symbols_list=yes
+else
+  lt_cv_ld_exported_symbols_list=no
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+	LDFLAGS="$save_LDFLAGS"
 
-    *)
-      lt_prog_compiler_can_build_shared=no
-      ;;
-    esac
-  fi
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_ld_exported_symbols_list" >&5
+$as_echo "$lt_cv_ld_exported_symbols_list" >&6; }
 
-case $host_os in
-  # For platforms which do not support PIC, -DPIC is meaningless:
-  *djgpp*)
-    lt_prog_compiler_pic=
+    { $as_echo "$as_me:${as_lineno-$LINENO}: checking for -force_load linker flag" >&5
+$as_echo_n "checking for -force_load linker flag... " >&6; }
+if ${lt_cv_ld_force_load+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  lt_cv_ld_force_load=no
+      cat > conftest.c << _LT_EOF
+int forced_loaded() { return 2;}
+_LT_EOF
+      echo "$LTCC $LTCFLAGS -c -o conftest.o conftest.c" >&5
+      $LTCC $LTCFLAGS -c -o conftest.o conftest.c 2>&5
+      echo "$AR cru libconftest.a conftest.o" >&5
+      $AR cru libconftest.a conftest.o 2>&5
+      echo "$RANLIB libconftest.a" >&5
+      $RANLIB libconftest.a 2>&5
+      cat > conftest.c << _LT_EOF
+int main() { return 0;}
+_LT_EOF
+      echo "$LTCC $LTCFLAGS $LDFLAGS -o conftest conftest.c -Wl,-force_load,./libconftest.a" >&5
+      $LTCC $LTCFLAGS $LDFLAGS -o conftest conftest.c -Wl,-force_load,./libconftest.a 2>conftest.err
+      _lt_result=$?
+      if test -s conftest.err && $GREP force_load conftest.err; then
+	cat conftest.err >&5
+      elif test -f conftest && test $_lt_result -eq 0 && $GREP forced_load conftest >/dev/null 2>&1 ; then
+	lt_cv_ld_force_load=yes
+      else
+	cat conftest.err >&5
+      fi
+        rm -f conftest.err libconftest.a conftest conftest.c
+        rm -rf conftest.dSYM
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_ld_force_load" >&5
+$as_echo "$lt_cv_ld_force_load" >&6; }
+    case $host_os in
+    rhapsody* | darwin1.[012])
+      _lt_dar_allow_undefined='${wl}-undefined ${wl}suppress' ;;
+    darwin1.*)
+      _lt_dar_allow_undefined='${wl}-flat_namespace ${wl}-undefined ${wl}suppress' ;;
+    darwin*) # darwin 5.x on
+      # if running on 10.5 or later, the deployment target defaults
+      # to the OS version, if on x86, and 10.4, the deployment
+      # target defaults to 10.4. Don't you love it?
+      case ${MACOSX_DEPLOYMENT_TARGET-10.0},$host in
+	10.0,*86*-darwin8*|10.0,*-darwin[91]*)
+	  _lt_dar_allow_undefined='${wl}-undefined ${wl}dynamic_lookup' ;;
+	10.[012]*)
+	  _lt_dar_allow_undefined='${wl}-flat_namespace ${wl}-undefined ${wl}suppress' ;;
+	10.*)
+	  _lt_dar_allow_undefined='${wl}-undefined ${wl}dynamic_lookup' ;;
+      esac
     ;;
-  *)
-    lt_prog_compiler_pic="$lt_prog_compiler_pic -DPIC"
+  esac
+    if test "$lt_cv_apple_cc_single_mod" = "yes"; then
+      _lt_dar_single_mod='$single_module'
+    fi
+    if test "$lt_cv_ld_exported_symbols_list" = "yes"; then
+      _lt_dar_export_syms=' ${wl}-exported_symbols_list,$output_objdir/${libname}-symbols.expsym'
+    else
+      _lt_dar_export_syms='~$NMEDIT -s $output_objdir/${libname}-symbols.expsym ${lib}'
+    fi
+    if test "$DSYMUTIL" != ":" && test "$lt_cv_ld_force_load" = "no"; then
+      _lt_dsymutil='~$DSYMUTIL $lib || :'
+    else
+      _lt_dsymutil=
+    fi
     ;;
-esac
-{ $as_echo "$as_me:$LINENO: result: $lt_prog_compiler_pic" >&5
-$as_echo "$lt_prog_compiler_pic" >&6; }
+  esac
 
+ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking how to run the C preprocessor" >&5
+$as_echo_n "checking how to run the C preprocessor... " >&6; }
+# On Suns, sometimes $CPP names a directory.
+if test -n "$CPP" && test -d "$CPP"; then
+  CPP=
+fi
+if test -z "$CPP"; then
+  if ${ac_cv_prog_CPP+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+      # Double quotes because CPP needs to be expanded
+    for CPP in "$CC -E" "$CC -E -traditional-cpp" "/lib/cpp"
+    do
+      ac_preproc_ok=false
+for ac_c_preproc_warn_flag in '' yes
+do
+  # Use a header file that comes with gcc, so configuring glibc
+  # with a fresh cross-compiler works.
+  # Prefer <limits.h> to <assert.h> if __STDC__ is defined, since
+  # <limits.h> exists even on freestanding compilers.
+  # On the NeXT, cc -E runs the code through the compiler's parser,
+  # not just through cpp. "Syntax error" is here to catch this case.
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#ifdef __STDC__
+# include <limits.h>
+#else
+# include <assert.h>
+#endif
+		     Syntax error
+_ACEOF
+if ac_fn_c_try_cpp "$LINENO"; then :
 
+else
+  # Broken: fails on valid input.
+continue
+fi
+rm -f conftest.err conftest.i conftest.$ac_ext
 
+  # OK, works on sane cases.  Now check whether nonexistent headers
+  # can be detected and how.
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <ac_nonexistent.h>
+_ACEOF
+if ac_fn_c_try_cpp "$LINENO"; then :
+  # Broken: success on invalid input.
+continue
+else
+  # Passes both tests.
+ac_preproc_ok=:
+break
+fi
+rm -f conftest.err conftest.i conftest.$ac_ext
 
+done
+# Because of `break', _AC_PREPROC_IFELSE's cleaning code was skipped.
+rm -f conftest.i conftest.err conftest.$ac_ext
+if $ac_preproc_ok; then :
+  break
+fi
 
+    done
+    ac_cv_prog_CPP=$CPP
 
-#
-# Check to make sure the PIC flag actually works.
-#
-if test -n "$lt_prog_compiler_pic"; then
-  { $as_echo "$as_me:$LINENO: checking if $compiler PIC flag $lt_prog_compiler_pic works" >&5
-$as_echo_n "checking if $compiler PIC flag $lt_prog_compiler_pic works... " >&6; }
-if test "${lt_cv_prog_compiler_pic_works+set}" = set; then
-  $as_echo_n "(cached) " >&6
+fi
+  CPP=$ac_cv_prog_CPP
 else
-  lt_cv_prog_compiler_pic_works=no
-   ac_outfile=conftest.$ac_objext
-   echo "$lt_simple_compile_test_code" > conftest.$ac_ext
-   lt_compiler_flag="$lt_prog_compiler_pic -DPIC"
-   # Insert the option either (1) after the last *FLAGS variable, or
-   # (2) before a word containing "conftest.", or (3) at the end.
-   # Note that $ac_compile itself does not contain backslashes and begins
-   # with a dollar sign (not a hyphen), so the echo should work correctly.
-   # The option is referenced via a variable to avoid confusing sed.
-   lt_compile=`echo "$ac_compile" | $SED \
-   -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
-   -e 's: [^ ]*conftest\.: $lt_compiler_flag&:; t' \
-   -e 's:$: $lt_compiler_flag:'`
-   (eval echo "\"\$as_me:7149: $lt_compile\"" >&5)
-   (eval "$lt_compile" 2>conftest.err)
-   ac_status=$?
-   cat conftest.err >&5
-   echo "$as_me:7153: \$? = $ac_status" >&5
-   if (exit $ac_status) && test -s "$ac_outfile"; then
-     # The compiler can only warn and ignore the option if not recognized
-     # So say no if there are warnings other than the usual output.
-     $ECHO "X$_lt_compiler_boilerplate" | $Xsed -e '/^$/d' >conftest.exp
-     $SED '/^$/d; /^ *+/d' conftest.err >conftest.er2
-     if test ! -s conftest.er2 || diff conftest.exp conftest.er2 >/dev/null; then
-       lt_cv_prog_compiler_pic_works=yes
-     fi
-   fi
-   $RM conftest*
-
+  ac_cv_prog_CPP=$CPP
 fi
-{ $as_echo "$as_me:$LINENO: result: $lt_cv_prog_compiler_pic_works" >&5
-$as_echo "$lt_cv_prog_compiler_pic_works" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $CPP" >&5
+$as_echo "$CPP" >&6; }
+ac_preproc_ok=false
+for ac_c_preproc_warn_flag in '' yes
+do
+  # Use a header file that comes with gcc, so configuring glibc
+  # with a fresh cross-compiler works.
+  # Prefer <limits.h> to <assert.h> if __STDC__ is defined, since
+  # <limits.h> exists even on freestanding compilers.
+  # On the NeXT, cc -E runs the code through the compiler's parser,
+  # not just through cpp. "Syntax error" is here to catch this case.
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#ifdef __STDC__
+# include <limits.h>
+#else
+# include <assert.h>
+#endif
+		     Syntax error
+_ACEOF
+if ac_fn_c_try_cpp "$LINENO"; then :
 
-if test x"$lt_cv_prog_compiler_pic_works" = xyes; then
-    case $lt_prog_compiler_pic in
-     "" | " "*) ;;
-     *) lt_prog_compiler_pic=" $lt_prog_compiler_pic" ;;
-     esac
 else
-    lt_prog_compiler_pic=
-     lt_prog_compiler_can_build_shared=no
+  # Broken: fails on valid input.
+continue
 fi
+rm -f conftest.err conftest.i conftest.$ac_ext
 
+  # OK, works on sane cases.  Now check whether nonexistent headers
+  # can be detected and how.
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <ac_nonexistent.h>
+_ACEOF
+if ac_fn_c_try_cpp "$LINENO"; then :
+  # Broken: success on invalid input.
+continue
+else
+  # Passes both tests.
+ac_preproc_ok=:
+break
 fi
+rm -f conftest.err conftest.i conftest.$ac_ext
 
+done
+# Because of `break', _AC_PREPROC_IFELSE's cleaning code was skipped.
+rm -f conftest.i conftest.err conftest.$ac_ext
+if $ac_preproc_ok; then :
 
+else
+  { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
+$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
+as_fn_error $? "C preprocessor \"$CPP\" fails sanity check
+See \`config.log' for more details" "$LINENO" 5; }
+fi
 
+ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
 
 
-
-#
-# Check to make sure the static flag actually works.
-#
-wl=$lt_prog_compiler_wl eval lt_tmp_static_flag=\"$lt_prog_compiler_static\"
-{ $as_echo "$as_me:$LINENO: checking if $compiler static flag $lt_tmp_static_flag works" >&5
-$as_echo_n "checking if $compiler static flag $lt_tmp_static_flag works... " >&6; }
-if test "${lt_cv_prog_compiler_static_works+set}" = set; then
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for ANSI C header files" >&5
+$as_echo_n "checking for ANSI C header files... " >&6; }
+if ${ac_cv_header_stdc+:} false; then :
   $as_echo_n "(cached) " >&6
 else
-  lt_cv_prog_compiler_static_works=no
-   save_LDFLAGS="$LDFLAGS"
-   LDFLAGS="$LDFLAGS $lt_tmp_static_flag"
-   echo "$lt_simple_link_test_code" > conftest.$ac_ext
-   if (eval $ac_link 2>conftest.err) && test -s conftest$ac_exeext; then
-     # The linker can only warn and ignore the option if not recognized
-     # So say no if there are warnings
-     if test -s conftest.err; then
-       # Append any errors to the config.log.
-       cat conftest.err 1>&5
-       $ECHO "X$_lt_linker_boilerplate" | $Xsed -e '/^$/d' > conftest.exp
-       $SED '/^$/d; /^ *+/d' conftest.err >conftest.er2
-       if diff conftest.exp conftest.er2 >/dev/null; then
-         lt_cv_prog_compiler_static_works=yes
-       fi
-     else
-       lt_cv_prog_compiler_static_works=yes
-     fi
-   fi
-   $RM -r conftest*
-   LDFLAGS="$save_LDFLAGS"
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <stdlib.h>
+#include <stdarg.h>
+#include <string.h>
+#include <float.h>
 
-fi
-{ $as_echo "$as_me:$LINENO: result: $lt_cv_prog_compiler_static_works" >&5
-$as_echo "$lt_cv_prog_compiler_static_works" >&6; }
+int
+main ()
+{
 
-if test x"$lt_cv_prog_compiler_static_works" = xyes; then
-    :
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ac_cv_header_stdc=yes
 else
-    lt_prog_compiler_static=
+  ac_cv_header_stdc=no
 fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
+if test $ac_cv_header_stdc = yes; then
+  # SunOS 4.x string.h does not declare mem*, contrary to ANSI.
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <string.h>
 
+_ACEOF
+if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
+  $EGREP "memchr" >/dev/null 2>&1; then :
 
+else
+  ac_cv_header_stdc=no
+fi
+rm -f conftest*
 
+fi
 
+if test $ac_cv_header_stdc = yes; then
+  # ISC 2.0.2 stdlib.h does not declare free, contrary to ANSI.
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <stdlib.h>
 
+_ACEOF
+if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
+  $EGREP "free" >/dev/null 2>&1; then :
 
-  { $as_echo "$as_me:$LINENO: checking if $compiler supports -c -o file.$ac_objext" >&5
-$as_echo_n "checking if $compiler supports -c -o file.$ac_objext... " >&6; }
-if test "${lt_cv_prog_compiler_c_o+set}" = set; then
-  $as_echo_n "(cached) " >&6
 else
-  lt_cv_prog_compiler_c_o=no
-   $RM -r conftest 2>/dev/null
-   mkdir conftest
-   cd conftest
-   mkdir out
-   echo "$lt_simple_compile_test_code" > conftest.$ac_ext
-
-   lt_compiler_flag="-o out/conftest2.$ac_objext"
-   # Insert the option either (1) after the last *FLAGS variable, or
-   # (2) before a word containing "conftest.", or (3) at the end.
-   # Note that $ac_compile itself does not contain backslashes and begins
-   # with a dollar sign (not a hyphen), so the echo should work correctly.
-   lt_compile=`echo "$ac_compile" | $SED \
-   -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
-   -e 's: [^ ]*conftest\.: $lt_compiler_flag&:; t' \
-   -e 's:$: $lt_compiler_flag:'`
-   (eval echo "\"\$as_me:7254: $lt_compile\"" >&5)
-   (eval "$lt_compile" 2>out/conftest.err)
-   ac_status=$?
-   cat out/conftest.err >&5
-   echo "$as_me:7258: \$? = $ac_status" >&5
-   if (exit $ac_status) && test -s out/conftest2.$ac_objext
-   then
-     # The compiler can only warn and ignore the option if not recognized
-     # So say no if there are warnings
-     $ECHO "X$_lt_compiler_boilerplate" | $Xsed -e '/^$/d' > out/conftest.exp
-     $SED '/^$/d; /^ *+/d' out/conftest.err >out/conftest.er2
-     if test ! -s out/conftest.er2 || diff out/conftest.exp out/conftest.er2 >/dev/null; then
-       lt_cv_prog_compiler_c_o=yes
-     fi
-   fi
-   chmod u+w . 2>&5
-   $RM conftest*
-   # SGI C++ compiler will create directory out/ii_files/ for
-   # template instantiation
-   test -d out/ii_files && $RM out/ii_files/* && rmdir out/ii_files
-   $RM out/* && rmdir out
-   cd ..
-   $RM -r conftest
-   $RM conftest*
-
+  ac_cv_header_stdc=no
 fi
-{ $as_echo "$as_me:$LINENO: result: $lt_cv_prog_compiler_c_o" >&5
-$as_echo "$lt_cv_prog_compiler_c_o" >&6; }
-
-
+rm -f conftest*
 
+fi
 
+if test $ac_cv_header_stdc = yes; then
+  # /bin/cc in Irix-4.0.5 gets non-ANSI ctype macros unless using -ansi.
+  if test "$cross_compiling" = yes; then :
+  :
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <ctype.h>
+#include <stdlib.h>
+#if ((' ' & 0x0FF) == 0x020)
+# define ISLOWER(c) ('a' <= (c) && (c) <= 'z')
+# define TOUPPER(c) (ISLOWER(c) ? 'A' + ((c) - 'a') : (c))
+#else
+# define ISLOWER(c) \
+		   (('a' <= (c) && (c) <= 'i') \
+		     || ('j' <= (c) && (c) <= 'r') \
+		     || ('s' <= (c) && (c) <= 'z'))
+# define TOUPPER(c) (ISLOWER(c) ? ((c) | 0x40) : (c))
+#endif
 
+#define XOR(e, f) (((e) && !(f)) || (!(e) && (f)))
+int
+main ()
+{
+  int i;
+  for (i = 0; i < 256; i++)
+    if (XOR (islower (i), ISLOWER (i))
+	|| toupper (i) != TOUPPER (i))
+      return 2;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_run "$LINENO"; then :
 
-  { $as_echo "$as_me:$LINENO: checking if $compiler supports -c -o file.$ac_objext" >&5
-$as_echo_n "checking if $compiler supports -c -o file.$ac_objext... " >&6; }
-if test "${lt_cv_prog_compiler_c_o+set}" = set; then
-  $as_echo_n "(cached) " >&6
 else
-  lt_cv_prog_compiler_c_o=no
-   $RM -r conftest 2>/dev/null
-   mkdir conftest
-   cd conftest
-   mkdir out
-   echo "$lt_simple_compile_test_code" > conftest.$ac_ext
-
-   lt_compiler_flag="-o out/conftest2.$ac_objext"
-   # Insert the option either (1) after the last *FLAGS variable, or
-   # (2) before a word containing "conftest.", or (3) at the end.
-   # Note that $ac_compile itself does not contain backslashes and begins
-   # with a dollar sign (not a hyphen), so the echo should work correctly.
-   lt_compile=`echo "$ac_compile" | $SED \
-   -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
-   -e 's: [^ ]*conftest\.: $lt_compiler_flag&:; t' \
-   -e 's:$: $lt_compiler_flag:'`
-   (eval echo "\"\$as_me:7309: $lt_compile\"" >&5)
-   (eval "$lt_compile" 2>out/conftest.err)
-   ac_status=$?
-   cat out/conftest.err >&5
-   echo "$as_me:7313: \$? = $ac_status" >&5
-   if (exit $ac_status) && test -s out/conftest2.$ac_objext
-   then
-     # The compiler can only warn and ignore the option if not recognized
-     # So say no if there are warnings
-     $ECHO "X$_lt_compiler_boilerplate" | $Xsed -e '/^$/d' > out/conftest.exp
-     $SED '/^$/d; /^ *+/d' out/conftest.err >out/conftest.er2
-     if test ! -s out/conftest.er2 || diff out/conftest.exp out/conftest.er2 >/dev/null; then
-       lt_cv_prog_compiler_c_o=yes
-     fi
-   fi
-   chmod u+w . 2>&5
-   $RM conftest*
-   # SGI C++ compiler will create directory out/ii_files/ for
-   # template instantiation
-   test -d out/ii_files && $RM out/ii_files/* && rmdir out/ii_files
-   $RM out/* && rmdir out
-   cd ..
-   $RM -r conftest
-   $RM conftest*
+  ac_cv_header_stdc=no
+fi
+rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext \
+  conftest.$ac_objext conftest.beam conftest.$ac_ext
+fi
 
 fi
-{ $as_echo "$as_me:$LINENO: result: $lt_cv_prog_compiler_c_o" >&5
-$as_echo "$lt_cv_prog_compiler_c_o" >&6; }
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_header_stdc" >&5
+$as_echo "$ac_cv_header_stdc" >&6; }
+if test $ac_cv_header_stdc = yes; then
 
+$as_echo "#define STDC_HEADERS 1" >>confdefs.h
 
+fi
 
+# On IRIX 5.3, sys/types and inttypes.h are conflicting.
+for ac_header in sys/types.h sys/stat.h stdlib.h string.h memory.h strings.h \
+		  inttypes.h stdint.h unistd.h
+do :
+  as_ac_Header=`$as_echo "ac_cv_header_$ac_header" | $as_tr_sh`
+ac_fn_c_check_header_compile "$LINENO" "$ac_header" "$as_ac_Header" "$ac_includes_default
+"
+if eval test \"x\$"$as_ac_Header"\" = x"yes"; then :
+  cat >>confdefs.h <<_ACEOF
+#define `$as_echo "HAVE_$ac_header" | $as_tr_cpp` 1
+_ACEOF
+
+fi
+
+done
+
+
+for ac_header in dlfcn.h
+do :
+  ac_fn_c_check_header_compile "$LINENO" "dlfcn.h" "ac_cv_header_dlfcn_h" "$ac_includes_default
+"
+if test "x$ac_cv_header_dlfcn_h" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_DLFCN_H 1
+_ACEOF
 
-hard_links="nottested"
-if test "$lt_cv_prog_compiler_c_o" = no && test "$need_locks" != no; then
-  # do not overwrite the value of need_locks provided by the user
-  { $as_echo "$as_me:$LINENO: checking if we can lock with hard links" >&5
-$as_echo_n "checking if we can lock with hard links... " >&6; }
-  hard_links=yes
-  $RM conftest*
-  ln conftest.a conftest.b 2>/dev/null && hard_links=no
-  touch conftest.a
-  ln conftest.a conftest.b 2>&5 || hard_links=no
-  ln conftest.a conftest.b 2>/dev/null && hard_links=no
-  { $as_echo "$as_me:$LINENO: result: $hard_links" >&5
-$as_echo "$hard_links" >&6; }
-  if test "$hard_links" = no; then
-    { $as_echo "$as_me:$LINENO: WARNING: \`$CC' does not support \`-c -o', so \`make -j' may be unsafe" >&5
-$as_echo "$as_me: WARNING: \`$CC' does not support \`-c -o', so \`make -j' may be unsafe" >&2;}
-    need_locks=warn
-  fi
-else
-  need_locks=no
 fi
 
+done
 
 
 
 
 
-  { $as_echo "$as_me:$LINENO: checking whether the $compiler linker ($LD) supports shared libraries" >&5
-$as_echo_n "checking whether the $compiler linker ($LD) supports shared libraries... " >&6; }
+# Set options
 
-  runpath_var=
-  allow_undefined_flag=
-  always_export_symbols=no
-  archive_cmds=
-  archive_expsym_cmds=
-  compiler_needs_object=no
-  enable_shared_with_static_runtimes=no
-  export_dynamic_flag_spec=
-  export_symbols_cmds='$NM $libobjs $convenience | $global_symbol_pipe | $SED '\''s/.* //'\'' | sort | uniq > $export_symbols'
-  hardcode_automatic=no
-  hardcode_direct=no
-  hardcode_direct_absolute=no
-  hardcode_libdir_flag_spec=
-  hardcode_libdir_flag_spec_ld=
-  hardcode_libdir_separator=
-  hardcode_minus_L=no
-  hardcode_shlibpath_var=unsupported
-  inherit_rpath=no
-  link_all_deplibs=unknown
-  module_cmds=
-  module_expsym_cmds=
-  old_archive_from_new_cmds=
-  old_archive_from_expsyms_cmds=
-  thread_safe_flag_spec=
-  whole_archive_flag_spec=
-  # include_expsyms should be a list of space-separated symbols to be *always*
-  # included in the symbol list
-  include_expsyms=
-  # exclude_expsyms can be an extended regexp of symbols to exclude
-  # it will be wrapped by ` (' and `)$', so one must not match beginning or
-  # end of line.  Example: `a|bc|.*d.*' will exclude the symbols `a' and `bc',
-  # as well as any symbol that contains `d'.
-  exclude_expsyms='_GLOBAL_OFFSET_TABLE_|_GLOBAL__F[ID]_.*'
-  # Although _GLOBAL_OFFSET_TABLE_ is a valid symbol C name, most a.out
-  # platforms (ab)use it in PIC code, but their linkers get confused if
-  # the symbol is explicitly referenced.  Since portable code cannot
-  # rely on this symbol name, it's probably fine to never include it in
-  # preloaded symbol tables.
-  # Exclude shared library initialization/finalization symbols.
-  extract_expsyms_cmds=
 
-  case $host_os in
-  cygwin* | mingw* | pw32* | cegcc*)
-    # FIXME: the MSVC++ port hasn't been tested in a loooong time
-    # When not using gcc, we currently assume that we are using
-    # Microsoft Visual C++.
-    if test "$GCC" != yes; then
-      with_gnu_ld=no
-    fi
-    ;;
-  interix*)
-    # we just hope/assume this is gcc and not c89 (= MSVC++)
-    with_gnu_ld=yes
-    ;;
-  openbsd*)
-    with_gnu_ld=no
-    ;;
-  esac
 
-  ld_shlibs=yes
-  if test "$with_gnu_ld" = yes; then
-    # If archive_cmds runs LD, not CC, wlarc should be empty
-    wlarc='${wl}'
+        enable_dlopen=no
 
-    # Set some defaults for GNU ld with shared library support. These
-    # are reset later if shared libraries are not supported. Putting them
-    # here allows them to be overridden if necessary.
-    runpath_var=LD_RUN_PATH
-    hardcode_libdir_flag_spec='${wl}-rpath ${wl}$libdir'
-    export_dynamic_flag_spec='${wl}--export-dynamic'
-    # ancient GNU ld didn't support --whole-archive et. al.
-    if $LD --help 2>&1 | $GREP 'no-whole-archive' > /dev/null; then
-      whole_archive_flag_spec="$wlarc"'--whole-archive$convenience '"$wlarc"'--no-whole-archive'
-    else
-      whole_archive_flag_spec=
-    fi
-    supports_anon_versioning=no
-    case `$LD -v 2>&1` in
-      *\ [01].* | *\ 2.[0-9].* | *\ 2.10.*) ;; # catch versions < 2.11
-      *\ 2.11.93.0.2\ *) supports_anon_versioning=yes ;; # RH7.3 ...
-      *\ 2.11.92.0.12\ *) supports_anon_versioning=yes ;; # Mandrake 8.2 ...
-      *\ 2.11.*) ;; # other 2.11 versions
-      *) supports_anon_versioning=yes ;;
-    esac
 
-    # See if GNU ld supports shared libraries.
-    case $host_os in
-    aix[3-9]*)
-      # On AIX/PPC, the GNU linker is very broken
-      if test "$host_cpu" != ia64; then
-	ld_shlibs=no
-	cat <<_LT_EOF 1>&2
+  enable_win32_dll=no
 
-*** Warning: the GNU linker, at least up to release 2.9.1, is reported
-*** to be unable to reliably create shared libraries on AIX.
-*** Therefore, libtool is disabling shared libraries support.  If you
-*** really care for shared libraries, you may want to modify your PATH
-*** so that a non-GNU linker is found, and then restart.
 
-_LT_EOF
-      fi
+            # Check whether --enable-shared was given.
+if test "${enable_shared+set}" = set; then :
+  enableval=$enable_shared; p=${PACKAGE-default}
+    case $enableval in
+    yes) enable_shared=yes ;;
+    no) enable_shared=no ;;
+    *)
+      enable_shared=no
+      # Look at the argument we got.  We use all the common list separators.
+      lt_save_ifs="$IFS"; IFS="${IFS}$PATH_SEPARATOR,"
+      for pkg in $enableval; do
+	IFS="$lt_save_ifs"
+	if test "X$pkg" = "X$p"; then
+	  enable_shared=yes
+	fi
+      done
+      IFS="$lt_save_ifs"
       ;;
+    esac
+else
+  enable_shared=yes
+fi
 
-    amigaos*)
-      case $host_cpu in
-      powerpc)
-            # see comment about AmigaOS4 .so support
-            archive_cmds='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
-            archive_expsym_cmds=''
-        ;;
-      m68k)
-            archive_cmds='$RM $output_objdir/a2ixlibrary.data~$ECHO "#define NAME $libname" > $output_objdir/a2ixlibrary.data~$ECHO "#define LIBRARY_ID 1" >> $output_objdir/a2ixlibrary.data~$ECHO "#define VERSION $major" >> $output_objdir/a2ixlibrary.data~$ECHO "#define REVISION $revision" >> $output_objdir/a2ixlibrary.data~$AR $AR_FLAGS $lib $libobjs~$RANLIB $lib~(cd $output_objdir && a2ixlibrary -32)'
-            hardcode_libdir_flag_spec='-L$libdir'
-            hardcode_minus_L=yes
-        ;;
-      esac
-      ;;
 
-    beos*)
-      if $LD --help 2>&1 | $GREP ': supported targets:.* elf' > /dev/null; then
-	allow_undefined_flag=unsupported
-	# Joseph Beckenbach <jrb3@best.com> says some releases of gcc
-	# support --undefined.  This deserves some investigation.  FIXME
-	archive_cmds='$CC -nostart $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
-      else
-	ld_shlibs=no
-      fi
-      ;;
 
-    cygwin* | mingw* | pw32* | cegcc*)
-      # _LT_TAGVAR(hardcode_libdir_flag_spec, ) is actually meaningless,
-      # as there is no search path for DLLs.
-      hardcode_libdir_flag_spec='-L$libdir'
-      allow_undefined_flag=unsupported
-      always_export_symbols=no
-      enable_shared_with_static_runtimes=yes
-      export_symbols_cmds='$NM $libobjs $convenience | $global_symbol_pipe | $SED -e '\''/^[BCDGRS][ ]/s/.*[ ]\([^ ]*\)/\1 DATA/'\'' | $SED -e '\''/^[AITW][ ]/s/.*[ ]//'\'' | sort | uniq > $export_symbols'
 
-      if $LD --help 2>&1 | $GREP 'auto-import' > /dev/null; then
-        archive_cmds='$CC -shared $libobjs $deplibs $compiler_flags -o $output_objdir/$soname ${wl}--enable-auto-image-base -Xlinker --out-implib -Xlinker $lib'
-	# If the export-symbols file already is a .def file (1st line
-	# is EXPORTS), use it as is; otherwise, prepend...
-	archive_expsym_cmds='if test "x`$SED 1q $export_symbols`" = xEXPORTS; then
-	  cp $export_symbols $output_objdir/$soname.def;
-	else
-	  echo EXPORTS > $output_objdir/$soname.def;
-	  cat $export_symbols >> $output_objdir/$soname.def;
-	fi~
-	$CC -shared $output_objdir/$soname.def $libobjs $deplibs $compiler_flags -o $output_objdir/$soname ${wl}--enable-auto-image-base -Xlinker --out-implib -Xlinker $lib'
-      else
-	ld_shlibs=no
-      fi
-      ;;
 
-    interix[3-9]*)
-      hardcode_direct=no
-      hardcode_shlibpath_var=no
-      hardcode_libdir_flag_spec='${wl}-rpath,$libdir'
-      export_dynamic_flag_spec='${wl}-E'
-      # Hack: On Interix 3.x, we cannot compile PIC because of a broken gcc.
-      # Instead, shared libraries are loaded at an image base (0x10000000 by
-      # default) and relocated if they conflict, which is a slow very memory
-      # consuming and fragmenting process.  To avoid this, we pick a random,
-      # 256 KiB-aligned image base between 0x50000000 and 0x6FFC0000 at link
-      # time.  Moving up from 0x10000000 also allows more sbrk(2) space.
-      archive_cmds='$CC -shared $pic_flag $libobjs $deplibs $compiler_flags ${wl}-h,$soname ${wl}--image-base,`expr ${RANDOM-$$} % 4096 / 2 \* 262144 + 1342177280` -o $lib'
-      archive_expsym_cmds='sed "s,^,_," $export_symbols >$output_objdir/$soname.expsym~$CC -shared $pic_flag $libobjs $deplibs $compiler_flags ${wl}-h,$soname ${wl}--retain-symbols-file,$output_objdir/$soname.expsym ${wl}--image-base,`expr ${RANDOM-$$} % 4096 / 2 \* 262144 + 1342177280` -o $lib'
-      ;;
 
-    gnu* | linux* | tpf* | k*bsd*-gnu)
-      tmp_diet=no
-      if test "$host_os" = linux-dietlibc; then
-	case $cc_basename in
-	  diet\ *) tmp_diet=yes;;	# linux-dietlibc with static linking (!diet-dyn)
-	esac
-      fi
-      if $LD --help 2>&1 | $EGREP ': supported targets:.* elf' > /dev/null \
-	 && test "$tmp_diet" = no
-      then
-	tmp_addflag=
-	tmp_sharedflag='-shared'
-	case $cc_basename,$host_cpu in
-        pgcc*)				# Portland Group C compiler
-	  whole_archive_flag_spec='${wl}--whole-archive`for conv in $convenience\"\"; do test  -n \"$conv\" && new_convenience=\"$new_convenience,$conv\"; done; $ECHO \"$new_convenience\"` ${wl}--no-whole-archive'
-	  tmp_addflag=' $pic_flag'
-	  ;;
-	pgf77* | pgf90* | pgf95*)	# Portland Group f77 and f90 compilers
-	  whole_archive_flag_spec='${wl}--whole-archive`for conv in $convenience\"\"; do test  -n \"$conv\" && new_convenience=\"$new_convenience,$conv\"; done; $ECHO \"$new_convenience\"` ${wl}--no-whole-archive'
-	  tmp_addflag=' $pic_flag -Mnomain' ;;
-	ecc*,ia64* | icc*,ia64*)	# Intel C compiler on ia64
-	  tmp_addflag=' -i_dynamic' ;;
-	efc*,ia64* | ifort*,ia64*)	# Intel Fortran compiler on ia64
-	  tmp_addflag=' -i_dynamic -nofor_main' ;;
-	ifc* | ifort*)			# Intel Fortran compiler
-	  tmp_addflag=' -nofor_main' ;;
-	lf95*)				# Lahey Fortran 8.1
-	  whole_archive_flag_spec=
-	  tmp_sharedflag='--shared' ;;
-	xl[cC]*)			# IBM XL C 8.0 on PPC (deal with xlf below)
-	  tmp_sharedflag='-qmkshrobj'
-	  tmp_addflag= ;;
-	esac
-	case `$CC -V 2>&1 | sed 5q` in
-	*Sun\ C*)			# Sun C 5.9
-	  whole_archive_flag_spec='${wl}--whole-archive`new_convenience=; for conv in $convenience\"\"; do test -z \"$conv\" || new_convenience=\"$new_convenience,$conv\"; done; $ECHO \"$new_convenience\"` ${wl}--no-whole-archive'
-	  compiler_needs_object=yes
-	  tmp_sharedflag='-G' ;;
-	*Sun\ F*)			# Sun Fortran 8.3
-	  tmp_sharedflag='-G' ;;
-	esac
-	archive_cmds='$CC '"$tmp_sharedflag""$tmp_addflag"' $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
 
-        if test "x$supports_anon_versioning" = xyes; then
-          archive_expsym_cmds='echo "{ global:" > $output_objdir/$libname.ver~
-	    cat $export_symbols | sed -e "s/\(.*\)/\1;/" >> $output_objdir/$libname.ver~
-	    echo "local: *; };" >> $output_objdir/$libname.ver~
-	    $CC '"$tmp_sharedflag""$tmp_addflag"' $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname ${wl}-version-script ${wl}$output_objdir/$libname.ver -o $lib'
-        fi
 
-	case $cc_basename in
-	xlf*)
-	  # IBM XL Fortran 10.1 on PPC cannot create shared libs itself
-	  whole_archive_flag_spec='--whole-archive$convenience --no-whole-archive'
-	  hardcode_libdir_flag_spec=
-	  hardcode_libdir_flag_spec_ld='-rpath $libdir'
-	  archive_cmds='$LD -shared $libobjs $deplibs $compiler_flags -soname $soname -o $lib'
-	  if test "x$supports_anon_versioning" = xyes; then
-	    archive_expsym_cmds='echo "{ global:" > $output_objdir/$libname.ver~
-	      cat $export_symbols | sed -e "s/\(.*\)/\1;/" >> $output_objdir/$libname.ver~
-	      echo "local: *; };" >> $output_objdir/$libname.ver~
-	      $LD -shared $libobjs $deplibs $compiler_flags -soname $soname -version-script $output_objdir/$libname.ver -o $lib'
-	  fi
-	  ;;
-	esac
-      else
-        ld_shlibs=no
-      fi
-      ;;
 
-    netbsd*)
-      if echo __ELF__ | $CC -E - | $GREP __ELF__ >/dev/null; then
-	archive_cmds='$LD -Bshareable $libobjs $deplibs $linker_flags -o $lib'
-	wlarc=
-      else
-	archive_cmds='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
-	archive_expsym_cmds='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
-      fi
+  # Check whether --enable-static was given.
+if test "${enable_static+set}" = set; then :
+  enableval=$enable_static; p=${PACKAGE-default}
+    case $enableval in
+    yes) enable_static=yes ;;
+    no) enable_static=no ;;
+    *)
+     enable_static=no
+      # Look at the argument we got.  We use all the common list separators.
+      lt_save_ifs="$IFS"; IFS="${IFS}$PATH_SEPARATOR,"
+      for pkg in $enableval; do
+	IFS="$lt_save_ifs"
+	if test "X$pkg" = "X$p"; then
+	  enable_static=yes
+	fi
+      done
+      IFS="$lt_save_ifs"
       ;;
+    esac
+else
+  enable_static=yes
+fi
+
 
-    solaris*)
-      if $LD -v 2>&1 | $GREP 'BFD 2\.8' > /dev/null; then
-	ld_shlibs=no
-	cat <<_LT_EOF 1>&2
 
-*** Warning: The releases 2.8.* of the GNU linker cannot reliably
-*** create shared libraries on Solaris systems.  Therefore, libtool
-*** is disabling shared libraries support.  We urge you to upgrade GNU
-*** binutils to release 2.9.1 or newer.  Another option is to modify
-*** your PATH or compiler configuration so that the native linker is
-*** used, and then restart.
 
-_LT_EOF
-      elif $LD --help 2>&1 | $GREP ': supported targets:.* elf' > /dev/null; then
-	archive_cmds='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
-	archive_expsym_cmds='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
-      else
-	ld_shlibs=no
-      fi
-      ;;
 
-    sysv5* | sco3.2v5* | sco5v6* | unixware* | OpenUNIX*)
-      case `$LD -v 2>&1` in
-        *\ [01].* | *\ 2.[0-9].* | *\ 2.1[0-5].*)
-	ld_shlibs=no
-	cat <<_LT_EOF 1>&2
 
-*** Warning: Releases of the GNU linker prior to 2.16.91.0.3 can not
-*** reliably create shared libraries on SCO systems.  Therefore, libtool
-*** is disabling shared libraries support.  We urge you to upgrade GNU
-*** binutils to release 2.16.91.0.3 or newer.  Another option is to modify
-*** your PATH or compiler configuration so that the native linker is
-*** used, and then restart.
 
-_LT_EOF
-	;;
-	*)
-	  # For security reasons, it is highly recommended that you always
-	  # use absolute paths for naming shared libraries, and exclude the
-	  # DT_RUNPATH tag from executables and libraries.  But doing so
-	  # requires that you compile everything twice, which is a pain.
-	  if $LD --help 2>&1 | $GREP ': supported targets:.* elf' > /dev/null; then
-	    hardcode_libdir_flag_spec='${wl}-rpath ${wl}$libdir'
-	    archive_cmds='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
-	    archive_expsym_cmds='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
-	  else
-	    ld_shlibs=no
-	  fi
-	;;
-      esac
-      ;;
 
-    sunos4*)
-      archive_cmds='$LD -assert pure-text -Bshareable -o $lib $libobjs $deplibs $linker_flags'
-      wlarc=
-      hardcode_direct=yes
-      hardcode_shlibpath_var=no
-      ;;
 
+
+# Check whether --with-pic was given.
+if test "${with_pic+set}" = set; then :
+  withval=$with_pic; lt_p=${PACKAGE-default}
+    case $withval in
+    yes|no) pic_mode=$withval ;;
     *)
-      if $LD --help 2>&1 | $GREP ': supported targets:.* elf' > /dev/null; then
-	archive_cmds='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
-	archive_expsym_cmds='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
-      else
-	ld_shlibs=no
-      fi
+      pic_mode=default
+      # Look at the argument we got.  We use all the common list separators.
+      lt_save_ifs="$IFS"; IFS="${IFS}$PATH_SEPARATOR,"
+      for lt_pkg in $withval; do
+	IFS="$lt_save_ifs"
+	if test "X$lt_pkg" = "X$lt_p"; then
+	  pic_mode=yes
+	fi
+      done
+      IFS="$lt_save_ifs"
       ;;
     esac
+else
+  pic_mode=default
+fi
 
-    if test "$ld_shlibs" = no; then
-      runpath_var=
-      hardcode_libdir_flag_spec=
-      export_dynamic_flag_spec=
-      whole_archive_flag_spec=
-    fi
-  else
-    # PORTME fill in a description of your system's linker (not GNU ld)
-    case $host_os in
-    aix3*)
-      allow_undefined_flag=unsupported
-      always_export_symbols=yes
-      archive_expsym_cmds='$LD -o $output_objdir/$soname $libobjs $deplibs $linker_flags -bE:$export_symbols -T512 -H512 -bM:SRE~$AR $AR_FLAGS $lib $output_objdir/$soname'
-      # Note: this linker hardcodes the directories in LIBPATH if there
-      # are no directories specified by -L.
-      hardcode_minus_L=yes
-      if test "$GCC" = yes && test -z "$lt_prog_compiler_static"; then
-	# Neither direct hardcoding nor static linking is supported with a
-	# broken collect2.
-	hardcode_direct=unsupported
-      fi
-      ;;
 
-    aix[4-9]*)
-      if test "$host_cpu" = ia64; then
-	# On IA64, the linker does run time linking by default, so we don't
-	# have to do anything special.
-	aix_use_runtimelinking=no
-	exp_sym_flag='-Bexport'
-	no_entry_flag=""
-      else
-	# If we're using GNU nm, then we don't want the "-C" option.
-	# -C means demangle to AIX nm, but means don't demangle with GNU nm
-	if $NM -V 2>&1 | $GREP 'GNU' > /dev/null; then
-	  export_symbols_cmds='$NM -Bpg $libobjs $convenience | awk '\''{ if (((\$ 2 == "T") || (\$ 2 == "D") || (\$ 2 == "B")) && (substr(\$ 3,1,1) != ".")) { print \$ 3 } }'\'' | sort -u > $export_symbols'
-	else
-	  export_symbols_cmds='$NM -BCpg $libobjs $convenience | awk '\''{ if (((\$ 2 == "T") || (\$ 2 == "D") || (\$ 2 == "B")) && (substr(\$ 3,1,1) != ".")) { print \$ 3 } }'\'' | sort -u > $export_symbols'
-	fi
-	aix_use_runtimelinking=no
+test -z "$pic_mode" && pic_mode=default
 
-	# Test if we are trying to use run time linking or normal
-	# AIX style linking. If -brtl is somewhere in LDFLAGS, we
-	# need to do runtime linking.
-	case $host_os in aix4.[23]|aix4.[23].*|aix[5-9]*)
-	  for ld_flag in $LDFLAGS; do
-	  if (test $ld_flag = "-brtl" || test $ld_flag = "-Wl,-brtl"); then
-	    aix_use_runtimelinking=yes
-	    break
-	  fi
-	  done
-	  ;;
-	esac
 
-	exp_sym_flag='-bexport'
-	no_entry_flag='-bnoentry'
-      fi
 
-      # When large executables or shared objects are built, AIX ld can
-      # have problems creating the table of contents.  If linking a library
-      # or program results in "error TOC overflow" add -mminimal-toc to
-      # CXXFLAGS/CFLAGS for g++/gcc.  In the cases where that is not
-      # enough to fix the problem, add -Wl,-bbigtoc to LDFLAGS.
 
-      archive_cmds=''
-      hardcode_direct=yes
-      hardcode_direct_absolute=yes
-      hardcode_libdir_separator=':'
-      link_all_deplibs=yes
-      file_list_spec='${wl}-f,'
 
-      if test "$GCC" = yes; then
-	case $host_os in aix4.[012]|aix4.[012].*)
-	# We only want to do this on AIX 4.2 and lower, the check
-	# below for broken collect2 doesn't work under 4.3+
-	  collect2name=`${CC} -print-prog-name=collect2`
-	  if test -f "$collect2name" &&
-	   strings "$collect2name" | $GREP resolve_lib_name >/dev/null
-	  then
-	  # We have reworked collect2
-	  :
-	  else
-	  # We have old collect2
-	  hardcode_direct=unsupported
-	  # It fails to find uninstalled libraries when the uninstalled
-	  # path is not listed in the libpath.  Setting hardcode_minus_L
-	  # to unsupported forces relinking
-	  hardcode_minus_L=yes
-	  hardcode_libdir_flag_spec='-L$libdir'
-	  hardcode_libdir_separator=
-	  fi
-	  ;;
-	esac
-	shared_flag='-shared'
-	if test "$aix_use_runtimelinking" = yes; then
-	  shared_flag="$shared_flag "'${wl}-G'
-	fi
-      else
-	# not using gcc
-	if test "$host_cpu" = ia64; then
-	# VisualAge C++, Version 5.5 for AIX 5L for IA-64, Beta 3 Release
-	# chokes on -Wl,-G. The following line is correct:
-	  shared_flag='-G'
-	else
-	  if test "$aix_use_runtimelinking" = yes; then
-	    shared_flag='${wl}-G'
-	  else
-	    shared_flag='${wl}-bM:SRE'
-	  fi
+
+
+  # Check whether --enable-fast-install was given.
+if test "${enable_fast_install+set}" = set; then :
+  enableval=$enable_fast_install; p=${PACKAGE-default}
+    case $enableval in
+    yes) enable_fast_install=yes ;;
+    no) enable_fast_install=no ;;
+    *)
+      enable_fast_install=no
+      # Look at the argument we got.  We use all the common list separators.
+      lt_save_ifs="$IFS"; IFS="${IFS}$PATH_SEPARATOR,"
+      for pkg in $enableval; do
+	IFS="$lt_save_ifs"
+	if test "X$pkg" = "X$p"; then
+	  enable_fast_install=yes
 	fi
-      fi
+      done
+      IFS="$lt_save_ifs"
+      ;;
+    esac
+else
+  enable_fast_install=yes
+fi
 
-      export_dynamic_flag_spec='${wl}-bexpall'
-      # It seems that -bexpall does not export symbols beginning with
-      # underscore (_), so it is better to generate a list of symbols to export.
-      always_export_symbols=yes
-      if test "$aix_use_runtimelinking" = yes; then
-	# Warning - without using the other runtime loading flags (-brtl),
-	# -berok will link without error, but may produce a broken library.
-	allow_undefined_flag='-berok'
-        # Determine the default libpath from the value encoded in an
-        # empty executable.
-        cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
 
-int
-main ()
-{
 
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest$ac_exeext && {
-	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
-       }; then
 
-lt_aix_libpath_sed='
-    /Import File Strings/,/^$/ {
-	/^0/ {
-	    s/^0  *\(.*\)$/\1/
-	    p
-	}
-    }'
-aix_libpath=`dump -H conftest$ac_exeext 2>/dev/null | $SED -n -e "$lt_aix_libpath_sed"`
-# Check for a 64-bit object if we didn't find anything.
-if test -z "$aix_libpath"; then
-  aix_libpath=`dump -HX64 conftest$ac_exeext 2>/dev/null | $SED -n -e "$lt_aix_libpath_sed"`
-fi
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
 
 
-fi
 
-rm -rf conftest.dSYM
-rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
-      conftest$ac_exeext conftest.$ac_ext
-if test -z "$aix_libpath"; then aix_libpath="/usr/lib:/lib"; fi
 
-        hardcode_libdir_flag_spec='${wl}-blibpath:$libdir:'"$aix_libpath"
-        archive_expsym_cmds='$CC -o $output_objdir/$soname $libobjs $deplibs '"\${wl}$no_entry_flag"' $compiler_flags `if test "x${allow_undefined_flag}" != "x"; then $ECHO "X${wl}${allow_undefined_flag}" | $Xsed; else :; fi` '"\${wl}$exp_sym_flag:\$export_symbols $shared_flag"
-      else
-	if test "$host_cpu" = ia64; then
-	  hardcode_libdir_flag_spec='${wl}-R $libdir:/usr/lib:/lib'
-	  allow_undefined_flag="-z nodefs"
-	  archive_expsym_cmds="\$CC $shared_flag"' -o $output_objdir/$soname $libobjs $deplibs '"\${wl}$no_entry_flag"' $compiler_flags ${wl}${allow_undefined_flag} '"\${wl}$exp_sym_flag:\$export_symbols"
-	else
-	 # Determine the default libpath from the value encoded in an
-	 # empty executable.
-	 cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
 
-int
-main ()
-{
 
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest$ac_exeext && {
-	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
-       }; then
 
-lt_aix_libpath_sed='
-    /Import File Strings/,/^$/ {
-	/^0/ {
-	    s/^0  *\(.*\)$/\1/
-	    p
-	}
-    }'
-aix_libpath=`dump -H conftest$ac_exeext 2>/dev/null | $SED -n -e "$lt_aix_libpath_sed"`
-# Check for a 64-bit object if we didn't find anything.
-if test -z "$aix_libpath"; then
-  aix_libpath=`dump -HX64 conftest$ac_exeext 2>/dev/null | $SED -n -e "$lt_aix_libpath_sed"`
-fi
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+# This can be used to rebuild libtool when needed
+LIBTOOL_DEPS="$ltmain"
+
+# Always use our own libtool.
+LIBTOOL='$(SHELL) $(top_builddir)/libtool'
+
+
 
 
-fi
 
-rm -rf conftest.dSYM
-rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
-      conftest$ac_exeext conftest.$ac_ext
-if test -z "$aix_libpath"; then aix_libpath="/usr/lib:/lib"; fi
 
-	 hardcode_libdir_flag_spec='${wl}-blibpath:$libdir:'"$aix_libpath"
-	  # Warning - without using the other run time loading flags,
-	  # -berok will link without error, but may produce a broken library.
-	  no_undefined_flag=' ${wl}-bernotok'
-	  allow_undefined_flag=' ${wl}-berok'
-	  # Exported symbols can be pulled into shared objects from archives
-	  whole_archive_flag_spec='$convenience'
-	  archive_cmds_need_lc=yes
-	  # This is similar to how AIX traditionally builds its shared libraries.
-	  archive_expsym_cmds="\$CC $shared_flag"' -o $output_objdir/$soname $libobjs $deplibs ${wl}-bnoentry $compiler_flags ${wl}-bE:$export_symbols${allow_undefined_flag}~$AR $AR_FLAGS $output_objdir/$libname$release.a $output_objdir/$soname'
-	fi
-      fi
-      ;;
 
-    amigaos*)
-      case $host_cpu in
-      powerpc)
-            # see comment about AmigaOS4 .so support
-            archive_cmds='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
-            archive_expsym_cmds=''
-        ;;
-      m68k)
-            archive_cmds='$RM $output_objdir/a2ixlibrary.data~$ECHO "#define NAME $libname" > $output_objdir/a2ixlibrary.data~$ECHO "#define LIBRARY_ID 1" >> $output_objdir/a2ixlibrary.data~$ECHO "#define VERSION $major" >> $output_objdir/a2ixlibrary.data~$ECHO "#define REVISION $revision" >> $output_objdir/a2ixlibrary.data~$AR $AR_FLAGS $lib $libobjs~$RANLIB $lib~(cd $output_objdir && a2ixlibrary -32)'
-            hardcode_libdir_flag_spec='-L$libdir'
-            hardcode_minus_L=yes
-        ;;
-      esac
-      ;;
 
-    bsdi[45]*)
-      export_dynamic_flag_spec=-rdynamic
-      ;;
 
-    cygwin* | mingw* | pw32* | cegcc*)
-      # When not using gcc, we currently assume that we are using
-      # Microsoft Visual C++.
-      # hardcode_libdir_flag_spec is actually meaningless, as there is
-      # no search path for DLLs.
-      hardcode_libdir_flag_spec=' '
-      allow_undefined_flag=unsupported
-      # Tell ltmain to make .lib files, not .a files.
-      libext=lib
-      # Tell ltmain to make .dll files, not .so files.
-      shrext_cmds=".dll"
-      # FIXME: Setting linknames here is a bad hack.
-      archive_cmds='$CC -o $lib $libobjs $compiler_flags `$ECHO "X$deplibs" | $Xsed -e '\''s/ -lc$//'\''` -link -dll~linknames='
-      # The linker will automatically build a .lib file if we build a DLL.
-      old_archive_from_new_cmds='true'
-      # FIXME: Should let the user specify the lib program.
-      old_archive_cmds='lib -OUT:$oldlib$oldobjs$old_deplibs'
-      fix_srcfile_path='`cygpath -w "$srcfile"`'
-      enable_shared_with_static_runtimes=yes
-      ;;
 
-    darwin* | rhapsody*)
 
 
-  archive_cmds_need_lc=no
-  hardcode_direct=no
-  hardcode_automatic=yes
-  hardcode_shlibpath_var=unsupported
-  whole_archive_flag_spec=''
-  link_all_deplibs=yes
-  allow_undefined_flag="$_lt_dar_allow_undefined"
-  case $cc_basename in
-     ifort*) _lt_dar_can_shared=yes ;;
-     *) _lt_dar_can_shared=$GCC ;;
-  esac
-  if test "$_lt_dar_can_shared" = "yes"; then
-    output_verbose_link_cmd=echo
-    archive_cmds="\$CC -dynamiclib \$allow_undefined_flag -o \$lib \$libobjs \$deplibs \$compiler_flags -install_name \$rpath/\$soname \$verstring $_lt_dar_single_mod${_lt_dsymutil}"
-    module_cmds="\$CC \$allow_undefined_flag -o \$lib -bundle \$libobjs \$deplibs \$compiler_flags${_lt_dsymutil}"
-    archive_expsym_cmds="sed 's,^,_,' < \$export_symbols > \$output_objdir/\${libname}-symbols.expsym~\$CC -dynamiclib \$allow_undefined_flag -o \$lib \$libobjs \$deplibs \$compiler_flags -install_name \$rpath/\$soname \$verstring ${_lt_dar_single_mod}${_lt_dar_export_syms}${_lt_dsymutil}"
-    module_expsym_cmds="sed -e 's,^,_,' < \$export_symbols > \$output_objdir/\${libname}-symbols.expsym~\$CC \$allow_undefined_flag -o \$lib -bundle \$libobjs \$deplibs \$compiler_flags${_lt_dar_export_syms}${_lt_dsymutil}"
 
-  else
-  ld_shlibs=no
-  fi
 
-      ;;
 
-    dgux*)
-      archive_cmds='$LD -G -h $soname -o $lib $libobjs $deplibs $linker_flags'
-      hardcode_libdir_flag_spec='-L$libdir'
-      hardcode_shlibpath_var=no
-      ;;
 
-    freebsd1*)
-      ld_shlibs=no
-      ;;
 
-    # FreeBSD 2.2.[012] allows us to include c++rt0.o to get C++ constructor
-    # support.  Future versions do this automatically, but an explicit c++rt0.o
-    # does not break anything, and helps significantly (at the cost of a little
-    # extra space).
-    freebsd2.2*)
-      archive_cmds='$LD -Bshareable -o $lib $libobjs $deplibs $linker_flags /usr/lib/c++rt0.o'
-      hardcode_libdir_flag_spec='-R$libdir'
-      hardcode_direct=yes
-      hardcode_shlibpath_var=no
-      ;;
 
-    # Unfortunately, older versions of FreeBSD 2 do not have this feature.
-    freebsd2*)
-      archive_cmds='$LD -Bshareable -o $lib $libobjs $deplibs $linker_flags'
-      hardcode_direct=yes
-      hardcode_minus_L=yes
-      hardcode_shlibpath_var=no
-      ;;
 
-    # FreeBSD 3 and greater uses gcc -shared to do shared libraries.
-    freebsd* | dragonfly*)
-      archive_cmds='$CC -shared -o $lib $libobjs $deplibs $compiler_flags'
-      hardcode_libdir_flag_spec='-R$libdir'
-      hardcode_direct=yes
-      hardcode_shlibpath_var=no
-      ;;
 
-    hpux9*)
-      if test "$GCC" = yes; then
-	archive_cmds='$RM $output_objdir/$soname~$CC -shared -fPIC ${wl}+b ${wl}$install_libdir -o $output_objdir/$soname $libobjs $deplibs $compiler_flags~test $output_objdir/$soname = $lib || mv $output_objdir/$soname $lib'
-      else
-	archive_cmds='$RM $output_objdir/$soname~$LD -b +b $install_libdir -o $output_objdir/$soname $libobjs $deplibs $linker_flags~test $output_objdir/$soname = $lib || mv $output_objdir/$soname $lib'
-      fi
-      hardcode_libdir_flag_spec='${wl}+b ${wl}$libdir'
-      hardcode_libdir_separator=:
-      hardcode_direct=yes
 
-      # hardcode_minus_L: Not really in the search PATH,
-      # but as the default location of the library.
-      hardcode_minus_L=yes
-      export_dynamic_flag_spec='${wl}-E'
-      ;;
 
-    hpux10*)
-      if test "$GCC" = yes -a "$with_gnu_ld" = no; then
-	archive_cmds='$CC -shared -fPIC ${wl}+h ${wl}$soname ${wl}+b ${wl}$install_libdir -o $lib $libobjs $deplibs $compiler_flags'
-      else
-	archive_cmds='$LD -b +h $soname +b $install_libdir -o $lib $libobjs $deplibs $linker_flags'
-      fi
-      if test "$with_gnu_ld" = no; then
-	hardcode_libdir_flag_spec='${wl}+b ${wl}$libdir'
-	hardcode_libdir_flag_spec_ld='+b $libdir'
-	hardcode_libdir_separator=:
-	hardcode_direct=yes
-	hardcode_direct_absolute=yes
-	export_dynamic_flag_spec='${wl}-E'
-	# hardcode_minus_L: Not really in the search PATH,
-	# but as the default location of the library.
-	hardcode_minus_L=yes
-      fi
-      ;;
 
-    hpux11*)
-      if test "$GCC" = yes -a "$with_gnu_ld" = no; then
-	case $host_cpu in
-	hppa*64*)
-	  archive_cmds='$CC -shared ${wl}+h ${wl}$soname -o $lib $libobjs $deplibs $compiler_flags'
-	  ;;
-	ia64*)
-	  archive_cmds='$CC -shared -fPIC ${wl}+h ${wl}$soname ${wl}+nodefaultrpath -o $lib $libobjs $deplibs $compiler_flags'
-	  ;;
-	*)
-	  archive_cmds='$CC -shared -fPIC ${wl}+h ${wl}$soname ${wl}+b ${wl}$install_libdir -o $lib $libobjs $deplibs $compiler_flags'
-	  ;;
-	esac
-      else
-	case $host_cpu in
-	hppa*64*)
-	  archive_cmds='$CC -b ${wl}+h ${wl}$soname -o $lib $libobjs $deplibs $compiler_flags'
-	  ;;
-	ia64*)
-	  archive_cmds='$CC -b ${wl}+h ${wl}$soname ${wl}+nodefaultrpath -o $lib $libobjs $deplibs $compiler_flags'
-	  ;;
-	*)
-	  archive_cmds='$CC -b ${wl}+h ${wl}$soname ${wl}+b ${wl}$install_libdir -o $lib $libobjs $deplibs $compiler_flags'
-	  ;;
-	esac
-      fi
-      if test "$with_gnu_ld" = no; then
-	hardcode_libdir_flag_spec='${wl}+b ${wl}$libdir'
-	hardcode_libdir_separator=:
 
-	case $host_cpu in
-	hppa*64*|ia64*)
-	  hardcode_direct=no
-	  hardcode_shlibpath_var=no
-	  ;;
-	*)
-	  hardcode_direct=yes
-	  hardcode_direct_absolute=yes
-	  export_dynamic_flag_spec='${wl}-E'
 
-	  # hardcode_minus_L: Not really in the search PATH,
-	  # but as the default location of the library.
-	  hardcode_minus_L=yes
-	  ;;
-	esac
-      fi
-      ;;
 
-    irix5* | irix6* | nonstopux*)
-      if test "$GCC" = yes; then
-	archive_cmds='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname ${wl}$soname `test -n "$verstring" && $ECHO "X${wl}-set_version ${wl}$verstring" | $Xsed` ${wl}-update_registry ${wl}${output_objdir}/so_locations -o $lib'
-	# Try to use the -exported_symbol ld option, if it does not
-	# work, assume that -exports_file does not work either and
-	# implicitly export all symbols.
-        save_LDFLAGS="$LDFLAGS"
-        LDFLAGS="$LDFLAGS -shared ${wl}-exported_symbol ${wl}foo ${wl}-update_registry ${wl}/dev/null"
-        cat >conftest.$ac_ext <<_ACEOF
-int foo(void) {}
-_ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest$ac_exeext && {
-	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
-       }; then
-  archive_expsym_cmds='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname ${wl}$soname `test -n "$verstring" && $ECHO "X${wl}-set_version ${wl}$verstring" | $Xsed` ${wl}-update_registry ${wl}${output_objdir}/so_locations ${wl}-exports_file ${wl}$export_symbols -o $lib'
 
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
 
 
-fi
 
-rm -rf conftest.dSYM
-rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
-      conftest$ac_exeext conftest.$ac_ext
-        LDFLAGS="$save_LDFLAGS"
-      else
-	archive_cmds='$CC -shared $libobjs $deplibs $compiler_flags -soname $soname `test -n "$verstring" && $ECHO "X-set_version $verstring" | $Xsed` -update_registry ${output_objdir}/so_locations -o $lib'
-	archive_expsym_cmds='$CC -shared $libobjs $deplibs $compiler_flags -soname $soname `test -n "$verstring" && $ECHO "X-set_version $verstring" | $Xsed` -update_registry ${output_objdir}/so_locations -exports_file $export_symbols -o $lib'
-      fi
-      archive_cmds_need_lc='no'
-      hardcode_libdir_flag_spec='${wl}-rpath ${wl}$libdir'
-      hardcode_libdir_separator=:
-      inherit_rpath=yes
-      link_all_deplibs=yes
-      ;;
+test -z "$LN_S" && LN_S="ln -s"
+
+
 
-    netbsd*)
-      if echo __ELF__ | $CC -E - | $GREP __ELF__ >/dev/null; then
-	archive_cmds='$LD -Bshareable -o $lib $libobjs $deplibs $linker_flags'  # a.out
-      else
-	archive_cmds='$LD -shared -o $lib $libobjs $deplibs $linker_flags'      # ELF
-      fi
-      hardcode_libdir_flag_spec='-R$libdir'
-      hardcode_direct=yes
-      hardcode_shlibpath_var=no
-      ;;
 
-    newsos6)
-      archive_cmds='$LD -G -h $soname -o $lib $libobjs $deplibs $linker_flags'
-      hardcode_direct=yes
-      hardcode_libdir_flag_spec='${wl}-rpath ${wl}$libdir'
-      hardcode_libdir_separator=:
-      hardcode_shlibpath_var=no
-      ;;
 
-    *nto* | *qnx*)
-      ;;
 
-    openbsd*)
-      if test -f /usr/libexec/ld.so; then
-	hardcode_direct=yes
-	hardcode_shlibpath_var=no
-	hardcode_direct_absolute=yes
-	if test -z "`echo __ELF__ | $CC -E - | $GREP __ELF__`" || test "$host_os-$host_cpu" = "openbsd2.8-powerpc"; then
-	  archive_cmds='$CC -shared $pic_flag -o $lib $libobjs $deplibs $compiler_flags'
-	  archive_expsym_cmds='$CC -shared $pic_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-retain-symbols-file,$export_symbols'
-	  hardcode_libdir_flag_spec='${wl}-rpath,$libdir'
-	  export_dynamic_flag_spec='${wl}-E'
-	else
-	  case $host_os in
-	   openbsd[01].* | openbsd2.[0-7] | openbsd2.[0-7].*)
-	     archive_cmds='$LD -Bshareable -o $lib $libobjs $deplibs $linker_flags'
-	     hardcode_libdir_flag_spec='-R$libdir'
-	     ;;
-	   *)
-	     archive_cmds='$CC -shared $pic_flag -o $lib $libobjs $deplibs $compiler_flags'
-	     hardcode_libdir_flag_spec='${wl}-rpath,$libdir'
-	     ;;
-	  esac
-	fi
-      else
-	ld_shlibs=no
-      fi
-      ;;
 
-    os2*)
-      hardcode_libdir_flag_spec='-L$libdir'
-      hardcode_minus_L=yes
-      allow_undefined_flag=unsupported
-      archive_cmds='$ECHO "LIBRARY $libname INITINSTANCE" > $output_objdir/$libname.def~$ECHO "DESCRIPTION \"$libname\"" >> $output_objdir/$libname.def~$ECHO DATA >> $output_objdir/$libname.def~$ECHO " SINGLE NONSHARED" >> $output_objdir/$libname.def~$ECHO EXPORTS >> $output_objdir/$libname.def~emxexp $libobjs >> $output_objdir/$libname.def~$CC -Zdll -Zcrtdll -o $lib $libobjs $deplibs $compiler_flags $output_objdir/$libname.def'
-      old_archive_from_new_cmds='emximp -o $output_objdir/$libname.a $output_objdir/$libname.def'
-      ;;
 
-    osf3*)
-      if test "$GCC" = yes; then
-	allow_undefined_flag=' ${wl}-expect_unresolved ${wl}\*'
-	archive_cmds='$CC -shared${allow_undefined_flag} $libobjs $deplibs $compiler_flags ${wl}-soname ${wl}$soname `test -n "$verstring" && $ECHO "X${wl}-set_version ${wl}$verstring" | $Xsed` ${wl}-update_registry ${wl}${output_objdir}/so_locations -o $lib'
-      else
-	allow_undefined_flag=' -expect_unresolved \*'
-	archive_cmds='$CC -shared${allow_undefined_flag} $libobjs $deplibs $compiler_flags -soname $soname `test -n "$verstring" && $ECHO "X-set_version $verstring" | $Xsed` -update_registry ${output_objdir}/so_locations -o $lib'
-      fi
-      archive_cmds_need_lc='no'
-      hardcode_libdir_flag_spec='${wl}-rpath ${wl}$libdir'
-      hardcode_libdir_separator=:
-      ;;
 
-    osf4* | osf5*)	# as osf3* with the addition of -msym flag
-      if test "$GCC" = yes; then
-	allow_undefined_flag=' ${wl}-expect_unresolved ${wl}\*'
-	archive_cmds='$CC -shared${allow_undefined_flag} $libobjs $deplibs $compiler_flags ${wl}-msym ${wl}-soname ${wl}$soname `test -n "$verstring" && $ECHO "X${wl}-set_version ${wl}$verstring" | $Xsed` ${wl}-update_registry ${wl}${output_objdir}/so_locations -o $lib'
-	hardcode_libdir_flag_spec='${wl}-rpath ${wl}$libdir'
-      else
-	allow_undefined_flag=' -expect_unresolved \*'
-	archive_cmds='$CC -shared${allow_undefined_flag} $libobjs $deplibs $compiler_flags -msym -soname $soname `test -n "$verstring" && $ECHO "X-set_version $verstring" | $Xsed` -update_registry ${output_objdir}/so_locations -o $lib'
-	archive_expsym_cmds='for i in `cat $export_symbols`; do printf "%s %s\\n" -exported_symbol "\$i" >> $lib.exp; done; printf "%s\\n" "-hidden">> $lib.exp~
-	$CC -shared${allow_undefined_flag} ${wl}-input ${wl}$lib.exp $compiler_flags $libobjs $deplibs -soname $soname `test -n "$verstring" && $ECHO "X-set_version $verstring" | $Xsed` -update_registry ${output_objdir}/so_locations -o $lib~$RM $lib.exp'
 
-	# Both c and cxx compiler support -rpath directly
-	hardcode_libdir_flag_spec='-rpath $libdir'
-      fi
-      archive_cmds_need_lc='no'
-      hardcode_libdir_separator=:
-      ;;
 
-    solaris*)
-      no_undefined_flag=' -z defs'
-      if test "$GCC" = yes; then
-	wlarc='${wl}'
-	archive_cmds='$CC -shared ${wl}-z ${wl}text ${wl}-h ${wl}$soname -o $lib $libobjs $deplibs $compiler_flags'
-	archive_expsym_cmds='echo "{ global:" > $lib.exp~cat $export_symbols | $SED -e "s/\(.*\)/\1;/" >> $lib.exp~echo "local: *; };" >> $lib.exp~
-	  $CC -shared ${wl}-z ${wl}text ${wl}-M ${wl}$lib.exp ${wl}-h ${wl}$soname -o $lib $libobjs $deplibs $compiler_flags~$RM $lib.exp'
-      else
-	case `$CC -V 2>&1` in
-	*"Compilers 5.0"*)
-	  wlarc=''
-	  archive_cmds='$LD -G${allow_undefined_flag} -h $soname -o $lib $libobjs $deplibs $linker_flags'
-	  archive_expsym_cmds='echo "{ global:" > $lib.exp~cat $export_symbols | $SED -e "s/\(.*\)/\1;/" >> $lib.exp~echo "local: *; };" >> $lib.exp~
-	  $LD -G${allow_undefined_flag} -M $lib.exp -h $soname -o $lib $libobjs $deplibs $linker_flags~$RM $lib.exp'
-	  ;;
-	*)
-	  wlarc='${wl}'
-	  archive_cmds='$CC -G${allow_undefined_flag} -h $soname -o $lib $libobjs $deplibs $compiler_flags'
-	  archive_expsym_cmds='echo "{ global:" > $lib.exp~cat $export_symbols | $SED -e "s/\(.*\)/\1;/" >> $lib.exp~echo "local: *; };" >> $lib.exp~
-	  $CC -G${allow_undefined_flag} -M $lib.exp -h $soname -o $lib $libobjs $deplibs $compiler_flags~$RM $lib.exp'
-	  ;;
-	esac
-      fi
-      hardcode_libdir_flag_spec='-R$libdir'
-      hardcode_shlibpath_var=no
-      case $host_os in
-      solaris2.[0-5] | solaris2.[0-5].*) ;;
-      *)
-	# The compiler driver will combine and reorder linker options,
-	# but understands `-z linker_flag'.  GCC discards it without `$wl',
-	# but is careful enough not to reorder.
-	# Supported since Solaris 2.6 (maybe 2.5.1?)
-	if test "$GCC" = yes; then
-	  whole_archive_flag_spec='${wl}-z ${wl}allextract$convenience ${wl}-z ${wl}defaultextract'
-	else
-	  whole_archive_flag_spec='-z allextract$convenience -z defaultextract'
-	fi
-	;;
-      esac
-      link_all_deplibs=yes
-      ;;
 
-    sunos4*)
-      if test "x$host_vendor" = xsequent; then
-	# Use $CC to link under sequent, because it throws in some extra .o
-	# files that make .init and .fini sections work.
-	archive_cmds='$CC -G ${wl}-h $soname -o $lib $libobjs $deplibs $compiler_flags'
-      else
-	archive_cmds='$LD -assert pure-text -Bstatic -o $lib $libobjs $deplibs $linker_flags'
-      fi
-      hardcode_libdir_flag_spec='-L$libdir'
-      hardcode_direct=yes
-      hardcode_minus_L=yes
-      hardcode_shlibpath_var=no
-      ;;
 
-    sysv4)
-      case $host_vendor in
-	sni)
-	  archive_cmds='$LD -G -h $soname -o $lib $libobjs $deplibs $linker_flags'
-	  hardcode_direct=yes # is this really true???
-	;;
-	siemens)
-	  ## LD is ld it makes a PLAMLIB
-	  ## CC just makes a GrossModule.
-	  archive_cmds='$LD -G -o $lib $libobjs $deplibs $linker_flags'
-	  reload_cmds='$CC -r -o $output$reload_objs'
-	  hardcode_direct=no
-        ;;
-	motorola)
-	  archive_cmds='$LD -G -h $soname -o $lib $libobjs $deplibs $linker_flags'
-	  hardcode_direct=no #Motorola manual says yes, but my tests say they lie
-	;;
-      esac
-      runpath_var='LD_RUN_PATH'
-      hardcode_shlibpath_var=no
-      ;;
 
-    sysv4.3*)
-      archive_cmds='$LD -G -h $soname -o $lib $libobjs $deplibs $linker_flags'
-      hardcode_shlibpath_var=no
-      export_dynamic_flag_spec='-Bexport'
-      ;;
+if test -n "${ZSH_VERSION+set}" ; then
+   setopt NO_GLOB_SUBST
+fi
 
-    sysv4*MP*)
-      if test -d /usr/nec; then
-	archive_cmds='$LD -G -h $soname -o $lib $libobjs $deplibs $linker_flags'
-	hardcode_shlibpath_var=no
-	runpath_var=LD_RUN_PATH
-	hardcode_runpath_var=yes
-	ld_shlibs=yes
-      fi
-      ;;
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for objdir" >&5
+$as_echo_n "checking for objdir... " >&6; }
+if ${lt_cv_objdir+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  rm -f .libs 2>/dev/null
+mkdir .libs 2>/dev/null
+if test -d .libs; then
+  lt_cv_objdir=.libs
+else
+  # MS-DOS does not allow filenames that begin with a dot.
+  lt_cv_objdir=_libs
+fi
+rmdir .libs 2>/dev/null
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_objdir" >&5
+$as_echo "$lt_cv_objdir" >&6; }
+objdir=$lt_cv_objdir
 
-    sysv4*uw2* | sysv5OpenUNIX* | sysv5UnixWare7.[01].[10]* | unixware7* | sco3.2v5.0.[024]*)
-      no_undefined_flag='${wl}-z,text'
-      archive_cmds_need_lc=no
-      hardcode_shlibpath_var=no
-      runpath_var='LD_RUN_PATH'
 
-      if test "$GCC" = yes; then
-	archive_cmds='$CC -shared ${wl}-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
-	archive_expsym_cmds='$CC -shared ${wl}-Bexport:$export_symbols ${wl}-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
-      else
-	archive_cmds='$CC -G ${wl}-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
-	archive_expsym_cmds='$CC -G ${wl}-Bexport:$export_symbols ${wl}-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
-      fi
-      ;;
 
-    sysv5* | sco3.2v5* | sco5v6*)
-      # Note: We can NOT use -z defs as we might desire, because we do not
-      # link with -lc, and that would cause any symbols used from libc to
-      # always be unresolved, which means just about no library would
-      # ever link correctly.  If we're not using GNU ld we use -z text
-      # though, which does catch some bad symbols but isn't as heavy-handed
-      # as -z defs.
-      no_undefined_flag='${wl}-z,text'
-      allow_undefined_flag='${wl}-z,nodefs'
-      archive_cmds_need_lc=no
-      hardcode_shlibpath_var=no
-      hardcode_libdir_flag_spec='${wl}-R,$libdir'
-      hardcode_libdir_separator=':'
-      link_all_deplibs=yes
-      export_dynamic_flag_spec='${wl}-Bexport'
-      runpath_var='LD_RUN_PATH'
 
-      if test "$GCC" = yes; then
-	archive_cmds='$CC -shared ${wl}-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
-	archive_expsym_cmds='$CC -shared ${wl}-Bexport:$export_symbols ${wl}-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
-      else
-	archive_cmds='$CC -G ${wl}-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
-	archive_expsym_cmds='$CC -G ${wl}-Bexport:$export_symbols ${wl}-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
-      fi
-      ;;
 
-    uts4*)
-      archive_cmds='$LD -G -h $soname -o $lib $libobjs $deplibs $linker_flags'
-      hardcode_libdir_flag_spec='-L$libdir'
-      hardcode_shlibpath_var=no
-      ;;
+cat >>confdefs.h <<_ACEOF
+#define LT_OBJDIR "$lt_cv_objdir/"
+_ACEOF
 
-    *)
-      ld_shlibs=no
-      ;;
-    esac
 
-    if test x$host_vendor = xsni; then
-      case $host in
-      sysv4 | sysv4.2uw2* | sysv4.3* | sysv5*)
-	export_dynamic_flag_spec='${wl}-Blargedynsym'
-	;;
-      esac
-    fi
-  fi
 
-{ $as_echo "$as_me:$LINENO: result: $ld_shlibs" >&5
-$as_echo "$ld_shlibs" >&6; }
-test "$ld_shlibs" = no && can_build_shared=no
 
-with_gnu_ld=$with_gnu_ld
+case $host_os in
+aix3*)
+  # AIX sometimes has problems with the GCC collect2 program.  For some
+  # reason, if we set the COLLECT_NAMES environment variable, the problems
+  # vanish in a puff of smoke.
+  if test "X${COLLECT_NAMES+set}" != Xset; then
+    COLLECT_NAMES=
+    export COLLECT_NAMES
+  fi
+  ;;
+esac
+
+# Global variables:
+ofile=libtool
+can_build_shared=yes
 
+# All known linkers require a `.a' archive for static linking (except MSVC,
+# which needs '.lib').
+libext=a
 
+with_gnu_ld="$lt_cv_prog_gnu_ld"
 
+old_CC="$CC"
+old_CFLAGS="$CFLAGS"
 
+# Set sane defaults for various variables
+test -z "$CC" && CC=cc
+test -z "$LTCC" && LTCC=$CC
+test -z "$LTCFLAGS" && LTCFLAGS=$CFLAGS
+test -z "$LD" && LD=ld
+test -z "$ac_objext" && ac_objext=o
 
+for cc_temp in $compiler""; do
+  case $cc_temp in
+    compile | *[\\/]compile | ccache | *[\\/]ccache ) ;;
+    distcc | *[\\/]distcc | purify | *[\\/]purify ) ;;
+    \-*) ;;
+    *) break;;
+  esac
+done
+cc_basename=`$ECHO "$cc_temp" | $SED "s%.*/%%; s%^$host_alias-%%"`
 
 
+# Only perform the check for file, if the check method requires it
+test -z "$MAGIC_CMD" && MAGIC_CMD=file
+case $deplibs_check_method in
+file_magic*)
+  if test "$file_magic_cmd" = '$MAGIC_CMD'; then
+    { $as_echo "$as_me:${as_lineno-$LINENO}: checking for ${ac_tool_prefix}file" >&5
+$as_echo_n "checking for ${ac_tool_prefix}file... " >&6; }
+if ${lt_cv_path_MAGIC_CMD+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  case $MAGIC_CMD in
+[\\/*] |  ?:[\\/]*)
+  lt_cv_path_MAGIC_CMD="$MAGIC_CMD" # Let the user override the test with a path.
+  ;;
+*)
+  lt_save_MAGIC_CMD="$MAGIC_CMD"
+  lt_save_ifs="$IFS"; IFS=$PATH_SEPARATOR
+  ac_dummy="/usr/bin$PATH_SEPARATOR$PATH"
+  for ac_dir in $ac_dummy; do
+    IFS="$lt_save_ifs"
+    test -z "$ac_dir" && ac_dir=.
+    if test -f $ac_dir/${ac_tool_prefix}file; then
+      lt_cv_path_MAGIC_CMD="$ac_dir/${ac_tool_prefix}file"
+      if test -n "$file_magic_test_file"; then
+	case $deplibs_check_method in
+	"file_magic "*)
+	  file_magic_regex=`expr "$deplibs_check_method" : "file_magic \(.*\)"`
+	  MAGIC_CMD="$lt_cv_path_MAGIC_CMD"
+	  if eval $file_magic_cmd \$file_magic_test_file 2> /dev/null |
+	    $EGREP "$file_magic_regex" > /dev/null; then
+	    :
+	  else
+	    cat <<_LT_EOF 1>&2
 
+*** Warning: the command libtool uses to detect shared libraries,
+*** $file_magic_cmd, produces output that libtool cannot recognize.
+*** The result is that libtool may fail to recognize shared libraries
+*** as such.  This will affect the creation of libtool libraries that
+*** depend on shared libraries, but programs linked with such libtool
+*** libraries will work regardless of this problem.  Nevertheless, you
+*** may want to report the problem to your system manager and/or to
+*** bug-libtool@gnu.org
 
+_LT_EOF
+	  fi ;;
+	esac
+      fi
+      break
+    fi
+  done
+  IFS="$lt_save_ifs"
+  MAGIC_CMD="$lt_save_MAGIC_CMD"
+  ;;
+esac
+fi
 
+MAGIC_CMD="$lt_cv_path_MAGIC_CMD"
+if test -n "$MAGIC_CMD"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $MAGIC_CMD" >&5
+$as_echo "$MAGIC_CMD" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
 
 
 
 
 
-#
-# Do we need to explicitly link libc?
-#
-case "x$archive_cmds_need_lc" in
-x|xyes)
-  # Assume -lc should be added
-  archive_cmds_need_lc=yes
+if test -z "$lt_cv_path_MAGIC_CMD"; then
+  if test -n "$ac_tool_prefix"; then
+    { $as_echo "$as_me:${as_lineno-$LINENO}: checking for file" >&5
+$as_echo_n "checking for file... " >&6; }
+if ${lt_cv_path_MAGIC_CMD+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  case $MAGIC_CMD in
+[\\/*] |  ?:[\\/]*)
+  lt_cv_path_MAGIC_CMD="$MAGIC_CMD" # Let the user override the test with a path.
+  ;;
+*)
+  lt_save_MAGIC_CMD="$MAGIC_CMD"
+  lt_save_ifs="$IFS"; IFS=$PATH_SEPARATOR
+  ac_dummy="/usr/bin$PATH_SEPARATOR$PATH"
+  for ac_dir in $ac_dummy; do
+    IFS="$lt_save_ifs"
+    test -z "$ac_dir" && ac_dir=.
+    if test -f $ac_dir/file; then
+      lt_cv_path_MAGIC_CMD="$ac_dir/file"
+      if test -n "$file_magic_test_file"; then
+	case $deplibs_check_method in
+	"file_magic "*)
+	  file_magic_regex=`expr "$deplibs_check_method" : "file_magic \(.*\)"`
+	  MAGIC_CMD="$lt_cv_path_MAGIC_CMD"
+	  if eval $file_magic_cmd \$file_magic_test_file 2> /dev/null |
+	    $EGREP "$file_magic_regex" > /dev/null; then
+	    :
+	  else
+	    cat <<_LT_EOF 1>&2
 
-  if test "$enable_shared" = yes && test "$GCC" = yes; then
-    case $archive_cmds in
-    *'~'*)
-      # FIXME: we may have to deal with multi-command sequences.
-      ;;
-    '$CC '*)
-      # Test whether the compiler implicitly links with -lc since on some
-      # systems, -lgcc has to come before -lc. If gcc already passes -lc
-      # to ld, don't add -lc before -lgcc.
-      { $as_echo "$as_me:$LINENO: checking whether -lc should be explicitly linked in" >&5
-$as_echo_n "checking whether -lc should be explicitly linked in... " >&6; }
-      $RM conftest*
-      echo "$lt_simple_compile_test_code" > conftest.$ac_ext
+*** Warning: the command libtool uses to detect shared libraries,
+*** $file_magic_cmd, produces output that libtool cannot recognize.
+*** The result is that libtool may fail to recognize shared libraries
+*** as such.  This will affect the creation of libtool libraries that
+*** depend on shared libraries, but programs linked with such libtool
+*** libraries will work regardless of this problem.  Nevertheless, you
+*** may want to report the problem to your system manager and/or to
+*** bug-libtool@gnu.org
 
-      if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
-  (eval $ac_compile) 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } 2>conftest.err; then
-        soname=conftest
-        lib=conftest
-        libobjs=conftest.$ac_objext
-        deplibs=
-        wl=$lt_prog_compiler_wl
-	pic_flag=$lt_prog_compiler_pic
-        compiler_flags=-v
-        linker_flags=-v
-        verstring=
-        output_objdir=.
-        libname=conftest
-        lt_save_allow_undefined_flag=$allow_undefined_flag
-        allow_undefined_flag=
-        if { (eval echo "$as_me:$LINENO: \"$archive_cmds 2\>\&1 \| $GREP \" -lc \" \>/dev/null 2\>\&1\"") >&5
-  (eval $archive_cmds 2\>\&1 \| $GREP \" -lc \" \>/dev/null 2\>\&1) 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }
-        then
-	  archive_cmds_need_lc=no
-        else
-	  archive_cmds_need_lc=yes
-        fi
-        allow_undefined_flag=$lt_save_allow_undefined_flag
-      else
-        cat conftest.err 1>&5
+_LT_EOF
+	  fi ;;
+	esac
       fi
-      $RM conftest*
-      { $as_echo "$as_me:$LINENO: result: $archive_cmds_need_lc" >&5
-$as_echo "$archive_cmds_need_lc" >&6; }
-      ;;
-    esac
-  fi
+      break
+    fi
+  done
+  IFS="$lt_save_ifs"
+  MAGIC_CMD="$lt_save_MAGIC_CMD"
   ;;
 esac
+fi
 
+MAGIC_CMD="$lt_cv_path_MAGIC_CMD"
+if test -n "$MAGIC_CMD"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $MAGIC_CMD" >&5
+$as_echo "$MAGIC_CMD" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
 
 
+  else
+    MAGIC_CMD=:
+  fi
+fi
 
+  fi
+  ;;
+esac
 
+# Use C for the default configuration in the libtool script
 
+lt_save_CC="$CC"
+ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
 
 
+# Source file extension for C test sources.
+ac_ext=c
 
+# Object file extension for compiled C test sources.
+objext=o
+objext=$objext
 
+# Code to be used in simple compile tests
+lt_simple_compile_test_code="int some_variable = 0;"
 
+# Code to be used in simple link tests
+lt_simple_link_test_code='int main(){return(0);}'
 
 
 
@@ -8539,62 +7583,475 @@ esac
 
 
 
+# If no C compiler was specified, use CC.
+LTCC=${LTCC-"$CC"}
 
+# If no C compiler flags were specified, use CFLAGS.
+LTCFLAGS=${LTCFLAGS-"$CFLAGS"}
 
+# Allow CC to be a program name with arguments.
+compiler=$CC
 
+# Save the default compiler, since it gets overwritten when the other
+# tags are being tested, and _LT_TAGVAR(compiler, []) is a NOP.
+compiler_DEFAULT=$CC
 
+# save warnings/boilerplate of simple test code
+ac_outfile=conftest.$ac_objext
+echo "$lt_simple_compile_test_code" >conftest.$ac_ext
+eval "$ac_compile" 2>&1 >/dev/null | $SED '/^$/d; /^ *+/d' >conftest.err
+_lt_compiler_boilerplate=`cat conftest.err`
+$RM conftest*
 
+ac_outfile=conftest.$ac_objext
+echo "$lt_simple_link_test_code" >conftest.$ac_ext
+eval "$ac_link" 2>&1 >/dev/null | $SED '/^$/d; /^ *+/d' >conftest.err
+_lt_linker_boilerplate=`cat conftest.err`
+$RM -r conftest*
 
 
+## CAVEAT EMPTOR:
+## There is no encapsulation within the following macros, do not change
+## the running order or otherwise move them around unless you know exactly
+## what you are doing...
+if test -n "$compiler"; then
 
+lt_prog_compiler_no_builtin_flag=
 
+if test "$GCC" = yes; then
+  case $cc_basename in
+  nvcc*)
+    lt_prog_compiler_no_builtin_flag=' -Xcompiler -fno-builtin' ;;
+  *)
+    lt_prog_compiler_no_builtin_flag=' -fno-builtin' ;;
+  esac
 
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking if $compiler supports -fno-rtti -fno-exceptions" >&5
+$as_echo_n "checking if $compiler supports -fno-rtti -fno-exceptions... " >&6; }
+if ${lt_cv_prog_compiler_rtti_exceptions+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  lt_cv_prog_compiler_rtti_exceptions=no
+   ac_outfile=conftest.$ac_objext
+   echo "$lt_simple_compile_test_code" > conftest.$ac_ext
+   lt_compiler_flag="-fno-rtti -fno-exceptions"
+   # Insert the option either (1) after the last *FLAGS variable, or
+   # (2) before a word containing "conftest.", or (3) at the end.
+   # Note that $ac_compile itself does not contain backslashes and begins
+   # with a dollar sign (not a hyphen), so the echo should work correctly.
+   # The option is referenced via a variable to avoid confusing sed.
+   lt_compile=`echo "$ac_compile" | $SED \
+   -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
+   -e 's: [^ ]*conftest\.: $lt_compiler_flag&:; t' \
+   -e 's:$: $lt_compiler_flag:'`
+   (eval echo "\"\$as_me:$LINENO: $lt_compile\"" >&5)
+   (eval "$lt_compile" 2>conftest.err)
+   ac_status=$?
+   cat conftest.err >&5
+   echo "$as_me:$LINENO: \$? = $ac_status" >&5
+   if (exit $ac_status) && test -s "$ac_outfile"; then
+     # The compiler can only warn and ignore the option if not recognized
+     # So say no if there are warnings other than the usual output.
+     $ECHO "$_lt_compiler_boilerplate" | $SED '/^$/d' >conftest.exp
+     $SED '/^$/d; /^ *+/d' conftest.err >conftest.er2
+     if test ! -s conftest.er2 || diff conftest.exp conftest.er2 >/dev/null; then
+       lt_cv_prog_compiler_rtti_exceptions=yes
+     fi
+   fi
+   $RM conftest*
 
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_prog_compiler_rtti_exceptions" >&5
+$as_echo "$lt_cv_prog_compiler_rtti_exceptions" >&6; }
 
+if test x"$lt_cv_prog_compiler_rtti_exceptions" = xyes; then
+    lt_prog_compiler_no_builtin_flag="$lt_prog_compiler_no_builtin_flag -fno-rtti -fno-exceptions"
+else
+    :
+fi
 
+fi
 
 
 
 
 
 
+  lt_prog_compiler_wl=
+lt_prog_compiler_pic=
+lt_prog_compiler_static=
 
 
+  if test "$GCC" = yes; then
+    lt_prog_compiler_wl='-Wl,'
+    lt_prog_compiler_static='-static'
 
+    case $host_os in
+      aix*)
+      # All AIX code is PIC.
+      if test "$host_cpu" = ia64; then
+	# AIX 5 now supports IA64 processor
+	lt_prog_compiler_static='-Bstatic'
+      fi
+      ;;
 
+    amigaos*)
+      case $host_cpu in
+      powerpc)
+            # see comment about AmigaOS4 .so support
+            lt_prog_compiler_pic='-fPIC'
+        ;;
+      m68k)
+            # FIXME: we need at least 68020 code to build shared libraries, but
+            # adding the `-m68020' flag to GCC prevents building anything better,
+            # like `-m68040'.
+            lt_prog_compiler_pic='-m68020 -resident32 -malways-restore-a4'
+        ;;
+      esac
+      ;;
 
+    beos* | irix5* | irix6* | nonstopux* | osf3* | osf4* | osf5*)
+      # PIC is the default for these OSes.
+      ;;
 
+    mingw* | cygwin* | pw32* | os2* | cegcc*)
+      # This hack is so that the source file can tell whether it is being
+      # built for inclusion in a dll (and should export symbols for example).
+      # Although the cygwin gcc ignores -fPIC, still need this for old-style
+      # (--disable-auto-import) libraries
+      lt_prog_compiler_pic='-DDLL_EXPORT'
+      ;;
 
+    darwin* | rhapsody*)
+      # PIC is the default on this platform
+      # Common symbols not allowed in MH_DYLIB files
+      lt_prog_compiler_pic='-fno-common'
+      ;;
 
+    haiku*)
+      # PIC is the default for Haiku.
+      # The "-static" flag exists, but is broken.
+      lt_prog_compiler_static=
+      ;;
 
+    hpux*)
+      # PIC is the default for 64-bit PA HP-UX, but not for 32-bit
+      # PA HP-UX.  On IA64 HP-UX, PIC is the default but the pic flag
+      # sets the default TLS model and affects inlining.
+      case $host_cpu in
+      hppa*64*)
+	# +Z the default
+	;;
+      *)
+	lt_prog_compiler_pic='-fPIC'
+	;;
+      esac
+      ;;
 
+    interix[3-9]*)
+      # Interix 3.x gcc -fpic/-fPIC options generate broken code.
+      # Instead, we relocate shared libraries at runtime.
+      ;;
 
+    msdosdjgpp*)
+      # Just because we use GCC doesn't mean we suddenly get shared libraries
+      # on systems that don't support them.
+      lt_prog_compiler_can_build_shared=no
+      enable_shared=no
+      ;;
 
+    *nto* | *qnx*)
+      # QNX uses GNU C++, but need to define -shared option too, otherwise
+      # it will coredump.
+      lt_prog_compiler_pic='-fPIC -shared'
+      ;;
 
+    sysv4*MP*)
+      if test -d /usr/nec; then
+	lt_prog_compiler_pic=-Kconform_pic
+      fi
+      ;;
 
+    *)
+      lt_prog_compiler_pic='-fPIC'
+      ;;
+    esac
 
+    case $cc_basename in
+    nvcc*) # Cuda Compiler Driver 2.2
+      lt_prog_compiler_wl='-Xlinker '
+      if test -n "$lt_prog_compiler_pic"; then
+        lt_prog_compiler_pic="-Xcompiler $lt_prog_compiler_pic"
+      fi
+      ;;
+    esac
+  else
+    # PORTME Check for flag to pass linker flags through the system compiler.
+    case $host_os in
+    aix*)
+      lt_prog_compiler_wl='-Wl,'
+      if test "$host_cpu" = ia64; then
+	# AIX 5 now supports IA64 processor
+	lt_prog_compiler_static='-Bstatic'
+      else
+	lt_prog_compiler_static='-bnso -bI:/lib/syscalls.exp'
+      fi
+      ;;
 
+    mingw* | cygwin* | pw32* | os2* | cegcc*)
+      # This hack is so that the source file can tell whether it is being
+      # built for inclusion in a dll (and should export symbols for example).
+      lt_prog_compiler_pic='-DDLL_EXPORT'
+      ;;
 
+    hpux9* | hpux10* | hpux11*)
+      lt_prog_compiler_wl='-Wl,'
+      # PIC is the default for IA64 HP-UX and 64-bit HP-UX, but
+      # not for PA HP-UX.
+      case $host_cpu in
+      hppa*64*|ia64*)
+	# +Z the default
+	;;
+      *)
+	lt_prog_compiler_pic='+Z'
+	;;
+      esac
+      # Is there a better lt_prog_compiler_static that works with the bundled CC?
+      lt_prog_compiler_static='${wl}-a ${wl}archive'
+      ;;
 
+    irix5* | irix6* | nonstopux*)
+      lt_prog_compiler_wl='-Wl,'
+      # PIC (with -KPIC) is the default.
+      lt_prog_compiler_static='-non_shared'
+      ;;
 
+    linux* | k*bsd*-gnu | kopensolaris*-gnu)
+      case $cc_basename in
+      # old Intel for x86_64 which still supported -KPIC.
+      ecc*)
+	lt_prog_compiler_wl='-Wl,'
+	lt_prog_compiler_pic='-KPIC'
+	lt_prog_compiler_static='-static'
+        ;;
+      # icc used to be incompatible with GCC.
+      # ICC 10 doesn't accept -KPIC any more.
+      icc* | ifort*)
+	lt_prog_compiler_wl='-Wl,'
+	lt_prog_compiler_pic='-fPIC'
+	lt_prog_compiler_static='-static'
+        ;;
+      # Lahey Fortran 8.1.
+      lf95*)
+	lt_prog_compiler_wl='-Wl,'
+	lt_prog_compiler_pic='--shared'
+	lt_prog_compiler_static='--static'
+	;;
+      nagfor*)
+	# NAG Fortran compiler
+	lt_prog_compiler_wl='-Wl,-Wl,,'
+	lt_prog_compiler_pic='-PIC'
+	lt_prog_compiler_static='-Bstatic'
+	;;
+      pgcc* | pgf77* | pgf90* | pgf95* | pgfortran*)
+        # Portland Group compilers (*not* the Pentium gcc compiler,
+	# which looks to be a dead project)
+	lt_prog_compiler_wl='-Wl,'
+	lt_prog_compiler_pic='-fpic'
+	lt_prog_compiler_static='-Bstatic'
+        ;;
+      ccc*)
+        lt_prog_compiler_wl='-Wl,'
+        # All Alpha code is PIC.
+        lt_prog_compiler_static='-non_shared'
+        ;;
+      xl* | bgxl* | bgf* | mpixl*)
+	# IBM XL C 8.0/Fortran 10.1, 11.1 on PPC and BlueGene
+	lt_prog_compiler_wl='-Wl,'
+	lt_prog_compiler_pic='-qpic'
+	lt_prog_compiler_static='-qstaticlink'
+	;;
+      *)
+	case `$CC -V 2>&1 | sed 5q` in
+	*Sun\ Ceres\ Fortran* | *Sun*Fortran*\ [1-7].* | *Sun*Fortran*\ 8.[0-3]*)
+	  # Sun Fortran 8.3 passes all unrecognized flags to the linker
+	  lt_prog_compiler_pic='-KPIC'
+	  lt_prog_compiler_static='-Bstatic'
+	  lt_prog_compiler_wl=''
+	  ;;
+	*Sun\ F* | *Sun*Fortran*)
+	  lt_prog_compiler_pic='-KPIC'
+	  lt_prog_compiler_static='-Bstatic'
+	  lt_prog_compiler_wl='-Qoption ld '
+	  ;;
+	*Sun\ C*)
+	  # Sun C 5.9
+	  lt_prog_compiler_pic='-KPIC'
+	  lt_prog_compiler_static='-Bstatic'
+	  lt_prog_compiler_wl='-Wl,'
+	  ;;
+        *Intel*\ [CF]*Compiler*)
+	  lt_prog_compiler_wl='-Wl,'
+	  lt_prog_compiler_pic='-fPIC'
+	  lt_prog_compiler_static='-static'
+	  ;;
+	*Portland\ Group*)
+	  lt_prog_compiler_wl='-Wl,'
+	  lt_prog_compiler_pic='-fpic'
+	  lt_prog_compiler_static='-Bstatic'
+	  ;;
+	esac
+	;;
+      esac
+      ;;
 
+    newsos6)
+      lt_prog_compiler_pic='-KPIC'
+      lt_prog_compiler_static='-Bstatic'
+      ;;
 
+    *nto* | *qnx*)
+      # QNX uses GNU C++, but need to define -shared option too, otherwise
+      # it will coredump.
+      lt_prog_compiler_pic='-fPIC -shared'
+      ;;
 
+    osf3* | osf4* | osf5*)
+      lt_prog_compiler_wl='-Wl,'
+      # All OSF/1 code is PIC.
+      lt_prog_compiler_static='-non_shared'
+      ;;
 
+    rdos*)
+      lt_prog_compiler_static='-non_shared'
+      ;;
 
+    solaris*)
+      lt_prog_compiler_pic='-KPIC'
+      lt_prog_compiler_static='-Bstatic'
+      case $cc_basename in
+      f77* | f90* | f95* | sunf77* | sunf90* | sunf95*)
+	lt_prog_compiler_wl='-Qoption ld ';;
+      *)
+	lt_prog_compiler_wl='-Wl,';;
+      esac
+      ;;
 
+    sunos4*)
+      lt_prog_compiler_wl='-Qoption ld '
+      lt_prog_compiler_pic='-PIC'
+      lt_prog_compiler_static='-Bstatic'
+      ;;
 
+    sysv4 | sysv4.2uw2* | sysv4.3*)
+      lt_prog_compiler_wl='-Wl,'
+      lt_prog_compiler_pic='-KPIC'
+      lt_prog_compiler_static='-Bstatic'
+      ;;
 
+    sysv4*MP*)
+      if test -d /usr/nec ;then
+	lt_prog_compiler_pic='-Kconform_pic'
+	lt_prog_compiler_static='-Bstatic'
+      fi
+      ;;
 
+    sysv5* | unixware* | sco3.2v5* | sco5v6* | OpenUNIX*)
+      lt_prog_compiler_wl='-Wl,'
+      lt_prog_compiler_pic='-KPIC'
+      lt_prog_compiler_static='-Bstatic'
+      ;;
 
+    unicos*)
+      lt_prog_compiler_wl='-Wl,'
+      lt_prog_compiler_can_build_shared=no
+      ;;
 
+    uts4*)
+      lt_prog_compiler_pic='-pic'
+      lt_prog_compiler_static='-Bstatic'
+      ;;
 
+    *)
+      lt_prog_compiler_can_build_shared=no
+      ;;
+    esac
+  fi
 
+case $host_os in
+  # For platforms which do not support PIC, -DPIC is meaningless:
+  *djgpp*)
+    lt_prog_compiler_pic=
+    ;;
+  *)
+    lt_prog_compiler_pic="$lt_prog_compiler_pic -DPIC"
+    ;;
+esac
 
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $compiler option to produce PIC" >&5
+$as_echo_n "checking for $compiler option to produce PIC... " >&6; }
+if ${lt_cv_prog_compiler_pic+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  lt_cv_prog_compiler_pic=$lt_prog_compiler_pic
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_prog_compiler_pic" >&5
+$as_echo "$lt_cv_prog_compiler_pic" >&6; }
+lt_prog_compiler_pic=$lt_cv_prog_compiler_pic
 
+#
+# Check to make sure the PIC flag actually works.
+#
+if test -n "$lt_prog_compiler_pic"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking if $compiler PIC flag $lt_prog_compiler_pic works" >&5
+$as_echo_n "checking if $compiler PIC flag $lt_prog_compiler_pic works... " >&6; }
+if ${lt_cv_prog_compiler_pic_works+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  lt_cv_prog_compiler_pic_works=no
+   ac_outfile=conftest.$ac_objext
+   echo "$lt_simple_compile_test_code" > conftest.$ac_ext
+   lt_compiler_flag="$lt_prog_compiler_pic -DPIC"
+   # Insert the option either (1) after the last *FLAGS variable, or
+   # (2) before a word containing "conftest.", or (3) at the end.
+   # Note that $ac_compile itself does not contain backslashes and begins
+   # with a dollar sign (not a hyphen), so the echo should work correctly.
+   # The option is referenced via a variable to avoid confusing sed.
+   lt_compile=`echo "$ac_compile" | $SED \
+   -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
+   -e 's: [^ ]*conftest\.: $lt_compiler_flag&:; t' \
+   -e 's:$: $lt_compiler_flag:'`
+   (eval echo "\"\$as_me:$LINENO: $lt_compile\"" >&5)
+   (eval "$lt_compile" 2>conftest.err)
+   ac_status=$?
+   cat conftest.err >&5
+   echo "$as_me:$LINENO: \$? = $ac_status" >&5
+   if (exit $ac_status) && test -s "$ac_outfile"; then
+     # The compiler can only warn and ignore the option if not recognized
+     # So say no if there are warnings other than the usual output.
+     $ECHO "$_lt_compiler_boilerplate" | $SED '/^$/d' >conftest.exp
+     $SED '/^$/d; /^ *+/d' conftest.err >conftest.er2
+     if test ! -s conftest.er2 || diff conftest.exp conftest.er2 >/dev/null; then
+       lt_cv_prog_compiler_pic_works=yes
+     fi
+   fi
+   $RM conftest*
 
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_prog_compiler_pic_works" >&5
+$as_echo "$lt_cv_prog_compiler_pic_works" >&6; }
 
+if test x"$lt_cv_prog_compiler_pic_works" = xyes; then
+    case $lt_prog_compiler_pic in
+     "" | " "*) ;;
+     *) lt_prog_compiler_pic=" $lt_prog_compiler_pic" ;;
+     esac
+else
+    lt_prog_compiler_pic=
+     lt_prog_compiler_can_build_shared=no
+fi
 
+fi
 
 
 
@@ -8606,8 +8063,46 @@ esac
 
 
 
+#
+# Check to make sure the static flag actually works.
+#
+wl=$lt_prog_compiler_wl eval lt_tmp_static_flag=\"$lt_prog_compiler_static\"
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking if $compiler static flag $lt_tmp_static_flag works" >&5
+$as_echo_n "checking if $compiler static flag $lt_tmp_static_flag works... " >&6; }
+if ${lt_cv_prog_compiler_static_works+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  lt_cv_prog_compiler_static_works=no
+   save_LDFLAGS="$LDFLAGS"
+   LDFLAGS="$LDFLAGS $lt_tmp_static_flag"
+   echo "$lt_simple_link_test_code" > conftest.$ac_ext
+   if (eval $ac_link 2>conftest.err) && test -s conftest$ac_exeext; then
+     # The linker can only warn and ignore the option if not recognized
+     # So say no if there are warnings
+     if test -s conftest.err; then
+       # Append any errors to the config.log.
+       cat conftest.err 1>&5
+       $ECHO "$_lt_linker_boilerplate" | $SED '/^$/d' > conftest.exp
+       $SED '/^$/d; /^ *+/d' conftest.err >conftest.er2
+       if diff conftest.exp conftest.er2 >/dev/null; then
+         lt_cv_prog_compiler_static_works=yes
+       fi
+     else
+       lt_cv_prog_compiler_static_works=yes
+     fi
+   fi
+   $RM -r conftest*
+   LDFLAGS="$save_LDFLAGS"
 
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_prog_compiler_static_works" >&5
+$as_echo "$lt_cv_prog_compiler_static_works" >&6; }
 
+if test x"$lt_cv_prog_compiler_static_works" = xyes; then
+    :
+else
+    lt_prog_compiler_static=
+fi
 
 
 
@@ -8615,773 +8110,1299 @@ esac
 
 
 
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking if $compiler supports -c -o file.$ac_objext" >&5
+$as_echo_n "checking if $compiler supports -c -o file.$ac_objext... " >&6; }
+if ${lt_cv_prog_compiler_c_o+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  lt_cv_prog_compiler_c_o=no
+   $RM -r conftest 2>/dev/null
+   mkdir conftest
+   cd conftest
+   mkdir out
+   echo "$lt_simple_compile_test_code" > conftest.$ac_ext
 
+   lt_compiler_flag="-o out/conftest2.$ac_objext"
+   # Insert the option either (1) after the last *FLAGS variable, or
+   # (2) before a word containing "conftest.", or (3) at the end.
+   # Note that $ac_compile itself does not contain backslashes and begins
+   # with a dollar sign (not a hyphen), so the echo should work correctly.
+   lt_compile=`echo "$ac_compile" | $SED \
+   -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
+   -e 's: [^ ]*conftest\.: $lt_compiler_flag&:; t' \
+   -e 's:$: $lt_compiler_flag:'`
+   (eval echo "\"\$as_me:$LINENO: $lt_compile\"" >&5)
+   (eval "$lt_compile" 2>out/conftest.err)
+   ac_status=$?
+   cat out/conftest.err >&5
+   echo "$as_me:$LINENO: \$? = $ac_status" >&5
+   if (exit $ac_status) && test -s out/conftest2.$ac_objext
+   then
+     # The compiler can only warn and ignore the option if not recognized
+     # So say no if there are warnings
+     $ECHO "$_lt_compiler_boilerplate" | $SED '/^$/d' > out/conftest.exp
+     $SED '/^$/d; /^ *+/d' out/conftest.err >out/conftest.er2
+     if test ! -s out/conftest.er2 || diff out/conftest.exp out/conftest.er2 >/dev/null; then
+       lt_cv_prog_compiler_c_o=yes
+     fi
+   fi
+   chmod u+w . 2>&5
+   $RM conftest*
+   # SGI C++ compiler will create directory out/ii_files/ for
+   # template instantiation
+   test -d out/ii_files && $RM out/ii_files/* && rmdir out/ii_files
+   $RM out/* && rmdir out
+   cd ..
+   $RM -r conftest
+   $RM conftest*
 
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_prog_compiler_c_o" >&5
+$as_echo "$lt_cv_prog_compiler_c_o" >&6; }
 
 
 
 
 
 
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking if $compiler supports -c -o file.$ac_objext" >&5
+$as_echo_n "checking if $compiler supports -c -o file.$ac_objext... " >&6; }
+if ${lt_cv_prog_compiler_c_o+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  lt_cv_prog_compiler_c_o=no
+   $RM -r conftest 2>/dev/null
+   mkdir conftest
+   cd conftest
+   mkdir out
+   echo "$lt_simple_compile_test_code" > conftest.$ac_ext
 
+   lt_compiler_flag="-o out/conftest2.$ac_objext"
+   # Insert the option either (1) after the last *FLAGS variable, or
+   # (2) before a word containing "conftest.", or (3) at the end.
+   # Note that $ac_compile itself does not contain backslashes and begins
+   # with a dollar sign (not a hyphen), so the echo should work correctly.
+   lt_compile=`echo "$ac_compile" | $SED \
+   -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
+   -e 's: [^ ]*conftest\.: $lt_compiler_flag&:; t' \
+   -e 's:$: $lt_compiler_flag:'`
+   (eval echo "\"\$as_me:$LINENO: $lt_compile\"" >&5)
+   (eval "$lt_compile" 2>out/conftest.err)
+   ac_status=$?
+   cat out/conftest.err >&5
+   echo "$as_me:$LINENO: \$? = $ac_status" >&5
+   if (exit $ac_status) && test -s out/conftest2.$ac_objext
+   then
+     # The compiler can only warn and ignore the option if not recognized
+     # So say no if there are warnings
+     $ECHO "$_lt_compiler_boilerplate" | $SED '/^$/d' > out/conftest.exp
+     $SED '/^$/d; /^ *+/d' out/conftest.err >out/conftest.er2
+     if test ! -s out/conftest.er2 || diff out/conftest.exp out/conftest.er2 >/dev/null; then
+       lt_cv_prog_compiler_c_o=yes
+     fi
+   fi
+   chmod u+w . 2>&5
+   $RM conftest*
+   # SGI C++ compiler will create directory out/ii_files/ for
+   # template instantiation
+   test -d out/ii_files && $RM out/ii_files/* && rmdir out/ii_files
+   $RM out/* && rmdir out
+   cd ..
+   $RM -r conftest
+   $RM conftest*
 
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_prog_compiler_c_o" >&5
+$as_echo "$lt_cv_prog_compiler_c_o" >&6; }
 
 
 
 
+hard_links="nottested"
+if test "$lt_cv_prog_compiler_c_o" = no && test "$need_locks" != no; then
+  # do not overwrite the value of need_locks provided by the user
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking if we can lock with hard links" >&5
+$as_echo_n "checking if we can lock with hard links... " >&6; }
+  hard_links=yes
+  $RM conftest*
+  ln conftest.a conftest.b 2>/dev/null && hard_links=no
+  touch conftest.a
+  ln conftest.a conftest.b 2>&5 || hard_links=no
+  ln conftest.a conftest.b 2>/dev/null && hard_links=no
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $hard_links" >&5
+$as_echo "$hard_links" >&6; }
+  if test "$hard_links" = no; then
+    { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: \`$CC' does not support \`-c -o', so \`make -j' may be unsafe" >&5
+$as_echo "$as_me: WARNING: \`$CC' does not support \`-c -o', so \`make -j' may be unsafe" >&2;}
+    need_locks=warn
+  fi
+else
+  need_locks=no
+fi
 
 
 
 
 
 
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether the $compiler linker ($LD) supports shared libraries" >&5
+$as_echo_n "checking whether the $compiler linker ($LD) supports shared libraries... " >&6; }
 
+  runpath_var=
+  allow_undefined_flag=
+  always_export_symbols=no
+  archive_cmds=
+  archive_expsym_cmds=
+  compiler_needs_object=no
+  enable_shared_with_static_runtimes=no
+  export_dynamic_flag_spec=
+  export_symbols_cmds='$NM $libobjs $convenience | $global_symbol_pipe | $SED '\''s/.* //'\'' | sort | uniq > $export_symbols'
+  hardcode_automatic=no
+  hardcode_direct=no
+  hardcode_direct_absolute=no
+  hardcode_libdir_flag_spec=
+  hardcode_libdir_separator=
+  hardcode_minus_L=no
+  hardcode_shlibpath_var=unsupported
+  inherit_rpath=no
+  link_all_deplibs=unknown
+  module_cmds=
+  module_expsym_cmds=
+  old_archive_from_new_cmds=
+  old_archive_from_expsyms_cmds=
+  thread_safe_flag_spec=
+  whole_archive_flag_spec=
+  # include_expsyms should be a list of space-separated symbols to be *always*
+  # included in the symbol list
+  include_expsyms=
+  # exclude_expsyms can be an extended regexp of symbols to exclude
+  # it will be wrapped by ` (' and `)$', so one must not match beginning or
+  # end of line.  Example: `a|bc|.*d.*' will exclude the symbols `a' and `bc',
+  # as well as any symbol that contains `d'.
+  exclude_expsyms='_GLOBAL_OFFSET_TABLE_|_GLOBAL__F[ID]_.*'
+  # Although _GLOBAL_OFFSET_TABLE_ is a valid symbol C name, most a.out
+  # platforms (ab)use it in PIC code, but their linkers get confused if
+  # the symbol is explicitly referenced.  Since portable code cannot
+  # rely on this symbol name, it's probably fine to never include it in
+  # preloaded symbol tables.
+  # Exclude shared library initialization/finalization symbols.
+  extract_expsyms_cmds=
 
+  case $host_os in
+  cygwin* | mingw* | pw32* | cegcc*)
+    # FIXME: the MSVC++ port hasn't been tested in a loooong time
+    # When not using gcc, we currently assume that we are using
+    # Microsoft Visual C++.
+    if test "$GCC" != yes; then
+      with_gnu_ld=no
+    fi
+    ;;
+  interix*)
+    # we just hope/assume this is gcc and not c89 (= MSVC++)
+    with_gnu_ld=yes
+    ;;
+  openbsd*)
+    with_gnu_ld=no
+    ;;
+  esac
 
+  ld_shlibs=yes
 
+  # On some targets, GNU ld is compatible enough with the native linker
+  # that we're better off using the native interface for both.
+  lt_use_gnu_ld_interface=no
+  if test "$with_gnu_ld" = yes; then
+    case $host_os in
+      aix*)
+	# The AIX port of GNU ld has always aspired to compatibility
+	# with the native linker.  However, as the warning in the GNU ld
+	# block says, versions before 2.19.5* couldn't really create working
+	# shared libraries, regardless of the interface used.
+	case `$LD -v 2>&1` in
+	  *\ \(GNU\ Binutils\)\ 2.19.5*) ;;
+	  *\ \(GNU\ Binutils\)\ 2.[2-9]*) ;;
+	  *\ \(GNU\ Binutils\)\ [3-9]*) ;;
+	  *)
+	    lt_use_gnu_ld_interface=yes
+	    ;;
+	esac
+	;;
+      *)
+	lt_use_gnu_ld_interface=yes
+	;;
+    esac
+  fi
 
+  if test "$lt_use_gnu_ld_interface" = yes; then
+    # If archive_cmds runs LD, not CC, wlarc should be empty
+    wlarc='${wl}'
 
+    # Set some defaults for GNU ld with shared library support. These
+    # are reset later if shared libraries are not supported. Putting them
+    # here allows them to be overridden if necessary.
+    runpath_var=LD_RUN_PATH
+    hardcode_libdir_flag_spec='${wl}-rpath ${wl}$libdir'
+    export_dynamic_flag_spec='${wl}--export-dynamic'
+    # ancient GNU ld didn't support --whole-archive et. al.
+    if $LD --help 2>&1 | $GREP 'no-whole-archive' > /dev/null; then
+      whole_archive_flag_spec="$wlarc"'--whole-archive$convenience '"$wlarc"'--no-whole-archive'
+    else
+      whole_archive_flag_spec=
+    fi
+    supports_anon_versioning=no
+    case `$LD -v 2>&1` in
+      *GNU\ gold*) supports_anon_versioning=yes ;;
+      *\ [01].* | *\ 2.[0-9].* | *\ 2.10.*) ;; # catch versions < 2.11
+      *\ 2.11.93.0.2\ *) supports_anon_versioning=yes ;; # RH7.3 ...
+      *\ 2.11.92.0.12\ *) supports_anon_versioning=yes ;; # Mandrake 8.2 ...
+      *\ 2.11.*) ;; # other 2.11 versions
+      *) supports_anon_versioning=yes ;;
+    esac
 
+    # See if GNU ld supports shared libraries.
+    case $host_os in
+    aix[3-9]*)
+      # On AIX/PPC, the GNU linker is very broken
+      if test "$host_cpu" != ia64; then
+	ld_shlibs=no
+	cat <<_LT_EOF 1>&2
 
+*** Warning: the GNU linker, at least up to release 2.19, is reported
+*** to be unable to reliably create shared libraries on AIX.
+*** Therefore, libtool is disabling shared libraries support.  If you
+*** really care for shared libraries, you may want to install binutils
+*** 2.20 or above, or modify your PATH so that a non-GNU linker is found.
+*** You will then need to restart the configuration process.
 
+_LT_EOF
+      fi
+      ;;
 
+    amigaos*)
+      case $host_cpu in
+      powerpc)
+            # see comment about AmigaOS4 .so support
+            archive_cmds='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
+            archive_expsym_cmds=''
+        ;;
+      m68k)
+            archive_cmds='$RM $output_objdir/a2ixlibrary.data~$ECHO "#define NAME $libname" > $output_objdir/a2ixlibrary.data~$ECHO "#define LIBRARY_ID 1" >> $output_objdir/a2ixlibrary.data~$ECHO "#define VERSION $major" >> $output_objdir/a2ixlibrary.data~$ECHO "#define REVISION $revision" >> $output_objdir/a2ixlibrary.data~$AR $AR_FLAGS $lib $libobjs~$RANLIB $lib~(cd $output_objdir && a2ixlibrary -32)'
+            hardcode_libdir_flag_spec='-L$libdir'
+            hardcode_minus_L=yes
+        ;;
+      esac
+      ;;
 
+    beos*)
+      if $LD --help 2>&1 | $GREP ': supported targets:.* elf' > /dev/null; then
+	allow_undefined_flag=unsupported
+	# Joseph Beckenbach <jrb3@best.com> says some releases of gcc
+	# support --undefined.  This deserves some investigation.  FIXME
+	archive_cmds='$CC -nostart $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
+      else
+	ld_shlibs=no
+      fi
+      ;;
 
+    cygwin* | mingw* | pw32* | cegcc*)
+      # _LT_TAGVAR(hardcode_libdir_flag_spec, ) is actually meaningless,
+      # as there is no search path for DLLs.
+      hardcode_libdir_flag_spec='-L$libdir'
+      export_dynamic_flag_spec='${wl}--export-all-symbols'
+      allow_undefined_flag=unsupported
+      always_export_symbols=no
+      enable_shared_with_static_runtimes=yes
+      export_symbols_cmds='$NM $libobjs $convenience | $global_symbol_pipe | $SED -e '\''/^[BCDGRS][ ]/s/.*[ ]\([^ ]*\)/\1 DATA/;s/^.*[ ]__nm__\([^ ]*\)[ ][^ ]*/\1 DATA/;/^I[ ]/d;/^[AITW][ ]/s/.* //'\'' | sort | uniq > $export_symbols'
+      exclude_expsyms='[_]+GLOBAL_OFFSET_TABLE_|[_]+GLOBAL__[FID]_.*|[_]+head_[A-Za-z0-9_]+_dll|[A-Za-z0-9_]+_dll_iname'
 
+      if $LD --help 2>&1 | $GREP 'auto-import' > /dev/null; then
+        archive_cmds='$CC -shared $libobjs $deplibs $compiler_flags -o $output_objdir/$soname ${wl}--enable-auto-image-base -Xlinker --out-implib -Xlinker $lib'
+	# If the export-symbols file already is a .def file (1st line
+	# is EXPORTS), use it as is; otherwise, prepend...
+	archive_expsym_cmds='if test "x`$SED 1q $export_symbols`" = xEXPORTS; then
+	  cp $export_symbols $output_objdir/$soname.def;
+	else
+	  echo EXPORTS > $output_objdir/$soname.def;
+	  cat $export_symbols >> $output_objdir/$soname.def;
+	fi~
+	$CC -shared $output_objdir/$soname.def $libobjs $deplibs $compiler_flags -o $output_objdir/$soname ${wl}--enable-auto-image-base -Xlinker --out-implib -Xlinker $lib'
+      else
+	ld_shlibs=no
+      fi
+      ;;
 
+    haiku*)
+      archive_cmds='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
+      link_all_deplibs=yes
+      ;;
 
+    interix[3-9]*)
+      hardcode_direct=no
+      hardcode_shlibpath_var=no
+      hardcode_libdir_flag_spec='${wl}-rpath,$libdir'
+      export_dynamic_flag_spec='${wl}-E'
+      # Hack: On Interix 3.x, we cannot compile PIC because of a broken gcc.
+      # Instead, shared libraries are loaded at an image base (0x10000000 by
+      # default) and relocated if they conflict, which is a slow very memory
+      # consuming and fragmenting process.  To avoid this, we pick a random,
+      # 256 KiB-aligned image base between 0x50000000 and 0x6FFC0000 at link
+      # time.  Moving up from 0x10000000 also allows more sbrk(2) space.
+      archive_cmds='$CC -shared $pic_flag $libobjs $deplibs $compiler_flags ${wl}-h,$soname ${wl}--image-base,`expr ${RANDOM-$$} % 4096 / 2 \* 262144 + 1342177280` -o $lib'
+      archive_expsym_cmds='sed "s,^,_," $export_symbols >$output_objdir/$soname.expsym~$CC -shared $pic_flag $libobjs $deplibs $compiler_flags ${wl}-h,$soname ${wl}--retain-symbols-file,$output_objdir/$soname.expsym ${wl}--image-base,`expr ${RANDOM-$$} % 4096 / 2 \* 262144 + 1342177280` -o $lib'
+      ;;
 
+    gnu* | linux* | tpf* | k*bsd*-gnu | kopensolaris*-gnu)
+      tmp_diet=no
+      if test "$host_os" = linux-dietlibc; then
+	case $cc_basename in
+	  diet\ *) tmp_diet=yes;;	# linux-dietlibc with static linking (!diet-dyn)
+	esac
+      fi
+      if $LD --help 2>&1 | $EGREP ': supported targets:.* elf' > /dev/null \
+	 && test "$tmp_diet" = no
+      then
+	tmp_addflag=' $pic_flag'
+	tmp_sharedflag='-shared'
+	case $cc_basename,$host_cpu in
+        pgcc*)				# Portland Group C compiler
+	  whole_archive_flag_spec='${wl}--whole-archive`for conv in $convenience\"\"; do test  -n \"$conv\" && new_convenience=\"$new_convenience,$conv\"; done; func_echo_all \"$new_convenience\"` ${wl}--no-whole-archive'
+	  tmp_addflag=' $pic_flag'
+	  ;;
+	pgf77* | pgf90* | pgf95* | pgfortran*)
+					# Portland Group f77 and f90 compilers
+	  whole_archive_flag_spec='${wl}--whole-archive`for conv in $convenience\"\"; do test  -n \"$conv\" && new_convenience=\"$new_convenience,$conv\"; done; func_echo_all \"$new_convenience\"` ${wl}--no-whole-archive'
+	  tmp_addflag=' $pic_flag -Mnomain' ;;
+	ecc*,ia64* | icc*,ia64*)	# Intel C compiler on ia64
+	  tmp_addflag=' -i_dynamic' ;;
+	efc*,ia64* | ifort*,ia64*)	# Intel Fortran compiler on ia64
+	  tmp_addflag=' -i_dynamic -nofor_main' ;;
+	ifc* | ifort*)			# Intel Fortran compiler
+	  tmp_addflag=' -nofor_main' ;;
+	lf95*)				# Lahey Fortran 8.1
+	  whole_archive_flag_spec=
+	  tmp_sharedflag='--shared' ;;
+	xl[cC]* | bgxl[cC]* | mpixl[cC]*) # IBM XL C 8.0 on PPC (deal with xlf below)
+	  tmp_sharedflag='-qmkshrobj'
+	  tmp_addflag= ;;
+	nvcc*)	# Cuda Compiler Driver 2.2
+	  whole_archive_flag_spec='${wl}--whole-archive`for conv in $convenience\"\"; do test  -n \"$conv\" && new_convenience=\"$new_convenience,$conv\"; done; func_echo_all \"$new_convenience\"` ${wl}--no-whole-archive'
+	  compiler_needs_object=yes
+	  ;;
+	esac
+	case `$CC -V 2>&1 | sed 5q` in
+	*Sun\ C*)			# Sun C 5.9
+	  whole_archive_flag_spec='${wl}--whole-archive`new_convenience=; for conv in $convenience\"\"; do test -z \"$conv\" || new_convenience=\"$new_convenience,$conv\"; done; func_echo_all \"$new_convenience\"` ${wl}--no-whole-archive'
+	  compiler_needs_object=yes
+	  tmp_sharedflag='-G' ;;
+	*Sun\ F*)			# Sun Fortran 8.3
+	  tmp_sharedflag='-G' ;;
+	esac
+	archive_cmds='$CC '"$tmp_sharedflag""$tmp_addflag"' $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
 
+        if test "x$supports_anon_versioning" = xyes; then
+          archive_expsym_cmds='echo "{ global:" > $output_objdir/$libname.ver~
+	    cat $export_symbols | sed -e "s/\(.*\)/\1;/" >> $output_objdir/$libname.ver~
+	    echo "local: *; };" >> $output_objdir/$libname.ver~
+	    $CC '"$tmp_sharedflag""$tmp_addflag"' $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname ${wl}-version-script ${wl}$output_objdir/$libname.ver -o $lib'
+        fi
 
+	case $cc_basename in
+	xlf* | bgf* | bgxlf* | mpixlf*)
+	  # IBM XL Fortran 10.1 on PPC cannot create shared libs itself
+	  whole_archive_flag_spec='--whole-archive$convenience --no-whole-archive'
+	  hardcode_libdir_flag_spec='${wl}-rpath ${wl}$libdir'
+	  archive_cmds='$LD -shared $libobjs $deplibs $linker_flags -soname $soname -o $lib'
+	  if test "x$supports_anon_versioning" = xyes; then
+	    archive_expsym_cmds='echo "{ global:" > $output_objdir/$libname.ver~
+	      cat $export_symbols | sed -e "s/\(.*\)/\1;/" >> $output_objdir/$libname.ver~
+	      echo "local: *; };" >> $output_objdir/$libname.ver~
+	      $LD -shared $libobjs $deplibs $linker_flags -soname $soname -version-script $output_objdir/$libname.ver -o $lib'
+	  fi
+	  ;;
+	esac
+      else
+        ld_shlibs=no
+      fi
+      ;;
 
+    netbsd*)
+      if echo __ELF__ | $CC -E - | $GREP __ELF__ >/dev/null; then
+	archive_cmds='$LD -Bshareable $libobjs $deplibs $linker_flags -o $lib'
+	wlarc=
+      else
+	archive_cmds='$CC -shared $pic_flag $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
+	archive_expsym_cmds='$CC -shared $pic_flag $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
+      fi
+      ;;
 
+    solaris*)
+      if $LD -v 2>&1 | $GREP 'BFD 2\.8' > /dev/null; then
+	ld_shlibs=no
+	cat <<_LT_EOF 1>&2
 
+*** Warning: The releases 2.8.* of the GNU linker cannot reliably
+*** create shared libraries on Solaris systems.  Therefore, libtool
+*** is disabling shared libraries support.  We urge you to upgrade GNU
+*** binutils to release 2.9.1 or newer.  Another option is to modify
+*** your PATH or compiler configuration so that the native linker is
+*** used, and then restart.
 
+_LT_EOF
+      elif $LD --help 2>&1 | $GREP ': supported targets:.* elf' > /dev/null; then
+	archive_cmds='$CC -shared $pic_flag $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
+	archive_expsym_cmds='$CC -shared $pic_flag $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
+      else
+	ld_shlibs=no
+      fi
+      ;;
 
+    sysv5* | sco3.2v5* | sco5v6* | unixware* | OpenUNIX*)
+      case `$LD -v 2>&1` in
+        *\ [01].* | *\ 2.[0-9].* | *\ 2.1[0-5].*)
+	ld_shlibs=no
+	cat <<_LT_EOF 1>&2
 
+*** Warning: Releases of the GNU linker prior to 2.16.91.0.3 can not
+*** reliably create shared libraries on SCO systems.  Therefore, libtool
+*** is disabling shared libraries support.  We urge you to upgrade GNU
+*** binutils to release 2.16.91.0.3 or newer.  Another option is to modify
+*** your PATH or compiler configuration so that the native linker is
+*** used, and then restart.
 
+_LT_EOF
+	;;
+	*)
+	  # For security reasons, it is highly recommended that you always
+	  # use absolute paths for naming shared libraries, and exclude the
+	  # DT_RUNPATH tag from executables and libraries.  But doing so
+	  # requires that you compile everything twice, which is a pain.
+	  if $LD --help 2>&1 | $GREP ': supported targets:.* elf' > /dev/null; then
+	    hardcode_libdir_flag_spec='${wl}-rpath ${wl}$libdir'
+	    archive_cmds='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
+	    archive_expsym_cmds='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
+	  else
+	    ld_shlibs=no
+	  fi
+	;;
+      esac
+      ;;
 
+    sunos4*)
+      archive_cmds='$LD -assert pure-text -Bshareable -o $lib $libobjs $deplibs $linker_flags'
+      wlarc=
+      hardcode_direct=yes
+      hardcode_shlibpath_var=no
+      ;;
 
+    *)
+      if $LD --help 2>&1 | $GREP ': supported targets:.* elf' > /dev/null; then
+	archive_cmds='$CC -shared $pic_flag $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
+	archive_expsym_cmds='$CC -shared $pic_flag $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
+      else
+	ld_shlibs=no
+      fi
+      ;;
+    esac
 
+    if test "$ld_shlibs" = no; then
+      runpath_var=
+      hardcode_libdir_flag_spec=
+      export_dynamic_flag_spec=
+      whole_archive_flag_spec=
+    fi
+  else
+    # PORTME fill in a description of your system's linker (not GNU ld)
+    case $host_os in
+    aix3*)
+      allow_undefined_flag=unsupported
+      always_export_symbols=yes
+      archive_expsym_cmds='$LD -o $output_objdir/$soname $libobjs $deplibs $linker_flags -bE:$export_symbols -T512 -H512 -bM:SRE~$AR $AR_FLAGS $lib $output_objdir/$soname'
+      # Note: this linker hardcodes the directories in LIBPATH if there
+      # are no directories specified by -L.
+      hardcode_minus_L=yes
+      if test "$GCC" = yes && test -z "$lt_prog_compiler_static"; then
+	# Neither direct hardcoding nor static linking is supported with a
+	# broken collect2.
+	hardcode_direct=unsupported
+      fi
+      ;;
 
+    aix[4-9]*)
+      if test "$host_cpu" = ia64; then
+	# On IA64, the linker does run time linking by default, so we don't
+	# have to do anything special.
+	aix_use_runtimelinking=no
+	exp_sym_flag='-Bexport'
+	no_entry_flag=""
+      else
+	# If we're using GNU nm, then we don't want the "-C" option.
+	# -C means demangle to AIX nm, but means don't demangle with GNU nm
+	# Also, AIX nm treats weak defined symbols like other global
+	# defined symbols, whereas GNU nm marks them as "W".
+	if $NM -V 2>&1 | $GREP 'GNU' > /dev/null; then
+	  export_symbols_cmds='$NM -Bpg $libobjs $convenience | awk '\''{ if (((\$ 2 == "T") || (\$ 2 == "D") || (\$ 2 == "B") || (\$ 2 == "W")) && (substr(\$ 3,1,1) != ".")) { print \$ 3 } }'\'' | sort -u > $export_symbols'
+	else
+	  export_symbols_cmds='$NM -BCpg $libobjs $convenience | awk '\''{ if (((\$ 2 == "T") || (\$ 2 == "D") || (\$ 2 == "B")) && (substr(\$ 3,1,1) != ".")) { print \$ 3 } }'\'' | sort -u > $export_symbols'
+	fi
+	aix_use_runtimelinking=no
 
+	# Test if we are trying to use run time linking or normal
+	# AIX style linking. If -brtl is somewhere in LDFLAGS, we
+	# need to do runtime linking.
+	case $host_os in aix4.[23]|aix4.[23].*|aix[5-9]*)
+	  for ld_flag in $LDFLAGS; do
+	  if (test $ld_flag = "-brtl" || test $ld_flag = "-Wl,-brtl"); then
+	    aix_use_runtimelinking=yes
+	    break
+	  fi
+	  done
+	  ;;
+	esac
 
+	exp_sym_flag='-bexport'
+	no_entry_flag='-bnoentry'
+      fi
 
+      # When large executables or shared objects are built, AIX ld can
+      # have problems creating the table of contents.  If linking a library
+      # or program results in "error TOC overflow" add -mminimal-toc to
+      # CXXFLAGS/CFLAGS for g++/gcc.  In the cases where that is not
+      # enough to fix the problem, add -Wl,-bbigtoc to LDFLAGS.
 
+      archive_cmds=''
+      hardcode_direct=yes
+      hardcode_direct_absolute=yes
+      hardcode_libdir_separator=':'
+      link_all_deplibs=yes
+      file_list_spec='${wl}-f,'
 
+      if test "$GCC" = yes; then
+	case $host_os in aix4.[012]|aix4.[012].*)
+	# We only want to do this on AIX 4.2 and lower, the check
+	# below for broken collect2 doesn't work under 4.3+
+	  collect2name=`${CC} -print-prog-name=collect2`
+	  if test -f "$collect2name" &&
+	   strings "$collect2name" | $GREP resolve_lib_name >/dev/null
+	  then
+	  # We have reworked collect2
+	  :
+	  else
+	  # We have old collect2
+	  hardcode_direct=unsupported
+	  # It fails to find uninstalled libraries when the uninstalled
+	  # path is not listed in the libpath.  Setting hardcode_minus_L
+	  # to unsupported forces relinking
+	  hardcode_minus_L=yes
+	  hardcode_libdir_flag_spec='-L$libdir'
+	  hardcode_libdir_separator=
+	  fi
+	  ;;
+	esac
+	shared_flag='-shared'
+	if test "$aix_use_runtimelinking" = yes; then
+	  shared_flag="$shared_flag "'${wl}-G'
+	fi
+      else
+	# not using gcc
+	if test "$host_cpu" = ia64; then
+	# VisualAge C++, Version 5.5 for AIX 5L for IA-64, Beta 3 Release
+	# chokes on -Wl,-G. The following line is correct:
+	  shared_flag='-G'
+	else
+	  if test "$aix_use_runtimelinking" = yes; then
+	    shared_flag='${wl}-G'
+	  else
+	    shared_flag='${wl}-bM:SRE'
+	  fi
+	fi
+      fi
 
+      export_dynamic_flag_spec='${wl}-bexpall'
+      # It seems that -bexpall does not export symbols beginning with
+      # underscore (_), so it is better to generate a list of symbols to export.
+      always_export_symbols=yes
+      if test "$aix_use_runtimelinking" = yes; then
+	# Warning - without using the other runtime loading flags (-brtl),
+	# -berok will link without error, but may produce a broken library.
+	allow_undefined_flag='-berok'
+        # Determine the default libpath from the value encoded in an
+        # empty executable.
+        if test "${lt_cv_aix_libpath+set}" = set; then
+  aix_libpath=$lt_cv_aix_libpath
+else
+  if ${lt_cv_aix_libpath_+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
 
+int
+main ()
+{
 
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_link "$LINENO"; then :
 
+  lt_aix_libpath_sed='
+      /Import File Strings/,/^$/ {
+	  /^0/ {
+	      s/^0  *\([^ ]*\) *$/\1/
+	      p
+	  }
+      }'
+  lt_cv_aix_libpath_=`dump -H conftest$ac_exeext 2>/dev/null | $SED -n -e "$lt_aix_libpath_sed"`
+  # Check for a 64-bit object if we didn't find anything.
+  if test -z "$lt_cv_aix_libpath_"; then
+    lt_cv_aix_libpath_=`dump -HX64 conftest$ac_exeext 2>/dev/null | $SED -n -e "$lt_aix_libpath_sed"`
+  fi
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+  if test -z "$lt_cv_aix_libpath_"; then
+    lt_cv_aix_libpath_="/usr/lib:/lib"
+  fi
 
+fi
 
+  aix_libpath=$lt_cv_aix_libpath_
+fi
 
+        hardcode_libdir_flag_spec='${wl}-blibpath:$libdir:'"$aix_libpath"
+        archive_expsym_cmds='$CC -o $output_objdir/$soname $libobjs $deplibs '"\${wl}$no_entry_flag"' $compiler_flags `if test "x${allow_undefined_flag}" != "x"; then func_echo_all "${wl}${allow_undefined_flag}"; else :; fi` '"\${wl}$exp_sym_flag:\$export_symbols $shared_flag"
+      else
+	if test "$host_cpu" = ia64; then
+	  hardcode_libdir_flag_spec='${wl}-R $libdir:/usr/lib:/lib'
+	  allow_undefined_flag="-z nodefs"
+	  archive_expsym_cmds="\$CC $shared_flag"' -o $output_objdir/$soname $libobjs $deplibs '"\${wl}$no_entry_flag"' $compiler_flags ${wl}${allow_undefined_flag} '"\${wl}$exp_sym_flag:\$export_symbols"
+	else
+	 # Determine the default libpath from the value encoded in an
+	 # empty executable.
+	 if test "${lt_cv_aix_libpath+set}" = set; then
+  aix_libpath=$lt_cv_aix_libpath
+else
+  if ${lt_cv_aix_libpath_+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
 
+int
+main ()
+{
 
-  { $as_echo "$as_me:$LINENO: checking dynamic linker characteristics" >&5
-$as_echo_n "checking dynamic linker characteristics... " >&6; }
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_link "$LINENO"; then :
 
-if test "$GCC" = yes; then
-  case $host_os in
-    darwin*) lt_awk_arg="/^libraries:/,/LR/" ;;
-    *) lt_awk_arg="/^libraries:/" ;;
-  esac
-  lt_search_path_spec=`$CC -print-search-dirs | awk $lt_awk_arg | $SED -e "s/^libraries://" -e "s,=/,/,g"`
-  if $ECHO "$lt_search_path_spec" | $GREP ';' >/dev/null ; then
-    # if the path contains ";" then we assume it to be the separator
-    # otherwise default to the standard path separator (i.e. ":") - it is
-    # assumed that no part of a normal pathname contains ";" but that should
-    # okay in the real world where ";" in dirpaths is itself problematic.
-    lt_search_path_spec=`$ECHO "$lt_search_path_spec" | $SED -e 's/;/ /g'`
-  else
-    lt_search_path_spec=`$ECHO "$lt_search_path_spec" | $SED  -e "s/$PATH_SEPARATOR/ /g"`
+  lt_aix_libpath_sed='
+      /Import File Strings/,/^$/ {
+	  /^0/ {
+	      s/^0  *\([^ ]*\) *$/\1/
+	      p
+	  }
+      }'
+  lt_cv_aix_libpath_=`dump -H conftest$ac_exeext 2>/dev/null | $SED -n -e "$lt_aix_libpath_sed"`
+  # Check for a 64-bit object if we didn't find anything.
+  if test -z "$lt_cv_aix_libpath_"; then
+    lt_cv_aix_libpath_=`dump -HX64 conftest$ac_exeext 2>/dev/null | $SED -n -e "$lt_aix_libpath_sed"`
   fi
-  # Ok, now we have the path, separated by spaces, we can step through it
-  # and add multilib dir if necessary.
-  lt_tmp_lt_search_path_spec=
-  lt_multi_os_dir=`$CC $CPPFLAGS $CFLAGS $LDFLAGS -print-multi-os-directory 2>/dev/null`
-  for lt_sys_path in $lt_search_path_spec; do
-    if test -d "$lt_sys_path/$lt_multi_os_dir"; then
-      lt_tmp_lt_search_path_spec="$lt_tmp_lt_search_path_spec $lt_sys_path/$lt_multi_os_dir"
-    else
-      test -d "$lt_sys_path" && \
-	lt_tmp_lt_search_path_spec="$lt_tmp_lt_search_path_spec $lt_sys_path"
-    fi
-  done
-  lt_search_path_spec=`$ECHO $lt_tmp_lt_search_path_spec | awk '
-BEGIN {RS=" "; FS="/|\n";} {
-  lt_foo="";
-  lt_count=0;
-  for (lt_i = NF; lt_i > 0; lt_i--) {
-    if ($lt_i != "" && $lt_i != ".") {
-      if ($lt_i == "..") {
-        lt_count++;
-      } else {
-        if (lt_count == 0) {
-          lt_foo="/" $lt_i lt_foo;
-        } else {
-          lt_count--;
-        }
-      }
-    }
-  }
-  if (lt_foo != "") { lt_freq[lt_foo]++; }
-  if (lt_freq[lt_foo] == 1) { print lt_foo; }
-}'`
-  sys_lib_search_path_spec=`$ECHO $lt_search_path_spec`
-else
-  sys_lib_search_path_spec="/lib /usr/lib /usr/local/lib"
 fi
-library_names_spec=
-libname_spec='lib$name'
-soname_spec=
-shrext_cmds=".so"
-postinstall_cmds=
-postuninstall_cmds=
-finish_cmds=
-finish_eval=
-shlibpath_var=
-shlibpath_overrides_runpath=unknown
-version_type=none
-dynamic_linker="$host_os ld.so"
-sys_lib_dlsearch_path_spec="/lib /usr/lib"
-need_lib_prefix=unknown
-hardcode_into_libs=no
-
-# when you set need_version to no, make sure it does not cause -set_version
-# flags to be left without arguments
-need_version=unknown
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+  if test -z "$lt_cv_aix_libpath_"; then
+    lt_cv_aix_libpath_="/usr/lib:/lib"
+  fi
 
-case $host_os in
-aix3*)
-  version_type=linux
-  library_names_spec='${libname}${release}${shared_ext}$versuffix $libname.a'
-  shlibpath_var=LIBPATH
+fi
 
-  # AIX 3 has no versioning support, so we append a major version to the name.
-  soname_spec='${libname}${release}${shared_ext}$major'
-  ;;
+  aix_libpath=$lt_cv_aix_libpath_
+fi
 
-aix[4-9]*)
-  version_type=linux
-  need_lib_prefix=no
-  need_version=no
-  hardcode_into_libs=yes
-  if test "$host_cpu" = ia64; then
-    # AIX 5 supports IA64
-    library_names_spec='${libname}${release}${shared_ext}$major ${libname}${release}${shared_ext}$versuffix $libname${shared_ext}'
-    shlibpath_var=LD_LIBRARY_PATH
-  else
-    # With GCC up to 2.95.x, collect2 would create an import file
-    # for dependence libraries.  The import file would start with
-    # the line `#! .'.  This would cause the generated library to
-    # depend on `.', always an invalid library.  This was fixed in
-    # development snapshots of GCC prior to 3.0.
-    case $host_os in
-      aix4 | aix4.[01] | aix4.[01].*)
-      if { echo '#if __GNUC__ > 2 || (__GNUC__ == 2 && __GNUC_MINOR__ >= 97)'
-	   echo ' yes '
-	   echo '#endif'; } | ${CC} -E - | $GREP yes > /dev/null; then
-	:
-      else
-	can_build_shared=no
+	 hardcode_libdir_flag_spec='${wl}-blibpath:$libdir:'"$aix_libpath"
+	  # Warning - without using the other run time loading flags,
+	  # -berok will link without error, but may produce a broken library.
+	  no_undefined_flag=' ${wl}-bernotok'
+	  allow_undefined_flag=' ${wl}-berok'
+	  if test "$with_gnu_ld" = yes; then
+	    # We only use this code for GNU lds that support --whole-archive.
+	    whole_archive_flag_spec='${wl}--whole-archive$convenience ${wl}--no-whole-archive'
+	  else
+	    # Exported symbols can be pulled into shared objects from archives
+	    whole_archive_flag_spec='$convenience'
+	  fi
+	  archive_cmds_need_lc=yes
+	  # This is similar to how AIX traditionally builds its shared libraries.
+	  archive_expsym_cmds="\$CC $shared_flag"' -o $output_objdir/$soname $libobjs $deplibs ${wl}-bnoentry $compiler_flags ${wl}-bE:$export_symbols${allow_undefined_flag}~$AR $AR_FLAGS $output_objdir/$libname$release.a $output_objdir/$soname'
+	fi
       fi
       ;;
-    esac
-    # AIX (on Power*) has no versioning support, so currently we can not hardcode correct
-    # soname into executable. Probably we can add versioning support to
-    # collect2, so additional links can be useful in future.
-    if test "$aix_use_runtimelinking" = yes; then
-      # If using run time linking (on AIX 4.2 or later) use lib<name>.so
-      # instead of lib<name>.a to let people know that these are not
-      # typical AIX shared libraries.
-      library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
-    else
-      # We preserve .a as extension for shared libraries through AIX4.2
-      # and later when we are not doing run time linking.
-      library_names_spec='${libname}${release}.a $libname.a'
-      soname_spec='${libname}${release}${shared_ext}$major'
-    fi
-    shlibpath_var=LIBPATH
-  fi
-  ;;
-
-amigaos*)
-  case $host_cpu in
-  powerpc)
-    # Since July 2007 AmigaOS4 officially supports .so libraries.
-    # When compiling the executable, add -use-dynld -Lsobjs: to the compileline.
-    library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
-    ;;
-  m68k)
-    library_names_spec='$libname.ixlibrary $libname.a'
-    # Create ${libname}_ixlibrary.a entries in /sys/libs.
-    finish_eval='for lib in `ls $libdir/*.ixlibrary 2>/dev/null`; do libname=`$ECHO "X$lib" | $Xsed -e '\''s%^.*/\([^/]*\)\.ixlibrary$%\1%'\''`; test $RM /sys/libs/${libname}_ixlibrary.a; $show "cd /sys/libs && $LN_S $lib ${libname}_ixlibrary.a"; cd /sys/libs && $LN_S $lib ${libname}_ixlibrary.a || exit 1; done'
-    ;;
-  esac
-  ;;
-
-beos*)
-  library_names_spec='${libname}${shared_ext}'
-  dynamic_linker="$host_os ld.so"
-  shlibpath_var=LIBRARY_PATH
-  ;;
-
-bsdi[45]*)
-  version_type=linux
-  need_version=no
-  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
-  soname_spec='${libname}${release}${shared_ext}$major'
-  finish_cmds='PATH="\$PATH:/sbin" ldconfig $libdir'
-  shlibpath_var=LD_LIBRARY_PATH
-  sys_lib_search_path_spec="/shlib /usr/lib /usr/X11/lib /usr/contrib/lib /lib /usr/local/lib"
-  sys_lib_dlsearch_path_spec="/shlib /usr/lib /usr/local/lib"
-  # the default ld.so.conf also contains /usr/contrib/lib and
-  # /usr/X11R6/lib (/usr/X11 is a link to /usr/X11R6), but let us allow
-  # libtool to hard-code these into programs
-  ;;
-
-cygwin* | mingw* | pw32* | cegcc*)
-  version_type=windows
-  shrext_cmds=".dll"
-  need_version=no
-  need_lib_prefix=no
-
-  case $GCC,$host_os in
-  yes,cygwin* | yes,mingw* | yes,pw32* | yes,cegcc*)
-    library_names_spec='$libname.dll.a'
-    # DLL is installed to $(libdir)/../bin by postinstall_cmds
-    postinstall_cmds='base_file=`basename \${file}`~
-      dlpath=`$SHELL 2>&1 -c '\''. $dir/'\''\${base_file}'\''i; echo \$dlname'\''`~
-      dldir=$destdir/`dirname \$dlpath`~
-      test -d \$dldir || mkdir -p \$dldir~
-      $install_prog $dir/$dlname \$dldir/$dlname~
-      chmod a+x \$dldir/$dlname~
-      if test -n '\''$stripme'\'' && test -n '\''$striplib'\''; then
-        eval '\''$striplib \$dldir/$dlname'\'' || exit \$?;
-      fi'
-    postuninstall_cmds='dldll=`$SHELL 2>&1 -c '\''. $file; echo \$dlname'\''`~
-      dlpath=$dir/\$dldll~
-       $RM \$dlpath'
-    shlibpath_overrides_runpath=yes
 
-    case $host_os in
-    cygwin*)
-      # Cygwin DLLs use 'cyg' prefix rather than 'lib'
-      soname_spec='`echo ${libname} | sed -e 's/^lib/cyg/'``echo ${release} | $SED -e 's/[.]/-/g'`${versuffix}${shared_ext}'
-      sys_lib_search_path_spec="/usr/lib /lib/w32api /lib /usr/local/lib"
+    amigaos*)
+      case $host_cpu in
+      powerpc)
+            # see comment about AmigaOS4 .so support
+            archive_cmds='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
+            archive_expsym_cmds=''
+        ;;
+      m68k)
+            archive_cmds='$RM $output_objdir/a2ixlibrary.data~$ECHO "#define NAME $libname" > $output_objdir/a2ixlibrary.data~$ECHO "#define LIBRARY_ID 1" >> $output_objdir/a2ixlibrary.data~$ECHO "#define VERSION $major" >> $output_objdir/a2ixlibrary.data~$ECHO "#define REVISION $revision" >> $output_objdir/a2ixlibrary.data~$AR $AR_FLAGS $lib $libobjs~$RANLIB $lib~(cd $output_objdir && a2ixlibrary -32)'
+            hardcode_libdir_flag_spec='-L$libdir'
+            hardcode_minus_L=yes
+        ;;
+      esac
       ;;
-    mingw* | cegcc*)
-      # MinGW DLLs use traditional 'lib' prefix
-      soname_spec='${libname}`echo ${release} | $SED -e 's/[.]/-/g'`${versuffix}${shared_ext}'
-      sys_lib_search_path_spec=`$CC -print-search-dirs | $GREP "^libraries:" | $SED -e "s/^libraries://" -e "s,=/,/,g"`
-      if $ECHO "$sys_lib_search_path_spec" | $GREP ';[c-zC-Z]:/' >/dev/null; then
-        # It is most probably a Windows format PATH printed by
-        # mingw gcc, but we are running on Cygwin. Gcc prints its search
-        # path with ; separators, and with drive letters. We can handle the
-        # drive letters (cygwin fileutils understands them), so leave them,
-        # especially as we might pass files found there to a mingw objdump,
-        # which wouldn't understand a cygwinified path. Ahh.
-        sys_lib_search_path_spec=`$ECHO "$sys_lib_search_path_spec" | $SED -e 's/;/ /g'`
-      else
-        sys_lib_search_path_spec=`$ECHO "$sys_lib_search_path_spec" | $SED  -e "s/$PATH_SEPARATOR/ /g"`
-      fi
+
+    bsdi[45]*)
+      export_dynamic_flag_spec=-rdynamic
       ;;
-    pw32*)
-      # pw32 DLLs use 'pw' prefix rather than 'lib'
-      library_names_spec='`echo ${libname} | sed -e 's/^lib/pw/'``echo ${release} | $SED -e 's/[.]/-/g'`${versuffix}${shared_ext}'
+
+    cygwin* | mingw* | pw32* | cegcc*)
+      # When not using gcc, we currently assume that we are using
+      # Microsoft Visual C++.
+      # hardcode_libdir_flag_spec is actually meaningless, as there is
+      # no search path for DLLs.
+      case $cc_basename in
+      cl*)
+	# Native MSVC
+	hardcode_libdir_flag_spec=' '
+	allow_undefined_flag=unsupported
+	always_export_symbols=yes
+	file_list_spec='@'
+	# Tell ltmain to make .lib files, not .a files.
+	libext=lib
+	# Tell ltmain to make .dll files, not .so files.
+	shrext_cmds=".dll"
+	# FIXME: Setting linknames here is a bad hack.
+	archive_cmds='$CC -o $output_objdir/$soname $libobjs $compiler_flags $deplibs -Wl,-dll~linknames='
+	archive_expsym_cmds='if test "x`$SED 1q $export_symbols`" = xEXPORTS; then
+	    sed -n -e 's/\\\\\\\(.*\\\\\\\)/-link\\\ -EXPORT:\\\\\\\1/' -e '1\\\!p' < $export_symbols > $output_objdir/$soname.exp;
+	  else
+	    sed -e 's/\\\\\\\(.*\\\\\\\)/-link\\\ -EXPORT:\\\\\\\1/' < $export_symbols > $output_objdir/$soname.exp;
+	  fi~
+	  $CC -o $tool_output_objdir$soname $libobjs $compiler_flags $deplibs "@$tool_output_objdir$soname.exp" -Wl,-DLL,-IMPLIB:"$tool_output_objdir$libname.dll.lib"~
+	  linknames='
+	# The linker will not automatically build a static lib if we build a DLL.
+	# _LT_TAGVAR(old_archive_from_new_cmds, )='true'
+	enable_shared_with_static_runtimes=yes
+	exclude_expsyms='_NULL_IMPORT_DESCRIPTOR|_IMPORT_DESCRIPTOR_.*'
+	export_symbols_cmds='$NM $libobjs $convenience | $global_symbol_pipe | $SED -e '\''/^[BCDGRS][ ]/s/.*[ ]\([^ ]*\)/\1,DATA/'\'' | $SED -e '\''/^[AITW][ ]/s/.*[ ]//'\'' | sort | uniq > $export_symbols'
+	# Don't use ranlib
+	old_postinstall_cmds='chmod 644 $oldlib'
+	postlink_cmds='lt_outputfile="@OUTPUT@"~
+	  lt_tool_outputfile="@TOOL_OUTPUT@"~
+	  case $lt_outputfile in
+	    *.exe|*.EXE) ;;
+	    *)
+	      lt_outputfile="$lt_outputfile.exe"
+	      lt_tool_outputfile="$lt_tool_outputfile.exe"
+	      ;;
+	  esac~
+	  if test "$MANIFEST_TOOL" != ":" && test -f "$lt_outputfile.manifest"; then
+	    $MANIFEST_TOOL -manifest "$lt_tool_outputfile.manifest" -outputresource:"$lt_tool_outputfile" || exit 1;
+	    $RM "$lt_outputfile.manifest";
+	  fi'
+	;;
+      *)
+	# Assume MSVC wrapper
+	hardcode_libdir_flag_spec=' '
+	allow_undefined_flag=unsupported
+	# Tell ltmain to make .lib files, not .a files.
+	libext=lib
+	# Tell ltmain to make .dll files, not .so files.
+	shrext_cmds=".dll"
+	# FIXME: Setting linknames here is a bad hack.
+	archive_cmds='$CC -o $lib $libobjs $compiler_flags `func_echo_all "$deplibs" | $SED '\''s/ -lc$//'\''` -link -dll~linknames='
+	# The linker will automatically build a .lib file if we build a DLL.
+	old_archive_from_new_cmds='true'
+	# FIXME: Should let the user specify the lib program.
+	old_archive_cmds='lib -OUT:$oldlib$oldobjs$old_deplibs'
+	enable_shared_with_static_runtimes=yes
+	;;
+      esac
       ;;
-    esac
-    ;;
-
-  *)
-    library_names_spec='${libname}`echo ${release} | $SED -e 's/[.]/-/g'`${versuffix}${shared_ext} $libname.lib'
-    ;;
-  esac
-  dynamic_linker='Win32 ld.exe'
-  # FIXME: first we should search . and the directory the executable is in
-  shlibpath_var=PATH
-  ;;
 
-darwin* | rhapsody*)
-  dynamic_linker="$host_os dyld"
-  version_type=darwin
-  need_lib_prefix=no
-  need_version=no
-  library_names_spec='${libname}${release}${major}$shared_ext ${libname}$shared_ext'
-  soname_spec='${libname}${release}${major}$shared_ext'
-  shlibpath_overrides_runpath=yes
-  shlibpath_var=DYLD_LIBRARY_PATH
-  shrext_cmds='`test .$module = .yes && echo .so || echo .dylib`'
+    darwin* | rhapsody*)
 
-  sys_lib_search_path_spec="$sys_lib_search_path_spec /usr/local/lib"
-  sys_lib_dlsearch_path_spec='/usr/local/lib /lib /usr/lib'
-  ;;
 
-dgux*)
-  version_type=linux
-  need_lib_prefix=no
-  need_version=no
-  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname$shared_ext'
-  soname_spec='${libname}${release}${shared_ext}$major'
-  shlibpath_var=LD_LIBRARY_PATH
-  ;;
+  archive_cmds_need_lc=no
+  hardcode_direct=no
+  hardcode_automatic=yes
+  hardcode_shlibpath_var=unsupported
+  if test "$lt_cv_ld_force_load" = "yes"; then
+    whole_archive_flag_spec='`for conv in $convenience\"\"; do test  -n \"$conv\" && new_convenience=\"$new_convenience ${wl}-force_load,$conv\"; done; func_echo_all \"$new_convenience\"`'
 
-freebsd1*)
-  dynamic_linker=no
-  ;;
+  else
+    whole_archive_flag_spec=''
+  fi
+  link_all_deplibs=yes
+  allow_undefined_flag="$_lt_dar_allow_undefined"
+  case $cc_basename in
+     ifort*) _lt_dar_can_shared=yes ;;
+     *) _lt_dar_can_shared=$GCC ;;
+  esac
+  if test "$_lt_dar_can_shared" = "yes"; then
+    output_verbose_link_cmd=func_echo_all
+    archive_cmds="\$CC -dynamiclib \$allow_undefined_flag -o \$lib \$libobjs \$deplibs \$compiler_flags -install_name \$rpath/\$soname \$verstring $_lt_dar_single_mod${_lt_dsymutil}"
+    module_cmds="\$CC \$allow_undefined_flag -o \$lib -bundle \$libobjs \$deplibs \$compiler_flags${_lt_dsymutil}"
+    archive_expsym_cmds="sed 's,^,_,' < \$export_symbols > \$output_objdir/\${libname}-symbols.expsym~\$CC -dynamiclib \$allow_undefined_flag -o \$lib \$libobjs \$deplibs \$compiler_flags -install_name \$rpath/\$soname \$verstring ${_lt_dar_single_mod}${_lt_dar_export_syms}${_lt_dsymutil}"
+    module_expsym_cmds="sed -e 's,^,_,' < \$export_symbols > \$output_objdir/\${libname}-symbols.expsym~\$CC \$allow_undefined_flag -o \$lib -bundle \$libobjs \$deplibs \$compiler_flags${_lt_dar_export_syms}${_lt_dsymutil}"
 
-freebsd* | dragonfly*)
-  # DragonFly does not have aout.  When/if they implement a new
-  # versioning mechanism, adjust this.
-  if test -x /usr/bin/objformat; then
-    objformat=`/usr/bin/objformat`
   else
-    case $host_os in
-    freebsd[123]*) objformat=aout ;;
-    *) objformat=elf ;;
-    esac
+  ld_shlibs=no
   fi
-  version_type=freebsd-$objformat
-  case $version_type in
-    freebsd-elf*)
-      library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext} $libname${shared_ext}'
-      need_version=no
-      need_lib_prefix=no
-      ;;
-    freebsd-*)
-      library_names_spec='${libname}${release}${shared_ext}$versuffix $libname${shared_ext}$versuffix'
-      need_version=yes
+
       ;;
-  esac
-  shlibpath_var=LD_LIBRARY_PATH
-  case $host_os in
-  freebsd2*)
-    shlibpath_overrides_runpath=yes
-    ;;
-  freebsd3.[01]* | freebsdelf3.[01]*)
-    shlibpath_overrides_runpath=yes
-    hardcode_into_libs=yes
-    ;;
-  freebsd3.[2-9]* | freebsdelf3.[2-9]* | \
-  freebsd4.[0-5] | freebsdelf4.[0-5] | freebsd4.1.1 | freebsdelf4.1.1)
-    shlibpath_overrides_runpath=no
-    hardcode_into_libs=yes
-    ;;
-  *) # from 4.6 on, and DragonFly
-    shlibpath_overrides_runpath=yes
-    hardcode_into_libs=yes
-    ;;
-  esac
-  ;;
 
-gnu*)
-  version_type=linux
-  need_lib_prefix=no
-  need_version=no
-  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}${major} ${libname}${shared_ext}'
-  soname_spec='${libname}${release}${shared_ext}$major'
-  shlibpath_var=LD_LIBRARY_PATH
-  hardcode_into_libs=yes
-  ;;
+    dgux*)
+      archive_cmds='$LD -G -h $soname -o $lib $libobjs $deplibs $linker_flags'
+      hardcode_libdir_flag_spec='-L$libdir'
+      hardcode_shlibpath_var=no
+      ;;
 
-hpux9* | hpux10* | hpux11*)
-  # Give a soname corresponding to the major version so that dld.sl refuses to
-  # link against other versions.
-  version_type=sunos
-  need_lib_prefix=no
-  need_version=no
-  case $host_cpu in
-  ia64*)
-    shrext_cmds='.so'
-    hardcode_into_libs=yes
-    dynamic_linker="$host_os dld.so"
-    shlibpath_var=LD_LIBRARY_PATH
-    shlibpath_overrides_runpath=yes # Unless +noenvvar is specified.
-    library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
-    soname_spec='${libname}${release}${shared_ext}$major'
-    if test "X$HPUX_IA64_MODE" = X32; then
-      sys_lib_search_path_spec="/usr/lib/hpux32 /usr/local/lib/hpux32 /usr/local/lib"
-    else
-      sys_lib_search_path_spec="/usr/lib/hpux64 /usr/local/lib/hpux64"
-    fi
-    sys_lib_dlsearch_path_spec=$sys_lib_search_path_spec
-    ;;
-  hppa*64*)
-    shrext_cmds='.sl'
-    hardcode_into_libs=yes
-    dynamic_linker="$host_os dld.sl"
-    shlibpath_var=LD_LIBRARY_PATH # How should we handle SHLIB_PATH
-    shlibpath_overrides_runpath=yes # Unless +noenvvar is specified.
-    library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
-    soname_spec='${libname}${release}${shared_ext}$major'
-    sys_lib_search_path_spec="/usr/lib/pa20_64 /usr/ccs/lib/pa20_64"
-    sys_lib_dlsearch_path_spec=$sys_lib_search_path_spec
-    ;;
-  *)
-    shrext_cmds='.sl'
-    dynamic_linker="$host_os dld.sl"
-    shlibpath_var=SHLIB_PATH
-    shlibpath_overrides_runpath=no # +s is required to enable SHLIB_PATH
-    library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
-    soname_spec='${libname}${release}${shared_ext}$major'
-    ;;
-  esac
-  # HP-UX runs *really* slowly unless shared libraries are mode 555.
-  postinstall_cmds='chmod 555 $lib'
-  ;;
+    # FreeBSD 2.2.[012] allows us to include c++rt0.o to get C++ constructor
+    # support.  Future versions do this automatically, but an explicit c++rt0.o
+    # does not break anything, and helps significantly (at the cost of a little
+    # extra space).
+    freebsd2.2*)
+      archive_cmds='$LD -Bshareable -o $lib $libobjs $deplibs $linker_flags /usr/lib/c++rt0.o'
+      hardcode_libdir_flag_spec='-R$libdir'
+      hardcode_direct=yes
+      hardcode_shlibpath_var=no
+      ;;
 
-interix[3-9]*)
-  version_type=linux
-  need_lib_prefix=no
-  need_version=no
-  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major ${libname}${shared_ext}'
-  soname_spec='${libname}${release}${shared_ext}$major'
-  dynamic_linker='Interix 3.x ld.so.1 (PE, like ELF)'
-  shlibpath_var=LD_LIBRARY_PATH
-  shlibpath_overrides_runpath=no
-  hardcode_into_libs=yes
-  ;;
+    # Unfortunately, older versions of FreeBSD 2 do not have this feature.
+    freebsd2.*)
+      archive_cmds='$LD -Bshareable -o $lib $libobjs $deplibs $linker_flags'
+      hardcode_direct=yes
+      hardcode_minus_L=yes
+      hardcode_shlibpath_var=no
+      ;;
 
-irix5* | irix6* | nonstopux*)
-  case $host_os in
-    nonstopux*) version_type=nonstopux ;;
-    *)
-	if test "$lt_cv_prog_gnu_ld" = yes; then
-		version_type=linux
-	else
-		version_type=irix
-	fi ;;
-  esac
-  need_lib_prefix=no
-  need_version=no
-  soname_spec='${libname}${release}${shared_ext}$major'
-  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major ${libname}${release}${shared_ext} $libname${shared_ext}'
-  case $host_os in
-  irix5* | nonstopux*)
-    libsuff= shlibsuff=
-    ;;
-  *)
-    case $LD in # libtool.m4 will add one of these switches to LD
-    *-32|*"-32 "|*-melf32bsmip|*"-melf32bsmip ")
-      libsuff= shlibsuff= libmagic=32-bit;;
-    *-n32|*"-n32 "|*-melf32bmipn32|*"-melf32bmipn32 ")
-      libsuff=32 shlibsuff=N32 libmagic=N32;;
-    *-64|*"-64 "|*-melf64bmip|*"-melf64bmip ")
-      libsuff=64 shlibsuff=64 libmagic=64-bit;;
-    *) libsuff= shlibsuff= libmagic=never-match;;
-    esac
-    ;;
-  esac
-  shlibpath_var=LD_LIBRARY${shlibsuff}_PATH
-  shlibpath_overrides_runpath=no
-  sys_lib_search_path_spec="/usr/lib${libsuff} /lib${libsuff} /usr/local/lib${libsuff}"
-  sys_lib_dlsearch_path_spec="/usr/lib${libsuff} /lib${libsuff}"
-  hardcode_into_libs=yes
-  ;;
+    # FreeBSD 3 and greater uses gcc -shared to do shared libraries.
+    freebsd* | dragonfly*)
+      archive_cmds='$CC -shared $pic_flag -o $lib $libobjs $deplibs $compiler_flags'
+      hardcode_libdir_flag_spec='-R$libdir'
+      hardcode_direct=yes
+      hardcode_shlibpath_var=no
+      ;;
 
-# No shared lib support for Linux oldld, aout, or coff.
-linux*oldld* | linux*aout* | linux*coff*)
-  dynamic_linker=no
-  ;;
+    hpux9*)
+      if test "$GCC" = yes; then
+	archive_cmds='$RM $output_objdir/$soname~$CC -shared $pic_flag ${wl}+b ${wl}$install_libdir -o $output_objdir/$soname $libobjs $deplibs $compiler_flags~test $output_objdir/$soname = $lib || mv $output_objdir/$soname $lib'
+      else
+	archive_cmds='$RM $output_objdir/$soname~$LD -b +b $install_libdir -o $output_objdir/$soname $libobjs $deplibs $linker_flags~test $output_objdir/$soname = $lib || mv $output_objdir/$soname $lib'
+      fi
+      hardcode_libdir_flag_spec='${wl}+b ${wl}$libdir'
+      hardcode_libdir_separator=:
+      hardcode_direct=yes
 
-# This must be Linux ELF.
-linux* | k*bsd*-gnu)
-  version_type=linux
-  need_lib_prefix=no
-  need_version=no
-  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
-  soname_spec='${libname}${release}${shared_ext}$major'
-  finish_cmds='PATH="\$PATH:/sbin" ldconfig -n $libdir'
-  shlibpath_var=LD_LIBRARY_PATH
-  shlibpath_overrides_runpath=no
-  # Some binutils ld are patched to set DT_RUNPATH
-  save_LDFLAGS=$LDFLAGS
-  save_libdir=$libdir
-  eval "libdir=/foo; wl=\"$lt_prog_compiler_wl\"; \
-       LDFLAGS=\"\$LDFLAGS $hardcode_libdir_flag_spec\""
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
+      # hardcode_minus_L: Not really in the search PATH,
+      # but as the default location of the library.
+      hardcode_minus_L=yes
+      export_dynamic_flag_spec='${wl}-E'
+      ;;
 
-int
-main ()
-{
+    hpux10*)
+      if test "$GCC" = yes && test "$with_gnu_ld" = no; then
+	archive_cmds='$CC -shared $pic_flag ${wl}+h ${wl}$soname ${wl}+b ${wl}$install_libdir -o $lib $libobjs $deplibs $compiler_flags'
+      else
+	archive_cmds='$LD -b +h $soname +b $install_libdir -o $lib $libobjs $deplibs $linker_flags'
+      fi
+      if test "$with_gnu_ld" = no; then
+	hardcode_libdir_flag_spec='${wl}+b ${wl}$libdir'
+	hardcode_libdir_separator=:
+	hardcode_direct=yes
+	hardcode_direct_absolute=yes
+	export_dynamic_flag_spec='${wl}-E'
+	# hardcode_minus_L: Not really in the search PATH,
+	# but as the default location of the library.
+	hardcode_minus_L=yes
+      fi
+      ;;
 
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest$ac_exeext && {
-	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
-       }; then
-  if  ($OBJDUMP -p conftest$ac_exeext) 2>/dev/null | grep "RUNPATH.*$libdir" >/dev/null; then
-  shlibpath_overrides_runpath=yes
-fi
+    hpux11*)
+      if test "$GCC" = yes && test "$with_gnu_ld" = no; then
+	case $host_cpu in
+	hppa*64*)
+	  archive_cmds='$CC -shared ${wl}+h ${wl}$soname -o $lib $libobjs $deplibs $compiler_flags'
+	  ;;
+	ia64*)
+	  archive_cmds='$CC -shared $pic_flag ${wl}+h ${wl}$soname ${wl}+nodefaultrpath -o $lib $libobjs $deplibs $compiler_flags'
+	  ;;
+	*)
+	  archive_cmds='$CC -shared $pic_flag ${wl}+h ${wl}$soname ${wl}+b ${wl}$install_libdir -o $lib $libobjs $deplibs $compiler_flags'
+	  ;;
+	esac
+      else
+	case $host_cpu in
+	hppa*64*)
+	  archive_cmds='$CC -b ${wl}+h ${wl}$soname -o $lib $libobjs $deplibs $compiler_flags'
+	  ;;
+	ia64*)
+	  archive_cmds='$CC -b ${wl}+h ${wl}$soname ${wl}+nodefaultrpath -o $lib $libobjs $deplibs $compiler_flags'
+	  ;;
+	*)
 
+	  # Older versions of the 11.00 compiler do not understand -b yet
+	  # (HP92453-01 A.11.01.20 doesn't, HP92453-01 B.11.X.35175-35176.GP does)
+	  { $as_echo "$as_me:${as_lineno-$LINENO}: checking if $CC understands -b" >&5
+$as_echo_n "checking if $CC understands -b... " >&6; }
+if ${lt_cv_prog_compiler__b+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
+  lt_cv_prog_compiler__b=no
+   save_LDFLAGS="$LDFLAGS"
+   LDFLAGS="$LDFLAGS -b"
+   echo "$lt_simple_link_test_code" > conftest.$ac_ext
+   if (eval $ac_link 2>conftest.err) && test -s conftest$ac_exeext; then
+     # The linker can only warn and ignore the option if not recognized
+     # So say no if there are warnings
+     if test -s conftest.err; then
+       # Append any errors to the config.log.
+       cat conftest.err 1>&5
+       $ECHO "$_lt_linker_boilerplate" | $SED '/^$/d' > conftest.exp
+       $SED '/^$/d; /^ *+/d' conftest.err >conftest.er2
+       if diff conftest.exp conftest.er2 >/dev/null; then
+         lt_cv_prog_compiler__b=yes
+       fi
+     else
+       lt_cv_prog_compiler__b=yes
+     fi
+   fi
+   $RM -r conftest*
+   LDFLAGS="$save_LDFLAGS"
 
 fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_prog_compiler__b" >&5
+$as_echo "$lt_cv_prog_compiler__b" >&6; }
 
-rm -rf conftest.dSYM
-rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
-      conftest$ac_exeext conftest.$ac_ext
-  LDFLAGS=$save_LDFLAGS
-  libdir=$save_libdir
-
-  # This implies no fast_install, which is unacceptable.
-  # Some rework will be needed to allow for fast_install
-  # before this can be enabled.
-  hardcode_into_libs=yes
+if test x"$lt_cv_prog_compiler__b" = xyes; then
+    archive_cmds='$CC -b ${wl}+h ${wl}$soname ${wl}+b ${wl}$install_libdir -o $lib $libobjs $deplibs $compiler_flags'
+else
+    archive_cmds='$LD -b +h $soname +b $install_libdir -o $lib $libobjs $deplibs $linker_flags'
+fi
 
-  # Add ABI-specific directories to the system library path.
-  sys_lib_dlsearch_path_spec="/lib64 /usr/lib64 /lib /usr/lib"
+	  ;;
+	esac
+      fi
+      if test "$with_gnu_ld" = no; then
+	hardcode_libdir_flag_spec='${wl}+b ${wl}$libdir'
+	hardcode_libdir_separator=:
 
-  # Append ld.so.conf contents to the search path
-  if test -f /etc/ld.so.conf; then
-    lt_ld_extra=`awk '/^include / { system(sprintf("cd /etc; cat %s 2>/dev/null", \$2)); skip = 1; } { if (!skip) print \$0; skip = 0; }' < /etc/ld.so.conf | $SED -e 's/#.*//;/^[	 ]*hwcap[	 ]/d;s/[:,	]/ /g;s/=[^=]*$//;s/=[^= ]* / /g;/^$/d' | tr '\n' ' '`
-    sys_lib_dlsearch_path_spec="$sys_lib_dlsearch_path_spec $lt_ld_extra"
-  fi
+	case $host_cpu in
+	hppa*64*|ia64*)
+	  hardcode_direct=no
+	  hardcode_shlibpath_var=no
+	  ;;
+	*)
+	  hardcode_direct=yes
+	  hardcode_direct_absolute=yes
+	  export_dynamic_flag_spec='${wl}-E'
 
-  # We used to test for /lib/ld.so.1 and disable shared libraries on
-  # powerpc, because MkLinux only supported shared libraries with the
-  # GNU dynamic linker.  Since this was broken with cross compilers,
-  # most powerpc-linux boxes support dynamic linking these days and
-  # people can always --disable-shared, the test was removed, and we
-  # assume the GNU/Linux dynamic linker is in use.
-  dynamic_linker='GNU/Linux ld.so'
-  ;;
+	  # hardcode_minus_L: Not really in the search PATH,
+	  # but as the default location of the library.
+	  hardcode_minus_L=yes
+	  ;;
+	esac
+      fi
+      ;;
 
-netbsd*)
-  version_type=sunos
-  need_lib_prefix=no
-  need_version=no
-  if echo __ELF__ | $CC -E - | $GREP __ELF__ >/dev/null; then
-    library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${shared_ext}$versuffix'
-    finish_cmds='PATH="\$PATH:/sbin" ldconfig -m $libdir'
-    dynamic_linker='NetBSD (a.out) ld.so'
-  else
-    library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major ${libname}${shared_ext}'
-    soname_spec='${libname}${release}${shared_ext}$major'
-    dynamic_linker='NetBSD ld.elf_so'
-  fi
-  shlibpath_var=LD_LIBRARY_PATH
-  shlibpath_overrides_runpath=yes
-  hardcode_into_libs=yes
-  ;;
+    irix5* | irix6* | nonstopux*)
+      if test "$GCC" = yes; then
+	archive_cmds='$CC -shared $pic_flag $libobjs $deplibs $compiler_flags ${wl}-soname ${wl}$soname `test -n "$verstring" && func_echo_all "${wl}-set_version ${wl}$verstring"` ${wl}-update_registry ${wl}${output_objdir}/so_locations -o $lib'
+	# Try to use the -exported_symbol ld option, if it does not
+	# work, assume that -exports_file does not work either and
+	# implicitly export all symbols.
+	# This should be the same for all languages, so no per-tag cache variable.
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether the $host_os linker accepts -exported_symbol" >&5
+$as_echo_n "checking whether the $host_os linker accepts -exported_symbol... " >&6; }
+if ${lt_cv_irix_exported_symbol+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  save_LDFLAGS="$LDFLAGS"
+	   LDFLAGS="$LDFLAGS -shared ${wl}-exported_symbol ${wl}foo ${wl}-update_registry ${wl}/dev/null"
+	   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+int foo (void) { return 0; }
+_ACEOF
+if ac_fn_c_try_link "$LINENO"; then :
+  lt_cv_irix_exported_symbol=yes
+else
+  lt_cv_irix_exported_symbol=no
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+           LDFLAGS="$save_LDFLAGS"
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_irix_exported_symbol" >&5
+$as_echo "$lt_cv_irix_exported_symbol" >&6; }
+	if test "$lt_cv_irix_exported_symbol" = yes; then
+          archive_expsym_cmds='$CC -shared $pic_flag $libobjs $deplibs $compiler_flags ${wl}-soname ${wl}$soname `test -n "$verstring" && func_echo_all "${wl}-set_version ${wl}$verstring"` ${wl}-update_registry ${wl}${output_objdir}/so_locations ${wl}-exports_file ${wl}$export_symbols -o $lib'
+	fi
+      else
+	archive_cmds='$CC -shared $libobjs $deplibs $compiler_flags -soname $soname `test -n "$verstring" && func_echo_all "-set_version $verstring"` -update_registry ${output_objdir}/so_locations -o $lib'
+	archive_expsym_cmds='$CC -shared $libobjs $deplibs $compiler_flags -soname $soname `test -n "$verstring" && func_echo_all "-set_version $verstring"` -update_registry ${output_objdir}/so_locations -exports_file $export_symbols -o $lib'
+      fi
+      archive_cmds_need_lc='no'
+      hardcode_libdir_flag_spec='${wl}-rpath ${wl}$libdir'
+      hardcode_libdir_separator=:
+      inherit_rpath=yes
+      link_all_deplibs=yes
+      ;;
 
-newsos6)
-  version_type=linux
-  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
-  shlibpath_var=LD_LIBRARY_PATH
-  shlibpath_overrides_runpath=yes
-  ;;
+    netbsd*)
+      if echo __ELF__ | $CC -E - | $GREP __ELF__ >/dev/null; then
+	archive_cmds='$LD -Bshareable -o $lib $libobjs $deplibs $linker_flags'  # a.out
+      else
+	archive_cmds='$LD -shared -o $lib $libobjs $deplibs $linker_flags'      # ELF
+      fi
+      hardcode_libdir_flag_spec='-R$libdir'
+      hardcode_direct=yes
+      hardcode_shlibpath_var=no
+      ;;
 
-*nto* | *qnx*)
-  version_type=qnx
-  need_lib_prefix=no
-  need_version=no
-  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
-  soname_spec='${libname}${release}${shared_ext}$major'
-  shlibpath_var=LD_LIBRARY_PATH
-  shlibpath_overrides_runpath=no
-  hardcode_into_libs=yes
-  dynamic_linker='ldqnx.so'
-  ;;
+    newsos6)
+      archive_cmds='$LD -G -h $soname -o $lib $libobjs $deplibs $linker_flags'
+      hardcode_direct=yes
+      hardcode_libdir_flag_spec='${wl}-rpath ${wl}$libdir'
+      hardcode_libdir_separator=:
+      hardcode_shlibpath_var=no
+      ;;
 
-openbsd*)
-  version_type=sunos
-  sys_lib_dlsearch_path_spec="/usr/lib"
-  need_lib_prefix=no
-  # Some older versions of OpenBSD (3.3 at least) *do* need versioned libs.
-  case $host_os in
-    openbsd3.3 | openbsd3.3.*)	need_version=yes ;;
-    *)				need_version=no  ;;
-  esac
-  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${shared_ext}$versuffix'
-  finish_cmds='PATH="\$PATH:/sbin" ldconfig -m $libdir'
-  shlibpath_var=LD_LIBRARY_PATH
-  if test -z "`echo __ELF__ | $CC -E - | $GREP __ELF__`" || test "$host_os-$host_cpu" = "openbsd2.8-powerpc"; then
-    case $host_os in
-      openbsd2.[89] | openbsd2.[89].*)
-	shlibpath_overrides_runpath=no
-	;;
-      *)
-	shlibpath_overrides_runpath=yes
-	;;
-      esac
-  else
-    shlibpath_overrides_runpath=yes
-  fi
-  ;;
+    *nto* | *qnx*)
+      ;;
 
-os2*)
-  libname_spec='$name'
-  shrext_cmds=".dll"
-  need_lib_prefix=no
-  library_names_spec='$libname${shared_ext} $libname.a'
-  dynamic_linker='OS/2 ld.exe'
-  shlibpath_var=LIBPATH
-  ;;
+    openbsd*)
+      if test -f /usr/libexec/ld.so; then
+	hardcode_direct=yes
+	hardcode_shlibpath_var=no
+	hardcode_direct_absolute=yes
+	if test -z "`echo __ELF__ | $CC -E - | $GREP __ELF__`" || test "$host_os-$host_cpu" = "openbsd2.8-powerpc"; then
+	  archive_cmds='$CC -shared $pic_flag -o $lib $libobjs $deplibs $compiler_flags'
+	  archive_expsym_cmds='$CC -shared $pic_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-retain-symbols-file,$export_symbols'
+	  hardcode_libdir_flag_spec='${wl}-rpath,$libdir'
+	  export_dynamic_flag_spec='${wl}-E'
+	else
+	  case $host_os in
+	   openbsd[01].* | openbsd2.[0-7] | openbsd2.[0-7].*)
+	     archive_cmds='$LD -Bshareable -o $lib $libobjs $deplibs $linker_flags'
+	     hardcode_libdir_flag_spec='-R$libdir'
+	     ;;
+	   *)
+	     archive_cmds='$CC -shared $pic_flag -o $lib $libobjs $deplibs $compiler_flags'
+	     hardcode_libdir_flag_spec='${wl}-rpath,$libdir'
+	     ;;
+	  esac
+	fi
+      else
+	ld_shlibs=no
+      fi
+      ;;
 
-osf3* | osf4* | osf5*)
-  version_type=osf
-  need_lib_prefix=no
-  need_version=no
-  soname_spec='${libname}${release}${shared_ext}$major'
-  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
-  shlibpath_var=LD_LIBRARY_PATH
-  sys_lib_search_path_spec="/usr/shlib /usr/ccs/lib /usr/lib/cmplrs/cc /usr/lib /usr/local/lib /var/shlib"
-  sys_lib_dlsearch_path_spec="$sys_lib_search_path_spec"
-  ;;
+    os2*)
+      hardcode_libdir_flag_spec='-L$libdir'
+      hardcode_minus_L=yes
+      allow_undefined_flag=unsupported
+      archive_cmds='$ECHO "LIBRARY $libname INITINSTANCE" > $output_objdir/$libname.def~$ECHO "DESCRIPTION \"$libname\"" >> $output_objdir/$libname.def~echo DATA >> $output_objdir/$libname.def~echo " SINGLE NONSHARED" >> $output_objdir/$libname.def~echo EXPORTS >> $output_objdir/$libname.def~emxexp $libobjs >> $output_objdir/$libname.def~$CC -Zdll -Zcrtdll -o $lib $libobjs $deplibs $compiler_flags $output_objdir/$libname.def'
+      old_archive_from_new_cmds='emximp -o $output_objdir/$libname.a $output_objdir/$libname.def'
+      ;;
 
-rdos*)
-  dynamic_linker=no
-  ;;
+    osf3*)
+      if test "$GCC" = yes; then
+	allow_undefined_flag=' ${wl}-expect_unresolved ${wl}\*'
+	archive_cmds='$CC -shared${allow_undefined_flag} $libobjs $deplibs $compiler_flags ${wl}-soname ${wl}$soname `test -n "$verstring" && func_echo_all "${wl}-set_version ${wl}$verstring"` ${wl}-update_registry ${wl}${output_objdir}/so_locations -o $lib'
+      else
+	allow_undefined_flag=' -expect_unresolved \*'
+	archive_cmds='$CC -shared${allow_undefined_flag} $libobjs $deplibs $compiler_flags -soname $soname `test -n "$verstring" && func_echo_all "-set_version $verstring"` -update_registry ${output_objdir}/so_locations -o $lib'
+      fi
+      archive_cmds_need_lc='no'
+      hardcode_libdir_flag_spec='${wl}-rpath ${wl}$libdir'
+      hardcode_libdir_separator=:
+      ;;
 
-solaris*)
-  version_type=linux
-  need_lib_prefix=no
-  need_version=no
-  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
-  soname_spec='${libname}${release}${shared_ext}$major'
-  shlibpath_var=LD_LIBRARY_PATH
-  shlibpath_overrides_runpath=yes
-  hardcode_into_libs=yes
-  # ldd complains unless libraries are executable
-  postinstall_cmds='chmod +x $lib'
-  ;;
+    osf4* | osf5*)	# as osf3* with the addition of -msym flag
+      if test "$GCC" = yes; then
+	allow_undefined_flag=' ${wl}-expect_unresolved ${wl}\*'
+	archive_cmds='$CC -shared${allow_undefined_flag} $pic_flag $libobjs $deplibs $compiler_flags ${wl}-msym ${wl}-soname ${wl}$soname `test -n "$verstring" && func_echo_all "${wl}-set_version ${wl}$verstring"` ${wl}-update_registry ${wl}${output_objdir}/so_locations -o $lib'
+	hardcode_libdir_flag_spec='${wl}-rpath ${wl}$libdir'
+      else
+	allow_undefined_flag=' -expect_unresolved \*'
+	archive_cmds='$CC -shared${allow_undefined_flag} $libobjs $deplibs $compiler_flags -msym -soname $soname `test -n "$verstring" && func_echo_all "-set_version $verstring"` -update_registry ${output_objdir}/so_locations -o $lib'
+	archive_expsym_cmds='for i in `cat $export_symbols`; do printf "%s %s\\n" -exported_symbol "\$i" >> $lib.exp; done; printf "%s\\n" "-hidden">> $lib.exp~
+	$CC -shared${allow_undefined_flag} ${wl}-input ${wl}$lib.exp $compiler_flags $libobjs $deplibs -soname $soname `test -n "$verstring" && $ECHO "-set_version $verstring"` -update_registry ${output_objdir}/so_locations -o $lib~$RM $lib.exp'
 
-sunos4*)
-  version_type=sunos
-  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${shared_ext}$versuffix'
-  finish_cmds='PATH="\$PATH:/usr/etc" ldconfig $libdir'
-  shlibpath_var=LD_LIBRARY_PATH
-  shlibpath_overrides_runpath=yes
-  if test "$with_gnu_ld" = yes; then
-    need_lib_prefix=no
-  fi
-  need_version=yes
-  ;;
+	# Both c and cxx compiler support -rpath directly
+	hardcode_libdir_flag_spec='-rpath $libdir'
+      fi
+      archive_cmds_need_lc='no'
+      hardcode_libdir_separator=:
+      ;;
 
-sysv4 | sysv4.3*)
-  version_type=linux
-  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
-  soname_spec='${libname}${release}${shared_ext}$major'
-  shlibpath_var=LD_LIBRARY_PATH
-  case $host_vendor in
-    sni)
-      shlibpath_overrides_runpath=no
-      need_lib_prefix=no
-      runpath_var=LD_RUN_PATH
+    solaris*)
+      no_undefined_flag=' -z defs'
+      if test "$GCC" = yes; then
+	wlarc='${wl}'
+	archive_cmds='$CC -shared $pic_flag ${wl}-z ${wl}text ${wl}-h ${wl}$soname -o $lib $libobjs $deplibs $compiler_flags'
+	archive_expsym_cmds='echo "{ global:" > $lib.exp~cat $export_symbols | $SED -e "s/\(.*\)/\1;/" >> $lib.exp~echo "local: *; };" >> $lib.exp~
+	  $CC -shared $pic_flag ${wl}-z ${wl}text ${wl}-M ${wl}$lib.exp ${wl}-h ${wl}$soname -o $lib $libobjs $deplibs $compiler_flags~$RM $lib.exp'
+      else
+	case `$CC -V 2>&1` in
+	*"Compilers 5.0"*)
+	  wlarc=''
+	  archive_cmds='$LD -G${allow_undefined_flag} -h $soname -o $lib $libobjs $deplibs $linker_flags'
+	  archive_expsym_cmds='echo "{ global:" > $lib.exp~cat $export_symbols | $SED -e "s/\(.*\)/\1;/" >> $lib.exp~echo "local: *; };" >> $lib.exp~
+	  $LD -G${allow_undefined_flag} -M $lib.exp -h $soname -o $lib $libobjs $deplibs $linker_flags~$RM $lib.exp'
+	  ;;
+	*)
+	  wlarc='${wl}'
+	  archive_cmds='$CC -G${allow_undefined_flag} -h $soname -o $lib $libobjs $deplibs $compiler_flags'
+	  archive_expsym_cmds='echo "{ global:" > $lib.exp~cat $export_symbols | $SED -e "s/\(.*\)/\1;/" >> $lib.exp~echo "local: *; };" >> $lib.exp~
+	  $CC -G${allow_undefined_flag} -M $lib.exp -h $soname -o $lib $libobjs $deplibs $compiler_flags~$RM $lib.exp'
+	  ;;
+	esac
+      fi
+      hardcode_libdir_flag_spec='-R$libdir'
+      hardcode_shlibpath_var=no
+      case $host_os in
+      solaris2.[0-5] | solaris2.[0-5].*) ;;
+      *)
+	# The compiler driver will combine and reorder linker options,
+	# but understands `-z linker_flag'.  GCC discards it without `$wl',
+	# but is careful enough not to reorder.
+	# Supported since Solaris 2.6 (maybe 2.5.1?)
+	if test "$GCC" = yes; then
+	  whole_archive_flag_spec='${wl}-z ${wl}allextract$convenience ${wl}-z ${wl}defaultextract'
+	else
+	  whole_archive_flag_spec='-z allextract$convenience -z defaultextract'
+	fi
+	;;
+      esac
+      link_all_deplibs=yes
       ;;
-    siemens)
-      need_lib_prefix=no
+
+    sunos4*)
+      if test "x$host_vendor" = xsequent; then
+	# Use $CC to link under sequent, because it throws in some extra .o
+	# files that make .init and .fini sections work.
+	archive_cmds='$CC -G ${wl}-h $soname -o $lib $libobjs $deplibs $compiler_flags'
+      else
+	archive_cmds='$LD -assert pure-text -Bstatic -o $lib $libobjs $deplibs $linker_flags'
+      fi
+      hardcode_libdir_flag_spec='-L$libdir'
+      hardcode_direct=yes
+      hardcode_minus_L=yes
+      hardcode_shlibpath_var=no
       ;;
-    motorola)
-      need_lib_prefix=no
-      need_version=no
-      shlibpath_overrides_runpath=no
-      sys_lib_search_path_spec='/lib /usr/lib /usr/ccs/lib'
+
+    sysv4)
+      case $host_vendor in
+	sni)
+	  archive_cmds='$LD -G -h $soname -o $lib $libobjs $deplibs $linker_flags'
+	  hardcode_direct=yes # is this really true???
+	;;
+	siemens)
+	  ## LD is ld it makes a PLAMLIB
+	  ## CC just makes a GrossModule.
+	  archive_cmds='$LD -G -o $lib $libobjs $deplibs $linker_flags'
+	  reload_cmds='$CC -r -o $output$reload_objs'
+	  hardcode_direct=no
+        ;;
+	motorola)
+	  archive_cmds='$LD -G -h $soname -o $lib $libobjs $deplibs $linker_flags'
+	  hardcode_direct=no #Motorola manual says yes, but my tests say they lie
+	;;
+      esac
+      runpath_var='LD_RUN_PATH'
+      hardcode_shlibpath_var=no
       ;;
-  esac
-  ;;
 
-sysv4*MP*)
-  if test -d /usr/nec ;then
-    version_type=linux
-    library_names_spec='$libname${shared_ext}.$versuffix $libname${shared_ext}.$major $libname${shared_ext}'
-    soname_spec='$libname${shared_ext}.$major'
-    shlibpath_var=LD_LIBRARY_PATH
-  fi
-  ;;
+    sysv4.3*)
+      archive_cmds='$LD -G -h $soname -o $lib $libobjs $deplibs $linker_flags'
+      hardcode_shlibpath_var=no
+      export_dynamic_flag_spec='-Bexport'
+      ;;
 
-sysv5* | sco3.2v5* | sco5v6* | unixware* | OpenUNIX* | sysv4*uw2*)
-  version_type=freebsd-elf
-  need_lib_prefix=no
-  need_version=no
-  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext} $libname${shared_ext}'
-  soname_spec='${libname}${release}${shared_ext}$major'
-  shlibpath_var=LD_LIBRARY_PATH
-  shlibpath_overrides_runpath=yes
-  hardcode_into_libs=yes
-  if test "$with_gnu_ld" = yes; then
-    sys_lib_search_path_spec='/usr/local/lib /usr/gnu/lib /usr/ccs/lib /usr/lib /lib'
-  else
-    sys_lib_search_path_spec='/usr/ccs/lib /usr/lib'
-    case $host_os in
-      sco3.2v5*)
-        sys_lib_search_path_spec="$sys_lib_search_path_spec /lib"
-	;;
-    esac
-  fi
-  sys_lib_dlsearch_path_spec='/usr/lib'
-  ;;
+    sysv4*MP*)
+      if test -d /usr/nec; then
+	archive_cmds='$LD -G -h $soname -o $lib $libobjs $deplibs $linker_flags'
+	hardcode_shlibpath_var=no
+	runpath_var=LD_RUN_PATH
+	hardcode_runpath_var=yes
+	ld_shlibs=yes
+      fi
+      ;;
 
-tpf*)
-  # TPF is a cross-target only.  Preferred cross-host = GNU/Linux.
-  version_type=linux
-  need_lib_prefix=no
-  need_version=no
-  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
-  shlibpath_var=LD_LIBRARY_PATH
-  shlibpath_overrides_runpath=no
-  hardcode_into_libs=yes
-  ;;
+    sysv4*uw2* | sysv5OpenUNIX* | sysv5UnixWare7.[01].[10]* | unixware7* | sco3.2v5.0.[024]*)
+      no_undefined_flag='${wl}-z,text'
+      archive_cmds_need_lc=no
+      hardcode_shlibpath_var=no
+      runpath_var='LD_RUN_PATH'
 
-uts4*)
-  version_type=linux
-  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
-  soname_spec='${libname}${release}${shared_ext}$major'
-  shlibpath_var=LD_LIBRARY_PATH
-  ;;
+      if test "$GCC" = yes; then
+	archive_cmds='$CC -shared ${wl}-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
+	archive_expsym_cmds='$CC -shared ${wl}-Bexport:$export_symbols ${wl}-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
+      else
+	archive_cmds='$CC -G ${wl}-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
+	archive_expsym_cmds='$CC -G ${wl}-Bexport:$export_symbols ${wl}-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
+      fi
+      ;;
 
-*)
-  dynamic_linker=no
-  ;;
-esac
-{ $as_echo "$as_me:$LINENO: result: $dynamic_linker" >&5
-$as_echo "$dynamic_linker" >&6; }
-test "$dynamic_linker" = no && can_build_shared=no
+    sysv5* | sco3.2v5* | sco5v6*)
+      # Note: We can NOT use -z defs as we might desire, because we do not
+      # link with -lc, and that would cause any symbols used from libc to
+      # always be unresolved, which means just about no library would
+      # ever link correctly.  If we're not using GNU ld we use -z text
+      # though, which does catch some bad symbols but isn't as heavy-handed
+      # as -z defs.
+      no_undefined_flag='${wl}-z,text'
+      allow_undefined_flag='${wl}-z,nodefs'
+      archive_cmds_need_lc=no
+      hardcode_shlibpath_var=no
+      hardcode_libdir_flag_spec='${wl}-R,$libdir'
+      hardcode_libdir_separator=':'
+      link_all_deplibs=yes
+      export_dynamic_flag_spec='${wl}-Bexport'
+      runpath_var='LD_RUN_PATH'
 
-variables_saved_for_relink="PATH $shlibpath_var $runpath_var"
-if test "$GCC" = yes; then
-  variables_saved_for_relink="$variables_saved_for_relink GCC_EXEC_PREFIX COMPILER_PATH LIBRARY_PATH"
-fi
+      if test "$GCC" = yes; then
+	archive_cmds='$CC -shared ${wl}-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
+	archive_expsym_cmds='$CC -shared ${wl}-Bexport:$export_symbols ${wl}-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
+      else
+	archive_cmds='$CC -G ${wl}-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
+	archive_expsym_cmds='$CC -G ${wl}-Bexport:$export_symbols ${wl}-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
+      fi
+      ;;
 
-if test "${lt_cv_sys_lib_search_path_spec+set}" = set; then
-  sys_lib_search_path_spec="$lt_cv_sys_lib_search_path_spec"
-fi
-if test "${lt_cv_sys_lib_dlsearch_path_spec+set}" = set; then
-  sys_lib_dlsearch_path_spec="$lt_cv_sys_lib_dlsearch_path_spec"
-fi
+    uts4*)
+      archive_cmds='$LD -G -h $soname -o $lib $libobjs $deplibs $linker_flags'
+      hardcode_libdir_flag_spec='-L$libdir'
+      hardcode_shlibpath_var=no
+      ;;
+
+    *)
+      ld_shlibs=no
+      ;;
+    esac
 
+    if test x$host_vendor = xsni; then
+      case $host in
+      sysv4 | sysv4.2uw2* | sysv4.3* | sysv5*)
+	export_dynamic_flag_spec='${wl}-Blargedynsym'
+	;;
+      esac
+    fi
+  fi
 
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ld_shlibs" >&5
+$as_echo "$ld_shlibs" >&6; }
+test "$ld_shlibs" = no && can_build_shared=no
 
+with_gnu_ld=$with_gnu_ld
 
 
 
@@ -9397,9 +9418,74 @@ fi
 
 
 
+#
+# Do we need to explicitly link libc?
+#
+case "x$archive_cmds_need_lc" in
+x|xyes)
+  # Assume -lc should be added
+  archive_cmds_need_lc=yes
 
+  if test "$enable_shared" = yes && test "$GCC" = yes; then
+    case $archive_cmds in
+    *'~'*)
+      # FIXME: we may have to deal with multi-command sequences.
+      ;;
+    '$CC '*)
+      # Test whether the compiler implicitly links with -lc since on some
+      # systems, -lgcc has to come before -lc. If gcc already passes -lc
+      # to ld, don't add -lc before -lgcc.
+      { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether -lc should be explicitly linked in" >&5
+$as_echo_n "checking whether -lc should be explicitly linked in... " >&6; }
+if ${lt_cv_archive_cmds_need_lc+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  $RM conftest*
+	echo "$lt_simple_compile_test_code" > conftest.$ac_ext
 
+	if { { eval echo "\"\$as_me\":${as_lineno-$LINENO}: \"$ac_compile\""; } >&5
+  (eval $ac_compile) 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; } 2>conftest.err; then
+	  soname=conftest
+	  lib=conftest
+	  libobjs=conftest.$ac_objext
+	  deplibs=
+	  wl=$lt_prog_compiler_wl
+	  pic_flag=$lt_prog_compiler_pic
+	  compiler_flags=-v
+	  linker_flags=-v
+	  verstring=
+	  output_objdir=.
+	  libname=conftest
+	  lt_save_allow_undefined_flag=$allow_undefined_flag
+	  allow_undefined_flag=
+	  if { { eval echo "\"\$as_me\":${as_lineno-$LINENO}: \"$archive_cmds 2\>\&1 \| $GREP \" -lc \" \>/dev/null 2\>\&1\""; } >&5
+  (eval $archive_cmds 2\>\&1 \| $GREP \" -lc \" \>/dev/null 2\>\&1) 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+	  then
+	    lt_cv_archive_cmds_need_lc=no
+	  else
+	    lt_cv_archive_cmds_need_lc=yes
+	  fi
+	  allow_undefined_flag=$lt_save_allow_undefined_flag
+	else
+	  cat conftest.err 1>&5
+	fi
+	$RM conftest*
 
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_archive_cmds_need_lc" >&5
+$as_echo "$lt_cv_archive_cmds_need_lc" >&6; }
+      archive_cmds_need_lc=$lt_cv_archive_cmds_need_lc
+      ;;
+    esac
+  fi
+  ;;
+esac
 
 
 
@@ -9466,2539 +9552,1613 @@ fi
 
 
 
-  { $as_echo "$as_me:$LINENO: checking how to hardcode library paths into programs" >&5
-$as_echo_n "checking how to hardcode library paths into programs... " >&6; }
-hardcode_action=
-if test -n "$hardcode_libdir_flag_spec" ||
-   test -n "$runpath_var" ||
-   test "X$hardcode_automatic" = "Xyes" ; then
 
-  # We can hardcode non-existent directories.
-  if test "$hardcode_direct" != no &&
-     # If the only mechanism to avoid hardcoding is shlibpath_var, we
-     # have to relink, otherwise we might link with an installed library
-     # when we should be linking with a yet-to-be-installed one
-     ## test "$_LT_TAGVAR(hardcode_shlibpath_var, )" != no &&
-     test "$hardcode_minus_L" != no; then
-    # Linking always hardcodes the temporary library directory.
-    hardcode_action=relink
-  else
-    # We can link without hardcoding, and we can hardcode nonexisting dirs.
-    hardcode_action=immediate
-  fi
-else
-  # We cannot hardcode anything, or else we can only hardcode existing
-  # directories.
-  hardcode_action=unsupported
-fi
-{ $as_echo "$as_me:$LINENO: result: $hardcode_action" >&5
-$as_echo "$hardcode_action" >&6; }
 
-if test "$hardcode_action" = relink ||
-   test "$inherit_rpath" = yes; then
-  # Fast installation is not supported
-  enable_fast_install=no
-elif test "$shlibpath_overrides_runpath" = yes ||
-     test "$enable_shared" = no; then
-  # Fast installation is not necessary
-  enable_fast_install=needless
-fi
 
 
 
 
 
 
-  if test "x$enable_dlopen" != xyes; then
-  enable_dlopen=unknown
-  enable_dlopen_self=unknown
-  enable_dlopen_self_static=unknown
-else
-  lt_cv_dlopen=no
-  lt_cv_dlopen_libs=
 
-  case $host_os in
-  beos*)
-    lt_cv_dlopen="load_add_on"
-    lt_cv_dlopen_libs=
-    lt_cv_dlopen_self=yes
-    ;;
 
-  mingw* | pw32* | cegcc*)
-    lt_cv_dlopen="LoadLibrary"
-    lt_cv_dlopen_libs=
-    ;;
 
-  cygwin*)
-    lt_cv_dlopen="dlopen"
-    lt_cv_dlopen_libs=
-    ;;
 
-  darwin*)
-  # if libdl is installed we need to link against it
-    { $as_echo "$as_me:$LINENO: checking for dlopen in -ldl" >&5
-$as_echo_n "checking for dlopen in -ldl... " >&6; }
-if test "${ac_cv_lib_dl_dlopen+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  ac_check_lib_save_LIBS=$LIBS
-LIBS="-ldl  $LIBS"
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
 
-/* Override any GCC internal prototype to avoid an error.
-   Use char because int might match the return type of a GCC
-   builtin and then its argument prototype would still apply.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-char dlopen ();
-int
-main ()
-{
-return dlopen ();
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest$ac_exeext && {
-	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
-       }; then
-  ac_cv_lib_dl_dlopen=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
 
-	ac_cv_lib_dl_dlopen=no
-fi
 
-rm -rf conftest.dSYM
-rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
-      conftest$ac_exeext conftest.$ac_ext
-LIBS=$ac_check_lib_save_LIBS
-fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_lib_dl_dlopen" >&5
-$as_echo "$ac_cv_lib_dl_dlopen" >&6; }
-if test "x$ac_cv_lib_dl_dlopen" = x""yes; then
-  lt_cv_dlopen="dlopen" lt_cv_dlopen_libs="-ldl"
-else
 
-    lt_cv_dlopen="dyld"
-    lt_cv_dlopen_libs=
-    lt_cv_dlopen_self=yes
 
-fi
 
-    ;;
 
-  *)
-    { $as_echo "$as_me:$LINENO: checking for shl_load" >&5
-$as_echo_n "checking for shl_load... " >&6; }
-if test "${ac_cv_func_shl_load+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-/* Define shl_load to an innocuous variant, in case <limits.h> declares shl_load.
-   For example, HP-UX 11i <limits.h> declares gettimeofday.  */
-#define shl_load innocuous_shl_load
 
-/* System header to define __stub macros and hopefully few prototypes,
-    which can conflict with char shl_load (); below.
-    Prefer <limits.h> to <assert.h> if __STDC__ is defined, since
-    <limits.h> exists even on freestanding compilers.  */
 
-#ifdef __STDC__
-# include <limits.h>
-#else
-# include <assert.h>
-#endif
 
-#undef shl_load
 
-/* Override any GCC internal prototype to avoid an error.
-   Use char because int might match the return type of a GCC
-   builtin and then its argument prototype would still apply.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-char shl_load ();
-/* The GNU C library defines this for functions which it implements
-    to always fail with ENOSYS.  Some functions are actually named
-    something starting with __ and the normal name is an alias.  */
-#if defined __stub_shl_load || defined __stub___shl_load
-choke me
-#endif
 
-int
-main ()
-{
-return shl_load ();
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest$ac_exeext && {
-	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
-       }; then
-  ac_cv_func_shl_load=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
 
-	ac_cv_func_shl_load=no
-fi
 
-rm -rf conftest.dSYM
-rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
-      conftest$ac_exeext conftest.$ac_ext
-fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_func_shl_load" >&5
-$as_echo "$ac_cv_func_shl_load" >&6; }
-if test "x$ac_cv_func_shl_load" = x""yes; then
-  lt_cv_dlopen="shl_load"
-else
-  { $as_echo "$as_me:$LINENO: checking for shl_load in -ldld" >&5
-$as_echo_n "checking for shl_load in -ldld... " >&6; }
-if test "${ac_cv_lib_dld_shl_load+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  ac_check_lib_save_LIBS=$LIBS
-LIBS="-ldld  $LIBS"
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
 
-/* Override any GCC internal prototype to avoid an error.
-   Use char because int might match the return type of a GCC
-   builtin and then its argument prototype would still apply.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-char shl_load ();
-int
-main ()
-{
-return shl_load ();
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest$ac_exeext && {
-	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
-       }; then
-  ac_cv_lib_dld_shl_load=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
 
-	ac_cv_lib_dld_shl_load=no
-fi
 
-rm -rf conftest.dSYM
-rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
-      conftest$ac_exeext conftest.$ac_ext
-LIBS=$ac_check_lib_save_LIBS
-fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_lib_dld_shl_load" >&5
-$as_echo "$ac_cv_lib_dld_shl_load" >&6; }
-if test "x$ac_cv_lib_dld_shl_load" = x""yes; then
-  lt_cv_dlopen="shl_load" lt_cv_dlopen_libs="-ldld"
-else
-  { $as_echo "$as_me:$LINENO: checking for dlopen" >&5
-$as_echo_n "checking for dlopen... " >&6; }
-if test "${ac_cv_func_dlopen+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-/* Define dlopen to an innocuous variant, in case <limits.h> declares dlopen.
-   For example, HP-UX 11i <limits.h> declares gettimeofday.  */
-#define dlopen innocuous_dlopen
 
-/* System header to define __stub macros and hopefully few prototypes,
-    which can conflict with char dlopen (); below.
-    Prefer <limits.h> to <assert.h> if __STDC__ is defined, since
-    <limits.h> exists even on freestanding compilers.  */
 
-#ifdef __STDC__
-# include <limits.h>
-#else
-# include <assert.h>
-#endif
 
-#undef dlopen
 
-/* Override any GCC internal prototype to avoid an error.
-   Use char because int might match the return type of a GCC
-   builtin and then its argument prototype would still apply.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-char dlopen ();
-/* The GNU C library defines this for functions which it implements
-    to always fail with ENOSYS.  Some functions are actually named
-    something starting with __ and the normal name is an alias.  */
-#if defined __stub_dlopen || defined __stub___dlopen
-choke me
-#endif
 
-int
-main ()
-{
-return dlopen ();
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest$ac_exeext && {
-	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
-       }; then
-  ac_cv_func_dlopen=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
 
-	ac_cv_func_dlopen=no
-fi
 
-rm -rf conftest.dSYM
-rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
-      conftest$ac_exeext conftest.$ac_ext
-fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_func_dlopen" >&5
-$as_echo "$ac_cv_func_dlopen" >&6; }
-if test "x$ac_cv_func_dlopen" = x""yes; then
-  lt_cv_dlopen="dlopen"
-else
-  { $as_echo "$as_me:$LINENO: checking for dlopen in -ldl" >&5
-$as_echo_n "checking for dlopen in -ldl... " >&6; }
-if test "${ac_cv_lib_dl_dlopen+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  ac_check_lib_save_LIBS=$LIBS
-LIBS="-ldl  $LIBS"
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
 
-/* Override any GCC internal prototype to avoid an error.
-   Use char because int might match the return type of a GCC
-   builtin and then its argument prototype would still apply.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-char dlopen ();
-int
-main ()
-{
-return dlopen ();
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest$ac_exeext && {
-	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
-       }; then
-  ac_cv_lib_dl_dlopen=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
 
-	ac_cv_lib_dl_dlopen=no
-fi
 
-rm -rf conftest.dSYM
-rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
-      conftest$ac_exeext conftest.$ac_ext
-LIBS=$ac_check_lib_save_LIBS
-fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_lib_dl_dlopen" >&5
-$as_echo "$ac_cv_lib_dl_dlopen" >&6; }
-if test "x$ac_cv_lib_dl_dlopen" = x""yes; then
-  lt_cv_dlopen="dlopen" lt_cv_dlopen_libs="-ldl"
-else
-  { $as_echo "$as_me:$LINENO: checking for dlopen in -lsvld" >&5
-$as_echo_n "checking for dlopen in -lsvld... " >&6; }
-if test "${ac_cv_lib_svld_dlopen+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  ac_check_lib_save_LIBS=$LIBS
-LIBS="-lsvld  $LIBS"
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
 
-/* Override any GCC internal prototype to avoid an error.
-   Use char because int might match the return type of a GCC
-   builtin and then its argument prototype would still apply.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-char dlopen ();
-int
-main ()
-{
-return dlopen ();
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest$ac_exeext && {
-	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
-       }; then
-  ac_cv_lib_svld_dlopen=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
 
-	ac_cv_lib_svld_dlopen=no
-fi
 
-rm -rf conftest.dSYM
-rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
-      conftest$ac_exeext conftest.$ac_ext
-LIBS=$ac_check_lib_save_LIBS
-fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_lib_svld_dlopen" >&5
-$as_echo "$ac_cv_lib_svld_dlopen" >&6; }
-if test "x$ac_cv_lib_svld_dlopen" = x""yes; then
-  lt_cv_dlopen="dlopen" lt_cv_dlopen_libs="-lsvld"
-else
-  { $as_echo "$as_me:$LINENO: checking for dld_link in -ldld" >&5
-$as_echo_n "checking for dld_link in -ldld... " >&6; }
-if test "${ac_cv_lib_dld_dld_link+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  ac_check_lib_save_LIBS=$LIBS
-LIBS="-ldld  $LIBS"
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
 
-/* Override any GCC internal prototype to avoid an error.
-   Use char because int might match the return type of a GCC
-   builtin and then its argument prototype would still apply.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-char dld_link ();
-int
-main ()
-{
-return dld_link ();
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest$ac_exeext && {
-	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
-       }; then
-  ac_cv_lib_dld_dld_link=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
 
-	ac_cv_lib_dld_dld_link=no
-fi
 
-rm -rf conftest.dSYM
-rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
-      conftest$ac_exeext conftest.$ac_ext
-LIBS=$ac_check_lib_save_LIBS
-fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_lib_dld_dld_link" >&5
-$as_echo "$ac_cv_lib_dld_dld_link" >&6; }
-if test "x$ac_cv_lib_dld_dld_link" = x""yes; then
-  lt_cv_dlopen="dld_link" lt_cv_dlopen_libs="-ldld"
-fi
 
 
-fi
 
 
-fi
 
 
-fi
 
 
-fi
 
 
-fi
 
-    ;;
-  esac
 
-  if test "x$lt_cv_dlopen" != xno; then
-    enable_dlopen=yes
-  else
-    enable_dlopen=no
-  fi
 
-  case $lt_cv_dlopen in
-  dlopen)
-    save_CPPFLAGS="$CPPFLAGS"
-    test "x$ac_cv_header_dlfcn_h" = xyes && CPPFLAGS="$CPPFLAGS -DHAVE_DLFCN_H"
 
-    save_LDFLAGS="$LDFLAGS"
-    wl=$lt_prog_compiler_wl eval LDFLAGS=\"\$LDFLAGS $export_dynamic_flag_spec\"
 
-    save_LIBS="$LIBS"
-    LIBS="$lt_cv_dlopen_libs $LIBS"
 
-    { $as_echo "$as_me:$LINENO: checking whether a program can dlopen itself" >&5
-$as_echo_n "checking whether a program can dlopen itself... " >&6; }
-if test "${lt_cv_dlopen_self+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  	  if test "$cross_compiling" = yes; then :
-  lt_cv_dlopen_self=cross
-else
-  lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2
-  lt_status=$lt_dlunknown
-  cat > conftest.$ac_ext <<_LT_EOF
-#line 10112 "configure"
-#include "confdefs.h"
 
-#if HAVE_DLFCN_H
-#include <dlfcn.h>
-#endif
 
-#include <stdio.h>
 
-#ifdef RTLD_GLOBAL
-#  define LT_DLGLOBAL		RTLD_GLOBAL
-#else
-#  ifdef DL_GLOBAL
-#    define LT_DLGLOBAL		DL_GLOBAL
-#  else
-#    define LT_DLGLOBAL		0
-#  endif
-#endif
 
-/* We may have to define LT_DLLAZY_OR_NOW in the command line if we
-   find out it does not work in some platform. */
-#ifndef LT_DLLAZY_OR_NOW
-#  ifdef RTLD_LAZY
-#    define LT_DLLAZY_OR_NOW		RTLD_LAZY
-#  else
-#    ifdef DL_LAZY
-#      define LT_DLLAZY_OR_NOW		DL_LAZY
-#    else
-#      ifdef RTLD_NOW
-#        define LT_DLLAZY_OR_NOW	RTLD_NOW
-#      else
-#        ifdef DL_NOW
-#          define LT_DLLAZY_OR_NOW	DL_NOW
-#        else
-#          define LT_DLLAZY_OR_NOW	0
-#        endif
-#      endif
-#    endif
-#  endif
-#endif
 
-void fnord() { int i=42;}
-int main ()
-{
-  void *self = dlopen (0, LT_DLGLOBAL|LT_DLLAZY_OR_NOW);
-  int status = $lt_dlunknown;
 
-  if (self)
-    {
-      if (dlsym (self,"fnord"))       status = $lt_dlno_uscore;
-      else if (dlsym( self,"_fnord")) status = $lt_dlneed_uscore;
-      /* dlclose (self); */
-    }
-  else
-    puts (dlerror ());
 
-  return status;
-}
-_LT_EOF
-  if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
-  (eval $ac_link) 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && test -s conftest${ac_exeext} 2>/dev/null; then
-    (./conftest; exit; ) >&5 2>/dev/null
-    lt_status=$?
-    case x$lt_status in
-      x$lt_dlno_uscore) lt_cv_dlopen_self=yes ;;
-      x$lt_dlneed_uscore) lt_cv_dlopen_self=yes ;;
-      x$lt_dlunknown|x*) lt_cv_dlopen_self=no ;;
-    esac
-  else :
-    # compilation failed
-    lt_cv_dlopen_self=no
-  fi
-fi
-rm -fr conftest*
 
 
-fi
-{ $as_echo "$as_me:$LINENO: result: $lt_cv_dlopen_self" >&5
-$as_echo "$lt_cv_dlopen_self" >&6; }
 
-    if test "x$lt_cv_dlopen_self" = xyes; then
-      wl=$lt_prog_compiler_wl eval LDFLAGS=\"\$LDFLAGS $lt_prog_compiler_static\"
-      { $as_echo "$as_me:$LINENO: checking whether a statically linked program can dlopen itself" >&5
-$as_echo_n "checking whether a statically linked program can dlopen itself... " >&6; }
-if test "${lt_cv_dlopen_self_static+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  	  if test "$cross_compiling" = yes; then :
-  lt_cv_dlopen_self_static=cross
-else
-  lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2
-  lt_status=$lt_dlunknown
-  cat > conftest.$ac_ext <<_LT_EOF
-#line 10208 "configure"
-#include "confdefs.h"
 
-#if HAVE_DLFCN_H
-#include <dlfcn.h>
-#endif
 
-#include <stdio.h>
 
-#ifdef RTLD_GLOBAL
-#  define LT_DLGLOBAL		RTLD_GLOBAL
-#else
-#  ifdef DL_GLOBAL
-#    define LT_DLGLOBAL		DL_GLOBAL
-#  else
-#    define LT_DLGLOBAL		0
-#  endif
-#endif
 
-/* We may have to define LT_DLLAZY_OR_NOW in the command line if we
-   find out it does not work in some platform. */
-#ifndef LT_DLLAZY_OR_NOW
-#  ifdef RTLD_LAZY
-#    define LT_DLLAZY_OR_NOW		RTLD_LAZY
-#  else
-#    ifdef DL_LAZY
-#      define LT_DLLAZY_OR_NOW		DL_LAZY
-#    else
-#      ifdef RTLD_NOW
-#        define LT_DLLAZY_OR_NOW	RTLD_NOW
-#      else
-#        ifdef DL_NOW
-#          define LT_DLLAZY_OR_NOW	DL_NOW
-#        else
-#          define LT_DLLAZY_OR_NOW	0
-#        endif
-#      endif
-#    endif
-#  endif
-#endif
 
-void fnord() { int i=42;}
-int main ()
-{
-  void *self = dlopen (0, LT_DLGLOBAL|LT_DLLAZY_OR_NOW);
-  int status = $lt_dlunknown;
 
-  if (self)
-    {
-      if (dlsym (self,"fnord"))       status = $lt_dlno_uscore;
-      else if (dlsym( self,"_fnord")) status = $lt_dlneed_uscore;
-      /* dlclose (self); */
-    }
-  else
-    puts (dlerror ());
 
-  return status;
-}
-_LT_EOF
-  if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
-  (eval $ac_link) 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && test -s conftest${ac_exeext} 2>/dev/null; then
-    (./conftest; exit; ) >&5 2>/dev/null
-    lt_status=$?
-    case x$lt_status in
-      x$lt_dlno_uscore) lt_cv_dlopen_self_static=yes ;;
-      x$lt_dlneed_uscore) lt_cv_dlopen_self_static=yes ;;
-      x$lt_dlunknown|x*) lt_cv_dlopen_self_static=no ;;
-    esac
-  else :
-    # compilation failed
-    lt_cv_dlopen_self_static=no
-  fi
-fi
-rm -fr conftest*
 
 
-fi
-{ $as_echo "$as_me:$LINENO: result: $lt_cv_dlopen_self_static" >&5
-$as_echo "$lt_cv_dlopen_self_static" >&6; }
-    fi
 
-    CPPFLAGS="$save_CPPFLAGS"
-    LDFLAGS="$save_LDFLAGS"
-    LIBS="$save_LIBS"
-    ;;
-  esac
 
-  case $lt_cv_dlopen_self in
-  yes|no) enable_dlopen_self=$lt_cv_dlopen_self ;;
-  *) enable_dlopen_self=unknown ;;
-  esac
 
-  case $lt_cv_dlopen_self_static in
-  yes|no) enable_dlopen_self_static=$lt_cv_dlopen_self_static ;;
-  *) enable_dlopen_self_static=unknown ;;
+
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking dynamic linker characteristics" >&5
+$as_echo_n "checking dynamic linker characteristics... " >&6; }
+
+if test "$GCC" = yes; then
+  case $host_os in
+    darwin*) lt_awk_arg="/^libraries:/,/LR/" ;;
+    *) lt_awk_arg="/^libraries:/" ;;
+  esac
+  case $host_os in
+    mingw* | cegcc*) lt_sed_strip_eq="s,=\([A-Za-z]:\),\1,g" ;;
+    *) lt_sed_strip_eq="s,=/,/,g" ;;
+  esac
+  lt_search_path_spec=`$CC -print-search-dirs | awk $lt_awk_arg | $SED -e "s/^libraries://" -e $lt_sed_strip_eq`
+  case $lt_search_path_spec in
+  *\;*)
+    # if the path contains ";" then we assume it to be the separator
+    # otherwise default to the standard path separator (i.e. ":") - it is
+    # assumed that no part of a normal pathname contains ";" but that should
+    # okay in the real world where ";" in dirpaths is itself problematic.
+    lt_search_path_spec=`$ECHO "$lt_search_path_spec" | $SED 's/;/ /g'`
+    ;;
+  *)
+    lt_search_path_spec=`$ECHO "$lt_search_path_spec" | $SED "s/$PATH_SEPARATOR/ /g"`
+    ;;
+  esac
+  # Ok, now we have the path, separated by spaces, we can step through it
+  # and add multilib dir if necessary.
+  lt_tmp_lt_search_path_spec=
+  lt_multi_os_dir=`$CC $CPPFLAGS $CFLAGS $LDFLAGS -print-multi-os-directory 2>/dev/null`
+  for lt_sys_path in $lt_search_path_spec; do
+    if test -d "$lt_sys_path/$lt_multi_os_dir"; then
+      lt_tmp_lt_search_path_spec="$lt_tmp_lt_search_path_spec $lt_sys_path/$lt_multi_os_dir"
+    else
+      test -d "$lt_sys_path" && \
+	lt_tmp_lt_search_path_spec="$lt_tmp_lt_search_path_spec $lt_sys_path"
+    fi
+  done
+  lt_search_path_spec=`$ECHO "$lt_tmp_lt_search_path_spec" | awk '
+BEGIN {RS=" "; FS="/|\n";} {
+  lt_foo="";
+  lt_count=0;
+  for (lt_i = NF; lt_i > 0; lt_i--) {
+    if ($lt_i != "" && $lt_i != ".") {
+      if ($lt_i == "..") {
+        lt_count++;
+      } else {
+        if (lt_count == 0) {
+          lt_foo="/" $lt_i lt_foo;
+        } else {
+          lt_count--;
+        }
+      }
+    }
+  }
+  if (lt_foo != "") { lt_freq[lt_foo]++; }
+  if (lt_freq[lt_foo] == 1) { print lt_foo; }
+}'`
+  # AWK program above erroneously prepends '/' to C:/dos/paths
+  # for these hosts.
+  case $host_os in
+    mingw* | cegcc*) lt_search_path_spec=`$ECHO "$lt_search_path_spec" |\
+      $SED 's,/\([A-Za-z]:\),\1,g'` ;;
   esac
+  sys_lib_search_path_spec=`$ECHO "$lt_search_path_spec" | $lt_NL2SP`
+else
+  sys_lib_search_path_spec="/lib /usr/lib /usr/local/lib"
 fi
+library_names_spec=
+libname_spec='lib$name'
+soname_spec=
+shrext_cmds=".so"
+postinstall_cmds=
+postuninstall_cmds=
+finish_cmds=
+finish_eval=
+shlibpath_var=
+shlibpath_overrides_runpath=unknown
+version_type=none
+dynamic_linker="$host_os ld.so"
+sys_lib_dlsearch_path_spec="/lib /usr/lib"
+need_lib_prefix=unknown
+hardcode_into_libs=no
+
+# when you set need_version to no, make sure it does not cause -set_version
+# flags to be left without arguments
+need_version=unknown
+
+case $host_os in
+aix3*)
+  version_type=linux # correct to gnu/linux during the next big refactor
+  library_names_spec='${libname}${release}${shared_ext}$versuffix $libname.a'
+  shlibpath_var=LIBPATH
+
+  # AIX 3 has no versioning support, so we append a major version to the name.
+  soname_spec='${libname}${release}${shared_ext}$major'
+  ;;
+
+aix[4-9]*)
+  version_type=linux # correct to gnu/linux during the next big refactor
+  need_lib_prefix=no
+  need_version=no
+  hardcode_into_libs=yes
+  if test "$host_cpu" = ia64; then
+    # AIX 5 supports IA64
+    library_names_spec='${libname}${release}${shared_ext}$major ${libname}${release}${shared_ext}$versuffix $libname${shared_ext}'
+    shlibpath_var=LD_LIBRARY_PATH
+  else
+    # With GCC up to 2.95.x, collect2 would create an import file
+    # for dependence libraries.  The import file would start with
+    # the line `#! .'.  This would cause the generated library to
+    # depend on `.', always an invalid library.  This was fixed in
+    # development snapshots of GCC prior to 3.0.
+    case $host_os in
+      aix4 | aix4.[01] | aix4.[01].*)
+      if { echo '#if __GNUC__ > 2 || (__GNUC__ == 2 && __GNUC_MINOR__ >= 97)'
+	   echo ' yes '
+	   echo '#endif'; } | ${CC} -E - | $GREP yes > /dev/null; then
+	:
+      else
+	can_build_shared=no
+      fi
+      ;;
+    esac
+    # AIX (on Power*) has no versioning support, so currently we can not hardcode correct
+    # soname into executable. Probably we can add versioning support to
+    # collect2, so additional links can be useful in future.
+    if test "$aix_use_runtimelinking" = yes; then
+      # If using run time linking (on AIX 4.2 or later) use lib<name>.so
+      # instead of lib<name>.a to let people know that these are not
+      # typical AIX shared libraries.
+      library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
+    else
+      # We preserve .a as extension for shared libraries through AIX4.2
+      # and later when we are not doing run time linking.
+      library_names_spec='${libname}${release}.a $libname.a'
+      soname_spec='${libname}${release}${shared_ext}$major'
+    fi
+    shlibpath_var=LIBPATH
+  fi
+  ;;
 
+amigaos*)
+  case $host_cpu in
+  powerpc)
+    # Since July 2007 AmigaOS4 officially supports .so libraries.
+    # When compiling the executable, add -use-dynld -Lsobjs: to the compileline.
+    library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
+    ;;
+  m68k)
+    library_names_spec='$libname.ixlibrary $libname.a'
+    # Create ${libname}_ixlibrary.a entries in /sys/libs.
+    finish_eval='for lib in `ls $libdir/*.ixlibrary 2>/dev/null`; do libname=`func_echo_all "$lib" | $SED '\''s%^.*/\([^/]*\)\.ixlibrary$%\1%'\''`; test $RM /sys/libs/${libname}_ixlibrary.a; $show "cd /sys/libs && $LN_S $lib ${libname}_ixlibrary.a"; cd /sys/libs && $LN_S $lib ${libname}_ixlibrary.a || exit 1; done'
+    ;;
+  esac
+  ;;
 
+beos*)
+  library_names_spec='${libname}${shared_ext}'
+  dynamic_linker="$host_os ld.so"
+  shlibpath_var=LIBRARY_PATH
+  ;;
 
+bsdi[45]*)
+  version_type=linux # correct to gnu/linux during the next big refactor
+  need_version=no
+  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
+  soname_spec='${libname}${release}${shared_ext}$major'
+  finish_cmds='PATH="\$PATH:/sbin" ldconfig $libdir'
+  shlibpath_var=LD_LIBRARY_PATH
+  sys_lib_search_path_spec="/shlib /usr/lib /usr/X11/lib /usr/contrib/lib /lib /usr/local/lib"
+  sys_lib_dlsearch_path_spec="/shlib /usr/lib /usr/local/lib"
+  # the default ld.so.conf also contains /usr/contrib/lib and
+  # /usr/X11R6/lib (/usr/X11 is a link to /usr/X11R6), but let us allow
+  # libtool to hard-code these into programs
+  ;;
 
+cygwin* | mingw* | pw32* | cegcc*)
+  version_type=windows
+  shrext_cmds=".dll"
+  need_version=no
+  need_lib_prefix=no
 
+  case $GCC,$cc_basename in
+  yes,*)
+    # gcc
+    library_names_spec='$libname.dll.a'
+    # DLL is installed to $(libdir)/../bin by postinstall_cmds
+    postinstall_cmds='base_file=`basename \${file}`~
+      dlpath=`$SHELL 2>&1 -c '\''. $dir/'\''\${base_file}'\''i; echo \$dlname'\''`~
+      dldir=$destdir/`dirname \$dlpath`~
+      test -d \$dldir || mkdir -p \$dldir~
+      $install_prog $dir/$dlname \$dldir/$dlname~
+      chmod a+x \$dldir/$dlname~
+      if test -n '\''$stripme'\'' && test -n '\''$striplib'\''; then
+        eval '\''$striplib \$dldir/$dlname'\'' || exit \$?;
+      fi'
+    postuninstall_cmds='dldll=`$SHELL 2>&1 -c '\''. $file; echo \$dlname'\''`~
+      dlpath=$dir/\$dldll~
+       $RM \$dlpath'
+    shlibpath_overrides_runpath=yes
 
+    case $host_os in
+    cygwin*)
+      # Cygwin DLLs use 'cyg' prefix rather than 'lib'
+      soname_spec='`echo ${libname} | sed -e 's/^lib/cyg/'``echo ${release} | $SED -e 's/[.]/-/g'`${versuffix}${shared_ext}'
 
+      sys_lib_search_path_spec="$sys_lib_search_path_spec /usr/lib/w32api"
+      ;;
+    mingw* | cegcc*)
+      # MinGW DLLs use traditional 'lib' prefix
+      soname_spec='${libname}`echo ${release} | $SED -e 's/[.]/-/g'`${versuffix}${shared_ext}'
+      ;;
+    pw32*)
+      # pw32 DLLs use 'pw' prefix rather than 'lib'
+      library_names_spec='`echo ${libname} | sed -e 's/^lib/pw/'``echo ${release} | $SED -e 's/[.]/-/g'`${versuffix}${shared_ext}'
+      ;;
+    esac
+    dynamic_linker='Win32 ld.exe'
+    ;;
 
+  *,cl*)
+    # Native MSVC
+    libname_spec='$name'
+    soname_spec='${libname}`echo ${release} | $SED -e 's/[.]/-/g'`${versuffix}${shared_ext}'
+    library_names_spec='${libname}.dll.lib'
+
+    case $build_os in
+    mingw*)
+      sys_lib_search_path_spec=
+      lt_save_ifs=$IFS
+      IFS=';'
+      for lt_path in $LIB
+      do
+        IFS=$lt_save_ifs
+        # Let DOS variable expansion print the short 8.3 style file name.
+        lt_path=`cd "$lt_path" 2>/dev/null && cmd //C "for %i in (".") do @echo %~si"`
+        sys_lib_search_path_spec="$sys_lib_search_path_spec $lt_path"
+      done
+      IFS=$lt_save_ifs
+      # Convert to MSYS style.
+      sys_lib_search_path_spec=`$ECHO "$sys_lib_search_path_spec" | sed -e 's|\\\\|/|g' -e 's| \\([a-zA-Z]\\):| /\\1|g' -e 's|^ ||'`
+      ;;
+    cygwin*)
+      # Convert to unix form, then to dos form, then back to unix form
+      # but this time dos style (no spaces!) so that the unix form looks
+      # like /cygdrive/c/PROGRA~1:/cygdr...
+      sys_lib_search_path_spec=`cygpath --path --unix "$LIB"`
+      sys_lib_search_path_spec=`cygpath --path --dos "$sys_lib_search_path_spec" 2>/dev/null`
+      sys_lib_search_path_spec=`cygpath --path --unix "$sys_lib_search_path_spec" | $SED -e "s/$PATH_SEPARATOR/ /g"`
+      ;;
+    *)
+      sys_lib_search_path_spec="$LIB"
+      if $ECHO "$sys_lib_search_path_spec" | $GREP ';[c-zC-Z]:/' >/dev/null; then
+        # It is most probably a Windows format PATH.
+        sys_lib_search_path_spec=`$ECHO "$sys_lib_search_path_spec" | $SED -e 's/;/ /g'`
+      else
+        sys_lib_search_path_spec=`$ECHO "$sys_lib_search_path_spec" | $SED -e "s/$PATH_SEPARATOR/ /g"`
+      fi
+      # FIXME: find the short name or the path components, as spaces are
+      # common. (e.g. "Program Files" -> "PROGRA~1")
+      ;;
+    esac
 
+    # DLL is installed to $(libdir)/../bin by postinstall_cmds
+    postinstall_cmds='base_file=`basename \${file}`~
+      dlpath=`$SHELL 2>&1 -c '\''. $dir/'\''\${base_file}'\''i; echo \$dlname'\''`~
+      dldir=$destdir/`dirname \$dlpath`~
+      test -d \$dldir || mkdir -p \$dldir~
+      $install_prog $dir/$dlname \$dldir/$dlname'
+    postuninstall_cmds='dldll=`$SHELL 2>&1 -c '\''. $file; echo \$dlname'\''`~
+      dlpath=$dir/\$dldll~
+       $RM \$dlpath'
+    shlibpath_overrides_runpath=yes
+    dynamic_linker='Win32 link.exe'
+    ;;
 
+  *)
+    # Assume MSVC wrapper
+    library_names_spec='${libname}`echo ${release} | $SED -e 's/[.]/-/g'`${versuffix}${shared_ext} $libname.lib'
+    dynamic_linker='Win32 ld.exe'
+    ;;
+  esac
+  # FIXME: first we should search . and the directory the executable is in
+  shlibpath_var=PATH
+  ;;
 
+darwin* | rhapsody*)
+  dynamic_linker="$host_os dyld"
+  version_type=darwin
+  need_lib_prefix=no
+  need_version=no
+  library_names_spec='${libname}${release}${major}$shared_ext ${libname}$shared_ext'
+  soname_spec='${libname}${release}${major}$shared_ext'
+  shlibpath_overrides_runpath=yes
+  shlibpath_var=DYLD_LIBRARY_PATH
+  shrext_cmds='`test .$module = .yes && echo .so || echo .dylib`'
 
+  sys_lib_search_path_spec="$sys_lib_search_path_spec /usr/local/lib"
+  sys_lib_dlsearch_path_spec='/usr/local/lib /lib /usr/lib'
+  ;;
 
+dgux*)
+  version_type=linux # correct to gnu/linux during the next big refactor
+  need_lib_prefix=no
+  need_version=no
+  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname$shared_ext'
+  soname_spec='${libname}${release}${shared_ext}$major'
+  shlibpath_var=LD_LIBRARY_PATH
+  ;;
 
+freebsd* | dragonfly*)
+  # DragonFly does not have aout.  When/if they implement a new
+  # versioning mechanism, adjust this.
+  if test -x /usr/bin/objformat; then
+    objformat=`/usr/bin/objformat`
+  else
+    case $host_os in
+    freebsd[23].*) objformat=aout ;;
+    *) objformat=elf ;;
+    esac
+  fi
+  version_type=freebsd-$objformat
+  case $version_type in
+    freebsd-elf*)
+      library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext} $libname${shared_ext}'
+      need_version=no
+      need_lib_prefix=no
+      ;;
+    freebsd-*)
+      library_names_spec='${libname}${release}${shared_ext}$versuffix $libname${shared_ext}$versuffix'
+      need_version=yes
+      ;;
+  esac
+  shlibpath_var=LD_LIBRARY_PATH
+  case $host_os in
+  freebsd2.*)
+    shlibpath_overrides_runpath=yes
+    ;;
+  freebsd3.[01]* | freebsdelf3.[01]*)
+    shlibpath_overrides_runpath=yes
+    hardcode_into_libs=yes
+    ;;
+  freebsd3.[2-9]* | freebsdelf3.[2-9]* | \
+  freebsd4.[0-5] | freebsdelf4.[0-5] | freebsd4.1.1 | freebsdelf4.1.1)
+    shlibpath_overrides_runpath=no
+    hardcode_into_libs=yes
+    ;;
+  *) # from 4.6 on, and DragonFly
+    shlibpath_overrides_runpath=yes
+    hardcode_into_libs=yes
+    ;;
+  esac
+  ;;
 
+gnu*)
+  version_type=linux # correct to gnu/linux during the next big refactor
+  need_lib_prefix=no
+  need_version=no
+  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}${major} ${libname}${shared_ext}'
+  soname_spec='${libname}${release}${shared_ext}$major'
+  shlibpath_var=LD_LIBRARY_PATH
+  shlibpath_overrides_runpath=no
+  hardcode_into_libs=yes
+  ;;
 
+haiku*)
+  version_type=linux # correct to gnu/linux during the next big refactor
+  need_lib_prefix=no
+  need_version=no
+  dynamic_linker="$host_os runtime_loader"
+  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}${major} ${libname}${shared_ext}'
+  soname_spec='${libname}${release}${shared_ext}$major'
+  shlibpath_var=LIBRARY_PATH
+  shlibpath_overrides_runpath=yes
+  sys_lib_dlsearch_path_spec='/boot/home/config/lib /boot/common/lib /boot/system/lib'
+  hardcode_into_libs=yes
+  ;;
 
-striplib=
-old_striplib=
-{ $as_echo "$as_me:$LINENO: checking whether stripping libraries is possible" >&5
-$as_echo_n "checking whether stripping libraries is possible... " >&6; }
-if test -n "$STRIP" && $STRIP -V 2>&1 | $GREP "GNU strip" >/dev/null; then
-  test -z "$old_striplib" && old_striplib="$STRIP --strip-debug"
-  test -z "$striplib" && striplib="$STRIP --strip-unneeded"
-  { $as_echo "$as_me:$LINENO: result: yes" >&5
-$as_echo "yes" >&6; }
-else
-# FIXME - insert some real tests, host_os isn't really good enough
-  case $host_os in
-  darwin*)
-    if test -n "$STRIP" ; then
-      striplib="$STRIP -x"
-      old_striplib="$STRIP -S"
-      { $as_echo "$as_me:$LINENO: result: yes" >&5
-$as_echo "yes" >&6; }
+hpux9* | hpux10* | hpux11*)
+  # Give a soname corresponding to the major version so that dld.sl refuses to
+  # link against other versions.
+  version_type=sunos
+  need_lib_prefix=no
+  need_version=no
+  case $host_cpu in
+  ia64*)
+    shrext_cmds='.so'
+    hardcode_into_libs=yes
+    dynamic_linker="$host_os dld.so"
+    shlibpath_var=LD_LIBRARY_PATH
+    shlibpath_overrides_runpath=yes # Unless +noenvvar is specified.
+    library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
+    soname_spec='${libname}${release}${shared_ext}$major'
+    if test "X$HPUX_IA64_MODE" = X32; then
+      sys_lib_search_path_spec="/usr/lib/hpux32 /usr/local/lib/hpux32 /usr/local/lib"
     else
-      { $as_echo "$as_me:$LINENO: result: no" >&5
-$as_echo "no" >&6; }
+      sys_lib_search_path_spec="/usr/lib/hpux64 /usr/local/lib/hpux64"
     fi
+    sys_lib_dlsearch_path_spec=$sys_lib_search_path_spec
+    ;;
+  hppa*64*)
+    shrext_cmds='.sl'
+    hardcode_into_libs=yes
+    dynamic_linker="$host_os dld.sl"
+    shlibpath_var=LD_LIBRARY_PATH # How should we handle SHLIB_PATH
+    shlibpath_overrides_runpath=yes # Unless +noenvvar is specified.
+    library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
+    soname_spec='${libname}${release}${shared_ext}$major'
+    sys_lib_search_path_spec="/usr/lib/pa20_64 /usr/ccs/lib/pa20_64"
+    sys_lib_dlsearch_path_spec=$sys_lib_search_path_spec
     ;;
   *)
-    { $as_echo "$as_me:$LINENO: result: no" >&5
-$as_echo "no" >&6; }
+    shrext_cmds='.sl'
+    dynamic_linker="$host_os dld.sl"
+    shlibpath_var=SHLIB_PATH
+    shlibpath_overrides_runpath=no # +s is required to enable SHLIB_PATH
+    library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
+    soname_spec='${libname}${release}${shared_ext}$major'
     ;;
   esac
-fi
-
-
-
-
-
-
-
-
-
-
-
-
-  # Report which library types will actually be built
-  { $as_echo "$as_me:$LINENO: checking if libtool supports shared libraries" >&5
-$as_echo_n "checking if libtool supports shared libraries... " >&6; }
-  { $as_echo "$as_me:$LINENO: result: $can_build_shared" >&5
-$as_echo "$can_build_shared" >&6; }
+  # HP-UX runs *really* slowly unless shared libraries are mode 555, ...
+  postinstall_cmds='chmod 555 $lib'
+  # or fails outright, so override atomically:
+  install_override_mode=555
+  ;;
 
-  { $as_echo "$as_me:$LINENO: checking whether to build shared libraries" >&5
-$as_echo_n "checking whether to build shared libraries... " >&6; }
-  test "$can_build_shared" = "no" && enable_shared=no
+interix[3-9]*)
+  version_type=linux # correct to gnu/linux during the next big refactor
+  need_lib_prefix=no
+  need_version=no
+  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major ${libname}${shared_ext}'
+  soname_spec='${libname}${release}${shared_ext}$major'
+  dynamic_linker='Interix 3.x ld.so.1 (PE, like ELF)'
+  shlibpath_var=LD_LIBRARY_PATH
+  shlibpath_overrides_runpath=no
+  hardcode_into_libs=yes
+  ;;
 
-  # On AIX, shared libraries and static libraries use the same namespace, and
-  # are all built from PIC.
+irix5* | irix6* | nonstopux*)
   case $host_os in
-  aix3*)
-    test "$enable_shared" = yes && enable_static=no
-    if test -n "$RANLIB"; then
-      archive_cmds="$archive_cmds~\$RANLIB \$lib"
-      postinstall_cmds='$RANLIB $lib'
-    fi
+    nonstopux*) version_type=nonstopux ;;
+    *)
+	if test "$lt_cv_prog_gnu_ld" = yes; then
+		version_type=linux # correct to gnu/linux during the next big refactor
+	else
+		version_type=irix
+	fi ;;
+  esac
+  need_lib_prefix=no
+  need_version=no
+  soname_spec='${libname}${release}${shared_ext}$major'
+  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major ${libname}${release}${shared_ext} $libname${shared_ext}'
+  case $host_os in
+  irix5* | nonstopux*)
+    libsuff= shlibsuff=
     ;;
-
-  aix[4-9]*)
-    if test "$host_cpu" != ia64 && test "$aix_use_runtimelinking" = no ; then
-      test "$enable_shared" = yes && enable_static=no
-    fi
+  *)
+    case $LD in # libtool.m4 will add one of these switches to LD
+    *-32|*"-32 "|*-melf32bsmip|*"-melf32bsmip ")
+      libsuff= shlibsuff= libmagic=32-bit;;
+    *-n32|*"-n32 "|*-melf32bmipn32|*"-melf32bmipn32 ")
+      libsuff=32 shlibsuff=N32 libmagic=N32;;
+    *-64|*"-64 "|*-melf64bmip|*"-melf64bmip ")
+      libsuff=64 shlibsuff=64 libmagic=64-bit;;
+    *) libsuff= shlibsuff= libmagic=never-match;;
+    esac
     ;;
   esac
-  { $as_echo "$as_me:$LINENO: result: $enable_shared" >&5
-$as_echo "$enable_shared" >&6; }
+  shlibpath_var=LD_LIBRARY${shlibsuff}_PATH
+  shlibpath_overrides_runpath=no
+  sys_lib_search_path_spec="/usr/lib${libsuff} /lib${libsuff} /usr/local/lib${libsuff}"
+  sys_lib_dlsearch_path_spec="/usr/lib${libsuff} /lib${libsuff}"
+  hardcode_into_libs=yes
+  ;;
 
-  { $as_echo "$as_me:$LINENO: checking whether to build static libraries" >&5
-$as_echo_n "checking whether to build static libraries... " >&6; }
-  # Make sure either enable_shared or enable_static is yes.
-  test "$enable_shared" = yes || enable_static=yes
-  { $as_echo "$as_me:$LINENO: result: $enable_static" >&5
-$as_echo "$enable_static" >&6; }
+# No shared lib support for Linux oldld, aout, or coff.
+linux*oldld* | linux*aout* | linux*coff*)
+  dynamic_linker=no
+  ;;
 
+# This must be glibc/ELF.
+linux* | k*bsd*-gnu | kopensolaris*-gnu)
+  version_type=linux # correct to gnu/linux during the next big refactor
+  need_lib_prefix=no
+  need_version=no
+  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
+  soname_spec='${libname}${release}${shared_ext}$major'
+  finish_cmds='PATH="\$PATH:/sbin" ldconfig -n $libdir'
+  shlibpath_var=LD_LIBRARY_PATH
+  shlibpath_overrides_runpath=no
 
+  # Some binutils ld are patched to set DT_RUNPATH
+  if ${lt_cv_shlibpath_overrides_runpath+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  lt_cv_shlibpath_overrides_runpath=no
+    save_LDFLAGS=$LDFLAGS
+    save_libdir=$libdir
+    eval "libdir=/foo; wl=\"$lt_prog_compiler_wl\"; \
+	 LDFLAGS=\"\$LDFLAGS $hardcode_libdir_flag_spec\""
+    cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
 
+int
+main ()
+{
 
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_link "$LINENO"; then :
+  if  ($OBJDUMP -p conftest$ac_exeext) 2>/dev/null | grep "RUNPATH.*$libdir" >/dev/null; then :
+  lt_cv_shlibpath_overrides_runpath=yes
 fi
-ac_ext=c
-ac_cpp='$CPP $CPPFLAGS'
-ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
-ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
-ac_compiler_gnu=$ac_cv_c_compiler_gnu
-
-CC="$lt_save_CC"
-
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+    LDFLAGS=$save_LDFLAGS
+    libdir=$save_libdir
 
+fi
 
+  shlibpath_overrides_runpath=$lt_cv_shlibpath_overrides_runpath
 
+  # This implies no fast_install, which is unacceptable.
+  # Some rework will be needed to allow for fast_install
+  # before this can be enabled.
+  hardcode_into_libs=yes
 
+  # Add ABI-specific directories to the system library path.
+  sys_lib_dlsearch_path_spec="/lib64 /usr/lib64 /lib /usr/lib"
 
+  # Append ld.so.conf contents to the search path
+  if test -f /etc/ld.so.conf; then
+    lt_ld_extra=`awk '/^include / { system(sprintf("cd /etc; cat %s 2>/dev/null", \$2)); skip = 1; } { if (!skip) print \$0; skip = 0; }' < /etc/ld.so.conf | $SED -e 's/#.*//;/^[	 ]*hwcap[	 ]/d;s/[:,	]/ /g;s/=[^=]*$//;s/=[^= ]* / /g;s/"//g;/^$/d' | tr '\n' ' '`
+    sys_lib_dlsearch_path_spec="$sys_lib_dlsearch_path_spec $lt_ld_extra"
 
+  fi
 
+  # We used to test for /lib/ld.so.1 and disable shared libraries on
+  # powerpc, because MkLinux only supported shared libraries with the
+  # GNU dynamic linker.  Since this was broken with cross compilers,
+  # most powerpc-linux boxes support dynamic linking these days and
+  # people can always --disable-shared, the test was removed, and we
+  # assume the GNU/Linux dynamic linker is in use.
+  dynamic_linker='GNU/Linux ld.so'
+  ;;
 
+netbsd*)
+  version_type=sunos
+  need_lib_prefix=no
+  need_version=no
+  if echo __ELF__ | $CC -E - | $GREP __ELF__ >/dev/null; then
+    library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${shared_ext}$versuffix'
+    finish_cmds='PATH="\$PATH:/sbin" ldconfig -m $libdir'
+    dynamic_linker='NetBSD (a.out) ld.so'
+  else
+    library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major ${libname}${shared_ext}'
+    soname_spec='${libname}${release}${shared_ext}$major'
+    dynamic_linker='NetBSD ld.elf_so'
+  fi
+  shlibpath_var=LD_LIBRARY_PATH
+  shlibpath_overrides_runpath=yes
+  hardcode_into_libs=yes
+  ;;
 
+newsos6)
+  version_type=linux # correct to gnu/linux during the next big refactor
+  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
+  shlibpath_var=LD_LIBRARY_PATH
+  shlibpath_overrides_runpath=yes
+  ;;
 
+*nto* | *qnx*)
+  version_type=qnx
+  need_lib_prefix=no
+  need_version=no
+  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
+  soname_spec='${libname}${release}${shared_ext}$major'
+  shlibpath_var=LD_LIBRARY_PATH
+  shlibpath_overrides_runpath=no
+  hardcode_into_libs=yes
+  dynamic_linker='ldqnx.so'
+  ;;
 
+openbsd*)
+  version_type=sunos
+  sys_lib_dlsearch_path_spec="/usr/lib"
+  need_lib_prefix=no
+  # Some older versions of OpenBSD (3.3 at least) *do* need versioned libs.
+  case $host_os in
+    openbsd3.3 | openbsd3.3.*)	need_version=yes ;;
+    *)				need_version=no  ;;
+  esac
+  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${shared_ext}$versuffix'
+  finish_cmds='PATH="\$PATH:/sbin" ldconfig -m $libdir'
+  shlibpath_var=LD_LIBRARY_PATH
+  if test -z "`echo __ELF__ | $CC -E - | $GREP __ELF__`" || test "$host_os-$host_cpu" = "openbsd2.8-powerpc"; then
+    case $host_os in
+      openbsd2.[89] | openbsd2.[89].*)
+	shlibpath_overrides_runpath=no
+	;;
+      *)
+	shlibpath_overrides_runpath=yes
+	;;
+      esac
+  else
+    shlibpath_overrides_runpath=yes
+  fi
+  ;;
 
-        ac_config_commands="$ac_config_commands libtool"
+os2*)
+  libname_spec='$name'
+  shrext_cmds=".dll"
+  need_lib_prefix=no
+  library_names_spec='$libname${shared_ext} $libname.a'
+  dynamic_linker='OS/2 ld.exe'
+  shlibpath_var=LIBPATH
+  ;;
 
+osf3* | osf4* | osf5*)
+  version_type=osf
+  need_lib_prefix=no
+  need_version=no
+  soname_spec='${libname}${release}${shared_ext}$major'
+  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
+  shlibpath_var=LD_LIBRARY_PATH
+  sys_lib_search_path_spec="/usr/shlib /usr/ccs/lib /usr/lib/cmplrs/cc /usr/lib /usr/local/lib /var/shlib"
+  sys_lib_dlsearch_path_spec="$sys_lib_search_path_spec"
+  ;;
 
+rdos*)
+  dynamic_linker=no
+  ;;
 
+solaris*)
+  version_type=linux # correct to gnu/linux during the next big refactor
+  need_lib_prefix=no
+  need_version=no
+  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
+  soname_spec='${libname}${release}${shared_ext}$major'
+  shlibpath_var=LD_LIBRARY_PATH
+  shlibpath_overrides_runpath=yes
+  hardcode_into_libs=yes
+  # ldd complains unless libraries are executable
+  postinstall_cmds='chmod +x $lib'
+  ;;
 
-# Only expand once:
+sunos4*)
+  version_type=sunos
+  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${shared_ext}$versuffix'
+  finish_cmds='PATH="\$PATH:/usr/etc" ldconfig $libdir'
+  shlibpath_var=LD_LIBRARY_PATH
+  shlibpath_overrides_runpath=yes
+  if test "$with_gnu_ld" = yes; then
+    need_lib_prefix=no
+  fi
+  need_version=yes
+  ;;
 
+sysv4 | sysv4.3*)
+  version_type=linux # correct to gnu/linux during the next big refactor
+  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
+  soname_spec='${libname}${release}${shared_ext}$major'
+  shlibpath_var=LD_LIBRARY_PATH
+  case $host_vendor in
+    sni)
+      shlibpath_overrides_runpath=no
+      need_lib_prefix=no
+      runpath_var=LD_RUN_PATH
+      ;;
+    siemens)
+      need_lib_prefix=no
+      ;;
+    motorola)
+      need_lib_prefix=no
+      need_version=no
+      shlibpath_overrides_runpath=no
+      sys_lib_search_path_spec='/lib /usr/lib /usr/ccs/lib'
+      ;;
+  esac
+  ;;
 
+sysv4*MP*)
+  if test -d /usr/nec ;then
+    version_type=linux # correct to gnu/linux during the next big refactor
+    library_names_spec='$libname${shared_ext}.$versuffix $libname${shared_ext}.$major $libname${shared_ext}'
+    soname_spec='$libname${shared_ext}.$major'
+    shlibpath_var=LD_LIBRARY_PATH
+  fi
+  ;;
 
-ac_ext=c
-ac_cpp='$CPP $CPPFLAGS'
-ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
-ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
-ac_compiler_gnu=$ac_cv_c_compiler_gnu
-if test -n "$ac_tool_prefix"; then
-  # Extract the first word of "${ac_tool_prefix}gcc", so it can be a program name with args.
-set dummy ${ac_tool_prefix}gcc; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
-$as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_CC+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  if test -n "$CC"; then
-  ac_cv_prog_CC="$CC" # Let the user override the test.
-else
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
-    ac_cv_prog_CC="${ac_tool_prefix}gcc"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
+sysv5* | sco3.2v5* | sco5v6* | unixware* | OpenUNIX* | sysv4*uw2*)
+  version_type=freebsd-elf
+  need_lib_prefix=no
+  need_version=no
+  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext} $libname${shared_ext}'
+  soname_spec='${libname}${release}${shared_ext}$major'
+  shlibpath_var=LD_LIBRARY_PATH
+  shlibpath_overrides_runpath=yes
+  hardcode_into_libs=yes
+  if test "$with_gnu_ld" = yes; then
+    sys_lib_search_path_spec='/usr/local/lib /usr/gnu/lib /usr/ccs/lib /usr/lib /lib'
+  else
+    sys_lib_search_path_spec='/usr/ccs/lib /usr/lib'
+    case $host_os in
+      sco3.2v5*)
+        sys_lib_search_path_spec="$sys_lib_search_path_spec /lib"
+	;;
+    esac
   fi
-done
-done
-IFS=$as_save_IFS
+  sys_lib_dlsearch_path_spec='/usr/lib'
+  ;;
 
-fi
-fi
-CC=$ac_cv_prog_CC
-if test -n "$CC"; then
-  { $as_echo "$as_me:$LINENO: result: $CC" >&5
-$as_echo "$CC" >&6; }
-else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
-$as_echo "no" >&6; }
-fi
+tpf*)
+  # TPF is a cross-target only.  Preferred cross-host = GNU/Linux.
+  version_type=linux # correct to gnu/linux during the next big refactor
+  need_lib_prefix=no
+  need_version=no
+  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
+  shlibpath_var=LD_LIBRARY_PATH
+  shlibpath_overrides_runpath=no
+  hardcode_into_libs=yes
+  ;;
+
+uts4*)
+  version_type=linux # correct to gnu/linux during the next big refactor
+  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
+  soname_spec='${libname}${release}${shared_ext}$major'
+  shlibpath_var=LD_LIBRARY_PATH
+  ;;
 
+*)
+  dynamic_linker=no
+  ;;
+esac
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $dynamic_linker" >&5
+$as_echo "$dynamic_linker" >&6; }
+test "$dynamic_linker" = no && can_build_shared=no
 
+variables_saved_for_relink="PATH $shlibpath_var $runpath_var"
+if test "$GCC" = yes; then
+  variables_saved_for_relink="$variables_saved_for_relink GCC_EXEC_PREFIX COMPILER_PATH LIBRARY_PATH"
 fi
-if test -z "$ac_cv_prog_CC"; then
-  ac_ct_CC=$CC
-  # Extract the first word of "gcc", so it can be a program name with args.
-set dummy gcc; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
-$as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_ac_ct_CC+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  if test -n "$ac_ct_CC"; then
-  ac_cv_prog_ac_ct_CC="$ac_ct_CC" # Let the user override the test.
-else
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
-    ac_cv_prog_ac_ct_CC="gcc"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
-  fi
-done
-done
-IFS=$as_save_IFS
 
+if test "${lt_cv_sys_lib_search_path_spec+set}" = set; then
+  sys_lib_search_path_spec="$lt_cv_sys_lib_search_path_spec"
 fi
-fi
-ac_ct_CC=$ac_cv_prog_ac_ct_CC
-if test -n "$ac_ct_CC"; then
-  { $as_echo "$as_me:$LINENO: result: $ac_ct_CC" >&5
-$as_echo "$ac_ct_CC" >&6; }
-else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
-$as_echo "no" >&6; }
+if test "${lt_cv_sys_lib_dlsearch_path_spec+set}" = set; then
+  sys_lib_dlsearch_path_spec="$lt_cv_sys_lib_dlsearch_path_spec"
 fi
 
-  if test "x$ac_ct_CC" = x; then
-    CC=""
-  else
-    case $cross_compiling:$ac_tool_warned in
-yes:)
-{ $as_echo "$as_me:$LINENO: WARNING: using cross tools not prefixed with host triplet" >&5
-$as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
-ac_tool_warned=yes ;;
-esac
-    CC=$ac_ct_CC
-  fi
-else
-  CC="$ac_cv_prog_CC"
-fi
 
-if test -z "$CC"; then
-          if test -n "$ac_tool_prefix"; then
-    # Extract the first word of "${ac_tool_prefix}cc", so it can be a program name with args.
-set dummy ${ac_tool_prefix}cc; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
-$as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_CC+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  if test -n "$CC"; then
-  ac_cv_prog_CC="$CC" # Let the user override the test.
-else
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
-    ac_cv_prog_CC="${ac_tool_prefix}cc"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
-  fi
-done
-done
-IFS=$as_save_IFS
 
-fi
-fi
-CC=$ac_cv_prog_CC
-if test -n "$CC"; then
-  { $as_echo "$as_me:$LINENO: result: $CC" >&5
-$as_echo "$CC" >&6; }
-else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
-$as_echo "no" >&6; }
-fi
 
 
-  fi
-fi
-if test -z "$CC"; then
-  # Extract the first word of "cc", so it can be a program name with args.
-set dummy cc; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
-$as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_CC+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  if test -n "$CC"; then
-  ac_cv_prog_CC="$CC" # Let the user override the test.
-else
-  ac_prog_rejected=no
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
-    if test "$as_dir/$ac_word$ac_exec_ext" = "/usr/ucb/cc"; then
-       ac_prog_rejected=yes
-       continue
-     fi
-    ac_cv_prog_CC="cc"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
-  fi
-done
-done
-IFS=$as_save_IFS
 
-if test $ac_prog_rejected = yes; then
-  # We found a bogon in the path, so make sure we never use it.
-  set dummy $ac_cv_prog_CC
-  shift
-  if test $# != 0; then
-    # We chose a different compiler from the bogus one.
-    # However, it has the same basename, so the bogon will be chosen
-    # first if we set CC to just the basename; use the full file name.
-    shift
-    ac_cv_prog_CC="$as_dir/$ac_word${1+' '}$@"
-  fi
-fi
-fi
-fi
-CC=$ac_cv_prog_CC
-if test -n "$CC"; then
-  { $as_echo "$as_me:$LINENO: result: $CC" >&5
-$as_echo "$CC" >&6; }
-else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
-$as_echo "no" >&6; }
-fi
 
 
-fi
-if test -z "$CC"; then
-  if test -n "$ac_tool_prefix"; then
-  for ac_prog in cl.exe
-  do
-    # Extract the first word of "$ac_tool_prefix$ac_prog", so it can be a program name with args.
-set dummy $ac_tool_prefix$ac_prog; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
-$as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_CC+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  if test -n "$CC"; then
-  ac_cv_prog_CC="$CC" # Let the user override the test.
-else
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
-    ac_cv_prog_CC="$ac_tool_prefix$ac_prog"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
-  fi
-done
-done
-IFS=$as_save_IFS
 
-fi
-fi
-CC=$ac_cv_prog_CC
-if test -n "$CC"; then
-  { $as_echo "$as_me:$LINENO: result: $CC" >&5
-$as_echo "$CC" >&6; }
-else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
-$as_echo "no" >&6; }
-fi
 
 
-    test -n "$CC" && break
-  done
-fi
-if test -z "$CC"; then
-  ac_ct_CC=$CC
-  for ac_prog in cl.exe
-do
-  # Extract the first word of "$ac_prog", so it can be a program name with args.
-set dummy $ac_prog; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
-$as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_ac_ct_CC+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  if test -n "$ac_ct_CC"; then
-  ac_cv_prog_ac_ct_CC="$ac_ct_CC" # Let the user override the test.
-else
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
-    ac_cv_prog_ac_ct_CC="$ac_prog"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
-  fi
-done
-done
-IFS=$as_save_IFS
 
-fi
-fi
-ac_ct_CC=$ac_cv_prog_ac_ct_CC
-if test -n "$ac_ct_CC"; then
-  { $as_echo "$as_me:$LINENO: result: $ac_ct_CC" >&5
-$as_echo "$ac_ct_CC" >&6; }
-else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
-$as_echo "no" >&6; }
-fi
 
 
-  test -n "$ac_ct_CC" && break
-done
 
-  if test "x$ac_ct_CC" = x; then
-    CC=""
-  else
-    case $cross_compiling:$ac_tool_warned in
-yes:)
-{ $as_echo "$as_me:$LINENO: WARNING: using cross tools not prefixed with host triplet" >&5
-$as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
-ac_tool_warned=yes ;;
-esac
-    CC=$ac_ct_CC
-  fi
-fi
 
-fi
 
 
-test -z "$CC" && { { $as_echo "$as_me:$LINENO: error: in \`$ac_pwd':" >&5
-$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-{ { $as_echo "$as_me:$LINENO: error: no acceptable C compiler found in \$PATH
-See \`config.log' for more details." >&5
-$as_echo "$as_me: error: no acceptable C compiler found in \$PATH
-See \`config.log' for more details." >&2;}
-   { (exit 1); exit 1; }; }; }
 
-# Provide some information about the compiler.
-$as_echo "$as_me:$LINENO: checking for C compiler version" >&5
-set X $ac_compile
-ac_compiler=$2
-{ (ac_try="$ac_compiler --version >&5"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compiler --version >&5") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }
-{ (ac_try="$ac_compiler -v >&5"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compiler -v >&5") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }
-{ (ac_try="$ac_compiler -V >&5"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compiler -V >&5") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }
 
-{ $as_echo "$as_me:$LINENO: checking whether we are using the GNU C compiler" >&5
-$as_echo_n "checking whether we are using the GNU C compiler... " >&6; }
-if test "${ac_cv_c_compiler_gnu+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
 
-int
-main ()
-{
-#ifndef __GNUC__
-       choke me
-#endif
 
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_compiler_gnu=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
 
-	ac_compiler_gnu=no
-fi
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-ac_cv_c_compiler_gnu=$ac_compiler_gnu
 
-fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_c_compiler_gnu" >&5
-$as_echo "$ac_cv_c_compiler_gnu" >&6; }
-if test $ac_compiler_gnu = yes; then
-  GCC=yes
-else
-  GCC=
-fi
-ac_test_CFLAGS=${CFLAGS+set}
-ac_save_CFLAGS=$CFLAGS
-{ $as_echo "$as_me:$LINENO: checking whether $CC accepts -g" >&5
-$as_echo_n "checking whether $CC accepts -g... " >&6; }
-if test "${ac_cv_prog_cc_g+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  ac_save_c_werror_flag=$ac_c_werror_flag
-   ac_c_werror_flag=yes
-   ac_cv_prog_cc_g=no
-   CFLAGS="-g"
-   cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
 
-int
-main ()
-{
 
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_cv_prog_cc_g=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
 
-	CFLAGS=""
-      cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
 
-int
-main ()
-{
 
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  :
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
 
-	ac_c_werror_flag=$ac_save_c_werror_flag
-	 CFLAGS="-g"
-	 cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
 
-int
-main ()
-{
 
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_cv_prog_cc_g=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
 
 
-fi
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-fi
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-fi
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-   ac_c_werror_flag=$ac_save_c_werror_flag
-fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_prog_cc_g" >&5
-$as_echo "$ac_cv_prog_cc_g" >&6; }
-if test "$ac_test_CFLAGS" = set; then
-  CFLAGS=$ac_save_CFLAGS
-elif test $ac_cv_prog_cc_g = yes; then
-  if test "$GCC" = yes; then
-    CFLAGS="-g -O2"
-  else
-    CFLAGS="-g"
-  fi
-else
-  if test "$GCC" = yes; then
-    CFLAGS="-O2"
-  else
-    CFLAGS=
-  fi
-fi
-{ $as_echo "$as_me:$LINENO: checking for $CC option to accept ISO C89" >&5
-$as_echo_n "checking for $CC option to accept ISO C89... " >&6; }
-if test "${ac_cv_prog_cc_c89+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  ac_cv_prog_cc_c89=no
-ac_save_CC=$CC
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <stdarg.h>
-#include <stdio.h>
-#include <sys/types.h>
-#include <sys/stat.h>
-/* Most of the following tests are stolen from RCS 5.7's src/conf.sh.  */
-struct buf { int x; };
-FILE * (*rcsopen) (struct buf *, struct stat *, int);
-static char *e (p, i)
-     char **p;
-     int i;
-{
-  return p[i];
-}
-static char *f (char * (*g) (char **, int), char **p, ...)
-{
-  char *s;
-  va_list v;
-  va_start (v,p);
-  s = g (p, va_arg (v,int));
-  va_end (v);
-  return s;
-}
 
-/* OSF 4.0 Compaq cc is some sort of almost-ANSI by default.  It has
-   function prototypes and stuff, but not '\xHH' hex character constants.
-   These don't provoke an error unfortunately, instead are silently treated
-   as 'x'.  The following induces an error, until -std is added to get
-   proper ANSI mode.  Curiously '\x00'!='x' always comes out true, for an
-   array size at least.  It's necessary to write '\x00'==0 to get something
-   that's true only with -std.  */
-int osf4_cc_array ['\x00' == 0 ? 1 : -1];
 
-/* IBM C 6 for AIX is almost-ANSI by default, but it replaces macro parameters
-   inside strings and character constants.  */
-#define FOO(x) 'x'
-int xlc6_cc_array[FOO(a) == 'x' ? 1 : -1];
 
-int test (int i, double x);
-struct s1 {int (*f) (int a);};
-struct s2 {int (*f) (double a);};
-int pairnames (int, char **, FILE *(*)(struct buf *, struct stat *, int), int, int);
-int argc;
-char **argv;
-int
-main ()
-{
-return f (e, argv, 0) != argv[0]  ||  f (e, argv, 1) != argv[1];
-  ;
-  return 0;
-}
-_ACEOF
-for ac_arg in '' -qlanglvl=extc89 -qlanglvl=ansi -std \
-	-Ae "-Aa -D_HPUX_SOURCE" "-Xc -D__EXTENSIONS__"
-do
-  CC="$ac_save_CC $ac_arg"
-  rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_cv_prog_cc_c89=$ac_arg
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
 
 
-fi
 
-rm -f core conftest.err conftest.$ac_objext
-  test "x$ac_cv_prog_cc_c89" != "xno" && break
-done
-rm -f conftest.$ac_ext
-CC=$ac_save_CC
 
-fi
-# AC_CACHE_VAL
-case "x$ac_cv_prog_cc_c89" in
-  x)
-    { $as_echo "$as_me:$LINENO: result: none needed" >&5
-$as_echo "none needed" >&6; } ;;
-  xno)
-    { $as_echo "$as_me:$LINENO: result: unsupported" >&5
-$as_echo "unsupported" >&6; } ;;
-  *)
-    CC="$CC $ac_cv_prog_cc_c89"
-    { $as_echo "$as_me:$LINENO: result: $ac_cv_prog_cc_c89" >&5
-$as_echo "$ac_cv_prog_cc_c89" >&6; } ;;
-esac
 
 
-ac_ext=c
-ac_cpp='$CPP $CPPFLAGS'
-ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
-ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
-ac_compiler_gnu=$ac_cv_c_compiler_gnu
 
-if test $cross_compiling = no; then
-  BUILD_CC="$CC"
 
-else
-  for ac_prog in gcc cc
-do
-  # Extract the first word of "$ac_prog", so it can be a program name with args.
-set dummy $ac_prog; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
-$as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_BUILD_CC+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  if test -n "$BUILD_CC"; then
-  ac_cv_prog_BUILD_CC="$BUILD_CC" # Let the user override the test.
-else
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
-    ac_cv_prog_BUILD_CC="$ac_prog"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
-  fi
-done
-done
-IFS=$as_save_IFS
 
-fi
-fi
-BUILD_CC=$ac_cv_prog_BUILD_CC
-if test -n "$BUILD_CC"; then
-  { $as_echo "$as_me:$LINENO: result: $BUILD_CC" >&5
-$as_echo "$BUILD_CC" >&6; }
-else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
-$as_echo "no" >&6; }
-fi
 
 
-  test -n "$BUILD_CC" && break
-done
 
-fi
 
-# Check whether --enable-shared was given.
-if test "${enable_shared+set}" = set; then
-  enableval=$enable_shared;
-else
-  enable_shared=yes
-fi
 
 
 
-# Check whether --enable-gettext was given.
-if test "${enable_gettext+set}" = set; then
-  enableval=$enable_gettext;
-else
-  enable_gettext=yes
-fi
 
 
 
-# Check whether --enable-blkid was given.
-if test "${enable_blkid+set}" = set; then
-  enableval=$enable_blkid;
-else
-  enable_blkid=yes
-fi
 
 
 
-# Check whether --enable-readline was given.
-if test "${enable_readline+set}" = set; then
-  enableval=$enable_readline; test $enable_readline = yes && libreadline="-lreadline"
-else
-  enable_readline=no
-fi
 
 
 
 
-# Check whether --enable-editline was given.
-if test "${enable_editline+set}" = set; then
-  enableval=$enable_editline; test $enable_editline = yes && libeditline="-ledit"
-else
-  enable_editline=no
-fi
 
 
 
 
-# Check whether --enable-termcap was given.
-if test "${enable_termcap+set}" = set; then
-  enableval=$enable_termcap; test $enable_termcap = yes && libtermcap="-ltermcap"
-fi
 
 
 
 
-# Check whether --enable-lib64 was given.
-if test "${enable_lib64+set}" = set; then
-  enableval=$enable_lib64;
-else
-  enable_lib64=yes
-fi
 
 
 
-# Check whether --enable-librt was given.
-if test "${enable_librt+set}" = set; then
-  enableval=$enable_librt;
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking how to hardcode library paths into programs" >&5
+$as_echo_n "checking how to hardcode library paths into programs... " >&6; }
+hardcode_action=
+if test -n "$hardcode_libdir_flag_spec" ||
+   test -n "$runpath_var" ||
+   test "X$hardcode_automatic" = "Xyes" ; then
+
+  # We can hardcode non-existent directories.
+  if test "$hardcode_direct" != no &&
+     # If the only mechanism to avoid hardcoding is shlibpath_var, we
+     # have to relink, otherwise we might link with an installed library
+     # when we should be linking with a yet-to-be-installed one
+     ## test "$_LT_TAGVAR(hardcode_shlibpath_var, )" != no &&
+     test "$hardcode_minus_L" != no; then
+    # Linking always hardcodes the temporary library directory.
+    hardcode_action=relink
+  else
+    # We can link without hardcoding, and we can hardcode nonexisting dirs.
+    hardcode_action=immediate
+  fi
 else
-  enable_librt=yes
+  # We cannot hardcode anything, or else we can only hardcode existing
+  # directories.
+  hardcode_action=unsupported
 fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $hardcode_action" >&5
+$as_echo "$hardcode_action" >&6; }
 
+if test "$hardcode_action" = relink ||
+   test "$inherit_rpath" = yes; then
+  # Fast installation is not supported
+  enable_fast_install=no
+elif test "$shlibpath_overrides_runpath" = yes ||
+     test "$enable_shared" = no; then
+  # Fast installation is not necessary
+  enable_fast_install=needless
+fi
 
 
-#
-# If the user specified a libdir ending in lib64 do not append another
-# 64 to the library names.
-#
-base_libdir=`basename "$libdir"`
-case $base_libdir in
-lib64)
-  enable_lib64=no
-esac
 
-#
-# Some important tools should be installed into the root partitions.
-#
-# Check whether exec_prefix=/usr: and install them to /sbin in that
-# case.  If the user choses a different prefix assume he just wants
-# a local install for testing and not a system install.
-#
-case $exec_prefix:$prefix in
-NONE:NONE | NONE:/usr | /usr:*)
-  root_sbindir='/sbin'
-  root_libdir="/${base_libdir}"
-  ;;
-*)
-  root_sbindir="${sbindir}"
-  root_libdir="${libdir}"
-  ;;
-esac
 
 
 
+  if test "x$enable_dlopen" != xyes; then
+  enable_dlopen=unknown
+  enable_dlopen_self=unknown
+  enable_dlopen_self_static=unknown
+else
+  lt_cv_dlopen=no
+  lt_cv_dlopen_libs=
 
-# Find localized files.  Don't descend into any "dot directories"
-# (like .git or .pc from quilt).  Strangely, the "-print" argument
-# to "find" is required, to avoid including such directories in the
-# list.
-LOCALIZED_FILES=""
-for lfile in `find ${srcdir} -path './.??*' -prune -o -name '*.c' -type f -print || exit 1`; do
-    LOCALIZED_FILES="$LOCALIZED_FILES \$(TOPDIR)/$lfile"
-done
+  case $host_os in
+  beos*)
+    lt_cv_dlopen="load_add_on"
+    lt_cv_dlopen_libs=
+    lt_cv_dlopen_self=yes
+    ;;
 
+  mingw* | pw32* | cegcc*)
+    lt_cv_dlopen="LoadLibrary"
+    lt_cv_dlopen_libs=
+    ;;
 
- pkg_name="xfsprogs"
+  cygwin*)
+    lt_cv_dlopen="dlopen"
+    lt_cv_dlopen_libs=
+    ;;
 
+  darwin*)
+  # if libdl is installed we need to link against it
+    { $as_echo "$as_me:${as_lineno-$LINENO}: checking for dlopen in -ldl" >&5
+$as_echo_n "checking for dlopen in -ldl... " >&6; }
+if ${ac_cv_lib_dl_dlopen+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-ldl  $LIBS"
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
 
-    ac_ext=c
-ac_cpp='$CPP $CPPFLAGS'
-ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
-ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
-ac_compiler_gnu=$ac_cv_c_compiler_gnu
-if test -n "$ac_tool_prefix"; then
-  # Extract the first word of "${ac_tool_prefix}gcc", so it can be a program name with args.
-set dummy ${ac_tool_prefix}gcc; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
-$as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_CC+set}" = set; then
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+char dlopen ();
+int
+main ()
+{
+return dlopen ();
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_link "$LINENO"; then :
+  ac_cv_lib_dl_dlopen=yes
+else
+  ac_cv_lib_dl_dlopen=no
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_dl_dlopen" >&5
+$as_echo "$ac_cv_lib_dl_dlopen" >&6; }
+if test "x$ac_cv_lib_dl_dlopen" = xyes; then :
+  lt_cv_dlopen="dlopen" lt_cv_dlopen_libs="-ldl"
+else
+
+    lt_cv_dlopen="dyld"
+    lt_cv_dlopen_libs=
+    lt_cv_dlopen_self=yes
+
+fi
+
+    ;;
+
+  *)
+    ac_fn_c_check_func "$LINENO" "shl_load" "ac_cv_func_shl_load"
+if test "x$ac_cv_func_shl_load" = xyes; then :
+  lt_cv_dlopen="shl_load"
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for shl_load in -ldld" >&5
+$as_echo_n "checking for shl_load in -ldld... " >&6; }
+if ${ac_cv_lib_dld_shl_load+:} false; then :
   $as_echo_n "(cached) " >&6
 else
-  if test -n "$CC"; then
-  ac_cv_prog_CC="$CC" # Let the user override the test.
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-ldld  $LIBS"
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+char shl_load ();
+int
+main ()
+{
+return shl_load ();
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_link "$LINENO"; then :
+  ac_cv_lib_dld_shl_load=yes
 else
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
-    ac_cv_prog_CC="${ac_tool_prefix}gcc"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
-  fi
-done
-done
-IFS=$as_save_IFS
+  ac_cv_lib_dld_shl_load=no
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_dld_shl_load" >&5
+$as_echo "$ac_cv_lib_dld_shl_load" >&6; }
+if test "x$ac_cv_lib_dld_shl_load" = xyes; then :
+  lt_cv_dlopen="shl_load" lt_cv_dlopen_libs="-ldld"
+else
+  ac_fn_c_check_func "$LINENO" "dlopen" "ac_cv_func_dlopen"
+if test "x$ac_cv_func_dlopen" = xyes; then :
+  lt_cv_dlopen="dlopen"
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for dlopen in -ldl" >&5
+$as_echo_n "checking for dlopen in -ldl... " >&6; }
+if ${ac_cv_lib_dl_dlopen+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-ldl  $LIBS"
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
 
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+char dlopen ();
+int
+main ()
+{
+return dlopen ();
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_link "$LINENO"; then :
+  ac_cv_lib_dl_dlopen=yes
+else
+  ac_cv_lib_dl_dlopen=no
 fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
 fi
-CC=$ac_cv_prog_CC
-if test -n "$CC"; then
-  { $as_echo "$as_me:$LINENO: result: $CC" >&5
-$as_echo "$CC" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_dl_dlopen" >&5
+$as_echo "$ac_cv_lib_dl_dlopen" >&6; }
+if test "x$ac_cv_lib_dl_dlopen" = xyes; then :
+  lt_cv_dlopen="dlopen" lt_cv_dlopen_libs="-ldl"
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for dlopen in -lsvld" >&5
+$as_echo_n "checking for dlopen in -lsvld... " >&6; }
+if ${ac_cv_lib_svld_dlopen+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-lsvld  $LIBS"
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+char dlopen ();
+int
+main ()
+{
+return dlopen ();
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_link "$LINENO"; then :
+  ac_cv_lib_svld_dlopen=yes
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
-$as_echo "no" >&6; }
+  ac_cv_lib_svld_dlopen=no
 fi
-
-
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
 fi
-if test -z "$ac_cv_prog_CC"; then
-  ac_ct_CC=$CC
-  # Extract the first word of "gcc", so it can be a program name with args.
-set dummy gcc; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
-$as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_ac_ct_CC+set}" = set; then
-  $as_echo_n "(cached) " >&6
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_svld_dlopen" >&5
+$as_echo "$ac_cv_lib_svld_dlopen" >&6; }
+if test "x$ac_cv_lib_svld_dlopen" = xyes; then :
+  lt_cv_dlopen="dlopen" lt_cv_dlopen_libs="-lsvld"
 else
-  if test -n "$ac_ct_CC"; then
-  ac_cv_prog_ac_ct_CC="$ac_ct_CC" # Let the user override the test.
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for dld_link in -ldld" >&5
+$as_echo_n "checking for dld_link in -ldld... " >&6; }
+if ${ac_cv_lib_dld_dld_link+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
-    ac_cv_prog_ac_ct_CC="gcc"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
-  fi
-done
-done
-IFS=$as_save_IFS
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-ldld  $LIBS"
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
 
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+char dld_link ();
+int
+main ()
+{
+return dld_link ();
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_link "$LINENO"; then :
+  ac_cv_lib_dld_dld_link=yes
+else
+  ac_cv_lib_dld_dld_link=no
 fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
 fi
-ac_ct_CC=$ac_cv_prog_ac_ct_CC
-if test -n "$ac_ct_CC"; then
-  { $as_echo "$as_me:$LINENO: result: $ac_ct_CC" >&5
-$as_echo "$ac_ct_CC" >&6; }
-else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
-$as_echo "no" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_dld_dld_link" >&5
+$as_echo "$ac_cv_lib_dld_dld_link" >&6; }
+if test "x$ac_cv_lib_dld_dld_link" = xyes; then :
+  lt_cv_dlopen="dld_link" lt_cv_dlopen_libs="-ldld"
 fi
 
-  if test "x$ac_ct_CC" = x; then
-    CC=""
-  else
-    case $cross_compiling:$ac_tool_warned in
-yes:)
-{ $as_echo "$as_me:$LINENO: WARNING: using cross tools not prefixed with host triplet" >&5
-$as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
-ac_tool_warned=yes ;;
-esac
-    CC=$ac_ct_CC
-  fi
-else
-  CC="$ac_cv_prog_CC"
+
 fi
 
-if test -z "$CC"; then
-          if test -n "$ac_tool_prefix"; then
-    # Extract the first word of "${ac_tool_prefix}cc", so it can be a program name with args.
-set dummy ${ac_tool_prefix}cc; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
-$as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_CC+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  if test -n "$CC"; then
-  ac_cv_prog_CC="$CC" # Let the user override the test.
-else
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
-    ac_cv_prog_CC="${ac_tool_prefix}cc"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
-  fi
-done
-done
-IFS=$as_save_IFS
 
 fi
+
+
 fi
-CC=$ac_cv_prog_CC
-if test -n "$CC"; then
-  { $as_echo "$as_me:$LINENO: result: $CC" >&5
-$as_echo "$CC" >&6; }
-else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
-$as_echo "no" >&6; }
+
+
 fi
 
 
-  fi
 fi
-if test -z "$CC"; then
-  # Extract the first word of "cc", so it can be a program name with args.
-set dummy cc; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
-$as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_CC+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  if test -n "$CC"; then
-  ac_cv_prog_CC="$CC" # Let the user override the test.
-else
-  ac_prog_rejected=no
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
-    if test "$as_dir/$ac_word$ac_exec_ext" = "/usr/ucb/cc"; then
-       ac_prog_rejected=yes
-       continue
-     fi
-    ac_cv_prog_CC="cc"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
-  fi
-done
-done
-IFS=$as_save_IFS
 
-if test $ac_prog_rejected = yes; then
-  # We found a bogon in the path, so make sure we never use it.
-  set dummy $ac_cv_prog_CC
-  shift
-  if test $# != 0; then
-    # We chose a different compiler from the bogus one.
-    # However, it has the same basename, so the bogon will be chosen
-    # first if we set CC to just the basename; use the full file name.
-    shift
-    ac_cv_prog_CC="$as_dir/$ac_word${1+' '}$@"
+    ;;
+  esac
+
+  if test "x$lt_cv_dlopen" != xno; then
+    enable_dlopen=yes
+  else
+    enable_dlopen=no
   fi
-fi
-fi
-fi
-CC=$ac_cv_prog_CC
-if test -n "$CC"; then
-  { $as_echo "$as_me:$LINENO: result: $CC" >&5
-$as_echo "$CC" >&6; }
-else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
-$as_echo "no" >&6; }
-fi
 
+  case $lt_cv_dlopen in
+  dlopen)
+    save_CPPFLAGS="$CPPFLAGS"
+    test "x$ac_cv_header_dlfcn_h" = xyes && CPPFLAGS="$CPPFLAGS -DHAVE_DLFCN_H"
 
-fi
-if test -z "$CC"; then
-  if test -n "$ac_tool_prefix"; then
-  for ac_prog in cl.exe
-  do
-    # Extract the first word of "$ac_tool_prefix$ac_prog", so it can be a program name with args.
-set dummy $ac_tool_prefix$ac_prog; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
-$as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_CC+set}" = set; then
+    save_LDFLAGS="$LDFLAGS"
+    wl=$lt_prog_compiler_wl eval LDFLAGS=\"\$LDFLAGS $export_dynamic_flag_spec\"
+
+    save_LIBS="$LIBS"
+    LIBS="$lt_cv_dlopen_libs $LIBS"
+
+    { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether a program can dlopen itself" >&5
+$as_echo_n "checking whether a program can dlopen itself... " >&6; }
+if ${lt_cv_dlopen_self+:} false; then :
   $as_echo_n "(cached) " >&6
 else
-  if test -n "$CC"; then
-  ac_cv_prog_CC="$CC" # Let the user override the test.
+  	  if test "$cross_compiling" = yes; then :
+  lt_cv_dlopen_self=cross
 else
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
-    ac_cv_prog_CC="$ac_tool_prefix$ac_prog"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
+  lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2
+  lt_status=$lt_dlunknown
+  cat > conftest.$ac_ext <<_LT_EOF
+#line $LINENO "configure"
+#include "confdefs.h"
+
+#if HAVE_DLFCN_H
+#include <dlfcn.h>
+#endif
+
+#include <stdio.h>
+
+#ifdef RTLD_GLOBAL
+#  define LT_DLGLOBAL		RTLD_GLOBAL
+#else
+#  ifdef DL_GLOBAL
+#    define LT_DLGLOBAL		DL_GLOBAL
+#  else
+#    define LT_DLGLOBAL		0
+#  endif
+#endif
+
+/* We may have to define LT_DLLAZY_OR_NOW in the command line if we
+   find out it does not work in some platform. */
+#ifndef LT_DLLAZY_OR_NOW
+#  ifdef RTLD_LAZY
+#    define LT_DLLAZY_OR_NOW		RTLD_LAZY
+#  else
+#    ifdef DL_LAZY
+#      define LT_DLLAZY_OR_NOW		DL_LAZY
+#    else
+#      ifdef RTLD_NOW
+#        define LT_DLLAZY_OR_NOW	RTLD_NOW
+#      else
+#        ifdef DL_NOW
+#          define LT_DLLAZY_OR_NOW	DL_NOW
+#        else
+#          define LT_DLLAZY_OR_NOW	0
+#        endif
+#      endif
+#    endif
+#  endif
+#endif
+
+/* When -fvisbility=hidden is used, assume the code has been annotated
+   correspondingly for the symbols needed.  */
+#if defined(__GNUC__) && (((__GNUC__ == 3) && (__GNUC_MINOR__ >= 3)) || (__GNUC__ > 3))
+int fnord () __attribute__((visibility("default")));
+#endif
+
+int fnord () { return 42; }
+int main ()
+{
+  void *self = dlopen (0, LT_DLGLOBAL|LT_DLLAZY_OR_NOW);
+  int status = $lt_dlunknown;
+
+  if (self)
+    {
+      if (dlsym (self,"fnord"))       status = $lt_dlno_uscore;
+      else
+        {
+	  if (dlsym( self,"_fnord"))  status = $lt_dlneed_uscore;
+          else puts (dlerror ());
+	}
+      /* dlclose (self); */
+    }
+  else
+    puts (dlerror ());
+
+  return status;
+}
+_LT_EOF
+  if { { eval echo "\"\$as_me\":${as_lineno-$LINENO}: \"$ac_link\""; } >&5
+  (eval $ac_link) 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; } && test -s conftest${ac_exeext} 2>/dev/null; then
+    (./conftest; exit; ) >&5 2>/dev/null
+    lt_status=$?
+    case x$lt_status in
+      x$lt_dlno_uscore) lt_cv_dlopen_self=yes ;;
+      x$lt_dlneed_uscore) lt_cv_dlopen_self=yes ;;
+      x$lt_dlunknown|x*) lt_cv_dlopen_self=no ;;
+    esac
+  else :
+    # compilation failed
+    lt_cv_dlopen_self=no
   fi
-done
-done
-IFS=$as_save_IFS
-
-fi
-fi
-CC=$ac_cv_prog_CC
-if test -n "$CC"; then
-  { $as_echo "$as_me:$LINENO: result: $CC" >&5
-$as_echo "$CC" >&6; }
-else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
-$as_echo "no" >&6; }
 fi
+rm -fr conftest*
 
 
-    test -n "$CC" && break
-  done
 fi
-if test -z "$CC"; then
-  ac_ct_CC=$CC
-  for ac_prog in cl.exe
-do
-  # Extract the first word of "$ac_prog", so it can be a program name with args.
-set dummy $ac_prog; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
-$as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_ac_ct_CC+set}" = set; then
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_dlopen_self" >&5
+$as_echo "$lt_cv_dlopen_self" >&6; }
+
+    if test "x$lt_cv_dlopen_self" = xyes; then
+      wl=$lt_prog_compiler_wl eval LDFLAGS=\"\$LDFLAGS $lt_prog_compiler_static\"
+      { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether a statically linked program can dlopen itself" >&5
+$as_echo_n "checking whether a statically linked program can dlopen itself... " >&6; }
+if ${lt_cv_dlopen_self_static+:} false; then :
   $as_echo_n "(cached) " >&6
 else
-  if test -n "$ac_ct_CC"; then
-  ac_cv_prog_ac_ct_CC="$ac_ct_CC" # Let the user override the test.
+  	  if test "$cross_compiling" = yes; then :
+  lt_cv_dlopen_self_static=cross
 else
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
-    ac_cv_prog_ac_ct_CC="$ac_prog"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
-  fi
-done
-done
-IFS=$as_save_IFS
+  lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2
+  lt_status=$lt_dlunknown
+  cat > conftest.$ac_ext <<_LT_EOF
+#line $LINENO "configure"
+#include "confdefs.h"
 
-fi
-fi
-ac_ct_CC=$ac_cv_prog_ac_ct_CC
-if test -n "$ac_ct_CC"; then
-  { $as_echo "$as_me:$LINENO: result: $ac_ct_CC" >&5
-$as_echo "$ac_ct_CC" >&6; }
-else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
-$as_echo "no" >&6; }
-fi
+#if HAVE_DLFCN_H
+#include <dlfcn.h>
+#endif
 
+#include <stdio.h>
 
-  test -n "$ac_ct_CC" && break
-done
+#ifdef RTLD_GLOBAL
+#  define LT_DLGLOBAL		RTLD_GLOBAL
+#else
+#  ifdef DL_GLOBAL
+#    define LT_DLGLOBAL		DL_GLOBAL
+#  else
+#    define LT_DLGLOBAL		0
+#  endif
+#endif
 
-  if test "x$ac_ct_CC" = x; then
-    CC=""
+/* We may have to define LT_DLLAZY_OR_NOW in the command line if we
+   find out it does not work in some platform. */
+#ifndef LT_DLLAZY_OR_NOW
+#  ifdef RTLD_LAZY
+#    define LT_DLLAZY_OR_NOW		RTLD_LAZY
+#  else
+#    ifdef DL_LAZY
+#      define LT_DLLAZY_OR_NOW		DL_LAZY
+#    else
+#      ifdef RTLD_NOW
+#        define LT_DLLAZY_OR_NOW	RTLD_NOW
+#      else
+#        ifdef DL_NOW
+#          define LT_DLLAZY_OR_NOW	DL_NOW
+#        else
+#          define LT_DLLAZY_OR_NOW	0
+#        endif
+#      endif
+#    endif
+#  endif
+#endif
+
+/* When -fvisbility=hidden is used, assume the code has been annotated
+   correspondingly for the symbols needed.  */
+#if defined(__GNUC__) && (((__GNUC__ == 3) && (__GNUC_MINOR__ >= 3)) || (__GNUC__ > 3))
+int fnord () __attribute__((visibility("default")));
+#endif
+
+int fnord () { return 42; }
+int main ()
+{
+  void *self = dlopen (0, LT_DLGLOBAL|LT_DLLAZY_OR_NOW);
+  int status = $lt_dlunknown;
+
+  if (self)
+    {
+      if (dlsym (self,"fnord"))       status = $lt_dlno_uscore;
+      else
+        {
+	  if (dlsym( self,"_fnord"))  status = $lt_dlneed_uscore;
+          else puts (dlerror ());
+	}
+      /* dlclose (self); */
+    }
   else
-    case $cross_compiling:$ac_tool_warned in
-yes:)
-{ $as_echo "$as_me:$LINENO: WARNING: using cross tools not prefixed with host triplet" >&5
-$as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
-ac_tool_warned=yes ;;
-esac
-    CC=$ac_ct_CC
+    puts (dlerror ());
+
+  return status;
+}
+_LT_EOF
+  if { { eval echo "\"\$as_me\":${as_lineno-$LINENO}: \"$ac_link\""; } >&5
+  (eval $ac_link) 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; } && test -s conftest${ac_exeext} 2>/dev/null; then
+    (./conftest; exit; ) >&5 2>/dev/null
+    lt_status=$?
+    case x$lt_status in
+      x$lt_dlno_uscore) lt_cv_dlopen_self_static=yes ;;
+      x$lt_dlneed_uscore) lt_cv_dlopen_self_static=yes ;;
+      x$lt_dlunknown|x*) lt_cv_dlopen_self_static=no ;;
+    esac
+  else :
+    # compilation failed
+    lt_cv_dlopen_self_static=no
   fi
 fi
+rm -fr conftest*
+
 
 fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_dlopen_self_static" >&5
+$as_echo "$lt_cv_dlopen_self_static" >&6; }
+    fi
 
+    CPPFLAGS="$save_CPPFLAGS"
+    LDFLAGS="$save_LDFLAGS"
+    LIBS="$save_LIBS"
+    ;;
+  esac
 
-test -z "$CC" && { { $as_echo "$as_me:$LINENO: error: in \`$ac_pwd':" >&5
-$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-{ { $as_echo "$as_me:$LINENO: error: no acceptable C compiler found in \$PATH
-See \`config.log' for more details." >&5
-$as_echo "$as_me: error: no acceptable C compiler found in \$PATH
-See \`config.log' for more details." >&2;}
-   { (exit 1); exit 1; }; }; }
+  case $lt_cv_dlopen_self in
+  yes|no) enable_dlopen_self=$lt_cv_dlopen_self ;;
+  *) enable_dlopen_self=unknown ;;
+  esac
 
-# Provide some information about the compiler.
-$as_echo "$as_me:$LINENO: checking for C compiler version" >&5
-set X $ac_compile
-ac_compiler=$2
-{ (ac_try="$ac_compiler --version >&5"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compiler --version >&5") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }
-{ (ac_try="$ac_compiler -v >&5"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compiler -v >&5") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }
-{ (ac_try="$ac_compiler -V >&5"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compiler -V >&5") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }
+  case $lt_cv_dlopen_self_static in
+  yes|no) enable_dlopen_self_static=$lt_cv_dlopen_self_static ;;
+  *) enable_dlopen_self_static=unknown ;;
+  esac
+fi
 
-{ $as_echo "$as_me:$LINENO: checking whether we are using the GNU C compiler" >&5
-$as_echo_n "checking whether we are using the GNU C compiler... " >&6; }
-if test "${ac_cv_c_compiler_gnu+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
 
-int
-main ()
-{
-#ifndef __GNUC__
-       choke me
-#endif
 
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_compiler_gnu=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
 
-	ac_compiler_gnu=no
-fi
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-ac_cv_c_compiler_gnu=$ac_compiler_gnu
 
-fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_c_compiler_gnu" >&5
-$as_echo "$ac_cv_c_compiler_gnu" >&6; }
-if test $ac_compiler_gnu = yes; then
-  GCC=yes
-else
-  GCC=
-fi
-ac_test_CFLAGS=${CFLAGS+set}
-ac_save_CFLAGS=$CFLAGS
-{ $as_echo "$as_me:$LINENO: checking whether $CC accepts -g" >&5
-$as_echo_n "checking whether $CC accepts -g... " >&6; }
-if test "${ac_cv_prog_cc_g+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  ac_save_c_werror_flag=$ac_c_werror_flag
-   ac_c_werror_flag=yes
-   ac_cv_prog_cc_g=no
-   CFLAGS="-g"
-   cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
 
-int
-main ()
-{
 
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_cv_prog_cc_g=yes
+
+
+
+
+
+
+
+
+
+striplib=
+old_striplib=
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether stripping libraries is possible" >&5
+$as_echo_n "checking whether stripping libraries is possible... " >&6; }
+if test -n "$STRIP" && $STRIP -V 2>&1 | $GREP "GNU strip" >/dev/null; then
+  test -z "$old_striplib" && old_striplib="$STRIP --strip-debug"
+  test -z "$striplib" && striplib="$STRIP --strip-unneeded"
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+# FIXME - insert some real tests, host_os isn't really good enough
+  case $host_os in
+  darwin*)
+    if test -n "$STRIP" ; then
+      striplib="$STRIP -x"
+      old_striplib="$STRIP -S"
+      { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+    else
+      { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+    fi
+    ;;
+  *)
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+    ;;
+  esac
+fi
 
-	CFLAGS=""
-      cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
 
-int
-main ()
-{
 
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  :
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
 
-	ac_c_werror_flag=$ac_save_c_werror_flag
-	 CFLAGS="-g"
-	 cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
 
-int
-main ()
-{
 
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_cv_prog_cc_g=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
 
 
-fi
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-fi
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-fi
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-   ac_c_werror_flag=$ac_save_c_werror_flag
-fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_prog_cc_g" >&5
-$as_echo "$ac_cv_prog_cc_g" >&6; }
-if test "$ac_test_CFLAGS" = set; then
-  CFLAGS=$ac_save_CFLAGS
-elif test $ac_cv_prog_cc_g = yes; then
-  if test "$GCC" = yes; then
-    CFLAGS="-g -O2"
-  else
-    CFLAGS="-g"
-  fi
-else
-  if test "$GCC" = yes; then
-    CFLAGS="-O2"
-  else
-    CFLAGS=
-  fi
-fi
-{ $as_echo "$as_me:$LINENO: checking for $CC option to accept ISO C89" >&5
-$as_echo_n "checking for $CC option to accept ISO C89... " >&6; }
-if test "${ac_cv_prog_cc_c89+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  ac_cv_prog_cc_c89=no
-ac_save_CC=$CC
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <stdarg.h>
-#include <stdio.h>
-#include <sys/types.h>
-#include <sys/stat.h>
-/* Most of the following tests are stolen from RCS 5.7's src/conf.sh.  */
-struct buf { int x; };
-FILE * (*rcsopen) (struct buf *, struct stat *, int);
-static char *e (p, i)
-     char **p;
-     int i;
-{
-  return p[i];
-}
-static char *f (char * (*g) (char **, int), char **p, ...)
-{
-  char *s;
-  va_list v;
-  va_start (v,p);
-  s = g (p, va_arg (v,int));
-  va_end (v);
-  return s;
-}
 
-/* OSF 4.0 Compaq cc is some sort of almost-ANSI by default.  It has
-   function prototypes and stuff, but not '\xHH' hex character constants.
-   These don't provoke an error unfortunately, instead are silently treated
-   as 'x'.  The following induces an error, until -std is added to get
-   proper ANSI mode.  Curiously '\x00'!='x' always comes out true, for an
-   array size at least.  It's necessary to write '\x00'==0 to get something
-   that's true only with -std.  */
-int osf4_cc_array ['\x00' == 0 ? 1 : -1];
+  # Report which library types will actually be built
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking if libtool supports shared libraries" >&5
+$as_echo_n "checking if libtool supports shared libraries... " >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $can_build_shared" >&5
+$as_echo "$can_build_shared" >&6; }
 
-/* IBM C 6 for AIX is almost-ANSI by default, but it replaces macro parameters
-   inside strings and character constants.  */
-#define FOO(x) 'x'
-int xlc6_cc_array[FOO(a) == 'x' ? 1 : -1];
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether to build shared libraries" >&5
+$as_echo_n "checking whether to build shared libraries... " >&6; }
+  test "$can_build_shared" = "no" && enable_shared=no
 
-int test (int i, double x);
-struct s1 {int (*f) (int a);};
-struct s2 {int (*f) (double a);};
-int pairnames (int, char **, FILE *(*)(struct buf *, struct stat *, int), int, int);
-int argc;
-char **argv;
-int
-main ()
-{
-return f (e, argv, 0) != argv[0]  ||  f (e, argv, 1) != argv[1];
-  ;
-  return 0;
-}
-_ACEOF
-for ac_arg in '' -qlanglvl=extc89 -qlanglvl=ansi -std \
-	-Ae "-Aa -D_HPUX_SOURCE" "-Xc -D__EXTENSIONS__"
-do
-  CC="$ac_save_CC $ac_arg"
-  rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_cv_prog_cc_c89=$ac_arg
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+  # On AIX, shared libraries and static libraries use the same namespace, and
+  # are all built from PIC.
+  case $host_os in
+  aix3*)
+    test "$enable_shared" = yes && enable_static=no
+    if test -n "$RANLIB"; then
+      archive_cmds="$archive_cmds~\$RANLIB \$lib"
+      postinstall_cmds='$RANLIB $lib'
+    fi
+    ;;
 
+  aix[4-9]*)
+    if test "$host_cpu" != ia64 && test "$aix_use_runtimelinking" = no ; then
+      test "$enable_shared" = yes && enable_static=no
+    fi
+    ;;
+  esac
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $enable_shared" >&5
+$as_echo "$enable_shared" >&6; }
 
-fi
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether to build static libraries" >&5
+$as_echo_n "checking whether to build static libraries... " >&6; }
+  # Make sure either enable_shared or enable_static is yes.
+  test "$enable_shared" = yes || enable_static=yes
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $enable_static" >&5
+$as_echo "$enable_static" >&6; }
 
-rm -f core conftest.err conftest.$ac_objext
-  test "x$ac_cv_prog_cc_c89" != "xno" && break
-done
-rm -f conftest.$ac_ext
-CC=$ac_save_CC
 
-fi
-# AC_CACHE_VAL
-case "x$ac_cv_prog_cc_c89" in
-  x)
-    { $as_echo "$as_me:$LINENO: result: none needed" >&5
-$as_echo "none needed" >&6; } ;;
-  xno)
-    { $as_echo "$as_me:$LINENO: result: unsupported" >&5
-$as_echo "unsupported" >&6; } ;;
-  *)
-    CC="$CC $ac_cv_prog_cc_c89"
-    { $as_echo "$as_me:$LINENO: result: $ac_cv_prog_cc_c89" >&5
-$as_echo "$ac_cv_prog_cc_c89" >&6; } ;;
-esac
 
 
+fi
 ac_ext=c
 ac_cpp='$CPP $CPPFLAGS'
 ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
 ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
 ac_compiler_gnu=$ac_cv_c_compiler_gnu
 
+CC="$lt_save_CC"
 
-    . ./VERSION
-    pkg_version=${PKG_MAJOR}.${PKG_MINOR}.${PKG_REVISION}
 
-    pkg_release=$PKG_BUILD
-    test -z "$BUILD_VERSION" || pkg_release="$BUILD_VERSION"
 
 
-    DEBUG=${DEBUG:-'-DDEBUG'}		    debug_build="$DEBUG"
 
 
-    OPTIMIZER=${OPTIMIZER:-'-g -O2'}
-    opt_build="$OPTIMIZER"
 
 
-    MALLOCLIB=${MALLOCLIB:-''}		    malloc_lib="$MALLOCLIB"
 
 
-    pkg_user=`id -u -n`
-    test -z "$INSTALL_USER" || pkg_user="$INSTALL_USER"
 
 
-    pkg_group=`id -g -n`
-    test -z "$INSTALL_GROUP" || pkg_group="$INSTALL_GROUP"
 
 
-    pkg_distribution=`uname -s`
-    test -z "$DISTRIBUTION" || pkg_distribution="$DISTRIBUTION"
+
+        ac_config_commands="$ac_config_commands libtool"
 
 
-    pkg_platform=`uname -s | tr 'A-Z' 'a-z' | tr -d / | sed -e 's/irix64/irix/'`
-    test -z "$PLATFORM" || pkg_platform="$PLATFORM"
 
 
- ac_ext=c
+# Only expand once:
+
+
+
+ac_ext=c
 ac_cpp='$CPP $CPPFLAGS'
 ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
 ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
@@ -12006,9 +11166,9 @@ ac_compiler_gnu=$ac_cv_c_compiler_gnu
 if test -n "$ac_tool_prefix"; then
   # Extract the first word of "${ac_tool_prefix}gcc", so it can be a program name with args.
 set dummy ${ac_tool_prefix}gcc; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_CC+set}" = set; then
+if ${ac_cv_prog_CC+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$CC"; then
@@ -12019,24 +11179,24 @@ for as_dir in $PATH
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_CC="${ac_tool_prefix}gcc"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
 CC=$ac_cv_prog_CC
 if test -n "$CC"; then
-  { $as_echo "$as_me:$LINENO: result: $CC" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $CC" >&5
 $as_echo "$CC" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
@@ -12046,9 +11206,9 @@ if test -z "$ac_cv_prog_CC"; then
   ac_ct_CC=$CC
   # Extract the first word of "gcc", so it can be a program name with args.
 set dummy gcc; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_ac_ct_CC+set}" = set; then
+if ${ac_cv_prog_ac_ct_CC+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$ac_ct_CC"; then
@@ -12059,24 +11219,24 @@ for as_dir in $PATH
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_CC="gcc"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
 ac_ct_CC=$ac_cv_prog_ac_ct_CC
 if test -n "$ac_ct_CC"; then
-  { $as_echo "$as_me:$LINENO: result: $ac_ct_CC" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_CC" >&5
 $as_echo "$ac_ct_CC" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
@@ -12085,7 +11245,7 @@ fi
   else
     case $cross_compiling:$ac_tool_warned in
 yes:)
-{ $as_echo "$as_me:$LINENO: WARNING: using cross tools not prefixed with host triplet" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
 $as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
 ac_tool_warned=yes ;;
 esac
@@ -12099,9 +11259,9 @@ if test -z "$CC"; then
           if test -n "$ac_tool_prefix"; then
     # Extract the first word of "${ac_tool_prefix}cc", so it can be a program name with args.
 set dummy ${ac_tool_prefix}cc; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_CC+set}" = set; then
+if ${ac_cv_prog_CC+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$CC"; then
@@ -12112,24 +11272,24 @@ for as_dir in $PATH
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_CC="${ac_tool_prefix}cc"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
 CC=$ac_cv_prog_CC
 if test -n "$CC"; then
-  { $as_echo "$as_me:$LINENO: result: $CC" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $CC" >&5
 $as_echo "$CC" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
@@ -12139,9 +11299,9 @@ fi
 if test -z "$CC"; then
   # Extract the first word of "cc", so it can be a program name with args.
 set dummy cc; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_CC+set}" = set; then
+if ${ac_cv_prog_CC+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$CC"; then
@@ -12153,18 +11313,18 @@ for as_dir in $PATH
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     if test "$as_dir/$ac_word$ac_exec_ext" = "/usr/ucb/cc"; then
        ac_prog_rejected=yes
        continue
      fi
     ac_cv_prog_CC="cc"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 if test $ac_prog_rejected = yes; then
@@ -12183,10 +11343,10 @@ fi
 fi
 CC=$ac_cv_prog_CC
 if test -n "$CC"; then
-  { $as_echo "$as_me:$LINENO: result: $CC" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $CC" >&5
 $as_echo "$CC" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
@@ -12198,9 +11358,9 @@ if test -z "$CC"; then
   do
     # Extract the first word of "$ac_tool_prefix$ac_prog", so it can be a program name with args.
 set dummy $ac_tool_prefix$ac_prog; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_CC+set}" = set; then
+if ${ac_cv_prog_CC+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$CC"; then
@@ -12211,24 +11371,24 @@ for as_dir in $PATH
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_CC="$ac_tool_prefix$ac_prog"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
 CC=$ac_cv_prog_CC
 if test -n "$CC"; then
-  { $as_echo "$as_me:$LINENO: result: $CC" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $CC" >&5
 $as_echo "$CC" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
@@ -12242,9 +11402,9 @@ if test -z "$CC"; then
 do
   # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_ac_ct_CC+set}" = set; then
+if ${ac_cv_prog_ac_ct_CC+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$ac_ct_CC"; then
@@ -12255,24 +11415,24 @@ for as_dir in $PATH
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_CC="$ac_prog"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
 ac_ct_CC=$ac_cv_prog_ac_ct_CC
 if test -n "$ac_ct_CC"; then
-  { $as_echo "$as_me:$LINENO: result: $ac_ct_CC" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_CC" >&5
 $as_echo "$ac_ct_CC" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
@@ -12285,7 +11445,7 @@ done
   else
     case $cross_compiling:$ac_tool_warned in
 yes:)
-{ $as_echo "$as_me:$LINENO: WARNING: using cross tools not prefixed with host triplet" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
 $as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
 ac_tool_warned=yes ;;
 esac
@@ -12296,62 +11456,42 @@ fi
 fi
 
 
-test -z "$CC" && { { $as_echo "$as_me:$LINENO: error: in \`$ac_pwd':" >&5
+test -z "$CC" && { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
 $as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-{ { $as_echo "$as_me:$LINENO: error: no acceptable C compiler found in \$PATH
-See \`config.log' for more details." >&5
-$as_echo "$as_me: error: no acceptable C compiler found in \$PATH
-See \`config.log' for more details." >&2;}
-   { (exit 1); exit 1; }; }; }
+as_fn_error $? "no acceptable C compiler found in \$PATH
+See \`config.log' for more details" "$LINENO" 5; }
 
 # Provide some information about the compiler.
-$as_echo "$as_me:$LINENO: checking for C compiler version" >&5
+$as_echo "$as_me:${as_lineno-$LINENO}: checking for C compiler version" >&5
 set X $ac_compile
 ac_compiler=$2
-{ (ac_try="$ac_compiler --version >&5"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compiler --version >&5") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }
-{ (ac_try="$ac_compiler -v >&5"
+for ac_option in --version -v -V -qversion; do
+  { { ac_try="$ac_compiler $ac_option >&5"
 case "(($ac_try" in
   *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
   *) ac_try_echo=$ac_try;;
 esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compiler -v >&5") 2>&5
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_compiler $ac_option >&5") 2>conftest.err
   ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }
-{ (ac_try="$ac_compiler -V >&5"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compiler -V >&5") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }
+  if test -s conftest.err; then
+    sed '10a\
+... rest of stderr output deleted ...
+         10q' conftest.err >conftest.er1
+    cat conftest.er1 >&5
+  fi
+  rm -f conftest.er1 conftest.err
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+done
 
-{ $as_echo "$as_me:$LINENO: checking whether we are using the GNU C compiler" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether we are using the GNU C compiler" >&5
 $as_echo_n "checking whether we are using the GNU C compiler... " >&6; }
-if test "${ac_cv_c_compiler_gnu+set}" = set; then
+if ${ac_cv_c_compiler_gnu+:} false; then :
   $as_echo_n "(cached) " >&6
 else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 int
@@ -12365,37 +11505,16 @@ main ()
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   ac_compiler_gnu=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_compiler_gnu=no
+  ac_compiler_gnu=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 ac_cv_c_compiler_gnu=$ac_compiler_gnu
 
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_c_compiler_gnu" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_c_compiler_gnu" >&5
 $as_echo "$ac_cv_c_compiler_gnu" >&6; }
 if test $ac_compiler_gnu = yes; then
   GCC=yes
@@ -12404,20 +11523,16 @@ else
 fi
 ac_test_CFLAGS=${CFLAGS+set}
 ac_save_CFLAGS=$CFLAGS
-{ $as_echo "$as_me:$LINENO: checking whether $CC accepts -g" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether $CC accepts -g" >&5
 $as_echo_n "checking whether $CC accepts -g... " >&6; }
-if test "${ac_cv_prog_cc_g+set}" = set; then
+if ${ac_cv_prog_cc_g+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_save_c_werror_flag=$ac_c_werror_flag
    ac_c_werror_flag=yes
    ac_cv_prog_cc_g=no
    CFLAGS="-g"
-   cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 int
@@ -12428,35 +11543,11 @@ main ()
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   ac_cv_prog_cc_g=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CFLAGS=""
-      cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  CFLAGS=""
+      cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 int
@@ -12467,36 +11558,12 @@ main ()
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  :
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+if ac_fn_c_try_compile "$LINENO"; then :
 
-	ac_c_werror_flag=$ac_save_c_werror_flag
+else
+  ac_c_werror_flag=$ac_save_c_werror_flag
 	 CFLAGS="-g"
-	 cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+	 cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 int
@@ -12507,42 +11574,17 @@ main ()
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   ac_cv_prog_cc_g=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
    ac_c_werror_flag=$ac_save_c_werror_flag
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_prog_cc_g" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_prog_cc_g" >&5
 $as_echo "$ac_cv_prog_cc_g" >&6; }
 if test "$ac_test_CFLAGS" = set; then
   CFLAGS=$ac_save_CFLAGS
@@ -12559,23 +11601,18 @@ else
     CFLAGS=
   fi
 fi
-{ $as_echo "$as_me:$LINENO: checking for $CC option to accept ISO C89" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $CC option to accept ISO C89" >&5
 $as_echo_n "checking for $CC option to accept ISO C89... " >&6; }
-if test "${ac_cv_prog_cc_c89+set}" = set; then
+if ${ac_cv_prog_cc_c89+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_cv_prog_cc_c89=no
 ac_save_CC=$CC
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #include <stdarg.h>
 #include <stdio.h>
-#include <sys/types.h>
-#include <sys/stat.h>
+struct stat;
 /* Most of the following tests are stolen from RCS 5.7's src/conf.sh.  */
 struct buf { int x; };
 FILE * (*rcsopen) (struct buf *, struct stat *, int);
@@ -12627,32 +11664,9 @@ for ac_arg in '' -qlanglvl=extc89 -qlang
 	-Ae "-Aa -D_HPUX_SOURCE" "-Xc -D__EXTENSIONS__"
 do
   CC="$ac_save_CC $ac_arg"
-  rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+  if ac_fn_c_try_compile "$LINENO"; then :
   ac_cv_prog_cc_c89=$ac_arg
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-
 fi
-
 rm -f core conftest.err conftest.$ac_objext
   test "x$ac_cv_prog_cc_c89" != "xno" && break
 done
@@ -12663,17 +11677,19 @@ fi
 # AC_CACHE_VAL
 case "x$ac_cv_prog_cc_c89" in
   x)
-    { $as_echo "$as_me:$LINENO: result: none needed" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: none needed" >&5
 $as_echo "none needed" >&6; } ;;
   xno)
-    { $as_echo "$as_me:$LINENO: result: unsupported" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: unsupported" >&5
 $as_echo "unsupported" >&6; } ;;
   *)
     CC="$CC $ac_cv_prog_cc_c89"
-    { $as_echo "$as_me:$LINENO: result: $ac_cv_prog_cc_c89" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_prog_cc_c89" >&5
 $as_echo "$ac_cv_prog_cc_c89" >&6; } ;;
 esac
+if test "x$ac_cv_prog_cc_c89" != xno; then :
 
+fi
 
 ac_ext=c
 ac_cpp='$CPP $CPPFLAGS'
@@ -12681,3595 +11697,3005 @@ ac_compile='$CC -c $CFLAGS $CPPFLAGS con
 ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
 ac_compiler_gnu=$ac_cv_c_compiler_gnu
 
-    cc="$CC"
-
-     if test -z ""$cc""; then
-        echo
-        echo FATAL ERROR: cc does not seem to be installed.
-        echo xfsprogs cannot be built without a working C compiler installation.
-        exit 1
-    fi
 
-
-    if test -z "$MAKE"; then
-        # Extract the first word of "gmake", so it can be a program name with args.
-set dummy gmake; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+if test "${BUILD_CC+set}" != "set"; then
+  if test $cross_compiling = no; then
+    BUILD_CC="$CC"
+  else
+    for ac_prog in gcc cc
+do
+  # Extract the first word of "$ac_prog", so it can be a program name with args.
+set dummy $ac_prog; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_path_MAKE+set}" = set; then
+if ${ac_cv_prog_BUILD_CC+:} false; then :
   $as_echo_n "(cached) " >&6
 else
-  case $MAKE in
-  [\\/]* | ?:[\\/]*)
-  ac_cv_path_MAKE="$MAKE" # Let the user override the test with a path.
-  ;;
-  *)
-  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+  if test -n "$BUILD_CC"; then
+  ac_cv_prog_BUILD_CC="$BUILD_CC" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
 for as_dir in $PATH
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
-    ac_cv_path_MAKE="$as_dir/$ac_word$ac_exec_ext"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_BUILD_CC="$ac_prog"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
-  ;;
-esac
 fi
-MAKE=$ac_cv_path_MAKE
-if test -n "$MAKE"; then
-  { $as_echo "$as_me:$LINENO: result: $MAKE" >&5
-$as_echo "$MAKE" >&6; }
+fi
+BUILD_CC=$ac_cv_prog_BUILD_CC
+if test -n "$BUILD_CC"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $BUILD_CC" >&5
+$as_echo "$BUILD_CC" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
 
-    fi
-    if test -z "$MAKE"; then
-        # Extract the first word of "make", so it can be a program name with args.
-set dummy make; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+  test -n "$BUILD_CC" && break
+done
+
+  fi
+fi
+
+if test "${BUILD_CFLAGS+set}" != "set"; then
+  if test $cross_compiling = no; then
+    BUILD_CFLAGS="$CFLAGS"
+  else
+    BUILD_CFLAGS="-g -O2"
+  fi
+fi
+
+# Check whether --enable-shared was given.
+if test "${enable_shared+set}" = set; then :
+  enableval=$enable_shared;
+else
+  enable_shared=yes
+fi
+
+
+
+# Check whether --enable-gettext was given.
+if test "${enable_gettext+set}" = set; then :
+  enableval=$enable_gettext;
+else
+  enable_gettext=yes
+fi
+
+
+
+# Check whether --enable-blkid was given.
+if test "${enable_blkid+set}" = set; then :
+  enableval=$enable_blkid;
+else
+  enable_blkid=yes
+fi
+
+
+
+# Check whether --enable-readline was given.
+if test "${enable_readline+set}" = set; then :
+  enableval=$enable_readline; test $enable_readline = yes && libreadline="-lreadline"
+else
+  enable_readline=no
+fi
+
+
+
+
+# Check whether --enable-editline was given.
+if test "${enable_editline+set}" = set; then :
+  enableval=$enable_editline; test $enable_editline = yes && libeditline="-ledit"
+else
+  enable_editline=no
+fi
+
+
+
+
+# Check whether --enable-termcap was given.
+if test "${enable_termcap+set}" = set; then :
+  enableval=$enable_termcap; test $enable_termcap = yes && libtermcap="-ltermcap"
+fi
+
+
+
+
+# Check whether --enable-lib64 was given.
+if test "${enable_lib64+set}" = set; then :
+  enableval=$enable_lib64;
+else
+  enable_lib64=yes
+fi
+
+
+
+# Check whether --enable-librt was given.
+if test "${enable_librt+set}" = set; then :
+  enableval=$enable_librt;
+else
+  enable_librt=yes
+fi
+
+
+
+# Enable UBSAN; set enable_ubsan=probe below to enable autoprobe.
+# Check whether --enable-ubsan was given.
+if test "${enable_ubsan+set}" = set; then :
+  enableval=$enable_ubsan;
+else
+  enable_ubsan=no
+fi
+
+
+
+# Enable ADDRSAN; set enable_addrsan=probe below to enable autoprobe.
+# Check whether --enable-addrsan was given.
+if test "${enable_addrsan+set}" = set; then :
+  enableval=$enable_addrsan;
+else
+  enable_addrsan=no
+fi
+
+
+
+# Enable THREADSAN; set enable_threadsan=probe to enable autoprobe.
+# Check whether --enable-threadsan was given.
+if test "${enable_threadsan+set}" = set; then :
+  enableval=$enable_threadsan;
+else
+  enable_threadsan=no
+fi
+
+
+
+#
+# If the user specified a libdir ending in lib64 do not append another
+# 64 to the library names.
+#
+base_libdir=`basename "$libdir"`
+case $base_libdir in
+lib64)
+  enable_lib64=no
+esac
+
+#
+# Some important tools should be installed into the root partitions.
+#
+# Check whether exec_prefix=/usr: and install them to /sbin in that
+# case.  If the user choses a different prefix assume he just wants
+# a local install for testing and not a system install.
+#
+case $exec_prefix:$prefix in
+NONE:NONE | NONE:/usr | /usr:*)
+  root_sbindir='/sbin'
+  root_libdir="/${base_libdir}"
+  ;;
+*)
+  root_sbindir="${sbindir}"
+  root_libdir="${libdir}"
+  ;;
+esac
+
+
+
+
+# Find localized files.  Don't descend into any "dot directories"
+# (like .git or .pc from quilt).  Strangely, the "-print" argument
+# to "find" is required, to avoid including such directories in the
+# list.
+LOCALIZED_FILES=""
+for lfile in `find ${srcdir} -path './.??*' -prune -o -name '*.c' -type f -print || exit 1`; do
+    LOCALIZED_FILES="$LOCALIZED_FILES \$(TOPDIR)/$lfile"
+done
+
+
+ pkg_name="xfsprogs"
+
+
+    ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+if test -n "$ac_tool_prefix"; then
+  # Extract the first word of "${ac_tool_prefix}gcc", so it can be a program name with args.
+set dummy ${ac_tool_prefix}gcc; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_path_MAKE+set}" = set; then
+if ${ac_cv_prog_CC+:} false; then :
   $as_echo_n "(cached) " >&6
 else
-  case $MAKE in
-  [\\/]* | ?:[\\/]*)
-  ac_cv_path_MAKE="$MAKE" # Let the user override the test with a path.
-  ;;
-  *)
-  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+  if test -n "$CC"; then
+  ac_cv_prog_CC="$CC" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
 for as_dir in $PATH
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
-    ac_cv_path_MAKE="$as_dir/$ac_word$ac_exec_ext"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_CC="${ac_tool_prefix}gcc"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
-  ;;
-esac
 fi
-MAKE=$ac_cv_path_MAKE
-if test -n "$MAKE"; then
-  { $as_echo "$as_me:$LINENO: result: $MAKE" >&5
-$as_echo "$MAKE" >&6; }
+fi
+CC=$ac_cv_prog_CC
+if test -n "$CC"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $CC" >&5
+$as_echo "$CC" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
 
-    fi
-    make=$MAKE
-
-     if test -z ""$make""; then
-        echo
-        echo FATAL ERROR: make does not seem to be installed.
-        echo xfsprogs cannot be built without a working GNU make installation.
-        exit 1
-    fi
-
-
-    if test -z "$TAR"; then
-        # Extract the first word of "tar", so it can be a program name with args.
-set dummy tar; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+fi
+if test -z "$ac_cv_prog_CC"; then
+  ac_ct_CC=$CC
+  # Extract the first word of "gcc", so it can be a program name with args.
+set dummy gcc; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_path_TAR+set}" = set; then
+if ${ac_cv_prog_ac_ct_CC+:} false; then :
   $as_echo_n "(cached) " >&6
 else
-  case $TAR in
-  [\\/]* | ?:[\\/]*)
-  ac_cv_path_TAR="$TAR" # Let the user override the test with a path.
-  ;;
-  *)
-  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+  if test -n "$ac_ct_CC"; then
+  ac_cv_prog_ac_ct_CC="$ac_ct_CC" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
 for as_dir in $PATH
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
-    ac_cv_path_TAR="$as_dir/$ac_word$ac_exec_ext"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_ac_ct_CC="gcc"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
-  ;;
-esac
 fi
-TAR=$ac_cv_path_TAR
-if test -n "$TAR"; then
-  { $as_echo "$as_me:$LINENO: result: $TAR" >&5
-$as_echo "$TAR" >&6; }
+fi
+ac_ct_CC=$ac_cv_prog_ac_ct_CC
+if test -n "$ac_ct_CC"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_CC" >&5
+$as_echo "$ac_ct_CC" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
+  if test "x$ac_ct_CC" = x; then
+    CC=""
+  else
+    case $cross_compiling:$ac_tool_warned in
+yes:)
+{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
+$as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
+ac_tool_warned=yes ;;
+esac
+    CC=$ac_ct_CC
+  fi
+else
+  CC="$ac_cv_prog_CC"
+fi
 
-    fi
-    tar=$TAR
-
-    if test -z "$ZIP"; then
-        # Extract the first word of "gzip", so it can be a program name with args.
-set dummy gzip; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+if test -z "$CC"; then
+          if test -n "$ac_tool_prefix"; then
+    # Extract the first word of "${ac_tool_prefix}cc", so it can be a program name with args.
+set dummy ${ac_tool_prefix}cc; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_path_ZIP+set}" = set; then
+if ${ac_cv_prog_CC+:} false; then :
   $as_echo_n "(cached) " >&6
 else
-  case $ZIP in
-  [\\/]* | ?:[\\/]*)
-  ac_cv_path_ZIP="$ZIP" # Let the user override the test with a path.
-  ;;
-  *)
-  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+  if test -n "$CC"; then
+  ac_cv_prog_CC="$CC" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
 for as_dir in $PATH
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
-    ac_cv_path_ZIP="$as_dir/$ac_word$ac_exec_ext"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_CC="${ac_tool_prefix}cc"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
-  ;;
-esac
 fi
-ZIP=$ac_cv_path_ZIP
-if test -n "$ZIP"; then
-  { $as_echo "$as_me:$LINENO: result: $ZIP" >&5
-$as_echo "$ZIP" >&6; }
+fi
+CC=$ac_cv_prog_CC
+if test -n "$CC"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $CC" >&5
+$as_echo "$CC" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
 
-    fi
-
-    zip=$ZIP
-
-
-    { $as_echo "$as_me:$LINENO: checking whether gcc -MM is supported" >&5
-$as_echo_n "checking whether gcc -MM is supported... " >&6; }
-if test "${ac_cv_gcc_nodeps+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  cat > conftest.c <<EOF
-		   #include <stdio.h>
-		   int main() { exit(0); }
-EOF
-                  ac_cv_gcc_nodeps=no
-                  if ${CC} -MM conftest.c >/dev/null 2>&1; then
-                     ac_cv_gcc_nodeps=yes
-                  fi
-                  rm -f conftest.c a.out
-
+  fi
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_gcc_nodeps" >&5
-$as_echo "$ac_cv_gcc_nodeps" >&6; }
-
-    makedepend="$cc -MM"
-    if test $ac_cv_gcc_nodeps = no; then
-	makedepend=/bin/true
-    fi
-
-
-    if test -z "$AWK"; then
-        # Extract the first word of "awk", so it can be a program name with args.
-set dummy awk; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+if test -z "$CC"; then
+  # Extract the first word of "cc", so it can be a program name with args.
+set dummy cc; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_path_AWK+set}" = set; then
+if ${ac_cv_prog_CC+:} false; then :
   $as_echo_n "(cached) " >&6
 else
-  case $AWK in
-  [\\/]* | ?:[\\/]*)
-  ac_cv_path_AWK="$AWK" # Let the user override the test with a path.
-  ;;
-  *)
-  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-as_dummy="/bin:/usr/bin"
-for as_dir in $as_dummy
+  if test -n "$CC"; then
+  ac_cv_prog_CC="$CC" # Let the user override the test.
+else
+  ac_prog_rejected=no
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
-    ac_cv_path_AWK="$as_dir/$ac_word$ac_exec_ext"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    if test "$as_dir/$ac_word$ac_exec_ext" = "/usr/ucb/cc"; then
+       ac_prog_rejected=yes
+       continue
+     fi
+    ac_cv_prog_CC="cc"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
-  ;;
-esac
+if test $ac_prog_rejected = yes; then
+  # We found a bogon in the path, so make sure we never use it.
+  set dummy $ac_cv_prog_CC
+  shift
+  if test $# != 0; then
+    # We chose a different compiler from the bogus one.
+    # However, it has the same basename, so the bogon will be chosen
+    # first if we set CC to just the basename; use the full file name.
+    shift
+    ac_cv_prog_CC="$as_dir/$ac_word${1+' '}$@"
+  fi
 fi
-AWK=$ac_cv_path_AWK
-if test -n "$AWK"; then
-  { $as_echo "$as_me:$LINENO: result: $AWK" >&5
-$as_echo "$AWK" >&6; }
+fi
+fi
+CC=$ac_cv_prog_CC
+if test -n "$CC"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $CC" >&5
+$as_echo "$CC" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
 
-    fi
-    awk=$AWK
-
-
-    if test -z "$SED"; then
-        # Extract the first word of "sed", so it can be a program name with args.
-set dummy sed; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+fi
+if test -z "$CC"; then
+  if test -n "$ac_tool_prefix"; then
+  for ac_prog in cl.exe
+  do
+    # Extract the first word of "$ac_tool_prefix$ac_prog", so it can be a program name with args.
+set dummy $ac_tool_prefix$ac_prog; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_path_SED+set}" = set; then
+if ${ac_cv_prog_CC+:} false; then :
   $as_echo_n "(cached) " >&6
 else
-  case $SED in
-  [\\/]* | ?:[\\/]*)
-  ac_cv_path_SED="$SED" # Let the user override the test with a path.
-  ;;
-  *)
-  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-as_dummy="/bin:/usr/bin"
-for as_dir in $as_dummy
+  if test -n "$CC"; then
+  ac_cv_prog_CC="$CC" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
-    ac_cv_path_SED="$as_dir/$ac_word$ac_exec_ext"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_CC="$ac_tool_prefix$ac_prog"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
-  ;;
-esac
 fi
-SED=$ac_cv_path_SED
-if test -n "$SED"; then
-  { $as_echo "$as_me:$LINENO: result: $SED" >&5
-$as_echo "$SED" >&6; }
+fi
+CC=$ac_cv_prog_CC
+if test -n "$CC"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $CC" >&5
+$as_echo "$CC" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
 
-    fi
-    sed=$SED
-
-
-    if test -z "$ECHO"; then
-        # Extract the first word of "echo", so it can be a program name with args.
-set dummy echo; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+    test -n "$CC" && break
+  done
+fi
+if test -z "$CC"; then
+  ac_ct_CC=$CC
+  for ac_prog in cl.exe
+do
+  # Extract the first word of "$ac_prog", so it can be a program name with args.
+set dummy $ac_prog; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_path_ECHO+set}" = set; then
+if ${ac_cv_prog_ac_ct_CC+:} false; then :
   $as_echo_n "(cached) " >&6
 else
-  case $ECHO in
-  [\\/]* | ?:[\\/]*)
-  ac_cv_path_ECHO="$ECHO" # Let the user override the test with a path.
-  ;;
-  *)
-  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-as_dummy="/bin:/usr/bin"
-for as_dir in $as_dummy
+  if test -n "$ac_ct_CC"; then
+  ac_cv_prog_ac_ct_CC="$ac_ct_CC" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
-    ac_cv_path_ECHO="$as_dir/$ac_word$ac_exec_ext"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_ac_ct_CC="$ac_prog"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
-  ;;
-esac
 fi
-ECHO=$ac_cv_path_ECHO
-if test -n "$ECHO"; then
-  { $as_echo "$as_me:$LINENO: result: $ECHO" >&5
-$as_echo "$ECHO" >&6; }
+fi
+ac_ct_CC=$ac_cv_prog_ac_ct_CC
+if test -n "$ac_ct_CC"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_CC" >&5
+$as_echo "$ac_ct_CC" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
 
-    fi
-    echo=$ECHO
+  test -n "$ac_ct_CC" && break
+done
 
+  if test "x$ac_ct_CC" = x; then
+    CC=""
+  else
+    case $cross_compiling:$ac_tool_warned in
+yes:)
+{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
+$as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
+ac_tool_warned=yes ;;
+esac
+    CC=$ac_ct_CC
+  fi
+fi
 
-    if test -z "$SORT"; then
-        # Extract the first word of "sort", so it can be a program name with args.
-set dummy sort; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
-$as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_path_SORT+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  case $SORT in
-  [\\/]* | ?:[\\/]*)
-  ac_cv_path_SORT="$SORT" # Let the user override the test with a path.
-  ;;
-  *)
-  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-as_dummy="/bin:/usr/bin"
-for as_dir in $as_dummy
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
-    ac_cv_path_SORT="$as_dir/$ac_word$ac_exec_ext"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
+fi
+
+
+test -z "$CC" && { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
+$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
+as_fn_error $? "no acceptable C compiler found in \$PATH
+See \`config.log' for more details" "$LINENO" 5; }
+
+# Provide some information about the compiler.
+$as_echo "$as_me:${as_lineno-$LINENO}: checking for C compiler version" >&5
+set X $ac_compile
+ac_compiler=$2
+for ac_option in --version -v -V -qversion; do
+  { { ac_try="$ac_compiler $ac_option >&5"
+case "(($ac_try" in
+  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_compiler $ac_option >&5") 2>conftest.err
+  ac_status=$?
+  if test -s conftest.err; then
+    sed '10a\
+... rest of stderr output deleted ...
+         10q' conftest.err >conftest.er1
+    cat conftest.er1 >&5
   fi
+  rm -f conftest.er1 conftest.err
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
 done
-done
-IFS=$as_save_IFS
 
-  ;;
-esac
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether we are using the GNU C compiler" >&5
+$as_echo_n "checking whether we are using the GNU C compiler... " >&6; }
+if ${ac_cv_c_compiler_gnu+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+int
+main ()
+{
+#ifndef __GNUC__
+       choke me
+#endif
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ac_compiler_gnu=yes
+else
+  ac_compiler_gnu=no
 fi
-SORT=$ac_cv_path_SORT
-if test -n "$SORT"; then
-  { $as_echo "$as_me:$LINENO: result: $SORT" >&5
-$as_echo "$SORT" >&6; }
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+ac_cv_c_compiler_gnu=$ac_compiler_gnu
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_c_compiler_gnu" >&5
+$as_echo "$ac_cv_c_compiler_gnu" >&6; }
+if test $ac_compiler_gnu = yes; then
+  GCC=yes
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
-$as_echo "no" >&6; }
+  GCC=
 fi
+ac_test_CFLAGS=${CFLAGS+set}
+ac_save_CFLAGS=$CFLAGS
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether $CC accepts -g" >&5
+$as_echo_n "checking whether $CC accepts -g... " >&6; }
+if ${ac_cv_prog_cc_g+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ac_save_c_werror_flag=$ac_c_werror_flag
+   ac_c_werror_flag=yes
+   ac_cv_prog_cc_g=no
+   CFLAGS="-g"
+   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
 
+int
+main ()
+{
 
-    fi
-    sort=$SORT
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ac_cv_prog_cc_g=yes
+else
+  CFLAGS=""
+      cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
 
+int
+main ()
+{
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
 
-        { $as_echo "$as_me:$LINENO: checking whether ln -s works" >&5
-$as_echo_n "checking whether ln -s works... " >&6; }
-LN_S=$as_ln_s
-if test "$LN_S" = "ln -s"; then
-  { $as_echo "$as_me:$LINENO: result: yes" >&5
-$as_echo "yes" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no, using $LN_S" >&5
-$as_echo "no, using $LN_S" >&6; }
-fi
+  ac_c_werror_flag=$ac_save_c_werror_flag
+	 CFLAGS="-g"
+	 cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
 
+int
+main ()
+{
 
-    if test "$enable_gettext" = yes; then
-        if test -z "$MSGFMT"; then
-                # Extract the first word of "msgfmt", so it can be a program name with args.
-set dummy msgfmt; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
-$as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_path_MSGFMT+set}" = set; then
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ac_cv_prog_cc_g=yes
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+   ac_c_werror_flag=$ac_save_c_werror_flag
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_prog_cc_g" >&5
+$as_echo "$ac_cv_prog_cc_g" >&6; }
+if test "$ac_test_CFLAGS" = set; then
+  CFLAGS=$ac_save_CFLAGS
+elif test $ac_cv_prog_cc_g = yes; then
+  if test "$GCC" = yes; then
+    CFLAGS="-g -O2"
+  else
+    CFLAGS="-g"
+  fi
+else
+  if test "$GCC" = yes; then
+    CFLAGS="-O2"
+  else
+    CFLAGS=
+  fi
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $CC option to accept ISO C89" >&5
+$as_echo_n "checking for $CC option to accept ISO C89... " >&6; }
+if ${ac_cv_prog_cc_c89+:} false; then :
   $as_echo_n "(cached) " >&6
 else
-  case $MSGFMT in
-  [\\/]* | ?:[\\/]*)
-  ac_cv_path_MSGFMT="$MSGFMT" # Let the user override the test with a path.
-  ;;
-  *)
-  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
+  ac_cv_prog_cc_c89=no
+ac_save_CC=$CC
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <stdarg.h>
+#include <stdio.h>
+struct stat;
+/* Most of the following tests are stolen from RCS 5.7's src/conf.sh.  */
+struct buf { int x; };
+FILE * (*rcsopen) (struct buf *, struct stat *, int);
+static char *e (p, i)
+     char **p;
+     int i;
+{
+  return p[i];
+}
+static char *f (char * (*g) (char **, int), char **p, ...)
+{
+  char *s;
+  va_list v;
+  va_start (v,p);
+  s = g (p, va_arg (v,int));
+  va_end (v);
+  return s;
+}
+
+/* OSF 4.0 Compaq cc is some sort of almost-ANSI by default.  It has
+   function prototypes and stuff, but not '\xHH' hex character constants.
+   These don't provoke an error unfortunately, instead are silently treated
+   as 'x'.  The following induces an error, until -std is added to get
+   proper ANSI mode.  Curiously '\x00'!='x' always comes out true, for an
+   array size at least.  It's necessary to write '\x00'==0 to get something
+   that's true only with -std.  */
+int osf4_cc_array ['\x00' == 0 ? 1 : -1];
+
+/* IBM C 6 for AIX is almost-ANSI by default, but it replaces macro parameters
+   inside strings and character constants.  */
+#define FOO(x) 'x'
+int xlc6_cc_array[FOO(a) == 'x' ? 1 : -1];
+
+int test (int i, double x);
+struct s1 {int (*f) (int a);};
+struct s2 {int (*f) (double a);};
+int pairnames (int, char **, FILE *(*)(struct buf *, struct stat *, int), int, int);
+int argc;
+char **argv;
+int
+main ()
+{
+return f (e, argv, 0) != argv[0]  ||  f (e, argv, 1) != argv[1];
+  ;
+  return 0;
+}
+_ACEOF
+for ac_arg in '' -qlanglvl=extc89 -qlanglvl=ansi -std \
+	-Ae "-Aa -D_HPUX_SOURCE" "-Xc -D__EXTENSIONS__"
 do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
-    ac_cv_path_MSGFMT="$as_dir/$ac_word$ac_exec_ext"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
-  fi
-done
+  CC="$ac_save_CC $ac_arg"
+  if ac_fn_c_try_compile "$LINENO"; then :
+  ac_cv_prog_cc_c89=$ac_arg
+fi
+rm -f core conftest.err conftest.$ac_objext
+  test "x$ac_cv_prog_cc_c89" != "xno" && break
 done
-IFS=$as_save_IFS
+rm -f conftest.$ac_ext
+CC=$ac_save_CC
 
-  ;;
+fi
+# AC_CACHE_VAL
+case "x$ac_cv_prog_cc_c89" in
+  x)
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: none needed" >&5
+$as_echo "none needed" >&6; } ;;
+  xno)
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: unsupported" >&5
+$as_echo "unsupported" >&6; } ;;
+  *)
+    CC="$CC $ac_cv_prog_cc_c89"
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_prog_cc_c89" >&5
+$as_echo "$ac_cv_prog_cc_c89" >&6; } ;;
 esac
-fi
-MSGFMT=$ac_cv_path_MSGFMT
-if test -n "$MSGFMT"; then
-  { $as_echo "$as_me:$LINENO: result: $MSGFMT" >&5
-$as_echo "$MSGFMT" >&6; }
-else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
-$as_echo "no" >&6; }
+if test "x$ac_cv_prog_cc_c89" != xno; then :
+
 fi
 
+ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
 
-        fi
-        msgfmt=$MSGFMT
 
-         if test -z ""$msgfmt""; then
-        echo
-        echo FATAL ERROR: msgfmt does not seem to be installed.
-        echo xfsprogs cannot be built without a working gettext installation.
-        exit 1
-    fi
+    . ./VERSION
+    pkg_version=${PKG_MAJOR}.${PKG_MINOR}.${PKG_REVISION}
 
+    pkg_release=$PKG_BUILD
+    test -z "$BUILD_VERSION" || pkg_release="$BUILD_VERSION"
 
-        if test -z "$MSGMERGE"; then
-                # Extract the first word of "msgmerge", so it can be a program name with args.
-set dummy msgmerge; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
-$as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_path_MSGMERGE+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  case $MSGMERGE in
-  [\\/]* | ?:[\\/]*)
-  ac_cv_path_MSGMERGE="$MSGMERGE" # Let the user override the test with a path.
-  ;;
-  *)
-  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
-    ac_cv_path_MSGMERGE="$as_dir/$ac_word$ac_exec_ext"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
-  fi
-done
-done
-IFS=$as_save_IFS
 
-  ;;
-esac
-fi
-MSGMERGE=$ac_cv_path_MSGMERGE
-if test -n "$MSGMERGE"; then
-  { $as_echo "$as_me:$LINENO: result: $MSGMERGE" >&5
-$as_echo "$MSGMERGE" >&6; }
-else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
-$as_echo "no" >&6; }
-fi
+    DEBUG=${DEBUG:-'-DDEBUG'}		    debug_build="$DEBUG"
 
 
-        fi
-        msgmerge=$MSGMERGE
+    OPTIMIZER=${OPTIMIZER:-'-g -O2'}
+    opt_build="$OPTIMIZER"
 
-         if test -z ""$msgmerge""; then
-        echo
-        echo FATAL ERROR: msgmerge does not seem to be installed.
-        echo xfsprogs cannot be built without a working gettext installation.
-        exit 1
-    fi
 
+    MALLOCLIB=${MALLOCLIB:-''}		    malloc_lib="$MALLOCLIB"
 
-        if test -z "$XGETTEXT"; then
-                # Extract the first word of "xgettext", so it can be a program name with args.
-set dummy xgettext; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
-$as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_path_XGETTEXT+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  case $XGETTEXT in
-  [\\/]* | ?:[\\/]*)
-  ac_cv_path_XGETTEXT="$XGETTEXT" # Let the user override the test with a path.
-  ;;
-  *)
-  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
-    ac_cv_path_XGETTEXT="$as_dir/$ac_word$ac_exec_ext"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
-  fi
-done
-done
-IFS=$as_save_IFS
 
-  ;;
-esac
-fi
-XGETTEXT=$ac_cv_path_XGETTEXT
-if test -n "$XGETTEXT"; then
-  { $as_echo "$as_me:$LINENO: result: $XGETTEXT" >&5
-$as_echo "$XGETTEXT" >&6; }
-else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
-$as_echo "no" >&6; }
-fi
+    pkg_user=`id -u -n`
+    test -z "$INSTALL_USER" || pkg_user="$INSTALL_USER"
 
 
-        fi
-        xgettext=$XGETTEXT
+    pkg_group=`id -g -n`
+    test -z "$INSTALL_GROUP" || pkg_group="$INSTALL_GROUP"
 
-         if test -z ""$xgettext""; then
-        echo
-        echo FATAL ERROR: xgettext does not seem to be installed.
-        echo xfsprogs cannot be built without a working gettext installation.
-        exit 1
-    fi
 
-    fi
+    pkg_distribution=`uname -s`
+    test -z "$DISTRIBUTION" || pkg_distribution="$DISTRIBUTION"
 
-    if test -z "$RPM"; then
-        # Extract the first word of "rpm", so it can be a program name with args.
-set dummy rpm; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+
+    pkg_platform=`uname -s | tr 'A-Z' 'a-z' | tr -d / | sed -e 's/irix64/irix/'`
+    test -z "$PLATFORM" || pkg_platform="$PLATFORM"
+
+
+ ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+if test -n "$ac_tool_prefix"; then
+  # Extract the first word of "${ac_tool_prefix}gcc", so it can be a program name with args.
+set dummy ${ac_tool_prefix}gcc; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_path_RPM+set}" = set; then
+if ${ac_cv_prog_CC+:} false; then :
   $as_echo_n "(cached) " >&6
 else
-  case $RPM in
-  [\\/]* | ?:[\\/]*)
-  ac_cv_path_RPM="$RPM" # Let the user override the test with a path.
-  ;;
-  *)
-  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+  if test -n "$CC"; then
+  ac_cv_prog_CC="$CC" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
 for as_dir in $PATH
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
-    ac_cv_path_RPM="$as_dir/$ac_word$ac_exec_ext"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_CC="${ac_tool_prefix}gcc"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
-  ;;
-esac
 fi
-RPM=$ac_cv_path_RPM
-if test -n "$RPM"; then
-  { $as_echo "$as_me:$LINENO: result: $RPM" >&5
-$as_echo "$RPM" >&6; }
+fi
+CC=$ac_cv_prog_CC
+if test -n "$CC"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $CC" >&5
+$as_echo "$CC" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
 
-    fi
-    rpm=$RPM
-
-
-        rpm_version=0
-    test -n "$RPM" && test -x "$RPM" && rpm_version=`$RPM --version \
-                        | awk '{print $NF}' | awk -F. '{V=1; print $V}'`
-
-                if test $rpm_version -ge 4; then
-        # Extract the first word of "rpmbuild", so it can be a program name with args.
-set dummy rpmbuild; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+fi
+if test -z "$ac_cv_prog_CC"; then
+  ac_ct_CC=$CC
+  # Extract the first word of "gcc", so it can be a program name with args.
+set dummy gcc; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_path_RPMBUILD+set}" = set; then
+if ${ac_cv_prog_ac_ct_CC+:} false; then :
   $as_echo_n "(cached) " >&6
 else
-  case $RPMBUILD in
-  [\\/]* | ?:[\\/]*)
-  ac_cv_path_RPMBUILD="$RPMBUILD" # Let the user override the test with a path.
-  ;;
-  *)
-  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+  if test -n "$ac_ct_CC"; then
+  ac_cv_prog_ac_ct_CC="$ac_ct_CC" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
 for as_dir in $PATH
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
-    ac_cv_path_RPMBUILD="$as_dir/$ac_word$ac_exec_ext"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_ac_ct_CC="gcc"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
-  ;;
-esac
 fi
-RPMBUILD=$ac_cv_path_RPMBUILD
-if test -n "$RPMBUILD"; then
-  { $as_echo "$as_me:$LINENO: result: $RPMBUILD" >&5
-$as_echo "$RPMBUILD" >&6; }
+fi
+ac_ct_CC=$ac_cv_prog_ac_ct_CC
+if test -n "$ac_ct_CC"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_CC" >&5
+$as_echo "$ac_ct_CC" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
-
-        rpmbuild=$RPMBUILD
-    else
-        rpmbuild=$RPM
-    fi
-
-
-
-                  enable_lib64="$enable_lib64"
-  libdirsuffix=""
-  searchpath=`(LC_ALL=C $CC -print-search-dirs) 2>/dev/null | sed -n -e 's,^libraries: ,,p' | sed -e 's,^=,,'`
-  if test "$enable_lib64" = "yes" -a -n "$searchpath"; then
-    save_IFS="${IFS= 	}"; IFS=":"
-    for searchdir in $searchpath; do
-      if test -d "$searchdir"; then
-        case "$searchdir" in
-          */lib64/ | */lib64 ) libdirsuffix=64 ;;
-          *) searchdir=`cd "$searchdir" && pwd`
-             case "$searchdir" in
-               */lib64 ) libdirsuffix=64 ;;
-             esac ;;
-        esac
-      fi
-    done
-    IFS="$save_IFS"
-  fi
-
-
-
-  if test "$enable_librt" = "yes"; then
-    librt="-lrt"
+  if test "x$ac_ct_CC" = x; then
+    CC=""
   else
-    librt=""
-  fi
-
-
-
-
-
-
-for ac_header in uuid.h sys/uuid.h uuid/uuid.h
-do
-as_ac_Header=`$as_echo "ac_cv_header_$ac_header" | $as_tr_sh`
-if { as_var=$as_ac_Header; eval "test \"\${$as_var+set}\" = set"; }; then
-  { $as_echo "$as_me:$LINENO: checking for $ac_header" >&5
-$as_echo_n "checking for $ac_header... " >&6; }
-if { as_var=$as_ac_Header; eval "test \"\${$as_var+set}\" = set"; }; then
-  $as_echo_n "(cached) " >&6
-fi
-ac_res=`eval 'as_val=${'$as_ac_Header'}
-		 $as_echo "$as_val"'`
-	       { $as_echo "$as_me:$LINENO: result: $ac_res" >&5
-$as_echo "$ac_res" >&6; }
-else
-  # Is the header compilable?
-{ $as_echo "$as_me:$LINENO: checking $ac_header usability" >&5
-$as_echo_n "checking $ac_header usability... " >&6; }
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-$ac_includes_default
-#include <$ac_header>
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
+    case $cross_compiling:$ac_tool_warned in
+yes:)
+{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
+$as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
+ac_tool_warned=yes ;;
 esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_header_compiler=yes
+    CC=$ac_ct_CC
+  fi
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_header_compiler=no
+  CC="$ac_cv_prog_CC"
 fi
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-{ $as_echo "$as_me:$LINENO: result: $ac_header_compiler" >&5
-$as_echo "$ac_header_compiler" >&6; }
-
-# Is the header present?
-{ $as_echo "$as_me:$LINENO: checking $ac_header presence" >&5
-$as_echo_n "checking $ac_header presence... " >&6; }
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <$ac_header>
-_ACEOF
-if { (ac_try="$ac_cpp conftest.$ac_ext"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_cpp conftest.$ac_ext") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } >/dev/null && {
-	 test -z "$ac_c_preproc_warn_flag$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       }; then
-  ac_header_preproc=yes
+if test -z "$CC"; then
+          if test -n "$ac_tool_prefix"; then
+    # Extract the first word of "${ac_tool_prefix}cc", so it can be a program name with args.
+set dummy ${ac_tool_prefix}cc; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_CC+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+  if test -n "$CC"; then
+  ac_cv_prog_CC="$CC" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_CC="${ac_tool_prefix}cc"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
 
-  ac_header_preproc=no
 fi
-
-rm -f conftest.err conftest.$ac_ext
-{ $as_echo "$as_me:$LINENO: result: $ac_header_preproc" >&5
-$as_echo "$ac_header_preproc" >&6; }
-
-# So?  What about this header?
-case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in
-  yes:no: )
-    { $as_echo "$as_me:$LINENO: WARNING: $ac_header: accepted by the compiler, rejected by the preprocessor!" >&5
-$as_echo "$as_me: WARNING: $ac_header: accepted by the compiler, rejected by the preprocessor!" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: $ac_header: proceeding with the compiler's result" >&5
-$as_echo "$as_me: WARNING: $ac_header: proceeding with the compiler's result" >&2;}
-    ac_header_preproc=yes
-    ;;
-  no:yes:* )
-    { $as_echo "$as_me:$LINENO: WARNING: $ac_header: present but cannot be compiled" >&5
-$as_echo "$as_me: WARNING: $ac_header: present but cannot be compiled" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: $ac_header:     check for missing prerequisite headers?" >&5
-$as_echo "$as_me: WARNING: $ac_header:     check for missing prerequisite headers?" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: $ac_header: see the Autoconf documentation" >&5
-$as_echo "$as_me: WARNING: $ac_header: see the Autoconf documentation" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: $ac_header:     section \"Present But Cannot Be Compiled\"" >&5
-$as_echo "$as_me: WARNING: $ac_header:     section \"Present But Cannot Be Compiled\"" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: $ac_header: proceeding with the preprocessor's result" >&5
-$as_echo "$as_me: WARNING: $ac_header: proceeding with the preprocessor's result" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: $ac_header: in the future, the compiler will take precedence" >&5
-$as_echo "$as_me: WARNING: $ac_header: in the future, the compiler will take precedence" >&2;}
-    ( cat <<\_ASBOX
-## ---------------------------------------- ##
-## Report this to linux-xfs@vger.kernel.org ##
-## ---------------------------------------- ##
-_ASBOX
-     ) | sed "s/^/$as_me: WARNING:     /" >&2
-    ;;
-esac
-{ $as_echo "$as_me:$LINENO: checking for $ac_header" >&5
-$as_echo_n "checking for $ac_header... " >&6; }
-if { as_var=$as_ac_Header; eval "test \"\${$as_var+set}\" = set"; }; then
-  $as_echo_n "(cached) " >&6
+fi
+CC=$ac_cv_prog_CC
+if test -n "$CC"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $CC" >&5
+$as_echo "$CC" >&6; }
 else
-  eval "$as_ac_Header=\$ac_header_preproc"
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 fi
-ac_res=`eval 'as_val=${'$as_ac_Header'}
-		 $as_echo "$as_val"'`
-	       { $as_echo "$as_me:$LINENO: result: $ac_res" >&5
-$as_echo "$ac_res" >&6; }
 
-fi
-as_val=`eval 'as_val=${'$as_ac_Header'}
-		 $as_echo "$as_val"'`
-   if test "x$as_val" = x""yes; then
-  cat >>confdefs.h <<_ACEOF
-#define `$as_echo "HAVE_$ac_header" | $as_tr_cpp` 1
-_ACEOF
 
+  fi
 fi
-
+if test -z "$CC"; then
+  # Extract the first word of "cc", so it can be a program name with args.
+set dummy cc; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_CC+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if test -n "$CC"; then
+  ac_cv_prog_CC="$CC" # Let the user override the test.
+else
+  ac_prog_rejected=no
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    if test "$as_dir/$ac_word$ac_exec_ext" = "/usr/ucb/cc"; then
+       ac_prog_rejected=yes
+       continue
+     fi
+    ac_cv_prog_CC="cc"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
 done
+  done
+IFS=$as_save_IFS
 
-    if test $ac_cv_header_uuid_h = no -a \
-	    $ac_cv_header_sys_uuid_h = no -a \
-	    $ac_cv_header_uuid_uuid_h = no; then
-	echo
-	echo 'FATAL ERROR: could not find a valid UUID header.'
-	echo 'Install the Universally Unique Identifiers development package.'
-	exit 1
-    fi
+if test $ac_prog_rejected = yes; then
+  # We found a bogon in the path, so make sure we never use it.
+  set dummy $ac_cv_prog_CC
+  shift
+  if test $# != 0; then
+    # We chose a different compiler from the bogus one.
+    # However, it has the same basename, so the bogon will be chosen
+    # first if we set CC to just the basename; use the full file name.
+    shift
+    ac_cv_prog_CC="$as_dir/$ac_word${1+' '}$@"
+  fi
+fi
+fi
+fi
+CC=$ac_cv_prog_CC
+if test -n "$CC"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $CC" >&5
+$as_echo "$CC" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
 
 
-for ac_func in uuid_compare
-do
-as_ac_var=`$as_echo "ac_cv_func_$ac_func" | $as_tr_sh`
-{ $as_echo "$as_me:$LINENO: checking for $ac_func" >&5
-$as_echo_n "checking for $ac_func... " >&6; }
-if { as_var=$as_ac_var; eval "test \"\${$as_var+set}\" = set"; }; then
+fi
+if test -z "$CC"; then
+  if test -n "$ac_tool_prefix"; then
+  for ac_prog in cl.exe
+  do
+    # Extract the first word of "$ac_tool_prefix$ac_prog", so it can be a program name with args.
+set dummy $ac_tool_prefix$ac_prog; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_CC+:} false; then :
   $as_echo_n "(cached) " >&6
 else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-/* Define $ac_func to an innocuous variant, in case <limits.h> declares $ac_func.
-   For example, HP-UX 11i <limits.h> declares gettimeofday.  */
-#define $ac_func innocuous_$ac_func
-
-/* System header to define __stub macros and hopefully few prototypes,
-    which can conflict with char $ac_func (); below.
-    Prefer <limits.h> to <assert.h> if __STDC__ is defined, since
-    <limits.h> exists even on freestanding compilers.  */
-
-#ifdef __STDC__
-# include <limits.h>
-#else
-# include <assert.h>
-#endif
-
-#undef $ac_func
-
-/* Override any GCC internal prototype to avoid an error.
-   Use char because int might match the return type of a GCC
-   builtin and then its argument prototype would still apply.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-char $ac_func ();
-/* The GNU C library defines this for functions which it implements
-    to always fail with ENOSYS.  Some functions are actually named
-    something starting with __ and the normal name is an alias.  */
-#if defined __stub_$ac_func || defined __stub___$ac_func
-choke me
-#endif
-
-int
-main ()
-{
-return $ac_func ();
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest$ac_exeext && {
-	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
-       }; then
-  eval "$as_ac_var=yes"
+  if test -n "$CC"; then
+  ac_cv_prog_CC="$CC" # Let the user override the test.
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_CC="$ac_tool_prefix$ac_prog"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
 
-	eval "$as_ac_var=no"
 fi
-
-rm -rf conftest.dSYM
-rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
-      conftest$ac_exeext conftest.$ac_ext
 fi
-ac_res=`eval 'as_val=${'$as_ac_var'}
-		 $as_echo "$as_val"'`
-	       { $as_echo "$as_me:$LINENO: result: $ac_res" >&5
-$as_echo "$ac_res" >&6; }
-as_val=`eval 'as_val=${'$as_ac_var'}
-		 $as_echo "$as_val"'`
-   if test "x$as_val" = x""yes; then
-  cat >>confdefs.h <<_ACEOF
-#define `$as_echo "HAVE_$ac_func" | $as_tr_cpp` 1
-_ACEOF
-
+CC=$ac_cv_prog_CC
+if test -n "$CC"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $CC" >&5
+$as_echo "$CC" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 fi
-done
 
-    if test $ac_cv_func_uuid_compare = yes; then
-	libuuid=""
-    else
 
-{ $as_echo "$as_me:$LINENO: checking for uuid_compare in -luuid" >&5
-$as_echo_n "checking for uuid_compare in -luuid... " >&6; }
-if test "${ac_cv_lib_uuid_uuid_compare+set}" = set; then
+    test -n "$CC" && break
+  done
+fi
+if test -z "$CC"; then
+  ac_ct_CC=$CC
+  for ac_prog in cl.exe
+do
+  # Extract the first word of "$ac_prog", so it can be a program name with args.
+set dummy $ac_prog; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_ac_ct_CC+:} false; then :
   $as_echo_n "(cached) " >&6
 else
-  ac_check_lib_save_LIBS=$LIBS
-LIBS="-luuid  $LIBS"
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-
-/* Override any GCC internal prototype to avoid an error.
-   Use char because int might match the return type of a GCC
-   builtin and then its argument prototype would still apply.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-char uuid_compare ();
-int
-main ()
-{
-return uuid_compare ();
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest$ac_exeext && {
-	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
-       }; then
-  ac_cv_lib_uuid_uuid_compare=yes
+  if test -n "$ac_ct_CC"; then
+  ac_cv_prog_ac_ct_CC="$ac_ct_CC" # Let the user override the test.
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_ac_ct_CC="$ac_prog"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
 
-	ac_cv_lib_uuid_uuid_compare=no
 fi
-
-rm -rf conftest.dSYM
-rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
-      conftest$ac_exeext conftest.$ac_ext
-LIBS=$ac_check_lib_save_LIBS
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_lib_uuid_uuid_compare" >&5
-$as_echo "$ac_cv_lib_uuid_uuid_compare" >&6; }
-if test "x$ac_cv_lib_uuid_uuid_compare" = x""yes; then
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_LIBUUID 1
-_ACEOF
-
-  LIBS="-luuid $LIBS"
-
+ac_ct_CC=$ac_cv_prog_ac_ct_CC
+if test -n "$ac_ct_CC"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_CC" >&5
+$as_echo "$ac_ct_CC" >&6; }
 else
-
-	    echo
-	    echo 'FATAL ERROR: could not find a valid UUID library.'
-	    echo 'Install the Universally Unique Identifiers library package.'
-	    exit 1
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 fi
 
-	libuuid="-luuid"
-    fi
-
-
 
+  test -n "$ac_ct_CC" && break
+done
 
-for ac_header in pthread.h
-do
-as_ac_Header=`$as_echo "ac_cv_header_$ac_header" | $as_tr_sh`
-if { as_var=$as_ac_Header; eval "test \"\${$as_var+set}\" = set"; }; then
-  { $as_echo "$as_me:$LINENO: checking for $ac_header" >&5
-$as_echo_n "checking for $ac_header... " >&6; }
-if { as_var=$as_ac_Header; eval "test \"\${$as_var+set}\" = set"; }; then
-  $as_echo_n "(cached) " >&6
-fi
-ac_res=`eval 'as_val=${'$as_ac_Header'}
-		 $as_echo "$as_val"'`
-	       { $as_echo "$as_me:$LINENO: result: $ac_res" >&5
-$as_echo "$ac_res" >&6; }
-else
-  # Is the header compilable?
-{ $as_echo "$as_me:$LINENO: checking $ac_header usability" >&5
-$as_echo_n "checking $ac_header usability... " >&6; }
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-$ac_includes_default
-#include <$ac_header>
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
+  if test "x$ac_ct_CC" = x; then
+    CC=""
+  else
+    case $cross_compiling:$ac_tool_warned in
+yes:)
+{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
+$as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
+ac_tool_warned=yes ;;
 esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_header_compiler=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+    CC=$ac_ct_CC
+  fi
+fi
 
-	ac_header_compiler=no
 fi
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-{ $as_echo "$as_me:$LINENO: result: $ac_header_compiler" >&5
-$as_echo "$ac_header_compiler" >&6; }
 
-# Is the header present?
-{ $as_echo "$as_me:$LINENO: checking $ac_header presence" >&5
-$as_echo_n "checking $ac_header presence... " >&6; }
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <$ac_header>
-_ACEOF
-if { (ac_try="$ac_cpp conftest.$ac_ext"
+test -z "$CC" && { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
+$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
+as_fn_error $? "no acceptable C compiler found in \$PATH
+See \`config.log' for more details" "$LINENO" 5; }
+
+# Provide some information about the compiler.
+$as_echo "$as_me:${as_lineno-$LINENO}: checking for C compiler version" >&5
+set X $ac_compile
+ac_compiler=$2
+for ac_option in --version -v -V -qversion; do
+  { { ac_try="$ac_compiler $ac_option >&5"
 case "(($ac_try" in
   *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
   *) ac_try_echo=$ac_try;;
 esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_cpp conftest.$ac_ext") 2>conftest.er1
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_compiler $ac_option >&5") 2>conftest.err
   ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } >/dev/null && {
-	 test -z "$ac_c_preproc_warn_flag$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       }; then
-  ac_header_preproc=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+  if test -s conftest.err; then
+    sed '10a\
+... rest of stderr output deleted ...
+         10q' conftest.err >conftest.er1
+    cat conftest.er1 >&5
+  fi
+  rm -f conftest.er1 conftest.err
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+done
 
-  ac_header_preproc=no
-fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether we are using the GNU C compiler" >&5
+$as_echo_n "checking whether we are using the GNU C compiler... " >&6; }
+if ${ac_cv_c_compiler_gnu+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
 
-rm -f conftest.err conftest.$ac_ext
-{ $as_echo "$as_me:$LINENO: result: $ac_header_preproc" >&5
-$as_echo "$ac_header_preproc" >&6; }
+int
+main ()
+{
+#ifndef __GNUC__
+       choke me
+#endif
 
-# So?  What about this header?
-case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in
-  yes:no: )
-    { $as_echo "$as_me:$LINENO: WARNING: $ac_header: accepted by the compiler, rejected by the preprocessor!" >&5
-$as_echo "$as_me: WARNING: $ac_header: accepted by the compiler, rejected by the preprocessor!" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: $ac_header: proceeding with the compiler's result" >&5
-$as_echo "$as_me: WARNING: $ac_header: proceeding with the compiler's result" >&2;}
-    ac_header_preproc=yes
-    ;;
-  no:yes:* )
-    { $as_echo "$as_me:$LINENO: WARNING: $ac_header: present but cannot be compiled" >&5
-$as_echo "$as_me: WARNING: $ac_header: present but cannot be compiled" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: $ac_header:     check for missing prerequisite headers?" >&5
-$as_echo "$as_me: WARNING: $ac_header:     check for missing prerequisite headers?" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: $ac_header: see the Autoconf documentation" >&5
-$as_echo "$as_me: WARNING: $ac_header: see the Autoconf documentation" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: $ac_header:     section \"Present But Cannot Be Compiled\"" >&5
-$as_echo "$as_me: WARNING: $ac_header:     section \"Present But Cannot Be Compiled\"" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: $ac_header: proceeding with the preprocessor's result" >&5
-$as_echo "$as_me: WARNING: $ac_header: proceeding with the preprocessor's result" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: $ac_header: in the future, the compiler will take precedence" >&5
-$as_echo "$as_me: WARNING: $ac_header: in the future, the compiler will take precedence" >&2;}
-    ( cat <<\_ASBOX
-## ---------------------------------------- ##
-## Report this to linux-xfs@vger.kernel.org ##
-## ---------------------------------------- ##
-_ASBOX
-     ) | sed "s/^/$as_me: WARNING:     /" >&2
-    ;;
-esac
-{ $as_echo "$as_me:$LINENO: checking for $ac_header" >&5
-$as_echo_n "checking for $ac_header... " >&6; }
-if { as_var=$as_ac_Header; eval "test \"\${$as_var+set}\" = set"; }; then
-  $as_echo_n "(cached) " >&6
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ac_compiler_gnu=yes
 else
-  eval "$as_ac_Header=\$ac_header_preproc"
+  ac_compiler_gnu=no
 fi
-ac_res=`eval 'as_val=${'$as_ac_Header'}
-		 $as_echo "$as_val"'`
-	       { $as_echo "$as_me:$LINENO: result: $ac_res" >&5
-$as_echo "$ac_res" >&6; }
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+ac_cv_c_compiler_gnu=$ac_compiler_gnu
 
 fi
-as_val=`eval 'as_val=${'$as_ac_Header'}
-		 $as_echo "$as_val"'`
-   if test "x$as_val" = x""yes; then
-  cat >>confdefs.h <<_ACEOF
-#define `$as_echo "HAVE_$ac_header" | $as_tr_cpp` 1
-_ACEOF
-
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_c_compiler_gnu" >&5
+$as_echo "$ac_cv_c_compiler_gnu" >&6; }
+if test $ac_compiler_gnu = yes; then
+  GCC=yes
+else
+  GCC=
 fi
-
-done
-
-    if test $ac_cv_header_pthread_h = no; then
-
-for ac_header in pthread.h
-do
-as_ac_Header=`$as_echo "ac_cv_header_$ac_header" | $as_tr_sh`
-if { as_var=$as_ac_Header; eval "test \"\${$as_var+set}\" = set"; }; then
-  { $as_echo "$as_me:$LINENO: checking for $ac_header" >&5
-$as_echo_n "checking for $ac_header... " >&6; }
-if { as_var=$as_ac_Header; eval "test \"\${$as_var+set}\" = set"; }; then
+ac_test_CFLAGS=${CFLAGS+set}
+ac_save_CFLAGS=$CFLAGS
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether $CC accepts -g" >&5
+$as_echo_n "checking whether $CC accepts -g... " >&6; }
+if ${ac_cv_prog_cc_g+:} false; then :
   $as_echo_n "(cached) " >&6
-fi
-ac_res=`eval 'as_val=${'$as_ac_Header'}
-		 $as_echo "$as_val"'`
-	       { $as_echo "$as_me:$LINENO: result: $ac_res" >&5
-$as_echo "$ac_res" >&6; }
 else
-  # Is the header compilable?
-{ $as_echo "$as_me:$LINENO: checking $ac_header usability" >&5
-$as_echo_n "checking $ac_header usability... " >&6; }
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  ac_save_c_werror_flag=$ac_c_werror_flag
+   ac_c_werror_flag=yes
+   ac_cv_prog_cc_g=no
+   CFLAGS="-g"
+   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
-$ac_includes_default
-#include <$ac_header>
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_header_compiler=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
 
-	ac_header_compiler=no
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-{ $as_echo "$as_me:$LINENO: result: $ac_header_compiler" >&5
-$as_echo "$ac_header_compiler" >&6; }
+int
+main ()
+{
 
-# Is the header present?
-{ $as_echo "$as_me:$LINENO: checking $ac_header presence" >&5
-$as_echo_n "checking $ac_header presence... " >&6; }
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <$ac_header>
+  ;
+  return 0;
+}
 _ACEOF
-if { (ac_try="$ac_cpp conftest.$ac_ext"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_cpp conftest.$ac_ext") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } >/dev/null && {
-	 test -z "$ac_c_preproc_warn_flag$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       }; then
-  ac_header_preproc=yes
+if ac_fn_c_try_compile "$LINENO"; then :
+  ac_cv_prog_cc_g=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+  CFLAGS=""
+      cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
 
-  ac_header_preproc=no
-fi
+int
+main ()
+{
 
-rm -f conftest.err conftest.$ac_ext
-{ $as_echo "$as_me:$LINENO: result: $ac_header_preproc" >&5
-$as_echo "$ac_header_preproc" >&6; }
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
 
-# So?  What about this header?
-case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in
-  yes:no: )
-    { $as_echo "$as_me:$LINENO: WARNING: $ac_header: accepted by the compiler, rejected by the preprocessor!" >&5
-$as_echo "$as_me: WARNING: $ac_header: accepted by the compiler, rejected by the preprocessor!" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: $ac_header: proceeding with the compiler's result" >&5
-$as_echo "$as_me: WARNING: $ac_header: proceeding with the compiler's result" >&2;}
-    ac_header_preproc=yes
-    ;;
-  no:yes:* )
-    { $as_echo "$as_me:$LINENO: WARNING: $ac_header: present but cannot be compiled" >&5
-$as_echo "$as_me: WARNING: $ac_header: present but cannot be compiled" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: $ac_header:     check for missing prerequisite headers?" >&5
-$as_echo "$as_me: WARNING: $ac_header:     check for missing prerequisite headers?" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: $ac_header: see the Autoconf documentation" >&5
-$as_echo "$as_me: WARNING: $ac_header: see the Autoconf documentation" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: $ac_header:     section \"Present But Cannot Be Compiled\"" >&5
-$as_echo "$as_me: WARNING: $ac_header:     section \"Present But Cannot Be Compiled\"" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: $ac_header: proceeding with the preprocessor's result" >&5
-$as_echo "$as_me: WARNING: $ac_header: proceeding with the preprocessor's result" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: $ac_header: in the future, the compiler will take precedence" >&5
-$as_echo "$as_me: WARNING: $ac_header: in the future, the compiler will take precedence" >&2;}
-    ( cat <<\_ASBOX
-## ---------------------------------------- ##
-## Report this to linux-xfs@vger.kernel.org ##
-## ---------------------------------------- ##
-_ASBOX
-     ) | sed "s/^/$as_me: WARNING:     /" >&2
-    ;;
-esac
-{ $as_echo "$as_me:$LINENO: checking for $ac_header" >&5
-$as_echo_n "checking for $ac_header... " >&6; }
-if { as_var=$as_ac_Header; eval "test \"\${$as_var+set}\" = set"; }; then
-  $as_echo_n "(cached) " >&6
 else
-  eval "$as_ac_Header=\$ac_header_preproc"
-fi
-ac_res=`eval 'as_val=${'$as_ac_Header'}
-		 $as_echo "$as_val"'`
-	       { $as_echo "$as_me:$LINENO: result: $ac_res" >&5
-$as_echo "$ac_res" >&6; }
+  ac_c_werror_flag=$ac_save_c_werror_flag
+	 CFLAGS="-g"
+	 cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
 
-fi
-as_val=`eval 'as_val=${'$as_ac_Header'}
-		 $as_echo "$as_val"'`
-   if test "x$as_val" = x""yes; then
-  cat >>confdefs.h <<_ACEOF
-#define `$as_echo "HAVE_$ac_header" | $as_tr_cpp` 1
-_ACEOF
+int
+main ()
+{
 
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ac_cv_prog_cc_g=yes
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+   ac_c_werror_flag=$ac_save_c_werror_flag
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_prog_cc_g" >&5
+$as_echo "$ac_cv_prog_cc_g" >&6; }
+if test "$ac_test_CFLAGS" = set; then
+  CFLAGS=$ac_save_CFLAGS
+elif test $ac_cv_prog_cc_g = yes; then
+  if test "$GCC" = yes; then
+    CFLAGS="-g -O2"
+  else
+    CFLAGS="-g"
+  fi
 else
-
-	echo
-	echo 'FATAL ERROR: could not find a valid pthread header.'
-	exit 1
+  if test "$GCC" = yes; then
+    CFLAGS="-O2"
+  else
+    CFLAGS=
+  fi
 fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $CC option to accept ISO C89" >&5
+$as_echo_n "checking for $CC option to accept ISO C89... " >&6; }
+if ${ac_cv_prog_cc_c89+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ac_cv_prog_cc_c89=no
+ac_save_CC=$CC
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <stdarg.h>
+#include <stdio.h>
+struct stat;
+/* Most of the following tests are stolen from RCS 5.7's src/conf.sh.  */
+struct buf { int x; };
+FILE * (*rcsopen) (struct buf *, struct stat *, int);
+static char *e (p, i)
+     char **p;
+     int i;
+{
+  return p[i];
+}
+static char *f (char * (*g) (char **, int), char **p, ...)
+{
+  char *s;
+  va_list v;
+  va_start (v,p);
+  s = g (p, va_arg (v,int));
+  va_end (v);
+  return s;
+}
 
-done
-
-    fi
-
+/* OSF 4.0 Compaq cc is some sort of almost-ANSI by default.  It has
+   function prototypes and stuff, but not '\xHH' hex character constants.
+   These don't provoke an error unfortunately, instead are silently treated
+   as 'x'.  The following induces an error, until -std is added to get
+   proper ANSI mode.  Curiously '\x00'!='x' always comes out true, for an
+   array size at least.  It's necessary to write '\x00'==0 to get something
+   that's true only with -std.  */
+int osf4_cc_array ['\x00' == 0 ? 1 : -1];
 
-{ $as_echo "$as_me:$LINENO: checking for pthread_mutex_init in -lpthread" >&5
-$as_echo_n "checking for pthread_mutex_init in -lpthread... " >&6; }
-if test "${ac_cv_lib_pthread_pthread_mutex_init+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  ac_check_lib_save_LIBS=$LIBS
-LIBS="-lpthread  $LIBS"
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
+/* IBM C 6 for AIX is almost-ANSI by default, but it replaces macro parameters
+   inside strings and character constants.  */
+#define FOO(x) 'x'
+int xlc6_cc_array[FOO(a) == 'x' ? 1 : -1];
 
-/* Override any GCC internal prototype to avoid an error.
-   Use char because int might match the return type of a GCC
-   builtin and then its argument prototype would still apply.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-char pthread_mutex_init ();
+int test (int i, double x);
+struct s1 {int (*f) (int a);};
+struct s2 {int (*f) (double a);};
+int pairnames (int, char **, FILE *(*)(struct buf *, struct stat *, int), int, int);
+int argc;
+char **argv;
 int
 main ()
 {
-return pthread_mutex_init ();
+return f (e, argv, 0) != argv[0]  ||  f (e, argv, 1) != argv[1];
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest$ac_exeext && {
-	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
-       }; then
-  ac_cv_lib_pthread_pthread_mutex_init=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_cv_lib_pthread_pthread_mutex_init=no
+for ac_arg in '' -qlanglvl=extc89 -qlanglvl=ansi -std \
+	-Ae "-Aa -D_HPUX_SOURCE" "-Xc -D__EXTENSIONS__"
+do
+  CC="$ac_save_CC $ac_arg"
+  if ac_fn_c_try_compile "$LINENO"; then :
+  ac_cv_prog_cc_c89=$ac_arg
 fi
+rm -f core conftest.err conftest.$ac_objext
+  test "x$ac_cv_prog_cc_c89" != "xno" && break
+done
+rm -f conftest.$ac_ext
+CC=$ac_save_CC
 
-rm -rf conftest.dSYM
-rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
-      conftest$ac_exeext conftest.$ac_ext
-LIBS=$ac_check_lib_save_LIBS
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_lib_pthread_pthread_mutex_init" >&5
-$as_echo "$ac_cv_lib_pthread_pthread_mutex_init" >&6; }
-if test "x$ac_cv_lib_pthread_pthread_mutex_init" = x""yes; then
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_LIBPTHREAD 1
-_ACEOF
-
-  LIBS="-lpthread $LIBS"
-
-else
-
-	echo
-	echo 'FATAL ERROR: could not find a valid pthread library.'
-	exit 1
+# AC_CACHE_VAL
+case "x$ac_cv_prog_cc_c89" in
+  x)
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: none needed" >&5
+$as_echo "none needed" >&6; } ;;
+  xno)
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: unsupported" >&5
+$as_echo "unsupported" >&6; } ;;
+  *)
+    CC="$CC $ac_cv_prog_cc_c89"
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_prog_cc_c89" >&5
+$as_echo "$ac_cv_prog_cc_c89" >&6; } ;;
+esac
+if test "x$ac_cv_prog_cc_c89" != xno; then :
 
 fi
 
-    libpthread=-lpthread
+ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
 
+    cc="$CC"
 
+     if test -z ""$cc""; then
+        echo
+        echo FATAL ERROR: cc does not seem to be installed.
+        echo xfsprogs cannot be built without a working C compiler installation.
+        exit 1
+    fi
 
- { $as_echo "$as_me:$LINENO: checking for fadvise " >&5
-$as_echo_n "checking for fadvise ... " >&6; }
-    cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
 
-#define _GNU_SOURCE
-#include <fcntl.h>
+    if test -z "$MAKE"; then
+        # Extract the first word of "gmake", so it can be a program name with args.
+set dummy gmake; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_path_MAKE+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  case $MAKE in
+  [\\/]* | ?:[\\/]*)
+  ac_cv_path_MAKE="$MAKE" # Let the user override the test with a path.
+  ;;
+  *)
+  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_path_MAKE="$as_dir/$ac_word$ac_exec_ext"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
 
-int
-main ()
-{
+  ;;
+esac
+fi
+MAKE=$ac_cv_path_MAKE
+if test -n "$MAKE"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $MAKE" >&5
+$as_echo "$MAKE" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
 
-	posix_fadvise(0, 1, 0, POSIX_FADV_NORMAL);
 
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  have_fadvise=yes
-	{ $as_echo "$as_me:$LINENO: result: yes" >&5
-$as_echo "yes" >&6; }
+    fi
+    if test -z "$MAKE"; then
+        # Extract the first word of "make", so it can be a program name with args.
+set dummy make; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_path_MAKE+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+  case $MAKE in
+  [\\/]* | ?:[\\/]*)
+  ac_cv_path_MAKE="$MAKE" # Let the user override the test with a path.
+  ;;
+  *)
+  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_path_MAKE="$as_dir/$ac_word$ac_exec_ext"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
 
-	{ $as_echo "$as_me:$LINENO: result: no" >&5
+  ;;
+esac
+fi
+MAKE=$ac_cv_path_MAKE
+if test -n "$MAKE"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $MAKE" >&5
+$as_echo "$MAKE" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-
 
- { $as_echo "$as_me:$LINENO: checking for madvise " >&5
-$as_echo_n "checking for madvise ... " >&6; }
-    cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
+    fi
+    make=$MAKE
 
-#define _GNU_SOURCE
-#include <sys/mman.h>
+     if test -z ""$make""; then
+        echo
+        echo FATAL ERROR: make does not seem to be installed.
+        echo xfsprogs cannot be built without a working GNU make installation.
+        exit 1
+    fi
 
-int
-main ()
-{
 
-	posix_madvise(0, 0, MADV_NORMAL);
+    if test -z "$TAR"; then
+        # Extract the first word of "tar", so it can be a program name with args.
+set dummy tar; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_path_TAR+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  case $TAR in
+  [\\/]* | ?:[\\/]*)
+  ac_cv_path_TAR="$TAR" # Let the user override the test with a path.
+  ;;
+  *)
+  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_path_TAR="$as_dir/$ac_word$ac_exec_ext"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
 
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
+  ;;
 esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  have_madvise=yes
-	{ $as_echo "$as_me:$LINENO: result: yes" >&5
-$as_echo "yes" >&6; }
+fi
+TAR=$ac_cv_path_TAR
+if test -n "$TAR"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $TAR" >&5
+$as_echo "$TAR" >&6; }
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	{ $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-
-
- { $as_echo "$as_me:$LINENO: checking for mincore " >&5
-$as_echo_n "checking for mincore ... " >&6; }
-    cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-
-#define _GNU_SOURCE
-#include <sys/mman.h>
 
-int
-main ()
-{
+    fi
+    tar=$TAR
 
-	mincore(0, 0, 0);
+    if test -z "$ZIP"; then
+        # Extract the first word of "gzip", so it can be a program name with args.
+set dummy gzip; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_path_ZIP+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  case $ZIP in
+  [\\/]* | ?:[\\/]*)
+  ac_cv_path_ZIP="$ZIP" # Let the user override the test with a path.
+  ;;
+  *)
+  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_path_ZIP="$as_dir/$ac_word$ac_exec_ext"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
 
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
+  ;;
 esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  have_mincore=yes
-	{ $as_echo "$as_me:$LINENO: result: yes" >&5
-$as_echo "yes" >&6; }
+fi
+ZIP=$ac_cv_path_ZIP
+if test -n "$ZIP"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ZIP" >&5
+$as_echo "$ZIP" >&6; }
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	{ $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
+    fi
+
+    zip=$ZIP
 
- { $as_echo "$as_me:$LINENO: checking for sendfile " >&5
-$as_echo_n "checking for sendfile ... " >&6; }
-    cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
 
-#define _GNU_SOURCE
-#include <sys/sendfile.h>
+    { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether gcc -MM is supported" >&5
+$as_echo_n "checking whether gcc -MM is supported... " >&6; }
+if ${ac_cv_gcc_nodeps+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat > conftest.c <<EOF
+		   #include <stdio.h>
+		   int main() { exit(0); }
+EOF
+                  ac_cv_gcc_nodeps=no
+                  if ${CC} -MM conftest.c >/dev/null 2>&1; then
+                     ac_cv_gcc_nodeps=yes
+                  fi
+                  rm -f conftest.c a.out
 
-int
-main ()
-{
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_gcc_nodeps" >&5
+$as_echo "$ac_cv_gcc_nodeps" >&6; }
 
-         sendfile(0, 0, 0, 0);
+    makedepend="$cc -MM"
+    if test $ac_cv_gcc_nodeps = no; then
+	makedepend=/bin/true
+    fi
 
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  have_sendfile=yes
-	{ $as_echo "$as_me:$LINENO: result: yes" >&5
-$as_echo "yes" >&6; }
+
+    if test -z "$AWK"; then
+        # Extract the first word of "awk", so it can be a program name with args.
+set dummy awk; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_path_AWK+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+  case $AWK in
+  [\\/]* | ?:[\\/]*)
+  ac_cv_path_AWK="$AWK" # Let the user override the test with a path.
+  ;;
+  *)
+  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+as_dummy="/bin:/usr/bin"
+for as_dir in $as_dummy
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_path_AWK="$as_dir/$ac_word$ac_exec_ext"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
 
-	{ $as_echo "$as_me:$LINENO: result: no" >&5
+  ;;
+esac
+fi
+AWK=$ac_cv_path_AWK
+if test -n "$AWK"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $AWK" >&5
+$as_echo "$AWK" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-
-
- { $as_echo "$as_me:$LINENO: checking for getmntent " >&5
-$as_echo_n "checking for getmntent ... " >&6; }
-    cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
 
-#include <stdio.h>
-#include <mntent.h>
+    fi
+    awk=$AWK
 
-int
-main ()
-{
 
-         getmntent(0);
+    if test -z "$SED"; then
+        # Extract the first word of "sed", so it can be a program name with args.
+set dummy sed; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_path_SED+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  case $SED in
+  [\\/]* | ?:[\\/]*)
+  ac_cv_path_SED="$SED" # Let the user override the test with a path.
+  ;;
+  *)
+  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+as_dummy="/bin:/usr/bin"
+for as_dir in $as_dummy
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_path_SED="$as_dir/$ac_word$ac_exec_ext"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
 
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
+  ;;
 esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  have_getmntent=yes
-       { $as_echo "$as_me:$LINENO: result: yes" >&5
-$as_echo "yes" >&6; }
+fi
+SED=$ac_cv_path_SED
+if test -n "$SED"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $SED" >&5
+$as_echo "$SED" >&6; }
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	{ $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-
-
- { $as_echo "$as_me:$LINENO: checking for getmntinfo " >&5
-$as_echo_n "checking for getmntinfo ... " >&6; }
-    cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
 
-#include <sys/param.h>
-#include <sys/ucred.h>
-#include <sys/mount.h>
+    fi
+    sed=$SED
 
-int
-main ()
-{
 
-         getmntinfo(0, 0);
+    if test -z "$ECHO"; then
+        # Extract the first word of "echo", so it can be a program name with args.
+set dummy echo; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_path_ECHO+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  case $ECHO in
+  [\\/]* | ?:[\\/]*)
+  ac_cv_path_ECHO="$ECHO" # Let the user override the test with a path.
+  ;;
+  *)
+  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+as_dummy="/bin:/usr/bin"
+for as_dir in $as_dummy
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_path_ECHO="$as_dir/$ac_word$ac_exec_ext"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
 
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
+  ;;
 esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  have_getmntinfo=yes
-       { $as_echo "$as_me:$LINENO: result: yes" >&5
-$as_echo "yes" >&6; }
+fi
+ECHO=$ac_cv_path_ECHO
+if test -n "$ECHO"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ECHO" >&5
+$as_echo "$ECHO" >&6; }
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	{ $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-
-
- { $as_echo "$as_me:$LINENO: checking for fallocate" >&5
-$as_echo_n "checking for fallocate... " >&6; }
-    cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
 
-#define _GNU_SOURCE
-#include <fcntl.h>
-#include <linux/falloc.h>
+    fi
+    echo=$ECHO
 
-int
-main ()
-{
 
-         fallocate(0, 0, 0, 0);
+    if test -z "$SORT"; then
+        # Extract the first word of "sort", so it can be a program name with args.
+set dummy sort; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_path_SORT+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  case $SORT in
+  [\\/]* | ?:[\\/]*)
+  ac_cv_path_SORT="$SORT" # Let the user override the test with a path.
+  ;;
+  *)
+  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+as_dummy="/bin:/usr/bin"
+for as_dir in $as_dummy
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_path_SORT="$as_dir/$ac_word$ac_exec_ext"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
 
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
+  ;;
 esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest$ac_exeext && {
-	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
-       }; then
-  have_fallocate=yes
-       { $as_echo "$as_me:$LINENO: result: yes" >&5
-$as_echo "yes" >&6; }
+fi
+SORT=$ac_cv_path_SORT
+if test -n "$SORT"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $SORT" >&5
+$as_echo "$SORT" >&6; }
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	{ $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
-rm -rf conftest.dSYM
-rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
-      conftest$ac_exeext conftest.$ac_ext
 
+    fi
+    sort=$SORT
 
- { $as_echo "$as_me:$LINENO: checking for fiemap" >&5
-$as_echo_n "checking for fiemap... " >&6; }
-    cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
 
-#define _GNU_SOURCE
-#include <linux/fs.h>
-#include <linux/fiemap.h>
+        { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether ln -s works" >&5
+$as_echo_n "checking whether ln -s works... " >&6; }
+LN_S=$as_ln_s
+if test "$LN_S" = "ln -s"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no, using $LN_S" >&5
+$as_echo "no, using $LN_S" >&6; }
+fi
 
-int
-main ()
-{
 
-         struct fiemap *fiemap;
-         ioctl(0, FS_IOC_FIEMAP, (unsigned long)fiemap);
+    if test "$enable_gettext" = yes; then
+        if test -z "$MSGFMT"; then
+                # Extract the first word of "msgfmt", so it can be a program name with args.
+set dummy msgfmt; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_path_MSGFMT+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  case $MSGFMT in
+  [\\/]* | ?:[\\/]*)
+  ac_cv_path_MSGFMT="$MSGFMT" # Let the user override the test with a path.
+  ;;
+  *)
+  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_path_MSGFMT="$as_dir/$ac_word$ac_exec_ext"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
 
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
+  ;;
 esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest$ac_exeext && {
-	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
-       }; then
-  have_fiemap=yes
-       { $as_echo "$as_me:$LINENO: result: yes" >&5
-$as_echo "yes" >&6; }
+fi
+MSGFMT=$ac_cv_path_MSGFMT
+if test -n "$MSGFMT"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $MSGFMT" >&5
+$as_echo "$MSGFMT" >&6; }
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	{ $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
-rm -rf conftest.dSYM
-rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
-      conftest$ac_exeext conftest.$ac_ext
 
+        fi
+        msgfmt=$MSGFMT
 
- { $as_echo "$as_me:$LINENO: checking for preadv" >&5
-$as_echo_n "checking for preadv... " >&6; }
-    cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-
-#define _BSD_SOURCE
-#include <sys/uio.h>
+         if test -z ""$msgfmt""; then
+        echo
+        echo FATAL ERROR: msgfmt does not seem to be installed.
+        echo xfsprogs cannot be built without a working gettext installation.
+        exit 1
+    fi
 
-int
-main ()
-{
 
-         preadv(0, 0, 0, 0);
+        if test -z "$MSGMERGE"; then
+                # Extract the first word of "msgmerge", so it can be a program name with args.
+set dummy msgmerge; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_path_MSGMERGE+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  case $MSGMERGE in
+  [\\/]* | ?:[\\/]*)
+  ac_cv_path_MSGMERGE="$MSGMERGE" # Let the user override the test with a path.
+  ;;
+  *)
+  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_path_MSGMERGE="$as_dir/$ac_word$ac_exec_ext"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
 
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
+  ;;
 esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest$ac_exeext && {
-	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
-       }; then
-  have_preadv=yes
-       { $as_echo "$as_me:$LINENO: result: yes" >&5
-$as_echo "yes" >&6; }
+fi
+MSGMERGE=$ac_cv_path_MSGMERGE
+if test -n "$MSGMERGE"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $MSGMERGE" >&5
+$as_echo "$MSGMERGE" >&6; }
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	{ $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
-rm -rf conftest.dSYM
-rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
-      conftest$ac_exeext conftest.$ac_ext
-
-
- { $as_echo "$as_me:$LINENO: checking for copy_file_range" >&5
-$as_echo_n "checking for copy_file_range... " >&6; }
-    cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
 
-#define _GNU_SOURCE
-#include <sys/syscall.h>
-#include <unistd.h>
+        fi
+        msgmerge=$MSGMERGE
 
-int
-main ()
-{
+         if test -z ""$msgmerge""; then
+        echo
+        echo FATAL ERROR: msgmerge does not seem to be installed.
+        echo xfsprogs cannot be built without a working gettext installation.
+        exit 1
+    fi
 
-         syscall(__NR_copy_file_range, 0, 0, 0, 0, 0, 0);
 
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest$ac_exeext && {
-	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
-       }; then
-  have_copy_file_range=yes
-       { $as_echo "$as_me:$LINENO: result: yes" >&5
-$as_echo "yes" >&6; }
+        if test -z "$XGETTEXT"; then
+                # Extract the first word of "xgettext", so it can be a program name with args.
+set dummy xgettext; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_path_XGETTEXT+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+  case $XGETTEXT in
+  [\\/]* | ?:[\\/]*)
+  ac_cv_path_XGETTEXT="$XGETTEXT" # Let the user override the test with a path.
+  ;;
+  *)
+  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_path_XGETTEXT="$as_dir/$ac_word$ac_exec_ext"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
 
-	{ $as_echo "$as_me:$LINENO: result: no" >&5
+  ;;
+esac
+fi
+XGETTEXT=$ac_cv_path_XGETTEXT
+if test -n "$XGETTEXT"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $XGETTEXT" >&5
+$as_echo "$XGETTEXT" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
-rm -rf conftest.dSYM
-rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
-      conftest$ac_exeext conftest.$ac_ext
-
 
- { $as_echo "$as_me:$LINENO: checking for sync_file_range" >&5
-$as_echo_n "checking for sync_file_range... " >&6; }
-    cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
+        fi
+        xgettext=$XGETTEXT
 
-#define _GNU_SOURCE
-#include <fcntl.h>
+         if test -z ""$xgettext""; then
+        echo
+        echo FATAL ERROR: xgettext does not seem to be installed.
+        echo xfsprogs cannot be built without a working gettext installation.
+        exit 1
+    fi
 
-int
-main ()
-{
+    fi
 
-         sync_file_range(0, 0, 0, 0);
+    if test -z "$RPM"; then
+        # Extract the first word of "rpm", so it can be a program name with args.
+set dummy rpm; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_path_RPM+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  case $RPM in
+  [\\/]* | ?:[\\/]*)
+  ac_cv_path_RPM="$RPM" # Let the user override the test with a path.
+  ;;
+  *)
+  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_path_RPM="$as_dir/$ac_word$ac_exec_ext"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
 
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
+  ;;
 esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest$ac_exeext && {
-	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
-       }; then
-  have_sync_file_range=yes
-       { $as_echo "$as_me:$LINENO: result: yes" >&5
-$as_echo "yes" >&6; }
+fi
+RPM=$ac_cv_path_RPM
+if test -n "$RPM"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $RPM" >&5
+$as_echo "$RPM" >&6; }
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	{ $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
-rm -rf conftest.dSYM
-rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
-      conftest$ac_exeext conftest.$ac_ext
 
+    fi
+    rpm=$RPM
 
 
-for ac_header in mntent.h
-do
-as_ac_Header=`$as_echo "ac_cv_header_$ac_header" | $as_tr_sh`
-if { as_var=$as_ac_Header; eval "test \"\${$as_var+set}\" = set"; }; then
-  { $as_echo "$as_me:$LINENO: checking for $ac_header" >&5
-$as_echo_n "checking for $ac_header... " >&6; }
-if { as_var=$as_ac_Header; eval "test \"\${$as_var+set}\" = set"; }; then
+        rpm_version=0
+    test -n "$RPM" && test -x "$RPM" && rpm_version=`$RPM --version \
+                        | awk '{print $NF}' | awk -F. '{V=1; print $V}'`
+
+                if test $rpm_version -ge 4; then
+        # Extract the first word of "rpmbuild", so it can be a program name with args.
+set dummy rpmbuild; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_path_RPMBUILD+:} false; then :
   $as_echo_n "(cached) " >&6
-fi
-ac_res=`eval 'as_val=${'$as_ac_Header'}
-		 $as_echo "$as_val"'`
-	       { $as_echo "$as_me:$LINENO: result: $ac_res" >&5
-$as_echo "$ac_res" >&6; }
 else
-  # Is the header compilable?
-{ $as_echo "$as_me:$LINENO: checking $ac_header usability" >&5
-$as_echo_n "checking $ac_header usability... " >&6; }
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-$ac_includes_default
-#include <$ac_header>
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
+  case $RPMBUILD in
+  [\\/]* | ?:[\\/]*)
+  ac_cv_path_RPMBUILD="$RPMBUILD" # Let the user override the test with a path.
+  ;;
+  *)
+  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_path_RPMBUILD="$as_dir/$ac_word$ac_exec_ext"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
+
+  ;;
 esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_header_compiler=yes
+fi
+RPMBUILD=$ac_cv_path_RPMBUILD
+if test -n "$RPMBUILD"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $RPMBUILD" >&5
+$as_echo "$RPMBUILD" >&6; }
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_header_compiler=no
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 fi
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-{ $as_echo "$as_me:$LINENO: result: $ac_header_compiler" >&5
-$as_echo "$ac_header_compiler" >&6; }
 
-# Is the header present?
-{ $as_echo "$as_me:$LINENO: checking $ac_header presence" >&5
-$as_echo_n "checking $ac_header presence... " >&6; }
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <$ac_header>
-_ACEOF
-if { (ac_try="$ac_cpp conftest.$ac_ext"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_cpp conftest.$ac_ext") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } >/dev/null && {
-	 test -z "$ac_c_preproc_warn_flag$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       }; then
-  ac_header_preproc=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+        rpmbuild=$RPMBUILD
+    else
+        rpmbuild=$RPM
+    fi
 
-  ac_header_preproc=no
-fi
 
-rm -f conftest.err conftest.$ac_ext
-{ $as_echo "$as_me:$LINENO: result: $ac_header_preproc" >&5
-$as_echo "$ac_header_preproc" >&6; }
 
-# So?  What about this header?
-case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in
-  yes:no: )
-    { $as_echo "$as_me:$LINENO: WARNING: $ac_header: accepted by the compiler, rejected by the preprocessor!" >&5
-$as_echo "$as_me: WARNING: $ac_header: accepted by the compiler, rejected by the preprocessor!" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: $ac_header: proceeding with the compiler's result" >&5
-$as_echo "$as_me: WARNING: $ac_header: proceeding with the compiler's result" >&2;}
-    ac_header_preproc=yes
-    ;;
-  no:yes:* )
-    { $as_echo "$as_me:$LINENO: WARNING: $ac_header: present but cannot be compiled" >&5
-$as_echo "$as_me: WARNING: $ac_header: present but cannot be compiled" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: $ac_header:     check for missing prerequisite headers?" >&5
-$as_echo "$as_me: WARNING: $ac_header:     check for missing prerequisite headers?" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: $ac_header: see the Autoconf documentation" >&5
-$as_echo "$as_me: WARNING: $ac_header: see the Autoconf documentation" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: $ac_header:     section \"Present But Cannot Be Compiled\"" >&5
-$as_echo "$as_me: WARNING: $ac_header:     section \"Present But Cannot Be Compiled\"" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: $ac_header: proceeding with the preprocessor's result" >&5
-$as_echo "$as_me: WARNING: $ac_header: proceeding with the preprocessor's result" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: $ac_header: in the future, the compiler will take precedence" >&5
-$as_echo "$as_me: WARNING: $ac_header: in the future, the compiler will take precedence" >&2;}
-    ( cat <<\_ASBOX
-## ---------------------------------------- ##
-## Report this to linux-xfs@vger.kernel.org ##
-## ---------------------------------------- ##
-_ASBOX
-     ) | sed "s/^/$as_me: WARNING:     /" >&2
-    ;;
-esac
-{ $as_echo "$as_me:$LINENO: checking for $ac_header" >&5
-$as_echo_n "checking for $ac_header... " >&6; }
-if { as_var=$as_ac_Header; eval "test \"\${$as_var+set}\" = set"; }; then
-  $as_echo_n "(cached) " >&6
-else
-  eval "$as_ac_Header=\$ac_header_preproc"
-fi
-ac_res=`eval 'as_val=${'$as_ac_Header'}
-		 $as_echo "$as_val"'`
-	       { $as_echo "$as_me:$LINENO: result: $ac_res" >&5
-$as_echo "$ac_res" >&6; }
+                  enable_lib64="$enable_lib64"
+  libdirsuffix=""
+  searchpath=`(LC_ALL=C $CC -print-search-dirs) 2>/dev/null | sed -n -e 's,^libraries: ,,p' | sed -e 's,^=,,'`
+  if test "$enable_lib64" = "yes" -a -n "$searchpath"; then
+    save_IFS="${IFS= 	}"; IFS=":"
+    for searchdir in $searchpath; do
+      if test -d "$searchdir"; then
+        case "$searchdir" in
+          */lib64/ | */lib64 ) libdirsuffix=64 ;;
+          *) searchdir=`cd "$searchdir" && pwd`
+             case "$searchdir" in
+               */lib64 ) libdirsuffix=64 ;;
+             esac ;;
+        esac
+      fi
+    done
+    IFS="$save_IFS"
+  fi
 
-fi
-as_val=`eval 'as_val=${'$as_ac_Header'}
-		 $as_echo "$as_val"'`
-   if test "x$as_val" = x""yes; then
+
+
+  if test "$enable_librt" = "yes"; then
+    librt="-lrt"
+  else
+    librt=""
+  fi
+
+
+
+ for ac_header in uuid.h sys/uuid.h uuid/uuid.h
+do :
+  as_ac_Header=`$as_echo "ac_cv_header_$ac_header" | $as_tr_sh`
+ac_fn_c_check_header_mongrel "$LINENO" "$ac_header" "$as_ac_Header" "$ac_includes_default"
+if eval test \"x\$"$as_ac_Header"\" = x"yes"; then :
   cat >>confdefs.h <<_ACEOF
 #define `$as_echo "HAVE_$ac_header" | $as_tr_cpp` 1
 _ACEOF
- have_mntent=yes
+
 fi
 
 done
 
+    if test $ac_cv_header_uuid_h = no -a \
+	    $ac_cv_header_sys_uuid_h = no -a \
+	    $ac_cv_header_uuid_uuid_h = no; then
+	echo
+	echo 'FATAL ERROR: could not find a valid UUID header.'
+	echo 'Install the Universally Unique Identifiers development package.'
+	exit 1
+    fi
+
+ for ac_func in uuid_compare
+do :
+  ac_fn_c_check_func "$LINENO" "uuid_compare" "ac_cv_func_uuid_compare"
+if test "x$ac_cv_func_uuid_compare" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_UUID_COMPARE 1
+_ACEOF
 
+fi
+done
 
- { $as_echo "$as_me:$LINENO: checking whether fls is declared" >&5
-$as_echo_n "checking whether fls is declared... " >&6; }
-if test "${ac_cv_have_decl_fls+set}" = set; then
+    if test $ac_cv_func_uuid_compare = yes; then
+	libuuid=""
+    else
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for uuid_compare in -luuid" >&5
+$as_echo_n "checking for uuid_compare in -luuid... " >&6; }
+if ${ac_cv_lib_uuid_uuid_compare+:} false; then :
   $as_echo_n "(cached) " >&6
 else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-luuid  $LIBS"
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
-#include <string.h>
-
 
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+char uuid_compare ();
 int
 main ()
 {
-#ifndef fls
-  (void) fls;
-#endif
-
+return uuid_compare ();
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_cv_have_decl_fls=yes
+if ac_fn_c_try_link "$LINENO"; then :
+  ac_cv_lib_uuid_uuid_compare=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_cv_have_decl_fls=no
+  ac_cv_lib_uuid_uuid_compare=no
 fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_have_decl_fls" >&5
-$as_echo "$ac_cv_have_decl_fls" >&6; }
-if test "x$ac_cv_have_decl_fls" = x""yes; then
-  have_fls=yes
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_uuid_uuid_compare" >&5
+$as_echo "$ac_cv_lib_uuid_uuid_compare" >&6; }
+if test "x$ac_cv_lib_uuid_uuid_compare" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_LIBUUID 1
+_ACEOF
+
+  LIBS="-luuid $LIBS"
+
+else
+
+	    echo
+	    echo 'FATAL ERROR: could not find a valid UUID library.'
+	    echo 'Install the Universally Unique Identifiers library package.'
+	    exit 1
 fi
 
+	libuuid="-luuid"
+    fi
+
 
 
- { $as_echo "$as_me:$LINENO: checking for readdir" >&5
-$as_echo_n "checking for readdir... " >&6; }
-    cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
+ for ac_header in pthread.h
+do :
+  ac_fn_c_check_header_mongrel "$LINENO" "pthread.h" "ac_cv_header_pthread_h" "$ac_includes_default"
+if test "x$ac_cv_header_pthread_h" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_PTHREAD_H 1
 _ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
 
-#include <dirent.h>
-
-int
-main ()
-{
+fi
 
-         readdir(0);
+done
 
-  ;
-  return 0;
-}
+    if test $ac_cv_header_pthread_h = no; then
+	for ac_header in pthread.h
+do :
+  ac_fn_c_check_header_mongrel "$LINENO" "pthread.h" "ac_cv_header_pthread_h" "$ac_includes_default"
+if test "x$ac_cv_header_pthread_h" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_PTHREAD_H 1
 _ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest$ac_exeext && {
-	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
-       }; then
-  have_readdir=yes
-       { $as_echo "$as_me:$LINENO: result: yes" >&5
-$as_echo "yes" >&6; }
+
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
 
-	{ $as_echo "$as_me:$LINENO: result: no" >&5
-$as_echo "no" >&6; }
+	echo
+	echo 'FATAL ERROR: could not find a valid pthread header.'
+	exit 1
 fi
 
-rm -rf conftest.dSYM
-rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
-      conftest$ac_exeext conftest.$ac_ext
+done
 
+    fi
 
- { $as_echo "$as_me:$LINENO: checking whether fsetxattr is declared" >&5
-$as_echo_n "checking whether fsetxattr is declared... " >&6; }
-if test "${ac_cv_have_decl_fsetxattr+set}" = set; then
+ { $as_echo "$as_me:${as_lineno-$LINENO}: checking for pthread_mutex_init in -lpthread" >&5
+$as_echo_n "checking for pthread_mutex_init in -lpthread... " >&6; }
+if ${ac_cv_lib_pthread_pthread_mutex_init+:} false; then :
   $as_echo_n "(cached) " >&6
 else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-lpthread  $LIBS"
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
-#include <sys/types.h>
-        #include <attr/xattr.h>
-
 
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+char pthread_mutex_init ();
 int
 main ()
 {
-#ifndef fsetxattr
-  (void) fsetxattr;
-#endif
-
+return pthread_mutex_init ();
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_cv_have_decl_fsetxattr=yes
+if ac_fn_c_try_link "$LINENO"; then :
+  ac_cv_lib_pthread_pthread_mutex_init=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_cv_have_decl_fsetxattr=no
+  ac_cv_lib_pthread_pthread_mutex_init=no
 fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_have_decl_fsetxattr" >&5
-$as_echo "$ac_cv_have_decl_fsetxattr" >&6; }
-if test "x$ac_cv_have_decl_fsetxattr" = x""yes; then
-  have_fsetxattr=yes
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_pthread_pthread_mutex_init" >&5
+$as_echo "$ac_cv_lib_pthread_pthread_mutex_init" >&6; }
+if test "x$ac_cv_lib_pthread_pthread_mutex_init" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_LIBPTHREAD 1
+_ACEOF
+
+  LIBS="-lpthread $LIBS"
+
+else
+
+	echo
+	echo 'FATAL ERROR: could not find a valid pthread library.'
+	exit 1
+
 fi
 
+    libpthread=-lpthread
+
 
 
- { $as_echo "$as_me:$LINENO: checking whether mremap is declared" >&5
-$as_echo_n "checking whether mremap is declared... " >&6; }
-if test "${ac_cv_have_decl_mremap+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+ { $as_echo "$as_me:${as_lineno-$LINENO}: checking for fadvise " >&5
+$as_echo_n "checking for fadvise ... " >&6; }
+    cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
-#define _GNU_SOURCE
-        #include <sys/mman.h>
 
+#define _GNU_SOURCE
+#include <fcntl.h>
 
 int
 main ()
 {
-#ifndef mremap
-  (void) mremap;
-#endif
+
+	posix_fadvise(0, 1, 0, POSIX_FADV_NORMAL);
 
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_cv_have_decl_mremap=yes
+if ac_fn_c_try_compile "$LINENO"; then :
+  have_fadvise=yes
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_cv_have_decl_mremap=no
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_have_decl_mremap" >&5
-$as_echo "$ac_cv_have_decl_mremap" >&6; }
-if test "x$ac_cv_have_decl_mremap" = x""yes; then
-  have_mremap=yes
-fi
-
-
 
 
-    { $as_echo "$as_me:$LINENO: checking for struct fsxattr" >&5
-$as_echo_n "checking for struct fsxattr... " >&6; }
-if test "${ac_cv_type_struct_fsxattr+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  ac_cv_type_struct_fsxattr=no
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+ { $as_echo "$as_me:${as_lineno-$LINENO}: checking for madvise " >&5
+$as_echo_n "checking for madvise ... " >&6; }
+    cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
-#include <linux/fs.h>
 
+#define _GNU_SOURCE
+#include <sys/mman.h>
 
 int
 main ()
 {
-if (sizeof (struct fsxattr))
-       return 0;
+
+	posix_madvise(0, 0, MADV_NORMAL);
+
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  have_madvise=yes
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+
+
+ { $as_echo "$as_me:${as_lineno-$LINENO}: checking for mincore " >&5
+$as_echo_n "checking for mincore ... " >&6; }
+    cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
-#include <linux/fs.h>
 
+#define _GNU_SOURCE
+#include <sys/mman.h>
 
 int
 main ()
 {
-if (sizeof ((struct fsxattr)))
-	  return 0;
+
+	mincore(0, 0, 0);
+
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  :
+if ac_fn_c_try_compile "$LINENO"; then :
+  have_mincore=yes
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_cv_type_struct_fsxattr=yes
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-
-fi
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_type_struct_fsxattr" >&5
-$as_echo "$ac_cv_type_struct_fsxattr" >&6; }
-if test "x$ac_cv_type_struct_fsxattr" = x""yes; then
 
-        { $as_echo "$as_me:$LINENO: checking for struct fsxattr.fsx_cowextsize" >&5
-$as_echo_n "checking for struct fsxattr.fsx_cowextsize... " >&6; }
-if test "${ac_cv_member_struct_fsxattr_fsx_cowextsize+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+ { $as_echo "$as_me:${as_lineno-$LINENO}: checking for sendfile " >&5
+$as_echo_n "checking for sendfile ... " >&6; }
+    cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
-#include <linux/fs.h>
 
+#define _GNU_SOURCE
+#include <sys/sendfile.h>
 
 int
 main ()
 {
-static struct fsxattr ac_aggr;
-if (ac_aggr.fsx_cowextsize)
-return 0;
+
+         sendfile(0, 0, 0, 0);
+
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_cv_member_struct_fsxattr_fsx_cowextsize=yes
+if ac_fn_c_try_compile "$LINENO"; then :
+  have_sendfile=yes
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
-	cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+
+ { $as_echo "$as_me:${as_lineno-$LINENO}: checking for getmntent " >&5
+$as_echo_n "checking for getmntent ... " >&6; }
+    cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
-#include <linux/fs.h>
 
+#include <stdio.h>
+#include <mntent.h>
 
 int
 main ()
 {
-static struct fsxattr ac_aggr;
-if (sizeof ac_aggr.fsx_cowextsize)
-return 0;
+
+         getmntent(0);
+
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_cv_member_struct_fsxattr_fsx_cowextsize=yes
+if ac_fn_c_try_compile "$LINENO"; then :
+  have_getmntent=yes
+       { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_cv_member_struct_fsxattr_fsx_cowextsize=no
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_member_struct_fsxattr_fsx_cowextsize" >&5
-$as_echo "$ac_cv_member_struct_fsxattr_fsx_cowextsize" >&6; }
-if test "x$ac_cv_member_struct_fsxattr_fsx_cowextsize" = x""yes; then
-  :
-else
-  need_internal_fsxattr=yes
-fi
-
-
-fi
 
 
-
-
-if test "$enable_blkid" = yes; then
-
-  { $as_echo "$as_me:$LINENO: checking for library containing blkid_probe_all" >&5
-$as_echo_n "checking for library containing blkid_probe_all... " >&6; }
-if test "${ac_cv_search_blkid_probe_all+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  ac_func_search_save_LIBS=$LIBS
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+ { $as_echo "$as_me:${as_lineno-$LINENO}: checking for getmntinfo " >&5
+$as_echo_n "checking for getmntinfo ... " >&6; }
+    cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
-/* Override any GCC internal prototype to avoid an error.
-   Use char because int might match the return type of a GCC
-   builtin and then its argument prototype would still apply.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-char blkid_probe_all ();
+#include <sys/param.h>
+#include <sys/ucred.h>
+#include <sys/mount.h>
+
 int
 main ()
 {
-return blkid_probe_all ();
+
+         getmntinfo(0, 0);
+
   ;
   return 0;
 }
 _ACEOF
-for ac_lib in '' blkid; do
-  if test -z "$ac_lib"; then
-    ac_res="none required"
-  else
-    ac_res=-l$ac_lib
-    LIBS="-l$ac_lib  $ac_func_search_save_LIBS"
-  fi
-  rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest$ac_exeext && {
-	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
-       }; then
-  ac_cv_search_blkid_probe_all=$ac_res
+if ac_fn_c_try_compile "$LINENO"; then :
+  have_getmntinfo=yes
+       { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
-fi
+ { $as_echo "$as_me:${as_lineno-$LINENO}: checking for fallocate" >&5
+$as_echo_n "checking for fallocate... " >&6; }
+    cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
 
-rm -rf conftest.dSYM
-rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
-      conftest$ac_exeext
-  if test "${ac_cv_search_blkid_probe_all+set}" = set; then
-  break
-fi
-done
-if test "${ac_cv_search_blkid_probe_all+set}" = set; then
-  :
-else
-  ac_cv_search_blkid_probe_all=no
-fi
-rm conftest.$ac_ext
-LIBS=$ac_func_search_save_LIBS
-fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_search_blkid_probe_all" >&5
-$as_echo "$ac_cv_search_blkid_probe_all" >&6; }
-ac_res=$ac_cv_search_blkid_probe_all
-if test "$ac_res" != no; then
-  test "$ac_res" = "none required" || LIBS="$ac_res $LIBS"
+#define _GNU_SOURCE
+#include <fcntl.h>
+#include <linux/falloc.h>
 
-fi
+int
+main ()
+{
 
+         fallocate(0, 0, 0, 0);
 
-for ac_func in blkid_probe_get_topology
-do
-as_ac_var=`$as_echo "ac_cv_func_$ac_func" | $as_tr_sh`
-{ $as_echo "$as_me:$LINENO: checking for $ac_func" >&5
-$as_echo_n "checking for $ac_func... " >&6; }
-if { as_var=$as_ac_var; eval "test \"\${$as_var+set}\" = set"; }; then
-  $as_echo_n "(cached) " >&6
-else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
+  ;
+  return 0;
+}
 _ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-/* Define $ac_func to an innocuous variant, in case <limits.h> declares $ac_func.
-   For example, HP-UX 11i <limits.h> declares gettimeofday.  */
-#define $ac_func innocuous_$ac_func
-
-/* System header to define __stub macros and hopefully few prototypes,
-    which can conflict with char $ac_func (); below.
-    Prefer <limits.h> to <assert.h> if __STDC__ is defined, since
-    <limits.h> exists even on freestanding compilers.  */
+if ac_fn_c_try_link "$LINENO"; then :
+  have_fallocate=yes
+       { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
 
-#ifdef __STDC__
-# include <limits.h>
-#else
-# include <assert.h>
-#endif
 
-#undef $ac_func
+ { $as_echo "$as_me:${as_lineno-$LINENO}: checking for fiemap" >&5
+$as_echo_n "checking for fiemap... " >&6; }
+    cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
 
-/* Override any GCC internal prototype to avoid an error.
-   Use char because int might match the return type of a GCC
-   builtin and then its argument prototype would still apply.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-char $ac_func ();
-/* The GNU C library defines this for functions which it implements
-    to always fail with ENOSYS.  Some functions are actually named
-    something starting with __ and the normal name is an alias.  */
-#if defined __stub_$ac_func || defined __stub___$ac_func
-choke me
-#endif
+#define _GNU_SOURCE
+#include <linux/fs.h>
+#include <linux/fiemap.h>
 
 int
 main ()
 {
-return $ac_func ();
+
+         struct fiemap *fiemap;
+         ioctl(0, FS_IOC_FIEMAP, (unsigned long)fiemap);
+
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest$ac_exeext && {
-	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
-       }; then
-  eval "$as_ac_var=yes"
+if ac_fn_c_try_link "$LINENO"; then :
+  have_fiemap=yes
+       { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	eval "$as_ac_var=no"
-fi
-
-rm -rf conftest.dSYM
-rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
-      conftest$ac_exeext conftest.$ac_ext
-fi
-ac_res=`eval 'as_val=${'$as_ac_var'}
-		 $as_echo "$as_val"'`
-	       { $as_echo "$as_me:$LINENO: result: $ac_res" >&5
-$as_echo "$ac_res" >&6; }
-as_val=`eval 'as_val=${'$as_ac_var'}
-		 $as_echo "$as_val"'`
-   if test "x$as_val" = x""yes; then
-  cat >>confdefs.h <<_ACEOF
-#define `$as_echo "HAVE_$ac_func" | $as_tr_cpp` 1
-_ACEOF
-
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 fi
-done
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
 
-  if test $ac_cv_func_blkid_probe_get_topology = yes; then
-    libblkid="-lblkid"
-  else
-    echo
-    echo 'FATAL ERROR: could not find a valid BLKID header.'
-    echo 'Install the Block device ID development package.'
-    exit 1
-  fi
 
+ { $as_echo "$as_me:${as_lineno-$LINENO}: checking for pwritev2" >&5
+$as_echo_n "checking for pwritev2... " >&6; }
+    cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
 
-fi
+#define _BSD_SOURCE
+#include <sys/uio.h>
 
-# The cast to long int works around a bug in the HP C Compiler
-# version HP92453-01 B.11.11.23709.GP, which incorrectly rejects
-# declarations like `int a3[[(sizeof (unsigned char)) >= 0]];'.
-# This bug is HP SR number 8606223364.
-{ $as_echo "$as_me:$LINENO: checking size of long" >&5
-$as_echo_n "checking size of long... " >&6; }
-if test "${ac_cv_sizeof_long+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  if test "$cross_compiling" = yes; then
-  # Depending upon the size, compute the lo and hi bounds.
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-$ac_includes_default
 int
 main ()
 {
-static int test_array [1 - 2 * !(((long int) (sizeof (long))) >= 0)];
-test_array [0] = 0
+
+         pwritev2(0, 0, 0, 0, 0);
 
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_lo=0 ac_mid=0
-  while :; do
-    cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+if ac_fn_c_try_link "$LINENO"; then :
+  have_pwritev2=yes
+       { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+
+
+ { $as_echo "$as_me:${as_lineno-$LINENO}: checking for preadv" >&5
+$as_echo_n "checking for preadv... " >&6; }
+    cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
-$ac_includes_default
+
+#define _BSD_SOURCE
+#define _DEFAULT_SOURCE
+#include <sys/uio.h>
+
 int
 main ()
 {
-static int test_array [1 - 2 * !(((long int) (sizeof (long))) <= $ac_mid)];
-test_array [0] = 0
+
+         preadv(0, 0, 0, 0);
 
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_hi=$ac_mid; break
+if ac_fn_c_try_link "$LINENO"; then :
+  have_preadv=yes
+       { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_lo=`expr $ac_mid + 1`
-			if test $ac_lo -le $ac_mid; then
-			  ac_lo= ac_hi=
-			  break
-			fi
-			ac_mid=`expr 2 '*' $ac_mid + 1`
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-  done
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
 
-	cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+ { $as_echo "$as_me:${as_lineno-$LINENO}: checking for copy_file_range" >&5
+$as_echo_n "checking for copy_file_range... " >&6; }
+    cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
-$ac_includes_default
+
+#define _GNU_SOURCE
+#include <sys/syscall.h>
+#include <unistd.h>
+
 int
 main ()
 {
-static int test_array [1 - 2 * !(((long int) (sizeof (long))) < 0)];
-test_array [0] = 0
+
+         syscall(__NR_copy_file_range, 0, 0, 0, 0, 0, 0);
 
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_hi=-1 ac_mid=-1
-  while :; do
-    cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+if ac_fn_c_try_link "$LINENO"; then :
+  have_copy_file_range=yes
+       { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+
+
+ { $as_echo "$as_me:${as_lineno-$LINENO}: checking for sync_file_range" >&5
+$as_echo_n "checking for sync_file_range... " >&6; }
+    cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
-$ac_includes_default
+
+#define _GNU_SOURCE
+#include <fcntl.h>
+
 int
 main ()
 {
-static int test_array [1 - 2 * !(((long int) (sizeof (long))) >= $ac_mid)];
-test_array [0] = 0
+
+         sync_file_range(0, 0, 0, 0);
 
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_lo=$ac_mid; break
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_hi=`expr '(' $ac_mid ')' - 1`
-			if test $ac_mid -le $ac_hi; then
-			  ac_lo= ac_hi=
-			  break
-			fi
-			ac_mid=`expr 2 '*' $ac_mid`
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-  done
+if ac_fn_c_try_link "$LINENO"; then :
+  have_sync_file_range=yes
+       { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_lo= ac_hi=
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-# Binary search between lo and hi bounds.
-while test "x$ac_lo" != "x$ac_hi"; do
-  ac_mid=`expr '(' $ac_hi - $ac_lo ')' / 2 + $ac_lo`
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+
+ { $as_echo "$as_me:${as_lineno-$LINENO}: checking for syncfs" >&5
+$as_echo_n "checking for syncfs... " >&6; }
+    cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
-$ac_includes_default
+
+#define _GNU_SOURCE
+#include <unistd.h>
+
 int
 main ()
 {
-static int test_array [1 - 2 * !(((long int) (sizeof (long))) <= $ac_mid)];
-test_array [0] = 0
+
+         syncfs(0);
 
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_hi=$ac_mid
+if ac_fn_c_try_link "$LINENO"; then :
+  have_syncfs=yes
+       { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
 
-	ac_lo=`expr '(' $ac_mid ')' + 1`
+
+ for ac_header in mntent.h
+do :
+  ac_fn_c_check_header_mongrel "$LINENO" "mntent.h" "ac_cv_header_mntent_h" "$ac_includes_default"
+if test "x$ac_cv_header_mntent_h" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_MNTENT_H 1
+_ACEOF
+ have_mntent=yes
 fi
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 done
-case $ac_lo in
-?*) ac_cv_sizeof_long=$ac_lo;;
-'') if test "$ac_cv_type_long" = yes; then
-     { { $as_echo "$as_me:$LINENO: error: in \`$ac_pwd':" >&5
-$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-{ { $as_echo "$as_me:$LINENO: error: cannot compute sizeof (long)
-See \`config.log' for more details." >&5
-$as_echo "$as_me: error: cannot compute sizeof (long)
-See \`config.log' for more details." >&2;}
-   { (exit 77); exit 77; }; }; }
-   else
-     ac_cv_sizeof_long=0
-   fi ;;
-esac
-else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+
+
+
+ ac_fn_c_check_decl "$LINENO" "fls" "ac_cv_have_decl_fls" "#include <string.h>
+
+"
+if test "x$ac_cv_have_decl_fls" = xyes; then :
+  have_fls=yes
+fi
+
+
+
+ { $as_echo "$as_me:${as_lineno-$LINENO}: checking for readdir" >&5
+$as_echo_n "checking for readdir... " >&6; }
+    cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
-$ac_includes_default
-static long int longval () { return (long int) (sizeof (long)); }
-static unsigned long int ulongval () { return (long int) (sizeof (long)); }
-#include <stdio.h>
-#include <stdlib.h>
+
+#include <dirent.h>
+
 int
 main ()
 {
 
-  FILE *f = fopen ("conftest.val", "w");
-  if (! f)
-    return 1;
-  if (((long int) (sizeof (long))) < 0)
-    {
-      long int i = longval ();
-      if (i != ((long int) (sizeof (long))))
-	return 1;
-      fprintf (f, "%ld", i);
-    }
-  else
-    {
-      unsigned long int i = ulongval ();
-      if (i != ((long int) (sizeof (long))))
-	return 1;
-      fprintf (f, "%lu", i);
-    }
-  /* Do not output a trailing newline, as this causes \r\n confusion
-     on some platforms.  */
-  return ferror (f) || fclose (f) != 0;
+         readdir(0);
 
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
-  ac_cv_sizeof_long=`cat conftest.val`
+if ac_fn_c_try_link "$LINENO"; then :
+  have_readdir=yes
+       { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
 else
-  $as_echo "$as_me: program exited with status $ac_status" >&5
-$as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-( exit $ac_status )
-if test "$ac_cv_type_long" = yes; then
-     { { $as_echo "$as_me:$LINENO: error: in \`$ac_pwd':" >&5
-$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-{ { $as_echo "$as_me:$LINENO: error: cannot compute sizeof (long)
-See \`config.log' for more details." >&5
-$as_echo "$as_me: error: cannot compute sizeof (long)
-See \`config.log' for more details." >&2;}
-   { (exit 77); exit 77; }; }; }
-   else
-     ac_cv_sizeof_long=0
-   fi
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 fi
-rm -rf conftest.dSYM
-rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+
+
+ ac_fn_c_check_decl "$LINENO" "fsetxattr" "ac_cv_have_decl_fsetxattr" "#include <sys/types.h>
+        #include <attr/xattr.h>
+
+"
+if test "x$ac_cv_have_decl_fsetxattr" = xyes; then :
+  have_fsetxattr=yes
 fi
-rm -f conftest.val
+
+
+
+ ac_fn_c_check_decl "$LINENO" "mremap" "ac_cv_have_decl_mremap" "#define _GNU_SOURCE
+        #include <sys/mman.h>
+
+"
+if test "x$ac_cv_have_decl_mremap" = xyes; then :
+  have_mremap=yes
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_sizeof_long" >&5
-$as_echo "$ac_cv_sizeof_long" >&6; }
 
 
 
-cat >>confdefs.h <<_ACEOF
-#define SIZEOF_LONG $ac_cv_sizeof_long
-_ACEOF
 
+    ac_fn_c_check_type "$LINENO" "struct fsxattr" "ac_cv_type_struct_fsxattr" "#include <linux/fs.h>
+
+"
+if test "x$ac_cv_type_struct_fsxattr" = xyes; then :
+
+        ac_fn_c_check_member "$LINENO" "struct fsxattr" "fsx_cowextsize" "ac_cv_member_struct_fsxattr_fsx_cowextsize" "#include <linux/fs.h>
+
+"
+if test "x$ac_cv_member_struct_fsxattr_fsx_cowextsize" = xyes; then :
 
-# The cast to long int works around a bug in the HP C Compiler
-# version HP92453-01 B.11.11.23709.GP, which incorrectly rejects
-# declarations like `int a3[[(sizeof (unsigned char)) >= 0]];'.
-# This bug is HP SR number 8606223364.
-{ $as_echo "$as_me:$LINENO: checking size of char *" >&5
-$as_echo_n "checking size of char *... " >&6; }
-if test "${ac_cv_sizeof_char_p+set}" = set; then
-  $as_echo_n "(cached) " >&6
 else
-  if test "$cross_compiling" = yes; then
-  # Depending upon the size, compute the lo and hi bounds.
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-$ac_includes_default
-int
-main ()
-{
-static int test_array [1 - 2 * !(((long int) (sizeof (char *))) >= 0)];
-test_array [0] = 0
+  need_internal_fsxattr=yes
+fi
 
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_lo=0 ac_mid=0
-  while :; do
-    cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+
+fi
+
+
+
+ { $as_echo "$as_me:${as_lineno-$LINENO}: checking for GETFSMAP" >&5
+$as_echo_n "checking for GETFSMAP... " >&6; }
+    cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
-$ac_includes_default
+
+#define _GNU_SOURCE
+#include <sys/syscall.h>
+#include <unistd.h>
+#include <linux/fs.h>
+#include <linux/fsmap.h>
+
 int
 main ()
 {
-static int test_array [1 - 2 * !(((long int) (sizeof (char *))) <= $ac_mid)];
-test_array [0] = 0
+
+         unsigned long x = FS_IOC_GETFSMAP;
+         struct fsmap_head fh;
 
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_hi=$ac_mid; break
+if ac_fn_c_try_link "$LINENO"; then :
+  have_getfsmap=yes
+       { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
 
-	ac_lo=`expr $ac_mid + 1`
-			if test $ac_lo -le $ac_mid; then
-			  ac_lo= ac_hi=
-			  break
-			fi
-			ac_mid=`expr 2 '*' $ac_mid + 1`
+
+
+    ac_fn_c_check_type "$LINENO" "struct statfs" "ac_cv_type_struct_statfs" "#include <sys/vfs.h>
+
+"
+if test "x$ac_cv_type_struct_statfs" = xyes; then :
+
+        ac_fn_c_check_member "$LINENO" "struct statfs" "f_flags" "ac_cv_member_struct_statfs_f_flags" "#include <sys/vfs.h>
+
+"
+if test "x$ac_cv_member_struct_statfs_f_flags" = xyes; then :
+  have_statfs_flags=yes
 fi
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-  done
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
 
-	cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+fi
+
+
+
+
+if test "$enable_blkid" = yes; then
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for library containing blkid_probe_all" >&5
+$as_echo_n "checking for library containing blkid_probe_all... " >&6; }
+if ${ac_cv_search_blkid_probe_all+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ac_func_search_save_LIBS=$LIBS
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
-$ac_includes_default
+
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+char blkid_probe_all ();
 int
 main ()
 {
-static int test_array [1 - 2 * !(((long int) (sizeof (char *))) < 0)];
-test_array [0] = 0
-
+return blkid_probe_all ();
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_hi=-1 ac_mid=-1
-  while :; do
-    cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
+for ac_lib in '' blkid; do
+  if test -z "$ac_lib"; then
+    ac_res="none required"
+  else
+    ac_res=-l$ac_lib
+    LIBS="-l$ac_lib  $ac_func_search_save_LIBS"
+  fi
+  if ac_fn_c_try_link "$LINENO"; then :
+  ac_cv_search_blkid_probe_all=$ac_res
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext
+  if ${ac_cv_search_blkid_probe_all+:} false; then :
+  break
+fi
+done
+if ${ac_cv_search_blkid_probe_all+:} false; then :
+
+else
+  ac_cv_search_blkid_probe_all=no
+fi
+rm conftest.$ac_ext
+LIBS=$ac_func_search_save_LIBS
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_search_blkid_probe_all" >&5
+$as_echo "$ac_cv_search_blkid_probe_all" >&6; }
+ac_res=$ac_cv_search_blkid_probe_all
+if test "$ac_res" != no; then :
+  test "$ac_res" = "none required" || LIBS="$ac_res $LIBS"
+
+fi
+
+  for ac_func in blkid_probe_get_topology
+do :
+  ac_fn_c_check_func "$LINENO" "blkid_probe_get_topology" "ac_cv_func_blkid_probe_get_topology"
+if test "x$ac_cv_func_blkid_probe_get_topology" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_BLKID_PROBE_GET_TOPOLOGY 1
 _ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+
+fi
+done
+
+  if test $ac_cv_func_blkid_probe_get_topology = yes; then
+    libblkid="-lblkid"
+  else
+    echo
+    echo 'FATAL ERROR: could not find a valid BLKID header.'
+    echo 'Install the Block device ID development package.'
+    exit 1
+  fi
+
+
+fi
+
+if test "$enable_ubsan" = "yes" || test "$enable_ubsan" = "probe"; then
+         { $as_echo "$as_me:${as_lineno-$LINENO}: checking if C compiler supports UBSAN" >&5
+$as_echo_n "checking if C compiler supports UBSAN... " >&6; }
+    OLD_CFLAGS="$CFLAGS"
+    OLD_LDFLAGS="$LDFLAGS"
+    UBSAN_FLAGS="-fsanitize=undefined"
+    CFLAGS="$CFLAGS $UBSAN_FLAGS"
+    LDFLAGS="$LDFLAGS $UBSAN_FLAGS"
+    cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
-$ac_includes_default
+
 int
 main ()
 {
-static int test_array [1 - 2 * !(((long int) (sizeof (char *))) >= $ac_mid)];
-test_array [0] = 0
 
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_lo=$ac_mid; break
+if ac_fn_c_try_link "$LINENO"; then :
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+        ubsan_cflags=$UBSAN_FLAGS
+        ubsan_ldflags=$UBSAN_FLAGS
+        have_ubsan=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_hi=`expr '(' $ac_mid ')' - 1`
-			if test $ac_mid -le $ac_hi; then
-			  ac_lo= ac_hi=
-			  break
-			fi
-			ac_mid=`expr 2 '*' $ac_mid`
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+    CFLAGS="${OLD_CFLAGS}"
+    LDFLAGS="${OLD_LDFLAGS}"
+
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-  done
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
 
-	ac_lo= ac_hi=
-fi
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+fi
+if test "$enable_ubsan" = "yes" && test "$have_ubsan" != "yes"; then
+        as_fn_error $? "UBSAN not supported by compiler." "$LINENO" 5
 fi
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-# Binary search between lo and hi bounds.
-while test "x$ac_lo" != "x$ac_hi"; do
-  ac_mid=`expr '(' $ac_hi - $ac_lo ')' / 2 + $ac_lo`
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+if test "$enable_addrsan" = "yes" || test "$enable_addrsan" = "probe"; then
+         { $as_echo "$as_me:${as_lineno-$LINENO}: checking if C compiler supports ADDRSAN" >&5
+$as_echo_n "checking if C compiler supports ADDRSAN... " >&6; }
+    OLD_CFLAGS="$CFLAGS"
+    OLD_LDFLAGS="$LDFLAGS"
+    ADDRSAN_FLAGS="-fsanitize=address"
+    CFLAGS="$CFLAGS $ADDRSAN_FLAGS"
+    LDFLAGS="$LDFLAGS $ADDRSAN_FLAGS"
+    cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
-$ac_includes_default
+
 int
 main ()
 {
-static int test_array [1 - 2 * !(((long int) (sizeof (char *))) <= $ac_mid)];
-test_array [0] = 0
 
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_hi=$ac_mid
+if ac_fn_c_try_link "$LINENO"; then :
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+        addrsan_cflags=$ADDRSAN_FLAGS
+        addrsan_ldflags=$ADDRSAN_FLAGS
+        have_addrsan=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+    CFLAGS="${OLD_CFLAGS}"
+    LDFLAGS="${OLD_LDFLAGS}"
+
+
 
-	ac_lo=`expr '(' $ac_mid ')' + 1`
+
+fi
+if test "$enable_addrsan" = "yes" && test "$have_addrsan" != "yes"; then
+        as_fn_error $? "ADDRSAN not supported by compiler." "$LINENO" 5
 fi
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-done
-case $ac_lo in
-?*) ac_cv_sizeof_char_p=$ac_lo;;
-'') if test "$ac_cv_type_char_p" = yes; then
-     { { $as_echo "$as_me:$LINENO: error: in \`$ac_pwd':" >&5
-$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-{ { $as_echo "$as_me:$LINENO: error: cannot compute sizeof (char *)
-See \`config.log' for more details." >&5
-$as_echo "$as_me: error: cannot compute sizeof (char *)
-See \`config.log' for more details." >&2;}
-   { (exit 77); exit 77; }; }; }
-   else
-     ac_cv_sizeof_char_p=0
-   fi ;;
-esac
-else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+if test "$enable_threadsan" = "yes" || test "$enable_threadsan" = "probe"; then
+         { $as_echo "$as_me:${as_lineno-$LINENO}: checking if C compiler supports THREADSAN" >&5
+$as_echo_n "checking if C compiler supports THREADSAN... " >&6; }
+    OLD_CFLAGS="$CFLAGS"
+    OLD_LDFLAGS="$LDFLAGS"
+    THREADSAN_FLAGS="-fsanitize=thread"
+    CFLAGS="$CFLAGS $THREADSAN_FLAGS"
+    LDFLAGS="$LDFLAGS $ADRSAN_FLAGS"
+    cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
-$ac_includes_default
-static long int longval () { return (long int) (sizeof (char *)); }
-static unsigned long int ulongval () { return (long int) (sizeof (char *)); }
-#include <stdio.h>
-#include <stdlib.h>
+
 int
 main ()
 {
 
-  FILE *f = fopen ("conftest.val", "w");
-  if (! f)
-    return 1;
-  if (((long int) (sizeof (char *))) < 0)
-    {
-      long int i = longval ();
-      if (i != ((long int) (sizeof (char *))))
-	return 1;
-      fprintf (f, "%ld", i);
-    }
-  else
-    {
-      unsigned long int i = ulongval ();
-      if (i != ((long int) (sizeof (char *))))
-	return 1;
-      fprintf (f, "%lu", i);
-    }
-  /* Do not output a trailing newline, as this causes \r\n confusion
-     on some platforms.  */
-  return ferror (f) || fclose (f) != 0;
-
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
-  ac_cv_sizeof_char_p=`cat conftest.val`
+if ac_fn_c_try_link "$LINENO"; then :
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+        threadsan_cflags=$THREADSAN_FLAGS
+        threadsan_ldflags=$THREADSAN_FLAGS
+        have_threadsan=yes
 else
-  $as_echo "$as_me: program exited with status $ac_status" >&5
-$as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+    CFLAGS="${OLD_CFLAGS}"
+    LDFLAGS="${OLD_LDFLAGS}"
+
+
+
+
+fi
+if test "$enable_threadsan" = "yes" && test "$have_threadsan" != "yes"; then
+        as_fn_error $? "THREADSAN not supported by compiler." "$LINENO" 5
+fi
+
+if test "$have_threadsan" = "yes" && test "$have_addrsan" = "yes"; then
+        { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: ADDRSAN and THREADSAN are not known to work together." >&5
+$as_echo "$as_me: WARNING: ADDRSAN and THREADSAN are not known to work together." >&2;}
+fi
+
+# The cast to long int works around a bug in the HP C Compiler
+# version HP92453-01 B.11.11.23709.GP, which incorrectly rejects
+# declarations like `int a3[[(sizeof (unsigned char)) >= 0]];'.
+# This bug is HP SR number 8606223364.
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking size of long" >&5
+$as_echo_n "checking size of long... " >&6; }
+if ${ac_cv_sizeof_long+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if ac_fn_c_compute_int "$LINENO" "(long int) (sizeof (long))" "ac_cv_sizeof_long"        "$ac_includes_default"; then :
 
-( exit $ac_status )
-if test "$ac_cv_type_char_p" = yes; then
-     { { $as_echo "$as_me:$LINENO: error: in \`$ac_pwd':" >&5
+else
+  if test "$ac_cv_type_long" = yes; then
+     { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
 $as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-{ { $as_echo "$as_me:$LINENO: error: cannot compute sizeof (char *)
-See \`config.log' for more details." >&5
-$as_echo "$as_me: error: cannot compute sizeof (char *)
-See \`config.log' for more details." >&2;}
-   { (exit 77); exit 77; }; }; }
+as_fn_error 77 "cannot compute sizeof (long)
+See \`config.log' for more details" "$LINENO" 5; }
    else
-     ac_cv_sizeof_char_p=0
+     ac_cv_sizeof_long=0
    fi
 fi
-rm -rf conftest.dSYM
-rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
+
 fi
-rm -f conftest.val
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_sizeof_long" >&5
+$as_echo "$ac_cv_sizeof_long" >&6; }
+
+
+
+cat >>confdefs.h <<_ACEOF
+#define SIZEOF_LONG $ac_cv_sizeof_long
+_ACEOF
+
+
+# The cast to long int works around a bug in the HP C Compiler
+# version HP92453-01 B.11.11.23709.GP, which incorrectly rejects
+# declarations like `int a3[[(sizeof (unsigned char)) >= 0]];'.
+# This bug is HP SR number 8606223364.
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking size of char *" >&5
+$as_echo_n "checking size of char *... " >&6; }
+if ${ac_cv_sizeof_char_p+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if ac_fn_c_compute_int "$LINENO" "(long int) (sizeof (char *))" "ac_cv_sizeof_char_p"        "$ac_includes_default"; then :
+
+else
+  if test "$ac_cv_type_char_p" = yes; then
+     { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
+$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
+as_fn_error 77 "cannot compute sizeof (char *)
+See \`config.log' for more details" "$LINENO" 5; }
+   else
+     ac_cv_sizeof_char_p=0
+   fi
+fi
+
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_sizeof_char_p" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_sizeof_char_p" >&5
 $as_echo "$ac_cv_sizeof_char_p" >&6; }
 
 
@@ -16279,13 +14705,9 @@ cat >>confdefs.h <<_ACEOF
 _ACEOF
 
 
- { $as_echo "$as_me:$LINENO: checking for umode_t" >&5
+ { $as_echo "$as_me:${as_lineno-$LINENO}: checking for umode_t" >&5
 $as_echo_n "checking for umode_t... " >&6; }
-    cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+    cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 #include <asm/types.h>
@@ -16300,37 +14722,14 @@ main ()
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  cat >>confdefs.h <<\_ACEOF
-#define HAVE_UMODE_T 1
-_ACEOF
- { $as_echo "$as_me:$LINENO: result: yes" >&5
+if ac_fn_c_try_compile "$LINENO"; then :
+  $as_echo "#define HAVE_UMODE_T 1" >>confdefs.h
+ { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
 $as_echo "yes" >&6; }
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	{ $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
  have_zipped_manpages=false
@@ -16373,13 +14772,13 @@ _ACEOF
     case $ac_val in #(
     *${as_nl}*)
       case $ac_var in #(
-      *_cv_*) { $as_echo "$as_me:$LINENO: WARNING: cache variable $ac_var contains a newline" >&5
+      *_cv_*) { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: cache variable $ac_var contains a newline" >&5
 $as_echo "$as_me: WARNING: cache variable $ac_var contains a newline" >&2;} ;;
       esac
       case $ac_var in #(
       _ | IFS | as_nl) ;; #(
       BASH_ARGV | BASH_SOURCE) eval $ac_var= ;; #(
-      *) $as_unset $ac_var ;;
+      *) { eval $ac_var=; unset $ac_var;} ;;
       esac ;;
     esac
   done
@@ -16387,8 +14786,8 @@ $as_echo "$as_me: WARNING: cache variabl
   (set) 2>&1 |
     case $as_nl`(ac_space=' '; set) 2>&1` in #(
     *${as_nl}ac_space=\ *)
-      # `set' does not quote correctly, so add quotes (double-quote
-      # substitution turns \\\\ into \\, and sed turns \\ into \).
+      # `set' does not quote correctly, so add quotes: double-quote
+      # substitution turns \\\\ into \\, and sed turns \\ into \.
       sed -n \
 	"s/'/'\\\\''/g;
 	  s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1='\\2'/p"
@@ -16410,12 +14809,23 @@ $as_echo "$as_me: WARNING: cache variabl
      :end' >>confcache
 if diff "$cache_file" confcache >/dev/null 2>&1; then :; else
   if test -w "$cache_file"; then
-    test "x$cache_file" != "x/dev/null" &&
-      { $as_echo "$as_me:$LINENO: updating cache $cache_file" >&5
+    if test "x$cache_file" != "x/dev/null"; then
+      { $as_echo "$as_me:${as_lineno-$LINENO}: updating cache $cache_file" >&5
 $as_echo "$as_me: updating cache $cache_file" >&6;}
-    cat confcache >$cache_file
+      if test ! -f "$cache_file" || test -h "$cache_file"; then
+	cat confcache >"$cache_file"
+      else
+        case $cache_file in #(
+        */* | ?:*)
+	  mv -f confcache "$cache_file"$$ &&
+	  mv -f "$cache_file"$$ "$cache_file" ;; #(
+        *)
+	  mv -f confcache "$cache_file" ;;
+	esac
+      fi
+    fi
   else
-    { $as_echo "$as_me:$LINENO: not updating unwritable cache $cache_file" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: not updating unwritable cache $cache_file" >&5
 $as_echo "$as_me: not updating unwritable cache $cache_file" >&6;}
   fi
 fi
@@ -16429,14 +14839,15 @@ DEFS=-DHAVE_CONFIG_H
 
 ac_libobjs=
 ac_ltlibobjs=
+U=
 for ac_i in : $LIBOBJS; do test "x$ac_i" = x: && continue
   # 1. Remove the extension, and $U if already installed.
   ac_script='s/\$U\././;s/\.o$//;s/\.obj$//'
   ac_i=`$as_echo "$ac_i" | sed "$ac_script"`
   # 2. Prepend LIBOBJDIR.  When used with automake>=1.10 LIBOBJDIR
   #    will be set to the directory where LIBOBJS objects are built.
-  ac_libobjs="$ac_libobjs \${LIBOBJDIR}$ac_i\$U.$ac_objext"
-  ac_ltlibobjs="$ac_ltlibobjs \${LIBOBJDIR}$ac_i"'$U.lo'
+  as_fn_append ac_libobjs " \${LIBOBJDIR}$ac_i\$U.$ac_objext"
+  as_fn_append ac_ltlibobjs " \${LIBOBJDIR}$ac_i"'$U.lo'
 done
 LIBOBJS=$ac_libobjs
 
@@ -16444,13 +14855,14 @@ LTLIBOBJS=$ac_ltlibobjs
 
 
 
-: ${CONFIG_STATUS=./config.status}
+: "${CONFIG_STATUS=./config.status}"
 ac_write_fail=0
 ac_clean_files_save=$ac_clean_files
 ac_clean_files="$ac_clean_files $CONFIG_STATUS"
-{ $as_echo "$as_me:$LINENO: creating $CONFIG_STATUS" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: creating $CONFIG_STATUS" >&5
 $as_echo "$as_me: creating $CONFIG_STATUS" >&6;}
-cat >$CONFIG_STATUS <<_ACEOF || ac_write_fail=1
+as_write_fail=0
+cat >$CONFIG_STATUS <<_ASEOF || as_write_fail=1
 #! $SHELL
 # Generated by $as_me.
 # Run this file to recreate the current configuration.
@@ -16460,17 +14872,18 @@ cat >$CONFIG_STATUS <<_ACEOF || ac_write
 debug=false
 ac_cs_recheck=false
 ac_cs_silent=false
-SHELL=\${CONFIG_SHELL-$SHELL}
-_ACEOF
 
-cat >>$CONFIG_STATUS <<\_ACEOF || ac_write_fail=1
-## --------------------- ##
-## M4sh Initialization.  ##
-## --------------------- ##
+SHELL=\${CONFIG_SHELL-$SHELL}
+export SHELL
+_ASEOF
+cat >>$CONFIG_STATUS <<\_ASEOF || as_write_fail=1
+## -------------------- ##
+## M4sh Initialization. ##
+## -------------------- ##
 
 # Be more Bourne compatible
 DUALCASE=1; export DUALCASE # for MKS sh
-if test -n "${ZSH_VERSION+set}" && (emulate sh) >/dev/null 2>&1; then
+if test -n "${ZSH_VERSION+set}" && (emulate sh) >/dev/null 2>&1; then :
   emulate sh
   NULLCMD=:
   # Pre-4.2 versions of Zsh do word splitting on ${1+"$@"}, which
@@ -16478,23 +14891,15 @@ if test -n "${ZSH_VERSION+set}" && (emul
   alias -g '${1+"$@"}'='"$@"'
   setopt NO_GLOB_SUBST
 else
-  case `(set -o) 2>/dev/null` in
-  *posix*) set -o posix ;;
+  case `(set -o) 2>/dev/null` in #(
+  *posix*) :
+    set -o posix ;; #(
+  *) :
+     ;;
 esac
-
 fi
 
 
-
-
-# PATH needs CR
-# Avoid depending upon Character Ranges.
-as_cr_letters='abcdefghijklmnopqrstuvwxyz'
-as_cr_LETTERS='ABCDEFGHIJKLMNOPQRSTUVWXYZ'
-as_cr_Letters=$as_cr_letters$as_cr_LETTERS
-as_cr_digits='0123456789'
-as_cr_alnum=$as_cr_Letters$as_cr_digits
-
 as_nl='
 '
 export as_nl
@@ -16502,7 +14907,13 @@ export as_nl
 as_echo='\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\'
 as_echo=$as_echo$as_echo$as_echo$as_echo$as_echo
 as_echo=$as_echo$as_echo$as_echo$as_echo$as_echo$as_echo
-if (test "X`printf %s $as_echo`" = "X$as_echo") 2>/dev/null; then
+# Prefer a ksh shell builtin over an external printf program on Solaris,
+# but without wasting forks for bash or zsh.
+if test -z "$BASH_VERSION$ZSH_VERSION" \
+    && (test "X`print -r -- $as_echo`" = "X$as_echo") 2>/dev/null; then
+  as_echo='print -r --'
+  as_echo_n='print -rn --'
+elif (test "X`printf %s $as_echo`" = "X$as_echo") 2>/dev/null; then
   as_echo='printf %s\n'
   as_echo_n='printf %s'
 else
@@ -16513,7 +14924,7 @@ else
     as_echo_body='eval expr "X$1" : "X\\(.*\\)"'
     as_echo_n_body='eval
       arg=$1;
-      case $arg in
+      case $arg in #(
       *"$as_nl"*)
 	expr "X$arg" : "X\\(.*\\)$as_nl";
 	arg=`expr "X$arg" : ".*$as_nl\\(.*\\)"`;;
@@ -16536,13 +14947,6 @@ if test "${PATH_SEPARATOR+set}" != set;
   }
 fi
 
-# Support unset when possible.
-if ( (MAIL=60; unset MAIL) || exit) >/dev/null 2>&1; then
-  as_unset=unset
-else
-  as_unset=false
-fi
-
 
 # IFS
 # We need space, tab and new line, in precisely that order.  Quoting is
@@ -16552,15 +14956,16 @@ fi
 IFS=" ""	$as_nl"
 
 # Find who we are.  Look in the path if we contain no directory separator.
-case $0 in
+as_myself=
+case $0 in #((
   *[\\/]* ) as_myself=$0 ;;
   *) as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
 for as_dir in $PATH
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  test -r "$as_dir/$0" && as_myself=$as_dir/$0 && break
-done
+    test -r "$as_dir/$0" && as_myself=$as_dir/$0 && break
+  done
 IFS=$as_save_IFS
 
      ;;
@@ -16572,12 +14977,16 @@ if test "x$as_myself" = x; then
 fi
 if test ! -f "$as_myself"; then
   $as_echo "$as_myself: error: cannot find myself; rerun with an absolute file name" >&2
-  { (exit 1); exit 1; }
+  exit 1
 fi
 
-# Work around bugs in pre-3.0 UWIN ksh.
-for as_var in ENV MAIL MAILPATH
-do ($as_unset $as_var) >/dev/null 2>&1 && $as_unset $as_var
+# Unset variables that we do not need and which cause bugs (e.g. in
+# pre-3.0 UWIN ksh).  But do not cause bugs in bash 2.01; the "|| exit 1"
+# suppresses any "Segmentation fault" message there.  '((' could
+# trigger a bug in pdksh 5.2.14.
+for as_var in BASH_ENV ENV MAIL MAILPATH
+do eval test x\${$as_var+set} = xset \
+  && ( (unset $as_var) || exit 1) >/dev/null 2>&1 && unset $as_var || :
 done
 PS1='$ '
 PS2='> '
@@ -16589,7 +14998,89 @@ export LC_ALL
 LANGUAGE=C
 export LANGUAGE
 
-# Required to use basename.
+# CDPATH.
+(unset CDPATH) >/dev/null 2>&1 && unset CDPATH
+
+
+# as_fn_error STATUS ERROR [LINENO LOG_FD]
+# ----------------------------------------
+# Output "`basename $0`: error: ERROR" to stderr. If LINENO and LOG_FD are
+# provided, also output the error to LOG_FD, referencing LINENO. Then exit the
+# script with STATUS, using 1 if that was 0.
+as_fn_error ()
+{
+  as_status=$1; test $as_status -eq 0 && as_status=1
+  if test "$4"; then
+    as_lineno=${as_lineno-"$3"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+    $as_echo "$as_me:${as_lineno-$LINENO}: error: $2" >&$4
+  fi
+  $as_echo "$as_me: error: $2" >&2
+  as_fn_exit $as_status
+} # as_fn_error
+
+
+# as_fn_set_status STATUS
+# -----------------------
+# Set $? to STATUS, without forking.
+as_fn_set_status ()
+{
+  return $1
+} # as_fn_set_status
+
+# as_fn_exit STATUS
+# -----------------
+# Exit the shell with STATUS, even in a "trap 0" or "set -e" context.
+as_fn_exit ()
+{
+  set +e
+  as_fn_set_status $1
+  exit $1
+} # as_fn_exit
+
+# as_fn_unset VAR
+# ---------------
+# Portably unset VAR.
+as_fn_unset ()
+{
+  { eval $1=; unset $1;}
+}
+as_unset=as_fn_unset
+# as_fn_append VAR VALUE
+# ----------------------
+# Append the text in VALUE to the end of the definition contained in VAR. Take
+# advantage of any shell optimizations that allow amortized linear growth over
+# repeated appends, instead of the typical quadratic growth present in naive
+# implementations.
+if (eval "as_var=1; as_var+=2; test x\$as_var = x12") 2>/dev/null; then :
+  eval 'as_fn_append ()
+  {
+    eval $1+=\$2
+  }'
+else
+  as_fn_append ()
+  {
+    eval $1=\$$1\$2
+  }
+fi # as_fn_append
+
+# as_fn_arith ARG...
+# ------------------
+# Perform arithmetic evaluation on the ARGs, and store the result in the
+# global $as_val. Take advantage of shells that can avoid forks. The arguments
+# must be portable across $(()) and expr.
+if (eval "test \$(( 1 + 1 )) = 2") 2>/dev/null; then :
+  eval 'as_fn_arith ()
+  {
+    as_val=$(( $* ))
+  }'
+else
+  as_fn_arith ()
+  {
+    as_val=`expr "$@" || test $? -eq 1`
+  }
+fi # as_fn_arith
+
+
 if expr a : '\(a\)' >/dev/null 2>&1 &&
    test "X`expr 00001 : '.*\(...\)'`" = X001; then
   as_expr=expr
@@ -16598,79 +15089,10 @@ else
 fi
 
 if (basename -- /) >/dev/null 2>&1 && test "X`basename -- / 2>&1`" = "X/"; then
-  as_basename=basename
-else
-  as_basename=false
-fi
-
-
-# Name of the executable.
-as_me=`$as_basename -- "$0" ||
-$as_expr X/"$0" : '.*/\([^/][^/]*\)/*$' \| \
-	 X"$0" : 'X\(//\)$' \| \
-	 X"$0" : 'X\(/\)' \| . 2>/dev/null ||
-$as_echo X/"$0" |
-    sed '/^.*\/\([^/][^/]*\)\/*$/{
-	    s//\1/
-	    q
-	  }
-	  /^X\/\(\/\/\)$/{
-	    s//\1/
-	    q
-	  }
-	  /^X\/\(\/\).*/{
-	    s//\1/
-	    q
-	  }
-	  s/.*/./; q'`
-
-# CDPATH.
-$as_unset CDPATH
-
-
-
-  as_lineno_1=$LINENO
-  as_lineno_2=$LINENO
-  test "x$as_lineno_1" != "x$as_lineno_2" &&
-  test "x`expr $as_lineno_1 + 1`" = "x$as_lineno_2" || {
-
-  # Create $as_me.lineno as a copy of $as_myself, but with $LINENO
-  # uniformly replaced by the line number.  The first 'sed' inserts a
-  # line-number line after each line using $LINENO; the second 'sed'
-  # does the real work.  The second script uses 'N' to pair each
-  # line-number line with the line containing $LINENO, and appends
-  # trailing '-' during substitution so that $LINENO is not a special
-  # case at line end.
-  # (Raja R Harinath suggested sed '=', and Paul Eggert wrote the
-  # scripts with optimization help from Paolo Bonzini.  Blame Lee
-  # E. McMahon (1931-1989) for sed's syntax.  :-)
-  sed -n '
-    p
-    /[$]LINENO/=
-  ' <$as_myself |
-    sed '
-      s/[$]LINENO.*/&-/
-      t lineno
-      b
-      :lineno
-      N
-      :loop
-      s/[$]LINENO\([^'$as_cr_alnum'_].*\n\)\(.*\)/\2\1\2/
-      t loop
-      s/-\n.*//
-    ' >$as_me.lineno &&
-  chmod +x "$as_me.lineno" ||
-    { $as_echo "$as_me: error: cannot create $as_me.lineno; rerun with a POSIX shell" >&2
-   { (exit 1); exit 1; }; }
-
-  # Don't try to exec as it changes $[0], causing all sort of problems
-  # (the dirname of $[0] is not the place where we might find the
-  # original and so on.  Autoconf is especially sensitive to this).
-  . "./$as_me.lineno"
-  # Exit status is that of the last command.
-  exit
-}
-
+  as_basename=basename
+else
+  as_basename=false
+fi
 
 if (as_dir=`dirname -- /` && test "X$as_dir" = X/) >/dev/null 2>&1; then
   as_dirname=dirname
@@ -16678,22 +15100,44 @@ else
   as_dirname=false
 fi
 
+as_me=`$as_basename -- "$0" ||
+$as_expr X/"$0" : '.*/\([^/][^/]*\)/*$' \| \
+	 X"$0" : 'X\(//\)$' \| \
+	 X"$0" : 'X\(/\)' \| . 2>/dev/null ||
+$as_echo X/"$0" |
+    sed '/^.*\/\([^/][^/]*\)\/*$/{
+	    s//\1/
+	    q
+	  }
+	  /^X\/\(\/\/\)$/{
+	    s//\1/
+	    q
+	  }
+	  /^X\/\(\/\).*/{
+	    s//\1/
+	    q
+	  }
+	  s/.*/./; q'`
+
+# Avoid depending upon Character Ranges.
+as_cr_letters='abcdefghijklmnopqrstuvwxyz'
+as_cr_LETTERS='ABCDEFGHIJKLMNOPQRSTUVWXYZ'
+as_cr_Letters=$as_cr_letters$as_cr_LETTERS
+as_cr_digits='0123456789'
+as_cr_alnum=$as_cr_Letters$as_cr_digits
+
 ECHO_C= ECHO_N= ECHO_T=
-case `echo -n x` in
+case `echo -n x` in #(((((
 -n*)
-  case `echo 'x\c'` in
+  case `echo 'xy\c'` in
   *c*) ECHO_T='	';;	# ECHO_T is single tab character.
-  *)   ECHO_C='\c';;
+  xy)  ECHO_C='\c';;
+  *)   echo `echo ksh88 bug on AIX 6.1` > /dev/null
+       ECHO_T='	';;
   esac;;
 *)
   ECHO_N='-n';;
 esac
-if expr a : '\(a\)' >/dev/null 2>&1 &&
-   test "X`expr 00001 : '.*\(...\)'`" = X001; then
-  as_expr=expr
-else
-  as_expr=false
-fi
 
 rm -f conf$$ conf$$.exe conf$$.file
 if test -d conf$$.dir; then
@@ -16708,49 +15152,85 @@ if (echo >conf$$.file) 2>/dev/null; then
     # ... but there are two gotchas:
     # 1) On MSYS, both `ln -s file dir' and `ln file dir' fail.
     # 2) DJGPP < 2.04 has no symlinks; `ln -s' creates a wrapper executable.
-    # In both cases, we have to default to `cp -p'.
+    # In both cases, we have to default to `cp -pR'.
     ln -s conf$$.file conf$$.dir 2>/dev/null && test ! -f conf$$.exe ||
-      as_ln_s='cp -p'
+      as_ln_s='cp -pR'
   elif ln conf$$.file conf$$ 2>/dev/null; then
     as_ln_s=ln
   else
-    as_ln_s='cp -p'
+    as_ln_s='cp -pR'
   fi
 else
-  as_ln_s='cp -p'
+  as_ln_s='cp -pR'
 fi
 rm -f conf$$ conf$$.exe conf$$.dir/conf$$.file conf$$.file
 rmdir conf$$.dir 2>/dev/null
 
+
+# as_fn_mkdir_p
+# -------------
+# Create "$as_dir" as a directory, including parents if necessary.
+as_fn_mkdir_p ()
+{
+
+  case $as_dir in #(
+  -*) as_dir=./$as_dir;;
+  esac
+  test -d "$as_dir" || eval $as_mkdir_p || {
+    as_dirs=
+    while :; do
+      case $as_dir in #(
+      *\'*) as_qdir=`$as_echo "$as_dir" | sed "s/'/'\\\\\\\\''/g"`;; #'(
+      *) as_qdir=$as_dir;;
+      esac
+      as_dirs="'$as_qdir' $as_dirs"
+      as_dir=`$as_dirname -- "$as_dir" ||
+$as_expr X"$as_dir" : 'X\(.*[^/]\)//*[^/][^/]*/*$' \| \
+	 X"$as_dir" : 'X\(//\)[^/]' \| \
+	 X"$as_dir" : 'X\(//\)$' \| \
+	 X"$as_dir" : 'X\(/\)' \| . 2>/dev/null ||
+$as_echo X"$as_dir" |
+    sed '/^X\(.*[^/]\)\/\/*[^/][^/]*\/*$/{
+	    s//\1/
+	    q
+	  }
+	  /^X\(\/\/\)[^/].*/{
+	    s//\1/
+	    q
+	  }
+	  /^X\(\/\/\)$/{
+	    s//\1/
+	    q
+	  }
+	  /^X\(\/\).*/{
+	    s//\1/
+	    q
+	  }
+	  s/.*/./; q'`
+      test -d "$as_dir" && break
+    done
+    test -z "$as_dirs" || eval "mkdir $as_dirs"
+  } || test -d "$as_dir" || as_fn_error $? "cannot create directory $as_dir"
+
+
+} # as_fn_mkdir_p
 if mkdir -p . 2>/dev/null; then
-  as_mkdir_p=:
+  as_mkdir_p='mkdir -p "$as_dir"'
 else
   test -d ./-p && rmdir ./-p
   as_mkdir_p=false
 fi
 
-if test -x / >/dev/null 2>&1; then
-  as_test_x='test -x'
-else
-  if ls -dL / >/dev/null 2>&1; then
-    as_ls_L_option=L
-  else
-    as_ls_L_option=
-  fi
-  as_test_x='
-    eval sh -c '\''
-      if test -d "$1"; then
-	test -d "$1/.";
-      else
-	case $1 in
-	-*)set "./$1";;
-	esac;
-	case `ls -ld'$as_ls_L_option' "$1" 2>/dev/null` in
-	???[sx]*):;;*)false;;esac;fi
-    '\'' sh
-  '
-fi
-as_executable_p=$as_test_x
+
+# as_fn_executable_p FILE
+# -----------------------
+# Test if FILE is an executable regular file.
+as_fn_executable_p ()
+{
+  test -f "$1" && test -x "$1"
+} # as_fn_executable_p
+as_test_x='test -x'
+as_executable_p=as_fn_executable_p
 
 # Sed expression to map a string onto a valid CPP name.
 as_tr_cpp="eval sed 'y%*$as_cr_letters%P$as_cr_LETTERS%;s%[^_$as_cr_alnum]%_%g'"
@@ -16760,13 +15240,19 @@ as_tr_sh="eval sed 'y%*+%pp%;s%[^_$as_cr
 
 
 exec 6>&1
+## ----------------------------------- ##
+## Main body of $CONFIG_STATUS script. ##
+## ----------------------------------- ##
+_ASEOF
+test $as_write_fail = 0 && chmod +x $CONFIG_STATUS || ac_write_fail=1
 
-# Save the log message, to keep $[0] and so on meaningful, and to
+cat >>$CONFIG_STATUS <<\_ACEOF || ac_write_fail=1
+# Save the log message, to keep $0 and so on meaningful, and to
 # report actual input values of CONFIG_FILES etc. instead of their
 # values after options handling.
 ac_log="
-This file was extended by xfsprogs $as_me 4.9.0, which was
-generated by GNU Autoconf 2.63.  Invocation command line was
+This file was extended by xfsprogs $as_me 4.14.0, which was
+generated by GNU Autoconf 2.69.  Invocation command line was
 
   CONFIG_FILES    = $CONFIG_FILES
   CONFIG_HEADERS  = $CONFIG_HEADERS
@@ -16798,13 +15284,15 @@ _ACEOF
 
 cat >>$CONFIG_STATUS <<\_ACEOF || ac_write_fail=1
 ac_cs_usage="\
-\`$as_me' instantiates files from templates according to the
-current configuration.
+\`$as_me' instantiates files and other configuration actions
+from templates according to the current configuration.  Unless the files
+and actions are specified as TAGs, all are instantiated by default.
 
-Usage: $0 [OPTION]... [FILE]...
+Usage: $0 [OPTION]... [TAG]...
 
   -h, --help       print this help, then exit
   -V, --version    print version number and configuration settings, then exit
+      --config     print configuration, then exit
   -q, --quiet, --silent
                    do not print progress messages
   -d, --debug      don't remove temporary files
@@ -16823,21 +15311,24 @@ $config_headers
 Configuration commands:
 $config_commands
 
-Report bugs to <bug-autoconf@gnu.org>."
+Report bugs to <linux-xfs@vger.kernel.org>."
 
 _ACEOF
 cat >>$CONFIG_STATUS <<_ACEOF || ac_write_fail=1
+ac_cs_config="`$as_echo "$ac_configure_args" | sed 's/^ //; s/[\\""\`\$]/\\\\&/g'`"
 ac_cs_version="\\
-xfsprogs config.status 4.9.0
-configured by $0, generated by GNU Autoconf 2.63,
-  with options \\"`$as_echo "$ac_configure_args" | sed 's/^ //; s/[\\""\`\$]/\\\\&/g'`\\"
+xfsprogs config.status 4.14.0
+configured by $0, generated by GNU Autoconf 2.69,
+  with options \\"\$ac_cs_config\\"
 
-Copyright (C) 2008 Free Software Foundation, Inc.
+Copyright (C) 2012 Free Software Foundation, Inc.
 This config.status script is free software; the Free Software Foundation
 gives unlimited permission to copy, distribute and modify it."
 
 ac_pwd='$ac_pwd'
 srcdir='$srcdir'
+INSTALL='$INSTALL'
+AWK='$AWK'
 test -n "\$AWK" || AWK=awk
 _ACEOF
 
@@ -16847,11 +15338,16 @@ ac_need_defaults=:
 while test $# != 0
 do
   case $1 in
-  --*=*)
+  --*=?*)
     ac_option=`expr "X$1" : 'X\([^=]*\)='`
     ac_optarg=`expr "X$1" : 'X[^=]*=\(.*\)'`
     ac_shift=:
     ;;
+  --*=)
+    ac_option=`expr "X$1" : 'X\([^=]*\)='`
+    ac_optarg=
+    ac_shift=:
+    ;;
   *)
     ac_option=$1
     ac_optarg=$2
@@ -16865,27 +15361,29 @@ do
     ac_cs_recheck=: ;;
   --version | --versio | --versi | --vers | --ver | --ve | --v | -V )
     $as_echo "$ac_cs_version"; exit ;;
+  --config | --confi | --conf | --con | --co | --c )
+    $as_echo "$ac_cs_config"; exit ;;
   --debug | --debu | --deb | --de | --d | -d )
     debug=: ;;
   --file | --fil | --fi | --f )
     $ac_shift
     case $ac_optarg in
     *\'*) ac_optarg=`$as_echo "$ac_optarg" | sed "s/'/'\\\\\\\\''/g"` ;;
+    '') as_fn_error $? "missing file argument" ;;
     esac
-    CONFIG_FILES="$CONFIG_FILES '$ac_optarg'"
+    as_fn_append CONFIG_FILES " '$ac_optarg'"
     ac_need_defaults=false;;
   --header | --heade | --head | --hea )
     $ac_shift
     case $ac_optarg in
     *\'*) ac_optarg=`$as_echo "$ac_optarg" | sed "s/'/'\\\\\\\\''/g"` ;;
     esac
-    CONFIG_HEADERS="$CONFIG_HEADERS '$ac_optarg'"
+    as_fn_append CONFIG_HEADERS " '$ac_optarg'"
     ac_need_defaults=false;;
   --he | --h)
     # Conflict between --help and --header
-    { $as_echo "$as_me: error: ambiguous option: $1
-Try \`$0 --help' for more information." >&2
-   { (exit 1); exit 1; }; };;
+    as_fn_error $? "ambiguous option: \`$1'
+Try \`$0 --help' for more information.";;
   --help | --hel | -h )
     $as_echo "$ac_cs_usage"; exit ;;
   -q | -quiet | --quiet | --quie | --qui | --qu | --q \
@@ -16893,11 +15391,10 @@ Try \`$0 --help' for more information."
     ac_cs_silent=: ;;
 
   # This is an error.
-  -*) { $as_echo "$as_me: error: unrecognized option: $1
-Try \`$0 --help' for more information." >&2
-   { (exit 1); exit 1; }; } ;;
+  -*) as_fn_error $? "unrecognized option: \`$1'
+Try \`$0 --help' for more information." ;;
 
-  *) ac_config_targets="$ac_config_targets $1"
+  *) as_fn_append ac_config_targets " $1"
      ac_need_defaults=false ;;
 
   esac
@@ -16914,7 +15411,7 @@ fi
 _ACEOF
 cat >>$CONFIG_STATUS <<_ACEOF || ac_write_fail=1
 if \$ac_cs_recheck; then
-  set X '$SHELL' '$0' $ac_configure_args \$ac_configure_extra_args --no-create --no-recursion
+  set X $SHELL '$0' $ac_configure_args \$ac_configure_extra_args --no-create --no-recursion
   shift
   \$as_echo "running CONFIG_SHELL=$SHELL \$*" >&6
   CONFIG_SHELL='$SHELL'
@@ -16947,131 +15444,154 @@ cat >>$CONFIG_STATUS <<_ACEOF || ac_writ
 sed_quote_subst='$sed_quote_subst'
 double_quote_subst='$double_quote_subst'
 delay_variable_subst='$delay_variable_subst'
-macro_version='`$ECHO "X$macro_version" | $Xsed -e "$delay_single_quote_subst"`'
-macro_revision='`$ECHO "X$macro_revision" | $Xsed -e "$delay_single_quote_subst"`'
-enable_shared='`$ECHO "X$enable_shared" | $Xsed -e "$delay_single_quote_subst"`'
-enable_static='`$ECHO "X$enable_static" | $Xsed -e "$delay_single_quote_subst"`'
-pic_mode='`$ECHO "X$pic_mode" | $Xsed -e "$delay_single_quote_subst"`'
-enable_fast_install='`$ECHO "X$enable_fast_install" | $Xsed -e "$delay_single_quote_subst"`'
-host_alias='`$ECHO "X$host_alias" | $Xsed -e "$delay_single_quote_subst"`'
-host='`$ECHO "X$host" | $Xsed -e "$delay_single_quote_subst"`'
-host_os='`$ECHO "X$host_os" | $Xsed -e "$delay_single_quote_subst"`'
-build_alias='`$ECHO "X$build_alias" | $Xsed -e "$delay_single_quote_subst"`'
-build='`$ECHO "X$build" | $Xsed -e "$delay_single_quote_subst"`'
-build_os='`$ECHO "X$build_os" | $Xsed -e "$delay_single_quote_subst"`'
-SED='`$ECHO "X$SED" | $Xsed -e "$delay_single_quote_subst"`'
-Xsed='`$ECHO "X$Xsed" | $Xsed -e "$delay_single_quote_subst"`'
-GREP='`$ECHO "X$GREP" | $Xsed -e "$delay_single_quote_subst"`'
-EGREP='`$ECHO "X$EGREP" | $Xsed -e "$delay_single_quote_subst"`'
-FGREP='`$ECHO "X$FGREP" | $Xsed -e "$delay_single_quote_subst"`'
-LD='`$ECHO "X$LD" | $Xsed -e "$delay_single_quote_subst"`'
-NM='`$ECHO "X$NM" | $Xsed -e "$delay_single_quote_subst"`'
-LN_S='`$ECHO "X$LN_S" | $Xsed -e "$delay_single_quote_subst"`'
-max_cmd_len='`$ECHO "X$max_cmd_len" | $Xsed -e "$delay_single_quote_subst"`'
-ac_objext='`$ECHO "X$ac_objext" | $Xsed -e "$delay_single_quote_subst"`'
-exeext='`$ECHO "X$exeext" | $Xsed -e "$delay_single_quote_subst"`'
-lt_unset='`$ECHO "X$lt_unset" | $Xsed -e "$delay_single_quote_subst"`'
-lt_SP2NL='`$ECHO "X$lt_SP2NL" | $Xsed -e "$delay_single_quote_subst"`'
-lt_NL2SP='`$ECHO "X$lt_NL2SP" | $Xsed -e "$delay_single_quote_subst"`'
-reload_flag='`$ECHO "X$reload_flag" | $Xsed -e "$delay_single_quote_subst"`'
-reload_cmds='`$ECHO "X$reload_cmds" | $Xsed -e "$delay_single_quote_subst"`'
-OBJDUMP='`$ECHO "X$OBJDUMP" | $Xsed -e "$delay_single_quote_subst"`'
-deplibs_check_method='`$ECHO "X$deplibs_check_method" | $Xsed -e "$delay_single_quote_subst"`'
-file_magic_cmd='`$ECHO "X$file_magic_cmd" | $Xsed -e "$delay_single_quote_subst"`'
-AR='`$ECHO "X$AR" | $Xsed -e "$delay_single_quote_subst"`'
-AR_FLAGS='`$ECHO "X$AR_FLAGS" | $Xsed -e "$delay_single_quote_subst"`'
-STRIP='`$ECHO "X$STRIP" | $Xsed -e "$delay_single_quote_subst"`'
-RANLIB='`$ECHO "X$RANLIB" | $Xsed -e "$delay_single_quote_subst"`'
-old_postinstall_cmds='`$ECHO "X$old_postinstall_cmds" | $Xsed -e "$delay_single_quote_subst"`'
-old_postuninstall_cmds='`$ECHO "X$old_postuninstall_cmds" | $Xsed -e "$delay_single_quote_subst"`'
-old_archive_cmds='`$ECHO "X$old_archive_cmds" | $Xsed -e "$delay_single_quote_subst"`'
-CC='`$ECHO "X$CC" | $Xsed -e "$delay_single_quote_subst"`'
-CFLAGS='`$ECHO "X$CFLAGS" | $Xsed -e "$delay_single_quote_subst"`'
-compiler='`$ECHO "X$compiler" | $Xsed -e "$delay_single_quote_subst"`'
-GCC='`$ECHO "X$GCC" | $Xsed -e "$delay_single_quote_subst"`'
-lt_cv_sys_global_symbol_pipe='`$ECHO "X$lt_cv_sys_global_symbol_pipe" | $Xsed -e "$delay_single_quote_subst"`'
-lt_cv_sys_global_symbol_to_cdecl='`$ECHO "X$lt_cv_sys_global_symbol_to_cdecl" | $Xsed -e "$delay_single_quote_subst"`'
-lt_cv_sys_global_symbol_to_c_name_address='`$ECHO "X$lt_cv_sys_global_symbol_to_c_name_address" | $Xsed -e "$delay_single_quote_subst"`'
-lt_cv_sys_global_symbol_to_c_name_address_lib_prefix='`$ECHO "X$lt_cv_sys_global_symbol_to_c_name_address_lib_prefix" | $Xsed -e "$delay_single_quote_subst"`'
-objdir='`$ECHO "X$objdir" | $Xsed -e "$delay_single_quote_subst"`'
-SHELL='`$ECHO "X$SHELL" | $Xsed -e "$delay_single_quote_subst"`'
-ECHO='`$ECHO "X$ECHO" | $Xsed -e "$delay_single_quote_subst"`'
-MAGIC_CMD='`$ECHO "X$MAGIC_CMD" | $Xsed -e "$delay_single_quote_subst"`'
-lt_prog_compiler_no_builtin_flag='`$ECHO "X$lt_prog_compiler_no_builtin_flag" | $Xsed -e "$delay_single_quote_subst"`'
-lt_prog_compiler_wl='`$ECHO "X$lt_prog_compiler_wl" | $Xsed -e "$delay_single_quote_subst"`'
-lt_prog_compiler_pic='`$ECHO "X$lt_prog_compiler_pic" | $Xsed -e "$delay_single_quote_subst"`'
-lt_prog_compiler_static='`$ECHO "X$lt_prog_compiler_static" | $Xsed -e "$delay_single_quote_subst"`'
-lt_cv_prog_compiler_c_o='`$ECHO "X$lt_cv_prog_compiler_c_o" | $Xsed -e "$delay_single_quote_subst"`'
-need_locks='`$ECHO "X$need_locks" | $Xsed -e "$delay_single_quote_subst"`'
-DSYMUTIL='`$ECHO "X$DSYMUTIL" | $Xsed -e "$delay_single_quote_subst"`'
-NMEDIT='`$ECHO "X$NMEDIT" | $Xsed -e "$delay_single_quote_subst"`'
-LIPO='`$ECHO "X$LIPO" | $Xsed -e "$delay_single_quote_subst"`'
-OTOOL='`$ECHO "X$OTOOL" | $Xsed -e "$delay_single_quote_subst"`'
-OTOOL64='`$ECHO "X$OTOOL64" | $Xsed -e "$delay_single_quote_subst"`'
-libext='`$ECHO "X$libext" | $Xsed -e "$delay_single_quote_subst"`'
-shrext_cmds='`$ECHO "X$shrext_cmds" | $Xsed -e "$delay_single_quote_subst"`'
-extract_expsyms_cmds='`$ECHO "X$extract_expsyms_cmds" | $Xsed -e "$delay_single_quote_subst"`'
-archive_cmds_need_lc='`$ECHO "X$archive_cmds_need_lc" | $Xsed -e "$delay_single_quote_subst"`'
-enable_shared_with_static_runtimes='`$ECHO "X$enable_shared_with_static_runtimes" | $Xsed -e "$delay_single_quote_subst"`'
-export_dynamic_flag_spec='`$ECHO "X$export_dynamic_flag_spec" | $Xsed -e "$delay_single_quote_subst"`'
-whole_archive_flag_spec='`$ECHO "X$whole_archive_flag_spec" | $Xsed -e "$delay_single_quote_subst"`'
-compiler_needs_object='`$ECHO "X$compiler_needs_object" | $Xsed -e "$delay_single_quote_subst"`'
-old_archive_from_new_cmds='`$ECHO "X$old_archive_from_new_cmds" | $Xsed -e "$delay_single_quote_subst"`'
-old_archive_from_expsyms_cmds='`$ECHO "X$old_archive_from_expsyms_cmds" | $Xsed -e "$delay_single_quote_subst"`'
-archive_cmds='`$ECHO "X$archive_cmds" | $Xsed -e "$delay_single_quote_subst"`'
-archive_expsym_cmds='`$ECHO "X$archive_expsym_cmds" | $Xsed -e "$delay_single_quote_subst"`'
-module_cmds='`$ECHO "X$module_cmds" | $Xsed -e "$delay_single_quote_subst"`'
-module_expsym_cmds='`$ECHO "X$module_expsym_cmds" | $Xsed -e "$delay_single_quote_subst"`'
-with_gnu_ld='`$ECHO "X$with_gnu_ld" | $Xsed -e "$delay_single_quote_subst"`'
-allow_undefined_flag='`$ECHO "X$allow_undefined_flag" | $Xsed -e "$delay_single_quote_subst"`'
-no_undefined_flag='`$ECHO "X$no_undefined_flag" | $Xsed -e "$delay_single_quote_subst"`'
-hardcode_libdir_flag_spec='`$ECHO "X$hardcode_libdir_flag_spec" | $Xsed -e "$delay_single_quote_subst"`'
-hardcode_libdir_flag_spec_ld='`$ECHO "X$hardcode_libdir_flag_spec_ld" | $Xsed -e "$delay_single_quote_subst"`'
-hardcode_libdir_separator='`$ECHO "X$hardcode_libdir_separator" | $Xsed -e "$delay_single_quote_subst"`'
-hardcode_direct='`$ECHO "X$hardcode_direct" | $Xsed -e "$delay_single_quote_subst"`'
-hardcode_direct_absolute='`$ECHO "X$hardcode_direct_absolute" | $Xsed -e "$delay_single_quote_subst"`'
-hardcode_minus_L='`$ECHO "X$hardcode_minus_L" | $Xsed -e "$delay_single_quote_subst"`'
-hardcode_shlibpath_var='`$ECHO "X$hardcode_shlibpath_var" | $Xsed -e "$delay_single_quote_subst"`'
-hardcode_automatic='`$ECHO "X$hardcode_automatic" | $Xsed -e "$delay_single_quote_subst"`'
-inherit_rpath='`$ECHO "X$inherit_rpath" | $Xsed -e "$delay_single_quote_subst"`'
-link_all_deplibs='`$ECHO "X$link_all_deplibs" | $Xsed -e "$delay_single_quote_subst"`'
-fix_srcfile_path='`$ECHO "X$fix_srcfile_path" | $Xsed -e "$delay_single_quote_subst"`'
-always_export_symbols='`$ECHO "X$always_export_symbols" | $Xsed -e "$delay_single_quote_subst"`'
-export_symbols_cmds='`$ECHO "X$export_symbols_cmds" | $Xsed -e "$delay_single_quote_subst"`'
-exclude_expsyms='`$ECHO "X$exclude_expsyms" | $Xsed -e "$delay_single_quote_subst"`'
-include_expsyms='`$ECHO "X$include_expsyms" | $Xsed -e "$delay_single_quote_subst"`'
-prelink_cmds='`$ECHO "X$prelink_cmds" | $Xsed -e "$delay_single_quote_subst"`'
-file_list_spec='`$ECHO "X$file_list_spec" | $Xsed -e "$delay_single_quote_subst"`'
-variables_saved_for_relink='`$ECHO "X$variables_saved_for_relink" | $Xsed -e "$delay_single_quote_subst"`'
-need_lib_prefix='`$ECHO "X$need_lib_prefix" | $Xsed -e "$delay_single_quote_subst"`'
-need_version='`$ECHO "X$need_version" | $Xsed -e "$delay_single_quote_subst"`'
-version_type='`$ECHO "X$version_type" | $Xsed -e "$delay_single_quote_subst"`'
-runpath_var='`$ECHO "X$runpath_var" | $Xsed -e "$delay_single_quote_subst"`'
-shlibpath_var='`$ECHO "X$shlibpath_var" | $Xsed -e "$delay_single_quote_subst"`'
-shlibpath_overrides_runpath='`$ECHO "X$shlibpath_overrides_runpath" | $Xsed -e "$delay_single_quote_subst"`'
-libname_spec='`$ECHO "X$libname_spec" | $Xsed -e "$delay_single_quote_subst"`'
-library_names_spec='`$ECHO "X$library_names_spec" | $Xsed -e "$delay_single_quote_subst"`'
-soname_spec='`$ECHO "X$soname_spec" | $Xsed -e "$delay_single_quote_subst"`'
-postinstall_cmds='`$ECHO "X$postinstall_cmds" | $Xsed -e "$delay_single_quote_subst"`'
-postuninstall_cmds='`$ECHO "X$postuninstall_cmds" | $Xsed -e "$delay_single_quote_subst"`'
-finish_cmds='`$ECHO "X$finish_cmds" | $Xsed -e "$delay_single_quote_subst"`'
-finish_eval='`$ECHO "X$finish_eval" | $Xsed -e "$delay_single_quote_subst"`'
-hardcode_into_libs='`$ECHO "X$hardcode_into_libs" | $Xsed -e "$delay_single_quote_subst"`'
-sys_lib_search_path_spec='`$ECHO "X$sys_lib_search_path_spec" | $Xsed -e "$delay_single_quote_subst"`'
-sys_lib_dlsearch_path_spec='`$ECHO "X$sys_lib_dlsearch_path_spec" | $Xsed -e "$delay_single_quote_subst"`'
-hardcode_action='`$ECHO "X$hardcode_action" | $Xsed -e "$delay_single_quote_subst"`'
-enable_dlopen='`$ECHO "X$enable_dlopen" | $Xsed -e "$delay_single_quote_subst"`'
-enable_dlopen_self='`$ECHO "X$enable_dlopen_self" | $Xsed -e "$delay_single_quote_subst"`'
-enable_dlopen_self_static='`$ECHO "X$enable_dlopen_self_static" | $Xsed -e "$delay_single_quote_subst"`'
-old_striplib='`$ECHO "X$old_striplib" | $Xsed -e "$delay_single_quote_subst"`'
-striplib='`$ECHO "X$striplib" | $Xsed -e "$delay_single_quote_subst"`'
+macro_version='`$ECHO "$macro_version" | $SED "$delay_single_quote_subst"`'
+macro_revision='`$ECHO "$macro_revision" | $SED "$delay_single_quote_subst"`'
+enable_shared='`$ECHO "$enable_shared" | $SED "$delay_single_quote_subst"`'
+enable_static='`$ECHO "$enable_static" | $SED "$delay_single_quote_subst"`'
+pic_mode='`$ECHO "$pic_mode" | $SED "$delay_single_quote_subst"`'
+enable_fast_install='`$ECHO "$enable_fast_install" | $SED "$delay_single_quote_subst"`'
+SHELL='`$ECHO "$SHELL" | $SED "$delay_single_quote_subst"`'
+ECHO='`$ECHO "$ECHO" | $SED "$delay_single_quote_subst"`'
+PATH_SEPARATOR='`$ECHO "$PATH_SEPARATOR" | $SED "$delay_single_quote_subst"`'
+host_alias='`$ECHO "$host_alias" | $SED "$delay_single_quote_subst"`'
+host='`$ECHO "$host" | $SED "$delay_single_quote_subst"`'
+host_os='`$ECHO "$host_os" | $SED "$delay_single_quote_subst"`'
+build_alias='`$ECHO "$build_alias" | $SED "$delay_single_quote_subst"`'
+build='`$ECHO "$build" | $SED "$delay_single_quote_subst"`'
+build_os='`$ECHO "$build_os" | $SED "$delay_single_quote_subst"`'
+SED='`$ECHO "$SED" | $SED "$delay_single_quote_subst"`'
+Xsed='`$ECHO "$Xsed" | $SED "$delay_single_quote_subst"`'
+GREP='`$ECHO "$GREP" | $SED "$delay_single_quote_subst"`'
+EGREP='`$ECHO "$EGREP" | $SED "$delay_single_quote_subst"`'
+FGREP='`$ECHO "$FGREP" | $SED "$delay_single_quote_subst"`'
+LD='`$ECHO "$LD" | $SED "$delay_single_quote_subst"`'
+NM='`$ECHO "$NM" | $SED "$delay_single_quote_subst"`'
+LN_S='`$ECHO "$LN_S" | $SED "$delay_single_quote_subst"`'
+max_cmd_len='`$ECHO "$max_cmd_len" | $SED "$delay_single_quote_subst"`'
+ac_objext='`$ECHO "$ac_objext" | $SED "$delay_single_quote_subst"`'
+exeext='`$ECHO "$exeext" | $SED "$delay_single_quote_subst"`'
+lt_unset='`$ECHO "$lt_unset" | $SED "$delay_single_quote_subst"`'
+lt_SP2NL='`$ECHO "$lt_SP2NL" | $SED "$delay_single_quote_subst"`'
+lt_NL2SP='`$ECHO "$lt_NL2SP" | $SED "$delay_single_quote_subst"`'
+lt_cv_to_host_file_cmd='`$ECHO "$lt_cv_to_host_file_cmd" | $SED "$delay_single_quote_subst"`'
+lt_cv_to_tool_file_cmd='`$ECHO "$lt_cv_to_tool_file_cmd" | $SED "$delay_single_quote_subst"`'
+reload_flag='`$ECHO "$reload_flag" | $SED "$delay_single_quote_subst"`'
+reload_cmds='`$ECHO "$reload_cmds" | $SED "$delay_single_quote_subst"`'
+OBJDUMP='`$ECHO "$OBJDUMP" | $SED "$delay_single_quote_subst"`'
+deplibs_check_method='`$ECHO "$deplibs_check_method" | $SED "$delay_single_quote_subst"`'
+file_magic_cmd='`$ECHO "$file_magic_cmd" | $SED "$delay_single_quote_subst"`'
+file_magic_glob='`$ECHO "$file_magic_glob" | $SED "$delay_single_quote_subst"`'
+want_nocaseglob='`$ECHO "$want_nocaseglob" | $SED "$delay_single_quote_subst"`'
+DLLTOOL='`$ECHO "$DLLTOOL" | $SED "$delay_single_quote_subst"`'
+sharedlib_from_linklib_cmd='`$ECHO "$sharedlib_from_linklib_cmd" | $SED "$delay_single_quote_subst"`'
+AR='`$ECHO "$AR" | $SED "$delay_single_quote_subst"`'
+AR_FLAGS='`$ECHO "$AR_FLAGS" | $SED "$delay_single_quote_subst"`'
+archiver_list_spec='`$ECHO "$archiver_list_spec" | $SED "$delay_single_quote_subst"`'
+STRIP='`$ECHO "$STRIP" | $SED "$delay_single_quote_subst"`'
+RANLIB='`$ECHO "$RANLIB" | $SED "$delay_single_quote_subst"`'
+old_postinstall_cmds='`$ECHO "$old_postinstall_cmds" | $SED "$delay_single_quote_subst"`'
+old_postuninstall_cmds='`$ECHO "$old_postuninstall_cmds" | $SED "$delay_single_quote_subst"`'
+old_archive_cmds='`$ECHO "$old_archive_cmds" | $SED "$delay_single_quote_subst"`'
+lock_old_archive_extraction='`$ECHO "$lock_old_archive_extraction" | $SED "$delay_single_quote_subst"`'
+CC='`$ECHO "$CC" | $SED "$delay_single_quote_subst"`'
+CFLAGS='`$ECHO "$CFLAGS" | $SED "$delay_single_quote_subst"`'
+compiler='`$ECHO "$compiler" | $SED "$delay_single_quote_subst"`'
+GCC='`$ECHO "$GCC" | $SED "$delay_single_quote_subst"`'
+lt_cv_sys_global_symbol_pipe='`$ECHO "$lt_cv_sys_global_symbol_pipe" | $SED "$delay_single_quote_subst"`'
+lt_cv_sys_global_symbol_to_cdecl='`$ECHO "$lt_cv_sys_global_symbol_to_cdecl" | $SED "$delay_single_quote_subst"`'
+lt_cv_sys_global_symbol_to_c_name_address='`$ECHO "$lt_cv_sys_global_symbol_to_c_name_address" | $SED "$delay_single_quote_subst"`'
+lt_cv_sys_global_symbol_to_c_name_address_lib_prefix='`$ECHO "$lt_cv_sys_global_symbol_to_c_name_address_lib_prefix" | $SED "$delay_single_quote_subst"`'
+nm_file_list_spec='`$ECHO "$nm_file_list_spec" | $SED "$delay_single_quote_subst"`'
+lt_sysroot='`$ECHO "$lt_sysroot" | $SED "$delay_single_quote_subst"`'
+objdir='`$ECHO "$objdir" | $SED "$delay_single_quote_subst"`'
+MAGIC_CMD='`$ECHO "$MAGIC_CMD" | $SED "$delay_single_quote_subst"`'
+lt_prog_compiler_no_builtin_flag='`$ECHO "$lt_prog_compiler_no_builtin_flag" | $SED "$delay_single_quote_subst"`'
+lt_prog_compiler_pic='`$ECHO "$lt_prog_compiler_pic" | $SED "$delay_single_quote_subst"`'
+lt_prog_compiler_wl='`$ECHO "$lt_prog_compiler_wl" | $SED "$delay_single_quote_subst"`'
+lt_prog_compiler_static='`$ECHO "$lt_prog_compiler_static" | $SED "$delay_single_quote_subst"`'
+lt_cv_prog_compiler_c_o='`$ECHO "$lt_cv_prog_compiler_c_o" | $SED "$delay_single_quote_subst"`'
+need_locks='`$ECHO "$need_locks" | $SED "$delay_single_quote_subst"`'
+MANIFEST_TOOL='`$ECHO "$MANIFEST_TOOL" | $SED "$delay_single_quote_subst"`'
+DSYMUTIL='`$ECHO "$DSYMUTIL" | $SED "$delay_single_quote_subst"`'
+NMEDIT='`$ECHO "$NMEDIT" | $SED "$delay_single_quote_subst"`'
+LIPO='`$ECHO "$LIPO" | $SED "$delay_single_quote_subst"`'
+OTOOL='`$ECHO "$OTOOL" | $SED "$delay_single_quote_subst"`'
+OTOOL64='`$ECHO "$OTOOL64" | $SED "$delay_single_quote_subst"`'
+libext='`$ECHO "$libext" | $SED "$delay_single_quote_subst"`'
+shrext_cmds='`$ECHO "$shrext_cmds" | $SED "$delay_single_quote_subst"`'
+extract_expsyms_cmds='`$ECHO "$extract_expsyms_cmds" | $SED "$delay_single_quote_subst"`'
+archive_cmds_need_lc='`$ECHO "$archive_cmds_need_lc" | $SED "$delay_single_quote_subst"`'
+enable_shared_with_static_runtimes='`$ECHO "$enable_shared_with_static_runtimes" | $SED "$delay_single_quote_subst"`'
+export_dynamic_flag_spec='`$ECHO "$export_dynamic_flag_spec" | $SED "$delay_single_quote_subst"`'
+whole_archive_flag_spec='`$ECHO "$whole_archive_flag_spec" | $SED "$delay_single_quote_subst"`'
+compiler_needs_object='`$ECHO "$compiler_needs_object" | $SED "$delay_single_quote_subst"`'
+old_archive_from_new_cmds='`$ECHO "$old_archive_from_new_cmds" | $SED "$delay_single_quote_subst"`'
+old_archive_from_expsyms_cmds='`$ECHO "$old_archive_from_expsyms_cmds" | $SED "$delay_single_quote_subst"`'
+archive_cmds='`$ECHO "$archive_cmds" | $SED "$delay_single_quote_subst"`'
+archive_expsym_cmds='`$ECHO "$archive_expsym_cmds" | $SED "$delay_single_quote_subst"`'
+module_cmds='`$ECHO "$module_cmds" | $SED "$delay_single_quote_subst"`'
+module_expsym_cmds='`$ECHO "$module_expsym_cmds" | $SED "$delay_single_quote_subst"`'
+with_gnu_ld='`$ECHO "$with_gnu_ld" | $SED "$delay_single_quote_subst"`'
+allow_undefined_flag='`$ECHO "$allow_undefined_flag" | $SED "$delay_single_quote_subst"`'
+no_undefined_flag='`$ECHO "$no_undefined_flag" | $SED "$delay_single_quote_subst"`'
+hardcode_libdir_flag_spec='`$ECHO "$hardcode_libdir_flag_spec" | $SED "$delay_single_quote_subst"`'
+hardcode_libdir_separator='`$ECHO "$hardcode_libdir_separator" | $SED "$delay_single_quote_subst"`'
+hardcode_direct='`$ECHO "$hardcode_direct" | $SED "$delay_single_quote_subst"`'
+hardcode_direct_absolute='`$ECHO "$hardcode_direct_absolute" | $SED "$delay_single_quote_subst"`'
+hardcode_minus_L='`$ECHO "$hardcode_minus_L" | $SED "$delay_single_quote_subst"`'
+hardcode_shlibpath_var='`$ECHO "$hardcode_shlibpath_var" | $SED "$delay_single_quote_subst"`'
+hardcode_automatic='`$ECHO "$hardcode_automatic" | $SED "$delay_single_quote_subst"`'
+inherit_rpath='`$ECHO "$inherit_rpath" | $SED "$delay_single_quote_subst"`'
+link_all_deplibs='`$ECHO "$link_all_deplibs" | $SED "$delay_single_quote_subst"`'
+always_export_symbols='`$ECHO "$always_export_symbols" | $SED "$delay_single_quote_subst"`'
+export_symbols_cmds='`$ECHO "$export_symbols_cmds" | $SED "$delay_single_quote_subst"`'
+exclude_expsyms='`$ECHO "$exclude_expsyms" | $SED "$delay_single_quote_subst"`'
+include_expsyms='`$ECHO "$include_expsyms" | $SED "$delay_single_quote_subst"`'
+prelink_cmds='`$ECHO "$prelink_cmds" | $SED "$delay_single_quote_subst"`'
+postlink_cmds='`$ECHO "$postlink_cmds" | $SED "$delay_single_quote_subst"`'
+file_list_spec='`$ECHO "$file_list_spec" | $SED "$delay_single_quote_subst"`'
+variables_saved_for_relink='`$ECHO "$variables_saved_for_relink" | $SED "$delay_single_quote_subst"`'
+need_lib_prefix='`$ECHO "$need_lib_prefix" | $SED "$delay_single_quote_subst"`'
+need_version='`$ECHO "$need_version" | $SED "$delay_single_quote_subst"`'
+version_type='`$ECHO "$version_type" | $SED "$delay_single_quote_subst"`'
+runpath_var='`$ECHO "$runpath_var" | $SED "$delay_single_quote_subst"`'
+shlibpath_var='`$ECHO "$shlibpath_var" | $SED "$delay_single_quote_subst"`'
+shlibpath_overrides_runpath='`$ECHO "$shlibpath_overrides_runpath" | $SED "$delay_single_quote_subst"`'
+libname_spec='`$ECHO "$libname_spec" | $SED "$delay_single_quote_subst"`'
+library_names_spec='`$ECHO "$library_names_spec" | $SED "$delay_single_quote_subst"`'
+soname_spec='`$ECHO "$soname_spec" | $SED "$delay_single_quote_subst"`'
+install_override_mode='`$ECHO "$install_override_mode" | $SED "$delay_single_quote_subst"`'
+postinstall_cmds='`$ECHO "$postinstall_cmds" | $SED "$delay_single_quote_subst"`'
+postuninstall_cmds='`$ECHO "$postuninstall_cmds" | $SED "$delay_single_quote_subst"`'
+finish_cmds='`$ECHO "$finish_cmds" | $SED "$delay_single_quote_subst"`'
+finish_eval='`$ECHO "$finish_eval" | $SED "$delay_single_quote_subst"`'
+hardcode_into_libs='`$ECHO "$hardcode_into_libs" | $SED "$delay_single_quote_subst"`'
+sys_lib_search_path_spec='`$ECHO "$sys_lib_search_path_spec" | $SED "$delay_single_quote_subst"`'
+sys_lib_dlsearch_path_spec='`$ECHO "$sys_lib_dlsearch_path_spec" | $SED "$delay_single_quote_subst"`'
+hardcode_action='`$ECHO "$hardcode_action" | $SED "$delay_single_quote_subst"`'
+enable_dlopen='`$ECHO "$enable_dlopen" | $SED "$delay_single_quote_subst"`'
+enable_dlopen_self='`$ECHO "$enable_dlopen_self" | $SED "$delay_single_quote_subst"`'
+enable_dlopen_self_static='`$ECHO "$enable_dlopen_self_static" | $SED "$delay_single_quote_subst"`'
+old_striplib='`$ECHO "$old_striplib" | $SED "$delay_single_quote_subst"`'
+striplib='`$ECHO "$striplib" | $SED "$delay_single_quote_subst"`'
 
 LTCC='$LTCC'
 LTCFLAGS='$LTCFLAGS'
 compiler='$compiler_DEFAULT'
 
+# A function that is used when there is no print builtin or printf.
+func_fallback_echo ()
+{
+  eval 'cat <<_LTECHO_EOF
+\$1
+_LTECHO_EOF'
+}
+
 # Quote evaled strings.
-for var in SED \
+for var in SHELL \
+ECHO \
+PATH_SEPARATOR \
+SED \
 GREP \
 EGREP \
 FGREP \
@@ -17084,8 +15604,13 @@ reload_flag \
 OBJDUMP \
 deplibs_check_method \
 file_magic_cmd \
+file_magic_glob \
+want_nocaseglob \
+DLLTOOL \
+sharedlib_from_linklib_cmd \
 AR \
 AR_FLAGS \
+archiver_list_spec \
 STRIP \
 RANLIB \
 CC \
@@ -17095,14 +15620,14 @@ lt_cv_sys_global_symbol_pipe \
 lt_cv_sys_global_symbol_to_cdecl \
 lt_cv_sys_global_symbol_to_c_name_address \
 lt_cv_sys_global_symbol_to_c_name_address_lib_prefix \
-SHELL \
-ECHO \
+nm_file_list_spec \
 lt_prog_compiler_no_builtin_flag \
-lt_prog_compiler_wl \
 lt_prog_compiler_pic \
+lt_prog_compiler_wl \
 lt_prog_compiler_static \
 lt_cv_prog_compiler_c_o \
 need_locks \
+MANIFEST_TOOL \
 DSYMUTIL \
 NMEDIT \
 LIPO \
@@ -17116,9 +15641,7 @@ with_gnu_ld \
 allow_undefined_flag \
 no_undefined_flag \
 hardcode_libdir_flag_spec \
-hardcode_libdir_flag_spec_ld \
 hardcode_libdir_separator \
-fix_srcfile_path \
 exclude_expsyms \
 include_expsyms \
 file_list_spec \
@@ -17126,12 +15649,13 @@ variables_saved_for_relink \
 libname_spec \
 library_names_spec \
 soname_spec \
+install_override_mode \
 finish_eval \
 old_striplib \
 striplib; do
-    case \`eval \\\\\$ECHO "X\\\\\$\$var"\` in
+    case \`eval \\\\\$ECHO \\\\""\\\\\$\$var"\\\\"\` in
     *[\\\\\\\`\\"\\\$]*)
-      eval "lt_\$var=\\\\\\"\\\`\\\$ECHO \\"X\\\$\$var\\" | \\\$Xsed -e \\"\\\$sed_quote_subst\\"\\\`\\\\\\""
+      eval "lt_\$var=\\\\\\"\\\`\\\$ECHO \\"\\\$\$var\\" | \\\$SED \\"\\\$sed_quote_subst\\"\\\`\\\\\\""
       ;;
     *)
       eval "lt_\$var=\\\\\\"\\\$\$var\\\\\\""
@@ -17153,14 +15677,15 @@ module_cmds \
 module_expsym_cmds \
 export_symbols_cmds \
 prelink_cmds \
+postlink_cmds \
 postinstall_cmds \
 postuninstall_cmds \
 finish_cmds \
 sys_lib_search_path_spec \
 sys_lib_dlsearch_path_spec; do
-    case \`eval \\\\\$ECHO "X\\\\\$\$var"\` in
+    case \`eval \\\\\$ECHO \\\\""\\\\\$\$var"\\\\"\` in
     *[\\\\\\\`\\"\\\$]*)
-      eval "lt_\$var=\\\\\\"\\\`\\\$ECHO \\"X\\\$\$var\\" | \\\$Xsed -e \\"\\\$double_quote_subst\\" -e \\"\\\$sed_quote_subst\\" -e \\"\\\$delay_variable_subst\\"\\\`\\\\\\""
+      eval "lt_\$var=\\\\\\"\\\`\\\$ECHO \\"\\\$\$var\\" | \\\$SED -e \\"\\\$double_quote_subst\\" -e \\"\\\$sed_quote_subst\\" -e \\"\\\$delay_variable_subst\\"\\\`\\\\\\""
       ;;
     *)
       eval "lt_\$var=\\\\\\"\\\$\$var\\\\\\""
@@ -17168,12 +15693,6 @@ sys_lib_dlsearch_path_spec; do
     esac
 done
 
-# Fix-up fallback echo if it was mangled by the above quoting rules.
-case \$lt_ECHO in
-*'\\\$0 --fallback-echo"')  lt_ECHO=\`\$ECHO "X\$lt_ECHO" | \$Xsed -e 's/\\\\\\\\\\\\\\\$0 --fallback-echo"\$/\$0 --fallback-echo"/'\`
-  ;;
-esac
-
 ac_aux_dir='$ac_aux_dir'
 xsi_shell='$xsi_shell'
 lt_shell_append='$lt_shell_append'
@@ -17206,9 +15725,7 @@ do
     "libtool") CONFIG_COMMANDS="$CONFIG_COMMANDS libtool" ;;
     "include/builddefs") CONFIG_FILES="$CONFIG_FILES include/builddefs" ;;
 
-  *) { { $as_echo "$as_me:$LINENO: error: invalid argument: $ac_config_target" >&5
-$as_echo "$as_me: error: invalid argument: $ac_config_target" >&2;}
-   { (exit 1); exit 1; }; };;
+  *) as_fn_error $? "invalid argument: \`$ac_config_target'" "$LINENO" 5;;
   esac
 done
 
@@ -17231,26 +15748,24 @@ fi
 # after its creation but before its name has been assigned to `$tmp'.
 $debug ||
 {
-  tmp=
+  tmp= ac_tmp=
   trap 'exit_status=$?
-  { test -z "$tmp" || test ! -d "$tmp" || rm -fr "$tmp"; } && exit $exit_status
+  : "${ac_tmp:=$tmp}"
+  { test ! -d "$ac_tmp" || rm -fr "$ac_tmp"; } && exit $exit_status
 ' 0
-  trap '{ (exit 1); exit 1; }' 1 2 13 15
+  trap 'as_fn_exit 1' 1 2 13 15
 }
 # Create a (secure) tmp directory for tmp files.
 
 {
   tmp=`(umask 077 && mktemp -d "./confXXXXXX") 2>/dev/null` &&
-  test -n "$tmp" && test -d "$tmp"
+  test -d "$tmp"
 }  ||
 {
   tmp=./conf$$-$RANDOM
   (umask 077 && mkdir "$tmp")
-} ||
-{
-   $as_echo "$as_me: cannot create a temporary directory in ." >&2
-   { (exit 1); exit 1; }
-}
+} || as_fn_error $? "cannot create a temporary directory in ." "$LINENO" 5
+ac_tmp=$tmp
 
 # Set up the scripts for CONFIG_FILES section.
 # No need to generate them if there are no CONFIG_FILES.
@@ -17258,7 +15773,13 @@ $debug ||
 if test -n "$CONFIG_FILES"; then
 
 
-ac_cr=''
+ac_cr=`echo X | tr X '\015'`
+# On cygwin, bash can eat \r inside `` if the user requested igncr.
+# But we know of no other shell where ac_cr would be empty at this
+# point, so we can use a bashism as a fallback.
+if test "x$ac_cr" = x; then
+  eval ac_cr=\$\'\\r\'
+fi
 ac_cs_awk_cr=`$AWK 'BEGIN { print "a\rb" }' </dev/null 2>/dev/null`
 if test "$ac_cs_awk_cr" = "a${ac_cr}b"; then
   ac_cs_awk_cr='\\r'
@@ -17266,7 +15787,7 @@ else
   ac_cs_awk_cr=$ac_cr
 fi
 
-echo 'BEGIN {' >"$tmp/subs1.awk" &&
+echo 'BEGIN {' >"$ac_tmp/subs1.awk" &&
 _ACEOF
 
 
@@ -17275,24 +15796,18 @@ _ACEOF
   echo "$ac_subst_vars" | sed 's/.*/&!$&$ac_delim/' &&
   echo "_ACEOF"
 } >conf$$subs.sh ||
-  { { $as_echo "$as_me:$LINENO: error: could not make $CONFIG_STATUS" >&5
-$as_echo "$as_me: error: could not make $CONFIG_STATUS" >&2;}
-   { (exit 1); exit 1; }; }
-ac_delim_num=`echo "$ac_subst_vars" | grep -c '$'`
+  as_fn_error $? "could not make $CONFIG_STATUS" "$LINENO" 5
+ac_delim_num=`echo "$ac_subst_vars" | grep -c '^'`
 ac_delim='%!_!# '
 for ac_last_try in false false false false false :; do
   . ./conf$$subs.sh ||
-    { { $as_echo "$as_me:$LINENO: error: could not make $CONFIG_STATUS" >&5
-$as_echo "$as_me: error: could not make $CONFIG_STATUS" >&2;}
-   { (exit 1); exit 1; }; }
+    as_fn_error $? "could not make $CONFIG_STATUS" "$LINENO" 5
 
   ac_delim_n=`sed -n "s/.*$ac_delim\$/X/p" conf$$subs.awk | grep -c X`
   if test $ac_delim_n = $ac_delim_num; then
     break
   elif $ac_last_try; then
-    { { $as_echo "$as_me:$LINENO: error: could not make $CONFIG_STATUS" >&5
-$as_echo "$as_me: error: could not make $CONFIG_STATUS" >&2;}
-   { (exit 1); exit 1; }; }
+    as_fn_error $? "could not make $CONFIG_STATUS" "$LINENO" 5
   else
     ac_delim="$ac_delim!$ac_delim _$ac_delim!! "
   fi
@@ -17300,7 +15815,7 @@ done
 rm -f conf$$subs.sh
 
 cat >>$CONFIG_STATUS <<_ACEOF || ac_write_fail=1
-cat >>"\$tmp/subs1.awk" <<\\_ACAWK &&
+cat >>"\$ac_tmp/subs1.awk" <<\\_ACAWK &&
 _ACEOF
 sed -n '
 h
@@ -17314,7 +15829,7 @@ s/'"$ac_delim"'$//
 t delim
 :nl
 h
-s/\(.\{148\}\).*/\1/
+s/\(.\{148\}\)..*/\1/
 t more1
 s/["\\]/\\&/g; s/^/"/; s/$/\\n"\\/
 p
@@ -17328,7 +15843,7 @@ s/.\{148\}//
 t nl
 :delim
 h
-s/\(.\{148\}\).*/\1/
+s/\(.\{148\}\)..*/\1/
 t more2
 s/["\\]/\\&/g; s/^/"/; s/$/"/
 p
@@ -17348,7 +15863,7 @@ t delim
 rm -f conf$$subs.awk
 cat >>$CONFIG_STATUS <<_ACEOF || ac_write_fail=1
 _ACAWK
-cat >>"\$tmp/subs1.awk" <<_ACAWK &&
+cat >>"\$ac_tmp/subs1.awk" <<_ACAWK &&
   for (key in S) S_is_set[key] = 1
   FS = ""
 
@@ -17380,23 +15895,29 @@ if sed "s/$ac_cr//" < /dev/null > /dev/n
   sed "s/$ac_cr\$//; s/$ac_cr/$ac_cs_awk_cr/g"
 else
   cat
-fi < "$tmp/subs1.awk" > "$tmp/subs.awk" \
-  || { { $as_echo "$as_me:$LINENO: error: could not setup config files machinery" >&5
-$as_echo "$as_me: error: could not setup config files machinery" >&2;}
-   { (exit 1); exit 1; }; }
+fi < "$ac_tmp/subs1.awk" > "$ac_tmp/subs.awk" \
+  || as_fn_error $? "could not setup config files machinery" "$LINENO" 5
 _ACEOF
 
-# VPATH may cause trouble with some makes, so we remove $(srcdir),
-# ${srcdir} and @srcdir@ from VPATH if srcdir is ".", strip leading and
+# VPATH may cause trouble with some makes, so we remove sole $(srcdir),
+# ${srcdir} and @srcdir@ entries from VPATH if srcdir is ".", strip leading and
 # trailing colons and then remove the whole line if VPATH becomes empty
 # (actually we leave an empty line to preserve line numbers).
 if test "x$srcdir" = x.; then
-  ac_vpsub='/^[	 ]*VPATH[	 ]*=/{
-s/:*\$(srcdir):*/:/
-s/:*\${srcdir}:*/:/
-s/:*@srcdir@:*/:/
-s/^\([^=]*=[	 ]*\):*/\1/
+  ac_vpsub='/^[	 ]*VPATH[	 ]*=[	 ]*/{
+h
+s///
+s/^/:/
+s/[	 ]*$/:/
+s/:\$(srcdir):/:/g
+s/:\${srcdir}:/:/g
+s/:@srcdir@:/:/g
+s/^:*//
 s/:*$//
+x
+s/\(=[	 ]*\).*/\1/
+G
+s/\n//
 s/^[^=]*=[	 ]*$//
 }'
 fi
@@ -17408,7 +15929,7 @@ fi # test -n "$CONFIG_FILES"
 # No need to generate them if there are no CONFIG_HEADERS.
 # This happens for instance with `./config.status Makefile'.
 if test -n "$CONFIG_HEADERS"; then
-cat >"$tmp/defines.awk" <<\_ACAWK ||
+cat >"$ac_tmp/defines.awk" <<\_ACAWK ||
 BEGIN {
 _ACEOF
 
@@ -17420,13 +15941,11 @@ _ACEOF
 # handling of long lines.
 ac_delim='%!_!# '
 for ac_last_try in false false :; do
-  ac_t=`sed -n "/$ac_delim/p" confdefs.h`
-  if test -z "$ac_t"; then
+  ac_tt=`sed -n "/$ac_delim/p" confdefs.h`
+  if test -z "$ac_tt"; then
     break
   elif $ac_last_try; then
-    { { $as_echo "$as_me:$LINENO: error: could not make $CONFIG_HEADERS" >&5
-$as_echo "$as_me: error: could not make $CONFIG_HEADERS" >&2;}
-   { (exit 1); exit 1; }; }
+    as_fn_error $? "could not make $CONFIG_HEADERS" "$LINENO" 5
   else
     ac_delim="$ac_delim!$ac_delim _$ac_delim!! "
   fi
@@ -17511,9 +16030,7 @@ cat >>$CONFIG_STATUS <<_ACEOF || ac_writ
 _ACAWK
 _ACEOF
 cat >>$CONFIG_STATUS <<\_ACEOF || ac_write_fail=1
-  { { $as_echo "$as_me:$LINENO: error: could not setup config headers machinery" >&5
-$as_echo "$as_me: error: could not setup config headers machinery" >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "could not setup config headers machinery" "$LINENO" 5
 fi # test -n "$CONFIG_HEADERS"
 
 
@@ -17526,9 +16043,7 @@ do
   esac
   case $ac_mode$ac_tag in
   :[FHL]*:*);;
-  :L* | :C*:*) { { $as_echo "$as_me:$LINENO: error: invalid tag $ac_tag" >&5
-$as_echo "$as_me: error: invalid tag $ac_tag" >&2;}
-   { (exit 1); exit 1; }; };;
+  :L* | :C*:*) as_fn_error $? "invalid tag \`$ac_tag'" "$LINENO" 5;;
   :[FH]-) ac_tag=-:-;;
   :[FH]*) ac_tag=$ac_tag:$ac_tag.in;;
   esac
@@ -17547,7 +16062,7 @@ $as_echo "$as_me: error: invalid tag $ac
     for ac_f
     do
       case $ac_f in
-      -) ac_f="$tmp/stdin";;
+      -) ac_f="$ac_tmp/stdin";;
       *) # Look for the file first in the build tree, then in the source tree
 	 # (if the path is not absolute).  The absolute path cannot be DOS-style,
 	 # because $ac_f cannot contain `:'.
@@ -17556,12 +16071,10 @@ $as_echo "$as_me: error: invalid tag $ac
 	   [\\/$]*) false;;
 	   *) test -f "$srcdir/$ac_f" && ac_f="$srcdir/$ac_f";;
 	   esac ||
-	   { { $as_echo "$as_me:$LINENO: error: cannot find input file: $ac_f" >&5
-$as_echo "$as_me: error: cannot find input file: $ac_f" >&2;}
-   { (exit 1); exit 1; }; };;
+	   as_fn_error 1 "cannot find input file: \`$ac_f'" "$LINENO" 5;;
       esac
       case $ac_f in *\'*) ac_f=`$as_echo "$ac_f" | sed "s/'/'\\\\\\\\''/g"`;; esac
-      ac_file_inputs="$ac_file_inputs '$ac_f'"
+      as_fn_append ac_file_inputs " '$ac_f'"
     done
 
     # Let's still pretend it is `configure' which instantiates (i.e., don't
@@ -17572,7 +16085,7 @@ $as_echo "$as_me: error: cannot find inp
 	`' by configure.'
     if test x"$ac_file" != x-; then
       configure_input="$ac_file.  $configure_input"
-      { $as_echo "$as_me:$LINENO: creating $ac_file" >&5
+      { $as_echo "$as_me:${as_lineno-$LINENO}: creating $ac_file" >&5
 $as_echo "$as_me: creating $ac_file" >&6;}
     fi
     # Neutralize special characters interpreted by sed in replacement strings.
@@ -17584,10 +16097,8 @@ $as_echo "$as_me: creating $ac_file" >&6
     esac
 
     case $ac_tag in
-    *:-:* | *:-) cat >"$tmp/stdin" \
-      || { { $as_echo "$as_me:$LINENO: error: could not create $ac_file" >&5
-$as_echo "$as_me: error: could not create $ac_file" >&2;}
-   { (exit 1); exit 1; }; } ;;
+    *:-:* | *:-) cat >"$ac_tmp/stdin" \
+      || as_fn_error $? "could not create $ac_file" "$LINENO" 5 ;;
     esac
     ;;
   esac
@@ -17615,47 +16126,7 @@ $as_echo X"$ac_file" |
 	    q
 	  }
 	  s/.*/./; q'`
-  { as_dir="$ac_dir"
-  case $as_dir in #(
-  -*) as_dir=./$as_dir;;
-  esac
-  test -d "$as_dir" || { $as_mkdir_p && mkdir -p "$as_dir"; } || {
-    as_dirs=
-    while :; do
-      case $as_dir in #(
-      *\'*) as_qdir=`$as_echo "$as_dir" | sed "s/'/'\\\\\\\\''/g"`;; #'(
-      *) as_qdir=$as_dir;;
-      esac
-      as_dirs="'$as_qdir' $as_dirs"
-      as_dir=`$as_dirname -- "$as_dir" ||
-$as_expr X"$as_dir" : 'X\(.*[^/]\)//*[^/][^/]*/*$' \| \
-	 X"$as_dir" : 'X\(//\)[^/]' \| \
-	 X"$as_dir" : 'X\(//\)$' \| \
-	 X"$as_dir" : 'X\(/\)' \| . 2>/dev/null ||
-$as_echo X"$as_dir" |
-    sed '/^X\(.*[^/]\)\/\/*[^/][^/]*\/*$/{
-	    s//\1/
-	    q
-	  }
-	  /^X\(\/\/\)[^/].*/{
-	    s//\1/
-	    q
-	  }
-	  /^X\(\/\/\)$/{
-	    s//\1/
-	    q
-	  }
-	  /^X\(\/\).*/{
-	    s//\1/
-	    q
-	  }
-	  s/.*/./; q'`
-      test -d "$as_dir" && break
-    done
-    test -z "$as_dirs" || eval "mkdir $as_dirs"
-  } || test -d "$as_dir" || { { $as_echo "$as_me:$LINENO: error: cannot create directory $as_dir" >&5
-$as_echo "$as_me: error: cannot create directory $as_dir" >&2;}
-   { (exit 1); exit 1; }; }; }
+  as_dir="$ac_dir"; as_fn_mkdir_p
   ac_builddir=.
 
 case "$ac_dir" in
@@ -17697,13 +16168,16 @@ ac_abs_srcdir=$ac_abs_top_srcdir$ac_dir_
   # CONFIG_FILE
   #
 
+  case $INSTALL in
+  [\\/$]* | ?:[\\/]* ) ac_INSTALL=$INSTALL ;;
+  *) ac_INSTALL=$ac_top_build_prefix$INSTALL ;;
+  esac
 _ACEOF
 
 cat >>$CONFIG_STATUS <<\_ACEOF || ac_write_fail=1
 # If the template does not know about datarootdir, expand it.
 # FIXME: This hack should be removed a few years after 2.60.
 ac_datarootdir_hack=; ac_datarootdir_seen=
-
 ac_sed_dataroot='
 /datarootdir/ {
   p
@@ -17713,12 +16187,11 @@ ac_sed_dataroot='
 /@docdir@/p
 /@infodir@/p
 /@localedir@/p
-/@mandir@/p
-'
+/@mandir@/p'
 case `eval "sed -n \"\$ac_sed_dataroot\" $ac_file_inputs"` in
 *datarootdir*) ac_datarootdir_seen=yes;;
 *@datadir@*|*@docdir@*|*@infodir@*|*@localedir@*|*@mandir@*)
-  { $as_echo "$as_me:$LINENO: WARNING: $ac_file_inputs seems to ignore the --datarootdir setting" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: $ac_file_inputs seems to ignore the --datarootdir setting" >&5
 $as_echo "$as_me: WARNING: $ac_file_inputs seems to ignore the --datarootdir setting" >&2;}
 _ACEOF
 cat >>$CONFIG_STATUS <<_ACEOF || ac_write_fail=1
@@ -17728,7 +16201,7 @@ cat >>$CONFIG_STATUS <<_ACEOF || ac_writ
   s&@infodir@&$infodir&g
   s&@localedir@&$localedir&g
   s&@mandir@&$mandir&g
-    s&\\\${datarootdir}&$datarootdir&g' ;;
+  s&\\\${datarootdir}&$datarootdir&g' ;;
 esac
 _ACEOF
 
@@ -17752,29 +16225,27 @@ s&@abs_top_srcdir@&$ac_abs_top_srcdir&;t
 s&@builddir@&$ac_builddir&;t t
 s&@abs_builddir@&$ac_abs_builddir&;t t
 s&@abs_top_builddir@&$ac_abs_top_builddir&;t t
+s&@INSTALL@&$ac_INSTALL&;t t
 $ac_datarootdir_hack
 "
-eval sed \"\$ac_sed_extra\" "$ac_file_inputs" | $AWK -f "$tmp/subs.awk" >$tmp/out \
-  || { { $as_echo "$as_me:$LINENO: error: could not create $ac_file" >&5
-$as_echo "$as_me: error: could not create $ac_file" >&2;}
-   { (exit 1); exit 1; }; }
+eval sed \"\$ac_sed_extra\" "$ac_file_inputs" | $AWK -f "$ac_tmp/subs.awk" \
+  >$ac_tmp/out || as_fn_error $? "could not create $ac_file" "$LINENO" 5
 
 test -z "$ac_datarootdir_hack$ac_datarootdir_seen" &&
-  { ac_out=`sed -n '/\${datarootdir}/p' "$tmp/out"`; test -n "$ac_out"; } &&
-  { ac_out=`sed -n '/^[	 ]*datarootdir[	 ]*:*=/p' "$tmp/out"`; test -z "$ac_out"; } &&
-  { $as_echo "$as_me:$LINENO: WARNING: $ac_file contains a reference to the variable \`datarootdir'
-which seems to be undefined.  Please make sure it is defined." >&5
+  { ac_out=`sed -n '/\${datarootdir}/p' "$ac_tmp/out"`; test -n "$ac_out"; } &&
+  { ac_out=`sed -n '/^[	 ]*datarootdir[	 ]*:*=/p' \
+      "$ac_tmp/out"`; test -z "$ac_out"; } &&
+  { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: $ac_file contains a reference to the variable \`datarootdir'
+which seems to be undefined.  Please make sure it is defined" >&5
 $as_echo "$as_me: WARNING: $ac_file contains a reference to the variable \`datarootdir'
-which seems to be undefined.  Please make sure it is defined." >&2;}
+which seems to be undefined.  Please make sure it is defined" >&2;}
 
-  rm -f "$tmp/stdin"
+  rm -f "$ac_tmp/stdin"
   case $ac_file in
-  -) cat "$tmp/out" && rm -f "$tmp/out";;
-  *) rm -f "$ac_file" && mv "$tmp/out" "$ac_file";;
+  -) cat "$ac_tmp/out" && rm -f "$ac_tmp/out";;
+  *) rm -f "$ac_file" && mv "$ac_tmp/out" "$ac_file";;
   esac \
-  || { { $as_echo "$as_me:$LINENO: error: could not create $ac_file" >&5
-$as_echo "$as_me: error: could not create $ac_file" >&2;}
-   { (exit 1); exit 1; }; }
+  || as_fn_error $? "could not create $ac_file" "$LINENO" 5
  ;;
   :H)
   #
@@ -17783,31 +16254,25 @@ $as_echo "$as_me: error: could not creat
   if test x"$ac_file" != x-; then
     {
       $as_echo "/* $configure_input  */" \
-      && eval '$AWK -f "$tmp/defines.awk"' "$ac_file_inputs"
-    } >"$tmp/config.h" \
-      || { { $as_echo "$as_me:$LINENO: error: could not create $ac_file" >&5
-$as_echo "$as_me: error: could not create $ac_file" >&2;}
-   { (exit 1); exit 1; }; }
-    if diff "$ac_file" "$tmp/config.h" >/dev/null 2>&1; then
-      { $as_echo "$as_me:$LINENO: $ac_file is unchanged" >&5
+      && eval '$AWK -f "$ac_tmp/defines.awk"' "$ac_file_inputs"
+    } >"$ac_tmp/config.h" \
+      || as_fn_error $? "could not create $ac_file" "$LINENO" 5
+    if diff "$ac_file" "$ac_tmp/config.h" >/dev/null 2>&1; then
+      { $as_echo "$as_me:${as_lineno-$LINENO}: $ac_file is unchanged" >&5
 $as_echo "$as_me: $ac_file is unchanged" >&6;}
     else
       rm -f "$ac_file"
-      mv "$tmp/config.h" "$ac_file" \
-	|| { { $as_echo "$as_me:$LINENO: error: could not create $ac_file" >&5
-$as_echo "$as_me: error: could not create $ac_file" >&2;}
-   { (exit 1); exit 1; }; }
+      mv "$ac_tmp/config.h" "$ac_file" \
+	|| as_fn_error $? "could not create $ac_file" "$LINENO" 5
     fi
   else
     $as_echo "/* $configure_input  */" \
-      && eval '$AWK -f "$tmp/defines.awk"' "$ac_file_inputs" \
-      || { { $as_echo "$as_me:$LINENO: error: could not create -" >&5
-$as_echo "$as_me: error: could not create -" >&2;}
-   { (exit 1); exit 1; }; }
+      && eval '$AWK -f "$ac_tmp/defines.awk"' "$ac_file_inputs" \
+      || as_fn_error $? "could not create -" "$LINENO" 5
   fi
  ;;
 
-  :C)  { $as_echo "$as_me:$LINENO: executing $ac_file commands" >&5
+  :C)  { $as_echo "$as_me:${as_lineno-$LINENO}: executing $ac_file commands" >&5
 $as_echo "$as_me: executing $ac_file commands" >&6;}
  ;;
   esac
@@ -17835,7 +16300,8 @@ $as_echo "$as_me: executing $ac_file com
 # NOTE: Changes made to this file will be lost: look at ltmain.sh.
 #
 #   Copyright (C) 1996, 1997, 1998, 1999, 2000, 2001, 2003, 2004, 2005,
-#                 2006, 2007, 2008 Free Software Foundation, Inc.
+#                 2006, 2007, 2008, 2009, 2010, 2011 Free Software
+#                 Foundation, Inc.
 #   Written by Gordon Matzigkeit, 1996
 #
 #   This file is part of GNU Libtool.
@@ -17883,6 +16349,15 @@ pic_mode=$pic_mode
 # Whether or not to optimize for fast installation.
 fast_install=$enable_fast_install
 
+# Shell to use when invoking shell scripts.
+SHELL=$lt_SHELL
+
+# An echo program that protects backslashes.
+ECHO=$lt_ECHO
+
+# The PATH separator for the build system.
+PATH_SEPARATOR=$lt_PATH_SEPARATOR
+
 # The host system.
 host_alias=$host_alias
 host=$host
@@ -17932,9 +16407,11 @@ SP2NL=$lt_lt_SP2NL
 # turn newlines into spaces.
 NL2SP=$lt_lt_NL2SP
 
-# How to create reloadable object files.
-reload_flag=$lt_reload_flag
-reload_cmds=$lt_reload_cmds
+# convert \$build file names to \$host format.
+to_host_file_cmd=$lt_cv_to_host_file_cmd
+
+# convert \$build files to toolchain format.
+to_tool_file_cmd=$lt_cv_to_tool_file_cmd
 
 # An object symbol dumper.
 OBJDUMP=$lt_OBJDUMP
@@ -17942,13 +16419,30 @@ OBJDUMP=$lt_OBJDUMP
 # Method to check whether dependent libraries are shared objects.
 deplibs_check_method=$lt_deplibs_check_method
 
-# Command to use when deplibs_check_method == "file_magic".
+# Command to use when deplibs_check_method = "file_magic".
 file_magic_cmd=$lt_file_magic_cmd
 
+# How to find potential files when deplibs_check_method = "file_magic".
+file_magic_glob=$lt_file_magic_glob
+
+# Find potential files using nocaseglob when deplibs_check_method = "file_magic".
+want_nocaseglob=$lt_want_nocaseglob
+
+# DLL creation program.
+DLLTOOL=$lt_DLLTOOL
+
+# Command to associate shared and link libraries.
+sharedlib_from_linklib_cmd=$lt_sharedlib_from_linklib_cmd
+
 # The archiver.
 AR=$lt_AR
+
+# Flags to create an archive.
 AR_FLAGS=$lt_AR_FLAGS
 
+# How to feed a file listing to the archiver.
+archiver_list_spec=$lt_archiver_list_spec
+
 # A symbol stripping program.
 STRIP=$lt_STRIP
 
@@ -17957,6 +16451,9 @@ RANLIB=$lt_RANLIB
 old_postinstall_cmds=$lt_old_postinstall_cmds
 old_postuninstall_cmds=$lt_old_postuninstall_cmds
 
+# Whether to use a lock for old archive extraction.
+lock_old_archive_extraction=$lock_old_archive_extraction
+
 # A C compiler.
 LTCC=$lt_CC
 
@@ -17975,14 +16472,14 @@ global_symbol_to_c_name_address=$lt_lt_c
 # Transform the output of nm in a C name address pair when lib prefix is needed.
 global_symbol_to_c_name_address_lib_prefix=$lt_lt_cv_sys_global_symbol_to_c_name_address_lib_prefix
 
-# The name of the directory that contains temporary libtool files.
-objdir=$objdir
+# Specify filename containing input files for \$NM.
+nm_file_list_spec=$lt_nm_file_list_spec
 
-# Shell to use when invoking shell scripts.
-SHELL=$lt_SHELL
+# The root where to search for dependent libraries,and in which our libraries should be installed.
+lt_sysroot=$lt_sysroot
 
-# An echo program that does not interpret backslashes.
-ECHO=$lt_ECHO
+# The name of the directory that contains temporary libtool files.
+objdir=$objdir
 
 # Used to examine libraries when file_magic_cmd begins with "file".
 MAGIC_CMD=$MAGIC_CMD
@@ -17990,6 +16487,9 @@ MAGIC_CMD=$MAGIC_CMD
 # Must we lock files when doing compilation?
 need_locks=$lt_need_locks
 
+# Manifest tool.
+MANIFEST_TOOL=$lt_MANIFEST_TOOL
+
 # Tool to manipulate archived DWARF debug symbol files on Mac OS X.
 DSYMUTIL=$lt_DSYMUTIL
 
@@ -18046,6 +16546,9 @@ library_names_spec=$lt_library_names_spe
 # The coded name of the library, if different from the real name.
 soname_spec=$lt_soname_spec
 
+# Permission mode override for installation of shared libraries.
+install_override_mode=$lt_install_override_mode
+
 # Command to use after installation of a shared archive.
 postinstall_cmds=$lt_postinstall_cmds
 
@@ -18085,6 +16588,10 @@ striplib=$lt_striplib
 # The linker used to build libraries.
 LD=$lt_LD
 
+# How to create reloadable object files.
+reload_flag=$lt_reload_flag
+reload_cmds=$lt_reload_cmds
+
 # Commands used to build an old-style archive.
 old_archive_cmds=$lt_old_archive_cmds
 
@@ -18097,12 +16604,12 @@ with_gcc=$GCC
 # Compiler flag to turn off builtin functions.
 no_builtin_flag=$lt_lt_prog_compiler_no_builtin_flag
 
-# How to pass a linker flag through the compiler.
-wl=$lt_lt_prog_compiler_wl
-
 # Additional compiler flags for building library objects.
 pic_flag=$lt_lt_prog_compiler_pic
 
+# How to pass a linker flag through the compiler.
+wl=$lt_lt_prog_compiler_wl
+
 # Compiler flag to prevent dynamic linking.
 link_static_flag=$lt_lt_prog_compiler_static
 
@@ -18152,10 +16659,6 @@ no_undefined_flag=$lt_no_undefined_flag
 # This must work even if \$libdir does not exist
 hardcode_libdir_flag_spec=$lt_hardcode_libdir_flag_spec
 
-# If ld is used when linking, flag to hardcode \$libdir into a binary
-# during linking.  This must work even if \$libdir does not exist.
-hardcode_libdir_flag_spec_ld=$lt_hardcode_libdir_flag_spec_ld
-
 # Whether we need a single "-rpath" flag with a separated argument.
 hardcode_libdir_separator=$lt_hardcode_libdir_separator
 
@@ -18189,9 +16692,6 @@ inherit_rpath=$inherit_rpath
 # Whether libtool must link a program against all its dependency libraries.
 link_all_deplibs=$link_all_deplibs
 
-# Fix the shell variable \$srcfile for the compiler.
-fix_srcfile_path=$lt_fix_srcfile_path
-
 # Set to "yes" if exported symbols are required.
 always_export_symbols=$always_export_symbols
 
@@ -18207,6 +16707,9 @@ include_expsyms=$lt_include_expsyms
 # Commands necessary for linking programs (against libraries) with templates.
 prelink_cmds=$lt_prelink_cmds
 
+# Commands necessary for finishing linking programs.
+postlink_cmds=$lt_postlink_cmds
+
 # Specify filename containing input files.
 file_list_spec=$lt_file_list_spec
 
@@ -18239,212 +16742,169 @@ ltmain="$ac_aux_dir/ltmain.sh"
   # if finds mixed CR/LF and LF-only lines.  Since sed operates in
   # text mode, it properly converts lines to CR/LF.  This bash problem
   # is reportedly fixed, but why not run on old versions too?
-  sed '/^# Generated shell functions inserted here/q' "$ltmain" >> "$cfgfile" \
-    || (rm -f "$cfgfile"; exit 1)
-
-  case $xsi_shell in
-  yes)
-    cat << \_LT_EOF >> "$cfgfile"
-
-# func_dirname file append nondir_replacement
-# Compute the dirname of FILE.  If nonempty, add APPEND to the result,
-# otherwise set result to NONDIR_REPLACEMENT.
-func_dirname ()
-{
-  case ${1} in
-    */*) func_dirname_result="${1%/*}${2}" ;;
-    *  ) func_dirname_result="${3}" ;;
-  esac
-}
-
-# func_basename file
-func_basename ()
-{
-  func_basename_result="${1##*/}"
-}
-
-# func_dirname_and_basename file append nondir_replacement
-# perform func_basename and func_dirname in a single function
-# call:
-#   dirname:  Compute the dirname of FILE.  If nonempty,
-#             add APPEND to the result, otherwise set result
-#             to NONDIR_REPLACEMENT.
-#             value returned in "$func_dirname_result"
-#   basename: Compute filename of FILE.
-#             value retuned in "$func_basename_result"
-# Implementation must be kept synchronized with func_dirname
-# and func_basename. For efficiency, we do not delegate to
-# those functions but instead duplicate the functionality here.
-func_dirname_and_basename ()
-{
-  case ${1} in
-    */*) func_dirname_result="${1%/*}${2}" ;;
-    *  ) func_dirname_result="${3}" ;;
-  esac
-  func_basename_result="${1##*/}"
-}
-
-# func_stripname prefix suffix name
-# strip PREFIX and SUFFIX off of NAME.
-# PREFIX and SUFFIX must not contain globbing or regex special
-# characters, hashes, percent signs, but SUFFIX may contain a leading
-# dot (in which case that matches only a dot).
-func_stripname ()
-{
-  # pdksh 5.2.14 does not do ${X%$Y} correctly if both X and Y are
-  # positional parameters, so assign one to ordinary parameter first.
-  func_stripname_result=${3}
-  func_stripname_result=${func_stripname_result#"${1}"}
-  func_stripname_result=${func_stripname_result%"${2}"}
-}
-
-# func_opt_split
-func_opt_split ()
-{
-  func_opt_split_opt=${1%%=*}
-  func_opt_split_arg=${1#*=}
-}
-
-# func_lo2o object
-func_lo2o ()
-{
-  case ${1} in
-    *.lo) func_lo2o_result=${1%.lo}.${objext} ;;
-    *)    func_lo2o_result=${1} ;;
-  esac
-}
-
-# func_xform libobj-or-source
-func_xform ()
-{
-  func_xform_result=${1%.*}.lo
-}
-
-# func_arith arithmetic-term...
-func_arith ()
-{
-  func_arith_result=$(( $* ))
-}
-
-# func_len string
-# STRING may not start with a hyphen.
-func_len ()
-{
-  func_len_result=${#1}
-}
-
-_LT_EOF
-    ;;
-  *) # Bourne compatible functions.
-    cat << \_LT_EOF >> "$cfgfile"
-
-# func_dirname file append nondir_replacement
-# Compute the dirname of FILE.  If nonempty, add APPEND to the result,
-# otherwise set result to NONDIR_REPLACEMENT.
-func_dirname ()
-{
-  # Extract subdirectory from the argument.
-  func_dirname_result=`$ECHO "X${1}" | $Xsed -e "$dirname"`
-  if test "X$func_dirname_result" = "X${1}"; then
-    func_dirname_result="${3}"
-  else
-    func_dirname_result="$func_dirname_result${2}"
-  fi
-}
-
-# func_basename file
-func_basename ()
-{
-  func_basename_result=`$ECHO "X${1}" | $Xsed -e "$basename"`
-}
-
-
-# func_stripname prefix suffix name
-# strip PREFIX and SUFFIX off of NAME.
-# PREFIX and SUFFIX must not contain globbing or regex special
-# characters, hashes, percent signs, but SUFFIX may contain a leading
-# dot (in which case that matches only a dot).
-# func_strip_suffix prefix name
-func_stripname ()
-{
-  case ${2} in
-    .*) func_stripname_result=`$ECHO "X${3}" \
-           | $Xsed -e "s%^${1}%%" -e "s%\\\\${2}\$%%"`;;
-    *)  func_stripname_result=`$ECHO "X${3}" \
-           | $Xsed -e "s%^${1}%%" -e "s%${2}\$%%"`;;
-  esac
-}
-
-# sed scripts:
-my_sed_long_opt='1s/^\(-[^=]*\)=.*/\1/;q'
-my_sed_long_arg='1s/^-[^=]*=//'
-
-# func_opt_split
-func_opt_split ()
-{
-  func_opt_split_opt=`$ECHO "X${1}" | $Xsed -e "$my_sed_long_opt"`
-  func_opt_split_arg=`$ECHO "X${1}" | $Xsed -e "$my_sed_long_arg"`
-}
-
-# func_lo2o object
-func_lo2o ()
-{
-  func_lo2o_result=`$ECHO "X${1}" | $Xsed -e "$lo2o"`
-}
-
-# func_xform libobj-or-source
-func_xform ()
-{
-  func_xform_result=`$ECHO "X${1}" | $Xsed -e 's/\.[^.]*$/.lo/'`
-}
-
-# func_arith arithmetic-term...
-func_arith ()
-{
-  func_arith_result=`expr "$@"`
-}
-
-# func_len string
-# STRING may not start with a hyphen.
-func_len ()
-{
-  func_len_result=`expr "$1" : ".*" 2>/dev/null || echo $max_cmd_len`
-}
-
-_LT_EOF
-esac
-
-case $lt_shell_append in
-  yes)
-    cat << \_LT_EOF >> "$cfgfile"
-
-# func_append var value
-# Append VALUE to the end of shell variable VAR.
-func_append ()
-{
-  eval "$1+=\$2"
-}
-_LT_EOF
-    ;;
-  *)
-    cat << \_LT_EOF >> "$cfgfile"
-
-# func_append var value
-# Append VALUE to the end of shell variable VAR.
-func_append ()
-{
-  eval "$1=\$$1\$2"
-}
-
-_LT_EOF
-    ;;
-  esac
+  sed '$q' "$ltmain" >> "$cfgfile" \
+     || (rm -f "$cfgfile"; exit 1)
 
+  if test x"$xsi_shell" = xyes; then
+  sed -e '/^func_dirname ()$/,/^} # func_dirname /c\
+func_dirname ()\
+{\
+\    case ${1} in\
+\      */*) func_dirname_result="${1%/*}${2}" ;;\
+\      *  ) func_dirname_result="${3}" ;;\
+\    esac\
+} # Extended-shell func_dirname implementation' "$cfgfile" > $cfgfile.tmp \
+  && mv -f "$cfgfile.tmp" "$cfgfile" \
+    || (rm -f "$cfgfile" && cp "$cfgfile.tmp" "$cfgfile" && rm -f "$cfgfile.tmp")
+test 0 -eq $? || _lt_function_replace_fail=:
+
+
+  sed -e '/^func_basename ()$/,/^} # func_basename /c\
+func_basename ()\
+{\
+\    func_basename_result="${1##*/}"\
+} # Extended-shell func_basename implementation' "$cfgfile" > $cfgfile.tmp \
+  && mv -f "$cfgfile.tmp" "$cfgfile" \
+    || (rm -f "$cfgfile" && cp "$cfgfile.tmp" "$cfgfile" && rm -f "$cfgfile.tmp")
+test 0 -eq $? || _lt_function_replace_fail=:
+
+
+  sed -e '/^func_dirname_and_basename ()$/,/^} # func_dirname_and_basename /c\
+func_dirname_and_basename ()\
+{\
+\    case ${1} in\
+\      */*) func_dirname_result="${1%/*}${2}" ;;\
+\      *  ) func_dirname_result="${3}" ;;\
+\    esac\
+\    func_basename_result="${1##*/}"\
+} # Extended-shell func_dirname_and_basename implementation' "$cfgfile" > $cfgfile.tmp \
+  && mv -f "$cfgfile.tmp" "$cfgfile" \
+    || (rm -f "$cfgfile" && cp "$cfgfile.tmp" "$cfgfile" && rm -f "$cfgfile.tmp")
+test 0 -eq $? || _lt_function_replace_fail=:
+
+
+  sed -e '/^func_stripname ()$/,/^} # func_stripname /c\
+func_stripname ()\
+{\
+\    # pdksh 5.2.14 does not do ${X%$Y} correctly if both X and Y are\
+\    # positional parameters, so assign one to ordinary parameter first.\
+\    func_stripname_result=${3}\
+\    func_stripname_result=${func_stripname_result#"${1}"}\
+\    func_stripname_result=${func_stripname_result%"${2}"}\
+} # Extended-shell func_stripname implementation' "$cfgfile" > $cfgfile.tmp \
+  && mv -f "$cfgfile.tmp" "$cfgfile" \
+    || (rm -f "$cfgfile" && cp "$cfgfile.tmp" "$cfgfile" && rm -f "$cfgfile.tmp")
+test 0 -eq $? || _lt_function_replace_fail=:
+
+
+  sed -e '/^func_split_long_opt ()$/,/^} # func_split_long_opt /c\
+func_split_long_opt ()\
+{\
+\    func_split_long_opt_name=${1%%=*}\
+\    func_split_long_opt_arg=${1#*=}\
+} # Extended-shell func_split_long_opt implementation' "$cfgfile" > $cfgfile.tmp \
+  && mv -f "$cfgfile.tmp" "$cfgfile" \
+    || (rm -f "$cfgfile" && cp "$cfgfile.tmp" "$cfgfile" && rm -f "$cfgfile.tmp")
+test 0 -eq $? || _lt_function_replace_fail=:
+
+
+  sed -e '/^func_split_short_opt ()$/,/^} # func_split_short_opt /c\
+func_split_short_opt ()\
+{\
+\    func_split_short_opt_arg=${1#??}\
+\    func_split_short_opt_name=${1%"$func_split_short_opt_arg"}\
+} # Extended-shell func_split_short_opt implementation' "$cfgfile" > $cfgfile.tmp \
+  && mv -f "$cfgfile.tmp" "$cfgfile" \
+    || (rm -f "$cfgfile" && cp "$cfgfile.tmp" "$cfgfile" && rm -f "$cfgfile.tmp")
+test 0 -eq $? || _lt_function_replace_fail=:
+
+
+  sed -e '/^func_lo2o ()$/,/^} # func_lo2o /c\
+func_lo2o ()\
+{\
+\    case ${1} in\
+\      *.lo) func_lo2o_result=${1%.lo}.${objext} ;;\
+\      *)    func_lo2o_result=${1} ;;\
+\    esac\
+} # Extended-shell func_lo2o implementation' "$cfgfile" > $cfgfile.tmp \
+  && mv -f "$cfgfile.tmp" "$cfgfile" \
+    || (rm -f "$cfgfile" && cp "$cfgfile.tmp" "$cfgfile" && rm -f "$cfgfile.tmp")
+test 0 -eq $? || _lt_function_replace_fail=:
+
+
+  sed -e '/^func_xform ()$/,/^} # func_xform /c\
+func_xform ()\
+{\
+    func_xform_result=${1%.*}.lo\
+} # Extended-shell func_xform implementation' "$cfgfile" > $cfgfile.tmp \
+  && mv -f "$cfgfile.tmp" "$cfgfile" \
+    || (rm -f "$cfgfile" && cp "$cfgfile.tmp" "$cfgfile" && rm -f "$cfgfile.tmp")
+test 0 -eq $? || _lt_function_replace_fail=:
+
+
+  sed -e '/^func_arith ()$/,/^} # func_arith /c\
+func_arith ()\
+{\
+    func_arith_result=$(( $* ))\
+} # Extended-shell func_arith implementation' "$cfgfile" > $cfgfile.tmp \
+  && mv -f "$cfgfile.tmp" "$cfgfile" \
+    || (rm -f "$cfgfile" && cp "$cfgfile.tmp" "$cfgfile" && rm -f "$cfgfile.tmp")
+test 0 -eq $? || _lt_function_replace_fail=:
+
+
+  sed -e '/^func_len ()$/,/^} # func_len /c\
+func_len ()\
+{\
+    func_len_result=${#1}\
+} # Extended-shell func_len implementation' "$cfgfile" > $cfgfile.tmp \
+  && mv -f "$cfgfile.tmp" "$cfgfile" \
+    || (rm -f "$cfgfile" && cp "$cfgfile.tmp" "$cfgfile" && rm -f "$cfgfile.tmp")
+test 0 -eq $? || _lt_function_replace_fail=:
+
+fi
+
+if test x"$lt_shell_append" = xyes; then
+  sed -e '/^func_append ()$/,/^} # func_append /c\
+func_append ()\
+{\
+    eval "${1}+=\\${2}"\
+} # Extended-shell func_append implementation' "$cfgfile" > $cfgfile.tmp \
+  && mv -f "$cfgfile.tmp" "$cfgfile" \
+    || (rm -f "$cfgfile" && cp "$cfgfile.tmp" "$cfgfile" && rm -f "$cfgfile.tmp")
+test 0 -eq $? || _lt_function_replace_fail=:
+
+
+  sed -e '/^func_append_quoted ()$/,/^} # func_append_quoted /c\
+func_append_quoted ()\
+{\
+\    func_quote_for_eval "${2}"\
+\    eval "${1}+=\\\\ \\$func_quote_for_eval_result"\
+} # Extended-shell func_append_quoted implementation' "$cfgfile" > $cfgfile.tmp \
+  && mv -f "$cfgfile.tmp" "$cfgfile" \
+    || (rm -f "$cfgfile" && cp "$cfgfile.tmp" "$cfgfile" && rm -f "$cfgfile.tmp")
+test 0 -eq $? || _lt_function_replace_fail=:
+
+
+  # Save a `func_append' function call where possible by direct use of '+='
+  sed -e 's%func_append \([a-zA-Z_]\{1,\}\) "%\1+="%g' $cfgfile > $cfgfile.tmp \
+    && mv -f "$cfgfile.tmp" "$cfgfile" \
+      || (rm -f "$cfgfile" && cp "$cfgfile.tmp" "$cfgfile" && rm -f "$cfgfile.tmp")
+  test 0 -eq $? || _lt_function_replace_fail=:
+else
+  # Save a `func_append' function call even when '+=' is not available
+  sed -e 's%func_append \([a-zA-Z_]\{1,\}\) "%\1="$\1%g' $cfgfile > $cfgfile.tmp \
+    && mv -f "$cfgfile.tmp" "$cfgfile" \
+      || (rm -f "$cfgfile" && cp "$cfgfile.tmp" "$cfgfile" && rm -f "$cfgfile.tmp")
+  test 0 -eq $? || _lt_function_replace_fail=:
+fi
+
+if test x"$_lt_function_replace_fail" = x":"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: Unable to substitute extended shell functions in $ofile" >&5
+$as_echo "$as_me: WARNING: Unable to substitute extended shell functions in $ofile" >&2;}
+fi
 
-  sed -n '/^# Generated shell functions inserted here/,$p' "$ltmain" >> "$cfgfile" \
-    || (rm -f "$cfgfile"; exit 1)
 
-  mv -f "$cfgfile" "$ofile" ||
+   mv -f "$cfgfile" "$ofile" ||
     (rm -f "$ofile" && cp "$cfgfile" "$ofile" && rm -f "$cfgfile")
   chmod +x "$ofile"
 
@@ -18454,15 +16914,12 @@ _LT_EOF
 done # for ac_tag
 
 
-{ (exit 0); exit 0; }
+as_fn_exit 0
 _ACEOF
-chmod +x $CONFIG_STATUS
 ac_clean_files=$ac_clean_files_save
 
 test $ac_write_fail = 0 ||
-  { { $as_echo "$as_me:$LINENO: error: write failure creating $CONFIG_STATUS" >&5
-$as_echo "$as_me: error: write failure creating $CONFIG_STATUS" >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "write failure creating $CONFIG_STATUS" "$LINENO" 5
 
 
 # configure is writing to config.log, and then calls config.status.
@@ -18483,10 +16940,10 @@ if test "$no_create" != yes; then
   exec 5>>config.log
   # Use ||, not &&, to avoid exiting from the if with $? = 1, which
   # would make configure fail if this is the last instruction.
-  $ac_cs_success || { (exit 1); exit 1; }
+  $ac_cs_success || as_fn_exit 1
 fi
 if test -n "$ac_unrecognized_opts" && test "$enable_option_checking" != no; then
-  { $as_echo "$as_me:$LINENO: WARNING: unrecognized options: $ac_unrecognized_opts" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: unrecognized options: $ac_unrecognized_opts" >&5
 $as_echo "$as_me: WARNING: unrecognized options: $ac_unrecognized_opts" >&2;}
 fi
 
diff -urpN xfsprogs-4.9.0/configure.ac xfsprogs-4.14.0/configure.ac
--- xfsprogs-4.9.0/configure.ac	2017-01-05 23:27:21.000000000 +0100
+++ xfsprogs-4.14.0/configure.ac	2017-11-27 17:57:55.000000000 +0100
@@ -1,4 +1,4 @@
-AC_INIT([xfsprogs], [4.9.0], [linux-xfs@vger.kernel.org])
+AC_INIT([xfsprogs], [4.14.0], [linux-xfs@vger.kernel.org])
 AC_PREREQ(2.50)
 AC_CONFIG_AUX_DIR([.])
 AC_CONFIG_MACRO_DIR([m4])
@@ -6,14 +6,25 @@ AC_CONFIG_SRCDIR([include/libxfs.h])
 AC_CONFIG_HEADER(include/platform_defs.h)
 AC_PREFIX_DEFAULT(/usr)
 
+AC_PROG_INSTALL
 AC_PROG_LIBTOOL
 
 AC_PROG_CC
-if test $cross_compiling = no; then
-  BUILD_CC="$CC"
-  AC_SUBST(BUILD_CC)
-else
-  AC_CHECK_PROGS(BUILD_CC, gcc cc)
+AC_ARG_VAR(BUILD_CC, [C compiler for build tools])
+if test "${BUILD_CC+set}" != "set"; then
+  if test $cross_compiling = no; then
+    BUILD_CC="$CC"
+  else
+    AC_CHECK_PROGS(BUILD_CC, gcc cc)
+  fi
+fi
+AC_ARG_VAR(BUILD_CFLAGS, [C compiler flags for build tools])
+if test "${BUILD_CFLAGS+set}" != "set"; then
+  if test $cross_compiling = no; then
+    BUILD_CFLAGS="$CFLAGS"
+  else
+    BUILD_CFLAGS="-g -O2"
+  fi
 fi
 
 AC_ARG_ENABLE(shared,
@@ -61,6 +72,24 @@ AC_ARG_ENABLE(librt,
 	enable_librt=yes)
 AC_SUBST(enable_librt)
 
+# Enable UBSAN; set enable_ubsan=probe below to enable autoprobe.
+AC_ARG_ENABLE(ubsan,
+[ --enable-ubsan=[yes/no] Enable Undefined Behavior Sanitizer (UBSAN) [default=no]],,
+	enable_ubsan=no)
+AC_SUBST(enable_ubsan)
+
+# Enable ADDRSAN; set enable_addrsan=probe below to enable autoprobe.
+AC_ARG_ENABLE(addrsan,
+[ --enable-addrsan=[yes/no] Enable Address Sanitizer (ADDRSAN) [default=no]],,
+	enable_addrsan=no)
+AC_SUBST(enable_addrsan)
+
+# Enable THREADSAN; set enable_threadsan=probe to enable autoprobe.
+AC_ARG_ENABLE(threadsan,
+[ --enable-threadsan=[yes/no] Enable Thread Sanitizer (THREADSAN) [default=no]],,
+	enable_threadsan=no)
+AC_SUBST(enable_threadsan)
+
 #
 # If the user specified a libdir ending in lib64 do not append another
 # 64 to the library names.
@@ -121,20 +150,49 @@ AC_HAVE_GETMNTENT
 AC_HAVE_GETMNTINFO
 AC_HAVE_FALLOCATE
 AC_HAVE_FIEMAP
+AC_HAVE_PWRITEV2
 AC_HAVE_PREADV
 AC_HAVE_COPY_FILE_RANGE
 AC_HAVE_SYNC_FILE_RANGE
+AC_HAVE_SYNCFS
 AC_HAVE_MNTENT
 AC_HAVE_FLS
 AC_HAVE_READDIR
 AC_HAVE_FSETXATTR
 AC_HAVE_MREMAP
 AC_NEED_INTERNAL_FSXATTR
+AC_HAVE_GETFSMAP
+AC_HAVE_STATFS_FLAGS
 
 if test "$enable_blkid" = yes; then
 AC_HAVE_BLKID_TOPO
 fi
 
+if test "$enable_ubsan" = "yes" || test "$enable_ubsan" = "probe"; then
+        AC_PACKAGE_CHECK_UBSAN
+fi
+if test "$enable_ubsan" = "yes" && test "$have_ubsan" != "yes"; then
+        AC_MSG_ERROR([UBSAN not supported by compiler.])
+fi
+
+if test "$enable_addrsan" = "yes" || test "$enable_addrsan" = "probe"; then
+        AC_PACKAGE_CHECK_ADDRSAN
+fi
+if test "$enable_addrsan" = "yes" && test "$have_addrsan" != "yes"; then
+        AC_MSG_ERROR([ADDRSAN not supported by compiler.])
+fi
+
+if test "$enable_threadsan" = "yes" || test "$enable_threadsan" = "probe"; then
+        AC_PACKAGE_CHECK_THREADSAN
+fi
+if test "$enable_threadsan" = "yes" && test "$have_threadsan" != "yes"; then
+        AC_MSG_ERROR([THREADSAN not supported by compiler.])
+fi
+
+if test "$have_threadsan" = "yes" && test "$have_addrsan" = "yes"; then
+        AC_MSG_WARN([ADDRSAN and THREADSAN are not known to work together.])
+fi
+
 AC_CHECK_SIZEOF([long])
 AC_CHECK_SIZEOF([char *])
 AC_TYPE_UMODE_T
diff -urpN xfsprogs-4.9.0/copy/xfs_copy.c xfsprogs-4.14.0/copy/xfs_copy.c
--- xfsprogs-4.9.0/copy/xfs_copy.c	2016-12-21 06:36:07.000000000 +0100
+++ xfsprogs-4.14.0/copy/xfs_copy.c	2017-11-27 17:57:55.000000000 +0100
@@ -43,7 +43,7 @@ unsigned int	source_sectorsize;	/* sourc
 
 xfs_agblock_t	first_agbno;
 
-__uint64_t	barcount[11];
+uint64_t	barcount[11];
 
 unsigned int	num_targets;
 target_control	*target;
@@ -313,7 +313,7 @@ usage(void)
 }
 
 void
-init_bar(__uint64_t source_blocks)
+init_bar(uint64_t source_blocks)
 {
 	int	i;
 
@@ -322,7 +322,7 @@ init_bar(__uint64_t source_blocks)
 }
 
 int
-bump_bar(int tenths, __uint64_t numblocks)
+bump_bar(int tenths, uint64_t numblocks)
 {
 	static char *bar[11] = {
 		" 0% ",
@@ -476,6 +476,7 @@ void
 write_wbuf(void)
 {
 	int		i;
+	int		badness = 0;
 
 	/* verify target threads */
 	for (i = 0; i < num_targets; i++)
@@ -486,6 +487,17 @@ write_wbuf(void)
 	for (i = 0; i < num_targets; i++)
 		if (target[i].state != INACTIVE)
 			pthread_mutex_unlock(&targ[i].wait);	/* wake up */
+		else
+			badness++;
+
+	/*
+	 * If all the targets are inactive then there won't be any io
+	 * threads left to release mainwait.  We're screwed, so bail out.
+	 */
+	if (badness == num_targets) {
+		check_errors();
+		exit(1);
+	}
 
 	signal_maskfunc(SIGCHLD, SIG_UNBLOCK);
 	pthread_mutex_lock(&mainwait);
@@ -534,8 +546,8 @@ main(int argc, char **argv)
 	xfs_off_t	pos;
 	size_t		length;
 	int		c;
-	__uint64_t	size, sizeb;
-	__uint64_t	numblocks = 0;
+	uint64_t	size, sizeb;
+	uint64_t	numblocks = 0;
 	int		wblocks = 0;
 	int		num_threads = 0;
 	struct dioattr	d;
@@ -951,8 +963,8 @@ main(int argc, char **argv)
 	num_ags = mp->m_sb.sb_agcount;
 
 	init_bar(mp->m_sb.sb_blocksize / BBSIZE
-			* ((__uint64_t)mp->m_sb.sb_dblocks
-			    - (__uint64_t)mp->m_sb.sb_fdblocks + 10 * num_ags));
+			* ((uint64_t)mp->m_sb.sb_dblocks
+			    - (uint64_t)mp->m_sb.sb_fdblocks + 10 * num_ags));
 
 	kids = num_targets;
 
diff -urpN xfsprogs-4.9.0/copy/xfs_copy.h xfsprogs-4.14.0/copy/xfs_copy.h
--- xfsprogs-4.9.0/copy/xfs_copy.h	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/copy/xfs_copy.h	2017-11-20 01:14:14.000000000 +0100
@@ -76,7 +76,7 @@ typedef struct {
 
 typedef int thread_id;
 typedef int tm_index;			/* index into thread mask array */
-typedef __uint32_t thread_mask;		/* a thread mask */
+typedef uint32_t thread_mask;		/* a thread mask */
 
 typedef struct {
 	char		*name;
diff -urpN xfsprogs-4.9.0/db/Makefile xfsprogs-4.14.0/db/Makefile
--- xfsprogs-4.9.0/db/Makefile	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/db/Makefile	2017-11-20 01:14:14.000000000 +0100
@@ -12,8 +12,9 @@ HFILES = addr.h agf.h agfl.h agi.h attr.
 	dir2.h dir2sf.h dquot.h echo.h faddr.h field.h \
 	flist.h fprint.h frag.h freesp.h hash.h help.h init.h inode.h input.h \
 	io.h logformat.h malloc.h metadump.h output.h print.h quit.h sb.h \
-	 sig.h strvec.h text.h type.h write.h attrset.h symlink.h fsmap.h
-CFILES = $(HFILES:.h=.c)
+	sig.h strvec.h text.h type.h write.h attrset.h symlink.h fsmap.h \
+	fuzz.h
+CFILES = $(HFILES:.h=.c) btdump.c
 LSRCFILES = xfs_admin.sh xfs_ncheck.sh xfs_metadump.sh
 
 LLDLIBS	= $(LIBXFS) $(LIBXLOG) $(LIBUUID) $(LIBRT) $(LIBPTHREAD)
diff -urpN xfsprogs-4.9.0/db/agi.c xfsprogs-4.14.0/db/agi.c
--- xfsprogs-4.9.0/db/agi.c	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/db/agi.c	2017-11-20 01:14:14.000000000 +0100
@@ -57,7 +57,7 @@ const field_t	agi_flds[] = {
 	{ "uuid", FLDT_UUID, OI(OFF(uuid)), C1, 0, TYP_NONE },
 	{ "lsn", FLDT_UINT64X, OI(OFF(lsn)), C1, 0, TYP_NONE },
 	{ "crc", FLDT_CRC, OI(OFF(crc)), C1, 0, TYP_NONE },
-	{ "free_root", FLDT_AGBLOCK, OI(OFF(free_root)), C1, 0, TYP_INOBT },
+	{ "free_root", FLDT_AGBLOCK, OI(OFF(free_root)), C1, 0, TYP_FINOBT },
 	{ "free_level", FLDT_UINT32D, OI(OFF(free_level)), C1, 0, TYP_NONE },
 	{ NULL }
 };
diff -urpN xfsprogs-4.9.0/db/attr.c xfsprogs-4.14.0/db/attr.c
--- xfsprogs-4.9.0/db/attr.c	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/db/attr.c	2017-11-20 01:14:14.000000000 +0100
@@ -41,6 +41,10 @@ static int	attr_leaf_nvlist_offset(void
 static int	attr_node_btree_count(void *obj, int startoff);
 static int	attr_node_hdr_count(void *obj, int startoff);
 
+static int	attr_remote_data_count(void *obj, int startoff);
+static int	attr3_remote_hdr_count(void *obj, int startoff);
+static int	attr3_remote_data_count(void *obj, int startoff);
+
 const field_t	attr_hfld[] = {
 	{ "", FLDT_ATTR, OI(0), C1, 0, TYP_NONE },
 	{ NULL }
@@ -53,6 +57,8 @@ const field_t	attr_flds[] = {
 	  FLD_COUNT, TYP_NONE },
 	{ "hdr", FLDT_ATTR_NODE_HDR, OI(NOFF(hdr)), attr_node_hdr_count,
 	  FLD_COUNT, TYP_NONE },
+	{ "data", FLDT_CHARNS, OI(0), attr_remote_data_count, FLD_COUNT,
+	  TYP_NONE },
 	{ "entries", FLDT_ATTR_LEAF_ENTRY, OI(LOFF(entries)),
 	  attr_leaf_entries_count, FLD_ARRAY|FLD_COUNT, TYP_NONE },
 	{ "btree", FLDT_ATTR_NODE_ENTRY, OI(NOFF(__btree)), attr_node_btree_count,
@@ -77,16 +83,16 @@ const field_t	attr_leaf_entry_flds[] = {
 	{ "nameidx", FLDT_UINT16D, OI(LEOFF(nameidx)), C1, 0, TYP_NONE },
 	{ "flags", FLDT_UINT8X, OI(LEOFF(flags)), C1, FLD_SKIPALL, TYP_NONE },
 	{ "incomplete", FLDT_UINT1,
-	  OI(LEOFF(flags) + bitsz(__uint8_t) - XFS_ATTR_INCOMPLETE_BIT - 1), C1,
+	  OI(LEOFF(flags) + bitsz(uint8_t) - XFS_ATTR_INCOMPLETE_BIT - 1), C1,
 	  0, TYP_NONE },
 	{ "root", FLDT_UINT1,
-	  OI(LEOFF(flags) + bitsz(__uint8_t) - XFS_ATTR_ROOT_BIT - 1), C1, 0,
+	  OI(LEOFF(flags) + bitsz(uint8_t) - XFS_ATTR_ROOT_BIT - 1), C1, 0,
 	  TYP_NONE },
 	{ "secure", FLDT_UINT1,
-	  OI(LEOFF(flags) + bitsz(__uint8_t) - XFS_ATTR_SECURE_BIT - 1), C1, 0,
+	  OI(LEOFF(flags) + bitsz(uint8_t) - XFS_ATTR_SECURE_BIT - 1), C1, 0,
 	  TYP_NONE },
 	{ "local", FLDT_UINT1,
-	  OI(LEOFF(flags) + bitsz(__uint8_t) - XFS_ATTR_LOCAL_BIT - 1), C1, 0,
+	  OI(LEOFF(flags) + bitsz(uint8_t) - XFS_ATTR_LOCAL_BIT - 1), C1, 0,
 	  TYP_NONE },
 	{ "pad2", FLDT_UINT8X, OI(LEOFF(pad2)), C1, FLD_SKIPALL, TYP_NONE },
 	{ NULL }
@@ -197,6 +203,35 @@ attr3_leaf_hdr_count(
 	return be16_to_cpu(leaf->hdr.info.hdr.magic) == XFS_ATTR3_LEAF_MAGIC;
 }
 
+static int
+attr_remote_data_count(
+	void				*obj,
+	int				startoff)
+{
+	if (attr_leaf_hdr_count(obj, startoff) == 0 &&
+	    attr_node_hdr_count(obj, startoff) == 0)
+		return mp->m_sb.sb_blocksize;
+	return 0;
+}
+
+static int
+attr3_remote_data_count(
+	void				*obj,
+	int				startoff)
+{
+	struct xfs_attr3_rmt_hdr	*hdr = obj;
+	size_t				buf_space;
+
+	ASSERT(startoff == 0);
+
+	if (hdr->rm_magic != cpu_to_be32(XFS_ATTR3_RMT_MAGIC))
+		return 0;
+	buf_space = XFS_ATTR3_RMT_BUF_SPACE(mp, mp->m_sb.sb_blocksize);
+	if (be32_to_cpu(hdr->rm_bytes) > buf_space)
+		return buf_space;
+	return be32_to_cpu(hdr->rm_bytes);
+}
+
 typedef int (*attr_leaf_entry_walk_f)(struct xfs_attr_leafblock *,
 				      struct xfs_attr_leaf_entry *, int);
 static int
@@ -477,6 +512,17 @@ attr3_node_hdr_count(
 	return be16_to_cpu(node->hdr.info.hdr.magic) == XFS_DA3_NODE_MAGIC;
 }
 
+static int
+attr3_remote_hdr_count(
+	void			*obj,
+	int			startoff)
+{
+	struct xfs_attr3_rmt_hdr	*node = obj;
+
+	ASSERT(startoff == 0);
+	return be32_to_cpu(node->rm_magic) == XFS_ATTR3_RMT_MAGIC;
+}
+
 int
 attr_size(
 	void	*obj,
@@ -499,8 +545,12 @@ const field_t	attr3_hfld[] = {
 const field_t	attr3_flds[] = {
 	{ "hdr", FLDT_ATTR3_LEAF_HDR, OI(L3OFF(hdr)), attr3_leaf_hdr_count,
 	  FLD_COUNT, TYP_NONE },
-	{ "hdr", FLDT_DA3_NODE_HDR, OI(N3OFF(hdr)), attr3_node_hdr_count,
+	{ "hdr", FLDT_ATTR3_NODE_HDR, OI(N3OFF(hdr)), attr3_node_hdr_count,
 	  FLD_COUNT, TYP_NONE },
+	{ "hdr", FLDT_ATTR3_REMOTE_HDR, OI(0), attr3_remote_hdr_count,
+	  FLD_COUNT, TYP_NONE },
+	{ "data", FLDT_CHARNS, OI(bitize(sizeof(struct xfs_attr3_rmt_hdr))),
+	  attr3_remote_data_count, FLD_COUNT, TYP_NONE },
 	{ "entries", FLDT_ATTR_LEAF_ENTRY, OI(L3OFF(entries)),
 	  attr3_leaf_entries_count, FLD_ARRAY|FLD_COUNT, TYP_NONE },
 	{ "btree", FLDT_ATTR_NODE_ENTRY, OI(N3OFF(__btree)),
@@ -512,7 +562,7 @@ const field_t	attr3_flds[] = {
 
 #define	LH3OFF(f)	bitize(offsetof(struct xfs_attr3_leaf_hdr, f))
 const field_t	attr3_leaf_hdr_flds[] = {
-	{ "info", FLDT_DA3_BLKINFO, OI(LH3OFF(info)), C1, 0, TYP_NONE },
+	{ "info", FLDT_ATTR3_BLKINFO, OI(LH3OFF(info)), C1, 0, TYP_NONE },
 	{ "count", FLDT_UINT16D, OI(LH3OFF(count)), C1, 0, TYP_NONE },
 	{ "usedbytes", FLDT_UINT16D, OI(LH3OFF(usedbytes)), C1, 0, TYP_NONE },
 	{ "firstused", FLDT_UINT16D, OI(LH3OFF(firstused)), C1, 0, TYP_NONE },
@@ -523,6 +573,71 @@ const field_t	attr3_leaf_hdr_flds[] = {
 	{ NULL }
 };
 
+#define	B3OFF(f)	bitize(offsetof(struct xfs_da3_blkinfo, f))
+const field_t	attr3_blkinfo_flds[] = {
+	{ "hdr", FLDT_ATTR_BLKINFO, OI(B3OFF(hdr)), C1, 0, TYP_NONE },
+	{ "crc", FLDT_CRC, OI(B3OFF(crc)), C1, 0, TYP_NONE },
+	{ "bno", FLDT_DFSBNO, OI(B3OFF(blkno)), C1, 0, TYP_BMAPBTD },
+	{ "lsn", FLDT_UINT64X, OI(B3OFF(lsn)), C1, 0, TYP_NONE },
+	{ "uuid", FLDT_UUID, OI(B3OFF(uuid)), C1, 0, TYP_NONE },
+	{ "owner", FLDT_INO, OI(B3OFF(owner)), C1, 0, TYP_NONE },
+	{ NULL }
+};
+
+#define	H3OFF(f)	bitize(offsetof(struct xfs_da3_node_hdr, f))
+const field_t	attr3_node_hdr_flds[] = {
+	{ "info", FLDT_ATTR3_BLKINFO, OI(H3OFF(info)), C1, 0, TYP_NONE },
+	{ "count", FLDT_UINT16D, OI(H3OFF(__count)), C1, 0, TYP_NONE },
+	{ "level", FLDT_UINT16D, OI(H3OFF(__level)), C1, 0, TYP_NONE },
+	{ "pad", FLDT_UINT32D, OI(H3OFF(__pad32)), C1, 0, TYP_NONE },
+	{ NULL }
+};
+
+#define	RM3OFF(f)	bitize(offsetof(struct xfs_attr3_rmt_hdr, rm_ ## f))
+const struct field	attr3_remote_crc_flds[] = {
+	{ "magic", FLDT_UINT32X, OI(RM3OFF(magic)), C1, 0, TYP_NONE },
+	{ "offset", FLDT_UINT32D, OI(RM3OFF(offset)), C1, 0, TYP_NONE },
+	{ "bytes", FLDT_UINT32D, OI(RM3OFF(bytes)), C1, 0, TYP_NONE },
+	{ "crc", FLDT_CRC, OI(RM3OFF(crc)), C1, 0, TYP_NONE },
+	{ "uuid", FLDT_UUID, OI(RM3OFF(uuid)), C1, 0, TYP_NONE },
+	{ "owner", FLDT_INO, OI(RM3OFF(owner)), C1, 0, TYP_NONE },
+	{ "bno", FLDT_DFSBNO, OI(RM3OFF(blkno)), C1, 0, TYP_BMAPBTD },
+	{ "lsn", FLDT_UINT64X, OI(RM3OFF(lsn)), C1, 0, TYP_NONE },
+	{ NULL }
+};
+
+/* Set the CRC. */
+void
+xfs_attr3_set_crc(
+	struct xfs_buf		*bp)
+{
+	__be32			magic32;
+	__be16			magic16;
+
+	magic32 = *(__be32 *)bp->b_addr;
+	magic16 = ((struct xfs_da_blkinfo *)bp->b_addr)->magic;
+
+	switch (magic16) {
+	case cpu_to_be16(XFS_ATTR3_LEAF_MAGIC):
+		xfs_buf_update_cksum(bp, XFS_ATTR3_LEAF_CRC_OFF);
+		return;
+	case cpu_to_be16(XFS_DA3_NODE_MAGIC):
+		xfs_buf_update_cksum(bp, XFS_DA3_NODE_CRC_OFF);
+		return;
+	default:
+		break;
+	}
+
+	switch (magic32) {
+	case cpu_to_be32(XFS_ATTR3_RMT_MAGIC):
+		xfs_buf_update_cksum(bp, XFS_ATTR3_RMT_CRC_OFF);
+		return;
+	default:
+		dbprintf(_("Unknown attribute buffer type!\n"));
+		break;
+	}
+}
+
 /*
  * Special read verifier for attribute buffers. Detect the magic number
  * appropriately and set the correct verifier and call it.
diff -urpN xfsprogs-4.9.0/db/attr.h xfsprogs-4.14.0/db/attr.h
--- xfsprogs-4.9.0/db/attr.h	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/db/attr.h	2017-11-20 01:14:14.000000000 +0100
@@ -30,8 +30,12 @@ extern const field_t	attr3_flds[];
 extern const field_t	attr3_hfld[];
 extern const field_t	attr3_leaf_hdr_flds[];
 extern const field_t	attr3_node_hdr_flds[];
+extern const field_t	attr3_blkinfo_flds[];
+extern const field_t	attr3_node_hdr_flds[];
+extern const field_t	attr3_remote_crc_flds[];
 
 extern int	attr_leaf_name_size(void *obj, int startoff, int idx);
 extern int	attr_size(void *obj, int startoff, int idx);
+extern void	xfs_attr3_set_crc(struct xfs_buf *bp);
 
 extern const struct xfs_buf_ops xfs_attr3_db_buf_ops;
diff -urpN xfsprogs-4.9.0/db/attrshort.c xfsprogs-4.14.0/db/attrshort.c
--- xfsprogs-4.9.0/db/attrshort.c	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/db/attrshort.c	2017-11-20 01:14:14.000000000 +0100
@@ -51,10 +51,10 @@ const field_t	attr_sf_entry_flds[] = {
 	{ "valuelen", FLDT_UINT8D, OI(EOFF(valuelen)), C1, 0, TYP_NONE },
 	{ "flags", FLDT_UINT8X, OI(EOFF(flags)), C1, FLD_SKIPALL, TYP_NONE },
 	{ "root", FLDT_UINT1,
-	  OI(EOFF(flags) + bitsz(__uint8_t) - XFS_ATTR_ROOT_BIT - 1), C1, 0,
+	  OI(EOFF(flags) + bitsz(uint8_t) - XFS_ATTR_ROOT_BIT - 1), C1, 0,
 	  TYP_NONE },
 	{ "secure", FLDT_UINT1,
-	  OI(EOFF(flags) + bitsz(__uint8_t) - XFS_ATTR_SECURE_BIT - 1), C1, 0,
+	  OI(EOFF(flags) + bitsz(uint8_t) - XFS_ATTR_SECURE_BIT - 1), C1, 0,
 	  TYP_NONE },
 	{ "name", FLDT_CHARNS, OI(EOFF(nameval)), attr_sf_entry_name_count,
 	  FLD_COUNT, TYP_NONE },
diff -urpN xfsprogs-4.9.0/db/bit.c xfsprogs-4.14.0/db/bit.c
--- xfsprogs-4.9.0/db/bit.c	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/db/bit.c	2017-11-20 01:14:14.000000000 +0100
@@ -19,13 +19,8 @@
 #include "libxfs.h"
 #include "bit.h"
 
-#undef setbit	/* defined in param.h on Linux */
-
-static int	getbit(char *ptr, int bit);
-static void	setbit(char *ptr, int bit, int val);
-
-static int
-getbit(
+int
+getbit_l(
 	char	*ptr,
 	int	bit)
 {
@@ -39,8 +34,8 @@ getbit(
 	return (*ptr & mask) >> shift;
 }
 
-static void
-setbit(
+void
+setbit_l(
 	char *ptr,
 	int  bit,
 	int  val)
@@ -60,7 +55,7 @@ setbit(
 	}
 }
 
-__int64_t
+int64_t
 getbitval(
 	void		*obj,
 	int		bitoff,
@@ -70,7 +65,7 @@ getbitval(
 	int		bit;
 	int		i;
 	char		*p;
-	__int64_t	rval;
+	int64_t		rval;
 	int		signext;
 	int		z1, z2, z3, z4;
 
@@ -106,7 +101,7 @@ getbitval(
 
 
 	for (i = 0, rval = 0LL; i < nbits; i++) {
-		if (getbit(p, bit + i)) {
+		if (getbit_l(p, bit + i)) {
 			/* If the last bit is on and we care about sign
 			 * bits and we don't have a full 64 bit
 			 * container, turn all bits on between the
@@ -162,7 +157,7 @@ setbitval(
 
 	if (bitoff % NBBY || nbits % NBBY) {
 		for (bit = 0; bit < nbits; bit++)
-			setbit(out, bit + bitoff, getbit(in, bit));
+			setbit_l(out, bit + bitoff, getbit_l(in, bit));
 	} else
 		memcpy(out + byteize(bitoff), in, byteize(nbits));
 }
diff -urpN xfsprogs-4.9.0/db/bit.h xfsprogs-4.14.0/db/bit.h
--- xfsprogs-4.9.0/db/bit.h	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/db/bit.h	2017-11-20 01:14:14.000000000 +0100
@@ -21,9 +21,12 @@
 #define	bitszof(x,y)	bitize(szof(x,y))
 #define	byteize(s)	((s) / NBBY)
 #define	bitoffs(s)	((s) % NBBY)
+#define	byteize_up(s)	(((s) + NBBY - 1) / NBBY)
 
 #define	BVUNSIGNED	0
 #define	BVSIGNED	1
 
-extern __int64_t	getbitval(void *obj, int bitoff, int nbits, int flags);
-extern void             setbitval(void *obuf, int bitoff, int nbits, void *ibuf);
+extern int64_t		getbitval(void *obj, int bitoff, int nbits, int flags);
+extern void		setbitval(void *obuf, int bitoff, int nbits, void *ibuf);
+extern int		getbit_l(char *ptr, int bit);
+extern void		setbit_l(char *ptr, int bit, int val);
diff -urpN xfsprogs-4.9.0/db/block.c xfsprogs-4.14.0/db/block.c
--- xfsprogs-4.9.0/db/block.c	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/db/block.c	2017-11-20 01:14:14.000000000 +0100
@@ -98,7 +98,7 @@ ablock_f(
 	}
 	dfsbno = bm.startblock + (bno - bm.startoff);
 	ASSERT(typtab[TYP_ATTR].typnm == TYP_ATTR);
-	set_cur(&typtab[TYP_ATTR], (__int64_t)XFS_FSB_TO_DADDR(mp, dfsbno),
+	set_cur(&typtab[TYP_ATTR], (int64_t)XFS_FSB_TO_DADDR(mp, dfsbno),
 		blkbb, DB_RING_ADD, NULL);
 	return 0;
 }
@@ -128,14 +128,14 @@ daddr_f(
 	int		argc,
 	char		**argv)
 {
-	__int64_t	d;
+	int64_t		d;
 	char		*p;
 
 	if (argc == 1) {
 		dbprintf(_("current daddr is %lld\n"), iocur_top->off >> BBSHIFT);
 		return 0;
 	}
-	d = (__int64_t)strtoull(argv[1], &p, 0);
+	d = (int64_t)strtoull(argv[1], &p, 0);
 	if (*p != '\0' ||
 	    d >= mp->m_sb.sb_dblocks << (mp->m_sb.sb_blocklog - BBSHIFT)) {
 		dbprintf(_("bad daddr %s\n"), argv[1]);
@@ -197,7 +197,7 @@ dblock_f(
 	ASSERT(typtab[type].typnm == type);
 	if (nex > 1)
 		make_bbmap(&bbmap, nex, bmp);
-	set_cur(&typtab[type], (__int64_t)XFS_FSB_TO_DADDR(mp, dfsbno),
+	set_cur(&typtab[type], (int64_t)XFS_FSB_TO_DADDR(mp, dfsbno),
 		nb * blkbb, DB_RING_ADD, nex > 1 ? &bbmap : NULL);
 	free(bmp);
 	return 0;
diff -urpN xfsprogs-4.9.0/db/btblock.c xfsprogs-4.14.0/db/btblock.c
--- xfsprogs-4.9.0/db/btblock.c	2016-12-13 21:07:01.000000000 +0100
+++ xfsprogs-4.14.0/db/btblock.c	2017-11-20 01:14:14.000000000 +0100
@@ -25,6 +25,8 @@
 #include "print.h"
 #include "bit.h"
 #include "init.h"
+#include "io.h"
+#include "output.h"
 
 /*
  * Definition of the possible btree block layouts.
@@ -113,22 +115,60 @@ struct xfs_db_btree {
 };
 
 /*
- * Find the right block defintion for a given ondisk block.
- *
- * We use the least significant bit of the magic number as index into
- * the array of block defintions.
+ * Find the right block definition for a given ondisk block.
  */
 static struct xfs_db_btree *
 block_to_bt(
 	struct xfs_btree_block	*bb)
 {
-	struct xfs_db_btree *btp = &btrees[0];
+	struct xfs_db_btree	*btp;
+	uint32_t		magic;
+	bool			crc;
+
+	magic = be32_to_cpu((bb)->bb_magic);
+	for (btp = &btrees[0]; btp->magic != 0; btp++) {
+		if (magic == btp->magic)
+			return btp;
+	}
+
+	/* Magic is invalid/unknown.  Guess based on iocur type */
+	crc = xfs_sb_version_hascrc(&mp->m_sb);
+	switch (iocur_top->typ->typnm) {
+	case TYP_BMAPBTA:
+	case TYP_BMAPBTD:
+		magic = crc ? XFS_BMAP_CRC_MAGIC : XFS_BMAP_MAGIC;
+		break;
+	case TYP_BNOBT:
+		magic = crc ? XFS_ABTB_CRC_MAGIC : XFS_ABTB_MAGIC;
+		break;
+	case TYP_CNTBT:
+		magic = crc ? XFS_ABTC_CRC_MAGIC : XFS_ABTC_MAGIC;
+		break;
+	case TYP_INOBT:
+		magic = crc ? XFS_IBT_CRC_MAGIC : XFS_IBT_MAGIC;
+		break;
+	case TYP_FINOBT:
+		magic = crc ? XFS_FIBT_CRC_MAGIC : XFS_FIBT_MAGIC;
+		break;
+	case TYP_RMAPBT:
+		magic = crc ? XFS_RMAP_CRC_MAGIC : 0;
+		break;
+	case TYP_REFCBT:
+		magic = crc ? XFS_REFC_CRC_MAGIC : 0;
+		break;
+	default:
+		ASSERT(0);
+	}
+
+	ASSERT(magic);
+	dbprintf(_("Bad btree magic 0x%x; coercing to %s.\n"),
+		be32_to_cpu((bb)->bb_magic),
+		iocur_top->typ->name);
 
-	do {
-		if (be32_to_cpu((bb)->bb_magic) == btp->magic)
+	for (btp = &btrees[0]; btp->magic != 0; btp++) {
+		if (magic == btp->magic)
 			return btp;
-		btp++;
-	} while (btp->magic != 0);
+	}
 
 	return NULL;
 }
diff -urpN xfsprogs-4.9.0/db/btdump.c xfsprogs-4.14.0/db/btdump.c
--- xfsprogs-4.9.0/db/btdump.c	1970-01-01 01:00:00.000000000 +0100
+++ xfsprogs-4.14.0/db/btdump.c	2017-11-20 01:14:14.000000000 +0100
@@ -0,0 +1,527 @@
+/*
+ * Copyright (C) 2017 Oracle.  All Rights Reserved.
+ *
+ * Author: Darrick J. Wong <darrick.wong@oracle.com>
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *
+ * This program is distributed in the hope that it would be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write the Free Software Foundation,
+ * Inc.,  51 Franklin St, Fifth Floor, Boston, MA  02110-1301, USA.
+ */
+#include "libxfs.h"
+#include "command.h"
+#include "output.h"
+#include "init.h"
+#include "io.h"
+#include "type.h"
+#include "input.h"
+
+static void
+btdump_help(void)
+{
+	dbprintf(_(
+"\n"
+" If the cursor points to a btree block, 'btdump' dumps the btree\n"
+" downward from that block.  If the cursor points to an inode,\n"
+" the data fork btree root is selected by default.  If the cursor\n"
+" points to a directory or extended attribute btree node, the tree\n"
+" will be printed downward from that block.\n"
+"\n"
+" Options:\n"
+"   -a -- Display an inode's extended attribute fork btree.\n"
+"   -i -- Print internal btree nodes.\n"
+"\n"
+));
+
+}
+
+static int
+eval(
+	const char	*fmt, ...)
+{
+	va_list		ap;
+	char		buf[PATH_MAX];
+	char		**v;
+	int		c;
+	int		ret;
+
+	va_start(ap, fmt);
+	vsnprintf(buf, sizeof(buf), fmt, ap);
+	va_end(ap);
+
+	v = breakline(buf, &c);
+	ret = command(c, v);
+	free(v);
+	return ret;
+}
+
+static bool
+btblock_has_rightsib(
+	struct xfs_btree_block	*block,
+	bool			long_format)
+{
+	if (long_format)
+		return block->bb_u.l.bb_rightsib != cpu_to_be64(NULLFSBLOCK);
+	return block->bb_u.s.bb_rightsib != cpu_to_be32(NULLAGBLOCK);
+}
+
+static int
+dump_btlevel(
+	int			level,
+	bool			long_format)
+{
+	xfs_daddr_t		orig_daddr = iocur_top->bb;
+	xfs_daddr_t		last_daddr;
+	unsigned int		nr;
+	int			ret = 0;
+
+	push_cur_and_set_type();
+
+	nr = 1;
+	do {
+		last_daddr = iocur_top->bb;
+		dbprintf(_("%s level %u block %u daddr %llu\n"),
+			 iocur_top->typ->name, level, nr, last_daddr);
+		if (level > 0) {
+			ret = eval("print keys");
+			if (ret)
+				goto err;
+			ret = eval("print ptrs");
+		} else {
+			ret = eval("print recs");
+		}
+		if (ret)
+			goto err;
+		if (btblock_has_rightsib(iocur_top->data, long_format)) {
+			ret = eval("addr rightsib");
+			if (ret)
+				goto err;
+		}
+		nr++;
+	} while (iocur_top->bb != orig_daddr && iocur_top->bb != last_daddr);
+
+err:
+	pop_cur();
+	return ret;
+}
+
+static int
+dump_btree(
+	bool		dump_node_blocks,
+	bool		long_format)
+{
+	xfs_daddr_t	orig_daddr = iocur_top->bb;
+	xfs_daddr_t	last_daddr;
+	int		level;
+	int		ret = 0;
+
+	push_cur_and_set_type();
+
+	cur_agno = XFS_FSB_TO_AGNO(mp, XFS_DADDR_TO_FSB(mp, iocur_top->bb));
+	level = xfs_btree_get_level(iocur_top->data);
+	do {
+		last_daddr = iocur_top->bb;
+		if (level > 0) {
+			if (dump_node_blocks) {
+				ret = dump_btlevel(level, long_format);
+				if (ret)
+					goto err;
+			}
+			ret = eval("addr ptrs[1]");
+		} else {
+			ret = dump_btlevel(level, long_format);
+		}
+		if (ret)
+			goto err;
+		level--;
+	} while (level >= 0 &&
+		 iocur_top->bb != orig_daddr &&
+		 iocur_top->bb != last_daddr);
+
+err:
+	pop_cur();
+	return ret;
+}
+
+static inline int dump_btree_short(bool dump_node_blocks)
+{
+	return dump_btree(dump_node_blocks, false);
+}
+
+static inline int dump_btree_long(bool dump_node_blocks)
+{
+	return dump_btree(dump_node_blocks, true);
+}
+
+static int
+dump_inode(
+	bool			dump_node_blocks,
+	bool			attrfork)
+{
+	char			*prefix;
+	struct xfs_dinode	*dip;
+	int			ret = 0;
+
+	if (attrfork)
+		prefix = "a.bmbt";
+	else if (xfs_sb_version_hascrc(&mp->m_sb))
+		prefix = "u3.bmbt";
+	else
+		prefix = "u.bmbt";
+
+	dip = iocur_top->data;
+	if (attrfork) {
+		if (!dip->di_anextents ||
+		    dip->di_aformat != XFS_DINODE_FMT_BTREE) {
+			dbprintf(_("attr fork not in btree format\n"));
+			return 0;
+		}
+	} else {
+		if (!dip->di_nextents ||
+		    dip->di_format != XFS_DINODE_FMT_BTREE) {
+			dbprintf(_("data fork not in btree format\n"));
+			return 0;
+		}
+	}
+
+	push_cur_and_set_type();
+
+	if (dump_node_blocks) {
+		ret = eval("print %s.keys", prefix);
+		if (ret)
+			goto err;
+		ret = eval("print %s.ptrs", prefix);
+		if (ret)
+			goto err;
+	}
+
+	ret = eval("addr %s.ptrs[1]", prefix);
+	if (ret)
+		goto err;
+
+	ret = dump_btree_long(dump_node_blocks);
+	if (ret)
+		goto err;
+
+err:
+	pop_cur();
+	return ret;
+}
+
+static bool
+dir_has_rightsib(
+	void				*block,
+	int				level)
+{
+	struct xfs_dir3_icleaf_hdr	lhdr;
+	struct xfs_da3_icnode_hdr	nhdr;
+
+	if (level > 0) {
+		M_DIROPS(mp)->node_hdr_from_disk(&nhdr, block);
+		return nhdr.forw != 0;
+	}
+	M_DIROPS(mp)->leaf_hdr_from_disk(&lhdr, block);
+	return lhdr.forw != 0;
+}
+
+static int
+dir_level(
+	void				*block)
+{
+	struct xfs_dir3_icleaf_hdr	lhdr;
+	struct xfs_da3_icnode_hdr	nhdr;
+
+	switch (((struct xfs_da_intnode *)block)->hdr.info.magic) {
+	case cpu_to_be16(XFS_DIR2_LEAF1_MAGIC):
+	case cpu_to_be16(XFS_DIR2_LEAFN_MAGIC):
+		M_DIROPS(mp)->leaf_hdr_from_disk(&lhdr, block);
+		return 0;
+	case cpu_to_be16(XFS_DA_NODE_MAGIC):
+		M_DIROPS(mp)->node_hdr_from_disk(&nhdr, block);
+		return nhdr.level;
+	default:
+		return -1;
+	}
+}
+
+static int
+dir3_level(
+	void				*block)
+{
+	struct xfs_dir3_icleaf_hdr	lhdr;
+	struct xfs_da3_icnode_hdr	nhdr;
+
+	switch (((struct xfs_da_intnode *)block)->hdr.info.magic) {
+	case cpu_to_be16(XFS_DIR3_LEAF1_MAGIC):
+	case cpu_to_be16(XFS_DIR3_LEAFN_MAGIC):
+		M_DIROPS(mp)->leaf_hdr_from_disk(&lhdr, block);
+		return 0;
+	case cpu_to_be16(XFS_DA3_NODE_MAGIC):
+		M_DIROPS(mp)->node_hdr_from_disk(&nhdr, block);
+		return nhdr.level;
+	default:
+		return -1;
+	}
+}
+
+static bool
+attr_has_rightsib(
+	void				*block,
+	int				level)
+{
+        struct xfs_attr_leafblock	lhdr;
+	struct xfs_da3_icnode_hdr	nhdr;
+
+	if (level > 0) {
+		M_DIROPS(mp)->node_hdr_from_disk(&nhdr, block);
+		return nhdr.forw != 0;
+	}
+	xfs_attr3_leaf_hdr_to_disk(mp->m_attr_geo, &lhdr, block);
+	return lhdr.hdr.info.forw != 0;
+}
+
+static int
+attr_level(
+	void				*block)
+{
+	struct xfs_attr_leafblock	lhdr;
+	struct xfs_da3_icnode_hdr	nhdr;
+
+	switch (((struct xfs_da_intnode *)block)->hdr.info.magic) {
+	case cpu_to_be16(XFS_ATTR_LEAF_MAGIC):
+		xfs_attr3_leaf_hdr_to_disk(mp->m_attr_geo, &lhdr, block);
+		return 0;
+	case cpu_to_be16(XFS_DA_NODE_MAGIC):
+		M_DIROPS(mp)->node_hdr_from_disk(&nhdr, block);
+		return nhdr.level;
+	default:
+		return -1;
+	}
+}
+
+static int
+attr3_level(
+	void				*block)
+{
+	struct xfs_attr_leafblock	lhdr;
+	struct xfs_da3_icnode_hdr	nhdr;
+
+	switch (((struct xfs_da_intnode *)block)->hdr.info.magic) {
+	case cpu_to_be16(XFS_ATTR3_LEAF_MAGIC):
+		xfs_attr3_leaf_hdr_to_disk(mp->m_attr_geo, &lhdr, block);
+		return 0;
+	case cpu_to_be16(XFS_DA3_NODE_MAGIC):
+		M_DIROPS(mp)->node_hdr_from_disk(&nhdr, block);
+		return nhdr.level;
+	default:
+		return -1;
+	}
+}
+
+struct dabprinter_ops {
+	const char		*print_node_entries;
+	const char		*print_leaf_entries;
+	const char		*go_node_forward;
+	const char		*go_leaf_forward;
+	const char		*go_down;
+	bool			(*has_rightsib)(void *, int);
+	int			(*level)(void *);
+};
+
+static struct dabprinter_ops attr_print = {
+	.print_node_entries	= "btree",
+	.print_leaf_entries	= "entries nvlist",
+	.go_node_forward	= "hdr.info.forw",
+	.go_leaf_forward	= "hdr.info.forw",
+	.go_down		= "btree[0].before",
+	.has_rightsib		= attr_has_rightsib,
+	.level			= attr_level,
+};
+
+static struct dabprinter_ops attr3_print = {
+	.print_node_entries	= "btree",
+	.print_leaf_entries	= "entries nvlist",
+	.go_node_forward	= "hdr.info.hdr.forw",
+	.go_leaf_forward	= "hdr.info.hdr.forw",
+	.go_down		= "btree[0].before",
+	.has_rightsib		= attr_has_rightsib,
+	.level			= attr3_level,
+};
+
+static struct dabprinter_ops dir_print = {
+	.print_node_entries	= "nbtree",
+	.print_leaf_entries	= "lents",
+	.go_node_forward	= "nhdr.info.hdr.forw",
+	.go_leaf_forward	= "lhdr.info.hdr.forw",
+	.go_down		= "nbtree[0].before",
+	.has_rightsib		= dir_has_rightsib,
+	.level			= dir_level,
+};
+
+static struct dabprinter_ops dir3_print = {
+	.print_node_entries	= "nbtree",
+	.print_leaf_entries	= "lents",
+	.go_node_forward	= "nhdr.info.forw",
+	.go_leaf_forward	= "lhdr.info.forw",
+	.go_down		= "nbtree[0].before",
+	.has_rightsib		= dir_has_rightsib,
+	.level			= dir3_level,
+};
+
+static int
+dump_dablevel(
+	int			level,
+	struct dabprinter_ops	*dbp)
+{
+	xfs_daddr_t		orig_daddr = iocur_top->bb;
+	xfs_daddr_t		last_daddr;
+	unsigned int		nr;
+	int			ret = 0;
+
+	push_cur_and_set_type();
+
+	nr = 1;
+	do {
+		last_daddr = iocur_top->bb;
+		dbprintf(_("%s level %u block %u daddr %llu\n"),
+			 iocur_top->typ->name, level, nr, last_daddr);
+		ret = eval("print %s", level > 0 ? dbp->print_node_entries :
+						   dbp->print_leaf_entries);
+		if (ret)
+			goto err;
+		if (dbp->has_rightsib(iocur_top->data, level)) {
+			ret = eval("addr %s", level > 0 ? dbp->go_node_forward :
+							  dbp->go_leaf_forward);
+			if (ret)
+				goto err;
+		}
+		nr++;
+	} while (iocur_top->bb != orig_daddr && iocur_top->bb != last_daddr);
+
+err:
+	pop_cur();
+	return ret;
+}
+
+static int
+dump_dabtree(
+	bool				dump_node_blocks,
+	struct dabprinter_ops		*dbp)
+{
+	xfs_daddr_t			orig_daddr = iocur_top->bb;
+	xfs_daddr_t			last_daddr;
+	int				level;
+	int				ret = 0;
+
+	push_cur_and_set_type();
+
+	cur_agno = XFS_FSB_TO_AGNO(mp, XFS_DADDR_TO_FSB(mp, iocur_top->bb));
+	level = dbp->level(iocur_top->data);
+	if (level < 0) {
+		printf(_("Current location is not part of a dir/attr btree.\n"));
+		goto err;
+	}
+
+	do {
+		last_daddr = iocur_top->bb;
+		if (level > 0) {
+			if (dump_node_blocks) {
+				ret = dump_dablevel(level, dbp);
+				if (ret)
+					goto err;
+			}
+			ret = eval("addr %s", dbp->go_down);
+		} else {
+			ret = dump_dablevel(level, dbp);
+		}
+		if (ret)
+			goto err;
+		level--;
+	} while (level >= 0 &&
+		 iocur_top->bb != orig_daddr &&
+		 iocur_top->bb != last_daddr);
+
+err:
+	pop_cur();
+	return ret;
+}
+
+static int
+btdump_f(
+	int		argc,
+	char		**argv)
+{
+	bool		aflag = false;
+	bool		iflag = false;
+	bool		crc = xfs_sb_version_hascrc(&mp->m_sb);
+	int		c;
+
+	if (cur_typ == NULL) {
+		dbprintf(_("no current type\n"));
+		return 0;
+	}
+	while ((c = getopt(argc, argv, "ai")) != EOF) {
+		switch (c) {
+		case 'a':
+			aflag = true;
+			break;
+		case 'i':
+			iflag = true;
+			break;
+		default:
+			dbprintf(_("bad option for btdump command\n"));
+			return 0;
+		}
+	}
+
+	if (optind != argc) {
+		dbprintf(_("bad options for btdump command\n"));
+		return 0;
+	}
+	if (aflag && cur_typ->typnm != TYP_INODE) {
+		dbprintf(_("attrfork flag doesn't apply here\n"));
+		return 0;
+	}
+
+	switch (cur_typ->typnm) {
+	case TYP_BNOBT:
+	case TYP_CNTBT:
+	case TYP_INOBT:
+	case TYP_FINOBT:
+	case TYP_RMAPBT:
+	case TYP_REFCBT:
+		return dump_btree_short(iflag);
+	case TYP_BMAPBTA:
+	case TYP_BMAPBTD:
+		return dump_btree_long(iflag);
+	case TYP_INODE:
+		return dump_inode(iflag, aflag);
+	case TYP_ATTR:
+		return dump_dabtree(iflag, crc ? &attr3_print : &attr_print);
+	case TYP_DIR2:
+		return dump_dabtree(iflag, crc ? &dir3_print : &dir_print);
+	default:
+		dbprintf(_("type \"%s\" is not a btree type or inode\n"),
+				cur_typ->name);
+		return 0;
+	}
+}
+
+static const cmdinfo_t btdump_cmd =
+	{ "btdump", "b", btdump_f, 0, 2, 0, "[-a] [-i]",
+	  N_("dump btree"), btdump_help };
+
+void
+btdump_init(void)
+{
+	add_command(&btdump_cmd);
+}
diff -urpN xfsprogs-4.9.0/db/check.c xfsprogs-4.14.0/db/check.c
--- xfsprogs-4.9.0/db/check.c	2016-12-13 21:07:01.000000000 +0100
+++ xfsprogs-4.14.0/db/check.c	2017-11-27 17:57:55.000000000 +0100
@@ -114,8 +114,8 @@ typedef struct dirhash {
 
 static xfs_extlen_t	agffreeblks;
 static xfs_extlen_t	agflongest;
-static __uint64_t	agf_aggr_freeblks;	/* aggregate count over all */
-static __uint32_t	agfbtreeblks;
+static uint64_t	agf_aggr_freeblks;	/* aggregate count over all */
+static uint32_t	agfbtreeblks;
 static int		lazycount;
 static xfs_agino_t	agicount;
 static xfs_agino_t	agifreecount;
@@ -124,10 +124,10 @@ static int		blist_size;
 static char		**dbmap;	/* really dbm_t:8 */
 static dirhash_t	**dirhash;
 static int		error;
-static __uint64_t	fdblocks;
-static __uint64_t	frextents;
-static __uint64_t	icount;
-static __uint64_t	ifree;
+static uint64_t	fdblocks;
+static uint64_t	frextents;
+static uint64_t	icount;
+static uint64_t	ifree;
 static inodata_t	***inodata;
 static int		inodata_hash_size;
 static inodata_t	***inomap;
@@ -1187,7 +1187,7 @@ blocktrash_f(
 		goto out;
 	}
 	for (i = 0; i < count; i++) {
-		randb = (xfs_rfsblock_t)((((__int64_t)random() << 32) |
+		randb = (xfs_rfsblock_t)((((int64_t)random() << 32) |
 					 random()) % blocks);
 		for (bi = 0, agno = 0, done = 0;
 		     !done && agno < mp->m_sb.sb_agcount;
@@ -3032,7 +3032,7 @@ process_leaf_node_dir_v2(
 		}
 		if (v)
 			dbprintf(_("dir inode %lld block %u=%llu\n"), id->ino,
-				(__uint32_t)dbno,
+				(uint32_t)dbno,
 				(xfs_fsblock_t)bmp->startblock);
 		push_cur();
 		if (nex > 1)
@@ -3045,7 +3045,7 @@ process_leaf_node_dir_v2(
 			if (!sflag || v)
 				dbprintf(_("can't read block %u for directory "
 					 "inode %lld\n"),
-					(__uint32_t)dbno, id->ino);
+					(uint32_t)dbno, id->ino);
 			error++;
 			pop_cur();
 			dbno += mp->m_dir_geo->fsbcount - 1;
@@ -3192,9 +3192,7 @@ process_leaf_node_dir_v2_free(
 		return;
 	}
 	if (be32_to_cpu(free->hdr.nvalid) > maxent ||
-				be32_to_cpu(free->hdr.nvalid) < 0 ||
 				be32_to_cpu(free->hdr.nused) > maxent ||
-				be32_to_cpu(free->hdr.nused) < 0 ||
 				be32_to_cpu(free->hdr.nused) >
 					be32_to_cpu(free->hdr.nvalid)) {
 		if (!sflag || v)
@@ -3383,7 +3381,7 @@ process_quota(
 	int		cb;
 	xfs_dqblk_t	*dqb;
 	xfs_dqid_t	dqid;
-	u_int8_t	exp_flags = 0;
+	uint8_t		exp_flags = 0;
 	uint		i;
 	uint		perblock;
 	xfs_fileoff_t	qbno;
diff -urpN xfsprogs-4.9.0/db/command.c xfsprogs-4.14.0/db/command.c
--- xfsprogs-4.9.0/db/command.c	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/db/command.c	2017-11-20 01:14:14.000000000 +0100
@@ -51,6 +51,7 @@
 #include "dquot.h"
 #include "fsmap.h"
 #include "crc.h"
+#include "fuzz.h"
 
 cmdinfo_t	*cmdtab;
 int		ncmds;
@@ -124,6 +125,7 @@ init_commands(void)
 	attrset_init();
 	block_init();
 	bmap_init();
+	btdump_init();
 	check_init();
 	convert_init();
 	crc_init();
@@ -146,4 +148,5 @@ init_commands(void)
 	type_init();
 	write_init();
 	dquot_init();
+	fuzz_init();
 }
diff -urpN xfsprogs-4.9.0/db/command.h xfsprogs-4.14.0/db/command.h
--- xfsprogs-4.9.0/db/command.h	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/db/command.h	2017-11-20 01:14:14.000000000 +0100
@@ -39,3 +39,5 @@ extern void		add_command(const cmdinfo_t
 extern int		command(int argc, char **argv);
 extern const cmdinfo_t	*find_command(const char *cmd);
 extern void		init_commands(void);
+
+extern void		btdump_init(void);
diff -urpN xfsprogs-4.9.0/db/convert.c xfsprogs-4.14.0/db/convert.c
--- xfsprogs-4.9.0/db/convert.c	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/db/convert.c	2017-11-20 01:14:14.000000000 +0100
@@ -24,13 +24,13 @@
 
 #define	M(A)	(1 << CT_ ## A)
 #define	agblock_to_bytes(x)	\
-	((__uint64_t)(x) << mp->m_sb.sb_blocklog)
+	((uint64_t)(x) << mp->m_sb.sb_blocklog)
 #define	agino_to_bytes(x)	\
-	((__uint64_t)(x) << mp->m_sb.sb_inodelog)
+	((uint64_t)(x) << mp->m_sb.sb_inodelog)
 #define	agnumber_to_bytes(x)	\
-	agblock_to_bytes((__uint64_t)(x) * mp->m_sb.sb_agblocks)
+	agblock_to_bytes((uint64_t)(x) * mp->m_sb.sb_agblocks)
 #define	daddr_to_bytes(x)	\
-	((__uint64_t)(x) << BBSHIFT)
+	((uint64_t)(x) << BBSHIFT)
 #define	fsblock_to_bytes(x)	\
 	(agnumber_to_bytes(XFS_FSB_TO_AGNO(mp, (x))) + \
 	 agblock_to_bytes(XFS_FSB_TO_AGBNO(mp, (x))))
@@ -38,7 +38,7 @@
 	(agnumber_to_bytes(XFS_INO_TO_AGNO(mp, (x))) + \
 	 agino_to_bytes(XFS_INO_TO_AGINO(mp, (x))))
 #define	inoidx_to_bytes(x)	\
-	((__uint64_t)(x) << mp->m_sb.sb_inodelog)
+	((uint64_t)(x) << mp->m_sb.sb_inodelog)
 
 typedef enum {
 	CT_NONE = -1,
@@ -68,7 +68,7 @@ typedef union {
 	xfs_agnumber_t	agnumber;
 	int		bboff;
 	int		blkoff;
-	__uint64_t	byte;
+	uint64_t	byte;
 	xfs_daddr_t	daddr;
 	xfs_fsblock_t	fsblock;
 	xfs_ino_t	ino;
@@ -76,7 +76,7 @@ typedef union {
 	int		inooff;
 } cval_t;
 
-static __uint64_t		bytevalue(ctype_t ctype, cval_t *val);
+static uint64_t		bytevalue(ctype_t ctype, cval_t *val);
 static int		convert_f(int argc, char **argv);
 static int		getvalue(char *s, ctype_t ctype, cval_t *val);
 static ctype_t		lookupcty(char *ctyname);
@@ -118,7 +118,7 @@ static const cmdinfo_t	convert_cmd =
 	{ "convert", NULL, convert_f, 3, 9, 0, "type num [type num]... type",
 	  "convert from one address form to another", NULL };
 
-static __uint64_t
+static uint64_t
 bytevalue(ctype_t ctype, cval_t *val)
 {
 	switch (ctype) {
@@ -129,9 +129,9 @@ bytevalue(ctype_t ctype, cval_t *val)
 	case CT_AGNUMBER:
 		return agnumber_to_bytes(val->agnumber);
 	case CT_BBOFF:
-		return (__uint64_t)val->bboff;
+		return (uint64_t)val->bboff;
 	case CT_BLKOFF:
-		return (__uint64_t)val->blkoff;
+		return (uint64_t)val->blkoff;
 	case CT_BYTE:
 		return val->byte;
 	case CT_DADDR:
@@ -143,7 +143,7 @@ bytevalue(ctype_t ctype, cval_t *val)
 	case CT_INOIDX:
 		return inoidx_to_bytes(val->inoidx);
 	case CT_INOOFF:
-		return (__uint64_t)val->inooff;
+		return (uint64_t)val->inooff;
 	case CT_NONE:
 	case NCTS:
 		break;
@@ -160,7 +160,7 @@ convert_f(int argc, char **argv)
 	cval_t		cvals[NCTS] = {};
 	int		i;
 	int		mask;
-	__uint64_t	v;
+	uint64_t	v;
 	ctype_t		wtype;
 
 	/* move past the "convert" command */
@@ -262,7 +262,7 @@ static int
 getvalue(char *s, ctype_t ctype, cval_t *val)
 {
 	char		*p;
-	__uint64_t	v;
+	uint64_t	v;
 
 	v = strtoull(s, &p, 0);
 	if (*p != '\0') {
@@ -286,7 +286,7 @@ getvalue(char *s, ctype_t ctype, cval_t
 		val->blkoff = (int)v;
 		break;
 	case CT_BYTE:
-		val->byte = (__uint64_t)v;
+		val->byte = (uint64_t)v;
 		break;
 	case CT_DADDR:
 		val->daddr = (xfs_daddr_t)v;
diff -urpN xfsprogs-4.9.0/db/dir2.c xfsprogs-4.14.0/db/dir2.c
--- xfsprogs-4.9.0/db/dir2.c	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/db/dir2.c	2017-11-20 01:14:14.000000000 +0100
@@ -981,6 +981,43 @@ const field_t	da3_node_hdr_flds[] = {
 	{ NULL }
 };
 
+/* Set the CRC. */
+void
+xfs_dir3_set_crc(
+	struct xfs_buf		*bp)
+{
+	__be32			magic32;
+	__be16			magic16;
+
+	magic32 = *(__be32 *)bp->b_addr;
+	magic16 = ((struct xfs_da_blkinfo *)bp->b_addr)->magic;
+
+	switch (magic32) {
+	case cpu_to_be32(XFS_DIR3_BLOCK_MAGIC):
+	case cpu_to_be32(XFS_DIR3_DATA_MAGIC):
+		xfs_buf_update_cksum(bp, XFS_DIR3_DATA_CRC_OFF);
+		return;
+	case cpu_to_be32(XFS_DIR3_FREE_MAGIC):
+		xfs_buf_update_cksum(bp, XFS_DIR3_FREE_CRC_OFF);
+		return;
+	default:
+		break;
+	}
+
+	switch (magic16) {
+	case cpu_to_be16(XFS_DIR3_LEAF1_MAGIC):
+	case cpu_to_be16(XFS_DIR3_LEAFN_MAGIC):
+		xfs_buf_update_cksum(bp, XFS_DIR3_LEAF_CRC_OFF);
+		return;
+	case cpu_to_be16(XFS_DA3_NODE_MAGIC):
+		xfs_buf_update_cksum(bp, XFS_DA3_NODE_CRC_OFF);
+		return;
+	default:
+		dbprintf(_("Unknown directory buffer type! %x %x\n"), magic32, magic16);
+		break;
+	}
+}
+
 /*
  * Special read verifier for directory buffers. Detect the magic number
  * appropriately and set the correct verifier and call it.
diff -urpN xfsprogs-4.9.0/db/dir2.h xfsprogs-4.14.0/db/dir2.h
--- xfsprogs-4.9.0/db/dir2.h	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/db/dir2.h	2017-11-20 01:14:14.000000000 +0100
@@ -60,5 +60,6 @@ static inline uint8_t *xfs_dir2_sf_inumb
 
 extern int	dir2_data_union_size(void *obj, int startoff, int idx);
 extern int	dir2_size(void *obj, int startoff, int idx);
+extern void	xfs_dir3_set_crc(struct xfs_buf *bp);
 
 extern const struct xfs_buf_ops xfs_dir3_db_buf_ops;
diff -urpN xfsprogs-4.9.0/db/dquot.c xfsprogs-4.14.0/db/dquot.c
--- xfsprogs-4.9.0/db/dquot.c	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/db/dquot.c	2017-11-20 01:14:14.000000000 +0100
@@ -171,6 +171,17 @@ dquot_f(
 }
 
 void
+xfs_dquot_set_crc(
+	struct xfs_buf *bp)
+{
+	ASSERT((iocur_top->dquot_buf));
+	ASSERT(iocur_top->bp == bp);
+
+	xfs_update_cksum(iocur_top->data, sizeof(struct xfs_dqblk),
+			 XFS_DQUOT_CRC_OFF);
+}
+
+void
 dquot_init(void)
 {
 	add_command(&dquot_cmd);
diff -urpN xfsprogs-4.9.0/db/dquot.h xfsprogs-4.14.0/db/dquot.h
--- xfsprogs-4.9.0/db/dquot.h	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/db/dquot.h	2017-11-20 01:14:14.000000000 +0100
@@ -20,4 +20,5 @@ extern const struct field	disk_dquot_fld
 extern const struct field	dqblk_flds[];
 extern const struct field	dqblk_hfld[];
 
+extern void	xfs_dquot_set_crc(struct xfs_buf *);
 extern void	dquot_init(void);
diff -urpN xfsprogs-4.9.0/db/faddr.c xfsprogs-4.14.0/db/faddr.c
--- xfsprogs-4.9.0/db/faddr.c	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/db/faddr.c	2017-11-20 01:14:14.000000000 +0100
@@ -79,11 +79,11 @@ fa_attrblock(
 	typnm_t		next)
 {
 	bmap_ext_t	bm;
-	__uint32_t	bno;
+	uint32_t	bno;
 	xfs_fsblock_t	dfsbno;
 	int		nex;
 
-	bno = (__uint32_t)getbitval(obj, bit, bitsz(bno), BVUNSIGNED);
+	bno = (uint32_t)getbitval(obj, bit, bitsz(bno), BVUNSIGNED);
 	if (bno == 0) {
 		dbprintf(_("null attribute block number, cannot set new addr\n"));
 		return;
@@ -96,7 +96,7 @@ fa_attrblock(
 	}
 	dfsbno = bm.startblock + (bno - bm.startoff);
 	ASSERT(typtab[next].typnm == next);
-	set_cur(&typtab[next], (__int64_t)XFS_FSB_TO_DADDR(mp, dfsbno), blkbb,
+	set_cur(&typtab[next], (int64_t)XFS_FSB_TO_DADDR(mp, dfsbno), blkbb,
 		DB_RING_ADD, NULL);
 }
 
@@ -276,11 +276,11 @@ fa_dirblock(
 {
 	bbmap_t		bbmap;
 	bmap_ext_t	*bmp;
-	__uint32_t	bno;
+	uint32_t	bno;
 	xfs_fsblock_t	dfsbno;
 	int		nex;
 
-	bno = (__uint32_t)getbitval(obj, bit, bitsz(bno), BVUNSIGNED);
+	bno = (uint32_t)getbitval(obj, bit, bitsz(bno), BVUNSIGNED);
 	if (bno == 0) {
 		dbprintf(_("null directory block number, cannot set new addr\n"));
 		return;
@@ -297,7 +297,7 @@ fa_dirblock(
 	ASSERT(typtab[next].typnm == next);
 	if (nex > 1)
 		make_bbmap(&bbmap, nex, bmp);
-	set_cur(&typtab[next], (__int64_t)XFS_FSB_TO_DADDR(mp, dfsbno),
+	set_cur(&typtab[next], (int64_t)XFS_FSB_TO_DADDR(mp, dfsbno),
 		XFS_FSB_TO_BB(mp, mp->m_dir_geo->fsbcount), DB_RING_ADD,
 		nex > 1 ? &bbmap : NULL);
 	free(bmp);
@@ -317,7 +317,7 @@ fa_drfsbno(
 		return;
 	}
 	ASSERT(typtab[next].typnm == next);
-	set_cur(&typtab[next], (__int64_t)XFS_FSB_TO_BB(mp, bno), blkbb,
+	set_cur(&typtab[next], (int64_t)XFS_FSB_TO_BB(mp, bno), blkbb,
 		DB_RING_ADD, NULL);
 }
 
diff -urpN xfsprogs-4.9.0/db/field.c xfsprogs-4.14.0/db/field.c
--- xfsprogs-4.9.0/db/field.c	2016-12-13 21:07:01.000000000 +0100
+++ xfsprogs-4.14.0/db/field.c	2017-11-20 01:14:14.000000000 +0100
@@ -83,7 +83,7 @@ const ftattr_t	ftattrtab[] = {
 	  attr_sf_entry_size, FTARG_SIZE, NULL, attr_sf_entry_flds },
 	{ FLDT_ATTR_SF_HDR, "attr_sf_hdr", NULL, (char *)attr_sf_hdr_flds,
 	  SI(bitsz(struct xfs_attr_sf_hdr)), 0, NULL, attr_sf_hdr_flds },
-	{ FLDT_ATTRBLOCK, "attrblock", fp_num, "%u", SI(bitsz(__uint32_t)), 0,
+	{ FLDT_ATTRBLOCK, "attrblock", fp_num, "%u", SI(bitsz(uint32_t)), 0,
 	  fa_attrblock, NULL },
 	{ FLDT_ATTRSHORT, "attrshort", NULL, (char *)attr_shortform_flds,
 	  attrshort_size, FTARG_SIZE, NULL, attr_shortform_flds },
@@ -91,12 +91,17 @@ const ftattr_t	ftattrtab[] = {
 /* attr3 specific fields */
 	{ FLDT_ATTR3, "attr3", NULL, (char *)attr3_flds, attr_size, FTARG_SIZE,
 	  NULL, attr3_flds },
+	{ FLDT_ATTR3_BLKINFO, "attr3_blkinfo", NULL, (char *)attr3_blkinfo_flds,
+	  SI(bitsz(struct xfs_da3_blkinfo)), 0, NULL, attr3_blkinfo_flds },
 	{ FLDT_ATTR3_LEAF_HDR, "attr3_leaf_hdr", NULL,
 	  (char *)attr3_leaf_hdr_flds, SI(bitsz(struct xfs_attr3_leaf_hdr)),
 	  0, NULL, attr3_leaf_hdr_flds },
 	{ FLDT_ATTR3_NODE_HDR, "attr3_node_hdr", NULL,
-	  (char *)da3_node_hdr_flds, SI(bitsz(struct xfs_da3_node_hdr)),
-	  0, NULL, da3_node_hdr_flds },
+	  (char *)attr3_node_hdr_flds, SI(bitsz(struct xfs_da3_node_hdr)),
+	  0, NULL, attr3_node_hdr_flds },
+	{ FLDT_ATTR3_REMOTE_HDR, "attr3_remote_hdr", NULL,
+	  (char *)attr3_remote_crc_flds, attr_size, FTARG_SIZE, NULL,
+	  attr3_remote_crc_flds },
 
 	{ FLDT_BMAPBTA, "bmapbta", NULL, (char *)bmapbta_flds, btblock_size,
 	  FTARG_SIZE, NULL, bmapbta_flds },
@@ -197,7 +202,7 @@ const ftattr_t	ftattrtab[] = {
 	  SI(bitsz(struct xfs_refcount_rec)), 0, NULL, refcbt_rec_flds },
 
 /* CRC field */
-	{ FLDT_CRC, "crc", fp_crc, "%#x (%s)", SI(bitsz(__uint32_t)),
+	{ FLDT_CRC, "crc", fp_crc, "%#x (%s)", SI(bitsz(uint32_t)),
 	  0, NULL, NULL },
 
 	{ FLDT_DEV, "dev", fp_num, "%#x", SI(bitsz(xfs_dev_t)), 0, NULL, NULL },
@@ -212,7 +217,7 @@ const ftattr_t	ftattrtab[] = {
 	{ FLDT_DINODE_CORE, "dinode_core", NULL, (char *)inode_core_flds,
 	  SI(bitsz(xfs_dinode_t)), 0, NULL, inode_core_flds },
 	{ FLDT_DINODE_FMT, "dinode_fmt", fp_dinode_fmt, NULL,
-	  SI(bitsz(__int8_t)), 0, NULL, NULL },
+	  SI(bitsz(int8_t)), 0, NULL, NULL },
 	{ FLDT_DINODE_U, "dinode_u", NULL, (char *)inode_u_flds, inode_u_size,
 	  FTARG_SIZE|FTARG_OKEMPTY, NULL, inode_u_flds },
 	{ FLDT_DINODE_V3, "dinode_v3", NULL, (char *)inode_v3_flds,
@@ -293,7 +298,7 @@ const ftattr_t	ftattrtab[] = {
 	{ FLDT_DA3_NODE_HDR, "dir_node_hdr", NULL, (char *)da3_node_hdr_flds,
 	  SI(bitsz(struct xfs_da3_node_hdr)), 0, NULL, da3_node_hdr_flds },
 
-	{ FLDT_DIRBLOCK, "dirblock", fp_num, "%u", SI(bitsz(__uint32_t)), 0,
+	{ FLDT_DIRBLOCK, "dirblock", fp_num, "%u", SI(bitsz(uint32_t)), 0,
 	  fa_dirblock, NULL },
 	{ FLDT_DISK_DQUOT, "disk_dquot", NULL, (char *)disk_dquot_flds,
 	  SI(bitsz(xfs_disk_dquot_t)), 0, NULL, disk_dquot_flds },
@@ -333,15 +338,15 @@ const ftattr_t	ftattrtab[] = {
 	  FTARG_SIZE, NULL, inode_crc_flds },
 	{ FLDT_INOFREE, "inofree", fp_num, "%#llx", SI(bitsz(xfs_inofree_t)), 0,
 	  NULL, NULL },
-	{ FLDT_INT16D, "int16d", fp_num, "%d", SI(bitsz(__int16_t)),
+	{ FLDT_INT16D, "int16d", fp_num, "%d", SI(bitsz(int16_t)),
 	  FTARG_SIGNED, NULL, NULL },
-	{ FLDT_INT32D, "int32d", fp_num, "%d", SI(bitsz(__int32_t)),
+	{ FLDT_INT32D, "int32d", fp_num, "%d", SI(bitsz(int32_t)),
 	  FTARG_SIGNED, NULL, NULL },
-	{ FLDT_INT64D, "int64d", fp_num, "%lld", SI(bitsz(__int64_t)),
+	{ FLDT_INT64D, "int64d", fp_num, "%lld", SI(bitsz(int64_t)),
 	  FTARG_SIGNED, NULL, NULL },
-	{ FLDT_INT8D, "int8d", fp_num, "%d", SI(bitsz(__int8_t)), FTARG_SIGNED,
+	{ FLDT_INT8D, "int8d", fp_num, "%d", SI(bitsz(int8_t)), FTARG_SIGNED,
 	  NULL, NULL },
-	{ FLDT_NSEC, "nsec", fp_num, "%09d", SI(bitsz(__int32_t)), FTARG_SIGNED,
+	{ FLDT_NSEC, "nsec", fp_num, "%09d", SI(bitsz(int32_t)), FTARG_SIGNED,
 	  NULL, NULL },
 	{ FLDT_QCNT, "qcnt", fp_num, "%llu", SI(bitsz(xfs_qcnt_t)), 0, NULL,
 	  NULL },
@@ -354,34 +359,34 @@ const ftattr_t	ftattrtab[] = {
 	{ FLDT_SYMLINK_CRC, "symlink", NULL, (char *)symlink_crc_flds,
 	  symlink_size, FTARG_SIZE, NULL, symlink_crc_flds },
 
-	{ FLDT_TIME, "time", fp_time, NULL, SI(bitsz(__int32_t)), FTARG_SIGNED,
+	{ FLDT_TIME, "time", fp_time, NULL, SI(bitsz(int32_t)), FTARG_SIGNED,
 	  NULL, NULL },
 	{ FLDT_TIMESTAMP, "timestamp", NULL, (char *)timestamp_flds,
 	  SI(bitsz(xfs_timestamp_t)), 0, NULL, timestamp_flds },
 	{ FLDT_UINT1, "uint1", fp_num, "%u", SI(1), 0, NULL, NULL },
-	{ FLDT_UINT16D, "uint16d", fp_num, "%u", SI(bitsz(__uint16_t)), 0, NULL,
+	{ FLDT_UINT16D, "uint16d", fp_num, "%u", SI(bitsz(uint16_t)), 0, NULL,
 	  NULL },
-	{ FLDT_UINT16O, "uint16o", fp_num, "%#o", SI(bitsz(__uint16_t)), 0,
+	{ FLDT_UINT16O, "uint16o", fp_num, "%#o", SI(bitsz(uint16_t)), 0,
 	  NULL, NULL },
-	{ FLDT_UINT16X, "uint16x", fp_num, "%#x", SI(bitsz(__uint16_t)), 0,
+	{ FLDT_UINT16X, "uint16x", fp_num, "%#x", SI(bitsz(uint16_t)), 0,
 	  NULL, NULL },
-	{ FLDT_UINT32D, "uint32d", fp_num, "%u", SI(bitsz(__uint32_t)), 0, NULL,
+	{ FLDT_UINT32D, "uint32d", fp_num, "%u", SI(bitsz(uint32_t)), 0, NULL,
 	  NULL },
-	{ FLDT_UINT32O, "uint32o", fp_num, "%#o", SI(bitsz(__uint32_t)), 0,
+	{ FLDT_UINT32O, "uint32o", fp_num, "%#o", SI(bitsz(uint32_t)), 0,
 	  NULL, NULL },
-	{ FLDT_UINT32X, "uint32x", fp_num, "%#x", SI(bitsz(__uint32_t)), 0,
+	{ FLDT_UINT32X, "uint32x", fp_num, "%#x", SI(bitsz(uint32_t)), 0,
 	  NULL, NULL },
-	{ FLDT_UINT64D, "uint64d", fp_num, "%llu", SI(bitsz(__uint64_t)), 0,
+	{ FLDT_UINT64D, "uint64d", fp_num, "%llu", SI(bitsz(uint64_t)), 0,
 	  NULL, NULL },
-	{ FLDT_UINT64O, "uint64o", fp_num, "%#llo", SI(bitsz(__uint64_t)), 0,
+	{ FLDT_UINT64O, "uint64o", fp_num, "%#llo", SI(bitsz(uint64_t)), 0,
 	  NULL, NULL },
-	{ FLDT_UINT64X, "uint64x", fp_num, "%#llx", SI(bitsz(__uint64_t)), 0,
+	{ FLDT_UINT64X, "uint64x", fp_num, "%#llx", SI(bitsz(uint64_t)), 0,
 	  NULL, NULL },
-	{ FLDT_UINT8D, "uint8d", fp_num, "%u", SI(bitsz(__uint8_t)), 0, NULL,
+	{ FLDT_UINT8D, "uint8d", fp_num, "%u", SI(bitsz(uint8_t)), 0, NULL,
 	  NULL },
-	{ FLDT_UINT8O, "uint8o", fp_num, "%#o", SI(bitsz(__uint8_t)), 0, NULL,
+	{ FLDT_UINT8O, "uint8o", fp_num, "%#o", SI(bitsz(uint8_t)), 0, NULL,
 	  NULL },
-	{ FLDT_UINT8X, "uint8x", fp_num, "%#x", SI(bitsz(__uint8_t)), 0, NULL,
+	{ FLDT_UINT8X, "uint8x", fp_num, "%#x", SI(bitsz(uint8_t)), 0, NULL,
 	  NULL },
 	{ FLDT_UUID, "uuid", fp_uuid, NULL, SI(bitsz(uuid_t)), 0, NULL, NULL },
 	{ FLDT_ZZZ, NULL }
diff -urpN xfsprogs-4.9.0/db/field.h xfsprogs-4.14.0/db/field.h
--- xfsprogs-4.9.0/db/field.h	2016-12-13 21:07:01.000000000 +0100
+++ xfsprogs-4.14.0/db/field.h	2017-11-20 01:14:14.000000000 +0100
@@ -44,8 +44,10 @@ typedef enum fldt	{
 
 	/* attr 3 specific fields */
 	FLDT_ATTR3,
+	FLDT_ATTR3_BLKINFO,
 	FLDT_ATTR3_LEAF_HDR,
 	FLDT_ATTR3_NODE_HDR,
+	FLDT_ATTR3_REMOTE_HDR,
 
 	FLDT_BMAPBTA,
 	FLDT_BMAPBTA_CRC,
diff -urpN xfsprogs-4.9.0/db/fprint.c xfsprogs-4.14.0/db/fprint.c
--- xfsprogs-4.9.0/db/fprint.c	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/db/fprint.c	2017-11-20 01:14:14.000000000 +0100
@@ -80,7 +80,7 @@ fp_num(
 	int		bitpos;
 	int		i;
 	int		isnull;
-	__int64_t	val;
+	int64_t		val;
 
 	for (i = 0, bitpos = bit;
 	     i < count && !seenint();
@@ -100,7 +100,7 @@ fp_num(
 		else if (size > 32)
 			dbprintf(fmtstr, val);
 		else
-			dbprintf(fmtstr, (__int32_t)val);
+			dbprintf(fmtstr, (int32_t)val);
 		if (i < count - 1)
 			dbprintf(" ");
 	}
@@ -203,7 +203,7 @@ fp_crc(
 {
 	int		bitpos;
 	int		i;
-	__int64_t	val;
+	int64_t		val;
 	char		*ok;
 
 	switch (iocur_crc_valid()) {
@@ -230,7 +230,7 @@ fp_crc(
 		if (size > 32)
 			dbprintf(fmtstr, val, ok);
 		else
-			dbprintf(fmtstr, (__int32_t)val, ok);
+			dbprintf(fmtstr, (int32_t)val, ok);
 		if (i < count - 1)
 			dbprintf(" ");
 	}
diff -urpN xfsprogs-4.9.0/db/frag.c xfsprogs-4.14.0/db/frag.c
--- xfsprogs-4.9.0/db/frag.c	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/db/frag.c	2017-11-20 01:14:14.000000000 +0100
@@ -42,8 +42,8 @@ typedef	struct extmap {
 
 static int		aflag;
 static int		dflag;
-static __uint64_t	extcount_actual;
-static __uint64_t	extcount_ideal;
+static uint64_t	extcount_actual;
+static uint64_t	extcount_ideal;
 static int		fflag;
 static int		lflag;
 static int		qflag;
@@ -310,8 +310,8 @@ process_inode(
 	xfs_agino_t		agino,
 	xfs_dinode_t		*dip)
 {
-	__uint64_t		actual;
-	__uint64_t		ideal;
+	uint64_t		actual;
+	uint64_t		ideal;
 	xfs_ino_t		ino;
 	int			skipa;
 	int			skipd;
diff -urpN xfsprogs-4.9.0/db/freesp.c xfsprogs-4.14.0/db/freesp.c
--- xfsprogs-4.9.0/db/freesp.c	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/db/freesp.c	2017-11-20 01:14:14.000000000 +0100
@@ -54,6 +54,7 @@ static int	usage(void);
 
 static int		agcount;
 static xfs_agnumber_t	*aglist;
+static int		alignment;
 static int		countflag;
 static int		dumpflag;
 static int		equalsize;
@@ -67,7 +68,7 @@ static long long	totexts;
 
 static const cmdinfo_t	freesp_cmd =
 	{ "freesp", NULL, freesp_f, 0, -1, 0,
-	  "[-bcdfs] [-a agno]... [-e binsize] [-h h1]... [-m binmult]",
+	  "[-bcdfs] [-A alignment] [-a agno]... [-e binsize] [-h h1]... [-m binmult]",
 	  "summarize free space for filesystem", NULL };
 
 static int
@@ -147,8 +148,11 @@ init(
 	totblocks = totexts = 0;
 	aglist = NULL;
 	hist = NULL;
-	while ((c = getopt(argc, argv, "a:bcde:h:m:s")) != EOF) {
+	while ((c = getopt(argc, argv, "A:a:bcde:h:m:s")) != EOF) {
 		switch (c) {
+		case 'A':
+			alignment = atoi(optarg);
+			break;
 		case 'a':
 			aglistadd(optarg);
 			break;
@@ -372,6 +376,9 @@ addtohist(
 {
 	int		i;
 
+	if (alignment && (XFS_AGB_TO_FSB(mp,agno,agbno) % alignment))
+		return;
+
 	if (dumpflag)
 		dbprintf("%8d %8d %8d\n", agno, agbno, len);
 	totexts++;
diff -urpN xfsprogs-4.9.0/db/fuzz.c xfsprogs-4.14.0/db/fuzz.c
--- xfsprogs-4.9.0/db/fuzz.c	1970-01-01 01:00:00.000000000 +0100
+++ xfsprogs-4.14.0/db/fuzz.c	2017-11-20 01:14:14.000000000 +0100
@@ -0,0 +1,463 @@
+/*
+ * Copyright (c) 2000-2002,2005 Silicon Graphics, Inc.
+ * All Rights Reserved.
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License as
+ * published by the Free Software Foundation.
+ *
+ * This program is distributed in the hope that it would be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write the Free Software Foundation,
+ * Inc.,  51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
+ */
+
+#include "libxfs.h"
+#include <ctype.h>
+#include <time.h>
+#include "bit.h"
+#include "block.h"
+#include "command.h"
+#include "type.h"
+#include "faddr.h"
+#include "fprint.h"
+#include "field.h"
+#include "flist.h"
+#include "io.h"
+#include "init.h"
+#include "output.h"
+#include "print.h"
+#include "write.h"
+#include "malloc.h"
+
+static int	fuzz_f(int argc, char **argv);
+static void     fuzz_help(void);
+
+static const cmdinfo_t	fuzz_cmd =
+	{ "fuzz", NULL, fuzz_f, 0, -1, 0, N_("[-c] [-d] field fuzzcmd..."),
+	  N_("fuzz values on disk"), fuzz_help };
+
+void
+fuzz_init(void)
+{
+	if (!expert_mode)
+		return;
+
+	add_command(&fuzz_cmd);
+	srand48(clock());
+}
+
+static void
+fuzz_help(void)
+{
+	dbprintf(_(
+"\n"
+" The 'fuzz' command fuzzes fields in any on-disk data structure.  For\n"
+" block fuzzing, see the 'blocktrash' or 'write' commands."
+"\n"
+" Examples:\n"
+"  Struct mode: 'fuzz core.uid zeroes'    - set an inode uid field to 0.\n"
+"               'fuzz crc ones'           - set a crc filed to all ones.\n"
+"               'fuzz bno[11] firstbit'   - set the high bit of a block array.\n"
+"               'fuzz keys[5].startblock add'    - increase a btree key value.\n"
+"               'fuzz uuid random'        - randomize the superblock uuid.\n"
+"\n"
+" Type 'fuzz' by itself for a list of specific commands.\n\n"
+" Specifying the -c option will allow writes of invalid (corrupt) data with\n"
+" an invalid CRC. Specifying the -d option will allow writes of invalid data,\n"
+" but still recalculate the CRC so we are forced to check and detect the\n"
+" invalid data appropriately.\n\n"
+));
+
+}
+
+static int
+fuzz_f(
+	int		argc,
+	char		**argv)
+{
+	pfunc_t	pf;
+	extern char *progname;
+	int c;
+	bool corrupt = false;	/* Allow write of bad data w/ invalid CRC */
+	bool invalid_data = false; /* Allow write of bad data w/ valid CRC */
+	struct xfs_buf_ops local_ops;
+	const struct xfs_buf_ops *stashed_ops = NULL;
+
+	if (x.isreadonly & LIBXFS_ISREADONLY) {
+		dbprintf(_("%s started in read only mode, fuzzing disabled\n"),
+			progname);
+		return 0;
+	}
+
+	if (cur_typ == NULL) {
+		dbprintf(_("no current type\n"));
+		return 0;
+	}
+
+	pf = cur_typ->pfunc;
+	if (pf == NULL) {
+		dbprintf(_("no handler function for type %s, fuzz unsupported.\n"),
+			 cur_typ->name);
+		return 0;
+	}
+
+	while ((c = getopt(argc, argv, "cd")) != EOF) {
+		switch (c) {
+		case 'c':
+			corrupt = true;
+			break;
+		case 'd':
+			invalid_data = true;
+			break;
+		default:
+			dbprintf(_("bad option for fuzz command\n"));
+			return 0;
+		}
+	}
+
+	if (corrupt && invalid_data) {
+		dbprintf(_("Cannot specify both -c and -d options\n"));
+		return 0;
+	}
+
+	if (invalid_data &&
+	    iocur_top->typ->crc_off == TYP_F_NO_CRC_OFF &&
+	    xfs_sb_version_hascrc(&mp->m_sb)) {
+		dbprintf(_("Cannot recalculate CRCs on this type of object\n"));
+		return 0;
+	}
+
+	argc -= optind;
+	argv += optind;
+
+	/*
+	 * If the buffer has no verifier or we are using standard verifier
+	 * paths, then just fuzz it and return
+	 */
+	if (!iocur_top->bp->b_ops ||
+	    !(corrupt || invalid_data)) {
+		(*pf)(DB_FUZZ, cur_typ->fields, argc, argv);
+		return 0;
+	}
+
+
+	/* Temporarily remove write verifier to write bad data */
+	stashed_ops = iocur_top->bp->b_ops;
+	local_ops.verify_read = stashed_ops->verify_read;
+	iocur_top->bp->b_ops = &local_ops;
+
+	if (!xfs_sb_version_hascrc(&mp->m_sb)) {
+		local_ops.verify_write = xfs_dummy_verify;
+	} else if (corrupt) {
+		local_ops.verify_write = xfs_dummy_verify;
+		dbprintf(_("Allowing fuzz of corrupted data and bad CRC\n"));
+	} else if (iocur_top->typ->crc_off == TYP_F_CRC_FUNC) {
+		local_ops.verify_write = iocur_top->typ->set_crc;
+		dbprintf(_("Allowing fuzz of corrupted data with good CRC\n"));
+	} else { /* invalid data */
+		local_ops.verify_write = xfs_verify_recalc_crc;
+		dbprintf(_("Allowing fuzz of corrupted data with good CRC\n"));
+	}
+
+	(*pf)(DB_FUZZ, cur_typ->fields, argc, argv);
+
+	iocur_top->bp->b_ops = stashed_ops;
+
+	return 0;
+}
+
+/* Write zeroes to the field */
+static bool
+fuzz_zeroes(
+	void		*buf,
+	int		bitoff,
+	int		nbits)
+{
+	char		*out = buf;
+	int		bit;
+
+	if (bitoff % NBBY || nbits % NBBY) {
+		for (bit = 0; bit < nbits; bit++)
+			setbit_l(out, bit + bitoff, 0);
+	} else
+		memset(out + byteize(bitoff), 0, byteize(nbits));
+	return true;
+}
+
+/* Write ones to the field */
+static bool
+fuzz_ones(
+	void		*buf,
+	int		bitoff,
+	int		nbits)
+{
+	char		*out = buf;
+	int		bit;
+
+	if (bitoff % NBBY || nbits % NBBY) {
+		for (bit = 0; bit < nbits; bit++)
+			setbit_l(out, bit + bitoff, 1);
+	} else
+		memset(out + byteize(bitoff), 0xFF, byteize(nbits));
+	return true;
+}
+
+/* Flip the high bit in the (presumably big-endian) field */
+static bool
+fuzz_firstbit(
+	void		*buf,
+	int		bitoff,
+	int		nbits)
+{
+	setbit_l((char *)buf, bitoff, !getbit_l((char *)buf, bitoff));
+	return true;
+}
+
+/* Flip the low bit in the (presumably big-endian) field */
+static bool
+fuzz_lastbit(
+	void		*buf,
+	int		bitoff,
+	int		nbits)
+{
+	setbit_l((char *)buf, bitoff + nbits - 1,
+			!getbit_l((char *)buf, bitoff + nbits - 1));
+	return true;
+}
+
+/* Flip the middle bit in the (presumably big-endian) field */
+static bool
+fuzz_middlebit(
+	void		*buf,
+	int		bitoff,
+	int		nbits)
+{
+	setbit_l((char *)buf, bitoff + nbits / 2,
+			!getbit_l((char *)buf, bitoff + nbits / 2));
+	return true;
+}
+
+/* Format and shift a number into a buffer for setbitval. */
+static char *
+format_number(
+	uint64_t	val,
+	__be64		*out,
+	int		bit_length)
+{
+	int		offset;
+	char		*rbuf = (char *)out;
+
+	/*
+	 * If the length of the field is not a multiple of a byte, push
+	 * the bits up in the field, so the most signicant field bit is
+	 * the most significant bit in the byte:
+	 *
+	 * before:
+	 * val  |----|----|----|----|----|--MM|mmmm|llll|
+	 * after
+	 * val  |----|----|----|----|----|MMmm|mmll|ll00|
+	 */
+	offset = bit_length % NBBY;
+	if (offset)
+		val <<= (NBBY - offset);
+
+	/*
+	 * convert to big endian and copy into the array
+	 * rbuf |----|----|----|----|----|MMmm|mmll|ll00|
+	 */
+	*out = cpu_to_be64(val);
+
+	/*
+	 * Align the array to point to the field in the array.
+	 *  rbuf  = |MMmm|mmll|ll00|
+	 */
+	offset = sizeof(__be64) - 1 - ((bit_length - 1) / sizeof(__be64));
+	return rbuf + offset;
+}
+
+/* Increase the value by some small prime number. */
+static bool
+fuzz_add(
+	void		*buf,
+	int		bitoff,
+	int		nbits)
+{
+	uint64_t	val;
+	__be64		out;
+	char		*b;
+
+	if (nbits > 64)
+		return false;
+
+	val = getbitval(buf, bitoff, nbits, BVUNSIGNED);
+	val += (nbits > 8 ? 2017 : 137);
+	b = format_number(val, &out, nbits);
+	setbitval(buf, bitoff, nbits, b);
+
+	return true;
+}
+
+/* Decrease the value by some small prime number. */
+static bool
+fuzz_sub(
+	void		*buf,
+	int		bitoff,
+	int		nbits)
+{
+	uint64_t	val;
+	__be64		out;
+	char		*b;
+
+	if (nbits > 64)
+		return false;
+
+	val = getbitval(buf, bitoff, nbits, BVUNSIGNED);
+	val -= (nbits > 8 ? 2017 : 137);
+	b = format_number(val, &out, nbits);
+	setbitval(buf, bitoff, nbits, b);
+
+	return true;
+}
+
+/* Randomize the field. */
+static bool
+fuzz_random(
+	void		*buf,
+	int		bitoff,
+	int		nbits)
+{
+	int		i, bytes;
+	char		*b, *rbuf;
+
+	bytes = byteize_up(nbits);
+	rbuf = b = malloc(bytes);
+	if (!b) {
+		perror("fuzz_random");
+		return false;
+	}
+
+	for (i = 0; i < bytes; i++)
+		*b++ = (char)lrand48();
+
+	setbitval(buf, bitoff, nbits, rbuf);
+	free(rbuf);
+
+	return true;
+}
+
+struct fuzzcmd {
+	const char	*verb;
+	bool		(*fn)(void *buf, int bitoff, int nbits);
+};
+
+/* Keep these verbs in sync with enum fuzzcmds. */
+static struct fuzzcmd fuzzverbs[] = {
+	{"zeroes",		fuzz_zeroes},
+	{"ones",		fuzz_ones},
+	{"firstbit",		fuzz_firstbit},
+	{"middlebit",		fuzz_middlebit},
+	{"lastbit",		fuzz_lastbit},
+	{"add",			fuzz_add},
+	{"sub",			fuzz_sub},
+	{"random",		fuzz_random},
+	{NULL,			NULL},
+};
+
+/* ARGSUSED */
+void
+fuzz_struct(
+	const field_t	*fields,
+	int		argc,
+	char		**argv)
+{
+	const ftattr_t	*fa;
+	flist_t		*fl;
+	flist_t		*sfl;
+	int		bit_length;
+	struct fuzzcmd	*fc;
+	bool		success;
+	int		parentoffset;
+
+	if (argc != 2) {
+		dbprintf(_("Usage: fuzz fieldname fuzzcmd\n"));
+		dbprintf("Fuzz commands: %s", fuzzverbs->verb);
+		for (fc = fuzzverbs + 1; fc->verb != NULL; fc++)
+			dbprintf(", %s", fc->verb);
+		dbprintf(".\n");
+		return;
+	}
+
+	fl = flist_scan(argv[0]);
+	if (!fl) {
+		dbprintf(_("unable to parse '%s'.\n"), argv[0]);
+		return;
+	}
+
+	/* Find our fuzz verb */
+	for (fc = fuzzverbs; fc->verb != NULL; fc++)
+		if (!strcmp(fc->verb, argv[1]))
+			break;
+	if (fc->fn == NULL) {
+		dbprintf(_("Unknown fuzz command '%s'.\n"), argv[1]);
+		goto out_free;
+	}
+
+	/* if we're a root field type, go down 1 layer to get field list */
+	if (fields->name[0] == '\0') {
+		fa = &ftattrtab[fields->ftyp];
+		ASSERT(fa->ftyp == fields->ftyp);
+		fields = fa->subfld;
+	}
+
+	/* run down the field list and set offsets into the data */
+	if (!flist_parse(fields, fl, iocur_top->data, 0)) {
+		dbprintf(_("parsing error\n"));
+		goto out_free;
+	}
+
+	sfl = fl;
+	parentoffset = 0;
+	while (sfl->child) {
+		parentoffset = sfl->offset;
+		sfl = sfl->child;
+	}
+
+	/*
+	 * For structures, fsize * fcount tells us the size of the region we are
+	 * modifying, which is usually a single structure member and is pointed
+	 * to by the last child in the list.
+	 *
+	 * However, if the base structure is an array and we have a direct index
+	 * into the array (e.g. write bno[5]) then we are returned a single
+	 * flist object with the offset pointing directly at the location we
+	 * need to modify. The length of the object we are modifying is then
+	 * determined by the size of the individual array entry (fsize) and the
+	 * indexes defined in the object, not the overall size of the array
+	 * (which is what fcount returns).
+	 */
+	bit_length = fsize(sfl->fld, iocur_top->data, parentoffset, 0);
+	if (sfl->fld->flags & FLD_ARRAY)
+		bit_length *= sfl->high - sfl->low + 1;
+	else
+		bit_length *= fcount(sfl->fld, iocur_top->data, parentoffset);
+
+	/* Fuzz the value */
+	success = fc->fn(iocur_top->data, sfl->offset, bit_length);
+	if (!success) {
+		dbprintf(_("unable to fuzz field '%s'\n"), argv[0]);
+		goto out_free;
+	}
+
+	/* Write the fuzzed value back */
+	write_cur();
+
+	flist_print(fl);
+	print_flist(fl);
+out_free:
+	flist_free(fl);
+}
diff -urpN xfsprogs-4.9.0/db/fuzz.h xfsprogs-4.14.0/db/fuzz.h
--- xfsprogs-4.9.0/db/fuzz.h	1970-01-01 01:00:00.000000000 +0100
+++ xfsprogs-4.14.0/db/fuzz.h	2017-11-20 01:14:14.000000000 +0100
@@ -0,0 +1,21 @@
+/*
+ * Copyright (C) 2017 Oracle.  All Rights Reserved.
+ *
+ * Author: Darrick J. Wong <darrick.wong@oracle.com>
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *
+ * This program is distributed in the hope that it would be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write the Free Software Foundation,
+ * Inc.,  51 Franklin St, Fifth Floor, Boston, MA  02110-1301, USA.
+ */
+extern void	fuzz_init(void);
+extern void	fuzz_struct(const field_t *fields, int argc, char **argv);
diff -urpN xfsprogs-4.9.0/db/init.c xfsprogs-4.14.0/db/init.c
--- xfsprogs-4.9.0/db/init.c	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/db/init.c	2017-11-20 01:14:14.000000000 +0100
@@ -58,6 +58,7 @@ init(
 {
 	struct xfs_sb	*sbp;
 	struct xfs_buf	*bp;
+	unsigned int	agcount;
 	int		c;
 
 	setlocale(LC_ALL, "");
@@ -148,6 +149,7 @@ init(
 		}
 	}
 
+	agcount = sbp->sb_agcount;
 	mp = libxfs_mount(&xmount, sbp, x.ddev, x.logdev, x.rtdev,
 			  LIBXFS_MOUNT_DEBUGGER);
 	if (!mp) {
@@ -159,6 +161,10 @@ init(
 	mp->m_log = &xlog;
 	blkbb = 1 << mp->m_blkbb_log;
 
+	/* Did we limit a broken agcount in libxfs_mount? */
+	if (sbp->sb_agcount != agcount)
+		exitcode = 1;
+
 	/*
 	 * xfs_check needs corrected incore superblock values
 	 */
@@ -192,7 +198,6 @@ main(
 	char	**v;
 	int	start_iocur_sp;
 
-	pushfile(stdin);
 	init(argc, argv);
 	start_iocur_sp = iocur_sp;
 
@@ -207,6 +212,7 @@ main(
 		goto close_devices;
 	}
 
+	pushfile(stdin);
 	while (!done) {
 		if ((input = fetchline()) == NULL)
 			break;
diff -urpN xfsprogs-4.9.0/db/inode.c xfsprogs-4.14.0/db/inode.c
--- xfsprogs-4.9.0/db/inode.c	2016-12-13 21:07:01.000000000 +0100
+++ xfsprogs-4.14.0/db/inode.c	2017-11-20 01:14:14.000000000 +0100
@@ -119,49 +119,49 @@ const field_t	inode_core_flds[] = {
 	{ "dmstate", FLDT_UINT16D, OI(COFF(dmstate)), C1, 0, TYP_NONE },
 	{ "flags", FLDT_UINT16X, OI(COFF(flags)), C1, FLD_SKIPALL, TYP_NONE },
 	{ "newrtbm", FLDT_UINT1,
-	  OI(COFF(flags) + bitsz(__uint16_t) - XFS_DIFLAG_NEWRTBM_BIT - 1), C1,
+	  OI(COFF(flags) + bitsz(uint16_t) - XFS_DIFLAG_NEWRTBM_BIT - 1), C1,
 	  0, TYP_NONE },
 	{ "prealloc", FLDT_UINT1,
-	  OI(COFF(flags) + bitsz(__uint16_t) - XFS_DIFLAG_PREALLOC_BIT - 1), C1,
+	  OI(COFF(flags) + bitsz(uint16_t) - XFS_DIFLAG_PREALLOC_BIT - 1), C1,
 	  0, TYP_NONE },
 	{ "realtime", FLDT_UINT1,
-	  OI(COFF(flags) + bitsz(__uint16_t) - XFS_DIFLAG_REALTIME_BIT - 1), C1,
+	  OI(COFF(flags) + bitsz(uint16_t) - XFS_DIFLAG_REALTIME_BIT - 1), C1,
 	  0, TYP_NONE },
 	{ "immutable", FLDT_UINT1,
-	  OI(COFF(flags) + bitsz(__uint16_t) - XFS_DIFLAG_IMMUTABLE_BIT-1), C1,
+	  OI(COFF(flags) + bitsz(uint16_t) - XFS_DIFLAG_IMMUTABLE_BIT-1), C1,
 	  0, TYP_NONE },
 	{ "append", FLDT_UINT1,
-	  OI(COFF(flags) + bitsz(__uint16_t) - XFS_DIFLAG_APPEND_BIT - 1), C1,
+	  OI(COFF(flags) + bitsz(uint16_t) - XFS_DIFLAG_APPEND_BIT - 1), C1,
 	  0, TYP_NONE },
 	{ "sync", FLDT_UINT1,
-	  OI(COFF(flags) + bitsz(__uint16_t) - XFS_DIFLAG_SYNC_BIT - 1), C1,
+	  OI(COFF(flags) + bitsz(uint16_t) - XFS_DIFLAG_SYNC_BIT - 1), C1,
 	  0, TYP_NONE },
 	{ "noatime", FLDT_UINT1,
-	  OI(COFF(flags) + bitsz(__uint16_t) - XFS_DIFLAG_NOATIME_BIT - 1), C1,
+	  OI(COFF(flags) + bitsz(uint16_t) - XFS_DIFLAG_NOATIME_BIT - 1), C1,
 	  0, TYP_NONE },
 	{ "nodump", FLDT_UINT1,
-	  OI(COFF(flags) + bitsz(__uint16_t) - XFS_DIFLAG_NODUMP_BIT - 1), C1,
+	  OI(COFF(flags) + bitsz(uint16_t) - XFS_DIFLAG_NODUMP_BIT - 1), C1,
 	  0, TYP_NONE },
 	{ "rtinherit", FLDT_UINT1,
-	  OI(COFF(flags) + bitsz(__uint16_t) - XFS_DIFLAG_RTINHERIT_BIT-1), C1,
+	  OI(COFF(flags) + bitsz(uint16_t) - XFS_DIFLAG_RTINHERIT_BIT-1), C1,
 	  0, TYP_NONE },
 	{ "projinherit", FLDT_UINT1,
-	  OI(COFF(flags) + bitsz(__uint16_t) - XFS_DIFLAG_PROJINHERIT_BIT-1),C1,
+	  OI(COFF(flags) + bitsz(uint16_t) - XFS_DIFLAG_PROJINHERIT_BIT-1), C1,
 	  0, TYP_NONE },
 	{ "nosymlinks", FLDT_UINT1,
-	  OI(COFF(flags) + bitsz(__uint16_t) - XFS_DIFLAG_NOSYMLINKS_BIT-1), C1,
+	  OI(COFF(flags) + bitsz(uint16_t) - XFS_DIFLAG_NOSYMLINKS_BIT-1), C1,
 	  0, TYP_NONE },
 	{ "extsz", FLDT_UINT1,
-	  OI(COFF(flags) + bitsz(__uint16_t) - XFS_DIFLAG_EXTSIZE_BIT-1),C1,
+	  OI(COFF(flags) + bitsz(uint16_t) - XFS_DIFLAG_EXTSIZE_BIT-1), C1,
 	  0, TYP_NONE },
 	{ "extszinherit", FLDT_UINT1,
-	  OI(COFF(flags) + bitsz(__uint16_t) - XFS_DIFLAG_EXTSZINHERIT_BIT-1),C1,
+	  OI(COFF(flags) + bitsz(uint16_t) - XFS_DIFLAG_EXTSZINHERIT_BIT-1), C1,
 	  0, TYP_NONE },
 	{ "nodefrag", FLDT_UINT1,
-	  OI(COFF(flags) + bitsz(__uint16_t) - XFS_DIFLAG_NODEFRAG_BIT-1),C1,
+	  OI(COFF(flags) + bitsz(uint16_t) - XFS_DIFLAG_NODEFRAG_BIT-1), C1,
 	  0, TYP_NONE },
 	{ "filestream", FLDT_UINT1,
-	  OI(COFF(flags) + bitsz(__uint16_t) - XFS_DIFLAG_FILESTREAM_BIT-1),C1,
+	  OI(COFF(flags) + bitsz(uint16_t) - XFS_DIFLAG_FILESTREAM_BIT-1), C1,
 	  0, TYP_NONE },
 	{ "gen", FLDT_UINT32D, OI(COFF(gen)), C1, 0, TYP_NONE },
 	{ NULL }
@@ -177,10 +177,10 @@ const field_t	inode_v3_flds[] = {
 	{ "inumber", FLDT_INO, OI(COFF(ino)), C1, 0, TYP_NONE },
 	{ "uuid", FLDT_UUID, OI(COFF(uuid)), C1, 0, TYP_NONE },
 	{ "reflink", FLDT_UINT1,
-	  OI(COFF(flags2) + bitsz(__uint64_t) - XFS_DIFLAG2_REFLINK_BIT-1), C1,
+	  OI(COFF(flags2) + bitsz(uint64_t) - XFS_DIFLAG2_REFLINK_BIT-1), C1,
 	  0, TYP_NONE },
 	{ "cowextsz", FLDT_UINT1,
-	  OI(COFF(flags2) + bitsz(__uint64_t) - XFS_DIFLAG2_COWEXTSIZE_BIT-1), C1,
+	  OI(COFF(flags2) + bitsz(uint64_t) - XFS_DIFLAG2_COWEXTSIZE_BIT-1), C1,
 	  0, TYP_NONE },
 	{ NULL }
 };
@@ -238,7 +238,7 @@ fp_dinode_fmt(
 	int			i;
 
 	for (i = 0, bitpos = bit; i < count; i++, bitpos += size) {
-		f = (xfs_dinode_fmt_t)getbitval(obj, bitpos, size, BVSIGNED);
+		f = (xfs_dinode_fmt_t)getbitval(obj, bitpos, size, BVUNSIGNED);
 		if (array)
 			dbprintf("%d:", i + base);
 		if (f < 0 || f >= dinode_fmt_name_size)
@@ -711,3 +711,14 @@ _("Metadata CRC error detected for ino %
 	/* track updated info in ring */
 	ring_add();
 }
+
+void
+xfs_inode_set_crc(
+	struct xfs_buf *bp)
+{
+	ASSERT(iocur_top->ino_buf);
+	ASSERT(iocur_top->bp == bp);
+
+	libxfs_dinode_calc_crc(mp, iocur_top->data);
+	iocur_top->ino_crc_ok = 1;
+}
diff -urpN xfsprogs-4.9.0/db/inode.h xfsprogs-4.14.0/db/inode.h
--- xfsprogs-4.9.0/db/inode.h	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/db/inode.h	2017-11-20 01:14:14.000000000 +0100
@@ -33,4 +33,5 @@ extern void	inode_init(void);
 extern typnm_t	inode_next_type(void);
 extern int	inode_size(void *obj, int startoff, int idx);
 extern int	inode_u_size(void *obj, int startoff, int idx);
+extern void	xfs_inode_set_crc(struct xfs_buf *);
 extern void	set_cur_inode(xfs_ino_t ino);
diff -urpN xfsprogs-4.9.0/db/input.c xfsprogs-4.14.0/db/input.c
--- xfsprogs-4.9.0/db/input.c	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/db/input.c	2017-11-20 01:14:14.000000000 +0100
@@ -156,7 +156,7 @@ fetchline_internal(void)
 
 	rval = NULL;
 	for (rlen = iscont = 0; ; ) {
-		if (inputstacksize == 1) {
+		if (curinput == stdin) {
 			if (iscont)
 				dbprintf("... ");
 			else
@@ -181,18 +181,24 @@ fetchline_internal(void)
 		}
 		if (ferror(curinput) || feof(curinput) ||
 		    (len = strlen(buf)) == 0) {
-			popfile();
-			if (curinput == NULL) {
+			/*
+			 * No more input at this inputstack level; pop
+			 * our fd off and return so that a lower
+			 * level fetchline can handle us.  If this was
+			 * an interactive session, print a newline
+			 * because ^D doesn't emit one.
+			 */
+			if (curinput == stdin)
 				dbprintf("\n");
-				return NULL;
-			}
+
+			popfile();
 			iscont = 0;
 			rlen = 0;
 			if (rval) {
 				xfree(rval);
 				rval = NULL;
 			}
-			continue;
+			return NULL;
 		}
 		if (inputstacksize == 1)
 			logprintf("%s", buf);
@@ -225,7 +231,9 @@ fetchline(void)
 
 	if (inputstacksize == 1) {
 		line = readline(get_prompt());
-		if (line && *line) {
+		if (!line)
+			dbprintf("\n");
+		else if (line && *line) {
 			add_history(line);
 			logprintf("%s", line);
 		}
@@ -314,12 +322,27 @@ source_f(
 	char	**argv)
 {
 	FILE	*f;
+	int	c, done = 0;
+	char	*input;
+	char	**v;
 
 	f = fopen(argv[1], "r");
-	if (f == NULL)
+	if (f == NULL) {
 		dbprintf(_("can't open %s\n"), argv[0]);
-	else
-		pushfile(f);
+		return 0;
+	}
+
+	/* Run the sourced commands now. */
+	pushfile(f);
+	while (!done) {
+		if ((input = fetchline_internal()) == NULL)
+			break;
+		v = breakline(input, &c);
+		if (c)
+			done = command(c, v);
+		doneline(input, v);
+	}
+
 	return 0;
 }
 
diff -urpN xfsprogs-4.9.0/db/io.c xfsprogs-4.14.0/db/io.c
--- xfsprogs-4.9.0/db/io.c	2017-01-05 18:41:55.000000000 +0100
+++ xfsprogs-4.14.0/db/io.c	2017-11-20 01:14:14.000000000 +0100
@@ -22,12 +22,14 @@
 #include "faddr.h"
 #include "fprint.h"
 #include "field.h"
+#include "dquot.h"
 #include "inode.h"
 #include "io.h"
 #include "output.h"
 #include "init.h"
 #include "malloc.h"
 #include "crc.h"
+#include "bit.h"
 
 static int	pop_f(int argc, char **argv);
 static void     pop_help(void);
@@ -219,6 +221,19 @@ push_cur(void)
 	cur_typ = NULL;
 }
 
+void
+push_cur_and_set_type(void)
+{
+	/* save current state */
+	push_cur();
+	if (iocur_top[-1].typ && iocur_top[-1].typ->typnm == TYP_INODE)
+		set_cur_inode(iocur_top[-1].ino);
+	else
+		set_cur(iocur_top[-1].typ, iocur_top[-1].bb,
+			iocur_top[-1].blen, DB_RING_IGN,
+			iocur_top[-1].bbmap);
+}
+
 static int
 push_f(
 	int		argc,
@@ -239,14 +254,7 @@ push_f(
 		}
 	}
 
-	/* save current state */
-	push_cur();
-	if (iocur_top[-1].typ && iocur_top[-1].typ->typnm == TYP_INODE)
-		set_cur_inode(iocur_top[-1].ino);
-	else
-		set_cur(iocur_top[-1].typ, iocur_top[-1].bb,
-			iocur_top[-1].blen, DB_RING_IGN,
-			iocur_top[-1].bbmap);
+	push_cur_and_set_type();
 
 	/* run requested command */
 	if (argc>1)
@@ -487,14 +495,10 @@ write_cur(void)
 		skip_crc = true;
 
 	if (!skip_crc) {
-		if (iocur_top->ino_buf) {
-			libxfs_dinode_calc_crc(mp, iocur_top->data);
-			iocur_top->ino_crc_ok = 1;
-		} else if (iocur_top->dquot_buf) {
-			xfs_update_cksum(iocur_top->data,
-					 sizeof(struct xfs_dqblk),
-					 XFS_DQUOT_CRC_OFF);
-		}
+		if (iocur_top->ino_buf)
+			xfs_inode_set_crc(iocur_top->bp);
+		else if (iocur_top->dquot_buf)
+			xfs_dquot_set_crc(iocur_top->bp);
 	}
 	if (iocur_top->bbmap)
 		write_cur_bbs();
@@ -504,7 +508,7 @@ write_cur(void)
 	/* If we didn't write the crc automatically, re-check inode validity */
 	if (xfs_sb_version_hascrc(&mp->m_sb) &&
 	    skip_crc && iocur_top->ino_buf) {
-		iocur_top->ino_crc_ok = xfs_verify_cksum(iocur_top->data,
+		iocur_top->ino_crc_ok = libxfs_verify_cksum(iocur_top->data,
 						mp->m_sb.sb_inodesize,
 						XFS_DINODE_CRC_OFF);
 	}
@@ -513,24 +517,23 @@ write_cur(void)
 
 void
 set_cur(
-	const typ_t	*t,
-	__int64_t	d,
-	int		c,
+	const typ_t	*type,
+	xfs_daddr_t	blknum,
+	int		len,
 	int		ring_flag,
 	bbmap_t		*bbmap)
 {
 	struct xfs_buf	*bp;
 	xfs_ino_t	dirino;
 	xfs_ino_t	ino;
-	__uint16_t	mode;
-	const struct xfs_buf_ops *ops = t ? t->bops : NULL;
+	uint16_t	mode;
+	const struct xfs_buf_ops *ops = type ? type->bops : NULL;
 
 	if (iocur_sp < 0) {
 		dbprintf(_("set_cur no stack element to set\n"));
 		return;
 	}
 
-
 	ino = iocur_top->ino;
 	dirino = iocur_top->dirino;
 	mode = iocur_top->mode;
@@ -540,7 +543,7 @@ set_cur(
 	if (bbmap) {
 #ifdef DEBUG_BBMAP
 		int i;
-		printf(_("xfs_db got a bbmap for %lld\n"), (long long)d);
+		printf(_("xfs_db got a bbmap for %lld\n"), (long long)blknum);
 		printf(_("\tblock map"));
 		for (i = 0; i < bbmap->nmaps; i++)
 			printf(" %lld:%d", (long long)bbmap->b[i].bm_bn,
@@ -554,7 +557,7 @@ set_cur(
 		bp = libxfs_readbuf_map(mp->m_ddev_targp, bbmap->b,
 					bbmap->nmaps, 0, ops);
 	} else {
-		bp = libxfs_readbuf(mp->m_ddev_targp, d, c, 0, ops);
+		bp = libxfs_readbuf(mp->m_ddev_targp, blknum, len, 0, ops);
 		iocur_top->bbmap = NULL;
 	}
 
@@ -570,13 +573,13 @@ set_cur(
 	if (!ops)
 		bp->b_flags |= LIBXFS_B_UNCHECKED;
 
-	iocur_top->bb = d;
-	iocur_top->blen = c;
+	iocur_top->bb = blknum;
+	iocur_top->blen = len;
 	iocur_top->boff = 0;
 	iocur_top->data = iocur_top->buf;
-	iocur_top->len = BBTOB(c);
-	iocur_top->off = d << BBSHIFT;
-	iocur_top->typ = cur_typ = t;
+	iocur_top->len = BBTOB(len);
+	iocur_top->off = blknum << BBSHIFT;
+	iocur_top->typ = cur_typ = type;
 	iocur_top->ino = ino;
 	iocur_top->dirino = dirino;
 	iocur_top->mode = mode;
@@ -590,16 +593,40 @@ set_cur(
 
 void
 set_iocur_type(
-	const typ_t	*t)
+	const typ_t	*type)
 {
 	struct xfs_buf	*bp = iocur_top->bp;
 
-	iocur_top->typ = t;
+	/* Inodes are special; verifier checks all inodes in the chunk */
+	if (type->typnm == TYP_INODE) {
+		xfs_daddr_t	b = iocur_top->bb;
+		xfs_ino_t	ino;
+
+		/*
+		 * Note that this will back up to the beginning of the inode
+ 		 * which contains the current disk location; daddr may change.
+ 		 */
+		ino = XFS_AGINO_TO_INO(mp, xfs_daddr_to_agno(mp, b),
+			((b << BBSHIFT) >> mp->m_sb.sb_inodelog) %
+			(mp->m_sb.sb_agblocks << mp->m_sb.sb_inopblog));
+		set_cur_inode(ino);
+		return;
+	}
+
+	/* adjust buffer size for types with fields & hence fsize() */
+	if (type->fields) {
+		int bb_count;	/* type's size in basic blocks */
+
+		bb_count = BTOBB(byteize(fsize(type->fields,
+					       iocur_top->data, 0, 0)));
+		set_cur(type, iocur_top->bb, bb_count, DB_RING_IGN, NULL);
+	}
+	iocur_top->typ = type;
 
 	/* verify the buffer if the type has one. */
 	if (!bp)
 		return;
-	if (!t->bops) {
+	if (!type->bops) {
 		bp->b_ops = NULL;
 		bp->b_flags |= LIBXFS_B_UNCHECKED;
 		return;
@@ -607,7 +634,7 @@ set_iocur_type(
 	if (!(bp->b_flags & LIBXFS_B_UPTODATE))
 		return;
 	bp->b_error = 0;
-	bp->b_ops = t->bops;
+	bp->b_ops = type->bops;
 	bp->b_ops->verify_read(bp);
 	bp->b_flags &= ~LIBXFS_B_UNCHECKED;
 }
diff -urpN xfsprogs-4.9.0/db/io.h xfsprogs-4.14.0/db/io.h
--- xfsprogs-4.9.0/db/io.h	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/db/io.h	2017-11-20 01:14:14.000000000 +0100
@@ -25,7 +25,7 @@ typedef struct bbmap {
 } bbmap_t;
 
 typedef struct iocur {
-	__int64_t		bb;	/* BB number in filesystem of buf */
+	int64_t			bb;	/* BB number in filesystem of buf */
 	int			blen;	/* length of "buf", bb's */
 	int			boff;	/* data - buf */
 	void			*buf;	/* base address of buffer */
@@ -33,7 +33,7 @@ typedef struct iocur {
 	xfs_ino_t		dirino;	/* current directory inode number */
 	xfs_ino_t		ino;	/* current inode number */
 	int			len;	/* length of "data", bytes */
-	__uint16_t		mode;	/* current inode's mode */
+	uint16_t		mode;	/* current inode's mode */
 	xfs_off_t		off;	/* fs offset of "data" in bytes */
 	const struct typ	*typ;	/* type of "data" */
 	bbmap_t			*bbmap;	/* map daddr if fragmented */
@@ -57,12 +57,13 @@ extern void	off_cur(int off, int len);
 extern void	pop_cur(void);
 extern void	print_iocur(char *tag, iocur_t *ioc);
 extern void	push_cur(void);
-extern int	read_buf(__int64_t daddr, int count, void *bufp);
+extern void	push_cur_and_set_type(void);
+extern int	read_buf(int64_t daddr, int count, void *bufp);
 extern void     write_cur(void);
-extern void	set_cur(const struct typ *t, __int64_t d, int c, int ring_add,
-			bbmap_t *bbmap);
+extern void	set_cur(const struct typ *type, xfs_daddr_t blknum,
+			int len, int ring_add, bbmap_t *bbmap);
 extern void     ring_add(void);
-extern void	set_iocur_type(const struct typ *t);
+extern void	set_iocur_type(const struct typ *type);
 extern void	xfs_dummy_verify(struct xfs_buf *bp);
 extern void	xfs_verify_recalc_crc(struct xfs_buf *bp);
 
diff -urpN xfsprogs-4.9.0/db/metadump.c xfsprogs-4.14.0/db/metadump.c
--- xfsprogs-4.9.0/db/metadump.c	2016-12-13 21:07:01.000000000 +0100
+++ xfsprogs-4.14.0/db/metadump.c	2017-11-27 17:57:55.000000000 +0100
@@ -32,7 +32,7 @@
 #include "field.h"
 #include "dir2.h"
 
-#define DEFAULT_MAX_EXT_SIZE	1000
+#define DEFAULT_MAX_EXT_SIZE	MAXEXTLEN
 
 /*
  * It's possible that multiple files in a directory (or attributes
@@ -78,6 +78,7 @@ static int		obfuscate = 1;
 static int		zero_stale_data = 1;
 static int		show_warnings = 0;
 static int		progress_since_warning = 0;
+static bool		stdout_metadump;
 
 void
 metadump_init(void)
@@ -137,7 +138,7 @@ print_progress(const char *fmt, ...)
 	va_end(ap);
 	buf[sizeof(buf)-1] = '\0';
 
-	f = (outf == stdout) ? stderr : stdout;
+	f = stdout_metadump ? stderr : stdout;
 	fprintf(f, "\r%-59s", buf);
 	fflush(f);
 	progress_since_warning = 1;
@@ -175,7 +176,7 @@ write_index(void)
 static int
 write_buf_segment(
 	char		*data,
-	__int64_t	off,
+	int64_t		off,
 	int		len)
 {
 	int		i;
@@ -1256,7 +1257,7 @@ process_sf_dir(
 {
 	struct xfs_dir2_sf_hdr	*sfp;
 	xfs_dir2_sf_entry_t	*sfep;
-	__uint64_t		ino_dir_size;
+	uint64_t		ino_dir_size;
 	int			i;
 
 	sfp = (struct xfs_dir2_sf_hdr *)XFS_DFORK_DPTR(dip);
@@ -1322,7 +1323,7 @@ process_sf_dir(
 static void
 obfuscate_path_components(
 	char			*buf,
-	__uint64_t		len)
+	uint64_t		len)
 {
 	unsigned char		*comp = (unsigned char *)buf;
 	unsigned char		*end = comp + len;
@@ -1359,7 +1360,7 @@ static void
 process_sf_symlink(
 	xfs_dinode_t		*dip)
 {
-	__uint64_t		len;
+	uint64_t		len;
 	char			*buf;
 
 	len = be64_to_cpu(dip->di_size);
@@ -1441,6 +1442,37 @@ process_sf_attr(
 }
 
 static void
+process_dir_leaf_block(
+	char				*block)
+{
+	struct xfs_dir2_leaf		*leaf;
+	struct xfs_dir3_icleaf_hdr 	leafhdr;
+
+	if (!zero_stale_data)
+		return;
+
+	/* Yes, this works for dir2 & dir3.  Difference is padding. */
+	leaf = (struct xfs_dir2_leaf *)block;
+	M_DIROPS(mp)->leaf_hdr_from_disk(&leafhdr, leaf);
+
+	/* Zero out space from end of ents[] to bests */
+	if (leafhdr.magic == XFS_DIR2_LEAF1_MAGIC ||
+	    leafhdr.magic == XFS_DIR3_LEAF1_MAGIC) {
+		struct xfs_dir2_leaf_tail	*ltp;
+		__be16				*lbp;
+		struct xfs_dir2_leaf_entry	*ents;
+		char				*free; /* end of ents */
+
+		ents = M_DIROPS(mp)->leaf_ents_p(leaf);
+		free = (char *)&ents[leafhdr.count];
+		ltp = xfs_dir2_leaf_tail_p(mp->m_dir_geo, leaf);
+		lbp = xfs_dir2_leaf_bests_p(ltp);
+		memset(free, 0, (char *)lbp - free);
+		iocur_top->need_crc = 1;
+	}
+}
+
+static void
 process_dir_data_block(
 	char		*block,
 	xfs_fileoff_t	offset,
@@ -1609,7 +1641,7 @@ add_remote_vals(
 		attr_data.remote_vals[attr_data.remote_val_count] = blockidx;
 		attr_data.remote_val_count++;
 		blockidx++;
-		length -= mp->m_sb.sb_blocksize;
+		length -= XFS_ATTR3_RMT_BUF_SPACE(mp, mp->m_sb.sb_blocksize);
 	}
 
 	if (attr_data.remote_val_count >= MAX_REMOTE_VALS) {
@@ -1631,7 +1663,7 @@ process_attr_block(
 	xfs_attr_leaf_entry_t 		*entry;
 	xfs_attr_leaf_name_local_t 	*local;
 	xfs_attr_leaf_name_remote_t 	*remote;
-	__uint32_t			bs = mp->m_sb.sb_blocksize;
+	uint32_t			bs = mp->m_sb.sb_blocksize;
 	char				*first_name;
 
 
@@ -1654,7 +1686,8 @@ process_attr_block(
 	xfs_attr3_leaf_hdr_from_disk(mp->m_attr_geo, &hdr, leaf);
 
 	nentries = hdr.count;
-	if (nentries * sizeof(xfs_attr_leaf_entry_t) +
+	if (nentries == 0 ||
+	    nentries * sizeof(xfs_attr_leaf_entry_t) +
 			xfs_attr3_leaf_hdr_size(leaf) >
 				XFS_ATTR3_RMT_BUF_SPACE(mp, bs)) {
 		if (show_warnings)
@@ -1799,11 +1832,15 @@ process_single_fsb_objects(
 		dp = iocur_top->data;
 		switch (btype) {
 		case TYP_DIR2:
-			if (o >= mp->m_dir_geo->leafblk)
+			if (o >= mp->m_dir_geo->freeblk) {
+				/* TODO, zap any stale data */
 				break;
-
-			process_dir_data_block(dp, o,
+			} else if (o >= mp->m_dir_geo->leafblk) {
+				process_dir_leaf_block(dp);
+			} else {
+				process_dir_data_block(dp, o,
 					 last == mp->m_dir_geo->fsbcount);
+			}
 			iocur_top->need_crc = 1;
 			break;
 		case TYP_SYMLINK:
@@ -2269,7 +2306,7 @@ done:
 	return success;
 }
 
-static __uint32_t	inodes_copied = 0;
+static uint32_t	inodes_copied;
 
 static int
 copy_inode_chunk(
@@ -2725,7 +2762,9 @@ copy_log(void)
 		/* keep the dirty log */
 		if (obfuscate)
 			print_warning(
-_("Filesystem log is dirty; image will contain unobfuscated metadata in log."));
+_("Warning: log recovery of an obfuscated metadata image can leak "
+"unobfuscated metadata and/or cause image corruption.  If possible, "
+"please mount the filesystem to clean the log, or disable obfuscation."));
 		break;
 	case -1:
 		/* log detection error */
@@ -2747,6 +2786,8 @@ metadump_f(
 	xfs_agnumber_t	agno;
 	int		c;
 	int		start_iocur_sp;
+	int		outfd = -1;
+	int		ret;
 	char		*p;
 
 	exitcode = 1;
@@ -2760,6 +2801,16 @@ metadump_f(
 		return 0;
 	}
 
+	/*
+	 * on load, we sanity-checked agcount and possibly set to 1
+	 * if it was corrupted and large.
+	 */
+	if (mp->m_sb.sb_agcount == 1 &&
+	    XFS_MAX_DBLOCKS(&mp->m_sb) < mp->m_sb.sb_dblocks) {
+		print_warning("truncated agcount, giving up");
+		return 0;
+	}
+
 	while ((c = getopt(argc, argv, "aegm:ow")) != EOF) {
 		switch (c) {
 			case 'a':
@@ -2804,6 +2855,28 @@ metadump_f(
 	metablock->mb_blocklog = BBSHIFT;
 	metablock->mb_magic = cpu_to_be32(XFS_MD_MAGIC);
 
+	/* Set flags about state of metadump */
+	metablock->mb_info = XFS_METADUMP_INFO_FLAGS;
+	if (obfuscate)
+		metablock->mb_info |= XFS_METADUMP_OBFUSCATED;
+	if (!zero_stale_data)
+		metablock->mb_info |= XFS_METADUMP_FULLBLOCKS;
+
+	/* If we'll copy the log, see if the log is dirty */
+	if (mp->m_sb.sb_logstart) {
+		push_cur();
+		set_cur(&typtab[TYP_LOG],
+			XFS_FSB_TO_DADDR(mp, mp->m_sb.sb_logstart),
+			mp->m_sb.sb_logblocks * blkbb, DB_RING_IGN, NULL);
+		if (iocur_top->data) {	/* best effort */
+			struct xlog	log;
+
+			if (xlog_is_dirty(mp, &log, &x, 0))
+				metablock->mb_info |= XFS_METADUMP_DIRTYLOG;
+		}
+		pop_cur();
+	}
+
 	block_index = (__be64 *)((char *)metablock + sizeof(xfs_metablock_t));
 	block_buffer = (char *)metablock + BBSIZE;
 	num_indices = (BBSIZE - sizeof(xfs_metablock_t)) / sizeof(__be64);
@@ -2829,13 +2902,40 @@ metadump_f(
 			free(metablock);
 			return 0;
 		}
-		outf = stdout;
+		/*
+		 * Redirect stdout to stderr for the duration of the
+		 * metadump operation so that dbprintf and other messages
+		 * are sent to the console instead of polluting the
+		 * metadump stream.
+		 *
+		 * We get to do this the hard way because musl doesn't
+		 * allow reassignment of stdout.
+		 */
+		fflush(stdout);
+		outfd = dup(STDOUT_FILENO);
+		if (outfd < 0) {
+			perror("opening dump stream");
+			goto out;
+		}
+		ret = dup2(STDERR_FILENO, STDOUT_FILENO);
+		if (ret < 0) {
+			perror("redirecting stdout");
+			close(outfd);
+			goto out;
+		}
+		outf = fdopen(outfd, "a");
+		if (outf == NULL) {
+			fprintf(stderr, "cannot create dump stream\n");
+			dup2(outfd, STDOUT_FILENO);
+			close(outfd);
+			goto out;
+		}
+		stdout_metadump = true;
 	} else {
 		outf = fopen(argv[optind], "wb");
 		if (outf == NULL) {
 			print_warning("cannot create dump file");
-			free(metablock);
-			return 0;
+			goto out;
 		}
 	}
 
@@ -2861,15 +2961,22 @@ metadump_f(
 		exitcode = write_index() < 0;
 
 	if (progress_since_warning)
-		fputc('\n', (outf == stdout) ? stderr : stdout);
+		fputc('\n', stdout_metadump ? stderr : stdout);
 
-	if (outf != stdout)
-		fclose(outf);
+	if (stdout_metadump) {
+		fflush(outf);
+		fflush(stdout);
+		ret = dup2(outfd, STDOUT_FILENO);
+		if (ret < 0)
+			perror("un-redirecting stdout");
+		stdout_metadump = false;
+	}
+	fclose(outf);
 
 	/* cleanup iocur stack */
 	while (iocur_sp > start_iocur_sp)
 		pop_cur();
-
+out:
 	free(metablock);
 
 	return 0;
diff -urpN xfsprogs-4.9.0/db/print.c xfsprogs-4.14.0/db/print.c
--- xfsprogs-4.9.0/db/print.c	2016-12-13 21:07:01.000000000 +0100
+++ xfsprogs-4.14.0/db/print.c	2017-11-20 01:14:14.000000000 +0100
@@ -144,10 +144,19 @@ print_flist_1(
 			if (fl->flags & FL_OKHIGH)
 				count = min(count, fl->high - low + 1);
 			if (fa->prfunc) {
+				int	fsz;
+				int	bitlen;
+
+				/* Don't read an array off the end of the buffer */
+				fsz = fsize(f, iocur_top->data, parentoff, 0);
+				bitlen = iocur_top->len * NBBY;
+				if ((f->flags & FLD_ARRAY) &&
+				    fl->offset + (count * fsz) > bitlen) {
+					count = (bitlen - fl->offset) / fsz;
+				}
+
 				neednl = fa->prfunc(iocur_top->data, fl->offset,
-					count, fa->fmtstr,
-					fsize(f, iocur_top->data, parentoff, 0),
-					fa->arg, low,
+					count, fa->fmtstr, fsz, fa->arg, low,
 					(f->flags & FLD_ARRAY) != 0);
 				if (neednl)
 					dbprintf("\n");
diff -urpN xfsprogs-4.9.0/db/sb.c xfsprogs-4.14.0/db/sb.c
--- xfsprogs-4.9.0/db/sb.c	2016-12-13 21:07:01.000000000 +0100
+++ xfsprogs-4.14.0/db/sb.c	2017-11-20 01:14:14.000000000 +0100
@@ -606,7 +606,7 @@ version_help(void)
 }
 
 static int
-do_version(xfs_agnumber_t agno, __uint16_t version, __uint32_t features)
+do_version(xfs_agnumber_t agno, uint16_t version, uint32_t features)
 {
 	xfs_sb_t	tsb;
 
@@ -694,6 +694,8 @@ version_string(
 		strcat(s, ",SPARSE_INODES");
 	if (xfs_sb_version_hasmetauuid(sbp))
 		strcat(s, ",META_UUID");
+	if (xfs_sb_version_hasrmapbt(sbp))
+		strcat(s, ",RMAPBT");
 	if (xfs_sb_version_hasreflink(sbp))
 		strcat(s, ",REFLINK");
 	return s;
@@ -710,8 +712,8 @@ version_f(
 	int		argc,
 	char		**argv)
 {
-	__uint16_t	version = 0;
-	__uint32_t	features = 0;
+	uint16_t	version = 0;
+	uint32_t	features = 0;
 	xfs_agnumber_t	ag;
 
 	if (argc == 2) {	/* WRITE VERSION */
diff -urpN xfsprogs-4.9.0/db/type.c xfsprogs-4.14.0/db/type.c
--- xfsprogs-4.9.0/db/type.c	2016-12-13 21:07:01.000000000 +0100
+++ xfsprogs-4.14.0/db/type.c	2017-11-20 01:14:14.000000000 +0100
@@ -39,6 +39,7 @@
 #include "dir2.h"
 #include "text.h"
 #include "symlink.h"
+#include "fuzz.h"
 
 static const typ_t	*findtyp(char *name);
 static int		type_f(int argc, char **argv);
@@ -87,7 +88,7 @@ static const typ_t	__typtab_crc[] = {
 	{ TYP_AGI, "agi", handle_struct, agi_hfld, &xfs_agi_buf_ops,
 		XFS_AGI_CRC_OFF },
 	{ TYP_ATTR, "attr3", handle_struct, attr3_hfld,
-		&xfs_attr3_db_buf_ops, TYP_F_NO_CRC_OFF },
+		&xfs_attr3_db_buf_ops, TYP_F_CRC_FUNC, xfs_attr3_set_crc },
 	{ TYP_BMAPBTA, "bmapbta", handle_struct, bmapbta_crc_hfld,
 		&xfs_bmbt_buf_ops, XFS_BTREE_LBLOCK_CRC_OFF },
 	{ TYP_BMAPBTD, "bmapbtd", handle_struct, bmapbtd_crc_hfld,
@@ -102,14 +103,14 @@ static const typ_t	__typtab_crc[] = {
 		&xfs_refcountbt_buf_ops, XFS_BTREE_SBLOCK_CRC_OFF },
 	{ TYP_DATA, "data", handle_block, NULL, NULL, TYP_F_NO_CRC_OFF },
 	{ TYP_DIR2, "dir3", handle_struct, dir3_hfld,
-		&xfs_dir3_db_buf_ops, TYP_F_NO_CRC_OFF },
+		&xfs_dir3_db_buf_ops, TYP_F_CRC_FUNC, xfs_dir3_set_crc },
 	{ TYP_DQBLK, "dqblk", handle_struct, dqblk_hfld,
-		&xfs_dquot_buf_ops, TYP_F_NO_CRC_OFF },
+		&xfs_dquot_buf_ops, TYP_F_CRC_FUNC, xfs_dquot_set_crc },
 	{ TYP_INOBT, "inobt", handle_struct, inobt_crc_hfld,
 		&xfs_inobt_buf_ops, XFS_BTREE_SBLOCK_CRC_OFF },
 	{ TYP_INODATA, "inodata", NULL, NULL, NULL, TYP_F_NO_CRC_OFF },
 	{ TYP_INODE, "inode", handle_struct, inode_crc_hfld,
-		&xfs_inode_buf_ops, TYP_F_NO_CRC_OFF },
+		&xfs_inode_buf_ops, TYP_F_CRC_FUNC, xfs_inode_set_crc },
 	{ TYP_LOG, "log", NULL, NULL, NULL, TYP_F_NO_CRC_OFF },
 	{ TYP_RTBITMAP, "rtbitmap", NULL, NULL, NULL, TYP_F_NO_CRC_OFF },
 	{ TYP_RTSUMMARY, "rtsummary", NULL, NULL, NULL, TYP_F_NO_CRC_OFF },
@@ -131,7 +132,7 @@ static const typ_t	__typtab_spcrc[] = {
 	{ TYP_AGI, "agi", handle_struct, agi_hfld, &xfs_agi_buf_ops ,
 		XFS_AGI_CRC_OFF },
 	{ TYP_ATTR, "attr3", handle_struct, attr3_hfld,
-		&xfs_attr3_db_buf_ops, TYP_F_NO_CRC_OFF },
+		&xfs_attr3_db_buf_ops, TYP_F_CRC_FUNC, xfs_attr3_set_crc },
 	{ TYP_BMAPBTA, "bmapbta", handle_struct, bmapbta_crc_hfld,
 		&xfs_bmbt_buf_ops, XFS_BTREE_LBLOCK_CRC_OFF },
 	{ TYP_BMAPBTD, "bmapbtd", handle_struct, bmapbtd_crc_hfld,
@@ -146,14 +147,14 @@ static const typ_t	__typtab_spcrc[] = {
 		&xfs_refcountbt_buf_ops, XFS_BTREE_SBLOCK_CRC_OFF },
 	{ TYP_DATA, "data", handle_block, NULL, NULL, TYP_F_NO_CRC_OFF },
 	{ TYP_DIR2, "dir3", handle_struct, dir3_hfld,
-		&xfs_dir3_db_buf_ops, TYP_F_NO_CRC_OFF },
+		&xfs_dir3_db_buf_ops, TYP_F_CRC_FUNC, xfs_dir3_set_crc },
 	{ TYP_DQBLK, "dqblk", handle_struct, dqblk_hfld,
-		&xfs_dquot_buf_ops, TYP_F_NO_CRC_OFF },
+		&xfs_dquot_buf_ops, TYP_F_CRC_FUNC, xfs_dquot_set_crc },
 	{ TYP_INOBT, "inobt", handle_struct, inobt_spcrc_hfld,
 		&xfs_inobt_buf_ops, XFS_BTREE_SBLOCK_CRC_OFF },
 	{ TYP_INODATA, "inodata", NULL, NULL, NULL, TYP_F_NO_CRC_OFF },
 	{ TYP_INODE, "inode", handle_struct, inode_crc_hfld,
-		&xfs_inode_buf_ops, TYP_F_NO_CRC_OFF },
+		&xfs_inode_buf_ops, TYP_F_CRC_FUNC, xfs_inode_set_crc },
 	{ TYP_LOG, "log", NULL, NULL, NULL, TYP_F_NO_CRC_OFF },
 	{ TYP_RTBITMAP, "rtbitmap", NULL, NULL, NULL, TYP_F_NO_CRC_OFF },
 	{ TYP_RTSUMMARY, "rtsummary", NULL, NULL, NULL, TYP_F_NO_CRC_OFF },
@@ -254,10 +255,17 @@ handle_struct(
 	int           argc,
 	char          **argv)
 {
-	if (action == DB_WRITE)
+	switch (action) {
+	case DB_FUZZ:
+		fuzz_struct(fields, argc, argv);
+		break;
+	case DB_WRITE:
 		write_struct(fields, argc, argv);
-	else
+		break;
+	case DB_READ:
 		print_struct(fields, argc, argv);
+		break;
+	}
 }
 
 void
@@ -267,10 +275,17 @@ handle_string(
 	int           argc,
 	char          **argv)
 {
-	if (action == DB_WRITE)
+	switch (action) {
+	case DB_WRITE:
 		write_string(fields, argc, argv);
-	else
+		break;
+	case DB_READ:
 		print_string(fields, argc, argv);
+		break;
+	case DB_FUZZ:
+		dbprintf(_("string fuzzing not supported.\n"));
+		break;
+	}
 }
 
 void
@@ -280,10 +295,17 @@ handle_block(
 	int           argc,
 	char          **argv)
 {
-	if (action == DB_WRITE)
+	switch (action) {
+	case DB_WRITE:
 		write_block(fields, argc, argv);
-	else
+		break;
+	case DB_READ:
 		print_block(fields, argc, argv);
+		break;
+	case DB_FUZZ:
+		dbprintf(_("use 'blocktrash' or 'write' to fuzz a block.\n"));
+		break;
+	}
 }
 
 void
@@ -293,6 +315,14 @@ handle_text(
 	int           argc,
 	char          **argv)
 {
-	if (action != DB_WRITE)
+	switch (action) {
+	case DB_FUZZ:
+		/* fall through */
+	case DB_WRITE:
+		dbprintf(_("text writing/fuzzing not supported.\n"));
+		break;
+	case DB_READ:
 		print_text(fields, argc, argv);
+		break;
+	}
 }
diff -urpN xfsprogs-4.9.0/db/type.h xfsprogs-4.14.0/db/type.h
--- xfsprogs-4.9.0/db/type.h	2016-12-13 21:07:02.000000000 +0100
+++ xfsprogs-4.14.0/db/type.h	2017-11-20 01:14:14.000000000 +0100
@@ -30,6 +30,7 @@ typedef enum typnm
 	TYP_TEXT, TYP_FINOBT, TYP_NONE
 } typnm_t;
 
+#define DB_FUZZ  2
 #define DB_WRITE 1
 #define DB_READ  0
 
@@ -45,6 +46,8 @@ typedef struct typ
 	const struct xfs_buf_ops *bops;
 	unsigned long		crc_off;
 #define TYP_F_NO_CRC_OFF	(-1UL)
+#define TYP_F_CRC_FUNC		(-2UL)
+	void			(*set_crc)(struct xfs_buf *);
 } typ_t;
 extern const typ_t	*typtab, *cur_typ;
 
diff -urpN xfsprogs-4.9.0/db/write.c xfsprogs-4.14.0/db/write.c
--- xfsprogs-4.9.0/db/write.c	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/db/write.c	2017-11-20 01:14:14.000000000 +0100
@@ -137,7 +137,9 @@ write_f(
 		return 0;
 	}
 
-	if (invalid_data && iocur_top->typ->crc_off == TYP_F_NO_CRC_OFF) {
+	if (invalid_data &&
+	    iocur_top->typ->crc_off == TYP_F_NO_CRC_OFF &&
+	    xfs_sb_version_hascrc(&mp->m_sb)) {
 		dbprintf(_("Cannot recalculate CRCs on this type of object\n"));
 		return 0;
 	}
@@ -161,9 +163,14 @@ write_f(
 	local_ops.verify_read = stashed_ops->verify_read;
 	iocur_top->bp->b_ops = &local_ops;
 
-	if (corrupt) {
+	if (!xfs_sb_version_hascrc(&mp->m_sb)) {
+		local_ops.verify_write = xfs_dummy_verify;
+	} else if (corrupt) {
 		local_ops.verify_write = xfs_dummy_verify;
 		dbprintf(_("Allowing write of corrupted data and bad CRC\n"));
+	} else if (iocur_top->typ->crc_off == TYP_F_CRC_FUNC) {
+		local_ops.verify_write = iocur_top->typ->set_crc;
+		dbprintf(_("Allowing write of corrupted data with good CRC\n"));
 	} else { /* invalid data */
 		local_ops.verify_write = xfs_verify_recalc_crc;
 		dbprintf(_("Allowing write of corrupted data with good CRC\n"));
diff -urpN xfsprogs-4.9.0/debian/changelog xfsprogs-4.14.0/debian/changelog
--- xfsprogs-4.9.0/debian/changelog	2017-01-05 23:27:21.000000000 +0100
+++ xfsprogs-4.14.0/debian/changelog	2017-11-27 17:57:55.000000000 +0100
@@ -1,3 +1,39 @@
+xfsprogs (4.14.0) unstable; urgency=low
+
+  * New upstream release
+
+ -- Nathan Scott <nathans@debian.org>  Mon, 27 Nov 2017 10:52:38 -0600
+
+xfsprogs (4.13.1) unstable; urgency=low
+
+  * New upstream release
+
+ -- Nathan Scott <nathans@debian.org>  Tue, 26 Sep 2017 20:42:32 -0500
+
+xfsprogs (4.13.0) unstable; urgency=low
+
+  * New upstream release
+
+ -- Nathan Scott <nathans@debian.org>  Tue, 26 Sep 2017 11:40:08 -0500
+
+xfsprogs (4.12.0) unstable; urgency=low
+
+  * New upstream release
+
+ -- Nathan Scott <nathans@debian.org>  Thu, 20 Jul 2017 10:54:03 -0500
+
+xfsprogs (4.11.0) unstable; urgency=low
+
+  * New upstream release
+
+ -- Nathan Scott <nathans@debian.org>  Fri, 05 May 2017 13:22:41 -0500
+
+xfsprogs (4.10.0) unstable; urgency=low
+
+  * New upstream release
+
+ -- Nathan Scott <nathans@debian.org>  Sun, 26 Feb 2017 14:02:20 -0600
+
 xfsprogs (4.9.0) unstable; urgency=low
 
   * New upstream release
diff -urpN xfsprogs-4.9.0/debian/rules xfsprogs-4.14.0/debian/rules
--- xfsprogs-4.9.0/debian/rules	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/debian/rules	2017-11-27 17:57:55.000000000 +0100
@@ -20,9 +20,9 @@ stdenv = @GZIP=-q; export GZIP;
 
 options = export DEBUG=-DNDEBUG DISTRIBUTION=debian \
 	  INSTALL_USER=root INSTALL_GROUP=root \
-	  LOCAL_CONFIGURE_OPTIONS="--enable-readline=yes --enable-blkid=yes" ;
+	  LOCAL_CONFIGURE_OPTIONS="--enable-readline=yes --enable-blkid=yes --disable-ubsan --disable-addrsan --disable-threadsan" ;
 diopts  = $(options) \
-	  export OPTIMIZER=-Os LOCAL_CONFIGURE_OPTIONS="--enable-gettext=no" ;
+	  export OPTIMIZER=-Os LOCAL_CONFIGURE_OPTIONS="--enable-gettext=no --disable-ubsan --disable-addrsan --disable-threadsan" ;
 checkdir = test -f debian/rules
 
 build: built
diff -urpN xfsprogs-4.9.0/doc/CHANGES xfsprogs-4.14.0/doc/CHANGES
--- xfsprogs-4.9.0/doc/CHANGES	2017-01-05 23:27:21.000000000 +0100
+++ xfsprogs-4.14.0/doc/CHANGES	2017-11-27 17:57:55.000000000 +0100
@@ -1,3 +1,105 @@
+xfsprogs-4.14.0 (27 Nov 2017)
+	- no changes from v4.14.0-rc2
+
+xfsprogs-4.14.0-rc2 (20 Nov 2017)
+	- xfs_repair: fix deadlock on failed refcountbt checks (Darrick Wong)
+	- xfs_repair: fix cowextsize field checking and repairing (Darrick Wong)
+	- xfs_repair: clear DAX flag from non-file inodes (Darrick Wong)
+	- xfs_repair: fix bag memory overwrite problems (Darrick Wong)
+	- xfs_metadump: zap stale data in DIR2_LEAF1 dirs (Eric Sandeen)
+	- xfs_metadump: allow large directory extents by default (Darrick Wong)
+	- xfs_copy: don't hang if all targets hit write errors (Darrick Wong)
+	- xfs_io: stat: treat statfs.f_flags as optional (Jeff Mahoney)
+	- xfs_io: stat: fix typo in statfs->f_flags (Jeff Mahoney)
+	- xfs_io: Allow partial writes in pwrite (Goldwyn Rodrigues)
+	- xfs_io: Add support for pwritev2() (Goldwyn Rodrigues)
+	- xfs_io: Add RWF_NOWAIT to pwritev2() (Goldwyn Rodrigues))
+	- xfs_io: Disable pwrite -V if pwritev unavailable (Goldwyn Rodrigues)
+	- xfs_io: add new error injection knobs to inject command (Darrick Wong)
+	- xfs_io: report io errors from pwrite -W and -w (Liu Bo)
+
+xfsprogs-4.13.1 (26 Sep 2017)
+	- fix global array overrun in mkfs (Darrick Wong)
+
+xfsprogs-4.13.0 (26 Sep 2017)
+	- no changes from v4.13.0-rc2
+
+xfsprogs-4.13.0-rc2 (21 Sep 2017)
+	- mkfs.xfs: pass custom cowextsize to created filesystem (Darrick Wong)
+	- xfs_repair: handle missing extent states (Darrick Wong)
+	- xfs_db: version command misses RMAPBT feature string (Zirong Lang)
+
+xfsprogs-4.13.0-rc1 (15 Sep 2017)
+	- mkfs.xfs: document forgotten flags (Darrick Wong)
+	- mkfs.xfs: don't stagger AG on single disk (Donald Douwsma)
+	- xfs_repair: various threading fixes (Jeff Mahoney)
+	- xfs_repair: validate symlink target length (Darrick Wong)
+	- xfs_repair: fix error exit status with -v flag (Masatake YAMATO)
+	- xfs_fsr: Fix uninitalized varable use aftger timeout (Jeff Mahoney)
+	- xfs_io: fix fiemap -n documentation to match reality (Nikolay Borisov)
+	- xfs_io: Allow lsattr & lsproj on foreign filesystems (Ross Zwisler)
+	- xfs_io: Print filesystem statfs flags in statfs output (Carlos Maiolino)
+	- xfs_io: add seek consistency checks (Andreas Gruenbacher)
+	- xfs_db: Fix metadump redirection (Darrick Wong)
+	- xfs_db: Add fuzz command (Darrick Wong)
+	- xfsprogs: Fix multiple compiler warnings (Darrick Wong)
+
+xfsprogs-4.12.0 (20 Jul 2017)
+	 - mkfs.xfs: allow specification of 0 stripe width & unit (Eric Sandeen)
+	 - xfs_db: redirect printfs when metadumping to stdout (Darrick Wong)
+	 - libxfs: propagate transaction block reservations (Darrick Wong)
+	 - xfs_db: properly set inode type (Eric Sandeen)
+
+xfsprogs-4.12.0-rc2 (13 Jul 2017)
+	- mkfs.xfs: minimum log size calculation fixes (Darrick Wong)
+
+xfsprogs-4.12.0-rc1 (30 Jun 2017)
+	- xfs_spaceman: new space management tool (Dave Chinner, Darrick Wong)
+	- xfs_io: implement fsmap command (Darrick Wong)
+	- xfs_repair: fix 512 sector image repair on 4k sector host (Zorro Lang)
+	- xfs_growfs: ensure target is an active xfs mountpoint (Bill O'Donnell)
+	- xfs_metadump: warn about corruption if log is dirty (Jan Tulak)
+	- xfs_metadump: tag metadump with informational flags (Eric Sandeen)
+	- xfs_db: fix 'type' command for interesting geoms (Bill O'Donnell)
+	- xfs_db: add alignment filter to freesp command (Eric Sandeen)
+	- libxfs: use crc32c slice-by-8 variant by default (Darrick Wong)
+	- update Polish translation (Jakub Bogusz)
+
+xfsprogs-4.11.0 (5 May 2017)
+	- xfs_io: man page fixups (Zorro Lang)
+
+xfsprogs-4.11.0-rc2 (2 May 2017)
+	- xfs_db: add btree dumping command (Darrick Wong)
+	- mkfs.xfs: change bare -m rmapbt,reflink to enable (Eric Sandeen)
+	- xfs_io: document -d option, enable for dqblks & inodes (Darrick Wong)
+	- xfs_io: minor statx fixes, updates (Chandan Rajendra, Gwendal Grignou)
+
+xfsprogs-4.11.0-rc1 (4 Apr 2017)
+	- xfs_io: add statx support (David Howells, Eric Sandeen)
+	- xfs_io: fix "falloc -p" to pass KEEP_SIZE (Calvin Owens)
+	- xfs_io: support shutdown on foreign filesystems (Darrick Wong)
+	- xfs_repair: repair zero-sized symlinks (Brian Foster)
+	- xfs_repair: warn about dirty log with -n option (Eric Sandeen)
+	- xfs.5: document barrier mount option deprecation (Eric Sandeen)
+
+xfsprogs-4.10.0 (6 Feb 2017)
+	- build: fix __bitwise definitions vs kernel headers (Darrick Wong)
+
+xfsprogs-4.10.0-rc1 (15 Feb 2017)
+	- build: fix cross-compile (Gwendal Grignou)
+	- remove old Irix support (Christoph Hellwig)
+	- xfs_repair: various additional checks (Darrick Wong)
+	- xfs_repair: document dirty log conditions (Darrick Wong)
+	- xfs_repair: document exit codes (Zirong Lang)
+	- xfs_io: fix building with musl (Ralph Sennhauser)
+	- xfs_io: add set_encpolicy / get_encpolicy (Eric Biggers)
+	- xfs_io: Fix command iteration (Dave Chinner)
+	- xfs_io: fix missing syncfs command  (Amir Goldstein)
+	- xfs_db: fix 'source' command when passed as a -c option (Darrick Wong)
+	- xfs_logprint: handle log operation split of inode item (Hou Tao)
+	- xfs_metadump: ignore empty attribute leaf (Eric Sandeen)
+	- libxfs: don't OOM on corrupt agcount (Darrick Wong)
+
 xfsprogs-4.9.0 (5 Jan 2017)
 	- no changes from v4.9.0-rc1
 
diff -urpN xfsprogs-4.9.0/doc/COPYING xfsprogs-4.14.0/doc/COPYING
--- xfsprogs-4.9.0/doc/COPYING	2017-01-05 18:41:55.000000000 +0100
+++ xfsprogs-4.14.0/doc/COPYING	2017-11-20 01:14:14.000000000 +0100
@@ -4,11 +4,11 @@ The library named "libhandle" and some s
 All other components are licensed under the GNU General Public License.
 
 ----------------------------------------------------------------------
-
-<http://www.fsf.org/copyleft/lesser.txt>
 
-		  GNU LESSER GENERAL PUBLIC LICENSE
-		       Version 2.1, February 1999
+<https://www.gnu.org/licenses/old-licenses/lgpl-2.1.txt>
+
+                  GNU LESSER GENERAL PUBLIC LICENSE
+                       Version 2.1, February 1999
 
  Copyright (C) 1991, 1999 Free Software Foundation, Inc.
  51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA
@@ -19,7 +19,7 @@ All other components are licensed under
  as the successor of the GNU Library Public License, version 2, hence
  the version number 2.1.]
 
-			    Preamble
+                            Preamble
 
   The licenses for most software are designed to take away your
 freedom to share and change it.  By contrast, the GNU General Public
@@ -120,8 +120,8 @@ modification follow.  Pay close attentio
 "work based on the library" and a "work that uses the library".  The
 former contains code derived from the library, whereas the latter must
 be combined with the library in order to run.
-
-		  GNU LESSER GENERAL PUBLIC LICENSE
+
+                  GNU LESSER GENERAL PUBLIC LICENSE
    TERMS AND CONDITIONS FOR COPYING, DISTRIBUTION AND MODIFICATION
 
   0. This License Agreement applies to any software library or other
@@ -155,7 +155,7 @@ such a program is covered only if its co
 on the Library (independent of the use of the Library in a tool for
 writing it).  Whether that is true depends on what the Library does
 and what the program that uses the Library does.
-  
+
   1. You may copy and distribute verbatim copies of the Library's
 complete source code as you receive it, in any medium, provided that
 you conspicuously and appropriately publish on each copy an
@@ -441,7 +441,7 @@ decision will be guided by the two goals
 of all derivatives of our free software and of promoting the sharing
 and reuse of software generally.
 
-			    NO WARRANTY
+                            NO WARRANTY
 
   15. BECAUSE THE LIBRARY IS LICENSED FREE OF CHARGE, THERE IS NO
 WARRANTY FOR THE LIBRARY, TO THE EXTENT PERMITTED BY APPLICABLE LAW.
@@ -464,7 +464,7 @@ FAILURE OF THE LIBRARY TO OPERATE WITH A
 SUCH HOLDER OR OTHER PARTY HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH
 DAMAGES.
 
-		     END OF TERMS AND CONDITIONS
+                     END OF TERMS AND CONDITIONS
 
            How to Apply These Terms to Your New Libraries
 
@@ -485,7 +485,7 @@ convey the exclusion of warranty; and ea
     This library is free software; you can redistribute it and/or
     modify it under the terms of the GNU Lesser General Public
     License as published by the Free Software Foundation; either
-    version 2 of the License, or (at your option) any later version.
+    version 2.1 of the License, or (at your option) any later version.
 
     This library is distributed in the hope that it will be useful,
     but WITHOUT ANY WARRANTY; without even the implied warranty of
@@ -494,7 +494,7 @@ convey the exclusion of warranty; and ea
 
     You should have received a copy of the GNU Lesser General Public
     License along with this library; if not, write to the Free Software
-    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+    Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA
 
 Also add information on how to contact you by electronic and paper mail.
 
@@ -509,21 +509,19 @@ necessary.  Here is a sample; alter the
   Ty Coon, President of Vice
 
 That's all there is to it!
-
-
 ----------------------------------------------------------------------
-
-<http://www.fsf.org/copyleft/gpl.txt>
 
-		    GNU GENERAL PUBLIC LICENSE
-		       Version 2, June 1991
+<https://www.gnu.org/licenses/old-licenses/gpl-2.0.txt>
+
+                    GNU GENERAL PUBLIC LICENSE
+                       Version 2, June 1991
 
  Copyright (C) 1989, 1991 Free Software Foundation, Inc.,
  51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA
  Everyone is permitted to copy and distribute verbatim copies
  of this license document, but changing it is not allowed.
 
-			    Preamble
+                            Preamble
 
   The licenses for most software are designed to take away your
 freedom to share and change it.  By contrast, the GNU General Public
@@ -532,7 +530,7 @@ software--to make sure the software is f
 General Public License applies to most of the Free Software
 Foundation's software and to any other program whose authors commit to
 using it.  (Some other Free Software Foundation software is covered by
-the GNU Library General Public License instead.)  You can apply it to
+the GNU Lesser General Public License instead.)  You can apply it to
 your programs, too.
 
   When we speak of free software, we are referring to freedom, not
@@ -572,353 +570,8 @@ patent must be licensed for everyone's f
 
   The precise terms and conditions for copying, distribution and
 modification follow.
-
-		    GNU GENERAL PUBLIC LICENSE
-   TERMS AND CONDITIONS FOR COPYING, DISTRIBUTION AND MODIFICATION
-
-  0. This License applies to any program or other work which contains
-a notice placed by the copyright holder saying it may be distributed
-under the terms of this General Public License.  The "Program", below,
-refers to any such program or work, and a "work based on the Program"
-means either the Program or any derivative work under copyright law:
-that is to say, a work containing the Program or a portion of it,
-either verbatim or with modifications and/or translated into another
-language.  (Hereinafter, translation is included without limitation in
-the term "modification".)  Each licensee is addressed as "you".
-
-Activities other than copying, distribution and modification are not
-covered by this License; they are outside its scope.  The act of
-running the Program is not restricted, and the output from the Program
-is covered only if its contents constitute a work based on the
-Program (independent of having been made by running the Program).
-Whether that is true depends on what the Program does.
-
-  1. You may copy and distribute verbatim copies of the Program's
-source code as you receive it, in any medium, provided that you
-conspicuously and appropriately publish on each copy an appropriate
-copyright notice and disclaimer of warranty; keep intact all the
-notices that refer to this License and to the absence of any warranty;
-and give any other recipients of the Program a copy of this License
-along with the Program.
-
-You may charge a fee for the physical act of transferring a copy, and
-you may at your option offer warranty protection in exchange for a fee.
-
-  2. You may modify your copy or copies of the Program or any portion
-of it, thus forming a work based on the Program, and copy and
-distribute such modifications or work under the terms of Section 1
-above, provided that you also meet all of these conditions:
-
-    a) You must cause the modified files to carry prominent notices
-    stating that you changed the files and the date of any change.
-
-    b) You must cause any work that you distribute or publish, that in
-    whole or in part contains or is derived from the Program or any
-    part thereof, to be licensed as a whole at no charge to all third
-    parties under the terms of this License.
-
-    c) If the modified program normally reads commands interactively
-    when run, you must cause it, when started running for such
-    interactive use in the most ordinary way, to print or display an
-    announcement including an appropriate copyright notice and a
-    notice that there is no warranty (or else, saying that you provide
-    a warranty) and that users may redistribute the program under
-    these conditions, and telling the user how to view a copy of this
-    License.  (Exception: if the Program itself is interactive but
-    does not normally print such an announcement, your work based on
-    the Program is not required to print an announcement.)
-
-These requirements apply to the modified work as a whole.  If
-identifiable sections of that work are not derived from the Program,
-and can be reasonably considered independent and separate works in
-themselves, then this License, and its terms, do not apply to those
-sections when you distribute them as separate works.  But when you
-distribute the same sections as part of a whole which is a work based
-on the Program, the distribution of the whole must be on the terms of
-this License, whose permissions for other licensees extend to the
-entire whole, and thus to each and every part regardless of who wrote it.
-
-Thus, it is not the intent of this section to claim rights or contest
-your rights to work written entirely by you; rather, the intent is to
-exercise the right to control the distribution of derivative or
-collective works based on the Program.
-
-In addition, mere aggregation of another work not based on the Program
-with the Program (or with a work based on the Program) on a volume of
-a storage or distribution medium does not bring the other work under
-the scope of this License.
-
-  3. You may copy and distribute the Program (or a work based on it,
-under Section 2) in object code or executable form under the terms of
-Sections 1 and 2 above provided that you also do one of the following:
-
-    a) Accompany it with the complete corresponding machine-readable
-    source code, which must be distributed under the terms of Sections
-    1 and 2 above on a medium customarily used for software interchange; or,
-
-    b) Accompany it with a written offer, valid for at least three
-    years, to give any third party, for a charge no more than your
-    cost of physically performing source distribution, a complete
-    machine-readable copy of the corresponding source code, to be
-    distributed under the terms of Sections 1 and 2 above on a medium
-    customarily used for software interchange; or,
-
-    c) Accompany it with the information you received as to the offer
-    to distribute corresponding source code.  (This alternative is
-    allowed only for noncommercial distribution and only if you
-    received the program in object code or executable form with such
-    an offer, in accord with Subsection b above.)
-
-The source code for a work means the preferred form of the work for
-making modifications to it.  For an executable work, complete source
-code means all the source code for all modules it contains, plus any
-associated interface definition files, plus the scripts used to
-control compilation and installation of the executable.  However, as a
-special exception, the source code distributed need not include
-anything that is normally distributed (in either source or binary
-form) with the major components (compiler, kernel, and so on) of the
-operating system on which the executable runs, unless that component
-itself accompanies the executable.
-
-If distribution of executable or object code is made by offering
-access to copy from a designated place, then offering equivalent
-access to copy the source code from the same place counts as
-distribution of the source code, even though third parties are not
-compelled to copy the source along with the object code.
-
-  4. You may not copy, modify, sublicense, or distribute the Program
-except as expressly provided under this License.  Any attempt
-otherwise to copy, modify, sublicense or distribute the Program is
-void, and will automatically terminate your rights under this License.
-However, parties who have received copies, or rights, from you under
-this License will not have their licenses terminated so long as such
-parties remain in full compliance.
-
-  5. You are not required to accept this License, since you have not
-signed it.  However, nothing else grants you permission to modify or
-distribute the Program or its derivative works.  These actions are
-prohibited by law if you do not accept this License.  Therefore, by
-modifying or distributing the Program (or any work based on the
-Program), you indicate your acceptance of this License to do so, and
-all its terms and conditions for copying, distributing or modifying
-the Program or works based on it.
-
-  6. Each time you redistribute the Program (or any work based on the
-Program), the recipient automatically receives a license from the
-original licensor to copy, distribute or modify the Program subject to
-these terms and conditions.  You may not impose any further
-restrictions on the recipients' exercise of the rights granted herein.
-You are not responsible for enforcing compliance by third parties to
-this License.
-
-  7. If, as a consequence of a court judgment or allegation of patent
-infringement or for any other reason (not limited to patent issues),
-conditions are imposed on you (whether by court order, agreement or
-otherwise) that contradict the conditions of this License, they do not
-excuse you from the conditions of this License.  If you cannot
-distribute so as to satisfy simultaneously your obligations under this
-License and any other pertinent obligations, then as a consequence you
-may not distribute the Program at all.  For example, if a patent
-license would not permit royalty-free redistribution of the Program by
-all those who receive copies directly or indirectly through you, then
-the only way you could satisfy both it and this License would be to
-refrain entirely from distribution of the Program.
-
-If any portion of this section is held invalid or unenforceable under
-any particular circumstance, the balance of the section is intended to
-apply and the section as a whole is intended to apply in other
-circumstances.
-
-It is not the purpose of this section to induce you to infringe any
-patents or other property right claims or to contest validity of any
-such claims; this section has the sole purpose of protecting the
-integrity of the free software distribution system, which is
-implemented by public license practices.  Many people have made
-generous contributions to the wide range of software distributed
-through that system in reliance on consistent application of that
-system; it is up to the author/donor to decide if he or she is willing
-to distribute software through any other system and a licensee cannot
-impose that choice.
 
-This section is intended to make thoroughly clear what is believed to
-be a consequence of the rest of this License.
-
-  8. If the distribution and/or use of the Program is restricted in
-certain countries either by patents or by copyrighted interfaces, the
-original copyright holder who places the Program under this License
-may add an explicit geographical distribution limitation excluding
-those countries, so that distribution is permitted only in or among
-countries not thus excluded.  In such case, this License incorporates
-the limitation as if written in the body of this License.
-
-  9. The Free Software Foundation may publish revised and/or new versions
-of the General Public License from time to time.  Such new versions will
-be similar in spirit to the present version, but may differ in detail to
-address new problems or concerns.
-
-Each version is given a distinguishing version number.  If the Program
-specifies a version number of this License which applies to it and "any
-later version", you have the option of following the terms and conditions
-either of that version or of any later version published by the Free
-Software Foundation.  If the Program does not specify a version number of
-this License, you may choose any version ever published by the Free Software
-Foundation.
-
-  10. If you wish to incorporate parts of the Program into other free
-programs whose distribution conditions are different, write to the author
-to ask for permission.  For software which is copyrighted by the Free
-Software Foundation, write to the Free Software Foundation; we sometimes
-make exceptions for this.  Our decision will be guided by the two goals
-of preserving the free status of all derivatives of our free software and
-of promoting the sharing and reuse of software generally.
-
-			    NO WARRANTY
-
-  11. BECAUSE THE PROGRAM IS LICENSED FREE OF CHARGE, THERE IS NO WARRANTY
-FOR THE PROGRAM, TO THE EXTENT PERMITTED BY APPLICABLE LAW.  EXCEPT WHEN
-OTHERWISE STATED IN WRITING THE COPYRIGHT HOLDERS AND/OR OTHER PARTIES
-PROVIDE THE PROGRAM "AS IS" WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESSED
-OR IMPLIED, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
-MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  THE ENTIRE RISK AS
-TO THE QUALITY AND PERFORMANCE OF THE PROGRAM IS WITH YOU.  SHOULD THE
-PROGRAM PROVE DEFECTIVE, YOU ASSUME THE COST OF ALL NECESSARY SERVICING,
-REPAIR OR CORRECTION.
-
-  12. IN NO EVENT UNLESS REQUIRED BY APPLICABLE LAW OR AGREED TO IN WRITING
-WILL ANY COPYRIGHT HOLDER, OR ANY OTHER PARTY WHO MAY MODIFY AND/OR
-REDISTRIBUTE THE PROGRAM AS PERMITTED ABOVE, BE LIABLE TO YOU FOR DAMAGES,
-INCLUDING ANY GENERAL, SPECIAL, INCIDENTAL OR CONSEQUENTIAL DAMAGES ARISING
-OUT OF THE USE OR INABILITY TO USE THE PROGRAM (INCLUDING BUT NOT LIMITED
-TO LOSS OF DATA OR DATA BEING RENDERED INACCURATE OR LOSSES SUSTAINED BY
-YOU OR THIRD PARTIES OR A FAILURE OF THE PROGRAM TO OPERATE WITH ANY OTHER
-PROGRAMS), EVEN IF SUCH HOLDER OR OTHER PARTY HAS BEEN ADVISED OF THE
-POSSIBILITY OF SUCH DAMAGES.
-
-		     END OF TERMS AND CONDITIONS
-
-	    How to Apply These Terms to Your New Programs
-
-  If you develop a new program, and you want it to be of the greatest
-possible use to the public, the best way to achieve this is to make it
-free software which everyone can redistribute and change under these terms.
-
-  To do so, attach the following notices to the program.  It is safest
-to attach them to the start of each source file to most effectively
-convey the exclusion of warranty; and each file should have at least
-the "copyright" line and a pointer to where the full notice is found.
-
-    <one line to give the program's name and a brief idea of what it does.>
-    Copyright (C) 19yy  <name of author>
-
-    This program is free software; you can redistribute it and/or modify
-    it under the terms of the GNU General Public License as published by
-    the Free Software Foundation; either version 2 of the License, or
-    (at your option) any later version.
-
-    This program is distributed in the hope that it will be useful,
-    but WITHOUT ANY WARRANTY; without even the implied warranty of
-    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-    GNU General Public License for more details.
-
-    You should have received a copy of the GNU General Public License
-    along with this program; if not, write to the Free Software
-    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
-
-
-Also add information on how to contact you by electronic and paper mail.
-
-If the program is interactive, make it output a short notice like this
-when it starts in an interactive mode:
-
-    Gnomovision version 69, Copyright (C) 19yy name of author
-    Gnomovision comes with ABSOLUTELY NO WARRANTY; for details type `show w'.
-    This is free software, and you are welcome to redistribute it
-    under certain conditions; type `show c' for details.
-
-The hypothetical commands `show w' and `show c' should show the appropriate
-parts of the General Public License.  Of course, the commands you use may
-be called something other than `show w' and `show c'; they could even be
-mouse-clicks or menu items--whatever suits your program.
-
-You should also get your employer (if you work as a programmer) or your
-school, if any, to sign a "copyright disclaimer" for the program, if
-necessary.  Here is a sample; alter the names:
-
-  Yoyodyne, Inc., hereby disclaims all copyright interest in the program
-  `Gnomovision' (which makes passes at compilers) written by James Hacker.
-
-  <signature of Ty Coon>, 1 April 1989
-  Ty Coon, President of Vice
-
-This General Public License does not permit incorporating your program into
-proprietary programs.  If your program is a subroutine library, you may
-consider it more useful to permit linking proprietary applications with the
-library.  If this is what you want to do, use the GNU Library General
-Public License instead of this License.
-
-----------------------------------------------------------------------
-
-<http://www.fsf.org/copyleft/gpl.txt>
-
-		    GNU GENERAL PUBLIC LICENSE
-		       Version 2, June 1991
-
- Copyright (C) 1989, 1991 Free Software Foundation, Inc.
-                       59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
- Everyone is permitted to copy and distribute verbatim copies
- of this license document, but changing it is not allowed.
-
-			    Preamble
-
-  The licenses for most software are designed to take away your
-freedom to share and change it.  By contrast, the GNU General Public
-License is intended to guarantee your freedom to share and change free
-software--to make sure the software is free for all its users.  This
-General Public License applies to most of the Free Software
-Foundation's software and to any other program whose authors commit to
-using it.  (Some other Free Software Foundation software is covered by
-the GNU Library General Public License instead.)  You can apply it to
-your programs, too.
-
-  When we speak of free software, we are referring to freedom, not
-price.  Our General Public Licenses are designed to make sure that you
-have the freedom to distribute copies of free software (and charge for
-this service if you wish), that you receive source code or can get it
-if you want it, that you can change the software or use pieces of it
-in new free programs; and that you know you can do these things.
-
-  To protect your rights, we need to make restrictions that forbid
-anyone to deny you these rights or to ask you to surrender the rights.
-These restrictions translate to certain responsibilities for you if you
-distribute copies of the software, or if you modify it.
-
-  For example, if you distribute copies of such a program, whether
-gratis or for a fee, you must give the recipients all the rights that
-you have.  You must make sure that they, too, receive or can get the
-source code.  And you must show them these terms so they know their
-rights.
-
-  We protect your rights with two steps: (1) copyright the software, and
-(2) offer you this license which gives you legal permission to copy,
-distribute and/or modify the software.
-
-  Also, for each author's protection and ours, we want to make certain
-that everyone understands that there is no warranty for this free
-software.  If the software is modified by someone else and passed on, we
-want its recipients to know that what they have is not the original, so
-that any problems introduced by others will not reflect on the original
-authors' reputations.
-
-  Finally, any free program is threatened constantly by software
-patents.  We wish to avoid the danger that redistributors of a free
-program will individually obtain patent licenses, in effect making the
-program proprietary.  To prevent this, we have made it clear that any
-patent must be licensed for everyone's free use or not licensed at all.
-
-  The precise terms and conditions for copying, distribution and
-modification follow.
-
-		    GNU GENERAL PUBLIC LICENSE
+                    GNU GENERAL PUBLIC LICENSE
    TERMS AND CONDITIONS FOR COPYING, DISTRIBUTION AND MODIFICATION
 
   0. This License applies to any program or other work which contains
@@ -972,7 +625,7 @@ above, provided that you also meet all o
     License.  (Exception: if the Program itself is interactive but
     does not normally print such an announcement, your work based on
     the Program is not required to print an announcement.)
-
+
 These requirements apply to the modified work as a whole.  If
 identifiable sections of that work are not derived from the Program,
 and can be reasonably considered independent and separate works in
@@ -1030,7 +683,7 @@ access to copy from a designated place,
 access to copy the source code from the same place counts as
 distribution of the source code, even though third parties are not
 compelled to copy the source along with the object code.
-
+
   4. You may not copy, modify, sublicense, or distribute the Program
 except as expressly provided under this License.  Any attempt
 otherwise to copy, modify, sublicense or distribute the Program is
@@ -1087,7 +740,7 @@ impose that choice.
 
 This section is intended to make thoroughly clear what is believed to
 be a consequence of the rest of this License.
-
+
   8. If the distribution and/or use of the Program is restricted in
 certain countries either by patents or by copyrighted interfaces, the
 original copyright holder who places the Program under this License
@@ -1117,7 +770,7 @@ make exceptions for this.  Our decision
 of preserving the free status of all derivatives of our free software and
 of promoting the sharing and reuse of software generally.
 
-			    NO WARRANTY
+                            NO WARRANTY
 
   11. BECAUSE THE PROGRAM IS LICENSED FREE OF CHARGE, THERE IS NO WARRANTY
 FOR THE PROGRAM, TO THE EXTENT PERMITTED BY APPLICABLE LAW.  EXCEPT WHEN
@@ -1139,9 +792,9 @@ YOU OR THIRD PARTIES OR A FAILURE OF THE
 PROGRAMS), EVEN IF SUCH HOLDER OR OTHER PARTY HAS BEEN ADVISED OF THE
 POSSIBILITY OF SUCH DAMAGES.
 
-		     END OF TERMS AND CONDITIONS
-
-	    How to Apply These Terms to Your New Programs
+                     END OF TERMS AND CONDITIONS
+
+            How to Apply These Terms to Your New Programs
 
   If you develop a new program, and you want it to be of the greatest
 possible use to the public, the best way to achieve this is to make it
@@ -1153,7 +806,7 @@ convey the exclusion of warranty; and ea
 the "copyright" line and a pointer to where the full notice is found.
 
     <one line to give the program's name and a brief idea of what it does.>
-    Copyright (C) 19yy  <name of author>
+    Copyright (C) <year>  <name of author>
 
     This program is free software; you can redistribute it and/or modify
     it under the terms of the GNU General Public License as published by
@@ -1165,17 +818,16 @@ the "copyright" line and a pointer to wh
     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
     GNU General Public License for more details.
 
-    You should have received a copy of the GNU General Public License
-    along with this program; if not, write to the Free Software
-    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
-
+    You should have received a copy of the GNU General Public License along
+    with this program; if not, write to the Free Software Foundation, Inc.,
+    51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
 
 Also add information on how to contact you by electronic and paper mail.
 
 If the program is interactive, make it output a short notice like this
 when it starts in an interactive mode:
 
-    Gnomovision version 69, Copyright (C) 19yy name of author
+    Gnomovision version 69, Copyright (C) year name of author
     Gnomovision comes with ABSOLUTELY NO WARRANTY; for details type `show w'.
     This is free software, and you are welcome to redistribute it
     under certain conditions; type `show c' for details.
@@ -1198,7 +850,5 @@ necessary.  Here is a sample; alter the
 This General Public License does not permit incorporating your program into
 proprietary programs.  If your program is a subroutine library, you may
 consider it more useful to permit linking proprietary applications with the
-library.  If this is what you want to do, use the GNU Library General
+library.  If this is what you want to do, use the GNU Lesser General
 Public License instead of this License.
-
-----------------------------------------------------------------------
diff -urpN xfsprogs-4.9.0/doc/INSTALL xfsprogs-4.14.0/doc/INSTALL
--- xfsprogs-4.9.0/doc/INSTALL	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/doc/INSTALL	2017-11-20 01:14:14.000000000 +0100
@@ -100,47 +100,3 @@ Mac OS X Instructions
 	# make install
 	[and optionally, for the development libraries and headers]
 	# make install-dev
-
-
-IRIX Instructions
-=================
-
-0. Note: building this package on IRIX is mainly useful for the
-   XFS developers who want to run purify on some of the tools.
-   Most tools are not functional due to incomplete support for
-   the syssgi and fcntl interfaces that XFS provides and which
-   these tools make extensive use of.
-
-1. Configure, build and install the package
-
-   The xfsprogs package uses autoconf/configure and expects a GNU build
-   environment which can be obtained by installing a number of freeware
-   packages (gcc, autoconf, libtool, gmake).
-
-   Even though IRIX provides a set of UUID functions via libc, you
-   still need to have built and installed the UUID library which is
-   provided by the e2fsprogs source package.  This is because some
-   difficult to resolve differences exist between the UUID functions
-   and data types, which makes co-existence of these more trouble
-   than its worth at the moment.  Follow the instructions above for
-   building and installing libuuid.
-
-   Building xfsprogs:
-
-	[firstly set these environment variables to these values]
-	INSTALL_GROUP=sys
-	CC=/usr/freeware/bin/gcc
-	TAR=/usr/freeware/bin/tar
-	MAKE=/usr/freeware/bin/gmake
-	LIBTOOL=/usr/freeware/bin/libtool
-	MSGFMT=/usr/freeware/bin/msgfmt
-	MSGMERGE=/usr/freeware/bin/msgmerge
-	XGETTEXT=/usr/freeware/bin/xgettext
-
-	$ make
-	$ su root
-	# make install
-	[and optionally, for the development libraries and headers]
-	# make install-dev
-
-
diff -urpN xfsprogs-4.9.0/fsr/xfs_fsr.c xfsprogs-4.14.0/fsr/xfs_fsr.c
--- xfsprogs-4.9.0/fsr/xfs_fsr.c	2016-12-21 06:36:07.000000000 +0100
+++ xfsprogs-4.14.0/fsr/xfs_fsr.c	2017-11-20 01:14:14.000000000 +0100
@@ -54,7 +54,7 @@ struct getbmap  *outmap = NULL;
 int             outmap_size = 0;
 int		RealUid;
 int		tmp_agi;
-static __int64_t	minimumfree = 2048;
+static int64_t		minimumfree = 2048;
 
 #define MNTTYPE_XFS             "xfs"
 
@@ -600,12 +600,7 @@ fsrallfs(char *mtab, int howlong, char *
 	/* reorg for 'howlong' -- checked in 'fsrfs' */
 	while (endtime > time(0)) {
 		pid_t pid;
-		if (fs == fsend)
-			fs = fsbase;
-		if (fs->npass == npasses) {
-			fsrprintf(_("Completed all %d passes\n"), npasses);
-			break;
-		}
+
 		if (npasses > 1 && !fs->npass)
 			Mflag = 1;
 		else
@@ -631,6 +626,12 @@ fsrallfs(char *mtab, int howlong, char *
 		startino = 0;  /* reset after the first time through */
 		fs->npass++;
 		fs++;
+		if (fs == fsend)
+			fs = fsbase;
+		if (fs->npass == npasses) {
+			fsrprintf(_("Completed all %d passes\n"), npasses);
+			break;
+		}
 	}
 	fsrall_cleanup(endtime <= time(0));
 }
diff -urpN xfsprogs-4.9.0/growfs/xfs_growfs.c xfsprogs-4.14.0/growfs/xfs_growfs.c
--- xfsprogs-4.9.0/growfs/xfs_growfs.c	2016-12-13 21:07:03.000000000 +0100
+++ xfsprogs-4.14.0/growfs/xfs_growfs.c	2017-11-20 01:14:14.000000000 +0100
@@ -133,6 +133,7 @@ main(int argc, char **argv)
 	int			spinodes;
 	int			rmapbt_enabled;
 	int			reflink_enabled;
+	char			rpath[PATH_MAX];
 
 	progname = basename(argv[0]);
 	setlocale(LC_ALL, "");
@@ -202,7 +203,14 @@ main(int argc, char **argv)
 		aflag = 1;
 
 	fs_table_initialise(0, NULL, 0, NULL);
-	fs = fs_table_lookup(argv[optind], FS_MOUNT_POINT);
+
+	if (!realpath(argv[optind], rpath)) {
+		fprintf(stderr, _("%s: path resolution failed for %s: %s\n"),
+			progname, argv[optind], strerror(errno));
+		return 1;
+	}
+
+	fs = fs_table_lookup_mount(rpath);
 	if (!fs) {
 		fprintf(stderr, _("%s: %s is not a mounted XFS filesystem\n"),
 			progname, argv[optind]);
diff -urpN xfsprogs-4.9.0/include/Makefile xfsprogs-4.14.0/include/Makefile
--- xfsprogs-4.9.0/include/Makefile	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/include/Makefile	2017-11-20 01:14:14.000000000 +0100
@@ -52,7 +52,7 @@ HFILES = handle.h \
 	xqm.h \
 	xfs_arch.h
 
-PHFILES = darwin.h freebsd.h irix.h linux.h gnukfreebsd.h
+PHFILES = darwin.h freebsd.h linux.h gnukfreebsd.h
 LSRCFILES = $(shell echo $(PHFILES) | sed -e "s/$(PKG_PLATFORM).h//g")
 LSRCFILES += platform_defs.h.in builddefs.in buildmacros buildrules install-sh
 LSRCFILES += $(DKHFILES) $(LIBHFILES)
diff -urpN xfsprogs-4.9.0/include/bitops.h xfsprogs-4.14.0/include/bitops.h
--- xfsprogs-4.9.0/include/bitops.h	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/include/bitops.h	2017-11-27 17:57:55.000000000 +0100
@@ -13,19 +13,19 @@ static inline int fls(int x)
 	if (!x)
 		return 0;
 	if (!(x & 0xffff0000u)) {
-		x <<= 16;
+		x = (x & 0xffffu) << 16;
 		r -= 16;
 	}
 	if (!(x & 0xff000000u)) {
-		x <<= 8;
+		x = (x & 0xffffffu) << 8;
 		r -= 8;
 	}
 	if (!(x & 0xf0000000u)) {
-		x <<= 4;
+		x = (x & 0xfffffffu) << 4;
 		r -= 4;
 	}
 	if (!(x & 0xc0000000u)) {
-		x <<= 2;
+		x = (x & 0x3fffffffu) << 2;
 		r -= 2;
 	}
 	if (!(x & 0x80000000u)) {
diff -urpN xfsprogs-4.9.0/include/builddefs.in xfsprogs-4.14.0/include/builddefs.in
--- xfsprogs-4.9.0/include/builddefs.in	2017-01-05 18:42:06.000000000 +0100
+++ xfsprogs-4.14.0/include/builddefs.in	2017-11-27 17:57:55.000000000 +0100
@@ -26,6 +26,7 @@ MALLOCLIB = @malloc_lib@
 LOADERFLAGS = @LDFLAGS@
 LTLDFLAGS = @LDFLAGS@
 CFLAGS = @CFLAGS@ -D_FILE_OFFSET_BITS=64
+BUILD_CFLAGS = @BUILD_CFLAGS@ -D_FILE_OFFSET_BITS=64
 
 LIBRT = @librt@
 LIBUUID = @libuuid@
@@ -102,14 +103,18 @@ HAVE_GETMNTINFO = @have_getmntinfo@
 HAVE_FALLOCATE = @have_fallocate@
 HAVE_FIEMAP = @have_fiemap@
 HAVE_PREADV = @have_preadv@
+HAVE_PWRITEV2 = @have_pwritev2@
 HAVE_COPY_FILE_RANGE = @have_copy_file_range@
 HAVE_SYNC_FILE_RANGE = @have_sync_file_range@
+HAVE_SYNCFS = @have_syncfs@
 HAVE_READDIR = @have_readdir@
 HAVE_MNTENT = @have_mntent@
 HAVE_FLS = @have_fls@
 HAVE_FSETXATTR = @have_fsetxattr@
 HAVE_MREMAP = @have_mremap@
 NEED_INTERNAL_FSXATTR = @need_internal_fsxattr@
+HAVE_GETFSMAP = @have_getfsmap@
+HAVE_STATFS_FLAGS = @have_statfs_flags@
 
 GCCFLAGS = -funsigned-char -fno-strict-aliasing -Wall
 #	   -Wbitwise -Wno-transparent-union -Wno-old-initializer -Wno-decl
@@ -128,10 +133,6 @@ ifeq ($(PKG_PLATFORM),darwin)
 PCFLAGS = $(GCCFLAGS)
 DEPENDFLAGS = -D__APPLE__ -D_DARWIN_FEATURE_64_BIT_INODE
 endif
-ifeq ($(PKG_PLATFORM),irix)
-PLDLIBS = -ldisk -lgen
-DEPENDFLAGS = -D__sgi__
-endif
 ifeq ($(PKG_PLATFORM),freebsd)
 PLDLIBS = -L/usr/local/lib -lintl
 PCFLAGS = -I/usr/local/include $(GCCFLAGS)
@@ -152,9 +153,14 @@ endif
 ifeq ($(NEED_INTERNAL_FSXATTR),yes)
 PCFLAGS+= -DOVERRIDE_SYSTEM_FSXATTR
 endif
+ifeq ($(HAVE_GETFSMAP),yes)
+PCFLAGS+= -DHAVE_GETFSMAP
+endif
 
+SANITIZER_CFLAGS += @addrsan_cflags@ @threadsan_cflags@ @ubsan_cflags@
+SANITIZER_LDFLAGS += @addrsan_ldflags@ @threadsan_ldflags@ @ubsan_ldflags@
 
-GCFLAGS = $(OPTIMIZER) $(DEBUG) \
+GCFLAGS = $(DEBUG) \
 	  -DVERSION=\"$(PKG_VERSION)\" -DLOCALEDIR=\"$(PKG_LOCALE_DIR)\"  \
 	  -DPACKAGE=\"$(PKG_NAME)\" -I$(TOPDIR)/include -I$(TOPDIR)/libxfs
 
@@ -162,8 +168,9 @@ ifeq ($(ENABLE_GETTEXT),yes)
 GCFLAGS += -DENABLE_GETTEXT
 endif
 
-# First, Global, Platform, Local CFLAGS
-CFLAGS += $(FCFLAGS) $(GCFLAGS) $(PCFLAGS) $(LCFLAGS)
+BUILD_CFLAGS += $(GCFLAGS) $(PCFLAGS)
+# First, Sanitizer, Global, Platform, Local CFLAGS
+CFLAGS += $(FCFLAGS) $(SANITIZER_CFLAGS) $(OPTIMIZER) $(GCFLAGS) $(PCFLAGS) $(LCFLAGS)
 
 include $(TOPDIR)/include/buildmacros
 
diff -urpN xfsprogs-4.9.0/include/buildmacros xfsprogs-4.14.0/include/buildmacros
--- xfsprogs-4.9.0/include/buildmacros	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/include/buildmacros	2017-11-27 17:57:55.000000000 +0100
@@ -9,7 +9,7 @@ BUILDRULES = $(TOPDIR)/include/buildrule
 # $(CXXFILES), or $(HFILES) and is used to construct the manifest list
 # during the "dist" phase (packaging).
 
-LDFLAGS += $(LOADERFLAGS) $(LLDFLAGS)
+LDFLAGS += $(SANITIZER_LDFLAGS) $(LOADERFLAGS) $(LLDFLAGS)
 LTLDFLAGS += $(LOADERFLAGS)
 LDLIBS = $(LLDLIBS) $(PLDLIBS) $(MALLOCLIB)
 
diff -urpN xfsprogs-4.9.0/include/command.h xfsprogs-4.14.0/include/command.h
--- xfsprogs-4.9.0/include/command.h	2017-01-05 18:41:55.000000000 +0100
+++ xfsprogs-4.14.0/include/command.h	2017-11-27 17:57:55.000000000 +0100
@@ -20,8 +20,14 @@
 
 #include <sys/time.h>
 
-#define CMD_FLAG_GLOBAL		(1<<31)	/* don't iterate "args" */
-#define CMD_FLAG_FOREIGN_OK	(1<<30)	/* command not restricted to XFS */
+/*
+ * A "oneshot" command ony runs once per command execution. It does
+ * not iterate the command args function callout and so can be used
+ * for functions like "help" that should only ever be run once.
+ */
+#define CMD_FLAG_ONESHOT	(1u << 31)
+#define CMD_FLAG_FOREIGN_OK	(1u << 30) /* command not restricted to XFS */
+#define CMD_FLAG_LIBRARY	(1u << 29) /* command provided by libxcmd */
 
 typedef int (*cfunc_t)(int argc, char **argv);
 typedef void (*helpfunc_t)(void);
@@ -45,12 +51,13 @@ extern int		ncmds;
 extern void		help_init(void);
 extern void		quit_init(void);
 
-typedef int (*argsfunc_t)(int index);
+typedef int (*iterfunc_t)(int index);
 typedef int (*checkfunc_t)(const cmdinfo_t *ci);
 
 extern void		add_command(const cmdinfo_t *ci);
 extern void		add_user_command(char *optarg);
-extern void		add_args_command(argsfunc_t af);
+extern void		add_oneshot_user_command(char *optarg);
+extern void		add_command_iterator(iterfunc_t func);
 extern void		add_check_command(checkfunc_t cf);
 
 extern const cmdinfo_t	*find_command(const char *cmd);
diff -urpN xfsprogs-4.9.0/include/darwin.h xfsprogs-4.14.0/include/darwin.h
--- xfsprogs-4.9.0/include/darwin.h	2016-12-21 06:36:07.000000000 +0100
+++ xfsprogs-4.14.0/include/darwin.h	2017-11-27 17:57:55.000000000 +0100
@@ -125,19 +125,15 @@ typedef signed int		__s32;
 typedef unsigned long long int	__u64;
 typedef signed long long int	__s64;
 
-#define __int8_t	int8_t
-#define __int16_t	int16_t
-#define __int32_t	int32_t
-#define __int32_t	int32_t
-#define __int64_t	int64_t
-#define __uint8_t	u_int8_t
-#define __uint16_t	u_int16_t
-#define __uint32_t	u_int32_t
-#define __uint64_t	u_int64_t
+#define int8_t		int8_t
+#define int16_t		int16_t
+#define int32_t		int32_t
+#define int32_t		int32_t
+#define int64_t		int64_t
 
 typedef off_t		xfs_off_t;
-typedef u_int64_t	xfs_ino_t;
-typedef u_int32_t	xfs_dev_t;
+typedef uint64_t	xfs_ino_t;
+typedef uint32_t	xfs_dev_t;
 typedef int64_t		xfs_daddr_t;
 typedef __u32		xfs_nlink_t;
 
diff -urpN xfsprogs-4.9.0/include/freebsd.h xfsprogs-4.14.0/include/freebsd.h
--- xfsprogs-4.9.0/include/freebsd.h	2016-12-21 06:36:07.000000000 +0100
+++ xfsprogs-4.14.0/include/freebsd.h	2017-11-20 01:14:14.000000000 +0100
@@ -50,9 +50,9 @@ typedef unsigned long long int	__u64;
 typedef signed long long int	__s64;
 
 typedef off_t		xfs_off_t;
-typedef __uint64_t	xfs_ino_t;
-typedef __uint32_t	xfs_dev_t;
-typedef __int64_t	xfs_daddr_t;
+typedef uint64_t	xfs_ino_t;
+typedef uint32_t	xfs_dev_t;
+typedef int64_t		xfs_daddr_t;
 typedef __u32		xfs_nlink_t;
 
 #define	O_LARGEFILE	0
diff -urpN xfsprogs-4.9.0/include/gnukfreebsd.h xfsprogs-4.14.0/include/gnukfreebsd.h
--- xfsprogs-4.9.0/include/gnukfreebsd.h	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/include/gnukfreebsd.h	2017-11-20 01:14:14.000000000 +0100
@@ -46,9 +46,9 @@ typedef unsigned long long int	__u64;
 typedef signed long long int	__s64;
 
 typedef off_t		xfs_off_t;
-typedef __uint64_t	xfs_ino_t;
-typedef __uint32_t	xfs_dev_t;
-typedef __int64_t	xfs_daddr_t;
+typedef uint64_t	xfs_ino_t;
+typedef uint32_t	xfs_dev_t;
+typedef int64_t		xfs_daddr_t;
 typedef __u32		xfs_nlink_t;
 
 #define HAVE_FID	1
diff -urpN xfsprogs-4.9.0/include/input.h xfsprogs-4.14.0/include/input.h
--- xfsprogs-4.9.0/include/input.h	2017-01-05 18:41:55.000000000 +0100
+++ xfsprogs-4.14.0/include/input.h	2017-11-20 01:14:14.000000000 +0100
@@ -28,6 +28,15 @@ extern char	**breakline(char *input, int
 extern void	doneline(char *input, char **vec);
 extern char	*fetchline(void);
 
+extern int64_t	cvt_s64(char *s, int base);
+extern int32_t	cvt_s32(char *s, int base);
+extern int16_t	cvt_s16(char *s, int base);
+
+extern uint64_t	cvt_u64(char *s, int base);
+extern uint32_t	cvt_u32(char *s, int base);
+extern uint16_t	cvt_u16(char *s, int base);
+
+extern size_t numlen(uint64_t val, size_t base);
 extern long long cvtnum(size_t blocksize, size_t sectorsize, char *s);
 extern void	cvtstr(double value, char *str, size_t sz);
 extern unsigned long cvttime(char *s);
@@ -48,6 +57,7 @@ extern uid_t	uid_from_string(char *user)
 extern gid_t	gid_from_string(char *group);
 extern prid_t	prid_from_string(char *project);
 extern bool	isdigits_only(const char *str);
+extern int	timespec_from_string(const char *sec, const char *nsec, struct timespec *ts);
 
 #define HAVE_FTW_H 1	/* TODO: configure me */
 
diff -urpN xfsprogs-4.9.0/include/irix.h xfsprogs-4.14.0/include/irix.h
--- xfsprogs-4.9.0/include/irix.h	2016-12-21 06:36:07.000000000 +0100
+++ xfsprogs-4.14.0/include/irix.h	1970-01-01 01:00:00.000000000 +0100
@@ -1,491 +0,0 @@
-/*
- * Copyright (c) 2000-2006 Silicon Graphics, Inc.
- * All Rights Reserved.
- *
- * This program is free software; you can redistribute it and/or
- * modify it under the terms of the GNU Lesser General Public License
- * as published by the Free Software Foundation.
- *
- * This program is distributed in the hope that it would be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU Lesser General Public License for more details.
- *
- * You should have received a copy of the GNU Lesser General Public License
- * along with this program; if not, write the Free Software Foundation,
- * Inc.,  51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
- */
-#ifndef __XFS_IRIX_H__
-#define __XFS_IRIX_H__
-
-#include <stdlib.h>
-#include <unistd.h>
-#include <libgen.h>
-#include <values.h>
-#include <strings.h>
-#include <inttypes.h>
-#include <limits.h>
-#include <fcntl.h>
-#include <sys/stat.h>
-#include <sys/uuid.h>
-#include <sys/param.h>
-#include <sys/ioctl.h>
-#include <sys/types.h>
-#include <sys/statfs.h>
-#include <sys/statvfs.h>
-#include <sys/syssgi.h>
-#include <sys/sysmacros.h>
-#include <sys/fs/xfs_fsops.h>
-#include <sys/fs/xfs_itable.h>
-#include <mntent.h>
-
-#define __int8_t	char
-#define __int16_t	short
-#define __uint8_t	unsigned char
-#define __uint16_t	unsigned short
-
-typedef unsigned char		__u8;
-typedef signed char		__s8;
-typedef unsigned short		__u16;
-typedef signed short		__s16;
-typedef unsigned int		__u32;
-typedef signed int		__s32;
-typedef unsigned long long int	__u64;
-typedef signed long long int	__s64;
-
-typedef off_t		xfs_off_t;
-typedef __int64_t	xfs_ino_t;
-typedef __int32_t	xfs_dev_t;
-typedef __int64_t	xfs_daddr_t;
-typedef __u32		xfs_nlink_t;
-
-#define xfs_flock64	flock64
-#define xfs_flock64_t	struct flock64
-
-#define EFSBADCRC	991	/* Bad CRC detected */
-
-typedef struct xfs_error_injection {
-	__int32_t	fd;
-	__int32_t	errtag;
-} xfs_error_injection_t;
-
-/* --- xfs_fsop_*req - request data structures --- */
-
-typedef struct xfs_fsop_bulkreq {
-	ino64_t	*lastip;
-	__int32_t	icount;
-	xfs_bstat_t	*ubuffer;
-	__int32_t	*ocount;
-} xfs_fsop_bulkreq_t;
-
-typedef struct xfs_fsop_handlereq {
-	__u32		fd;		/* fd for FD_TO_HANDLE		*/
-	void		*path;		/* user pathname		*/
-	__u32		oflags;		/* open flags			*/
-	void		*ihandle;	/* user supplied handle		*/
-	__u32		ihandlen;	/* user supplied length		*/
-	void		*ohandle;	/* user buffer for handle	*/
-	__u32		*ohandlen;	/* user buffer length		*/
-} xfs_fsop_handlereq_t;
-
-typedef struct xfs_fsop_setdm_handlereq {
-	struct xfs_fsop_handlereq	hreq;	/* handle information	*/
-	struct fsdmidata		*data;	/* DMAPI data	*/
-} xfs_fsop_setdm_handlereq_t;
-
-typedef struct xfs_attrlist_cursor {
-	__u32		opaque[4];
-} xfs_attrlist_cursor_t;
-
-typedef struct xfs_fsop_attrlist_handlereq {
-	struct xfs_fsop_handlereq	hreq; /* handle interface structure */
-	struct xfs_attrlist_cursor	pos; /* opaque cookie, list offset */
-	__u32				flags;	/* which namespace to use */
-	__u32				buflen;	/* length of buffer supplied */
-	void				*buffer;	/* returned names */
-} xfs_fsop_attrlist_handlereq_t;
-
-typedef struct xfs_fsop_getparents_handlereq {
-	struct xfs_fsop_handlereq	hreq; /* handle interface structure */
-	struct xfs_attrlist_cursor	pos; /* opaque cookie, list offset */
-	__u32				buflen;	/* length of buffer supplied */
-	void				*buffer; /* returned data */
-	__u32				*ocount; /* return number of links */
-	__u32				*omore; /* return whether more to come */
-} xfs_fsop_getparents_handlereq_t;
-
-typedef struct xfs_attr_multiop {
-	__u32		am_opcode;
-	__s32		am_error;
-	void		*am_attrname;
-	void		*am_attrvalue;
-	__u32		am_length;
-	__u32		am_flags;
-} xfs_attr_multiop_t;
-
-typedef struct xfs_fsop_attrmulti_handlereq {
-	struct xfs_fsop_handlereq	hreq; /* handle interface structure */
-	__u32				opcount;/* count of following multiop */
-	struct xfs_attr_multiop		*ops; /* attr_multi data */
-} xfs_fsop_attrmulti_handlereq_t;
-
-/* start doing packed stuctures here */
-#define HAVE_FORMAT32	1
-#pragma pack 1
-typedef struct xfs_inode_log_format_32 {
-	__u16			ilf_type;	/* inode log item type */
-	__u16			ilf_size;	/* size of this item */
-	__u32			ilf_fields;	/* flags for fields logged */
-	__u16			ilf_asize;	/* size of attr d/ext/root */
-	__u16			ilf_dsize;	/* size of data/ext/root */
-	__u64			ilf_ino;	/* inode number */
-	union {
-		__u32		ilfu_rdev;	/* rdev value for dev inode*/
-		uuid_t		ilfu_uuid;	/* mount point value */
-	} ilf_u;
-	__s64			ilf_blkno;	/* blkno of inode buffer */
-	__s32			ilf_len;	/* len of inode buffer */
-	__s32			ilf_boffset;	/* off of inode in buffer */
-} xfs_inode_log_format_32_t;
-
-typedef struct xfs_extent_32 {
-	__u64	ext_start;
-	__u32	ext_len;
-} xfs_extent_32_t;
-
-typedef struct xfs_efi_log_format_32 {
-	__u16			efi_type;	/* efi log item type */
-	__u16			efi_size;	/* size of this item */
-	__u32			efi_nextents;	/* # extents to free */
-	__u64			efi_id;		/* efi identifier */
-	xfs_extent_32_t		efi_extents[1];	/* array of extents to free */
-} xfs_efi_log_format_32_t;
-
-typedef struct xfs_efd_log_format_32 {
-	__u16			efd_type;	/* efd log item type */
-	__u16			efd_size;	/* size of this item */
-	__u32			efd_nextents;	/* # of extents freed */
-	__u64			efd_efi_id;	/* id of corresponding efi */
-	xfs_extent_32_t		efd_extents[1];	/* array of extents freed */
-} xfs_efd_log_format_32_t;
-
-#pragma pack 0
-/* end of packed stuctures */
-
-#include <sys/endian.h>
-#define __BYTE_ORDER	BYTE_ORDER
-#define __BIG_ENDIAN	BIG_ENDIAN
-#define __LITTLE_ENDIAN	LITTLE_ENDIAN
-
-/* Map some gcc macros for the MipsPRO compiler */
-#ifndef __GNUC__
-#define __builtin_constant_p(x)	(0)
-#define __FUNCTION__	"XFS"
-#define __sgi__		__sgi
-#define __inline__	__inline
-#define inline		__inline
-#endif
-
-/*ARGSUSED*/
-static __inline__ int xfsctl(const char *path, int fd, int cmd, void *arg)
-{
-	if (cmd >= 0 && cmd < XFS_FSOPS_COUNT) {
-		/*
-		 * We have a problem in that xfsctl takes 1 arg but
-		 * some sgi xfs ops take an input arg and/or an output arg
-		 * So have to special case the ops to decide if xfsctl arg
-		 * is an input or an output argument.
-		 */
-		if (cmd == XFS_FS_GOINGDOWN)
-			return syssgi(SGI_XFS_FSOPERATIONS, fd, cmd, arg, 0);
-		return syssgi(SGI_XFS_FSOPERATIONS, fd, cmd, 0, arg);
-	}
-	switch (cmd) {
-		case SGI_FS_INUMBERS:
-		case SGI_FS_BULKSTAT:
-			return syssgi(cmd, fd,
-					((xfs_fsop_bulkreq_t*)arg)->lastip,
-					((xfs_fsop_bulkreq_t*)arg)->icount,
-					((xfs_fsop_bulkreq_t*)arg)->ubuffer,
-					((xfs_fsop_bulkreq_t*)arg)->ocount);
-		case SGI_FS_BULKSTAT_SINGLE:
-			return syssgi(SGI_FS_BULKSTAT_SINGLE, fd,
-					((xfs_fsop_bulkreq_t*)arg)->lastip,
-					((xfs_fsop_bulkreq_t*)arg)->ubuffer);
-		case SGI_XFS_INJECT_ERROR:
-			return syssgi(SGI_XFS_INJECT_ERROR,
-					((xfs_error_injection_t*)arg)->errtag,
-					fd);
-		case SGI_XFS_CLEARALL_ERROR:
-			return syssgi(SGI_XFS_CLEARALL_ERROR, fd);
-		case SGI_PATH_TO_HANDLE:
-		case SGI_PATH_TO_FSHANDLE:
-			return syssgi(cmd,
-					((xfs_fsop_handlereq_t*)arg)->path,
-					((xfs_fsop_handlereq_t*)arg)->ohandle,
-					((xfs_fsop_handlereq_t*)arg)->ohandlen);
-		case SGI_FD_TO_HANDLE:
-			return syssgi(cmd,
-					((xfs_fsop_handlereq_t*)arg)->fd,
-					((xfs_fsop_handlereq_t*)arg)->ohandle,
-					((xfs_fsop_handlereq_t*)arg)->ohandlen);
-		case SGI_OPEN_BY_HANDLE:
-			return syssgi(cmd,
-					((xfs_fsop_handlereq_t*)arg)->ihandle,
-					((xfs_fsop_handlereq_t*)arg)->ihandlen,
-					((xfs_fsop_handlereq_t*)arg)->oflags);
-		case SGI_READLINK_BY_HANDLE:
-			return syssgi(cmd,
-					((xfs_fsop_handlereq_t*)arg)->ihandle,
-					((xfs_fsop_handlereq_t*)arg)->ihandlen,
-					((xfs_fsop_handlereq_t*)arg)->ohandle,
-					((xfs_fsop_handlereq_t*)arg)->ohandlen);
-		case SGI_ATTR_LIST_BY_HANDLE:
-			return syssgi(cmd,
-					((xfs_fsop_attrlist_handlereq_t*)arg)->hreq.ihandle,
-					((xfs_fsop_attrlist_handlereq_t*)arg)->hreq.ihandlen,
-					((xfs_fsop_attrlist_handlereq_t*)arg)->buffer,
-					((xfs_fsop_attrlist_handlereq_t*)arg)->buflen,
-					((xfs_fsop_attrlist_handlereq_t*)arg)->flags,
-					&(((xfs_fsop_attrlist_handlereq_t*)arg)->pos));
-		case SGI_XFS_GETPARENTS:
-		case SGI_XFS_GETPARENTPATHS:
-			return syssgi(cmd,
-					((xfs_fsop_getparents_handlereq_t*)arg)->hreq.ihandle,
-					((xfs_fsop_getparents_handlereq_t*)arg)->hreq.ihandlen,
-					((xfs_fsop_getparents_handlereq_t*)arg)->buffer,
-					((xfs_fsop_getparents_handlereq_t*)arg)->buflen,
-					&(((xfs_fsop_getparents_handlereq_t*)arg)->pos),
-					((xfs_fsop_getparents_handlereq_t*)arg)->ocount,
-					((xfs_fsop_getparents_handlereq_t*)arg)->omore);
-		case SGI_ATTR_MULTI_BY_HANDLE:
-			return syssgi(cmd,
-					((xfs_fsop_attrmulti_handlereq_t*)arg)->hreq.ihandle,
-					((xfs_fsop_attrmulti_handlereq_t*)arg)->hreq.ihandlen,
-					((xfs_fsop_attrmulti_handlereq_t*)arg)->ops,
-					((xfs_fsop_attrmulti_handlereq_t*)arg)->opcount,
-					((xfs_fsop_attrmulti_handlereq_t*)arg)->hreq.oflags);
-		case SGI_FSSETDM_BY_HANDLE:
-			return syssgi(cmd,
-					((xfs_fsop_setdm_handlereq_t*)arg)->hreq.ihandle,
-					((xfs_fsop_setdm_handlereq_t*)arg)->hreq.ihandlen,
-					((xfs_fsop_setdm_handlereq_t*)arg)->data);
-	}
-	return fcntl(fd, cmd, arg);
-}
-
-static __inline__ int platform_test_xfs_fd(int fd)
-{
-	struct statvfs sbuf;
-	if (fstatvfs(fd, &sbuf) < 0)
-		return 0;
-	return strncmp(sbuf.f_basetype, "xfs", 4) == 0;
-}
-
-static __inline__ int platform_test_xfs_path(const char *path)
-{
-	struct statvfs sbuf;
-	if (statvfs(path, &sbuf) < 0)
-		return 0;
-	return strncmp(sbuf.f_basetype, "xfs", 4) == 0;
-}
-
-static __inline__ int platform_fstatfs(int fd, struct statfs *buf)
-{
-	return fstatfs(fd, buf, sizeof(struct statfs), 0);
-}
-
-static __inline__ void platform_getoptreset(void)
-{
-	getoptreset();
-}
-
-static __inline__ int platform_uuid_compare(uuid_t *uu1, uuid_t *uu2)
-{
-	__uint32_t status;
-	return uuid_compare(uu1, uu2, &status);
-}
-
-static __inline__ void platform_uuid_unparse(uuid_t *uu, char *buffer)
-{
-	__uint32_t status;
-	char *s;
-	uuid_to_string(uu, &s, &status);
-	if (status == uuid_s_ok)
-		strcpy(buffer, s);
-	else buffer[0] = '\0';
-	free(s);
-}
-
-static __inline__ int platform_uuid_parse(char *buffer, uuid_t *uu)
-{
-	__uint32_t status;
-	uuid_from_string(buffer, uu, &status);
-	return (status == uuid_s_ok);
-}
-
-static __inline__ int platform_uuid_is_null(uuid_t *uu)
-{
-	uint status;
-	return uuid_is_nil(uu, &status);
-}
-
-static __inline__ void platform_uuid_generate(uuid_t *uu)
-{
-	__uint32_t status;
-	uuid_create(uu, &status);
-}
-
-static __inline__ void platform_uuid_clear(uuid_t *uu)
-{
-	__uint32_t status;
-	uuid_create_nil(uu, &status);
-}
-
-static __inline__ void platform_uuid_copy(uuid_t *dst, uuid_t *src)
-{
-	memcpy(dst, src, sizeof(uuid_t));
-}
-
-static __inline__ int
-platform_discard_blocks(int fd, uint64_t start, uint64_t len)
-{
-	return 0;
-}
-
-static __inline__ char * strsep(char **s, const char *ct)
-{
-	char *sbegin = *s, *end;
-
-	if (!sbegin)
-		return NULL;
-	end = strpbrk(sbegin, ct);
-	if (end)
-		*end++ = '\0';
-	*s = end;
-	return sbegin;
-}
-
-#define HAVE_DIOATTR	1
-#define HAVE_FSXATTR	1
-#define HAVE_GETBMAP	1
-#define HAVE_GETBMAPX	1
-#define HAVE_FSDMIDATA	1
-#define HAVE_FID	1
-#define HAVE_IOCMACROS	1
-#define HAVE_BBMACROS	1
-
-#define __XFS_FS_H__	1
-
-#define XFS_IOC_DIOINFO			F_DIOINFO
-#define XFS_IOC_ALLOCSP64		F_ALLOCSP64
-#define XFS_IOC_FREESP64		F_FREESP64
-#define XFS_IOC_GETBMAP			F_GETBMAP
-#define XFS_IOC_FSSETDM			F_FSSETDM
-#define XFS_IOC_RESVSP			F_RESVSP
-#define XFS_IOC_RESVSP64		F_RESVSP64
-#define XFS_IOC_UNRESVSP		F_UNRESVSP
-#define XFS_IOC_UNRESVSP64		F_UNRESVSP64
-#define XFS_IOC_GETBMAPA		F_GETBMAPA
-#define XFS_IOC_FSGETXATTRA		F_FSGETXATTRA
-#define XFS_IOC_GETBMAPX		F_GETBMAPX
-
-#define XFS_IOC_FSGEOMETRY_V1		XFS_FS_GEOMETRY
-#define XFS_IOC_FSBULKSTAT		SGI_FS_BULKSTAT
-#define XFS_IOC_FSBULKSTAT_SINGLE	SGI_FS_BULKSTAT_SINGLE
-#define XFS_IOC_FSINUMBERS		SGI_FS_INUMBERS
-#define XFS_IOC_PATH_TO_FSHANDLE	SGI_PATH_TO_FSHANDLE
-#define XFS_IOC_PATH_TO_HANDLE		SGI_PATH_TO_HANDLE
-#define XFS_IOC_FD_TO_HANDLE		SGI_FD_TO_HANDLE
-#define XFS_IOC_OPEN_BY_HANDLE		SGI_OPEN_BY_HANDLE
-#define XFS_IOC_READLINK_BY_HANDLE	SGI_READLINK_BY_HANDLE
-#define XFS_IOC_SWAPEXT			/* TODO */
-#define XFS_IOC_FSGROWFSDATA		XFS_GROWFS_DATA
-#define XFS_IOC_FSGROWFSLOG		XFS_GROWFS_LOG
-#define XFS_IOC_FSGROWFSRT		XFS_GROWFS_RT
-#define XFS_IOC_FSCOUNTS		XFS_FS_COUNTS
-#define XFS_IOC_SET_RESBLKS		XFS_SET_RESBLKS
-#define XFS_IOC_GET_RESBLKS		XFS_GET_RESBLKS
-#define XFS_IOC_ERROR_INJECTION		SGI_XFS_INJECT_ERROR
-#define XFS_IOC_ERROR_CLEARALL		SGI_XFS_CLEARALL_ERROR
-#define XFS_IOC_FREEZE			XFS_FS_FREEZE
-#define XFS_IOC_THAW			XFS_FS_THAW
-#define XFS_IOC_FSSETDM_BY_HANDLE	SGI_FSSETDM_BY_HANDLE
-#define XFS_IOC_ATTRLIST_BY_HANDLE	SGI_ATTR_LIST_BY_HANDLE
-#define XFS_IOC_ATTRMULTI_BY_HANDLE	SGI_ATTR_MULTI_BY_HANDLE
-#define XFS_IOC_FSGEOMETRY		XFS_FS_GEOMETRY
-#define XFS_IOC_GOINGDOWN		XFS_FS_GOINGDOWN
-#define XFS_IOC_GETPARENTS		SGI_XFS_GETPARENTS
-#define XFS_IOC_GETPARENTPATHS		SGI_XFS_GETPARENTPATHS
-
-#define	_AIOCB64_T_DEFINED		1
-
-/* check whether we have to define FS_IOC_FS[GS]ETXATTR ourselves */
-#ifndef HAVE_FSXATTR
-struct fsxattr {
-	__u32		fsx_xflags;	/* xflags field value (get/set) */
-	__u32		fsx_extsize;	/* extsize field value (get/set)*/
-	__u32		fsx_nextents;	/* nextents field value (get)	*/
-	__u32		fsx_projid;	/* project identifier (get/set) */
-	__u32		fsx_cowextsize;	/* cow extsize field value (get/set) */
-	unsigned char	fsx_pad[8];
-};
-
-/*
- * Flags for the fsx_xflags field
- */
-#define FS_XFLAG_REALTIME	0x00000001	/* data in realtime volume */
-#define FS_XFLAG_PREALLOC	0x00000002	/* preallocated file extents */
-#define FS_XFLAG_IMMUTABLE	0x00000008	/* file cannot be modified */
-#define FS_XFLAG_APPEND		0x00000010	/* all writes append */
-#define FS_XFLAG_SYNC		0x00000020	/* all writes synchronous */
-#define FS_XFLAG_NOATIME	0x00000040	/* do not update access time */
-#define FS_XFLAG_NODUMP		0x00000080	/* do not include in backups */
-#define FS_XFLAG_RTINHERIT	0x00000100	/* create with rt bit set */
-#define FS_XFLAG_PROJINHERIT	0x00000200	/* create with parents projid */
-#define FS_XFLAG_NOSYMLINKS	0x00000400	/* disallow symlink creation */
-#define FS_XFLAG_EXTSIZE	0x00000800	/* extent size allocator hint */
-#define FS_XFLAG_EXTSZINHERIT	0x00001000	/* inherit inode extent size */
-#define FS_XFLAG_NODEFRAG	0x00002000	/* do not defragment */
-#define FS_XFLAG_FILESTREAM	0x00004000	/* use filestream allocator */
-#define FS_XFLAG_DAX		0x00008000	/* use DAX for IO */
-#define FS_XFLAG_HASATTR	0x80000000	/* no DIFLAG for this	*/
-
-#define FS_IOC_FSGETXATTR		F_FSGETXATTR
-#define FS_IOC_FSSETXATTR		F_FSSETXATTR
-
-#endif
-
-#ifndef FS_XFLAG_COWEXTSIZE
-#define FS_XFLAG_COWEXTSIZE	0x00010000	/* CoW extent size allocator hint */
-#endif
-
-/**
- * Abstraction of mountpoints.
- */
-struct mntent_cursor {
-	FILE *mtabp;
-};
-
-static inline int platform_mntent_open(struct mntent_cursor * cursor, char *mtab)
-{
-	cursor->mtabp = setmntent(mtab, "r");
-	if (!cursor->mtabp) {
-		fprintf(stderr, "Error: cannot read %s\n", mtab);
-		return 1;
-	}
-	return 0;
-}
-
-static inline struct mntent * platform_mntent_next(struct mntent_cursor * cursor)
-{
-	return getmntent(cursor->mtabp);
-}
-
-static inline void platform_mntent_close(struct mntent_cursor * cursor)
-{
-	endmntent(cursor->mtabp);
-}
-
-
-#endif	/* __XFS_IRIX_H__ */
diff -urpN xfsprogs-4.9.0/include/libxcmd.h xfsprogs-4.14.0/include/libxcmd.h
--- xfsprogs-4.9.0/include/libxcmd.h	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/include/libxcmd.h	2017-11-20 01:14:14.000000000 +0100
@@ -42,10 +42,10 @@ get_topology(
 extern void
 calc_default_ag_geometry(
 	int		blocklog,
-	__uint64_t	dblocks,
+	uint64_t	dblocks,
 	int		multidisk,
-	__uint64_t	*agsize,
-	__uint64_t	*agcount);
+	uint64_t	*agsize,
+	uint64_t	*agcount);
 
 extern int
 check_overwrite(
diff -urpN xfsprogs-4.9.0/include/linux.h xfsprogs-4.14.0/include/linux.h
--- xfsprogs-4.9.0/include/linux.h	2016-12-21 06:36:07.000000000 +0100
+++ xfsprogs-4.14.0/include/linux.h	2017-11-20 01:14:14.000000000 +0100
@@ -132,7 +132,7 @@ static __inline__ void platform_uuid_cop
 static __inline__ int
 platform_discard_blocks(int fd, uint64_t start, uint64_t len)
 {
-	__uint64_t range[2] = { start, len };
+	uint64_t range[2] = { start, len };
 
 	if (ioctl(fd, BLKDISCARD, &range) < 0)
 		return errno;
@@ -144,9 +144,9 @@ platform_discard_blocks(int fd, uint64_t
 #define EFSBADCRC	EBADMSG	/* Bad CRC detected */
 
 typedef off_t		xfs_off_t;
-typedef __uint64_t	xfs_ino_t;
-typedef __uint32_t	xfs_dev_t;
-typedef __int64_t	xfs_daddr_t;
+typedef uint64_t	xfs_ino_t;
+typedef uint32_t	xfs_dev_t;
+typedef int64_t		xfs_daddr_t;
 typedef __u32		xfs_nlink_t;
 
 /**
@@ -222,4 +222,109 @@ struct fsxattr {
 #define FS_XFLAG_COWEXTSIZE	0x00010000	/* CoW extent size allocator hint */
 #endif
 
+#ifdef HAVE_GETFSMAP
+# include <linux/fsmap.h>
+#else
+/*
+ *	Structure for FS_IOC_GETFSMAP.
+ *
+ *	The memory layout for this call are the scalar values defined in
+ *	struct fsmap_head, followed by two struct fsmap that describe
+ *	the lower and upper bound of mappings to return, followed by an
+ *	array of struct fsmap mappings.
+ *
+ *	fmh_iflags control the output of the call, whereas fmh_oflags report
+ *	on the overall record output.  fmh_count should be set to the
+ *	length of the fmh_recs array, and fmh_entries will be set to the
+ *	number of entries filled out during each call.  If fmh_count is
+ *	zero, the number of reverse mappings will be returned in
+ *	fmh_entries, though no mappings will be returned.  fmh_reserved
+ *	must be set to zero.
+ *
+ *	The two elements in the fmh_keys array are used to constrain the
+ *	output.  The first element in the array should represent the
+ *	lowest disk mapping ("low key") that the user wants to learn
+ *	about.  If this value is all zeroes, the filesystem will return
+ *	the first entry it knows about.  For a subsequent call, the
+ *	contents of fsmap_head.fmh_recs[fsmap_head.fmh_count - 1] should be
+ *	copied into fmh_keys[0] to have the kernel start where it left off.
+ *
+ *	The second element in the fmh_keys array should represent the
+ *	highest disk mapping ("high key") that the user wants to learn
+ *	about.  If this value is all ones, the filesystem will not stop
+ *	until it runs out of mapping to return or runs out of space in
+ *	fmh_recs.
+ *
+ *	fmr_device can be either a 32-bit cookie representing a device, or
+ *	a 32-bit dev_t if the FMH_OF_DEV_T flag is set.  fmr_physical,
+ *	fmr_offset, and fmr_length are expressed in units of bytes.
+ *	fmr_owner is either an inode number, or a special value if
+ *	FMR_OF_SPECIAL_OWNER is set in fmr_flags.
+ */
+struct fsmap {
+	__u32		fmr_device;	/* device id */
+	__u32		fmr_flags;	/* mapping flags */
+	__u64		fmr_physical;	/* device offset of segment */
+	__u64		fmr_owner;	/* owner id */
+	__u64		fmr_offset;	/* file offset of segment */
+	__u64		fmr_length;	/* length of segment */
+	__u64		fmr_reserved[3];	/* must be zero */
+};
+
+struct fsmap_head {
+	__u32		fmh_iflags;	/* control flags */
+	__u32		fmh_oflags;	/* output flags */
+	__u32		fmh_count;	/* # of entries in array incl. input */
+	__u32		fmh_entries;	/* # of entries filled in (output). */
+	__u64		fmh_reserved[6];	/* must be zero */
+
+	struct fsmap	fmh_keys[2];	/* low and high keys for the mapping search */
+	struct fsmap	fmh_recs[];	/* returned records */
+};
+
+/* Size of an fsmap_head with room for nr records. */
+static inline size_t
+fsmap_sizeof(
+	unsigned int	nr)
+{
+	return sizeof(struct fsmap_head) + nr * sizeof(struct fsmap);
+}
+
+/* Start the next fsmap query at the end of the current query results. */
+static inline void
+fsmap_advance(
+	struct fsmap_head	*head)
+{
+	head->fmh_keys[0] = head->fmh_recs[head->fmh_entries - 1];
+}
+
+/*	fmh_iflags values - set by XFS_IOC_GETFSMAP caller in the header. */
+/* no flags defined yet */
+#define FMH_IF_VALID		0
+
+/*	fmh_oflags values - returned in the header segment only. */
+#define FMH_OF_DEV_T		0x1	/* fmr_device values will be dev_t */
+
+/*	fmr_flags values - returned for each non-header segment */
+#define FMR_OF_PREALLOC		0x1	/* segment = unwritten pre-allocation */
+#define FMR_OF_ATTR_FORK	0x2	/* segment = attribute fork */
+#define FMR_OF_EXTENT_MAP	0x4	/* segment = extent map */
+#define FMR_OF_SHARED		0x8	/* segment = shared with another file */
+#define FMR_OF_SPECIAL_OWNER	0x10	/* owner is a special value */
+#define FMR_OF_LAST		0x20	/* segment is the last in the FS */
+
+/* Each FS gets to define its own special owner codes. */
+#define FMR_OWNER(type, code)	(((__u64)type << 32) | \
+				 ((__u64)code & 0xFFFFFFFFULL))
+#define FMR_OWNER_TYPE(owner)	((__u32)((__u64)owner >> 32))
+#define FMR_OWNER_CODE(owner)	((__u32)(((__u64)owner & 0xFFFFFFFFULL)))
+#define FMR_OWN_FREE		FMR_OWNER(0, 1) /* free space */
+#define FMR_OWN_UNKNOWN		FMR_OWNER(0, 2) /* unknown owner */
+#define FMR_OWN_METADATA	FMR_OWNER(0, 3) /* metadata */
+
+#define FS_IOC_GETFSMAP		_IOWR('X', 59, struct fsmap_head)
+
+#define HAVE_GETFSMAP
+#endif /* HAVE_GETFSMAP */
+
 #endif	/* __XFS_LINUX_H__ */
diff -urpN xfsprogs-4.9.0/include/path.h xfsprogs-4.14.0/include/path.h
--- xfsprogs-4.9.0/include/path.h	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/include/path.h	2017-11-20 01:14:14.000000000 +0100
@@ -56,6 +56,7 @@ extern void fs_table_insert_project_path
 
 
 extern fs_path_t *fs_table_lookup(const char *__dir, uint __flags);
+extern fs_path_t *fs_table_lookup_mount(const char *__dir);
 
 typedef struct fs_cursor {
 	uint		count;		/* total count of mount entries	*/
diff -urpN xfsprogs-4.9.0/include/xfs.h xfsprogs-4.14.0/include/xfs.h
--- xfsprogs-4.9.0/include/xfs.h	2016-12-21 06:36:07.000000000 +0100
+++ xfsprogs-4.14.0/include/xfs.h	2017-11-20 01:14:14.000000000 +0100
@@ -41,8 +41,6 @@
 #include <xfs/gnukfreebsd.h>
 #elif defined(__APPLE__)
 #include <xfs/darwin.h>
-#elif defined(__sgi__) || defined(__sgi)
-#include <xfs/irix.h>
 #else
 # error unknown platform... have fun porting!
 #endif
diff -urpN xfsprogs-4.9.0/include/xfs_arch.h xfsprogs-4.14.0/include/xfs_arch.h
--- xfsprogs-4.9.0/include/xfs_arch.h	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/include/xfs_arch.h	2017-11-27 17:57:55.000000000 +0100
@@ -25,10 +25,14 @@
 #endif
 
 #ifdef __CHECKER__
-#define __bitwise		__attribute__((bitwise))
+# ifndef __bitwise
+#  define __bitwise		__attribute__((bitwise))
+# endif
 #define __force			__attribute__((force))
 #else
-#define __bitwise
+# ifndef __bitwise
+#  define __bitwise
+# endif
 #define __force
 #endif
 
@@ -240,39 +244,39 @@ static inline void be64_add_cpu(__be64 *
 	*a = cpu_to_be64(be64_to_cpu(*a) + b);
 }
 
-static inline __uint16_t get_unaligned_be16(void *p)
+static inline uint16_t get_unaligned_be16(void *p)
 {
-	__uint8_t *__p = p;
+	uint8_t *__p = p;
 	return __p[0] << 8 | __p[1];
 }
 
-static inline __uint32_t get_unaligned_be32(void *p)
+static inline uint32_t get_unaligned_be32(void *p)
 {
-	__uint8_t *__p = p;
-        return __p[0] << 24 | __p[1] << 16 | __p[2] << 8 | __p[3];
+	uint8_t *__p = p;
+        return (uint32_t)__p[0] << 24 | __p[1] << 16 | __p[2] << 8 | __p[3];
 }
 
-static inline __uint64_t get_unaligned_be64(void *p)
+static inline uint64_t get_unaligned_be64(void *p)
 {
-	return (__uint64_t)get_unaligned_be32(p) << 32 |
+	return (uint64_t)get_unaligned_be32(p) << 32 |
 			   get_unaligned_be32(p + 4);
 }
 
-static inline void put_unaligned_be16(__uint16_t val, void *p)
+static inline void put_unaligned_be16(uint16_t val, void *p)
 {
-	__uint8_t *__p = p;
+	uint8_t *__p = p;
 	*__p++ = val >> 8;
 	*__p++ = val;
 }
 
-static inline void put_unaligned_be32(__uint32_t val, void *p)
+static inline void put_unaligned_be32(uint32_t val, void *p)
 {
-	__uint8_t *__p = p;
+	uint8_t *__p = p;
 	put_unaligned_be16(val >> 16, __p);
 	put_unaligned_be16(val, __p + 2);
 }
 
-static inline void put_unaligned_be64(__uint64_t val, void *p)
+static inline void put_unaligned_be64(uint64_t val, void *p)
 {
 	put_unaligned_be32(val >> 32, p);
 	put_unaligned_be32(val, p + 4);
diff -urpN xfsprogs-4.9.0/include/xfs_inode.h xfsprogs-4.14.0/include/xfs_inode.h
--- xfsprogs-4.9.0/include/xfs_inode.h	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/include/xfs_inode.h	2017-11-27 17:57:55.000000000 +0100
@@ -65,11 +65,24 @@ typedef struct xfs_inode {
 	struct inode		i_vnode;
 } xfs_inode_t;
 
+/* Convert from vfs inode to xfs inode */
+static inline struct xfs_inode *XFS_I(struct inode *inode)
+{
+	return container_of(inode, struct xfs_inode, i_vnode);
+}
+
+/* convert from xfs inode to vfs inode */
 static inline struct inode *VFS_I(struct xfs_inode *ip)
 {
 	return &ip->i_vnode;
 }
 
+/* We only have i_size in the xfs inode in userspace */
+static inline loff_t i_size_read(struct inode *inode)
+{
+	return XFS_I(inode)->i_size;
+}
+
 /*
  * wrappers around the mode checks to simplify code
  */
@@ -123,8 +136,8 @@ xfs_get_projid(struct xfs_icdinode *id)
 static inline void
 xfs_set_projid(struct xfs_icdinode *id, prid_t projid)
 {
-	id->di_projid_hi = (__uint16_t) (projid >> 16);
-	id->di_projid_lo = (__uint16_t) (projid & 0xffff);
+	id->di_projid_hi = (uint16_t) (projid >> 16);
+	id->di_projid_lo = (uint16_t) (projid & 0xffff);
 }
 
 static inline bool xfs_is_reflink_inode(struct xfs_inode *ip)
diff -urpN xfsprogs-4.9.0/include/xfs_log_recover.h xfsprogs-4.14.0/include/xfs_log_recover.h
--- xfsprogs-4.9.0/include/xfs_log_recover.h	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/include/xfs_log_recover.h	2017-11-20 01:14:14.000000000 +0100
@@ -26,7 +26,7 @@
 #define XLOG_RHASH_SIZE	16
 #define XLOG_RHASH_SHIFT 2
 #define XLOG_RHASH(tid)	\
-	((((__uint32_t)tid)>>XLOG_RHASH_SHIFT) & (XLOG_RHASH_SIZE-1))
+	((((uint32_t)tid)>>XLOG_RHASH_SHIFT) & (XLOG_RHASH_SIZE-1))
 
 #define XLOG_MAX_REGIONS_IN_ITEM   (XFS_MAX_BLOCKSIZE / XFS_BLF_CHUNK / 2 + 1)
 
@@ -42,7 +42,6 @@ typedef struct xlog_recover_item {
 	xfs_log_iovec_t		*ri_buf;	/* ptr to regions buffer */
 } xlog_recover_item_t;
 
-struct xlog_tid;
 typedef struct xlog_recover {
 	struct hlist_node	r_list;
 	xlog_tid_t		r_log_tid;	/* log's transaction id */
diff -urpN xfsprogs-4.9.0/include/xfs_metadump.h xfsprogs-4.14.0/include/xfs_metadump.h
--- xfsprogs-4.9.0/include/xfs_metadump.h	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/include/xfs_metadump.h	2017-11-20 01:14:14.000000000 +0100
@@ -24,9 +24,15 @@
 typedef struct xfs_metablock {
 	__be32		mb_magic;
 	__be16		mb_count;
-	__uint8_t	mb_blocklog;
-	__uint8_t	mb_reserved;
+	uint8_t		mb_blocklog;
+	uint8_t		mb_info;
 	/* followed by an array of xfs_daddr_t */
 } xfs_metablock_t;
 
+/* These flags are informational only, not backwards compatible */
+#define XFS_METADUMP_INFO_FLAGS	(1 << 0) /* This image has informative flags */
+#define XFS_METADUMP_OBFUSCATED	(1 << 1)
+#define XFS_METADUMP_FULLBLOCKS	(1 << 2)
+#define XFS_METADUMP_DIRTYLOG	(1 << 3)
+
 #endif /* _XFS_METADUMP_H_ */
diff -urpN xfsprogs-4.9.0/include/xfs_mount.h xfsprogs-4.14.0/include/xfs_mount.h
--- xfsprogs-4.9.0/include/xfs_mount.h	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/include/xfs_mount.h	2017-11-20 01:14:14.000000000 +0100
@@ -48,12 +48,12 @@ typedef struct xfs_mount {
 #define m_dev		m_ddev_targp
 #define m_logdev	m_logdev_targp
 #define m_rtdev		m_rtdev_targp
-	__uint8_t		m_dircook_elog;	/* log d-cookie entry bits */
-	__uint8_t		m_blkbit_log;	/* blocklog + NBBY */
-	__uint8_t		m_blkbb_log;	/* blocklog - BBSHIFT */
-	__uint8_t		m_sectbb_log;	/* sectorlog - BBSHIFT */
-	__uint8_t		m_agno_log;	/* log #ag's */
-	__uint8_t		m_agino_log;	/* #bits for agino in inum */
+	uint8_t			m_dircook_elog;	/* log d-cookie entry bits */
+	uint8_t			m_blkbit_log;	/* blocklog + NBBY */
+	uint8_t			m_blkbb_log;	/* blocklog - BBSHIFT */
+	uint8_t			m_sectbb_log;	/* sectorlog - BBSHIFT */
+	uint8_t			m_agno_log;	/* log #ag's */
+	uint8_t			m_agino_log;	/* #bits for agino in inum */
 	uint			m_inode_cluster_size;/* min inode buf size */
 	uint			m_blockmask;	/* sb_blocksize-1 */
 	uint			m_blockwsize;	/* sb_blocksize in words */
@@ -78,6 +78,7 @@ typedef struct xfs_mount {
 	uint			m_ag_max_usable; /* max space per AG */
 	struct radix_tree_root	m_perag_tree;
 	uint			m_flags;	/* global mount flags */
+	bool			m_inotbt_nores; /* no per-AG finobt resv. */
 	uint			m_qflags;	/* quota status flags */
 	uint			m_attroffset;	/* inode attribute offset */
 	int			m_ialloc_inos;	/* inodes in inode allocation */
@@ -87,7 +88,7 @@ typedef struct xfs_mount {
 	int			m_litino;	/* size of inode union area */
 	int			m_inoalign_mask;/* mask sb_inoalignmt if used */
 	struct xfs_trans_resv	m_resv;		/* precomputed res values */
-	__uint64_t		m_maxicount;	/* maximum inode count */
+	uint64_t		m_maxicount;	/* maximum inode count */
 	int			m_dalign;	/* stripe unit */
 	int			m_swidth;	/* stripe width */
 	int			m_sinoalign;	/* stripe unit inode alignmnt */
@@ -143,12 +144,12 @@ typedef struct xfs_perag {
 	char		pagi_init;	/* this agi's entry is initialized */
 	char		pagf_metadata;	/* the agf is preferred to be metadata */
 	char		pagi_inodeok;	/* The agi is ok for inodes */
-	__uint8_t	pagf_levels[XFS_BTNUM_AGF];
+	uint8_t		pagf_levels[XFS_BTNUM_AGF];
 					/* # of levels in bno & cnt btree */
-	__uint32_t	pagf_flcount;	/* count of blocks in freelist */
+	uint32_t	pagf_flcount;	/* count of blocks in freelist */
 	xfs_extlen_t	pagf_freeblks;	/* total free blocks */
 	xfs_extlen_t	pagf_longest;	/* longest free space */
-	__uint32_t	pagf_btreeblks;	/* # of blocks held in AGF btrees */
+	uint32_t	pagf_btreeblks;	/* # of blocks held in AGF btrees */
 	xfs_agino_t	pagi_freecount;	/* number of free inodes */
 	xfs_agino_t	pagi_count;	/* number of allocated inodes */
 
@@ -168,7 +169,7 @@ typedef struct xfs_perag {
 	struct xfs_ag_resv	pag_agfl_resv;
 
 	/* reference count */
-	__uint8_t	pagf_refcount_level;
+	uint8_t		pagf_refcount_level;
 } xfs_perag_t;
 
 static inline struct xfs_ag_resv *
diff -urpN xfsprogs-4.9.0/include/xfs_multidisk.h xfsprogs-4.14.0/include/xfs_multidisk.h
--- xfsprogs-4.9.0/include/xfs_multidisk.h	2016-12-13 21:07:05.000000000 +0100
+++ xfsprogs-4.14.0/include/xfs_multidisk.h	2017-11-20 01:14:14.000000000 +0100
@@ -69,6 +69,6 @@ extern void res_failed (int err);
 extern int max_trans_res(unsigned long agsize, int crcs_enabled, int dirversion,
 		int sectorlog, int blocklog, int inodelog, int dirblocklog,
 		int logversion, int log_sunit, int finobt, int rmapbt,
-		int reflink);
+		int reflink, int inode_align);
 
 #endif	/* __XFS_MULTIDISK_H__ */
diff -urpN xfsprogs-4.9.0/include/xfs_trans.h xfsprogs-4.14.0/include/xfs_trans.h
--- xfsprogs-4.9.0/include/xfs_trans.h	2016-12-13 21:07:06.000000000 +0100
+++ xfsprogs-4.14.0/include/xfs_trans.h	2017-11-27 17:57:55.000000000 +0100
@@ -85,11 +85,12 @@ typedef struct xfs_trans {
 } xfs_trans_t;
 
 void	xfs_trans_init(struct xfs_mount *);
-int	xfs_trans_roll(struct xfs_trans **, struct xfs_inode *);
+int	xfs_trans_roll(struct xfs_trans **);
 
 int	libxfs_trans_alloc(struct xfs_mount *mp, struct xfs_trans_res *resp,
 			   uint blocks, uint rtextents, uint flags,
 			   struct xfs_trans **tpp);
+int	libxfs_trans_alloc_empty(struct xfs_mount *mp, struct xfs_trans **tpp);
 int	libxfs_trans_commit(struct xfs_trans *);
 void	libxfs_trans_cancel(struct xfs_trans *);
 struct xfs_buf *libxfs_trans_getsb(struct xfs_trans *, struct xfs_mount *, int);
@@ -100,6 +101,7 @@ void	libxfs_trans_ijoin(struct xfs_trans
 void	libxfs_trans_ijoin_ref(struct xfs_trans *, struct xfs_inode *, int);
 void	libxfs_trans_log_inode (struct xfs_trans *, struct xfs_inode *,
 				uint);
+int	libxfs_trans_roll_inode (struct xfs_trans **, struct xfs_inode *);
 
 void	libxfs_trans_brelse(struct xfs_trans *, struct xfs_buf *);
 void	libxfs_trans_binval(struct xfs_trans *, struct xfs_buf *);
@@ -107,6 +109,7 @@ void	libxfs_trans_bjoin(struct xfs_trans
 void	libxfs_trans_bhold(struct xfs_trans *, struct xfs_buf *);
 void	libxfs_trans_log_buf(struct xfs_trans *, struct xfs_buf *,
 				uint, uint);
+bool	libxfs_trans_ordered_buf(xfs_trans_t *, struct xfs_buf *);
 
 struct xfs_buf	*libxfs_trans_get_buf_map(struct xfs_trans *tp,
 					struct xfs_buftarg *btp,
diff -urpN xfsprogs-4.9.0/io/Makefile xfsprogs-4.14.0/io/Makefile
--- xfsprogs-4.9.0/io/Makefile	2017-01-05 18:41:55.000000000 +0100
+++ xfsprogs-4.14.0/io/Makefile	2017-11-27 17:57:55.000000000 +0100
@@ -9,9 +9,9 @@ LTCOMMAND = xfs_io
 LSRCFILES = xfs_bmap.sh xfs_freeze.sh xfs_mkfile.sh
 HFILES = init.h io.h
 CFILES = init.c \
-	attr.c bmap.c file.c freeze.c fsync.c getrusage.c imap.c link.c \
-	mmap.c open.c parent.c pread.c prealloc.c pwrite.c seek.c shutdown.c \
-	sync.c truncate.c reflink.c cowextsize.c
+	attr.c bmap.c cowextsize.c encrypt.c file.c freeze.c fsync.c \
+	getrusage.c imap.c link.c mmap.c open.c parent.c pread.c prealloc.c \
+	pwrite.c reflink.c seek.c shutdown.c stat.c sync.c truncate.c utimes.c
 
 LLDLIBS = $(LIBXCMD) $(LIBHANDLE) $(LIBPTHREAD)
 LTDEPENDENCIES = $(LIBXCMD) $(LIBHANDLE)
@@ -90,6 +90,10 @@ ifeq ($(HAVE_PREADV),yes)
 LCFLAGS += -DHAVE_PREADV -DHAVE_PWRITEV
 endif
 
+ifeq ($(HAVE_PWRITEV2),yes)
+LCFLAGS += -DHAVE_PWRITEV2
+endif
+
 ifeq ($(HAVE_READDIR),yes)
 CFILES += readdir.c
 LCFLAGS += -DHAVE_READDIR
@@ -99,6 +103,17 @@ ifeq ($(HAVE_MREMAP),yes)
 LCFLAGS += -DHAVE_MREMAP
 endif
 
+# On linux we get fsmap from the system or define it ourselves
+# so include this based on platform type.  If this reverts to only
+# the autoconf check w/o local definition, change to testing HAVE_GETFSMAP
+ifeq ($(PKG_PLATFORM),linux)
+CFILES += fsmap.c
+endif
+
+ifeq ($(HAVE_STATFS_FLAGS),yes)
+LCFLAGS += -DHAVE_STATFS_FLAGS
+endif
+
 default: depend $(LTCOMMAND)
 
 include $(BUILDRULES)
diff -urpN xfsprogs-4.9.0/io/attr.c xfsprogs-4.14.0/io/attr.c
--- xfsprogs-4.9.0/io/attr.c	2016-12-13 21:07:06.000000000 +0100
+++ xfsprogs-4.14.0/io/attr.c	2017-11-20 01:14:14.000000000 +0100
@@ -353,7 +353,7 @@ attr_init(void)
 	lsattr_cmd.args = _("[-R|-D|-a|-v]");
 	lsattr_cmd.argmin = 0;
 	lsattr_cmd.argmax = 1;
-	lsattr_cmd.flags = CMD_NOMAP_OK;
+	lsattr_cmd.flags = CMD_NOMAP_OK | CMD_FOREIGN_OK;
 	lsattr_cmd.oneline =
 		_("list extended inode flags set on the currently open file");
 	lsattr_cmd.help = lsattr_help;
diff -urpN xfsprogs-4.9.0/io/bmap.c xfsprogs-4.14.0/io/bmap.c
--- xfsprogs-4.9.0/io/bmap.c	2016-12-13 21:07:06.000000000 +0100
+++ xfsprogs-4.14.0/io/bmap.c	2017-11-20 01:14:14.000000000 +0100
@@ -18,6 +18,7 @@
 
 #include "platform_defs.h"
 #include "command.h"
+#include "input.h"
 #include "init.h"
 #include "io.h"
 
@@ -53,18 +54,6 @@ bmap_help(void)
 "\n"));
 }
 
-static int
-numlen(
-	off64_t	val)
-{
-	off64_t	tmp;
-	int	len;
-
-	for (len = 0, tmp = val; tmp > 0; tmp = tmp/10)
-		len++;
-	return (len == 0 ? 1 : len);
-}
-
 int
 bmap_f(
 	int			argc,
@@ -323,7 +312,7 @@ bmap_f(
 			if (map[i + 1].bmv_block == -1) {
 				foff_w = max(foff_w, strlen(rbuf));
 				tot_w = max(tot_w,
-					numlen(map[i+1].bmv_length));
+					numlen(map[i+1].bmv_length, 10));
 			} else {
 				snprintf(bbuf, sizeof(bbuf), "%lld..%lld",
 					(long long) map[i + 1].bmv_block,
@@ -344,10 +333,10 @@ bmap_f(
 					aoff_w = 0;
 				foff_w = max(foff_w, strlen(rbuf));
 				tot_w = max(tot_w,
-					numlen(map[i+1].bmv_length));
+					numlen(map[i+1].bmv_length, 10));
 			}
 		}
-		agno_w = is_rt ? 0 : max(MINAG_WIDTH, numlen(fsgeo.agcount));
+		agno_w = is_rt ? 0 : max(MINAG_WIDTH, numlen(fsgeo.agcount, 10));
 		printf("%4s: %-*s %-*s %*s %-*s %*s%s\n",
 			_("EXT"),
 			foff_w, _("FILE-OFFSET"),
diff -urpN xfsprogs-4.9.0/io/copy_file_range.c xfsprogs-4.14.0/io/copy_file_range.c
--- xfsprogs-4.9.0/io/copy_file_range.c	2016-12-21 06:36:07.000000000 +0100
+++ xfsprogs-4.14.0/io/copy_file_range.c	2017-11-20 01:14:14.000000000 +0100
@@ -49,8 +49,11 @@ copy_file_range(int fd, loff_t *src, lof
 
 	do {
 		ret = syscall(__NR_copy_file_range, fd, src, file->fd, dst, len, 0);
-		if (ret == -1)
+		if (ret == -1) {
+			perror("copy_range");
 			return errno;
+		} else if (ret == 0)
+			break;
 		len -= ret;
 	} while (len > 0);
 
@@ -118,7 +121,7 @@ copy_range_f(int argc, char **argv)
 	if (optind != argc - 1)
 		return command_usage(&copy_range_cmd);
 
-	fd = openfile(argv[optind], NULL, IO_READONLY, 0);
+	fd = openfile(argv[optind], NULL, IO_READONLY, 0, NULL);
 	if (fd < 0)
 		return 0;
 
diff -urpN xfsprogs-4.9.0/io/cowextsize.c xfsprogs-4.14.0/io/cowextsize.c
--- xfsprogs-4.9.0/io/cowextsize.c	2016-12-13 21:07:06.000000000 +0100
+++ xfsprogs-4.14.0/io/cowextsize.c	2017-11-20 01:14:14.000000000 +0100
@@ -50,7 +50,7 @@ get_cowextsize(const char *path, int fd)
 {
 	struct fsxattr	fsx;
 
-	if ((xfsctl(path, fd, XFS_IOC_FSGETXATTR, &fsx)) < 0) {
+	if ((xfsctl(path, fd, FS_IOC_FSGETXATTR, &fsx)) < 0) {
 		printf("%s: XFS_IOC_FSGETXATTR %s: %s\n",
 			progname, path, strerror(errno));
 		return 0;
@@ -69,7 +69,7 @@ set_cowextsize(const char *path, int fd,
 		perror("fstat64");
 		return 0;
 	}
-	if ((xfsctl(path, fd, XFS_IOC_FSGETXATTR, &fsx)) < 0) {
+	if ((xfsctl(path, fd, FS_IOC_FSGETXATTR, &fsx)) < 0) {
 		printf("%s: XFS_IOC_FSGETXATTR %s: %s\n",
 			progname, path, strerror(errno));
 		return 0;
@@ -83,7 +83,7 @@ set_cowextsize(const char *path, int fd,
 	}
 	fsx.fsx_cowextsize = extsz;
 
-	if ((xfsctl(path, fd, XFS_IOC_FSSETXATTR, &fsx)) < 0) {
+	if ((xfsctl(path, fd, FS_IOC_FSSETXATTR, &fsx)) < 0) {
 		printf("%s: XFS_IOC_FSSETXATTR %s: %s\n",
 			progname, path, strerror(errno));
 		return 0;
diff -urpN xfsprogs-4.9.0/io/encrypt.c xfsprogs-4.14.0/io/encrypt.c
--- xfsprogs-4.9.0/io/encrypt.c	1970-01-01 01:00:00.000000000 +0100
+++ xfsprogs-4.14.0/io/encrypt.c	2017-11-20 01:14:14.000000000 +0100
@@ -0,0 +1,303 @@
+/*
+ * Copyright (c) 2016 Google, Inc.  All Rights Reserved.
+ *
+ * Author: Eric Biggers <ebiggers@google.com>
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License as
+ * published by the Free Software Foundation.
+ *
+ * This program is distributed in the hope that it would be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write the Free Software Foundation,
+ * Inc.,  51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
+ */
+
+#include "platform_defs.h"
+#include "command.h"
+#include "init.h"
+#include "path.h"
+#include "io.h"
+
+#ifndef ARRAY_SIZE
+#define ARRAY_SIZE(x) (sizeof(x) / sizeof((x)[0]))
+#endif
+
+/*
+ * We may have to declare the fscrypt ioctls ourselves because someone may be
+ * compiling xfsprogs with old kernel headers.  And since some old versions of
+ * <linux/fs.h> declared the policy struct and ioctl numbers but not the flags
+ * and modes, our declarations must be split into two conditional blocks.
+ */
+
+/* Policy struct and ioctl numbers */
+#ifndef FS_IOC_SET_ENCRYPTION_POLICY
+#define FS_KEY_DESCRIPTOR_SIZE  8
+
+struct fscrypt_policy {
+	__u8 version;
+	__u8 contents_encryption_mode;
+	__u8 filenames_encryption_mode;
+	__u8 flags;
+	__u8 master_key_descriptor[FS_KEY_DESCRIPTOR_SIZE];
+} __attribute__((packed));
+
+#define FS_IOC_SET_ENCRYPTION_POLICY	_IOR('f', 19, struct fscrypt_policy)
+#define FS_IOC_GET_ENCRYPTION_PWSALT	_IOW('f', 20, __u8[16])
+#define FS_IOC_GET_ENCRYPTION_POLICY	_IOW('f', 21, struct fscrypt_policy)
+#endif /* FS_IOC_SET_ENCRYPTION_POLICY */
+
+/* Policy flags and encryption modes */
+#ifndef FS_ENCRYPTION_MODE_AES_256_XTS
+#define FS_POLICY_FLAGS_PAD_4		0x00
+#define FS_POLICY_FLAGS_PAD_8		0x01
+#define FS_POLICY_FLAGS_PAD_16		0x02
+#define FS_POLICY_FLAGS_PAD_32		0x03
+#define FS_POLICY_FLAGS_PAD_MASK	0x03
+#define FS_POLICY_FLAGS_VALID		0x03
+
+#define FS_ENCRYPTION_MODE_INVALID	0
+#define FS_ENCRYPTION_MODE_AES_256_XTS	1
+#define FS_ENCRYPTION_MODE_AES_256_GCM	2
+#define FS_ENCRYPTION_MODE_AES_256_CBC	3
+#define FS_ENCRYPTION_MODE_AES_256_CTS	4
+#endif /* FS_ENCRYPTION_MODE_AES_256_XTS */
+
+static cmdinfo_t get_encpolicy_cmd;
+static cmdinfo_t set_encpolicy_cmd;
+
+static void
+set_encpolicy_help(void)
+{
+	printf(_(
+"\n"
+" assign an encryption policy to the currently open file\n"
+"\n"
+" Examples:\n"
+" 'set_encpolicy' - assign policy with default key [0000000000000000]\n"
+" 'set_encpolicy 0000111122223333' - assign policy with specified key\n"
+"\n"
+" -c MODE -- contents encryption mode\n"
+" -n MODE -- filenames encryption mode\n"
+" -f FLAGS -- policy flags\n"
+" -v VERSION -- version of policy structure\n"
+"\n"
+" MODE can be numeric or one of the following predefined values:\n"
+"    AES-256-XTS, AES-256-CTS, AES-256-GCM, AES-256-CBC\n"
+" FLAGS and VERSION must be numeric.\n"
+"\n"
+" Note that it's only possible to set an encryption policy on an empty\n"
+" directory.  It's then inherited by new files and subdirectories.\n"
+"\n"));
+}
+
+static const struct {
+	__u8 mode;
+	const char *name;
+} available_modes[] = {
+	{FS_ENCRYPTION_MODE_AES_256_XTS, "AES-256-XTS"},
+	{FS_ENCRYPTION_MODE_AES_256_CTS, "AES-256-CTS"},
+	{FS_ENCRYPTION_MODE_AES_256_GCM, "AES-256-GCM"},
+	{FS_ENCRYPTION_MODE_AES_256_CBC, "AES-256-CBC"},
+};
+
+static bool
+parse_byte_value(const char *arg, __u8 *value_ret)
+{
+	long value;
+	char *tmp;
+
+	value = strtol(arg, &tmp, 0);
+	if (value < 0 || value > 255 || tmp == arg || *tmp != '\0')
+		return false;
+	*value_ret = value;
+	return true;
+}
+
+static bool
+parse_mode(const char *arg, __u8 *mode_ret)
+{
+	int i;
+
+	for (i = 0; i < ARRAY_SIZE(available_modes); i++) {
+		if (strcmp(arg, available_modes[i].name) == 0) {
+			*mode_ret = available_modes[i].mode;
+			return true;
+		}
+	}
+
+	return parse_byte_value(arg, mode_ret);
+}
+
+static const char *
+mode2str(__u8 mode)
+{
+	static char buf[32];
+	int i;
+
+	for (i = 0; i < ARRAY_SIZE(available_modes); i++)
+		if (mode == available_modes[i].mode)
+			return available_modes[i].name;
+
+	sprintf(buf, "0x%02x", mode);
+	return buf;
+}
+
+static const char *
+keydesc2str(__u8 master_key_descriptor[FS_KEY_DESCRIPTOR_SIZE])
+{
+	static char buf[2 * FS_KEY_DESCRIPTOR_SIZE + 1];
+	int i;
+
+	for (i = 0; i < FS_KEY_DESCRIPTOR_SIZE; i++)
+		sprintf(&buf[2 * i], "%02x", master_key_descriptor[i]);
+
+	return buf;
+}
+
+static int
+get_encpolicy_f(int argc, char **argv)
+{
+	struct fscrypt_policy policy;
+
+	if (ioctl(file->fd, FS_IOC_GET_ENCRYPTION_POLICY, &policy) < 0) {
+		fprintf(stderr, "%s: failed to get encryption policy: %s\n",
+			file->name, strerror(errno));
+		exitcode = 1;
+		return 0;
+	}
+
+	printf("Encryption policy for %s:\n", file->name);
+	printf("\tPolicy version: %u\n", policy.version);
+	printf("\tMaster key descriptor: %s\n",
+	       keydesc2str(policy.master_key_descriptor));
+	printf("\tContents encryption mode: %u (%s)\n",
+	       policy.contents_encryption_mode,
+	       mode2str(policy.contents_encryption_mode));
+	printf("\tFilenames encryption mode: %u (%s)\n",
+	       policy.filenames_encryption_mode,
+	       mode2str(policy.filenames_encryption_mode));
+	printf("\tFlags: 0x%02x\n", policy.flags);
+	return 0;
+}
+
+static int
+set_encpolicy_f(int argc, char **argv)
+{
+	int c;
+	struct fscrypt_policy policy;
+
+	/* Initialize the policy structure with default values */
+	memset(&policy, 0, sizeof(policy));
+	policy.contents_encryption_mode = FS_ENCRYPTION_MODE_AES_256_XTS;
+	policy.filenames_encryption_mode = FS_ENCRYPTION_MODE_AES_256_CTS;
+	policy.flags = FS_POLICY_FLAGS_PAD_16;
+
+	/* Parse options */
+	while ((c = getopt(argc, argv, "c:n:f:v:")) != EOF) {
+		switch (c) {
+		case 'c':
+			if (!parse_mode(optarg,
+					&policy.contents_encryption_mode)) {
+				fprintf(stderr, "invalid contents encryption "
+					"mode: %s\n", optarg);
+				return 0;
+			}
+			break;
+		case 'n':
+			if (!parse_mode(optarg,
+					&policy.filenames_encryption_mode)) {
+				fprintf(stderr, "invalid filenames encryption "
+					"mode: %s\n", optarg);
+				return 0;
+			}
+			break;
+		case 'f':
+			if (!parse_byte_value(optarg, &policy.flags)) {
+				fprintf(stderr, "invalid flags: %s\n", optarg);
+				return 0;
+			}
+			break;
+		case 'v':
+			if (!parse_byte_value(optarg, &policy.version)) {
+				fprintf(stderr, "invalid policy version: %s\n",
+					optarg);
+				return 0;
+			}
+			break;
+		default:
+			return command_usage(&set_encpolicy_cmd);
+		}
+	}
+	argc -= optind;
+	argv += optind;
+
+	if (argc > 1)
+		return command_usage(&set_encpolicy_cmd);
+
+	/* Parse key descriptor if specified */
+	if (argc > 0) {
+		const char *keydesc = argv[0];
+		char *tmp;
+		unsigned long long x;
+		int i;
+
+		if (strlen(keydesc) != FS_KEY_DESCRIPTOR_SIZE * 2) {
+			fprintf(stderr, "invalid key descriptor: %s\n",
+				keydesc);
+			return 0;
+		}
+
+		x = strtoull(keydesc, &tmp, 16);
+		if (tmp == keydesc || *tmp != '\0') {
+			fprintf(stderr, "invalid key descriptor: %s\n",
+				keydesc);
+			return 0;
+		}
+
+		for (i = 0; i < FS_KEY_DESCRIPTOR_SIZE; i++) {
+			policy.master_key_descriptor[i] = x >> 56;
+			x <<= 8;
+		}
+	}
+
+	/* Set the encryption policy */
+	if (ioctl(file->fd, FS_IOC_SET_ENCRYPTION_POLICY, &policy) < 0) {
+		fprintf(stderr, "%s: failed to set encryption policy: %s\n",
+			file->name, strerror(errno));
+		exitcode = 1;
+		return 0;
+	}
+
+	return 0;
+}
+
+void
+encrypt_init(void)
+{
+	get_encpolicy_cmd.name = "get_encpolicy";
+	get_encpolicy_cmd.cfunc = get_encpolicy_f;
+	get_encpolicy_cmd.argmin = 0;
+	get_encpolicy_cmd.argmax = 0;
+	get_encpolicy_cmd.flags = CMD_NOMAP_OK | CMD_FOREIGN_OK;
+	get_encpolicy_cmd.oneline =
+		_("display the encryption policy of the current file");
+
+	set_encpolicy_cmd.name = "set_encpolicy";
+	set_encpolicy_cmd.cfunc = set_encpolicy_f;
+	set_encpolicy_cmd.args =
+		_("[-c mode] [-n mode] [-f flags] [-v version] [keydesc]");
+	set_encpolicy_cmd.argmin = 0;
+	set_encpolicy_cmd.argmax = -1;
+	set_encpolicy_cmd.flags = CMD_NOMAP_OK | CMD_FOREIGN_OK;
+	set_encpolicy_cmd.oneline =
+		_("assign an encryption policy to the current file");
+	set_encpolicy_cmd.help = set_encpolicy_help;
+
+	add_command(&get_encpolicy_cmd);
+	add_command(&set_encpolicy_cmd);
+}
diff -urpN xfsprogs-4.9.0/io/fiemap.c xfsprogs-4.14.0/io/fiemap.c
--- xfsprogs-4.9.0/io/fiemap.c	2016-12-13 21:07:06.000000000 +0100
+++ xfsprogs-4.14.0/io/fiemap.c	2017-11-27 17:57:55.000000000 +0100
@@ -18,11 +18,15 @@
 
 #include "platform_defs.h"
 #include "command.h"
+#include "input.h"
 #include <linux/fiemap.h>
 #include "init.h"
 #include "io.h"
 
+#define EXTENT_BATCH 32
+
 static cmdinfo_t fiemap_cmd;
+static int max_extents = -1;
 
 static void
 fiemap_help(void)
@@ -48,30 +52,47 @@ fiemap_help(void)
 "\n"));
 }
 
-static int
-numlen(
-	__u64	val,
-	int	base)
+static void
+print_hole(
+	   int		foff_w,
+	   int		boff_w,
+	   int		tot_w,
+	   int		cur_extent,
+	   int		lflag,
+	   bool		plain,
+	   __u64	llast,
+	   __u64	lstart)
 {
-	__u64	tmp;
-	int	len;
+	   char		lbuf[48];
+
+	   if (plain) {
+		printf("\t%d: [%llu..%llu]: hole", cur_extent,
+		       (unsigned long long)llast, lstart - 1ULL);
+		if (lflag)
+			printf(_(" %llu blocks\n"),
+			       (unsigned long long)lstart - llast);
+		else
+			printf("\n");
+	   } else {
+		snprintf(lbuf, sizeof(lbuf), "[%llu..%llu]:",
+			 (unsigned long long)llast, lstart - 1ULL);
+		printf("%4d: %-*s %-*s %*llu\n", cur_extent, foff_w, lbuf,
+		       boff_w, _("hole"), tot_w,
+		       (unsigned long long)lstart - llast);
+	   }
+
 
-	for (len = 0, tmp = val; tmp > 0; tmp = tmp/base)
-		len++;
-	return (len == 0 ? 1 : len);
 }
 
-static void
+static int
 print_verbose(
 	struct fiemap_extent	*extent,
-	int			blocksize,
 	int			foff_w,
 	int			boff_w,
 	int			tot_w,
 	int			flg_w,
-	int			max_extents,
-	int			*cur_extent,
-	__u64			*last_logical)
+	int			cur_extent,
+	__u64			last_logical)
 {
 	__u64			lstart;
 	__u64			llast;
@@ -81,15 +102,15 @@ print_verbose(
 	char			bbuf[48];
 	char			flgbuf[16];
 
-	llast = *last_logical / blocksize;
-	lstart = extent->fe_logical / blocksize;
-	len = extent->fe_length / blocksize;
-	block = extent->fe_physical / blocksize;
+	llast = BTOBBT(last_logical);
+	lstart = BTOBBT(extent->fe_logical);
+	len = BTOBBT(extent->fe_length);
+	block = BTOBBT(extent->fe_physical);
 
 	memset(lbuf, 0, sizeof(lbuf));
 	memset(bbuf, 0, sizeof(bbuf));
 
-	if (*cur_extent == 0) {
+	if (cur_extent == 0) {
 		printf("%4s: %-*s %-*s %*s %*s\n", _("EXT"),
 			foff_w, _("FILE-OFFSET"),
 			boff_w, _("BLOCK-RANGE"),
@@ -98,70 +119,59 @@ print_verbose(
 	}
 
 	if (lstart != llast) {
-		snprintf(lbuf, sizeof(lbuf), "[%llu..%llu]:", llast,
-			 lstart - 1ULL);
-		printf("%4d: %-*s %-*s %*llu\n", *cur_extent, foff_w, lbuf,
-		       boff_w, _("hole"), tot_w, lstart - llast);
-		(*cur_extent)++;
-		memset(lbuf, 0, sizeof(lbuf));
+		print_hole(foff_w, boff_w, tot_w, cur_extent, 0, false, llast,
+			   lstart);
+		cur_extent++;
 	}
 
-	if ((*cur_extent + 1) == max_extents)
-		return;
+	if (cur_extent == max_extents)
+		return 1;
 
-	snprintf(lbuf, sizeof(lbuf), "[%llu..%llu]:", lstart,
-		 lstart + len - 1ULL);
-	snprintf(bbuf, sizeof(bbuf), "%llu..%llu", block, block + len - 1ULL);
+	snprintf(lbuf, sizeof(lbuf), "[%llu..%llu]:",
+		 (unsigned long long)lstart, lstart + len - 1ULL);
+	snprintf(bbuf, sizeof(bbuf), "%llu..%llu",
+		 (unsigned long long)block, block + len - 1ULL);
 	snprintf(flgbuf, sizeof(flgbuf), "0x%x", extent->fe_flags);
-	printf("%4d: %-*s %-*s %*llu %*s\n", *cur_extent, foff_w, lbuf,
-	       boff_w, bbuf, tot_w, len, flg_w, flgbuf);
+	printf("%4d: %-*s %-*s %*llu %*s\n", cur_extent, foff_w, lbuf,
+	       boff_w, bbuf, tot_w, (unsigned long long)len, flg_w, flgbuf);
 
-	(*cur_extent)++;
-	*last_logical = extent->fe_logical + extent->fe_length;
+	return 2;
 }
 
-static void
+static int
 print_plain(
 	struct fiemap_extent	*extent,
 	int			lflag,
-	int			blocksize,
-	int			max_extents,
-	int			*cur_extent,
-	__u64			*last_logical)
+	int			cur_extent,
+	__u64			last_logical)
 {
 	__u64			lstart;
 	__u64			llast;
 	__u64			block;
 	__u64			len;
 
-	llast = *last_logical / blocksize;
-	lstart = extent->fe_logical / blocksize;
-	len = extent->fe_length / blocksize;
-	block = extent->fe_physical / blocksize;
+	llast = BTOBBT(last_logical);
+	lstart = BTOBBT(extent->fe_logical);
+	len = BTOBBT(extent->fe_length);
+	block = BTOBBT(extent->fe_physical);
 
 	if (lstart != llast) {
-		printf("\t%d: [%llu..%llu]: hole", *cur_extent,
-		       llast, lstart - 1ULL);
-		if (lflag)
-			printf(_(" %llu blocks\n"), lstart - llast);
-		else
-			printf("\n");
-		(*cur_extent)++;
+		print_hole(0, 0, 0, cur_extent, lflag, true, llast, lstart);
+		cur_extent++;
 	}
 
-	if ((*cur_extent + 1) == max_extents)
-		return;
+	if (cur_extent == max_extents)
+		return 1;
 
-	printf("\t%d: [%llu..%llu]: %llu..%llu", *cur_extent,
-	       lstart, lstart + len - 1ULL, block,
-	       block + len - 1ULL);
+	printf("\t%d: [%llu..%llu]: %llu..%llu", cur_extent,
+	       (unsigned long long)lstart, lstart + len - 1ULL,
+	       (unsigned long long)block, block + len - 1ULL);
 
 	if (lflag)
-		printf(_(" %llu blocks\n"), len);
+		printf(_(" %llu blocks\n"), (unsigned long long)len);
 	else
 		printf("\n");
-	(*cur_extent)++;
-	*last_logical = extent->fe_logical + extent->fe_length;
+	return 2;
 }
 
 /*
@@ -171,13 +181,12 @@ print_plain(
 static void
 calc_print_format(
 	struct fiemap		*fiemap,
-	__u64			blocksize,
 	int			*foff_w,
 	int			*boff_w,
 	int			*tot_w,
 	int			*flg_w)
 {
-	int 			i;
+	int			i;
 	char			lbuf[32];
 	char			bbuf[32];
 	__u64			logical;
@@ -188,14 +197,16 @@ calc_print_format(
 	for (i = 0; i < fiemap->fm_mapped_extents; i++) {
 
 		extent = &fiemap->fm_extents[i];
-		logical = extent->fe_logical / blocksize;
-		len = extent->fe_length / blocksize;
-		block = extent->fe_physical / blocksize;
-
-		snprintf(lbuf, sizeof(lbuf), "[%llu..%llu]", logical,
-			 logical + len - 1);
-		snprintf(bbuf, sizeof(bbuf), "%llu..%llu", block,
-			 block + len - 1);
+		logical = BTOBBT(extent->fe_logical);
+		len = BTOBBT(extent->fe_length);
+		block = BTOBBT(extent->fe_physical);
+
+		snprintf(lbuf, sizeof(lbuf), "[%llu..%llu]",
+			 (unsigned long long)logical,
+			 (unsigned long long)logical + len - 1);
+		snprintf(bbuf, sizeof(bbuf), "%llu..%llu",
+			 (unsigned long long)block,
+			 (unsigned long long)block + len - 1);
 		*foff_w = max(*foff_w, strlen(lbuf));
 		*boff_w = max(*boff_w, strlen(bbuf));
 		*tot_w = max(*tot_w, numlen(len, 10));
@@ -211,8 +222,6 @@ fiemap_f(
 	char		**argv)
 {
 	struct fiemap	*fiemap;
-	int		max_extents = 0;
-	int		num_extents = 32;
 	int		last = 0;
 	int		lflag = 0;
 	int		vflag = 0;
@@ -226,7 +235,6 @@ fiemap_f(
 	int		boff_w = 16;
 	int		tot_w = 5;	/* 5 since its just one number */
 	int		flg_w = 5;
-	__u64		blocksize = 512;
 	__u64		last_logical = 0;
 	struct stat	st;
 
@@ -249,10 +257,8 @@ fiemap_f(
 		}
 	}
 
-	if (max_extents)
-		num_extents = min(num_extents, max_extents);
 	map_size = sizeof(struct fiemap) +
-		(num_extents * sizeof(struct fiemap_extent));
+		(EXTENT_BATCH * sizeof(struct fiemap_extent));
 	fiemap = malloc(map_size);
 	if (!fiemap) {
 		fprintf(stderr, _("%s: malloc of %d bytes failed.\n"),
@@ -263,16 +269,13 @@ fiemap_f(
 
 	printf("%s:\n", file->name);
 
-	while (!last && ((cur_extent + 1) != max_extents)) {
-		if (max_extents)
-			num_extents = min(num_extents,
-					  max_extents - (cur_extent + 1));
+	while (!last && (cur_extent != max_extents)) {
 
 		memset(fiemap, 0, map_size);
 		fiemap->fm_flags = fiemap_flags;
 		fiemap->fm_start = last_logical;
 		fiemap->fm_length = -1LL;
-		fiemap->fm_extent_count = num_extents;
+		fiemap->fm_extent_count = EXTENT_BATCH;
 
 		ret = ioctl(file->fd, FS_IOC_FIEMAP, (unsigned long)fiemap);
 		if (ret < 0) {
@@ -289,35 +292,39 @@ fiemap_f(
 
 		for (i = 0; i < fiemap->fm_mapped_extents; i++) {
 			struct fiemap_extent	*extent;
+			int num_printed = 0;
 
 			extent = &fiemap->fm_extents[i];
 			if (vflag) {
 				if (cur_extent == 0) {
-					calc_print_format(fiemap, blocksize,
-							  &foff_w, &boff_w,
-							  &tot_w, &flg_w);
+					calc_print_format(fiemap, &foff_w,
+							  &boff_w, &tot_w,
+							  &flg_w);
 				}
 
-				print_verbose(extent, blocksize, foff_w,
-					      boff_w, tot_w, flg_w,
-					      max_extents, &cur_extent,
-					      &last_logical);
+				num_printed = print_verbose(extent, foff_w,
+							    boff_w, tot_w,
+							    flg_w, cur_extent,
+							    last_logical);
 			} else
-				print_plain(extent, lflag, blocksize,
-					    max_extents, &cur_extent,
-					    &last_logical);
+				num_printed = print_plain(extent, lflag,
+							  cur_extent,
+							  last_logical);
+
+			cur_extent += num_printed;
+			last_logical = extent->fe_logical + extent->fe_length;
 
 			if (extent->fe_flags & FIEMAP_EXTENT_LAST) {
 				last = 1;
 				break;
 			}
 
-			if ((cur_extent + 1) == max_extents)
+			if (cur_extent == max_extents)
 				break;
 		}
 	}
 
-	if ((cur_extent + 1) == max_extents)
+	if (cur_extent  == max_extents)
 		goto out;
 
 	memset(&st, 0, sizeof(st));
@@ -329,25 +336,9 @@ fiemap_f(
 		return 0;
 	}
 
-	if (cur_extent && last_logical < st.st_size) {
-		char	lbuf[32];
-
-		snprintf(lbuf, sizeof(lbuf), "[%llu..%llu]:",
-			 last_logical / blocksize, (st.st_size / blocksize) - 1);
-		if (vflag) {
-			printf("%4d: %-*s %-*s %*llu\n", cur_extent,
-			       foff_w, lbuf, boff_w, _("hole"), tot_w,
-			       (st.st_size - last_logical) / blocksize);
-		} else {
-			printf("\t%d: %s %s", cur_extent, lbuf,
-			       _("hole"));
-			if (lflag)
-				printf(_(" %llu blocks\n"),
-				       (st.st_size - last_logical) / blocksize);
-			else
-				printf("\n");
-		}
-	}
+	if (cur_extent && last_logical < st.st_size)
+		print_hole(foff_w, boff_w, tot_w, cur_extent, lflag, !vflag,
+			   BTOBBT(last_logical), BTOBBT(st.st_size));
 
 out:
 	free(fiemap);
diff -urpN xfsprogs-4.9.0/io/file.c xfsprogs-4.14.0/io/file.c
--- xfsprogs-4.9.0/io/file.c	2017-01-05 18:41:55.000000000 +0100
+++ xfsprogs-4.14.0/io/file.c	2017-11-20 01:14:14.000000000 +0100
@@ -95,7 +95,7 @@ file_init(void)
 	file_cmd.cfunc = file_f;
 	file_cmd.argmin = 0;
 	file_cmd.argmax = 1;
-	file_cmd.flags = CMD_NOMAP_OK | CMD_FOREIGN_OK;
+	file_cmd.flags = CMD_NOMAP_OK | CMD_FOREIGN_OK | CMD_FLAG_ONESHOT;
 	file_cmd.oneline = _("set the current file");
 
 	print_cmd.name = "print";
@@ -104,7 +104,7 @@ file_init(void)
 	print_cmd.argmin = 0;
 	print_cmd.argmax = 0;
 	print_cmd.flags = CMD_NOMAP_OK | CMD_NOFILE_OK | CMD_FOREIGN_OK |
-				CMD_FLAG_GLOBAL;
+				CMD_FLAG_ONESHOT;
 	print_cmd.oneline = _("list current open files and memory mappings");
 
 	add_command(&file_cmd);
diff -urpN xfsprogs-4.9.0/io/freeze.c xfsprogs-4.14.0/io/freeze.c
--- xfsprogs-4.9.0/io/freeze.c	2017-01-05 18:41:55.000000000 +0100
+++ xfsprogs-4.14.0/io/freeze.c	2017-11-20 01:14:14.000000000 +0100
@@ -65,14 +65,14 @@ freeze_init(void)
 	freeze_cmd.cfunc = freeze_f;
 	freeze_cmd.argmin = 0;
 	freeze_cmd.argmax = 0;
-	freeze_cmd.flags = CMD_NOMAP_OK | CMD_FOREIGN_OK;
+	freeze_cmd.flags = CMD_NOMAP_OK | CMD_FOREIGN_OK | CMD_FLAG_ONESHOT;
 	freeze_cmd.oneline = _("freeze filesystem of current file");
 
 	thaw_cmd.name = "thaw";
 	thaw_cmd.cfunc = thaw_f;
 	thaw_cmd.argmin = 0;
 	thaw_cmd.argmax = 0;
-	thaw_cmd.flags = CMD_NOMAP_OK | CMD_FOREIGN_OK;
+	thaw_cmd.flags = CMD_NOMAP_OK | CMD_FOREIGN_OK | CMD_FLAG_ONESHOT;
 	thaw_cmd.oneline = _("unfreeze filesystem of current file");
 
 	if (expert) {
diff -urpN xfsprogs-4.9.0/io/fsmap.c xfsprogs-4.14.0/io/fsmap.c
--- xfsprogs-4.9.0/io/fsmap.c	1970-01-01 01:00:00.000000000 +0100
+++ xfsprogs-4.14.0/io/fsmap.c	2017-11-20 01:14:14.000000000 +0100
@@ -0,0 +1,591 @@
+/*
+ * Copyright (C) 2017 Oracle.  All Rights Reserved.
+ *
+ * Author: Darrick J. Wong <darrick.wong@oracle.com>
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *
+ * This program is distributed in the hope that it would be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write the Free Software Foundation,
+ * Inc.,  51 Franklin St, Fifth Floor, Boston, MA  02110-1301, USA.
+ */
+#include "platform_defs.h"
+#include "command.h"
+#include "init.h"
+#include "path.h"
+#include "io.h"
+#include "input.h"
+
+static cmdinfo_t	fsmap_cmd;
+static dev_t		xfs_data_dev;
+
+static void
+fsmap_help(void)
+{
+	printf(_(
+"\n"
+" Prints the block mapping for the filesystem hosting the current file"
+"\n"
+" fsmap prints the map of disk blocks used by the whole filesystem.\n"
+" When possible, owner and offset information will be included in the\n"
+" space report.\n"
+"\n"
+" By default, each line of the listing takes the following form:\n"
+"     extent: major:minor [startblock..endblock]: owner startoffset..endoffset length\n"
+" The owner field is either an inode number or a special value.\n"
+" All the file offsets and disk blocks are in units of 512-byte blocks.\n"
+" -d -- query only the data device (default).\n"
+" -l -- query only the log device.\n"
+" -r -- query only the realtime device.\n"
+" -n -- query n extents at a time.\n"
+" -m -- output machine-readable format.\n"
+" -v -- Verbose information, show AG and offsets.  Show flags legend on 2nd -v\n"
+"\n"
+"The optional start and end arguments require one of -d, -l, or -r to be set.\n"
+"\n"));
+}
+
+#define OWNER_BUF_SZ	32
+static const char *
+special_owner(
+	int64_t		owner,
+	char		*buf)
+{
+	switch (owner) {
+	case XFS_FMR_OWN_FREE:
+		return _("free space");
+	case XFS_FMR_OWN_UNKNOWN:
+		return _("unknown");
+	case XFS_FMR_OWN_FS:
+		return _("static fs metadata");
+	case XFS_FMR_OWN_LOG:
+		return _("journalling log");
+	case XFS_FMR_OWN_AG:
+		return _("per-AG metadata");
+	case XFS_FMR_OWN_INOBT:
+		return _("inode btree");
+	case XFS_FMR_OWN_INODES:
+		return _("inodes");
+	case XFS_FMR_OWN_REFC:
+		return _("refcount btree");
+	case XFS_FMR_OWN_COW:
+		return _("cow reservation");
+	case XFS_FMR_OWN_DEFECTIVE:
+		return _("defective");
+	default:
+		snprintf(buf, OWNER_BUF_SZ, _("special %u:%u"),
+				FMR_OWNER_TYPE(owner), FMR_OWNER_CODE(owner));
+		return buf;
+	}
+}
+
+static void
+dump_map(
+	unsigned long long	*nr,
+	struct fsmap_head	*head)
+{
+	unsigned long long	i;
+	struct fsmap		*p;
+	char			owner[OWNER_BUF_SZ];
+	char			*fork;
+
+	for (i = 0, p = head->fmh_recs; i < head->fmh_entries; i++, p++) {
+		printf("\t%llu: %u:%u [%lld..%lld]: ", i + (*nr),
+			major(p->fmr_device), minor(p->fmr_device),
+			(long long)BTOBBT(p->fmr_physical),
+			(long long)BTOBBT(p->fmr_physical + p->fmr_length - 1));
+		fork = (p->fmr_flags & FMR_OF_ATTR_FORK) ? _("attr") : _("data");
+		if (p->fmr_flags & FMR_OF_SPECIAL_OWNER)
+			printf("%s", special_owner(p->fmr_owner, owner));
+		else if (p->fmr_flags & FMR_OF_EXTENT_MAP)
+			printf(_("inode %lld %s extent map"),
+				(long long) p->fmr_owner, fork);
+		else
+			printf(_("inode %lld %s %lld..%lld"),
+				(long long)p->fmr_owner, fork,
+				(long long)BTOBBT(p->fmr_offset),
+				(long long)BTOBBT(p->fmr_offset + p->fmr_length - 1));
+		printf(_(" %lld\n"),
+			(long long)BTOBBT(p->fmr_length));
+	}
+
+	(*nr) += head->fmh_entries;
+}
+
+static void
+dump_map_machine(
+	unsigned long long	*nr,
+	struct fsmap_head	*head)
+{
+	unsigned long long	i;
+	struct fsmap		*p;
+	char			*fork;
+
+	printf(_("EXT,MAJOR,MINOR,PSTART,PEND,OWNER,OSTART,OEND,LENGTH\n"));
+	for (i = 0, p = head->fmh_recs; i < head->fmh_entries; i++, p++) {
+		printf("%llu,%u,%u,%lld,%lld,", i + (*nr),
+			major(p->fmr_device), minor(p->fmr_device),
+			(long long)BTOBBT(p->fmr_physical),
+			(long long)BTOBBT(p->fmr_physical + p->fmr_length - 1));
+		fork = (p->fmr_flags & FMR_OF_ATTR_FORK) ? "attr" : "data";
+		if (p->fmr_flags & FMR_OF_SPECIAL_OWNER)
+			printf("special_%u:%u,,,", FMR_OWNER_TYPE(p->fmr_owner),
+				FMR_OWNER_CODE(p->fmr_owner));
+		else if (p->fmr_flags & FMR_OF_EXTENT_MAP)
+			printf(_("inode_%lld_%s_bmbt,,,"),
+				(long long) p->fmr_owner, fork);
+		else
+			printf(_("inode_%lld_%s,%lld,%lld,"),
+				(long long)p->fmr_owner, fork,
+				(long long)BTOBBT(p->fmr_offset),
+				(long long)BTOBBT(p->fmr_offset + p->fmr_length - 1));
+		printf("%lld\n",
+			(long long)BTOBBT(p->fmr_length));
+	}
+
+	(*nr) += head->fmh_entries;
+}
+
+/*
+ * Verbose mode displays:
+ *   extent: major:minor [startblock..endblock]: startoffset..endoffset \
+ *	ag# (agoffset..agendoffset) totalbbs flags
+ */
+#define MINRANGE_WIDTH	16
+#define MINAG_WIDTH	2
+#define MINTOT_WIDTH	5
+#define NFLG		7		/* count of flags */
+#define	FLG_NULL	00000000	/* Null flag */
+#define	FLG_ATTR_FORK	01000000	/* attribute fork */
+#define	FLG_SHARED	00100000	/* shared extent */
+#define	FLG_PRE		00010000	/* Unwritten extent */
+#define	FLG_BSU		00001000	/* Not on begin of stripe unit  */
+#define	FLG_ESU		00000100	/* Not on end   of stripe unit  */
+#define	FLG_BSW		00000010	/* Not on begin of stripe width */
+#define	FLG_ESW		00000001	/* Not on end   of stripe width */
+static void
+dump_map_verbose(
+	unsigned long long	*nr,
+	struct fsmap_head	*head,
+	bool			*dumped_flags,
+	struct xfs_fsop_geom	*fsgeo)
+{
+	unsigned long long	i;
+	struct fsmap		*p;
+	int			agno;
+	off64_t			agoff, bperag;
+	int			foff_w, boff_w, aoff_w, tot_w, agno_w, own_w;
+	int			nr_w, dev_w;
+	char			rbuf[32], bbuf[32], abuf[32], obuf[32];
+	char			nbuf[32], dbuf[32], gbuf[32];
+	char			owner[OWNER_BUF_SZ];
+	int			sunit, swidth;
+	int			flg = 0;
+
+	foff_w = boff_w = aoff_w = own_w = MINRANGE_WIDTH;
+	dev_w = 3;
+	nr_w = 4;
+	tot_w = MINTOT_WIDTH;
+	bperag = (off64_t)fsgeo->agblocks *
+		  (off64_t)fsgeo->blocksize;
+	sunit = (fsgeo->sunit * fsgeo->blocksize);
+	swidth = (fsgeo->swidth * fsgeo->blocksize);
+
+	/*
+	 * Go through the extents and figure out the width
+	 * needed for all columns.
+	 */
+	for (i = 0, p = head->fmh_recs; i < head->fmh_entries; i++, p++) {
+		if (p->fmr_flags & FMR_OF_PREALLOC ||
+		    p->fmr_flags & FMR_OF_ATTR_FORK ||
+		    p->fmr_flags & FMR_OF_SHARED)
+			flg = 1;
+		if (sunit &&
+		    (p->fmr_physical  % sunit != 0 ||
+		     ((p->fmr_physical + p->fmr_length) % sunit) != 0 ||
+		     p->fmr_physical % swidth != 0 ||
+		     ((p->fmr_physical + p->fmr_length) % swidth) != 0))
+			flg = 1;
+		if (flg)
+			*dumped_flags = true;
+		snprintf(nbuf, sizeof(nbuf), "%llu", (*nr) + i);
+		nr_w = max(nr_w, strlen(nbuf));
+		if (head->fmh_oflags & FMH_OF_DEV_T)
+			snprintf(dbuf, sizeof(dbuf), "%u:%u",
+				major(p->fmr_device),
+				minor(p->fmr_device));
+		else
+			snprintf(dbuf, sizeof(dbuf), "0x%x", p->fmr_device);
+		dev_w = max(dev_w, strlen(dbuf));
+		snprintf(bbuf, sizeof(bbuf), "[%lld..%lld]:",
+			(long long)BTOBBT(p->fmr_physical),
+			(long long)BTOBBT(p->fmr_physical + p->fmr_length - 1));
+		boff_w = max(boff_w, strlen(bbuf));
+		if (p->fmr_flags & FMR_OF_SPECIAL_OWNER)
+			own_w = max(own_w, strlen(
+					special_owner(p->fmr_owner, owner)));
+		else {
+			snprintf(obuf, sizeof(obuf), "%lld",
+				(long long)p->fmr_owner);
+			own_w = max(own_w, strlen(obuf));
+		}
+		if (p->fmr_flags & FMR_OF_EXTENT_MAP)
+			foff_w = max(foff_w, strlen(_("extent_map")));
+		else if (p->fmr_flags & FMR_OF_SPECIAL_OWNER)
+			;
+		else {
+			snprintf(rbuf, sizeof(rbuf), "%lld..%lld",
+				(long long)BTOBBT(p->fmr_offset),
+				(long long)BTOBBT(p->fmr_offset + p->fmr_length - 1));
+			foff_w = max(foff_w, strlen(rbuf));
+		}
+		if (p->fmr_device == xfs_data_dev) {
+			agno = p->fmr_physical / bperag;
+			agoff = p->fmr_physical - (agno * bperag);
+			snprintf(abuf, sizeof(abuf),
+				"(%lld..%lld)",
+				(long long)BTOBBT(agoff),
+				(long long)BTOBBT(agoff + p->fmr_length - 1));
+		} else
+			abuf[0] = 0;
+		aoff_w = max(aoff_w, strlen(abuf));
+		tot_w = max(tot_w,
+			numlen(BTOBBT(p->fmr_length), 10));
+	}
+	agno_w = max(MINAG_WIDTH, numlen(fsgeo->agcount, 10));
+	if (*nr == 0)
+		printf("%*s: %-*s %-*s %-*s %-*s %*s %-*s %*s%s\n",
+			nr_w, _("EXT"),
+			dev_w, _("DEV"),
+			boff_w, _("BLOCK-RANGE"),
+			own_w, _("OWNER"),
+			foff_w, _("FILE-OFFSET"),
+			agno_w, _("AG"),
+			aoff_w, _("AG-OFFSET"),
+			tot_w, _("TOTAL"),
+			flg ? _(" FLAGS") : "");
+	for (i = 0, p = head->fmh_recs; i < head->fmh_entries; i++, p++) {
+		flg = FLG_NULL;
+		if (p->fmr_flags & FMR_OF_PREALLOC)
+			flg |= FLG_PRE;
+		if (p->fmr_flags & FMR_OF_ATTR_FORK)
+			flg |= FLG_ATTR_FORK;
+		if (p->fmr_flags & FMR_OF_SHARED)
+			flg |= FLG_SHARED;
+		/*
+		 * If striping enabled, determine if extent starts/ends
+		 * on a stripe unit boundary.
+		 */
+		if (sunit) {
+			if (p->fmr_physical  % sunit != 0)
+				flg |= FLG_BSU;
+			if (((p->fmr_physical +
+			      p->fmr_length ) % sunit ) != 0)
+				flg |= FLG_ESU;
+			if (p->fmr_physical % swidth != 0)
+				flg |= FLG_BSW;
+			if (((p->fmr_physical +
+			      p->fmr_length ) % swidth ) != 0)
+				flg |= FLG_ESW;
+		}
+		if (head->fmh_oflags & FMH_OF_DEV_T)
+			snprintf(dbuf, sizeof(dbuf), "%u:%u",
+				major(p->fmr_device),
+				minor(p->fmr_device));
+		else
+			snprintf(dbuf, sizeof(dbuf), "0x%x", p->fmr_device);
+		snprintf(bbuf, sizeof(bbuf), "[%lld..%lld]:",
+			(long long)BTOBBT(p->fmr_physical),
+			(long long)BTOBBT(p->fmr_physical + p->fmr_length - 1));
+		if (p->fmr_flags & FMR_OF_SPECIAL_OWNER) {
+			snprintf(obuf, sizeof(obuf), "%s",
+				special_owner(p->fmr_owner, owner));
+			snprintf(rbuf, sizeof(rbuf), " ");
+		} else {
+			snprintf(obuf, sizeof(obuf), "%lld",
+				(long long)p->fmr_owner);
+			snprintf(rbuf, sizeof(rbuf), "%lld..%lld",
+				(long long)BTOBBT(p->fmr_offset),
+				(long long)BTOBBT(p->fmr_offset + p->fmr_length - 1));
+		}
+		if (p->fmr_device == xfs_data_dev) {
+			agno = p->fmr_physical / bperag;
+			agoff = p->fmr_physical - (agno * bperag);
+			snprintf(abuf, sizeof(abuf),
+				"(%lld..%lld)",
+				(long long)BTOBBT(agoff),
+				(long long)BTOBBT(agoff + p->fmr_length - 1));
+			snprintf(gbuf, sizeof(gbuf),
+				"%lld",
+				(long long)agno);
+		} else {
+			abuf[0] = 0;
+			gbuf[0] = 0;
+		}
+		if (p->fmr_flags & FMR_OF_EXTENT_MAP)
+			printf("%*llu: %-*s %-*s %-*s %-*s %-*s %-*s %*lld\n",
+				nr_w, (*nr) + i,
+				dev_w, dbuf,
+				boff_w, bbuf,
+				own_w, obuf,
+				foff_w, _("extent map"),
+				agno_w, gbuf,
+				aoff_w, abuf,
+				tot_w, (long long)BTOBBT(p->fmr_length));
+		else {
+			printf("%*llu: %-*s %-*s %-*s %-*s", nr_w, (*nr) + i,
+				dev_w, dbuf, boff_w, bbuf, own_w, obuf,
+				foff_w, rbuf);
+			printf(" %-*s %-*s", agno_w, gbuf,
+				aoff_w, abuf);
+			printf(" %*lld", tot_w,
+				(long long)BTOBBT(p->fmr_length));
+			if (flg == FLG_NULL)
+				printf("\n");
+			else
+				printf(" %-*.*o\n", NFLG, NFLG, flg);
+		}
+	}
+
+	(*nr) += head->fmh_entries;
+}
+
+static void
+dump_verbose_key(void)
+{
+	printf(_(" FLAG Values:\n"));
+	printf(_("    %*.*o Attribute fork\n"),
+		NFLG+1, NFLG+1, FLG_ATTR_FORK);
+	printf(_("    %*.*o Shared extent\n"),
+		NFLG+1, NFLG+1, FLG_SHARED);
+	printf(_("    %*.*o Unwritten preallocated extent\n"),
+		NFLG+1, NFLG+1, FLG_PRE);
+	printf(_("    %*.*o Doesn't begin on stripe unit\n"),
+		NFLG+1, NFLG+1, FLG_BSU);
+	printf(_("    %*.*o Doesn't end   on stripe unit\n"),
+		NFLG+1, NFLG+1, FLG_ESU);
+	printf(_("    %*.*o Doesn't begin on stripe width\n"),
+		NFLG+1, NFLG+1, FLG_BSW);
+	printf(_("    %*.*o Doesn't end   on stripe width\n"),
+		NFLG+1, NFLG+1, FLG_ESW);
+}
+
+int
+fsmap_f(
+	int			argc,
+	char			**argv)
+{
+	struct fsmap		*p;
+	struct fsmap_head	*nhead;
+	struct fsmap_head	*head;
+	struct fsmap		*l, *h;
+	struct xfs_fsop_geom	fsgeo;
+	long long		start = 0;
+	long long		end = -1;
+	int			nmap_size;
+	int			map_size;
+	int			nflag = 0;
+	int			vflag = 0;
+	int			mflag = 0;
+	int			i = 0;
+	int			c;
+	unsigned long long	nr = 0;
+	size_t			fsblocksize, fssectsize;
+	struct fs_path		*fs;
+	static bool		tab_init;
+	bool			dumped_flags = false;
+	int			dflag, lflag, rflag;
+
+	init_cvtnum(&fsblocksize, &fssectsize);
+
+	dflag = lflag = rflag = 0;
+	while ((c = getopt(argc, argv, "dlmn:rv")) != EOF) {
+		switch (c) {
+		case 'd':	/* data device */
+			dflag = 1;
+			break;
+		case 'l':	/* log device */
+			lflag = 1;
+			break;
+		case 'm':	/* machine readable format */
+			mflag++;
+			break;
+		case 'n':	/* number of extents specified */
+			nflag = cvt_u32(optarg, 10);
+			if (errno)
+				return command_usage(&fsmap_cmd);
+			break;
+		case 'r':	/* rt device */
+			rflag = 1;
+			break;
+		case 'v':	/* Verbose output */
+			vflag++;
+			break;
+		default:
+			return command_usage(&fsmap_cmd);
+		}
+	}
+
+	if ((dflag + lflag + rflag > 1) || (mflag > 0 && vflag > 0) ||
+	    (argc > optind && dflag + lflag + rflag == 0))
+		return command_usage(&fsmap_cmd);
+
+	if (argc > optind) {
+		start = cvtnum(fsblocksize, fssectsize, argv[optind]);
+		if (start < 0) {
+			fprintf(stderr,
+				_("Bad rmap start_bblock %s.\n"),
+				argv[optind]);
+			return 0;
+		}
+		start <<= BBSHIFT;
+	}
+
+	if (argc > optind + 1) {
+		end = cvtnum(fsblocksize, fssectsize, argv[optind + 1]);
+		if (end < 0) {
+			fprintf(stderr,
+				_("Bad rmap end_bblock %s.\n"),
+				argv[optind + 1]);
+			return 0;
+		}
+		end <<= BBSHIFT;
+	}
+
+	if (vflag) {
+		c = ioctl(file->fd, XFS_IOC_FSGEOMETRY, &fsgeo);
+		if (c < 0) {
+			fprintf(stderr,
+				_("%s: can't get geometry [\"%s\"]: %s\n"),
+				progname, file->name, strerror(errno));
+			exitcode = 1;
+			return 0;
+		}
+	}
+
+	map_size = nflag ? nflag : 131072 / sizeof(struct fsmap);
+	head = malloc(fsmap_sizeof(map_size));
+	if (head == NULL) {
+		fprintf(stderr, _("%s: malloc of %zu bytes failed.\n"),
+			progname, fsmap_sizeof(map_size));
+		exitcode = 1;
+		return 0;
+	}
+
+	memset(head, 0, sizeof(*head));
+	l = head->fmh_keys;
+	h = head->fmh_keys + 1;
+	if (dflag) {
+		l->fmr_device = h->fmr_device = file->fs_path.fs_datadev;
+	} else if (lflag) {
+		l->fmr_device = h->fmr_device = file->fs_path.fs_logdev;
+	} else if (rflag) {
+		l->fmr_device = h->fmr_device = file->fs_path.fs_rtdev;
+	} else {
+		l->fmr_device = 0;
+		h->fmr_device = UINT_MAX;
+	}
+	l->fmr_physical = start;
+	h->fmr_physical = end;
+	h->fmr_owner = ULLONG_MAX;
+	h->fmr_flags = UINT_MAX;
+	h->fmr_offset = ULLONG_MAX;
+
+	/* Count mappings */
+	if (!nflag) {
+		head->fmh_count = 0;
+		i = ioctl(file->fd, FS_IOC_GETFSMAP, head);
+		if (i < 0) {
+			fprintf(stderr, _("%s: xfsctl(XFS_IOC_GETFSMAP)"
+				" iflags=0x%x [\"%s\"]: %s\n"),
+				progname, head->fmh_iflags, file->name,
+				strerror(errno));
+			free(head);
+			exitcode = 1;
+			return 0;
+		}
+		if (head->fmh_entries > map_size + 2) {
+			map_size = 11ULL * head->fmh_entries / 10;
+			nmap_size = map_size > (1 << 24) ? (1 << 24) : map_size;
+			nhead = realloc(head, fsmap_sizeof(nmap_size));
+			if (nhead == NULL) {
+				fprintf(stderr,
+					_("%s: cannot realloc %zu bytes\n"),
+					progname, fsmap_sizeof(nmap_size));
+			} else {
+				head = nhead;
+				map_size = nmap_size;
+			}
+		}
+	}
+
+	/*
+	 * If this is an XFS filesystem, remember the data device.
+	 * (We report AG number/block for data device extents on XFS).
+	 */
+	if (!tab_init) {
+		fs_table_initialise(0, NULL, 0, NULL);
+		tab_init = true;
+	}
+	fs = fs_table_lookup(file->name, FS_MOUNT_POINT);
+	xfs_data_dev = fs ? fs->fs_datadev : 0;
+
+	head->fmh_count = map_size;
+	do {
+		/* Get some extents */
+		i = ioctl(file->fd, FS_IOC_GETFSMAP, head);
+		if (i < 0) {
+			fprintf(stderr, _("%s: xfsctl(XFS_IOC_GETFSMAP)"
+				" iflags=0x%x [\"%s\"]: %s\n"),
+				progname, head->fmh_iflags, file->name,
+				strerror(errno));
+			free(head);
+			exitcode = 1;
+			return 0;
+		}
+
+		if (head->fmh_entries == 0)
+			break;
+
+		if (vflag)
+			dump_map_verbose(&nr, head, &dumped_flags, &fsgeo);
+		else if (mflag)
+			dump_map_machine(&nr, head);
+		else
+			dump_map(&nr, head);
+
+		p = &head->fmh_recs[head->fmh_entries - 1];
+		if (p->fmr_flags & FMR_OF_LAST)
+			break;
+		fsmap_advance(head);
+	} while (true);
+
+	if (dumped_flags)
+		dump_verbose_key();
+
+	free(head);
+	return 0;
+}
+
+void
+fsmap_init(void)
+{
+	fsmap_cmd.name = "fsmap";
+	fsmap_cmd.cfunc = fsmap_f;
+	fsmap_cmd.argmin = 0;
+	fsmap_cmd.argmax = -1;
+	fsmap_cmd.flags = CMD_NOMAP_OK | CMD_FLAG_FOREIGN_OK;
+	fsmap_cmd.args = _("[-d|-l|-r] [-m|-v] [-n nx] [start] [end]");
+	fsmap_cmd.oneline = _("print filesystem mapping for a range of blocks");
+	fsmap_cmd.help = fsmap_help;
+
+	add_command(&fsmap_cmd);
+}
diff -urpN xfsprogs-4.9.0/io/getrusage.c xfsprogs-4.14.0/io/getrusage.c
--- xfsprogs-4.9.0/io/getrusage.c	2017-01-05 18:41:55.000000000 +0100
+++ xfsprogs-4.14.0/io/getrusage.c	2017-11-20 01:14:14.000000000 +0100
@@ -113,7 +113,8 @@ getrusage_init(void)
 	getrusage_cmd.argmin = 0;
 	getrusage_cmd.argmax = -1;
 	getrusage_cmd.cfunc = getrusage_f;
-	getrusage_cmd.flags = CMD_NOFILE_OK | CMD_NOMAP_OK | CMD_FOREIGN_OK;
+	getrusage_cmd.flags = CMD_NOFILE_OK | CMD_NOMAP_OK |
+			      CMD_FOREIGN_OK | CMD_FLAG_ONESHOT;
 	getrusage_cmd.oneline = _("report process resource usage");
 
 	if (expert)
diff -urpN xfsprogs-4.9.0/io/imap.c xfsprogs-4.14.0/io/imap.c
--- xfsprogs-4.9.0/io/imap.c	2017-01-05 18:41:55.000000000 +0100
+++ xfsprogs-4.14.0/io/imap.c	2017-11-20 01:14:14.000000000 +0100
@@ -72,7 +72,7 @@ imap_init(void)
 	imap_cmd.argmin = 0;
 	imap_cmd.argmax = 1;
 	imap_cmd.args = _("[nentries]");
-	imap_cmd.flags = CMD_NOMAP_OK;
+	imap_cmd.flags = CMD_NOMAP_OK | CMD_FLAG_ONESHOT;
 	imap_cmd.oneline = _("inode map for filesystem of current file");
 
 	if (expert)
diff -urpN xfsprogs-4.9.0/io/init.c xfsprogs-4.14.0/io/init.c
--- xfsprogs-4.9.0/io/init.c	2017-01-05 18:41:55.000000000 +0100
+++ xfsprogs-4.14.0/io/init.c	2017-11-20 01:14:14.000000000 +0100
@@ -34,7 +34,7 @@ void
 usage(void)
 {
 	fprintf(stderr,
-		_("Usage: %s [-adfinrRstVx] [-m mode] [-p prog] [-c cmd]... file\n"),
+_("Usage: %s [-adfinrRstVx] [-m mode] [-p prog] [[-c|-C] cmd]... file\n"),
 		progname);
 	exit(1);
 }
@@ -59,16 +59,19 @@ init_commands(void)
 	attr_init();
 	bmap_init();
 	copy_range_init();
+	cowextsize_init();
+	encrypt_init();
 	fadvise_init();
+	fiemap_init();
 	file_init();
 	flink_init();
 	freeze_init();
+	fsmap_init();
 	fsync_init();
 	getrusage_init();
 	help_init();
 	imap_init();
 	inject_init();
-	seek_init();
 	madvise_init();
 	mincore_init();
 	mmap_init();
@@ -76,22 +79,28 @@ init_commands(void)
 	parent_init();
 	pread_init();
 	prealloc_init();
-	fiemap_init();
 	pwrite_init();
 	quit_init();
 	readdir_init();
+	reflink_init();
 	resblks_init();
+	seek_init();
 	sendfile_init();
 	shutdown_init();
+	stat_init();
 	sync_init();
 	sync_range_init();
 	truncate_init();
-	reflink_init();
-	cowextsize_init();
+	utimes_init();
 }
 
+/*
+ * This allows xfs_io commands specified on the command line to be run on every
+ * open file in the file table. Commands that should not be iterated across all
+ * open files need to specify CMD_FLAG_ONESHOT in their command flags.
+ */
 static int
-init_args_command(
+filetable_iterator(
 	int	index)
 {
 	if (index >= filecount)
@@ -104,9 +113,6 @@ static int
 init_check_command(
 	const cmdinfo_t	*ct)
 {
-	if (ct->flags & CMD_FLAG_GLOBAL)
-		return 1;
-
 	if (!file && !(ct->flags & CMD_NOFILE_OK)) {
 		fprintf(stderr, _("no files are open, try 'help open'\n"));
 		return 0;
@@ -134,6 +140,7 @@ init(
 	char		*sp;
 	mode_t		mode = 0600;
 	xfs_fsop_geom_t	geometry = { 0 };
+	struct fs_path	fsp;
 
 	progname = basename(argv[0]);
 	setlocale(LC_ALL, "");
@@ -143,7 +150,8 @@ init(
 	pagesize = getpagesize();
 	gettimeofday(&stopwatch, NULL);
 
-	while ((c = getopt(argc, argv, "ac:dFfim:p:nrRstTVx")) != EOF) {
+	fs_table_initialise(0, NULL, 0, NULL);
+	while ((c = getopt(argc, argv, "ac:C:dFfim:p:nrRstTVx")) != EOF) {
 		switch (c) {
 		case 'a':
 			flags |= IO_APPEND;
@@ -151,6 +159,9 @@ init(
 		case 'c':
 			add_user_command(optarg);
 			break;
+		case 'C':
+			add_oneshot_user_command(optarg);
+			break;
 		case 'd':
 			flags |= IO_DIRECT;
 			break;
@@ -204,17 +215,18 @@ init(
 	}
 
 	while (optind < argc) {
-		if ((c = openfile(argv[optind], &geometry, flags, mode)) < 0)
+		c = openfile(argv[optind], &geometry, flags, mode, &fsp);
+		if (c < 0)
 			exit(1);
 		if (!platform_test_xfs_fd(c))
 			flags |= IO_FOREIGN;
-		if (addfile(argv[optind], c, &geometry, flags) < 0)
+		if (addfile(argv[optind], c, &geometry, flags, &fsp) < 0)
 			exit(1);
 		optind++;
 	}
 
 	init_commands();
-	add_args_command(init_args_command);
+	add_command_iterator(filetable_iterator);
 	add_check_command(init_check_command);
 }
 
diff -urpN xfsprogs-4.9.0/io/inject.c xfsprogs-4.14.0/io/inject.c
--- xfsprogs-4.9.0/io/inject.c	2017-01-05 18:41:55.000000000 +0100
+++ xfsprogs-4.14.0/io/inject.c	2017-11-27 17:57:55.000000000 +0100
@@ -86,7 +86,13 @@ error_tag(char *name)
 		{ XFS_ERRTAG_BMAP_FINISH_ONE,		"bmap_finish_one" },
 #define XFS_ERRTAG_AG_RESV_CRITICAL			27
 		{ XFS_ERRTAG_AG_RESV_CRITICAL,		"ag_resv_critical" },
-#define XFS_ERRTAG_MAX                                  28
+#define XFS_ERRTAG_DROP_WRITES				28
+		{ XFS_ERRTAG_DROP_WRITES,		"drop_writes" },
+#define XFS_ERRTAG_LOG_BAD_CRC				29
+		{ XFS_ERRTAG_LOG_BAD_CRC,		"log_bad_crc" },
+#define XFS_ERRTAG_LOG_ITEM_PIN				30
+		{ XFS_ERRTAG_LOG_ITEM_PIN,		"log_item_pin" },
+#define XFS_ERRTAG_MAX                                  31
 		{ XFS_ERRTAG_MAX,			NULL }
 	};
 	int	count;
@@ -163,7 +169,7 @@ inject_init(void)
 	inject_cmd.cfunc = inject_f;
 	inject_cmd.argmin = 0;
 	inject_cmd.argmax = -1;
-	inject_cmd.flags = CMD_NOMAP_OK;
+	inject_cmd.flags = CMD_NOMAP_OK | CMD_FLAG_ONESHOT;
 	inject_cmd.args = _("[tag ...]");
 	inject_cmd.oneline = _("inject errors into a filesystem");
 	inject_cmd.help = inject_help;
diff -urpN xfsprogs-4.9.0/io/io.h xfsprogs-4.14.0/io/io.h
--- xfsprogs-4.9.0/io/io.h	2017-01-05 18:41:55.000000000 +0100
+++ xfsprogs-4.14.0/io/io.h	2017-11-27 17:57:55.000000000 +0100
@@ -17,6 +17,7 @@
  */
 
 #include "xfs.h"
+#include "path.h"
 
 /*
  * Read/write patterns (default is always "forward")
@@ -24,6 +25,7 @@
 #define IO_RANDOM	( 0)
 #define IO_FORWARD	( 1)
 #define IO_BACKWARD	(-1)
+#define IO_ONCE		( 2)
 
 /*
  * File descriptor options
@@ -47,13 +49,14 @@ typedef struct fileio {
 	int		flags;		/* flags describing file state */
 	char		*name;		/* file name at time of open */
 	xfs_fsop_geom_t	geom;		/* XFS filesystem geometry */
+	struct fs_path	fs_path;	/* XFS path information */
 } fileio_t;
 
 extern fileio_t		*filetable;	/* open file table */
 extern int		filecount;	/* number of open files */
 extern fileio_t		*file;		/* active file in file table */
 extern int filelist_f(void);
-
+extern int stat_f(int argc, char **argv);
 /*
  * Memory mapped file regions
  */
@@ -76,8 +79,10 @@ extern void *check_mapping_range(mmap_re
  */
 
 extern off64_t		filesize(void);
-extern int		openfile(char *, xfs_fsop_geom_t *, int, mode_t);
-extern int		addfile(char *, int , xfs_fsop_geom_t *, int);
+extern int		openfile(char *, xfs_fsop_geom_t *, int, mode_t,
+				 struct fs_path *);
+extern int		addfile(char *, int , xfs_fsop_geom_t *, int,
+				struct fs_path *);
 extern void		printxattr(uint, int, int, const char *, int, int);
 
 extern unsigned int	recurse_all;
@@ -94,6 +99,7 @@ extern void		dump_buffer(off64_t, ssize_
 
 extern void		attr_init(void);
 extern void		bmap_init(void);
+extern void		encrypt_init(void);
 extern void		file_init(void);
 extern void		flink_init(void);
 extern void		freeze_init(void);
@@ -111,8 +117,10 @@ extern void		pwrite_init(void);
 extern void		quit_init(void);
 extern void		seek_init(void);
 extern void		shutdown_init(void);
+extern void		stat_init(void);
 extern void		sync_init(void);
 extern void		truncate_init(void);
+extern void		utimes_init(void);
 
 #ifdef HAVE_FADVISE
 extern void		fadvise_init(void);
@@ -171,3 +179,9 @@ extern void		readdir_init(void);
 extern void		reflink_init(void);
 
 extern void		cowextsize_init(void);
+
+#ifdef HAVE_GETFSMAP
+extern void		fsmap_init(void);
+#else
+# define fsmap_init()	do { } while (0)
+#endif
diff -urpN xfsprogs-4.9.0/io/link.c xfsprogs-4.14.0/io/link.c
--- xfsprogs-4.9.0/io/link.c	2017-01-05 18:41:55.000000000 +0100
+++ xfsprogs-4.14.0/io/link.c	2017-11-20 01:14:14.000000000 +0100
@@ -59,7 +59,7 @@ flink_init(void)
 	flink_cmd.cfunc = flink_f;
 	flink_cmd.argmin = 1;
 	flink_cmd.argmax = 1;
-	flink_cmd.flags = CMD_NOMAP_OK | CMD_FOREIGN_OK;
+	flink_cmd.flags = CMD_NOMAP_OK | CMD_FOREIGN_OK | CMD_FLAG_ONESHOT;
 	flink_cmd.args = _("filename");
 	flink_cmd.oneline =
 		_("link the open file descriptor to the supplied filename");
diff -urpN xfsprogs-4.9.0/io/mmap.c xfsprogs-4.14.0/io/mmap.c
--- xfsprogs-4.9.0/io/mmap.c	2017-01-05 18:41:55.000000000 +0100
+++ xfsprogs-4.14.0/io/mmap.c	2017-11-20 01:14:14.000000000 +0100
@@ -628,8 +628,8 @@ mremap_f(
 		switch (c) {
 		case 'f':
 			flags = MREMAP_FIXED|MREMAP_MAYMOVE;
-			new_addr = (void *)cvtnum(blocksize, sectsize,
-			                          optarg);
+			new_addr = (void *)(unsigned long)cvtnum(blocksize,
+			                          sectsize, optarg);
 			break;
 		case 'm':
 			flags = MREMAP_MAYMOVE;
@@ -674,7 +674,8 @@ mmap_init(void)
 	mmap_cmd.cfunc = mmap_f;
 	mmap_cmd.argmin = 0;
 	mmap_cmd.argmax = -1;
-	mmap_cmd.flags = CMD_NOMAP_OK | CMD_NOFILE_OK | CMD_FOREIGN_OK;
+	mmap_cmd.flags = CMD_NOMAP_OK | CMD_NOFILE_OK |
+			 CMD_FOREIGN_OK | CMD_FLAG_ONESHOT;
 	mmap_cmd.args = _("[N] | [-rwx] [-s size] [off len]");
 	mmap_cmd.oneline =
 		_("mmap a range in the current file, show mappings");
diff -urpN xfsprogs-4.9.0/io/open.c xfsprogs-4.14.0/io/open.c
--- xfsprogs-4.9.0/io/open.c	2017-01-05 18:41:55.000000000 +0100
+++ xfsprogs-4.14.0/io/open.c	2017-11-27 17:57:55.000000000 +0100
@@ -39,9 +39,7 @@
 #endif
 
 static cmdinfo_t open_cmd;
-static cmdinfo_t stat_cmd;
 static cmdinfo_t close_cmd;
-static cmdinfo_t statfs_cmd;
 static cmdinfo_t chproj_cmd;
 static cmdinfo_t lsproj_cmd;
 static cmdinfo_t extsize_cmd;
@@ -49,103 +47,15 @@ static cmdinfo_t inode_cmd;
 static prid_t prid;
 static long extsize;
 
-off64_t
-filesize(void)
-{
-	struct stat	st;
-
-	if (fstat(file->fd, &st) < 0) {
-		perror("fstat");
-		return -1;
-	}
-	return st.st_size;
-}
-
-static char *
-filetype(mode_t mode)
-{
-	switch (mode & S_IFMT) {
-	case S_IFSOCK:
-		return _("socket");
-	case S_IFDIR:
-		return _("directory");
-	case S_IFCHR:
-		return _("char device");
-	case S_IFBLK:
-		return _("block device");
-	case S_IFREG:
-		return _("regular file");
-	case S_IFLNK:
-		return _("symbolic link");
-	case S_IFIFO:
-		return _("fifo");
-	}
-	return NULL;
-}
-
-static int
-stat_f(
-	int		argc,
-	char		**argv)
-{
-	struct dioattr	dio;
-	struct fsxattr	fsx, fsxa;
-	struct stat	st;
-	int		verbose = (argc == 2 && !strcmp(argv[1], "-v"));
-
-	printf(_("fd.path = \"%s\"\n"), file->name);
-	printf(_("fd.flags = %s,%s,%s%s%s%s%s\n"),
-		file->flags & IO_OSYNC ? _("sync") : _("non-sync"),
-		file->flags & IO_DIRECT ? _("direct") : _("non-direct"),
-		file->flags & IO_READONLY ? _("read-only") : _("read-write"),
-		file->flags & IO_REALTIME ? _(",real-time") : "",
-		file->flags & IO_APPEND ? _(",append-only") : "",
-		file->flags & IO_NONBLOCK ? _(",non-block") : "",
-		file->flags & IO_TMPFILE ? _(",tmpfile") : "");
-	if (fstat(file->fd, &st) < 0) {
-		perror("fstat");
-	} else {
-		printf(_("stat.ino = %lld\n"), (long long)st.st_ino);
-		printf(_("stat.type = %s\n"), filetype(st.st_mode));
-		printf(_("stat.size = %lld\n"), (long long)st.st_size);
-		printf(_("stat.blocks = %lld\n"), (long long)st.st_blocks);
-		if (verbose) {
-			printf(_("stat.atime = %s"), ctime(&st.st_atime));
-			printf(_("stat.mtime = %s"), ctime(&st.st_mtime));
-			printf(_("stat.ctime = %s"), ctime(&st.st_ctime));
-		}
-	}
-	if (file->flags & IO_FOREIGN)
-		return 0;
-	if ((xfsctl(file->name, file->fd, FS_IOC_FSGETXATTR, &fsx)) < 0 ||
-	    (xfsctl(file->name, file->fd, XFS_IOC_FSGETXATTRA, &fsxa)) < 0) {
-		perror("FS_IOC_FSGETXATTR");
-	} else {
-		printf(_("fsxattr.xflags = 0x%x "), fsx.fsx_xflags);
-		printxattr(fsx.fsx_xflags, verbose, 0, file->name, 1, 1);
-		printf(_("fsxattr.projid = %u\n"), fsx.fsx_projid);
-		printf(_("fsxattr.extsize = %u\n"), fsx.fsx_extsize);
-		printf(_("fsxattr.cowextsize = %u\n"), fsx.fsx_cowextsize);
-		printf(_("fsxattr.nextents = %u\n"), fsx.fsx_nextents);
-		printf(_("fsxattr.naextents = %u\n"), fsxa.fsx_nextents);
-	}
-	if ((xfsctl(file->name, file->fd, XFS_IOC_DIOINFO, &dio)) < 0) {
-		perror("XFS_IOC_DIOINFO");
-	} else {
-		printf(_("dioattr.mem = 0x%x\n"), dio.d_mem);
-		printf(_("dioattr.miniosz = %u\n"), dio.d_miniosz);
-		printf(_("dioattr.maxiosz = %u\n"), dio.d_maxiosz);
-	}
-	return 0;
-}
-
 int
 openfile(
 	char		*path,
 	xfs_fsop_geom_t	*geom,
 	int		flags,
-	mode_t		mode)
+	mode_t		mode,
+	struct fs_path	*fs_path)
 {
+	struct fs_path	*fsp;
 	int		fd;
 	int		oflags;
 
@@ -210,6 +120,14 @@ openfile(
 			}
 		}
 	}
+
+	if (fs_path) {
+		fsp = fs_table_lookup(path, FS_MOUNT_POINT);
+		if (!fsp)
+			memset(fs_path, 0, sizeof(*fs_path));
+		else
+			*fs_path = *fsp;
+	}
 	return fd;
 }
 
@@ -218,7 +136,8 @@ addfile(
 	char		*name,
 	int		fd,
 	xfs_fsop_geom_t	*geometry,
-	int		flags)
+	int		flags,
+	struct fs_path	*fs_path)
 {
 	char		*filename;
 
@@ -246,6 +165,7 @@ addfile(
 	file->flags = flags;
 	file->name = filename;
 	file->geom = *geometry;
+	file->fs_path = *fs_path;
 	return 0;
 }
 
@@ -287,6 +207,7 @@ open_f(
 	char		*sp;
 	mode_t		mode = 0600;
 	xfs_fsop_geom_t	geometry = { 0 };
+	struct fs_path	fsp;
 
 	if (argc == 1) {
 		if (file)
@@ -349,14 +270,14 @@ open_f(
 		return -1;
 	}
 
-	fd = openfile(argv[optind], &geometry, flags, mode);
+	fd = openfile(argv[optind], &geometry, flags, mode, &fsp);
 	if (fd < 0)
 		return 0;
 
 	if (!platform_test_xfs_fd(fd))
 		flags |= IO_FOREIGN;
 
-	addfile(argv[optind], fd, &geometry, flags);
+	addfile(argv[optind], fd, &geometry, flags, &fsp);
 	return 0;
 }
 
@@ -697,62 +618,6 @@ extsize_f(
 	return 0;
 }
 
-static int
-statfs_f(
-	int			argc,
-	char			**argv)
-{
-	struct xfs_fsop_counts	fscounts;
-	struct xfs_fsop_geom	fsgeo;
-	struct statfs		st;
-
-	printf(_("fd.path = \"%s\"\n"), file->name);
-	if (platform_fstatfs(file->fd, &st) < 0) {
-		perror("fstatfs");
-	} else {
-		printf(_("statfs.f_bsize = %lld\n"), (long long) st.f_bsize);
-		printf(_("statfs.f_blocks = %lld\n"), (long long) st.f_blocks);
-#if defined(__sgi__)
-		printf(_("statfs.f_frsize = %lld\n"), (long long) st.f_frsize);
-#else
-		printf(_("statfs.f_bavail = %lld\n"), (long long) st.f_bavail);
-#endif
-		printf(_("statfs.f_files = %lld\n"), (long long) st.f_files);
-		printf(_("statfs.f_ffree = %lld\n"), (long long) st.f_ffree);
-	}
-	if (file->flags & IO_FOREIGN)
-		return 0;
-	if ((xfsctl(file->name, file->fd, XFS_IOC_FSGEOMETRY_V1, &fsgeo)) < 0) {
-		perror("XFS_IOC_FSGEOMETRY_V1");
-	} else {
-		printf(_("geom.bsize = %u\n"), fsgeo.blocksize);
-		printf(_("geom.agcount = %u\n"), fsgeo.agcount);
-		printf(_("geom.agblocks = %u\n"), fsgeo.agblocks);
-		printf(_("geom.datablocks = %llu\n"),
-			(unsigned long long) fsgeo.datablocks);
-		printf(_("geom.rtblocks = %llu\n"),
-			(unsigned long long) fsgeo.rtblocks);
-		printf(_("geom.rtextents = %llu\n"),
-			(unsigned long long) fsgeo.rtextents);
-		printf(_("geom.rtextsize = %u\n"), fsgeo.rtextsize);
-		printf(_("geom.sunit = %u\n"), fsgeo.sunit);
-		printf(_("geom.swidth = %u\n"), fsgeo.swidth);
-	}
-	if ((xfsctl(file->name, file->fd, XFS_IOC_FSCOUNTS, &fscounts)) < 0) {
-		perror("XFS_IOC_FSCOUNTS");
-	} else {
-		printf(_("counts.freedata = %llu\n"),
-			(unsigned long long) fscounts.freedata);
-		printf(_("counts.freertx = %llu\n"),
-			(unsigned long long) fscounts.freertx);
-		printf(_("counts.freeino = %llu\n"),
-			(unsigned long long) fscounts.freeino);
-		printf(_("counts.allocino = %llu\n"),
-			(unsigned long long) fscounts.allocino);
-	}
-	return 0;
-}
-
 static void
 inode_help(void)
 {
@@ -897,14 +762,14 @@ inode_f(
 
 	if (verbose && result_ino) {
 		/* Requested verbose and we have an answer */
-		printf("%llu:%d\n", result_ino,
+		printf("%llu:%d\n", (unsigned long long)result_ino,
 			result_ino > XFS_MAXINUMBER_32 ? 64 : 32);
 	} else if (userino == NULLFSINO) {
 		/* Just checking 32 or 64 bit presence, non-verbose */
 		printf("%d\n", result_ino > XFS_MAXINUMBER_32 ? 1 : 0);
 	} else {
 		/* We asked about a specific inode, non-verbose */
-		printf("%llu\n", result_ino);
+		printf("%llu\n", (unsigned long long)result_ino);
 	}
 
 	return 0;
@@ -918,33 +783,20 @@ open_init(void)
 	open_cmd.cfunc = open_f;
 	open_cmd.argmin = 0;
 	open_cmd.argmax = -1;
-	open_cmd.flags = CMD_NOMAP_OK | CMD_NOFILE_OK | CMD_FOREIGN_OK;
+	open_cmd.flags = CMD_NOMAP_OK | CMD_NOFILE_OK |
+			 CMD_FOREIGN_OK | CMD_FLAG_ONESHOT;
 	open_cmd.args = _("[-acdrstxT] [-m mode] [path]");
 	open_cmd.oneline = _("open the file specified by path");
 	open_cmd.help = open_help;
 
-	stat_cmd.name = "stat";
-	stat_cmd.cfunc = stat_f;
-	stat_cmd.argmin = 0;
-	stat_cmd.argmax = 1;
-	stat_cmd.flags = CMD_NOMAP_OK | CMD_FOREIGN_OK;
-	stat_cmd.args = _("[-v]");
-	stat_cmd.oneline = _("statistics on the currently open file");
-
 	close_cmd.name = "close";
 	close_cmd.altname = "c";
 	close_cmd.cfunc = close_f;
 	close_cmd.argmin = 0;
 	close_cmd.argmax = 0;
-	close_cmd.flags = CMD_NOMAP_OK | CMD_FOREIGN_OK;
+	close_cmd.flags = CMD_NOMAP_OK | CMD_FOREIGN_OK | CMD_FLAG_ONESHOT;
 	close_cmd.oneline = _("close the current open file");
 
-	statfs_cmd.name = "statfs";
-	statfs_cmd.cfunc = statfs_f;
-	statfs_cmd.flags = CMD_NOMAP_OK | CMD_FOREIGN_OK;
-	statfs_cmd.oneline =
-		_("statistics on the filesystem of the currently open file");
-
 	chproj_cmd.name = "chproj";
 	chproj_cmd.cfunc = chproj_f;
 	chproj_cmd.args = _("[-D | -R] projid");
@@ -960,7 +812,7 @@ open_init(void)
 	lsproj_cmd.args = _("[-D | -R]");
 	lsproj_cmd.argmin = 0;
 	lsproj_cmd.argmax = -1;
-	lsproj_cmd.flags = CMD_NOMAP_OK;
+	lsproj_cmd.flags = CMD_NOMAP_OK | CMD_FOREIGN_OK;
 	lsproj_cmd.oneline =
 		_("list project identifier set on the currently open file");
 	lsproj_cmd.help = lsproj_help;
@@ -980,15 +832,13 @@ open_init(void)
 	inode_cmd.args = _("[-nv] [num]");
 	inode_cmd.argmin = 0;
 	inode_cmd.argmax = 3;
-	inode_cmd.flags = CMD_NOMAP_OK;
+	inode_cmd.flags = CMD_NOMAP_OK | CMD_FLAG_ONESHOT;
 	inode_cmd.oneline =
 		_("Query inode number usage in the filesystem");
 	inode_cmd.help = inode_help;
 
 	add_command(&open_cmd);
-	add_command(&stat_cmd);
 	add_command(&close_cmd);
-	add_command(&statfs_cmd);
 	add_command(&chproj_cmd);
 	add_command(&lsproj_cmd);
 	add_command(&extsize_cmd);
diff -urpN xfsprogs-4.9.0/io/pread.c xfsprogs-4.14.0/io/pread.c
--- xfsprogs-4.9.0/io/pread.c	2016-12-21 06:36:07.000000000 +0100
+++ xfsprogs-4.14.0/io/pread.c	2017-11-27 17:57:55.000000000 +0100
@@ -16,6 +16,8 @@
  * Inc.,  51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
  */
 
+#define _BSD_SOURCE
+#define _DEFAULT_SOURCE
 #include <sys/uio.h>
 #include "command.h"
 #include "input.h"
@@ -170,12 +172,12 @@ dump_buffer(
 }
 
 #ifdef HAVE_PREADV
-static int
+static ssize_t
 do_preadv(
 	int		fd,
 	off64_t		offset,
-	ssize_t		count,
-	ssize_t		buffer_size)
+	size_t		count,
+	size_t		buffer_size)
 {
 	int		vecs = 0;
 	ssize_t		oldlen = 0;
@@ -206,12 +208,12 @@ do_preadv(
 #define do_preadv(fd, offset, count, buffer_size) (0)
 #endif
 
-static int
+static ssize_t
 do_pread(
 	int		fd,
 	off64_t		offset,
-	ssize_t		count,
-	ssize_t		buffer_size)
+	size_t		count,
+	size_t		buffer_size)
 {
 	if (!vectors)
 		return pread(fd, buffer, min(count, buffer_size), offset);
diff -urpN xfsprogs-4.9.0/io/prealloc.c xfsprogs-4.14.0/io/prealloc.c
--- xfsprogs-4.9.0/io/prealloc.c	2016-12-13 21:07:08.000000000 +0100
+++ xfsprogs-4.14.0/io/prealloc.c	2017-11-20 01:14:14.000000000 +0100
@@ -210,7 +210,7 @@ fallocate_f(
 			mode = FALLOC_FL_KEEP_SIZE;
 			break;
 		case 'p':
-			mode = FALLOC_FL_PUNCH_HOLE;
+			mode = FALLOC_FL_PUNCH_HOLE|FALLOC_FL_KEEP_SIZE;
 			break;
 		case 'u':
 			mode = FALLOC_FL_UNSHARE_RANGE;
diff -urpN xfsprogs-4.9.0/io/pwrite.c xfsprogs-4.14.0/io/pwrite.c
--- xfsprogs-4.9.0/io/pwrite.c	2016-12-21 06:36:07.000000000 +0100
+++ xfsprogs-4.14.0/io/pwrite.c	2017-11-27 17:57:55.000000000 +0100
@@ -47,22 +47,27 @@ pwrite_help(void)
 " -W   -- call fsync(2) at the end (included in timing results)\n"
 " -B   -- write backwards through the range from offset (backwards N bytes)\n"
 " -F   -- write forwards through the range of bytes from offset (default)\n"
+" -O   -- perform pwrite call once and return (maybe partial) bytes written\n"
 " -R   -- write at random offsets in the specified range of bytes\n"
 " -Z N -- zeed the random number generator (used when writing randomly)\n"
 "         (heh, zorry, the -s/-S arguments were already in use in pwrite)\n"
 #ifdef HAVE_PWRITEV
 " -V N -- use vectored IO with N iovecs of blocksize each (pwritev)\n"
 #endif
+#ifdef HAVE_PWRITEV2
+" -N   -- Perform the pwritev2() with RWF_NOWAIT\n"
+#endif
 "\n"));
 }
 
 #ifdef HAVE_PWRITEV
-static int
+static ssize_t
 do_pwritev(
 	int		fd,
 	off64_t		offset,
-	ssize_t		count,
-	ssize_t		buffer_size)
+	size_t		count,
+	size_t		buffer_size,
+	int 		pwritev2_flags)
 {
 	int vecs = 0;
 	ssize_t oldlen = 0;
@@ -81,7 +86,14 @@ do_pwritev(
 	} else {
 		vecs = vectors;
 	}
+#ifdef HAVE_PWRITEV2
+	if (pwritev2_flags)
+		bytes = pwritev2(fd, iov, vectors, offset, pwritev2_flags);
+	else
+		bytes = pwritev(fd, iov, vectors, offset);
+#else
 	bytes = pwritev(fd, iov, vectors, offset);
+#endif
 
 	/* restore trimmed iov */
 	if (oldlen)
@@ -90,20 +102,21 @@ do_pwritev(
 	return bytes;
 }
 #else
-#define do_pwritev(fd, offset, count, buffer_size) (0)
+#define do_pwritev(fd, offset, count, buffer_size, pwritev2_flags) (0)
 #endif
 
-static int
+static ssize_t
 do_pwrite(
 	int		fd,
 	off64_t		offset,
-	ssize_t		count,
-	ssize_t		buffer_size)
+	size_t		count,
+	size_t		buffer_size,
+	int		pwritev2_flags)
 {
 	if (!vectors)
 		return pwrite(fd, buffer, min(count, buffer_size), offset);
 
-	return do_pwritev(fd, offset, count, buffer_size);
+	return do_pwritev(fd, offset, count, buffer_size, pwritev2_flags);
 }
 
 static int
@@ -111,7 +124,8 @@ write_random(
 	off64_t		offset,
 	long long	count,
 	unsigned int	seed,
-	long long	*total)
+	long long	*total,
+	int 		pwritev2_flags)
 {
 	off64_t		off, range;
 	ssize_t		bytes;
@@ -133,7 +147,8 @@ write_random(
 				buffersize;
 		else
 			off = offset;
-		bytes = do_pwrite(file->fd, off, buffersize, buffersize);
+		bytes = do_pwrite(file->fd, off, buffersize, buffersize,
+				pwritev2_flags);
 		if (bytes == 0)
 			break;
 		if (bytes < 0) {
@@ -153,7 +168,8 @@ static int
 write_backward(
 	off64_t		offset,
 	long long	*count,
-	long long	*total)
+	long long	*total,
+	int		pwritev2_flags)
 {
 	off64_t		end, off = offset;
 	ssize_t		bytes = 0, bytes_requested;
@@ -171,7 +187,8 @@ write_backward(
 	if ((bytes_requested = (off % buffersize))) {
 		bytes_requested = min(cnt, bytes_requested);
 		off -= bytes_requested;
-		bytes = do_pwrite(file->fd, off, bytes_requested, buffersize);
+		bytes = do_pwrite(file->fd, off, bytes_requested, buffersize,
+				pwritev2_flags);
 		if (bytes == 0)
 			return ops;
 		if (bytes < 0) {
@@ -189,7 +206,8 @@ write_backward(
 	while (cnt > end) {
 		bytes_requested = min(cnt, buffersize);
 		off -= bytes_requested;
-		bytes = do_pwrite(file->fd, off, cnt, buffersize);
+		bytes = do_pwrite(file->fd, off, cnt, buffersize,
+				pwritev2_flags);
 		if (bytes == 0)
 			break;
 		if (bytes < 0) {
@@ -212,7 +230,8 @@ write_buffer(
 	size_t		bs,
 	int		fd,
 	off64_t		skip,
-	long long	*total)
+	long long	*total,
+	int		pwritev2_flags)
 {
 	ssize_t		bytes;
 	long long	bar = min(bs, count);
@@ -224,7 +243,7 @@ write_buffer(
 			if (read_buffer(fd, skip + *total, bs, &bar, 0, 1) < 0)
 				break;
 		}
-		bytes = do_pwrite(file->fd, offset, count, bar);
+		bytes = do_pwrite(file->fd, offset, count, bar, pwritev2_flags);
 		if (bytes == 0)
 			break;
 		if (bytes < 0) {
@@ -244,6 +263,22 @@ write_buffer(
 }
 
 static int
+write_once(
+	off64_t		offset,
+	long long	count,
+	long long	*total,
+	int		pwritev2_flags)
+{
+	ssize_t bytes;
+	bytes = do_pwrite(file->fd, offset, count, count, pwritev2_flags);
+	if (bytes < 0)
+		return -1;
+	*total = bytes;
+	return 1;
+}
+
+
+static int
 pwrite_f(
 	int		argc,
 	char		**argv)
@@ -258,12 +293,13 @@ pwrite_f(
 	int		Cflag, qflag, uflag, dflag, wflag, Wflag;
 	int		direction = IO_FORWARD;
 	int		c, fd = -1;
+	int		pwritev2_flags = 0;
 
 	Cflag = qflag = uflag = dflag = wflag = Wflag = 0;
 	init_cvtnum(&fsblocksize, &fssectsize);
 	bsize = fsblocksize;
 
-	while ((c = getopt(argc, argv, "b:BCdf:Fi:qRs:S:uV:wWZ:")) != EOF) {
+	while ((c = getopt(argc, argv, "b:BCdf:Fi:NqRs:OS:uV:wWZ:")) != EOF) {
 		switch (c) {
 		case 'b':
 			tmp = cvtnum(fsblocksize, fssectsize, optarg);
@@ -285,6 +321,9 @@ pwrite_f(
 		case 'R':
 			direction = IO_RANDOM;
 			break;
+		case 'O':
+			direction = IO_ONCE;
+			break;
 		case 'd':
 			dflag = 1;
 			break;
@@ -292,6 +331,11 @@ pwrite_f(
 		case 'i':
 			infile = optarg;
 			break;
+#ifdef HAVE_PWRITEV2
+		case 'N':
+			pwritev2_flags |= RWF_NOWAIT;
+			break;
+#endif
 		case 's':
 			skip = cvtnum(fsblocksize, fssectsize, optarg);
 			if (skip < 0) {
@@ -312,6 +356,7 @@ pwrite_f(
 		case 'u':
 			uflag = 1;
 			break;
+#ifdef HAVE_PWRITEV
 		case 'V':
 			vectors = strtoul(optarg, &sp, 0);
 			if (!sp || sp == optarg) {
@@ -320,6 +365,7 @@ pwrite_f(
 				return 0;
 			}
 			break;
+#endif
 		case 'w':
 			wflag = 1;
 			break;
@@ -334,7 +380,12 @@ pwrite_f(
 			}
 			break;
 		default:
-			return command_usage(&pwrite_cmd);
+			/* Handle ifdef'd-out options above */
+			if (c != '?')
+				printf(_("%s: command -%c not supported\n"), argv[0], c);
+			else
+				command_usage(&pwrite_cmd);
+			return 0;
 		}
 	}
 	if (((skip || dflag) && !infile) || (optind != argc - 2))
@@ -357,7 +408,7 @@ pwrite_f(
 		return 0;
 
 	c = IO_READONLY | (dflag ? IO_DIRECT : 0);
-	if (infile && ((fd = openfile(infile, NULL, c, 0)) < 0))
+	if (infile && ((fd = openfile(infile, NULL, c, 0, NULL)) < 0))
 		return 0;
 
 	gettimeofday(&t1, NULL);
@@ -365,13 +416,17 @@ pwrite_f(
 	case IO_RANDOM:
 		if (!zeed)	/* srandom seed */
 			zeed = time(NULL);
-		c = write_random(offset, count, zeed, &total);
+		c = write_random(offset, count, zeed, &total, pwritev2_flags);
 		break;
 	case IO_FORWARD:
-		c = write_buffer(offset, count, bsize, fd, skip, &total);
+		c = write_buffer(offset, count, bsize, fd, skip, &total,
+				pwritev2_flags);
 		break;
 	case IO_BACKWARD:
-		c = write_backward(offset, &count, &total);
+		c = write_backward(offset, &count, &total, pwritev2_flags);
+		break;
+	case IO_ONCE:
+		c = write_once(offset, count, &total, pwritev2_flags);
 		break;
 	default:
 		total = 0;
@@ -379,10 +434,18 @@ pwrite_f(
 	}
 	if (c < 0)
 		goto done;
-	if (Wflag)
-		fsync(file->fd);
-	if (wflag)
-		fdatasync(file->fd);
+	if (Wflag) {
+		if (fsync(file->fd) < 0) {
+			perror("fsync");
+			goto done;
+		}
+	}
+	if (wflag) {
+		if (fdatasync(file->fd) < 0) {
+			perror("fdatasync");
+			goto done;
+		}
+	}
 	if (qflag)
 		goto done;
 	gettimeofday(&t2, NULL);
@@ -406,7 +469,7 @@ pwrite_init(void)
 	pwrite_cmd.argmax = -1;
 	pwrite_cmd.flags = CMD_NOMAP_OK | CMD_FOREIGN_OK;
 	pwrite_cmd.args =
-_("[-i infile [-d] [-s skip]] [-b bs] [-S seed] [-wW] [-FBR [-Z N]] [-V N] off len");
+_("[-i infile [-dwNOW] [-s skip]] [-b bs] [-S seed] [-FBR [-Z N]] [-V N] off len");
 	pwrite_cmd.oneline =
 		_("writes a number of bytes at a specified offset");
 	pwrite_cmd.help = pwrite_help;
diff -urpN xfsprogs-4.9.0/io/readdir.c xfsprogs-4.14.0/io/readdir.c
--- xfsprogs-4.9.0/io/readdir.c	2017-01-05 18:41:55.000000000 +0100
+++ xfsprogs-4.14.0/io/readdir.c	2017-11-20 01:14:14.000000000 +0100
@@ -24,6 +24,10 @@
 #include <sys/types.h>
 #include <dirent.h>
 
+#ifndef _DIRENT_HAVE_D_RECLEN
+#include <string.h>
+#endif
+
 static struct cmdinfo readdir_cmd;
 
 const char *d_type_str(unsigned int type)
@@ -71,9 +75,10 @@ dump_dirent(
 	long long offset,
 	struct dirent *dirent)
 {
-	printf("%08llx: d_ino: 0x%08lx", offset, dirent->d_ino);
+	printf("%08llx: d_ino: 0x%08llx", offset,
+					(unsigned long long)dirent->d_ino);
 #ifdef _DIRENT_HAVE_D_OFF
-	printf(" d_off: 0x%08lx", dirent->d_off);
+	printf(" d_off: 0x%08llx", (unsigned long long)dirent->d_off);
 #endif
 #ifdef _DIRENT_HAVE_D_RECLEN
 	printf(" d_reclen: 0x%x", dirent->d_reclen);
@@ -106,7 +111,7 @@ read_directory(
 #ifdef _DIRENT_HAVE_D_RECLEN
 		*total += dirent->d_reclen;
 #else
-		*total += dirent->d_namlen + sizeof(*dirent);
+		*total += strlen(dirent->d_name) + sizeof(*dirent);
 #endif
 		count++;
 
diff -urpN xfsprogs-4.9.0/io/reflink.c xfsprogs-4.14.0/io/reflink.c
--- xfsprogs-4.9.0/io/reflink.c	2017-01-05 18:41:55.000000000 +0100
+++ xfsprogs-4.14.0/io/reflink.c	2017-11-20 01:14:14.000000000 +0100
@@ -78,12 +78,12 @@ dedupe_ioctl(
 			goto done;
 		}
 		if (info->status < 0) {
-			fprintf(stderr, "dedupe: %s\n",
+			fprintf(stderr, "XFS_IOC_FILE_EXTENT_SAME: %s\n",
 					_(strerror(-info->status)));
 			goto done;
 		}
 		if (info->status == XFS_EXTENT_DATA_DIFFERS) {
-			fprintf(stderr, "dedupe: %s\n",
+			fprintf(stderr, "XFS_IOC_FILE_EXTENT_SAME: %s\n",
 					_("Extents did not match."));
 			goto done;
 		}
@@ -154,7 +154,7 @@ dedupe_f(
 		return 0;
 	}
 
-	fd = openfile(infile, NULL, IO_READONLY, 0);
+	fd = openfile(infile, NULL, IO_READONLY, 0, NULL);
 	if (fd < 0)
 		return 0;
 
@@ -278,7 +278,7 @@ reflink_f(
 	}
 
 clone_all:
-	fd = openfile(infile, NULL, IO_READONLY, 0);
+	fd = openfile(infile, NULL, IO_READONLY, 0, NULL);
 	if (fd < 0)
 		return 0;
 
@@ -302,13 +302,13 @@ reflink_init(void)
 	reflink_cmd.name = "reflink";
 	reflink_cmd.altname = "rl";
 	reflink_cmd.cfunc = reflink_f;
-	reflink_cmd.argmin = 4;
+	reflink_cmd.argmin = 1;
 	reflink_cmd.argmax = -1;
-	reflink_cmd.flags = CMD_NOMAP_OK | CMD_FOREIGN_OK;
+	reflink_cmd.flags = CMD_NOMAP_OK | CMD_FOREIGN_OK | CMD_FLAG_ONESHOT;
 	reflink_cmd.args =
-_("infile src_off dst_off len");
+_("infile [src_off dst_off len]");
 	reflink_cmd.oneline =
-		_("reflinks a number of bytes at a specified offset");
+		_("reflinks an entire file, or a number of bytes at a specified offset");
 	reflink_cmd.help = reflink_help;
 
 	add_command(&reflink_cmd);
@@ -318,7 +318,7 @@ _("infile src_off dst_off len");
 	dedupe_cmd.cfunc = dedupe_f;
 	dedupe_cmd.argmin = 4;
 	dedupe_cmd.argmax = -1;
-	dedupe_cmd.flags = CMD_NOMAP_OK | CMD_FOREIGN_OK;
+	dedupe_cmd.flags = CMD_NOMAP_OK | CMD_FOREIGN_OK | CMD_FLAG_ONESHOT;
 	dedupe_cmd.args =
 _("infile src_off dst_off len");
 	dedupe_cmd.oneline =
diff -urpN xfsprogs-4.9.0/io/resblks.c xfsprogs-4.14.0/io/resblks.c
--- xfsprogs-4.9.0/io/resblks.c	2017-01-05 18:41:55.000000000 +0100
+++ xfsprogs-4.14.0/io/resblks.c	2017-11-20 01:14:14.000000000 +0100
@@ -61,7 +61,7 @@ resblks_init(void)
 	resblks_cmd.cfunc = resblks_f;
 	resblks_cmd.argmin = 0;
 	resblks_cmd.argmax = 1;
-	resblks_cmd.flags = CMD_NOMAP_OK;
+	resblks_cmd.flags = CMD_NOMAP_OK | CMD_FLAG_ONESHOT;
 	resblks_cmd.args = _("[blocks]");
 	resblks_cmd.oneline =
 		_("get and/or set count of reserved filesystem blocks");
diff -urpN xfsprogs-4.9.0/io/seek.c xfsprogs-4.14.0/io/seek.c
--- xfsprogs-4.9.0/io/seek.c	2016-12-21 06:36:07.000000000 +0100
+++ xfsprogs-4.14.0/io/seek.c	2017-11-20 01:14:14.000000000 +0100
@@ -147,7 +147,10 @@ seek_f(
 	 * decide if we want to display that type of entry.
 	 */
 	if (flag & SEEK_HFLAG) {
+		current = HOLE;
 		offset = lseek(file->fd, start, SEEK_HOLE);
+		if (offset != -1 && offset < start)
+			goto bad_result;
 		if ((start == offset) || !(flag & SEEK_DFLAG)) {
 			/*
 			 * this offset is a hole or are only displaying holes.
@@ -155,7 +158,6 @@ seek_f(
 			 * data, then we will fall through below to
 			 * initialize the data search.
 			 */
-			current = HOLE;
 			goto found_hole;
 		}
 	}
@@ -163,6 +165,8 @@ seek_f(
 	/* The offset is not a hole, or we are looking just for data */
 	current = DATA;
 	offset = lseek(file->fd, start, SEEK_DATA);
+	if (offset != -1 && offset < start)
+		goto bad_result;
 
 found_hole:
 	/*
@@ -203,8 +207,15 @@ found_hole:
 		current ^= 1;		/* alternate between data and hole */
 		start = offset;
 		offset = lseek(file->fd, start, seekinfo[current].seektype);
+		if (offset != -1 && offset <= start)
+			goto bad_result;
 	}
 	return 0;
+
+bad_result:
+	fprintf(stderr, "Invalid seek result: lseek(<fd>, %lld, SEEK_%s) = %lld\n",
+		(long long)start, seekinfo[current].name, (long long)offset);
+	return 0;
 }
 
 void
diff -urpN xfsprogs-4.9.0/io/sendfile.c xfsprogs-4.14.0/io/sendfile.c
--- xfsprogs-4.9.0/io/sendfile.c	2016-12-21 06:36:07.000000000 +0100
+++ xfsprogs-4.14.0/io/sendfile.c	2017-11-20 01:14:14.000000000 +0100
@@ -115,7 +115,7 @@ sendfile_f(
 
 	if (!infile)
 		fd = filetable[fd].fd;
-	else if ((fd = openfile(infile, NULL, IO_READONLY, 0)) < 0)
+	else if ((fd = openfile(infile, NULL, IO_READONLY, 0, NULL)) < 0)
 		return 0;
 
 	if (optind == argc - 2) {
diff -urpN xfsprogs-4.9.0/io/shutdown.c xfsprogs-4.14.0/io/shutdown.c
--- xfsprogs-4.9.0/io/shutdown.c	2017-01-05 18:41:55.000000000 +0100
+++ xfsprogs-4.14.0/io/shutdown.c	2017-11-20 01:14:14.000000000 +0100
@@ -54,7 +54,7 @@ shutdown_init(void)
 	shutdown_cmd.cfunc = shutdown_f;
 	shutdown_cmd.argmin = 0;
 	shutdown_cmd.argmax = 1;
-	shutdown_cmd.flags = CMD_NOMAP_OK;
+	shutdown_cmd.flags = CMD_NOMAP_OK | CMD_FLAG_ONESHOT | CMD_FLAG_FOREIGN_OK;
 	shutdown_cmd.args = _("[-f]");
 	shutdown_cmd.oneline =
 		_("shuts down the filesystem where the current file resides");
diff -urpN xfsprogs-4.9.0/io/stat.c xfsprogs-4.14.0/io/stat.c
--- xfsprogs-4.9.0/io/stat.c	1970-01-01 01:00:00.000000000 +0100
+++ xfsprogs-4.14.0/io/stat.c	2017-11-27 17:57:55.000000000 +0100
@@ -0,0 +1,417 @@
+/*
+ * Copyright (c) 2003-2005 Silicon Graphics, Inc.
+ * All Rights Reserved.
+ *
+ * Copyright (C) 2015, 2017 Red Hat, Inc.
+ * Portions of statx support written by David Howells (dhowells@redhat.com)
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License as
+ * published by the Free Software Foundation.
+ *
+ * This program is distributed in the hope that it would be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write the Free Software Foundation,
+ * Inc.,  51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
+ */
+
+#include "command.h"
+#include "input.h"
+#include "init.h"
+#include "io.h"
+#include "statx.h"
+#include "libxfs.h"
+
+#include <fcntl.h>
+
+static cmdinfo_t stat_cmd;
+static cmdinfo_t statfs_cmd;
+static cmdinfo_t statx_cmd;
+
+off64_t
+filesize(void)
+{
+	struct stat	st;
+
+	if (fstat(file->fd, &st) < 0) {
+		perror("fstat");
+		return -1;
+	}
+	return st.st_size;
+}
+
+static char *
+filetype(mode_t mode)
+{
+	switch (mode & S_IFMT) {
+	case S_IFSOCK:
+		return _("socket");
+	case S_IFDIR:
+		return _("directory");
+	case S_IFCHR:
+		return _("char device");
+	case S_IFBLK:
+		return _("block device");
+	case S_IFREG:
+		return _("regular file");
+	case S_IFLNK:
+		return _("symbolic link");
+	case S_IFIFO:
+		return _("fifo");
+	}
+	return NULL;
+}
+
+static int
+dump_raw_stat(struct stat *st)
+{
+	printf("stat.blksize = %lu\n", (unsigned long)st->st_blksize);
+	printf("stat.nlink = %lu\n", (unsigned long)st->st_nlink);
+	printf("stat.uid = %u\n", st->st_uid);
+	printf("stat.gid = %u\n", st->st_gid);
+	printf("stat.mode: 0%o\n", st->st_mode);
+	printf("stat.ino = %llu\n", (unsigned long long)st->st_ino);
+	printf("stat.size = %lld\n", (long long)st->st_size);
+	printf("stat.blocks = %lld\n", (long long)st->st_blocks);
+	printf("stat.atime.tv_sec = %ld\n", st->st_atim.tv_sec);
+	printf("stat.atime.tv_nsec = %ld\n", st->st_atim.tv_nsec);
+	printf("stat.ctime.tv_sec = %ld\n", st->st_ctim.tv_sec);
+	printf("stat.ctime.tv_nsec = %ld\n", st->st_ctim.tv_nsec);
+	printf("stat.mtime.tv_sec = %ld\n", st->st_mtim.tv_sec);
+	printf("stat.mtime.tv_nsec = %ld\n", st->st_mtim.tv_nsec);
+	printf("stat.rdev_major = %u\n", major(st->st_rdev));
+	printf("stat.rdev_minor = %u\n", minor(st->st_rdev));
+	printf("stat.dev_major = %u\n", major(st->st_dev));
+	printf("stat.dev_minor = %u\n", minor(st->st_dev));
+	return 0;
+}
+
+void print_file_info(void)
+{
+	printf(_("fd.path = \"%s\"\n"), file->name);
+	printf(_("fd.flags = %s,%s,%s%s%s%s%s\n"),
+		file->flags & IO_OSYNC ? _("sync") : _("non-sync"),
+		file->flags & IO_DIRECT ? _("direct") : _("non-direct"),
+		file->flags & IO_READONLY ? _("read-only") : _("read-write"),
+		file->flags & IO_REALTIME ? _(",real-time") : "",
+		file->flags & IO_APPEND ? _(",append-only") : "",
+		file->flags & IO_NONBLOCK ? _(",non-block") : "",
+		file->flags & IO_TMPFILE ? _(",tmpfile") : "");
+}
+
+void print_xfs_info(int verbose)
+{
+	struct dioattr	dio;
+	struct fsxattr	fsx, fsxa;
+
+	if ((xfsctl(file->name, file->fd, FS_IOC_FSGETXATTR, &fsx)) < 0 ||
+	    (xfsctl(file->name, file->fd, XFS_IOC_FSGETXATTRA, &fsxa)) < 0) {
+		perror("FS_IOC_FSGETXATTR");
+	} else {
+		printf(_("fsxattr.xflags = 0x%x "), fsx.fsx_xflags);
+		printxattr(fsx.fsx_xflags, verbose, 0, file->name, 1, 1);
+		printf(_("fsxattr.projid = %u\n"), fsx.fsx_projid);
+		printf(_("fsxattr.extsize = %u\n"), fsx.fsx_extsize);
+		printf(_("fsxattr.cowextsize = %u\n"), fsx.fsx_cowextsize);
+		printf(_("fsxattr.nextents = %u\n"), fsx.fsx_nextents);
+		printf(_("fsxattr.naextents = %u\n"), fsxa.fsx_nextents);
+	}
+	if ((xfsctl(file->name, file->fd, XFS_IOC_DIOINFO, &dio)) < 0) {
+		perror("XFS_IOC_DIOINFO");
+	} else {
+		printf(_("dioattr.mem = 0x%x\n"), dio.d_mem);
+		printf(_("dioattr.miniosz = %u\n"), dio.d_miniosz);
+		printf(_("dioattr.maxiosz = %u\n"), dio.d_maxiosz);
+	}
+}
+
+int
+stat_f(
+	int		argc,
+	char		**argv)
+{
+	struct stat	st;
+	int		c, verbose = 0, raw = 0;
+
+	while ((c = getopt(argc, argv, "rv")) != EOF) {
+		switch (c) {
+		case 'r':
+			raw = 1;
+			break;
+		case 'v':
+			verbose = 1;
+			break;
+		default:
+			return command_usage(&stat_cmd);
+		}
+	}
+
+	if (raw && verbose)
+		return command_usage(&stat_cmd);
+
+	if (fstat(file->fd, &st) < 0) {
+		perror("fstat");
+		return 0;
+	}
+
+	if (raw)
+		return dump_raw_stat(&st);
+
+	print_file_info();
+
+	printf(_("stat.ino = %lld\n"), (long long)st.st_ino);
+	printf(_("stat.type = %s\n"), filetype(st.st_mode));
+	printf(_("stat.size = %lld\n"), (long long)st.st_size);
+	printf(_("stat.blocks = %lld\n"), (long long)st.st_blocks);
+	if (verbose) {
+		printf(_("stat.atime = %s"), ctime(&st.st_atime));
+		printf(_("stat.mtime = %s"), ctime(&st.st_mtime));
+		printf(_("stat.ctime = %s"), ctime(&st.st_ctime));
+	}
+
+	if (file->flags & IO_FOREIGN)
+		return 0;
+
+	print_xfs_info(verbose);
+
+	return 0;
+}
+
+static int
+statfs_f(
+	int			argc,
+	char			**argv)
+{
+	struct xfs_fsop_counts	fscounts;
+	struct xfs_fsop_geom	fsgeo;
+	struct statfs		st;
+
+	printf(_("fd.path = \"%s\"\n"), file->name);
+	if (platform_fstatfs(file->fd, &st) < 0) {
+		perror("fstatfs");
+	} else {
+		printf(_("statfs.f_bsize = %lld\n"), (long long) st.f_bsize);
+		printf(_("statfs.f_blocks = %lld\n"), (long long) st.f_blocks);
+		printf(_("statfs.f_bavail = %lld\n"), (long long) st.f_bavail);
+		printf(_("statfs.f_files = %lld\n"), (long long) st.f_files);
+		printf(_("statfs.f_ffree = %lld\n"), (long long) st.f_ffree);
+#ifdef HAVE_STATFS_FLAGS
+		printf(_("statfs.f_flags = 0x%llx\n"), (long long) st.f_flags);
+#endif
+	}
+	if (file->flags & IO_FOREIGN)
+		return 0;
+	if ((xfsctl(file->name, file->fd, XFS_IOC_FSGEOMETRY_V1, &fsgeo)) < 0) {
+		perror("XFS_IOC_FSGEOMETRY_V1");
+	} else {
+		printf(_("geom.bsize = %u\n"), fsgeo.blocksize);
+		printf(_("geom.agcount = %u\n"), fsgeo.agcount);
+		printf(_("geom.agblocks = %u\n"), fsgeo.agblocks);
+		printf(_("geom.datablocks = %llu\n"),
+			(unsigned long long) fsgeo.datablocks);
+		printf(_("geom.rtblocks = %llu\n"),
+			(unsigned long long) fsgeo.rtblocks);
+		printf(_("geom.rtextents = %llu\n"),
+			(unsigned long long) fsgeo.rtextents);
+		printf(_("geom.rtextsize = %u\n"), fsgeo.rtextsize);
+		printf(_("geom.sunit = %u\n"), fsgeo.sunit);
+		printf(_("geom.swidth = %u\n"), fsgeo.swidth);
+	}
+	if ((xfsctl(file->name, file->fd, XFS_IOC_FSCOUNTS, &fscounts)) < 0) {
+		perror("XFS_IOC_FSCOUNTS");
+	} else {
+		printf(_("counts.freedata = %llu\n"),
+			(unsigned long long) fscounts.freedata);
+		printf(_("counts.freertx = %llu\n"),
+			(unsigned long long) fscounts.freertx);
+		printf(_("counts.freeino = %llu\n"),
+			(unsigned long long) fscounts.freeino);
+		printf(_("counts.allocino = %llu\n"),
+			(unsigned long long) fscounts.allocino);
+	}
+	return 0;
+}
+
+static ssize_t
+_statx(
+	int		dfd,
+	const char	*filename,
+	unsigned int	flags,
+	unsigned int	mask,
+	struct statx	*buffer)
+{
+#ifdef __NR_statx
+	return syscall(__NR_statx, dfd, filename, flags, mask, buffer);
+#else
+	errno = ENOSYS;
+	return -1;
+#endif
+}
+
+static void
+statx_help(void)
+{
+        printf(_(
+"\n"
+" Display extended file status.\n"
+"\n"
+" Options:\n"
+" -v -- More verbose output\n"
+" -r -- Print raw statx structure fields\n"
+" -m mask -- Specify the field mask for the statx call\n"
+"            (can also be 'basic' or 'all'; default STATX_ALL)\n"
+" -D -- Don't sync attributes with the server\n"
+" -F -- Force the attributes to be sync'd with the server\n"
+"\n"));
+}
+
+/* statx helper */
+static int
+dump_raw_statx(struct statx *stx)
+{
+	printf("stat.mask = 0x%x\n", stx->stx_mask);
+	printf("stat.blksize = %u\n", stx->stx_blksize);
+	printf("stat.attributes = 0x%llx\n", (unsigned long long)stx->stx_attributes);
+	printf("stat.nlink = %u\n", stx->stx_nlink);
+	printf("stat.uid = %u\n", stx->stx_uid);
+	printf("stat.gid = %u\n", stx->stx_gid);
+	printf("stat.mode: 0%o\n", stx->stx_mode);
+	printf("stat.ino = %llu\n", (unsigned long long)stx->stx_ino);
+	printf("stat.size = %llu\n", (unsigned long long)stx->stx_size);
+	printf("stat.blocks = %llu\n", (unsigned long long)stx->stx_blocks);
+	printf("stat.atime.tv_sec = %lld\n", (long long)stx->stx_atime.tv_sec);
+	printf("stat.atime.tv_nsec = %d\n", stx->stx_atime.tv_nsec);
+	printf("stat.btime.tv_sec = %lld\n", (long long)stx->stx_btime.tv_sec);
+	printf("stat.btime.tv_nsec = %d\n", stx->stx_btime.tv_nsec);
+	printf("stat.ctime.tv_sec = %lld\n", (long long)stx->stx_ctime.tv_sec);
+	printf("stat.ctime.tv_nsec = %d\n", stx->stx_ctime.tv_nsec);
+	printf("stat.mtime.tv_sec = %lld\n", (long long)stx->stx_mtime.tv_sec);
+	printf("stat.mtime.tv_nsec = %d\n", stx->stx_mtime.tv_nsec);
+	printf("stat.rdev_major = %u\n", stx->stx_rdev_major);
+	printf("stat.rdev_minor = %u\n", stx->stx_rdev_minor);
+	printf("stat.dev_major = %u\n", stx->stx_dev_major);
+	printf("stat.dev_minor = %u\n", stx->stx_dev_minor);
+	return 0;
+}
+
+/*
+ * options:
+ * 	- input flags - query type
+ * 	- output style for flags (and all else?) (chars vs. hex?)
+ * 	- output - mask out incidental flag or not?
+ */
+int
+statx_f(
+	int		argc,
+	char		**argv)
+{
+	int		c, verbose = 0, raw = 0;
+	char		*p;
+	struct statx	stx;
+	int		atflag = 0;
+	unsigned int	mask = STATX_ALL;
+
+	while ((c = getopt(argc, argv, "m:rvFD")) != EOF) {
+		switch (c) {
+		case 'm':
+			if (strcmp(optarg, "basic") == 0)
+				mask = STATX_BASIC_STATS;
+			else if (strcmp(optarg, "all") == 0)
+				mask = STATX_ALL;
+			else {
+				mask = strtoul(optarg, &p, 0);
+				if (!p || p == optarg) {
+					printf(
+				_("non-numeric mask -- %s\n"), optarg);
+					return 0;
+				}
+			}
+			break;
+		case 'r':
+			raw = 1;
+			break;
+		case 'v':
+			verbose = 1;
+			break;
+		case 'F':
+			atflag &= ~AT_STATX_SYNC_TYPE;
+			atflag |= AT_STATX_FORCE_SYNC;
+			break;
+		case 'D':
+			atflag &= ~AT_STATX_SYNC_TYPE;
+			atflag |= AT_STATX_DONT_SYNC;
+			break;
+		default:
+			return command_usage(&statx_cmd);
+		}
+	}
+
+	if (raw && verbose)
+		return command_usage(&statx_cmd);
+
+	memset(&stx, 0xbf, sizeof(stx));
+	if (_statx(file->fd, "", atflag | AT_EMPTY_PATH, mask, &stx) < 0) {
+		perror("statx");
+		return 0;
+	}
+
+	if (raw)
+		return dump_raw_statx(&stx);
+
+	print_file_info();
+
+	printf(_("stat.ino = %lld\n"), (long long)stx.stx_ino);
+	printf(_("stat.type = %s\n"), filetype(stx.stx_mode));
+	printf(_("stat.size = %lld\n"), (long long)stx.stx_size);
+	printf(_("stat.blocks = %lld\n"), (long long)stx.stx_blocks);
+	if (verbose) {
+		printf(_("stat.atime = %s"), ctime((time_t *)&stx.stx_atime.tv_sec));
+		printf(_("stat.mtime = %s"), ctime((time_t *)&stx.stx_mtime.tv_sec));
+		printf(_("stat.ctime = %s"), ctime((time_t *)&stx.stx_ctime.tv_sec));
+		if (stx.stx_mask & STATX_BTIME)
+			printf(_("stat.btime = %s"),
+				ctime((time_t *)&stx.stx_btime.tv_sec));
+	}
+
+	if (file->flags & IO_FOREIGN)
+		return 0;
+
+	print_xfs_info(verbose);
+
+	return 0;
+}
+
+void
+stat_init(void)
+{
+	stat_cmd.name = "stat";
+	stat_cmd.cfunc = stat_f;
+	stat_cmd.argmin = 0;
+	stat_cmd.argmax = 1;
+	stat_cmd.flags = CMD_NOMAP_OK | CMD_FOREIGN_OK;
+	stat_cmd.args = _("[-v|-r]");
+	stat_cmd.oneline = _("statistics on the currently open file");
+
+	statx_cmd.name = "statx";
+	statx_cmd.cfunc = statx_f;
+	statx_cmd.argmin = 0;
+	statx_cmd.argmax = -1;
+	statx_cmd.flags = CMD_NOMAP_OK | CMD_FOREIGN_OK;
+	statx_cmd.args = _("[-v|-r][-m basic | -m all | -m <mask>][-FD]");
+	statx_cmd.oneline = _("extended statistics on the currently open file");
+	statx_cmd.help = statx_help;
+
+	statfs_cmd.name = "statfs";
+	statfs_cmd.cfunc = statfs_f;
+	statfs_cmd.flags = CMD_NOMAP_OK | CMD_FOREIGN_OK;
+	statfs_cmd.oneline =
+		_("statistics on the filesystem of the currently open file");
+
+	add_command(&stat_cmd);
+	add_command(&statx_cmd);
+	add_command(&statfs_cmd);
+}
diff -urpN xfsprogs-4.9.0/io/statx.h xfsprogs-4.14.0/io/statx.h
--- xfsprogs-4.9.0/io/statx.h	1970-01-01 01:00:00.000000000 +0100
+++ xfsprogs-4.14.0/io/statx.h	2017-11-20 01:14:14.000000000 +0100
@@ -0,0 +1,168 @@
+#ifndef XFS_IO_STATX_H
+#define XFS_IO_STATX_H
+
+#include <unistd.h>
+#include <sys/syscall.h>
+
+#ifndef AT_EMPTY_PATH
+#define AT_EMPTY_PATH	0x1000
+#endif
+
+#ifndef AT_STATX_SYNC_TYPE
+#define AT_STATX_SYNC_TYPE      0x6000  /* Type of synchronisation required from statx() */
+#define AT_STATX_SYNC_AS_STAT   0x0000  /* - Do whatever stat() does */
+#define AT_STATX_FORCE_SYNC     0x2000  /* - Force the attributes to be sync'd with the server */
+#define AT_STATX_DONT_SYNC      0x4000  /* - Don't sync attributes with the server */
+#endif
+
+#ifndef AT_NO_AUTOMOUNT
+#define AT_NO_AUTOMOUNT		0x800	/* Suppress terminal automount traversal */
+#endif
+
+#ifndef __NR_statx
+# if defined(__i386__) || defined(__powerpc__)
+#  define __NR_statx 383
+# elif defined (__x86_64__)
+#  if defined (__ILP32__)
+#   define __NR_statx (__X32_SYSCALL_BIT + 332)
+#  else
+#   define __NR_statx 332
+#  endif
+# endif
+#endif
+
+#ifndef STATX_TYPE
+
+/*
+ * Timestamp structure for the timestamps in struct statx.
+ *
+ * tv_sec holds the number of seconds before (negative) or after (positive)
+ * 00:00:00 1st January 1970 UTC.
+ *
+ * tv_nsec holds a number of nanoseconds before (0..-999,999,999 if tv_sec is
+ * negative) or after (0..999,999,999 if tv_sec is positive) the tv_sec time.
+ *
+ * Note that if both tv_sec and tv_nsec are non-zero, then the two values must
+ * either be both positive or both negative.
+ *
+ * __reserved is held in case we need a yet finer resolution.
+ */
+struct statx_timestamp {
+	__s64	tv_sec;
+	__s32	tv_nsec;
+	__s32	__reserved;
+};
+
+/*
+ * Structures for the extended file attribute retrieval system call
+ * (statx()).
+ *
+ * The caller passes a mask of what they're specifically interested in as a
+ * parameter to statx().  What statx() actually got will be indicated in
+ * st_mask upon return.
+ *
+ * For each bit in the mask argument:
+ *
+ * - if the datum is not supported:
+ *
+ *   - the bit will be cleared, and
+ *
+ *   - the datum will be set to an appropriate fabricated value if one is
+ *     available (eg. CIFS can take a default uid and gid), otherwise
+ *
+ *   - the field will be cleared;
+ *
+ * - otherwise, if explicitly requested:
+ *
+ *   - the datum will be synchronised to the server if AT_STATX_FORCE_SYNC is
+ *     set or if the datum is considered out of date, and
+ *
+ *   - the field will be filled in and the bit will be set;
+ *
+ * - otherwise, if not requested, but available in approximate form without any
+ *   effort, it will be filled in anyway, and the bit will be set upon return
+ *   (it might not be up to date, however, and no attempt will be made to
+ *   synchronise the internal state first);
+ *
+ * - otherwise the field and the bit will be cleared before returning.
+ *
+ * Items in STATX_BASIC_STATS may be marked unavailable on return, but they
+ * will have values installed for compatibility purposes so that stat() and
+ * co. can be emulated in userspace.
+ */
+struct statx {
+	/* 0x00 */
+	__u32	stx_mask;	/* What results were written [uncond] */
+	__u32	stx_blksize;	/* Preferred general I/O size [uncond] */
+	__u64	stx_attributes;	/* Flags conveying information about the file [uncond] */
+	/* 0x10 */
+	__u32	stx_nlink;	/* Number of hard links */
+	__u32	stx_uid;	/* User ID of owner */
+	__u32	stx_gid;	/* Group ID of owner */
+	__u16	stx_mode;	/* File mode */
+	__u16	__spare0[1];
+	/* 0x20 */
+	__u64	stx_ino;	/* Inode number */
+	__u64	stx_size;	/* File size */
+	__u64	stx_blocks;	/* Number of 512-byte blocks allocated */
+	__u64	__spare1[1];
+	/* 0x40 */
+	struct statx_timestamp	stx_atime;	/* Last access time */
+	struct statx_timestamp	stx_btime;	/* File creation time */
+	struct statx_timestamp	stx_ctime;	/* Last attribute change time */
+	struct statx_timestamp	stx_mtime;	/* Last data modification time */
+	/* 0x80 */
+	__u32	stx_rdev_major;	/* Device ID of special file [if bdev/cdev] */
+	__u32	stx_rdev_minor;
+	__u32	stx_dev_major;	/* ID of device containing file [uncond] */
+	__u32	stx_dev_minor;
+	/* 0x90 */
+	__u64	__spare2[14];	/* Spare space for future expansion */
+	/* 0x100 */
+};
+
+/*
+ * Flags to be stx_mask
+ *
+ * Query request/result mask for statx() and struct statx::stx_mask.
+ *
+ * These bits should be set in the mask argument of statx() to request
+ * particular items when calling statx().
+ */
+#define STATX_TYPE		0x00000001U	/* Want/got stx_mode & S_IFMT */
+#define STATX_MODE		0x00000002U	/* Want/got stx_mode & ~S_IFMT */
+#define STATX_NLINK		0x00000004U	/* Want/got stx_nlink */
+#define STATX_UID		0x00000008U	/* Want/got stx_uid */
+#define STATX_GID		0x00000010U	/* Want/got stx_gid */
+#define STATX_ATIME		0x00000020U	/* Want/got stx_atime */
+#define STATX_MTIME		0x00000040U	/* Want/got stx_mtime */
+#define STATX_CTIME		0x00000080U	/* Want/got stx_ctime */
+#define STATX_INO		0x00000100U	/* Want/got stx_ino */
+#define STATX_SIZE		0x00000200U	/* Want/got stx_size */
+#define STATX_BLOCKS		0x00000400U	/* Want/got stx_blocks */
+#define STATX_BASIC_STATS	0x000007ffU	/* The stuff in the normal stat struct */
+#define STATX_BTIME		0x00000800U	/* Want/got stx_btime */
+#define STATX_ALL		0x00000fffU	/* All currently supported flags */
+#define STATX__RESERVED		0x80000000U	/* Reserved for future struct statx expansion */
+
+/*
+ * Attributes to be found in stx_attributes
+ *
+ * These give information about the features or the state of a file that might
+ * be of use to ordinary userspace programs such as GUIs or ls rather than
+ * specialised tools.
+ *
+ * Note that the flags marked [I] correspond to generic FS_IOC_FLAGS
+ * semantically.  Where possible, the numerical value is picked to correspond
+ * also.
+ */
+#define STATX_ATTR_COMPRESSED		0x00000004 /* [I] File is compressed by the fs */
+#define STATX_ATTR_IMMUTABLE		0x00000010 /* [I] File is marked immutable */
+#define STATX_ATTR_APPEND		0x00000020 /* [I] File is append-only */
+#define STATX_ATTR_NODUMP		0x00000040 /* [I] File is not to be dumped */
+#define STATX_ATTR_ENCRYPTED		0x00000800 /* [I] File requires key to decrypt in fs */
+
+#define STATX_ATTR_AUTOMOUNT		0x00001000 /* Dir: Automount trigger */
+
+#endif /* STATX_TYPE */
+#endif /* XFS_IO_STATX_H */
diff -urpN xfsprogs-4.9.0/io/sync.c xfsprogs-4.14.0/io/sync.c
--- xfsprogs-4.9.0/io/sync.c	2017-01-05 18:41:55.000000000 +0100
+++ xfsprogs-4.14.0/io/sync.c	2017-11-20 01:14:14.000000000 +0100
@@ -52,7 +52,8 @@ sync_init(void)
 {
 	sync_cmd.name = "sync";
 	sync_cmd.cfunc = sync_f;
-	sync_cmd.flags = CMD_NOMAP_OK | CMD_NOFILE_OK | CMD_FOREIGN_OK;
+	sync_cmd.flags = CMD_NOMAP_OK | CMD_NOFILE_OK |
+			 CMD_FOREIGN_OK | CMD_FLAG_ONESHOT;
 	sync_cmd.oneline =
 		_("calls sync(2) to flush all in-core filesystem state to disk");
 
diff -urpN xfsprogs-4.9.0/io/utimes.c xfsprogs-4.14.0/io/utimes.c
--- xfsprogs-4.9.0/io/utimes.c	1970-01-01 01:00:00.000000000 +0100
+++ xfsprogs-4.14.0/io/utimes.c	2017-11-20 01:14:14.000000000 +0100
@@ -0,0 +1,81 @@
+/*
+ * Copyright (c) 2016 Deepa Dinamani
+ * All Rights Reserved.
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License as
+ * published by the Free Software Foundation.
+ *
+ * This program is distributed in the hope that it would be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write the Free Software Foundation,
+ * Inc.,  51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
+ */
+
+#include "command.h"
+#include "input.h"
+#include "init.h"
+#include "io.h"
+
+static cmdinfo_t utimes_cmd;
+
+static void
+utimes_help(void)
+{
+	printf(_(
+"\n"
+" Update file atime and mtime of the current file with nansecond precision.\n"
+"\n"
+" Usage: utimes atime_sec atime_nsec mtime_sec mtime_nsec.\n"
+" *_sec: Seconds elapsed since 1970-01-01 00:00:00 UTC.\n"
+" *_nsec: Nanoseconds since the corresponding *_sec.\n"
+"\n"));
+}
+
+static int
+utimes_f(
+	int		argc,
+	char		**argv)
+{
+	struct timespec t[2];
+	int result;
+
+	/* Get the timestamps */
+	result = timespec_from_string(argv[1], argv[2], &t[0]);
+	if (result) {
+		fprintf(stderr, "Bad value for atime\n");
+		return 0;
+	}
+	result = timespec_from_string(argv[3], argv[4], &t[1]);
+	if (result) {
+		fprintf(stderr, "Bad value for mtime\n");
+		return 0;
+	}
+
+	/* Call futimens to update time. */
+	if (futimens(file->fd, t)) {
+		perror("futimens");
+		return 0;
+	}
+
+	return 0;
+}
+
+void
+utimes_init(void)
+{
+	utimes_cmd.name = "utimes";
+	utimes_cmd.cfunc = utimes_f;
+	utimes_cmd.argmin = 4;
+	utimes_cmd.argmax = 4;
+	utimes_cmd.flags = CMD_NOMAP_OK | CMD_FOREIGN_OK;
+	utimes_cmd.args = _("atime_sec atime_nsec mtime_sec mtime_nsec");
+	utimes_cmd.oneline = _("Update file times of the current file");
+	utimes_cmd.help = utimes_help;
+
+	add_command(&utimes_cmd);
+}
diff -urpN xfsprogs-4.9.0/libhandle/handle.c xfsprogs-4.14.0/libhandle/handle.c
--- xfsprogs-4.9.0/libhandle/handle.c	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/libhandle/handle.c	2017-11-20 01:14:14.000000000 +0100
@@ -232,7 +232,7 @@ obj_to_handle(
 {
 	char		hbuf [MAXHANSIZ];
 	int		ret;
-	__uint32_t	handlen;
+	uint32_t	handlen;
 	xfs_fsop_handlereq_t hreq;
 
 	if (opcode == XFS_IOC_FD_TO_HANDLE) {
diff -urpN xfsprogs-4.9.0/libhandle/jdm.c xfsprogs-4.14.0/libhandle/jdm.c
--- xfsprogs-4.9.0/libhandle/jdm.c	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/libhandle/jdm.c	2017-11-20 01:14:14.000000000 +0100
@@ -36,7 +36,7 @@ typedef struct filehandle {
 	fshandle_t fh_fshandle;		/* handle of fs containing this inode */
 	int16_t fh_sz_following;	/* bytes in handle after this member */
 	char fh_pad[FILEHANDLE_SZ_PAD];	/* padding, must be zeroed */
-	__uint32_t fh_gen;		/* generation count */
+	uint32_t fh_gen;		/* generation count */
 	xfs_ino_t fh_ino;		/* 64 bit ino */
 } filehandle_t;
 
diff -urpN xfsprogs-4.9.0/libxcmd/command.c xfsprogs-4.14.0/libxcmd/command.c
--- xfsprogs-4.9.0/libxcmd/command.c	2017-01-05 18:41:55.000000000 +0100
+++ xfsprogs-4.14.0/libxcmd/command.c	2017-11-20 01:14:14.000000000 +0100
@@ -23,10 +23,16 @@
 cmdinfo_t	*cmdtab;
 int		ncmds;
 
-static argsfunc_t	args_func;
+static iterfunc_t	iter_func;
 static checkfunc_t	check_func;
-static int		ncmdline;
-static char		**cmdline;
+
+struct cmdline {
+	char	*cmdline;
+	bool	iterate;
+};
+
+static int	ncmdline;
+struct cmdline	*cmdline;
 
 static int
 compare(const void *a, const void *b)
@@ -48,6 +54,10 @@ static int
 check_command(
 	const cmdinfo_t	*ci)
 {
+	/* always run internal library supplied commands */
+	if (ci->flags & CMD_FLAG_LIBRARY)
+		return 1;
+
 	if (check_func)
 		return check_func(ci);
 	return 1;
@@ -116,81 +126,124 @@ void
 add_user_command(char *optarg)
 {
 	ncmdline++;
-	cmdline = realloc(cmdline, sizeof(char*) * (ncmdline));
+	cmdline = realloc(cmdline, sizeof(struct cmdline) * (ncmdline));
+	if (!cmdline) {
+		perror("realloc");
+		exit(1);
+	}
+	cmdline[ncmdline-1].cmdline = optarg;
+	cmdline[ncmdline-1].iterate = true;
+
+}
+
+void
+add_oneshot_user_command(char *optarg)
+{
+	ncmdline++;
+	cmdline = realloc(cmdline, sizeof(struct cmdline) * (ncmdline));
 	if (!cmdline) {
 		perror("realloc");
 		exit(1);
 	}
-	cmdline[ncmdline-1] = optarg;
+	cmdline[ncmdline-1].cmdline = optarg;
+	cmdline[ncmdline-1].iterate = false;
 }
 
+/*
+ * Run a command, iterating as necessary. Return 0 for success, non-zero
+ * if an error occurred. Errors terminate loop iteration immediately.
+ */
 static int
-args_command(
-	int	index)
+iterate_command(
+	const cmdinfo_t	*ct,
+	int		argc,
+	char		**argv)
 {
-	if (args_func)
-		return args_func(index);
-	return 0;
+	int		error = 0;
+	int		j;
+
+	/* if there's nothing to iterate, we're done! */
+	if (!iter_func)
+		return 0;
+
+	for (j = iter_func(0); j; j = iter_func(j)) {
+		error = command(ct, argc, argv);
+		if (error)
+			break;
+
+	}
+
+	return error;
 }
 
 void
-add_args_command(
-	argsfunc_t	af)
+add_command_iterator(
+	iterfunc_t	func)
 {
-	args_func = af;
+	iter_func = func;
 }
 
-void
-command_loop(void)
+static int
+process_input(
+	char		*input,
+	bool		iterate)
 {
-	int		c, i, j = 0, done = 0;
-	char		*input;
 	char		**v;
 	const cmdinfo_t	*ct;
+	int		c = 0;
+	int		error = 0;
+
+	v = breakline(input, &c);
+	if (!c)
+		goto out;
+
+	ct = find_command(v[0]);
+	if (!ct) {
+		fprintf(stderr, _("command \"%s\" not found\n"), v[0]);
+		goto out;
+	}
+
+	/* oneshot commands don't iterate */
+	if (!iterate || (ct->flags & CMD_FLAG_ONESHOT))
+		error = command(ct, c, v);
+	else
+		error = iterate_command(ct, c, v);
+out:
+	doneline(input, v);
+	return error;
+}
+
+void
+command_loop(void)
+{
+	char	*input;
+	int	done = 0;
+	int	i;
 
+	if (!cmdline) {
+		/* interactive mode */
+		while (!done) {
+			input = fetchline();
+			if (!input)
+				break;
+			done = process_input(input, false);
+		}
+		return;
+	}
+
+	/* command line mode */
 	for (i = 0; !done && i < ncmdline; i++) {
-		input = strdup(cmdline[i]);
+		input = strdup(cmdline[i].cmdline);
 		if (!input) {
 			fprintf(stderr,
 				_("cannot strdup command '%s': %s\n"),
-				cmdline[i], strerror(errno));
+				cmdline[i].cmdline, strerror(errno));
 			exit(1);
 		}
-		v = breakline(input, &c);
-		if (c) {
-			ct = find_command(v[0]);
-			if (ct) {
-				if (ct->flags & CMD_FLAG_GLOBAL)
-					done = command(ct, c, v);
-				else {
-					j = 0;
-					while (!done && (j = args_command(j)))
-						done = command(ct, c, v);
-				}
-			} else
-				fprintf(stderr, _("command \"%s\" not found\n"),
-					v[0]);
-		}
-		doneline(input, v);
-	}
-	if (cmdline) {
-		free(cmdline);
-		return;
-	}
-	while (!done) {
-		if ((input = fetchline()) == NULL)
-			break;
-		v = breakline(input, &c);
-		if (c) {
-			ct = find_command(v[0]);
-			if (ct)
-				done = command(ct, c, v);
-			else
-				fprintf(stderr, _("command \"%s\" not found\n"),
-					v[0]);
-		}
-		doneline(input, v);
+		done = process_input(input, cmdline[i].iterate);
 	}
+	free(cmdline);
+	return;
 }
 
 void
diff -urpN xfsprogs-4.9.0/libxcmd/help.c xfsprogs-4.14.0/libxcmd/help.c
--- xfsprogs-4.9.0/libxcmd/help.c	2017-01-05 18:41:55.000000000 +0100
+++ xfsprogs-4.14.0/libxcmd/help.c	2017-11-20 01:14:14.000000000 +0100
@@ -89,7 +89,7 @@ help_init(void)
 	help_cmd.cfunc = help_f;
 	help_cmd.argmin = 0;
 	help_cmd.argmax = 1;
-	help_cmd.flags = CMD_FLAG_GLOBAL | CMD_ALL_FSTYPES;
+	help_cmd.flags = CMD_FLAG_ONESHOT | CMD_FLAG_LIBRARY;
 	help_cmd.args = _("[command]");
 	help_cmd.oneline = _("help for one or all commands");
 
diff -urpN xfsprogs-4.9.0/libxcmd/input.c xfsprogs-4.14.0/libxcmd/input.c
--- xfsprogs-4.9.0/libxcmd/input.c	2017-01-05 18:41:55.000000000 +0100
+++ xfsprogs-4.14.0/libxcmd/input.c	2017-11-20 01:14:14.000000000 +0100
@@ -136,6 +136,171 @@ doneline(
 	free(vec);
 }
 
+size_t
+numlen(
+	uint64_t	val,
+	size_t		base)
+{
+	uint64_t	tmp;
+	size_t		len;
+
+	for (len = 0, tmp = val; tmp > 0; tmp = tmp / base)
+		len++;
+	return len == 0 ? 1 : len;
+}
+
+/*
+ * Convert string to int64_t, set errno if the conversion fails or
+ * doesn't fit.  Does not allow unit specifiers.  Sets errno to zero
+ * prior to conversion so you can check for bad inputs by examining
+ * errno immediately after the call.
+ */
+int64_t
+cvt_s64(
+	char		*s,
+	int		base)
+{
+	long long	i;
+	char		*sp;
+
+	errno = 0;
+	i = strtoll(s, &sp, base);
+	/*
+	 * If the input would over or underflow, return the clamped
+	 * value and let the user check errno.  If we went all the
+	 * way to the end of the input, return the converted value;
+	 * errno will be zero.
+	 */
+	if (errno || (*sp == '\0' && sp != s))
+		return i;
+
+	/* Not all the input was consumed, return error. */
+	errno = -ERANGE;
+	return INT64_MIN;
+}
+
+/*
+ * Convert string to int32_t, set errno if the conversion fails or
+ * doesn't fit.  Does not allow unit specifiers.  Sets errno to zero
+ * prior to conversion so you can check for bad inputs by examining
+ * errno immediately after the call.
+ */
+int32_t
+cvt_s32(
+	char		*s,
+	int		base)
+{
+	int64_t		i;
+
+	i = cvt_s64(s, base);
+	if (errno)
+		return i;
+	if (i > INT32_MAX || i < INT32_MIN) {
+		errno = -ERANGE;
+		return INT32_MIN;
+	}
+	return i;
+}
+
+/*
+ * Convert string to int16_t, set errno if the conversion fails or
+ * doesn't fit.  Does not allow unit specifiers.  Sets errno to zero
+ * prior to conversion so you can check for bad inputs by examining
+ * errno immediately after the call.
+ */
+int16_t
+cvt_s16(
+	char		*s,
+	int		base)
+{
+	int64_t		i;
+
+	i = cvt_s64(s, base);
+	if (errno)
+		return i;
+	if (i > INT16_MAX || i < INT16_MIN) {
+		errno = -ERANGE;
+		return INT16_MIN;
+	}
+	return i;
+}
+
+/*
+ * Convert string to uint64_t, set errno if the conversion fails or
+ * doesn't fit.  Does not allow unit specifiers.  Sets errno to zero
+ * prior to conversion so you can check for bad inputs by examining
+ * errno immediately after the call.
+ */
+uint64_t
+cvt_u64(
+	char		*s,
+	int		base)
+{
+	long long	i;
+	char		*sp;
+
+	errno = 0;
+	i = strtoll(s, &sp, base);
+	/*
+	 * If the input would over or underflow, return the clamped
+	 * value and let the user check errno.  If we went all the
+	 * way to the end of the input, return the converted value;
+	 * errno will be zero.
+	 */
+	if (errno || (*sp == '\0' && sp != s))
+		return i;
+
+	/* Not all the input was consumed, return error. */
+	errno = -ERANGE;
+	return UINT64_MAX;
+}
+
+/*
+ * Convert string to uint32_t, set errno if the conversion fails or
+ * doesn't fit.  Does not allow unit specifiers.  Sets errno to zero
+ * prior to conversion so you can check for bad inputs by examining
+ * errno immediately after the call.
+ */
+uint32_t
+cvt_u32(
+	char		*s,
+	int		base)
+{
+	uint64_t	i;
+
+	i = cvt_u64(s, base);
+	if (errno)
+		return i;
+	if (i > UINT32_MAX) {
+		errno = -ERANGE;
+		return UINT32_MAX;
+	}
+	return i;
+}
+
+/*
+ * Convert string to uint16_t, set errno if the conversion fails or
+ * doesn't fit.  Does not allow unit specifiers.  Sets errno to zero
+ * prior to conversion so you can check for bad inputs by examining
+ * errno immediately after the call.
+ */
+uint16_t
+cvt_u16(
+	char		*s,
+	int		base)
+{
+	uint64_t	i;
+
+	i = cvt_u64(s, base);
+	if (errno)
+		return i;
+	if (i > UINT16_MAX) {
+		errno = -ERANGE;
+		return UINT16_MAX;
+	}
+	return i;
+}
+
 #define EXABYTES(x)	((long long)(x) << 60)
 #define PETABYTES(x)	((long long)(x) << 50)
 #define TERABYTES(x)	((long long)(x) << 40)
@@ -327,6 +492,28 @@ timestr(
 }
 
 /*
+ * Convert from a pair of arbitrary user strings into a timespec.
+ */
+
+int
+timespec_from_string(
+	const char	* secs,
+	const char	* nsecs,
+	struct timespec	* ts)
+{
+	char* p;
+	if (!secs || !nsecs || !ts)
+		return 1;
+	ts->tv_sec = strtoull(secs, &p, 0);
+	if (*p)
+		return 1;
+	ts->tv_nsec = strtoull(nsecs, &p, 0);
+	if (*p)
+		return 1;
+	return 0;
+}
+
+/*
  * Convert from arbitrary user strings into a numeric ID.
  * If it's all numeric, we convert that inplace, else we do
  * the name lookup, and return the found identifier.
diff -urpN xfsprogs-4.9.0/libxcmd/paths.c xfsprogs-4.14.0/libxcmd/paths.c
--- xfsprogs-4.9.0/libxcmd/paths.c	2016-12-21 06:36:07.000000000 +0100
+++ xfsprogs-4.14.0/libxcmd/paths.c	2017-11-20 01:14:14.000000000 +0100
@@ -65,6 +65,9 @@ fs_device_number(
  * Find the FS table entry for the given path.  The "flags" argument
  * is a mask containing FS_MOUNT_POINT or FS_PROJECT_PATH (or both)
  * to indicate the type of table entry sought.
+ * fs_table_lookup() finds the fs table entry for the filesystem hosting
+ * the file represented in the "dir" argument. To compare against actual
+ * mount point entries, use fs_table_lookup_mount() instead.
  */
 struct fs_path *
 fs_table_lookup(
@@ -84,6 +87,34 @@ fs_table_lookup(
 			return &fs_table[i];
 	}
 	return NULL;
+}
+
+/*
+ * Find the FS table entry describing an actual mount for the given path.
+ * Unlike fs_table_lookup(), fs_table_lookup_mount() compares the "dir"
+ * argument to actual mount point entries in the table. Accordingly, it
+ * will find matches only if the "dir" argument is indeed mounted.
+ */
+struct fs_path *
+fs_table_lookup_mount(
+	const char	*dir)
+{
+	uint		i;
+	dev_t		dev = 0;
+	char		rpath[PATH_MAX];
+
+	if (fs_device_number(dir, &dev))
+		return NULL;
+
+	for (i = 0; i < fs_count; i++) {
+		if (fs_table[i].fs_flags != FS_MOUNT_POINT)
+			continue;
+		if (!realpath(fs_table[i].fs_dir, rpath))
+			continue;
+		if (strcmp(rpath, dir) == 0)
+			return &fs_table[i];
+	}
+	return NULL;
 }
 
 static int
diff -urpN xfsprogs-4.9.0/libxcmd/quit.c xfsprogs-4.14.0/libxcmd/quit.c
--- xfsprogs-4.9.0/libxcmd/quit.c	2017-01-05 18:41:55.000000000 +0100
+++ xfsprogs-4.14.0/libxcmd/quit.c	2017-11-20 01:14:14.000000000 +0100
@@ -39,7 +39,7 @@ quit_init(void)
 	quit_cmd.cfunc = quit_f;
 	quit_cmd.argmin = -1;
 	quit_cmd.argmax = -1;
-	quit_cmd.flags = CMD_FLAG_GLOBAL | CMD_ALL_FSTYPES;
+	quit_cmd.flags = CMD_FLAG_ONESHOT | CMD_FLAG_LIBRARY;
 	quit_cmd.oneline = _("exit the program");
 
 	add_command(&quit_cmd);
diff -urpN xfsprogs-4.9.0/libxcmd/topology.c xfsprogs-4.14.0/libxcmd/topology.c
--- xfsprogs-4.9.0/libxcmd/topology.c	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/libxcmd/topology.c	2017-11-20 01:14:14.000000000 +0100
@@ -23,19 +23,19 @@
 #endif /* ENABLE_BLKID */
 #include "xfs_multidisk.h"
 
-#define TERABYTES(count, blog)	((__uint64_t)(count) << (40 - (blog)))
-#define GIGABYTES(count, blog)	((__uint64_t)(count) << (30 - (blog)))
-#define MEGABYTES(count, blog)	((__uint64_t)(count) << (20 - (blog)))
+#define TERABYTES(count, blog)	((uint64_t)(count) << (40 - (blog)))
+#define GIGABYTES(count, blog)	((uint64_t)(count) << (30 - (blog)))
+#define MEGABYTES(count, blog)	((uint64_t)(count) << (20 - (blog)))
 
 void
 calc_default_ag_geometry(
 	int		blocklog,
-	__uint64_t	dblocks,
+	uint64_t	dblocks,
 	int		multidisk,
-	__uint64_t	*agsize,
-	__uint64_t	*agcount)
+	uint64_t	*agsize,
+	uint64_t	*agcount)
 {
-	__uint64_t	blocks = 0;
+	uint64_t	blocks = 0;
 	int		shift = 0;
 
 	/*
diff -urpN xfsprogs-4.9.0/libxfs/Makefile xfsprogs-4.14.0/libxfs/Makefile
--- xfsprogs-4.9.0/libxfs/Makefile	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/libxfs/Makefile	2017-11-27 17:57:52.000000000 +0100
@@ -122,9 +122,9 @@ LDIRT = gen_crc32table crc32table.h crc3
 
 default: crc32selftest ltdepend $(LTLIBRARY)
 
-crc32table.h: gen_crc32table.c
+crc32table.h: gen_crc32table.c crc32defs.h
 	@echo "    [CC]     gen_crc32table"
-	$(Q) $(BUILD_CC) $(CFLAGS) -o gen_crc32table $<
+	$(Q) $(BUILD_CC) $(BUILD_CFLAGS) -o gen_crc32table $<
 	@echo "    [GENERATE] $@"
 	$(Q) ./gen_crc32table > crc32table.h
 
@@ -133,9 +133,9 @@ crc32table.h: gen_crc32table.c
 # systems/architectures. Hence we make sure that xfsprogs will never use a
 # busted CRC calculation at build time and hence avoid putting bad CRCs down on
 # disk.
-crc32selftest: gen_crc32table.c crc32table.h crc32.c
+crc32selftest: gen_crc32table.c crc32table.h crc32.c crc32defs.h
 	@echo "    [TEST]    CRC32"
-	$(Q) $(BUILD_CC) $(CFLAGS) -D CRC32_SELFTEST=1 crc32.c -o $@
+	$(Q) $(BUILD_CC) $(BUILD_CFLAGS) -D CRC32_SELFTEST=1 crc32.c -o $@
 	$(Q) ./$@
 
 # set up include/xfs header directory
diff -urpN xfsprogs-4.9.0/libxfs/crc32defs.h xfsprogs-4.14.0/libxfs/crc32defs.h
--- xfsprogs-4.9.0/libxfs/crc32defs.h	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/libxfs/crc32defs.h	2017-11-20 01:14:14.000000000 +0100
@@ -1,4 +1,38 @@
 /*
+ * Use slice-by-8, which is the fastest variant.
+ *
+ * Calculate checksum 8 bytes at a time with a clever slicing algorithm.
+ * This is the fastest algorithm, but comes with a 8KiB lookup table.
+ * Most modern processors have enough cache to hold this table without
+ * thrashing the cache.
+ *
+ * The Linux kernel uses this as the default implementation "unless you
+ * have a good reason not to".  The reason why Kconfig urges you to pick
+ * SLICEBY8 is because people challenged the assertion that we should
+ * always use slice by 8, so Darrick wrote a crc microbenchmark utility
+ * and ran it on as many machines as he could get his hands on to show
+ * that sb8 was the fastest.
+ *
+ * Every 64-bit machine (and most of the 32-bit ones too) saw the best
+ * results with sb8.  Any machine with more than 4K of cache saw better
+ * results.  The spreadsheet still exists today[1]; note that
+ * 'crc32-kern-le' corresponds to the slice by 4 algorithm which is the
+ * default unless CRC_LE_BITS is defined explicitly.
+ *
+ * FWIW, there are a handful of board defconfigs in the kernel that
+ * don't pick sliceby8.  These are all embedded 32-bit mips/ppc systems
+ * with very small cache sizes which experience cache thrashing with the
+ * slice by 8 algorithm, and therefore chose to pick defaults that are
+ * saner for their particular board configuration.  For nearly all of
+ * XFS' perceived userbase (which we assume are 32 and 64-bit machines
+ * with sufficiently large CPU cache and largeish storage devices) slice
+ * by 8 is the right choice.
+ *
+ * [1] https://goo.gl/0LSzsG ("crc32c_bench")
+ */
+#define CRC_LE_BITS 64
+
+/*
  * There are multiple 16-bit CRC polynomials in common use, but this is
  * *the* standard CRC-32 polynomial, first popularized by Ethernet.
  * x^32+x^26+x^23+x^22+x^16+x^12+x^11+x^10+x^8+x^7+x^5+x^4+x^2+x^1+x^0
diff -urpN xfsprogs-4.9.0/libxfs/darwin.c xfsprogs-4.14.0/libxfs/darwin.c
--- xfsprogs-4.9.0/libxfs/darwin.c	2016-12-21 06:36:07.000000000 +0100
+++ xfsprogs-4.14.0/libxfs/darwin.c	2017-11-20 01:14:14.000000000 +0100
@@ -68,7 +68,7 @@ platform_flush_device(int fd, dev_t devi
 void
 platform_findsizes(char *path, int fd, long long *sz, int *bsz)
 {
-	__uint64_t	size;
+	uint64_t	size;
 	struct stat	st;
 
 	if (fstat(fd, &st) < 0) {
diff -urpN xfsprogs-4.9.0/libxfs/defer_item.c xfsprogs-4.14.0/libxfs/defer_item.c
--- xfsprogs-4.9.0/libxfs/defer_item.c	2016-12-13 21:07:08.000000000 +0100
+++ xfsprogs-4.14.0/libxfs/defer_item.c	2017-11-20 01:14:14.000000000 +0100
@@ -445,16 +445,23 @@ xfs_bmap_update_finish_item(
 	void				**state)
 {
 	struct xfs_bmap_intent		*bmap;
+	xfs_filblks_t			count;
 	int				error;
 
 	bmap = container_of(item, struct xfs_bmap_intent, bi_list);
+	count = bmap->bi_bmap.br_blockcount;
 	error = xfs_bmap_finish_one(tp, dop,
 			bmap->bi_owner,
 			bmap->bi_type, bmap->bi_whichfork,
 			bmap->bi_bmap.br_startoff,
 			bmap->bi_bmap.br_startblock,
-			bmap->bi_bmap.br_blockcount,
+			&count,
 			bmap->bi_bmap.br_state);
+	if (!error && count > 0) {
+		ASSERT(bmap->bi_type == XFS_BMAP_UNMAP);
+		bmap->bi_bmap.br_blockcount = count;
+		return -EAGAIN;
+	}
 	kmem_free(bmap);
 	return error;
 }
diff -urpN xfsprogs-4.9.0/libxfs/freebsd.c xfsprogs-4.14.0/libxfs/freebsd.c
--- xfsprogs-4.9.0/libxfs/freebsd.c	2016-12-21 06:36:07.000000000 +0100
+++ xfsprogs-4.14.0/libxfs/freebsd.c	2017-11-27 17:57:55.000000000 +0100
@@ -109,8 +109,8 @@ void
 platform_findsizes(char *path, int fd, long long *sz, int *bsz)
 {
 	struct stat	st;
-	__int64_t	size;
-	u_int		ssize;
+	int64_t		size;
+	uint		ssize;
 
 	if (fstat(fd, &st) < 0) {
 		fprintf(stderr, _("%s: "
diff -urpN xfsprogs-4.9.0/libxfs/init.c xfsprogs-4.14.0/libxfs/init.c
--- xfsprogs-4.9.0/libxfs/init.c	2016-12-21 06:36:07.000000000 +0100
+++ xfsprogs-4.14.0/libxfs/init.c	2017-11-20 01:14:14.000000000 +0100
@@ -239,13 +239,11 @@ int
 libxfs_init(libxfs_init_t *a)
 {
 	char		*blockfile;
-	char		curdir[MAXPATHLEN];
 	char		*dname;
 	char		dpath[25];
 	int		fd;
 	char		*logname;
 	char		logpath[25];
-	int		needcd;
 	char		*rawfile;
 	char		*rtname;
 	char		rtpath[25];
@@ -261,8 +259,6 @@ libxfs_init(libxfs_init_t *a)
 	a->dsize = a->lbsize = a->rtbsize = 0;
 	a->dbsize = a->logBBsize = a->logBBstart = a->rtsize = 0;
 
-	(void)getcwd(curdir,MAXPATHLEN);
-	needcd = 0;
 	fd = -1;
 	flags = (a->isreadonly | a->isdirect);
 
@@ -276,14 +272,11 @@ libxfs_init(libxfs_init_t *a)
 	if (a->volname) {
 		if(!check_open(a->volname,flags,&rawfile,&blockfile))
 			goto done;
-		needcd = 1;
 		fd = open(rawfile, O_RDONLY);
 		dname = a->dname = a->volname;
 		a->volname = NULL;
 	}
 	if (dname) {
-		if (dname[0] != '/' && needcd)
-			chdir(curdir);
 		if (a->disfile) {
 			a->ddev= libxfs_device_open(dname, a->dcreat, flags,
 						    a->setblksize);
@@ -299,12 +292,9 @@ libxfs_init(libxfs_init_t *a)
 			platform_findsizes(rawfile, a->dfd,
 					   &a->dsize, &a->dbsize);
 		}
-		needcd = 1;
 	} else
 		a->dsize = 0;
 	if (logname) {
-		if (logname[0] != '/' && needcd)
-			chdir(curdir);
 		if (a->lisfile) {
 			a->logdev = libxfs_device_open(logname,
 					a->lcreat, flags, a->setblksize);
@@ -320,12 +310,9 @@ libxfs_init(libxfs_init_t *a)
 			platform_findsizes(rawfile, a->logfd,
 					   &a->logBBsize, &a->lbsize);
 		}
-		needcd = 1;
 	} else
 		a->logBBsize = 0;
 	if (rtname) {
-		if (rtname[0] != '/' && needcd)
-			chdir(curdir);
 		if (a->risfile) {
 			a->rtdev = libxfs_device_open(rtname,
 					a->rcreat, flags, a->setblksize);
@@ -341,7 +328,6 @@ libxfs_init(libxfs_init_t *a)
 			platform_findsizes(rawfile, a->rtfd,
 					   &a->rtsize, &a->rtbsize);
 		}
-		needcd = 1;
 	} else
 		a->rtsize = 0;
 	if (a->dsize < 0) {
@@ -359,8 +345,6 @@ libxfs_init(libxfs_init_t *a)
 			progname);
 		goto done;
 	}
-	if (needcd)
-		chdir(curdir);
 	if (!libxfs_bhash_size)
 		libxfs_bhash_size = LIBXFS_BHASHSIZE(sbp);
 	libxfs_bcache = cache_init(a->bcache_flags, libxfs_bhash_size,
@@ -546,7 +530,7 @@ libxfs_initialize_perag(
 		 * the max inode percentage.
 		 */
 		if (mp->m_maxicount) {
-			__uint64_t	icount;
+			uint64_t	icount;
 
 			icount = sbp->sb_dblocks * sbp->sb_imax_pct;
 			do_div(icount, 100);
@@ -705,6 +689,13 @@ libxfs_mount(
 		mp->m_maxicount = 0;
 
 	mp->m_inode_cluster_size = XFS_INODE_BIG_CLUSTER_SIZE;
+	if (xfs_sb_version_hascrc(&mp->m_sb)) {
+		int	new_size = mp->m_inode_cluster_size;
+
+		new_size *= mp->m_sb.sb_inodesize / XFS_DINODE_MIN_SIZE;
+		if (mp->m_sb.sb_inoalignmt >= XFS_B_TO_FSBT(mp, new_size))
+			mp->m_inode_cluster_size = new_size;
+	}
 
 	/*
 	 * Set whether we're using stripe alignment.
@@ -817,6 +808,29 @@ libxfs_mount(
 			return NULL;
 	}
 
+	/*
+	 * libxfs_initialize_perag will allocate a perag structure for each ag.
+	 * If agcount is corrupted and insanely high, this will OOM the box.
+	 * If the agount seems (arbitrarily) high, try to read what would be
+	 * the last AG, and if that fails for a relatively high agcount, just
+	 * read the first one and let the user know to check the geometry.
+	 */
+	if (sbp->sb_agcount > 1000000) {
+		bp = libxfs_readbuf(mp->m_dev,
+				XFS_AG_DADDR(mp, sbp->sb_agcount - 1, 0), 1,
+				!(flags & LIBXFS_MOUNT_DEBUGGER), NULL);
+		if (bp->b_error) {
+			fprintf(stderr, _("%s: read of AG %u failed\n"),
+						progname, sbp->sb_agcount);
+			if (!(flags & LIBXFS_MOUNT_DEBUGGER))
+				return NULL;
+			fprintf(stderr, _("%s: limiting reads to AG 0\n"),
+								progname);
+			sbp->sb_agcount = 1;
+		}
+		libxfs_putbuf(bp);
+	}
+
 	error = libxfs_initialize_perag(mp, sbp->sb_agcount, &mp->m_maxagi);
 	if (error) {
 		fprintf(stderr, _("%s: perag init failed\n"),
diff -urpN xfsprogs-4.9.0/libxfs/irix.c xfsprogs-4.14.0/libxfs/irix.c
--- xfsprogs-4.9.0/libxfs/irix.c	2016-12-21 06:36:07.000000000 +0100
+++ xfsprogs-4.14.0/libxfs/irix.c	2017-11-20 01:14:14.000000000 +0100
@@ -22,7 +22,7 @@
 
 int platform_has_uuid = 0;
 extern char *progname;
-extern __int64_t findsize(char *);
+extern int64_t findsize(char *);
 
 int
 platform_check_ismounted(char *name, char *block, struct stat *s, int verbose)
diff -urpN xfsprogs-4.9.0/libxfs/libxfs_api_defs.h xfsprogs-4.14.0/libxfs/libxfs_api_defs.h
--- xfsprogs-4.9.0/libxfs/libxfs_api_defs.h	2017-01-05 18:41:55.000000000 +0100
+++ xfsprogs-4.14.0/libxfs/libxfs_api_defs.h	2017-11-27 17:57:55.000000000 +0100
@@ -32,6 +32,7 @@
 #define xfs_fs_cmn_err			libxfs_fs_cmn_err
 
 #define xfs_trans_alloc			libxfs_trans_alloc
+#define xfs_trans_alloc_empty		libxfs_trans_alloc_empty
 #define xfs_trans_add_item		libxfs_trans_add_item
 #define xfs_trans_bhold			libxfs_trans_bhold
 #define xfs_trans_binval		libxfs_trans_binval
@@ -49,7 +50,9 @@
 #define xfs_trans_init			libxfs_trans_init
 #define xfs_trans_inode_alloc_buf	libxfs_trans_inode_alloc_buf
 #define xfs_trans_log_buf		libxfs_trans_log_buf
+#define xfs_trans_ordered_buf		libxfs_trans_ordered_buf
 #define xfs_trans_log_inode		libxfs_trans_log_inode
+#define xfs_trans_roll_inode		libxfs_trans_roll_inode
 #define xfs_trans_mod_sb		libxfs_trans_mod_sb
 #define xfs_trans_read_buf		libxfs_trans_read_buf
 #define xfs_trans_read_buf_map		libxfs_trans_read_buf_map
@@ -67,6 +70,7 @@
 #define xfs_alloc_read_agf		libxfs_alloc_read_agf
 #define xfs_bmap_last_offset		libxfs_bmap_last_offset
 #define xfs_bmap_search_extents		libxfs_bmap_search_extents
+#define xfs_iext_lookup_extent		libxfs_iext_lookup_extent
 #define xfs_bmapi_write			libxfs_bmapi_write
 #define xfs_bmapi_read			libxfs_bmapi_read
 #define xfs_bunmapi			libxfs_bunmapi
@@ -75,6 +79,7 @@
 #define xfs_zero_extent			libxfs_zero_extent
 
 #define xfs_defer_init			libxfs_defer_init
+#define xfs_defer_ijoin			libxfs_defer_ijoin
 #define xfs_defer_finish		libxfs_defer_finish
 #define xfs_defer_cancel		libxfs_defer_cancel
 
@@ -88,7 +93,7 @@
 #define xfs_dir_replace			libxfs_dir_replace
 #define xfs_dir2_isblock		libxfs_dir2_isblock
 #define xfs_dir2_isleaf			libxfs_dir2_isleaf
-#define __xfs_dir2_data_freescan	libxfs_dir2_data_freescan
+#define xfs_dir2_data_freescan_int	libxfs_dir2_data_freescan_int
 #define xfs_dir2_data_log_entry		libxfs_dir2_data_log_entry
 #define xfs_dir2_data_log_header	libxfs_dir2_data_log_header
 #define xfs_dir2_data_make_free		libxfs_dir2_data_make_free
@@ -143,5 +148,6 @@
 #define xfs_refcount_get_rec		libxfs_refcount_get_rec
 #define xfs_rmap_lookup_le_range	libxfs_rmap_lookup_le_range
 #define xfs_refc_block			libxfs_refc_block
+#define xfs_rmap_compare		libxfs_rmap_compare
 
 #endif /* __LIBXFS_API_DEFS_H__ */
diff -urpN xfsprogs-4.9.0/libxfs/libxfs_io.h xfsprogs-4.14.0/libxfs/libxfs_io.h
--- xfsprogs-4.9.0/libxfs/libxfs_io.h	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/libxfs/libxfs_io.h	2017-11-20 01:14:14.000000000 +0100
@@ -76,6 +76,7 @@ typedef struct xfs_buf {
 	const struct xfs_buf_ops *b_ops;
 	struct xfs_perag	*b_pag;
 	struct xfs_buf_map	*b_maps;
+	struct xfs_buf_map	__b_map;
 	int			b_nmaps;
 #ifdef XFS_BUF_TRACING
 	struct list_head	b_lock_list;
diff -urpN xfsprogs-4.9.0/libxfs/libxfs_priv.h xfsprogs-4.14.0/libxfs/libxfs_priv.h
--- xfsprogs-4.9.0/libxfs/libxfs_priv.h	2017-01-05 18:41:55.000000000 +0100
+++ xfsprogs-4.14.0/libxfs/libxfs_priv.h	2017-11-27 17:57:55.000000000 +0100
@@ -49,14 +49,6 @@
 #ifndef __LIBXFS_INTERNAL_XFS_H__
 #define __LIBXFS_INTERNAL_XFS_H__
 
-/*
- * Repair doesn't have a inode when it calls libxfs_dir2_data_freescan,
- * so we to work around this internally for now.
- */
-#define xfs_dir2_data_freescan(ip, hdr, loghead) \
-	__xfs_dir2_data_freescan((ip)->i_mount->m_dir_geo, \
-				 (ip)->d_ops, hdr, loghead)
-
 #include "libxfs_api_defs.h"
 #include "platform_defs.h"
 #include "xfs.h"
@@ -111,8 +103,6 @@ extern char    *progname;
 #define ATTR_KERNOTIME			0
 #define ATTR_KERNOVAL			0
 
-#define IHOLD(ip)			((void) 0)
-
 #define XFS_IGET_CREATE			0x1
 #define XFS_IGET_UNTRUSTED		0x2
 
@@ -136,17 +126,13 @@ enum ce { CE_DEBUG, CE_CONT, CE_NOTE, CE
 	cmn_err(CE_ALERT, "%s: XFS_ERROR_REPORT", (e));  \
 } while (0)
 
-#define XFS_QM_DQATTACH(mp,ip,flags)	0
 #define XFS_ERRLEVEL_LOW		1
 #define XFS_FORCED_SHUTDOWN(mp)		0
 #define XFS_ILOCK_EXCL			0
 #define XFS_STATS_INC(mp, count)	do { (mp) = (mp); } while (0)
 #define XFS_STATS_DEC(mp, count, x)	do { (mp) = (mp); } while (0)
 #define XFS_STATS_ADD(mp, count, x)	do { (mp) = (mp); } while (0)
-#define XFS_TRANS_MOD_DQUOT_BYINO(mp,tp,ip,field,delta)	do { } while (0)
-#define XFS_TRANS_RESERVE_QUOTA_NBLKS(mp,tp,ip,nblks,ninos,fl)	0
-#define XFS_TRANS_UNRESERVE_QUOTA_NBLKS(mp,tp,ip,nblks,ninos,fl)	0
-#define XFS_TEST_ERROR(expr,a,b,c)	( expr )
+#define XFS_TEST_ERROR(expr,a,b)	( expr )
 #define XFS_WANT_CORRUPTED_GOTO(mp, expr, l)				\
 {									\
 	if (!(expr)) {							\
@@ -183,7 +169,10 @@ enum ce { CE_DEBUG, CE_CONT, CE_NOTE, CE
 #define unlikely(x)		(x)
 #define rcu_read_lock()		((void) 0)
 #define rcu_read_unlock()	((void) 0)
-#define WARN_ON_ONCE(expr)	((void) 0)
+/* Need to be able to handle this bare or in control flow */
+static inline bool WARN_ON_ONCE(bool expr) {
+	return (expr);
+}
 
 #define percpu_counter_read(x)		(*x)
 #define percpu_counter_read_positive(x)	((*x) > 0 ? (*x) : 0)
@@ -307,8 +296,8 @@ roundup_pow_of_two(uint v)
 	return 0;
 }
 
-static inline __uint64_t
-roundup_64(__uint64_t x, __uint32_t y)
+static inline uint64_t
+roundup_64(uint64_t x, uint32_t y)
 {
 	x += y - 1;
 	do_div(x, y);
@@ -316,20 +305,11 @@ roundup_64(__uint64_t x, __uint32_t y)
 }
 
 /* buffer management */
-#define XFS_BUF_LOCK			0
-#define XFS_BUF_TRYLOCK			0
-#define XBF_LOCK			XFS_BUF_LOCK
-#define XBF_TRYLOCK			XFS_BUF_TRYLOCK
-#define XBF_DONT_BLOCK			0
+#define XBF_TRYLOCK			0
 #define XBF_UNMAPPED			0
 #define XBF_DONE			0
-#define XFS_BUF_GETERROR(bp)		0
-#define XFS_BUF_DONE(bp)		((bp)->b_flags |= LIBXFS_B_UPTODATE)
-#define XFS_BUF_ISDONE(bp)		((bp)->b_flags & LIBXFS_B_UPTODATE)
 #define xfs_buf_stale(bp)		((bp)->b_flags |= LIBXFS_B_STALE)
 #define XFS_BUF_UNDELAYWRITE(bp)	((bp)->b_flags &= ~LIBXFS_B_DIRTY)
-#define XFS_BUF_SET_VTYPE(a,b)		((void) 0)
-#define XFS_BUF_SET_VTYPE_REF(a,b,c)	((void) 0)
 #define XFS_BUF_SET_BDSTRAT_FUNC(a,b)	((void) 0)
 
 /* avoid gcc warning */
@@ -361,9 +341,7 @@ roundup_64(__uint64_t x, __uint32_t y)
 #define XFS_MOUNT_RDONLY		0	/* ignored in userspace */
 
 
-#define xfs_trans_get_block_res(tp)	1
 #define xfs_trans_set_sync(tp)		((void) 0)
-#define xfs_trans_ordered_buf(tp, bp)	((void) 0)
 #define	xfs_trans_agblocks_delta(tp, d)
 #define	xfs_trans_agflist_delta(tp, d)
 #define	xfs_trans_agbtree_delta(tp, d)
@@ -381,26 +359,13 @@ roundup_64(__uint64_t x, __uint32_t y)
 	__d = __d; /* no set-but-unused warning */	\
 })
 #define xfs_buf_readahead_map(a,b,c,ops)	((void) 0)	/* no readahead */
-#define xfs_buftrace(x,y)			((void) 0)	/* debug only */
 
-#define xfs_cmn_err(tag,level,mp,fmt,args...)	cmn_err(level,fmt, ## args)
 #define xfs_warn(mp,fmt,args...)		cmn_err(CE_WARN,fmt, ## args)
 #define xfs_alert(mp,fmt,args...)		cmn_err(CE_ALERT,fmt, ## args)
 #define xfs_alert_tag(mp,tag,fmt,args...)	cmn_err(CE_ALERT,fmt, ## args)
 
-#define xfs_dir2_trace_args(where, args)		((void) 0)
-#define xfs_dir2_trace_args_b(where, args, bp)		((void) 0)
-#define xfs_dir2_trace_args_bb(where, args, lbp, dbp)	((void) 0)
-#define xfs_dir2_trace_args_bibii(where, args, bs, ss, bd, sd, c) ((void) 0)
-#define xfs_dir2_trace_args_db(where, args, db, bp)	((void) 0)
-#define xfs_dir2_trace_args_i(where, args, i)		((void) 0)
-#define xfs_dir2_trace_args_s(where, args, s)		((void) 0)
-#define xfs_dir2_trace_args_sb(where, args, s, bp)	((void) 0)
 #define xfs_sort					qsort
 
-#define xfs_icsb_reinit_counters(mp)			do { } while (0)
-#define xfs_initialize_perag_icache(pag)		((void) 0)
-
 #define xfs_ilock(ip,mode)				((void) 0)
 #define xfs_ilock_nowait(ip,mode)			((void) 0)
 #define xfs_ilock_demote(ip,mode)			((void) 0)
@@ -410,7 +375,6 @@ roundup_64(__uint64_t x, __uint32_t y)
 	typeof(mode) __mode = mode;				\
 	__mode = __mode; /* no set-but-unused warning */	\
 })
-#define __xfs_flock(ip)					((void) 0)
 
 /* space allocation */
 #define xfs_extent_busy_reuse(mp,ag,bno,len,user)	((void) 0)
@@ -419,17 +383,12 @@ roundup_64(__uint64_t x, __uint32_t y)
 	xfs_agnumber_t __foo = ag; 			\
 	__foo = __foo; /* no set-but-unused warning */	\
 })
-#define xfs_extent_busy_trim(args,fbno,flen,bno,len) \
-do { \
-	*(bno) = (fbno); \
-	*(len) = (flen); \
-} while (0)
-
-/* avoid unused variable warning */
-#define xfs_alloc_busy_insert(tp,ag,b,len)	({	\
-	xfs_agnumber_t __foo = ag;			\
-	__foo = 0;					\
+#define xfs_extent_busy_trim(args,bno,len,busy_gen) 	({	\
+	unsigned __foo = *(busy_gen);				\
+	*(busy_gen) = __foo;					\
+	false;							\
 })
+#define xfs_extent_busy_flush(mp,pag,busy_gen)		((void)(0))
 
 #define xfs_rotorstep				1
 #define xfs_bmap_rtalloc(a)			(-ENOSYS)
@@ -485,7 +444,7 @@ void xfs_mount_common(struct xfs_mount *
  * logitem.c and trans.c prototypes
  */
 void xfs_trans_init(struct xfs_mount *);
-int xfs_trans_roll(struct xfs_trans **, struct xfs_inode *);
+int xfs_trans_roll(struct xfs_trans **);
 
 /* xfs_trans_item.c */
 void xfs_trans_add_item(struct xfs_trans *, struct xfs_log_item *);
@@ -512,17 +471,36 @@ int  libxfs_mod_incore_sb(struct xfs_mou
 #define xfs_reinit_percpu_counters(mp)
 
 void xfs_trans_mod_sb(struct xfs_trans *, uint, long);
-void xfs_trans_init(struct xfs_mount *);
-int  xfs_trans_roll(struct xfs_trans **, struct xfs_inode *);
 void xfs_verifier_error(struct xfs_buf *bp);
 
 /* XXX: this is clearly a bug - a shared header needs to export this */
 /* xfs_rtalloc.c */
 int libxfs_rtfree_extent(struct xfs_trans *, xfs_rtblock_t, xfs_extlen_t);
 
+struct xfs_rtalloc_rec {
+	xfs_rtblock_t		ar_startblock;
+	xfs_rtblock_t		ar_blockcount;
+};
+
+typedef int (*xfs_rtalloc_query_range_fn)(
+	struct xfs_trans	*tp,
+	struct xfs_rtalloc_rec	*rec,
+	void			*priv);
+
 int libxfs_zero_extent(struct xfs_inode *ip, xfs_fsblock_t start_fsb,
                         xfs_off_t count_fsb);
 
 bool xfs_log_check_lsn(struct xfs_mount *, xfs_lsn_t);
 
+/* xfs_icache.c */
+#define xfs_inode_set_cowblocks_tag(ip)	do { } while (0)
+#define xfs_inode_set_eofblocks_tag(ip)	do { } while (0)
+
+/* xfs_stats.h */
+#define XFS_STATS_CALC_INDEX(member)	0
+#define XFS_STATS_INC_OFF(mp, off)
+#define XFS_STATS_ADD_OFF(mp, off, val)
+
+typedef unsigned char u8;
+
 #endif	/* __LIBXFS_INTERNAL_XFS_H__ */
diff -urpN xfsprogs-4.9.0/libxfs/linux.c xfsprogs-4.14.0/libxfs/linux.c
--- xfsprogs-4.9.0/libxfs/linux.c	2016-12-21 06:36:07.000000000 +0100
+++ xfsprogs-4.14.0/libxfs/linux.c	2017-11-20 01:14:14.000000000 +0100
@@ -163,7 +163,7 @@ void
 platform_findsizes(char *path, int fd, long long *sz, int *bsz)
 {
 	struct stat	st;
-	__uint64_t	size;
+	uint64_t	size;
 	int		error;
 
 	if (fstat(fd, &st) < 0) {
diff -urpN xfsprogs-4.9.0/libxfs/logitem.c xfsprogs-4.14.0/libxfs/logitem.c
--- xfsprogs-4.9.0/libxfs/logitem.c	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/libxfs/logitem.c	2017-11-27 17:57:52.000000000 +0100
@@ -121,7 +121,7 @@ xfs_buf_item_init(
 	bip->bli_item.li_mountp = mp;
 	bip->bli_buf = bp;
 	bip->bli_format.blf_type = XFS_LI_BUF;
-	bip->bli_format.blf_blkno = (__int64_t)XFS_BUF_ADDR(bp);
+	bip->bli_format.blf_blkno = (int64_t)XFS_BUF_ADDR(bp);
 	bip->bli_format.blf_len = (unsigned short)BTOBB(XFS_BUF_COUNT(bp));
 	XFS_BUF_SET_FSPRIVATE(bp, bip);
 }
diff -urpN xfsprogs-4.9.0/libxfs/radix-tree.c xfsprogs-4.14.0/libxfs/radix-tree.c
--- xfsprogs-4.9.0/libxfs/radix-tree.c	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/libxfs/radix-tree.c	2017-11-20 01:14:14.000000000 +0100
@@ -66,21 +66,21 @@ static unsigned long height_to_maxindex[
 static inline void tag_set(struct radix_tree_node *node, unsigned int tag,
 		int offset)
 {
-	*((__uint32_t *)node->tags[tag] + (offset >> 5)) |= (1 << (offset & 31));
+	*((uint32_t *)node->tags[tag] + (offset >> 5)) |= (1 << (offset & 31));
 }
 
 static inline void tag_clear(struct radix_tree_node *node, unsigned int tag,
 		int offset)
 {
-	__uint32_t 	*p = (__uint32_t*)node->tags[tag] + (offset >> 5);
-	__uint32_t 	m = 1 << (offset & 31);
+	uint32_t 	*p = (uint32_t*)node->tags[tag] + (offset >> 5);
+	uint32_t 	m = 1 << (offset & 31);
 	*p &= ~m;
 }
 
 static inline int tag_get(struct radix_tree_node *node, unsigned int tag,
 		int offset)
 {
-	return 1 & (((const __uint32_t *)node->tags[tag])[offset >> 5] >> (offset & 31));
+	return 1 & (((const uint32_t *)node->tags[tag])[offset >> 5] >> (offset & 31));
 }
 
 /*
diff -urpN xfsprogs-4.9.0/libxfs/rdwr.c xfsprogs-4.14.0/libxfs/rdwr.c
--- xfsprogs-4.9.0/libxfs/rdwr.c	2016-12-21 06:36:07.000000000 +0100
+++ xfsprogs-4.14.0/libxfs/rdwr.c	2017-11-20 01:14:14.000000000 +0100
@@ -118,9 +118,9 @@ static void unmount_record(void *p)
 	xlog_op_header_t	*op = (xlog_op_header_t *)p;
 	/* the data section must be 32 bit size aligned */
 	struct {
-	    __uint16_t magic;
-	    __uint16_t pad1;
-	    __uint32_t pad2; /* may as well make it 64 bits */
+	    uint16_t magic;
+	    uint16_t pad1;
+	    uint32_t pad2; /* may as well make it 64 bits */
 	} magic = { XLOG_UNMOUNT_TYPE, 0, 0 };
 
 	memset(p, 0, BBSIZE);
@@ -591,6 +591,13 @@ __initbuf(xfs_buf_t *bp, struct xfs_buft
 	bp->b_holder = 0;
 	bp->b_recur = 0;
 	bp->b_ops = NULL;
+
+	if (!bp->b_maps) {
+		bp->b_nmaps = 1;
+		bp->b_maps = &bp->__b_map;
+		bp->b_maps[0].bm_bn = bp->b_bn;
+		bp->b_maps[0].bm_len = bp->b_length;
+	}
 }
 
 static void
@@ -654,7 +661,8 @@ __libxfs_getbufr(int blen)
 			list_del_init(&bp->b_node.cn_mru);
 			free(bp->b_addr);
 			bp->b_addr = NULL;
-			free(bp->b_maps);
+			if (bp->b_maps != &bp->__b_map)
+				free(bp->b_maps);
 			bp->b_maps = NULL;
 		}
 	} else
diff -urpN xfsprogs-4.9.0/libxfs/trans.c xfsprogs-4.14.0/libxfs/trans.c
--- xfsprogs-4.9.0/libxfs/trans.c	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/libxfs/trans.c	2017-11-27 17:57:55.000000000 +0100
@@ -100,27 +100,21 @@ libxfs_trans_del_item(
  */
 int
 libxfs_trans_roll(
-	struct xfs_trans	**tpp,
-	struct xfs_inode	*dp)
+	struct xfs_trans	**tpp)
 {
 	struct xfs_mount	*mp;
-	struct xfs_trans	*trans;
+	struct xfs_trans	*trans = *tpp;
 	struct xfs_trans_res	tres;
+	unsigned int		old_blk_res;
 	int			error;
 
 	/*
-	 * Ensure that the inode is always logged.
-	 */
-	trans = *tpp;
-	if (dp)
-		xfs_trans_log_inode(trans, dp, XFS_ILOG_CORE);
-
-	/*
 	 * Copy the critical parameters from one trans to the next.
 	 */
 	mp = trans->t_mountp;
 	tres.tr_logres = trans->t_log_res;
 	tres.tr_logcount = trans->t_log_count;
+	old_blk_res = trans->t_blk_res;
 
 	/*
 	 * Commit the current transaction.
@@ -133,9 +127,8 @@ libxfs_trans_roll(
 	if (error)
 		return error;
 
-
 	/*
-	 * Reserve space in the log for th next transaction.
+	 * Reserve space in the log for the next transaction.
 	 * This also pushes items in the "AIL", the list of logged items,
 	 * out to disk if they are taking up space at the tail of the log
 	 * that we want to use.  This requires that either nothing be locked
@@ -145,14 +138,8 @@ libxfs_trans_roll(
 	tres.tr_logflags = XFS_TRANS_PERM_LOG_RES;
 	error = libxfs_trans_alloc(mp, &tres, 0, 0, 0, tpp);
 	trans = *tpp;
-	/*
-	 *  Ensure that the inode is in the new transaction and locked.
-	 */
-	if (error)
-		return error;
+	trans->t_blk_res = old_blk_res;
 
-	if (dp)
-		xfs_trans_ijoin(trans, dp, 0);
 	return 0;
 }
 
@@ -185,6 +172,7 @@ libxfs_trans_alloc(
 		exit(1);
 	}
 	ptr->t_mountp = mp;
+	ptr->t_blk_res = blocks;
 	INIT_LIST_HEAD(&ptr->t_items);
 #ifdef XACT_DEBUG
 	fprintf(stderr, "allocated new transaction %p\n", ptr);
@@ -193,6 +181,28 @@ libxfs_trans_alloc(
 	return 0;
 }
 
+/*
+ * Create an empty transaction with no reservation.  This is a defensive
+ * mechanism for routines that query metadata without actually modifying
+ * them -- if the metadata being queried is somehow cross-linked (think a
+ * btree block pointer that points higher in the tree), we risk deadlock.
+ * However, blocks grabbed as part of a transaction can be re-grabbed.
+ * The verifiers will notice the corrupt block and the operation will fail
+ * back to userspace without deadlocking.
+ *
+ * Note the zero-length reservation; this transaction MUST be cancelled
+ * without any dirty data.
+ */
+int
+libxfs_trans_alloc_empty(
+	struct xfs_mount		*mp,
+	struct xfs_trans		**tpp)
+{
+	struct xfs_trans_res		resv = {0};
+
+	return xfs_trans_alloc(mp, &resv, 0, 0, XFS_TRANS_NO_WRITECOUNT, tpp);
+}
+
 void
 libxfs_trans_cancel(
 	xfs_trans_t	*tp)
@@ -331,6 +341,21 @@ xfs_trans_log_inode(
 	ip->i_itemp->ili_fields |= flags;
 }
 
+int
+libxfs_trans_roll_inode(
+	struct xfs_trans	**tpp,
+	struct xfs_inode	*ip)
+{
+	int			error;
+
+	xfs_trans_log_inode(*tpp, ip, XFS_ILOG_CORE);
+	error = xfs_trans_roll(tpp);
+	if (!error)
+		xfs_trans_ijoin(*tpp, ip, 0);
+	return error;
+}
+
+
 /*
  * This is called to mark bytes first through last inclusive of the given
  * buffer as needing to be logged when the transaction is committed.
@@ -363,6 +388,26 @@ libxfs_trans_log_buf(
 	xfs_buf_item_log(bip, first, last);
 }
 
+/*
+ * For userspace, ordered buffers just need to be marked dirty so
+ * the transaction commit will write them and mark them up-to-date.
+ * In essence, they are just like any other logged buffer in userspace.
+ *
+ * If the buffer is already dirty, trigger the "already logged" return condition.
+ */
+bool
+libxfs_trans_ordered_buf(
+	struct xfs_trans	*tp,
+	struct xfs_buf		*bp)
+{
+	struct xfs_buf_log_item	*bip = bp->b_fspriv;
+	bool			ret;
+
+	ret = (bip->bli_item.li_desc->lid_flags & XFS_LID_DIRTY);
+	libxfs_trans_log_buf(tp, bp, 0, bp->b_bcount);
+	return ret;
+}
+
 void
 libxfs_trans_brelse(
 	xfs_trans_t		*tp,
@@ -728,7 +773,7 @@ trans_committed(
         list_for_each_entry_safe(lidp, next, &tp->t_items, lid_trans) {
 		struct xfs_log_item *lip = lidp->lid_item;
 
-                xfs_trans_del_item(lip);
+		xfs_trans_del_item(lip);
 
 		if (lip->li_type == XFS_LI_BUF)
 			buf_item_done((xfs_buf_log_item_t *)lip);
diff -urpN xfsprogs-4.9.0/libxfs/util.c xfsprogs-4.14.0/libxfs/util.c
--- xfsprogs-4.9.0/libxfs/util.c	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/libxfs/util.c	2017-11-27 17:57:55.000000000 +0100
@@ -36,6 +36,9 @@
 #include "xfs_ialloc.h"
 #include "xfs_alloc.h"
 #include "xfs_bit.h"
+#include "xfs_da_format.h"
+#include "xfs_da_btree.h"
+#include "xfs_dir2_priv.h"
 
 /*
  * Calculate the worst case log unit reservation for a given superblock
@@ -167,11 +170,69 @@ libxfs_trans_ichgtime(
 	if (flags & XFS_ICHGTIME_CHG)
 		VFS_I(ip)->i_ctime = tv;
 	if (flags & XFS_ICHGTIME_CREATE) {
-		ip->i_d.di_crtime.t_sec = (__int32_t)tv.tv_sec;
-		ip->i_d.di_crtime.t_nsec = (__int32_t)tv.tv_nsec;
+		ip->i_d.di_crtime.t_sec = (int32_t)tv.tv_sec;
+		ip->i_d.di_crtime.t_nsec = (int32_t)tv.tv_nsec;
 	}
 }
 
+STATIC uint16_t
+xfs_flags2diflags(
+	struct xfs_inode	*ip,
+	unsigned int		xflags)
+{
+	/* can't set PREALLOC this way, just preserve it */
+	uint16_t		di_flags =
+		(ip->i_d.di_flags & XFS_DIFLAG_PREALLOC);
+
+	if (xflags & FS_XFLAG_IMMUTABLE)
+		di_flags |= XFS_DIFLAG_IMMUTABLE;
+	if (xflags & FS_XFLAG_APPEND)
+		di_flags |= XFS_DIFLAG_APPEND;
+	if (xflags & FS_XFLAG_SYNC)
+		di_flags |= XFS_DIFLAG_SYNC;
+	if (xflags & FS_XFLAG_NOATIME)
+		di_flags |= XFS_DIFLAG_NOATIME;
+	if (xflags & FS_XFLAG_NODUMP)
+		di_flags |= XFS_DIFLAG_NODUMP;
+	if (xflags & FS_XFLAG_NODEFRAG)
+		di_flags |= XFS_DIFLAG_NODEFRAG;
+	if (xflags & FS_XFLAG_FILESTREAM)
+		di_flags |= XFS_DIFLAG_FILESTREAM;
+	if (S_ISDIR(VFS_I(ip)->i_mode)) {
+		if (xflags & FS_XFLAG_RTINHERIT)
+			di_flags |= XFS_DIFLAG_RTINHERIT;
+		if (xflags & FS_XFLAG_NOSYMLINKS)
+			di_flags |= XFS_DIFLAG_NOSYMLINKS;
+		if (xflags & FS_XFLAG_EXTSZINHERIT)
+			di_flags |= XFS_DIFLAG_EXTSZINHERIT;
+		if (xflags & FS_XFLAG_PROJINHERIT)
+			di_flags |= XFS_DIFLAG_PROJINHERIT;
+	} else if (S_ISREG(VFS_I(ip)->i_mode)) {
+		if (xflags & FS_XFLAG_REALTIME)
+			di_flags |= XFS_DIFLAG_REALTIME;
+		if (xflags & FS_XFLAG_EXTSIZE)
+			di_flags |= XFS_DIFLAG_EXTSIZE;
+	}
+
+	return di_flags;
+}
+
+STATIC uint64_t
+xfs_flags2diflags2(
+	struct xfs_inode	*ip,
+	unsigned int		xflags)
+{
+	uint64_t		di_flags2 =
+		(ip->i_d.di_flags2 & XFS_DIFLAG2_REFLINK);
+
+	if (xflags & FS_XFLAG_DAX)
+		di_flags2 |= XFS_DIFLAG2_DAX;
+	if (xflags & FS_XFLAG_COWEXTSIZE)
+		di_flags2 |= XFS_DIFLAG2_COWEXTSIZE;
+
+	return di_flags2;
+}
+
 /*
  * Allocate an inode on disk and return a copy of its in-core version.
  * Set mode, nlink, and rdev appropriately within the inode.
@@ -251,15 +312,17 @@ libxfs_ialloc(
 	ip->i_d.di_extsize = pip ? 0 : fsx->fsx_extsize;
 	ip->i_d.di_dmevmask = 0;
 	ip->i_d.di_dmstate = 0;
-	ip->i_d.di_flags = pip ? 0 : fsx->fsx_xflags;
+	ip->i_d.di_flags = pip ? 0 : xfs_flags2diflags(ip, fsx->fsx_xflags);
 
 	if (ip->i_d.di_version == 3) {
 		ASSERT(ip->i_d.di_ino == ino);
 		ASSERT(uuid_equal(&ip->i_d.di_uuid, &mp->m_sb.sb_meta_uuid));
 		VFS_I(ip)->i_version = 1;
-		ip->i_d.di_flags2 = 0;
-		ip->i_d.di_crtime.t_sec = (__int32_t)VFS_I(ip)->i_mtime.tv_sec;
-		ip->i_d.di_crtime.t_nsec = (__int32_t)VFS_I(ip)->i_mtime.tv_nsec;
+		ip->i_d.di_flags2 = pip ? 0 : xfs_flags2diflags2(ip,
+				fsx->fsx_xflags);
+		ip->i_d.di_crtime.t_sec = (int32_t)VFS_I(ip)->i_mtime.tv_sec;
+		ip->i_d.di_crtime.t_nsec = (int32_t)VFS_I(ip)->i_mtime.tv_nsec;
+		ip->i_d.di_cowextsize = pip ? 0 : fsx->fsx_cowextsize;
 	}
 
 	flags = XFS_ILOG_CORE;
@@ -433,6 +496,12 @@ libxfs_iflush_int(xfs_inode_t *ip, xfs_b
 	if (ip->i_d.di_version == 3)
 		VFS_I(ip)->i_version++;
 
+	/* Check the inline directory data. */
+	if (S_ISDIR(VFS_I(ip)->i_mode) &&
+	    ip->i_d.di_format == XFS_DINODE_FMT_LOCAL &&
+	    xfs_dir2_sf_verify(ip))
+		return -EFSCORRUPTED;
+
 	/*
 	 * Copy the dirty parts of the inode into the on-disk
 	 * inode.  We always copy out the core of the inode,
@@ -538,8 +607,10 @@ libxfs_alloc_file_space(
 		if (error)
 			goto error0;
 
-		/* complete the transaction */
-		error = xfs_defer_finish(&tp, &free_list, ip);
+		/*
+		 * Complete the transaction
+		 */
+		error = xfs_defer_finish(&tp, &free_list);
 		if (error)
 			goto error0;
 
@@ -612,7 +683,7 @@ libxfs_inode_alloc(
 
 		xfs_trans_bhold(*tp, ialloc_context);
 
-		error = xfs_trans_roll(tp, NULL);
+		error = xfs_trans_roll(tp);
 		if (error) {
 			fprintf(stderr, _("%s: cannot duplicate transaction: %s\n"),
 				progname, strerror(error));
diff -urpN xfsprogs-4.9.0/libxfs/xfs_ag_resv.c xfsprogs-4.14.0/libxfs/xfs_ag_resv.c
--- xfsprogs-4.9.0/libxfs/xfs_ag_resv.c	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/libxfs/xfs_ag_resv.c	2017-11-27 17:57:55.000000000 +0100
@@ -38,6 +38,7 @@
 #include "xfs_rmap_btree.h"
 #include "xfs_btree.h"
 #include "xfs_refcount_btree.h"
+#include "xfs_ialloc_btree.h"
 
 /*
  * Per-AG Block Reservations
@@ -109,8 +110,7 @@ xfs_ag_resv_critical(
 
 	/* Critically low if less than 10% or max btree height remains. */
 	return XFS_TEST_ERROR(avail < orig / 10 || avail < XFS_BTREE_MAXLEVELS,
-			pag->pag_mount, XFS_ERRTAG_AG_RESV_CRITICAL,
-			XFS_RANDOM_AG_RESV_CRITICAL);
+			pag->pag_mount, XFS_ERRTAG_AG_RESV_CRITICAL);
 }
 
 /*
@@ -155,7 +155,8 @@ __xfs_ag_resv_free(
 	trace_xfs_ag_resv_free(pag, type, 0);
 
 	resv = xfs_perag_resv(pag, type);
-	pag->pag_mount->m_ag_max_usable += resv->ar_asked;
+	if (pag->pag_agno == 0)
+		pag->pag_mount->m_ag_max_usable += resv->ar_asked;
 	/*
 	 * AGFL blocks are always considered "free", so whatever
 	 * was reserved at mount time must be given back at umount.
@@ -199,22 +200,37 @@ __xfs_ag_resv_init(
 	struct xfs_mount		*mp = pag->pag_mount;
 	struct xfs_ag_resv		*resv;
 	int				error;
+	xfs_extlen_t			reserved;
 
-	resv = xfs_perag_resv(pag, type);
 	if (used > ask)
 		ask = used;
-	resv->ar_asked = ask;
-	resv->ar_reserved = resv->ar_orig_reserved = ask - used;
-	mp->m_ag_max_usable -= ask;
-
-	trace_xfs_ag_resv_init(pag, type, ask);
+	reserved = ask - used;
 
-	error = xfs_mod_fdblocks(mp, -(int64_t)resv->ar_reserved, true);
-	if (error)
+	error = xfs_mod_fdblocks(mp, -(int64_t)reserved, true);
+	if (error) {
 		trace_xfs_ag_resv_init_error(pag->pag_mount, pag->pag_agno,
 				error, _RET_IP_);
+		xfs_warn(mp,
+"Per-AG reservation for AG %u failed.  Filesystem may run out of space.",
+				pag->pag_agno);
+		return error;
+	}
 
-	return error;
+	/*
+	 * Reduce the maximum per-AG allocation length by however much we're
+	 * trying to reserve for an AG.  Since this is a filesystem-wide
+	 * counter, we only make the adjustment for AG 0.  This assumes that
+	 * there aren't any AGs hungrier for per-AG reservation than AG 0.
+	 */
+	if (pag->pag_agno == 0)
+		mp->m_ag_max_usable -= ask;
+
+	resv = xfs_perag_resv(pag, type);
+	resv->ar_asked = ask;
+	resv->ar_reserved = resv->ar_orig_reserved = reserved;
+
+	trace_xfs_ag_resv_init(pag, type, ask);
+	return 0;
 }
 
 /* Create a per-AG block reservation. */
@@ -222,6 +238,8 @@ int
 xfs_ag_resv_init(
 	struct xfs_perag		*pag)
 {
+	struct xfs_mount		*mp = pag->pag_mount;
+	xfs_agnumber_t			agno = pag->pag_agno;
 	xfs_extlen_t			ask;
 	xfs_extlen_t			used;
 	int				error = 0;
@@ -230,23 +248,45 @@ xfs_ag_resv_init(
 	if (pag->pag_meta_resv.ar_asked == 0) {
 		ask = used = 0;
 
-		error = xfs_refcountbt_calc_reserves(pag->pag_mount,
-				pag->pag_agno, &ask, &used);
+		error = xfs_refcountbt_calc_reserves(mp, agno, &ask, &used);
 		if (error)
 			goto out;
 
-		error = __xfs_ag_resv_init(pag, XFS_AG_RESV_METADATA,
-				ask, used);
+		error = xfs_finobt_calc_reserves(mp, agno, &ask, &used);
 		if (error)
 			goto out;
+
+		error = __xfs_ag_resv_init(pag, XFS_AG_RESV_METADATA,
+				ask, used);
+		if (error) {
+			/*
+			 * Because we didn't have per-AG reservations when the
+			 * finobt feature was added we might not be able to
+			 * reserve all needed blocks.  Warn and fall back to the
+			 * old and potentially buggy code in that case, but
+			 * ensure we do have the reservation for the refcountbt.
+			 */
+			ask = used = 0;
+
+			mp->m_inotbt_nores = true;
+
+			error = xfs_refcountbt_calc_reserves(mp, agno, &ask,
+					&used);
+			if (error)
+				goto out;
+
+			error = __xfs_ag_resv_init(pag, XFS_AG_RESV_METADATA,
+					ask, used);
+			if (error)
+				goto out;
+		}
 	}
 
 	/* Create the AGFL metadata reservation */
 	if (pag->pag_agfl_resv.ar_asked == 0) {
 		ask = used = 0;
 
-		error = xfs_rmapbt_calc_reserves(pag->pag_mount, pag->pag_agno,
-				&ask, &used);
+		error = xfs_rmapbt_calc_reserves(mp, agno, &ask, &used);
 		if (error)
 			goto out;
 
@@ -255,6 +295,16 @@ xfs_ag_resv_init(
 			goto out;
 	}
 
+#ifdef DEBUG
+	/* need to read in the AGF for the ASSERT below to work */
+	error = xfs_alloc_pagf_init(pag->pag_mount, NULL, pag->pag_agno, 0);
+	if (error)
+		return error;
+
+	ASSERT(xfs_perag_resv(pag, XFS_AG_RESV_METADATA)->ar_reserved +
+	       xfs_perag_resv(pag, XFS_AG_RESV_AGFL)->ar_reserved <=
+	       pag->pagf_freeblks + pag->pagf_flcount);
+#endif
 out:
 	return error;
 }
diff -urpN xfsprogs-4.9.0/libxfs/xfs_alloc.c xfsprogs-4.14.0/libxfs/xfs_alloc.c
--- xfsprogs-4.9.0/libxfs/xfs_alloc.c	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/libxfs/xfs_alloc.c	2017-11-27 17:57:55.000000000 +0100
@@ -91,10 +91,7 @@ unsigned int
 xfs_alloc_set_aside(
 	struct xfs_mount	*mp)
 {
-	unsigned int		blocks;
-
-	blocks = 4 + (mp->m_sb.sb_agcount * XFS_ALLOC_AGFL_RESERVE);
-	return blocks;
+	return mp->m_sb.sb_agcount * (XFS_ALLOC_AGFL_RESERVE + 4);
 }
 
 /*
@@ -220,20 +217,22 @@ xfs_alloc_get_rec(
  * Compute aligned version of the found extent.
  * Takes alignment and min length into account.
  */
-STATIC void
+STATIC bool
 xfs_alloc_compute_aligned(
 	xfs_alloc_arg_t	*args,		/* allocation argument structure */
 	xfs_agblock_t	foundbno,	/* starting block in found extent */
 	xfs_extlen_t	foundlen,	/* length in found extent */
 	xfs_agblock_t	*resbno,	/* result block number */
-	xfs_extlen_t	*reslen)	/* result length */
+	xfs_extlen_t	*reslen,	/* result length */
+	unsigned	*busy_gen)
 {
-	xfs_agblock_t	bno;
-	xfs_extlen_t	len;
+	xfs_agblock_t	bno = foundbno;
+	xfs_extlen_t	len = foundlen;
 	xfs_extlen_t	diff;
+	bool		busy;
 
 	/* Trim busy sections out of found extent */
-	xfs_extent_busy_trim(args, foundbno, foundlen, &bno, &len);
+	busy = xfs_extent_busy_trim(args, &bno, &len, busy_gen);
 
 	/*
 	 * If we have a largish extent that happens to start before min_agbno,
@@ -258,6 +257,8 @@ xfs_alloc_compute_aligned(
 		*resbno = bno;
 		*reslen = len;
 	}
+
+	return busy;
 }
 
 /*
@@ -361,36 +362,12 @@ xfs_alloc_fix_len(
 		return;
 	ASSERT(rlen >= args->minlen && rlen <= args->maxlen);
 	ASSERT(rlen % args->prod == args->mod);
+	ASSERT(args->pag->pagf_freeblks + args->pag->pagf_flcount >=
+		rlen + args->minleft);
 	args->len = rlen;
 }
 
 /*
- * Fix up length if there is too little space left in the a.g.
- * Return 1 if ok, 0 if too little, should give up.
- */
-STATIC int
-xfs_alloc_fix_minleft(
-	xfs_alloc_arg_t	*args)		/* allocation argument structure */
-{
-	xfs_agf_t	*agf;		/* a.g. freelist header */
-	int		diff;		/* free space difference */
-
-	if (args->minleft == 0)
-		return 1;
-	agf = XFS_BUF_TO_AGF(args->agbp);
-	diff = be32_to_cpu(agf->agf_freeblks)
-		- args->len - args->minleft;
-	if (diff >= 0)
-		return 1;
-	args->len += diff;		/* shrink the allocated space */
-	/* casts to (int) catch length underflows */
-	if ((int)args->len >= (int)args->minlen)
-		return 1;
-	args->agbno = NULLAGBLOCK;
-	return 0;
-}
-
-/*
  * Update the two btrees, logically removing from freespace the extent
  * starting at rbno, rlen blocks.  The extent is contained within the
  * actual (current) free extent fbno for flen blocks.
@@ -625,7 +602,7 @@ const struct xfs_buf_ops xfs_agfl_buf_op
 /*
  * Read in the allocation group free block array.
  */
-STATIC int				/* error */
+int					/* error */
 xfs_alloc_read_agfl(
 	xfs_mount_t	*mp,		/* mount point structure */
 	xfs_trans_t	*tp,		/* transaction pointer */
@@ -685,8 +662,6 @@ xfs_alloc_ag_vextent(
 	xfs_alloc_arg_t	*args)	/* argument structure for allocation */
 {
 	int		error=0;
-	xfs_extlen_t	reservation;
-	xfs_extlen_t	oldmax;
 
 	ASSERT(args->minlen > 0);
 	ASSERT(args->maxlen > 0);
@@ -695,20 +670,6 @@ xfs_alloc_ag_vextent(
 	ASSERT(args->alignment > 0);
 
 	/*
-	 * Clamp maxlen to the amount of free space minus any reservations
-	 * that have been made.
-	 */
-	oldmax = args->maxlen;
-	reservation = xfs_ag_resv_needed(args->pag, args->resv);
-	if (args->maxlen > args->pag->pagf_freeblks - reservation)
-		args->maxlen = args->pag->pagf_freeblks - reservation;
-	if (args->maxlen == 0) {
-		args->agbno = NULLAGBLOCK;
-		args->maxlen = oldmax;
-		return 0;
-	}
-
-	/*
 	 * Branch to correct routine based on the type.
 	 */
 	args->wasfromfl = 0;
@@ -727,8 +688,6 @@ xfs_alloc_ag_vextent(
 		/* NOTREACHED */
 	}
 
-	args->maxlen = oldmax;
-
 	if (error || args->agbno == NULLAGBLOCK)
 		return error;
 
@@ -778,10 +737,11 @@ xfs_alloc_ag_vextent_exact(
 	int		error;
 	xfs_agblock_t	fbno;	/* start block of found extent */
 	xfs_extlen_t	flen;	/* length of found extent */
-	xfs_agblock_t	tbno;	/* start block of trimmed extent */
-	xfs_extlen_t	tlen;	/* length of trimmed extent */
-	xfs_agblock_t	tend;	/* end block of trimmed extent */
+	xfs_agblock_t	tbno;	/* start block of busy extent */
+	xfs_extlen_t	tlen;	/* length of busy extent */
+	xfs_agblock_t	tend;	/* end block of busy extent */
 	int		i;	/* success/failure of operation */
+	unsigned	busy_gen;
 
 	ASSERT(args->alignment == 1);
 
@@ -814,7 +774,9 @@ xfs_alloc_ag_vextent_exact(
 	/*
 	 * Check for overlapping busy extents.
 	 */
-	xfs_extent_busy_trim(args, fbno, flen, &tbno, &tlen);
+	tbno = fbno;
+	tlen = flen;
+	xfs_extent_busy_trim(args, &tbno, &tlen, &busy_gen);
 
 	/*
 	 * Give up if the start of the extent is busy, or the freespace isn't
@@ -837,9 +799,6 @@ xfs_alloc_ag_vextent_exact(
 	args->len = XFS_AGBLOCK_MIN(tend, args->agbno + args->maxlen)
 						- args->agbno;
 	xfs_alloc_fix_len(args);
-	if (!xfs_alloc_fix_minleft(args))
-		goto not_found;
-
 	ASSERT(args->agbno + args->len <= tend);
 
 	/*
@@ -897,6 +856,7 @@ xfs_alloc_find_best_extent(
 	xfs_agblock_t		sdiff;
 	int			error;
 	int			i;
+	unsigned		busy_gen;
 
 	/* The good extent is perfect, no need to  search. */
 	if (!gdiff)
@@ -910,7 +870,8 @@ xfs_alloc_find_best_extent(
 		if (error)
 			goto error0;
 		XFS_WANT_CORRUPTED_GOTO(args->mp, i == 1, error0);
-		xfs_alloc_compute_aligned(args, *sbno, *slen, sbnoa, slena);
+		xfs_alloc_compute_aligned(args, *sbno, *slen,
+				sbnoa, slena, &busy_gen);
 
 		/*
 		 * The good extent is closer than this one.
@@ -999,7 +960,8 @@ xfs_alloc_ag_vextent_near(
 	xfs_extlen_t	ltlena;		/* aligned ... */
 	xfs_agblock_t	ltnew;		/* useful start bno of left side */
 	xfs_extlen_t	rlen;		/* length of returned extent */
-	int		forced = 0;
+	bool		busy;
+	unsigned	busy_gen;
 #ifdef DEBUG
 	/*
 	 * Randomly don't execute the first algorithm.
@@ -1026,6 +988,7 @@ restart:
 	ltlen = 0;
 	gtlena = 0;
 	ltlena = 0;
+	busy = false;
 
 	/*
 	 * Get a cursor for the by-size btree.
@@ -1108,8 +1071,8 @@ restart:
 			if ((error = xfs_alloc_get_rec(cnt_cur, &ltbno, &ltlen, &i)))
 				goto error0;
 			XFS_WANT_CORRUPTED_GOTO(args->mp, i == 1, error0);
-			xfs_alloc_compute_aligned(args, ltbno, ltlen,
-						  &ltbnoa, &ltlena);
+			busy = xfs_alloc_compute_aligned(args, ltbno, ltlen,
+					&ltbnoa, &ltlena, &busy_gen);
 			if (ltlena < args->minlen)
 				continue;
 			if (ltbnoa < args->min_agbno || ltbnoa > args->max_agbno)
@@ -1145,12 +1108,7 @@ restart:
 		XFS_WANT_CORRUPTED_GOTO(args->mp, i == 1, error0);
 		ASSERT(ltbno + ltlen <= be32_to_cpu(XFS_BUF_TO_AGF(args->agbp)->agf_length));
 		args->len = blen;
-		if (!xfs_alloc_fix_minleft(args)) {
-			xfs_btree_del_cursor(cnt_cur, XFS_BTREE_NOERROR);
-			trace_xfs_alloc_near_nominleft(args);
-			return 0;
-		}
-		blen = args->len;
+
 		/*
 		 * We are allocating starting at bnew for blen blocks.
 		 */
@@ -1232,8 +1190,8 @@ restart:
 			if ((error = xfs_alloc_get_rec(bno_cur_lt, &ltbno, &ltlen, &i)))
 				goto error0;
 			XFS_WANT_CORRUPTED_GOTO(args->mp, i == 1, error0);
-			xfs_alloc_compute_aligned(args, ltbno, ltlen,
-						  &ltbnoa, &ltlena);
+			busy |= xfs_alloc_compute_aligned(args, ltbno, ltlen,
+					&ltbnoa, &ltlena, &busy_gen);
 			if (ltlena >= args->minlen && ltbnoa >= args->min_agbno)
 				break;
 			if ((error = xfs_btree_decrement(bno_cur_lt, 0, &i)))
@@ -1248,8 +1206,8 @@ restart:
 			if ((error = xfs_alloc_get_rec(bno_cur_gt, &gtbno, &gtlen, &i)))
 				goto error0;
 			XFS_WANT_CORRUPTED_GOTO(args->mp, i == 1, error0);
-			xfs_alloc_compute_aligned(args, gtbno, gtlen,
-						  &gtbnoa, &gtlena);
+			busy |= xfs_alloc_compute_aligned(args, gtbno, gtlen,
+					&gtbnoa, &gtlena, &busy_gen);
 			if (gtlena >= args->minlen && gtbnoa <= args->max_agbno)
 				break;
 			if ((error = xfs_btree_increment(bno_cur_gt, 0, &i)))
@@ -1310,9 +1268,9 @@ restart:
 	if (bno_cur_lt == NULL && bno_cur_gt == NULL) {
 		xfs_btree_del_cursor(cnt_cur, XFS_BTREE_NOERROR);
 
-		if (!forced++) {
+		if (busy) {
 			trace_xfs_alloc_near_busy(args);
-			xfs_log_force(args->mp, XFS_LOG_SYNC);
+			xfs_extent_busy_flush(args->mp, args->pag, busy_gen);
 			goto restart;
 		}
 		trace_xfs_alloc_size_neither(args);
@@ -1342,12 +1300,6 @@ restart:
 	 */
 	args->len = XFS_EXTLEN_MIN(ltlena, args->maxlen);
 	xfs_alloc_fix_len(args);
-	if (!xfs_alloc_fix_minleft(args)) {
-		trace_xfs_alloc_near_nominleft(args);
-		xfs_btree_del_cursor(bno_cur_lt, XFS_BTREE_NOERROR);
-		xfs_btree_del_cursor(cnt_cur, XFS_BTREE_NOERROR);
-		return 0;
-	}
 	rlen = args->len;
 	(void)xfs_alloc_compute_diff(args->agbno, rlen, args->alignment,
 				     args->datatype, ltbnoa, ltlena, &ltnew);
@@ -1399,7 +1351,8 @@ xfs_alloc_ag_vextent_size(
 	int		i;		/* temp status variable */
 	xfs_agblock_t	rbno;		/* returned block number */
 	xfs_extlen_t	rlen;		/* length of returned extent */
-	int		forced = 0;
+	bool		busy;
+	unsigned	busy_gen;
 
 restart:
 	/*
@@ -1408,6 +1361,7 @@ restart:
 	cnt_cur = xfs_allocbt_init_cursor(args->mp, args->tp, args->agbp,
 		args->agno, XFS_BTNUM_CNT);
 	bno_cur = NULL;
+	busy = false;
 
 	/*
 	 * Look for an entry >= maxlen+alignment-1 blocks.
@@ -1417,14 +1371,13 @@ restart:
 		goto error0;
 
 	/*
-	 * If none or we have busy extents that we cannot allocate from, then
-	 * we have to settle for a smaller extent. In the case that there are
-	 * no large extents, this will return the last entry in the tree unless
-	 * the tree is empty. In the case that there are only busy large
-	 * extents, this will return the largest small extent unless there
+	 * If none then we have to settle for a smaller extent. In the case that
+	 * there are no large extents, this will return the last entry in the
+	 * tree unless the tree is empty. In the case that there are only busy
+	 * large extents, this will return the largest small extent unless there
 	 * are no smaller extents available.
 	 */
-	if (!i || forced > 1) {
+	if (!i) {
 		error = xfs_alloc_ag_vextent_small(args, cnt_cur,
 						   &fbno, &flen, &i);
 		if (error)
@@ -1435,13 +1388,11 @@ restart:
 			return 0;
 		}
 		ASSERT(i == 1);
-		xfs_alloc_compute_aligned(args, fbno, flen, &rbno, &rlen);
+		busy = xfs_alloc_compute_aligned(args, fbno, flen, &rbno,
+				&rlen, &busy_gen);
 	} else {
 		/*
 		 * Search for a non-busy extent that is large enough.
-		 * If we are at low space, don't check, or if we fall of
-		 * the end of the btree, turn off the busy check and
-		 * restart.
 		 */
 		for (;;) {
 			error = xfs_alloc_get_rec(cnt_cur, &fbno, &flen, &i);
@@ -1449,8 +1400,8 @@ restart:
 				goto error0;
 			XFS_WANT_CORRUPTED_GOTO(args->mp, i == 1, error0);
 
-			xfs_alloc_compute_aligned(args, fbno, flen,
-						  &rbno, &rlen);
+			busy = xfs_alloc_compute_aligned(args, fbno, flen,
+					&rbno, &rlen, &busy_gen);
 
 			if (rlen >= args->maxlen)
 				break;
@@ -1462,18 +1413,13 @@ restart:
 				/*
 				 * Our only valid extents must have been busy.
 				 * Make it unbusy by forcing the log out and
-				 * retrying. If we've been here before, forcing
-				 * the log isn't making the extents available,
-				 * which means they have probably been freed in
-				 * this transaction.  In that case, we have to
-				 * give up on them and we'll attempt a minlen
-				 * allocation the next time around.
+				 * retrying.
 				 */
 				xfs_btree_del_cursor(cnt_cur,
 						     XFS_BTREE_NOERROR);
 				trace_xfs_alloc_size_busy(args);
-				if (!forced++)
-					xfs_log_force(args->mp, XFS_LOG_SYNC);
+				xfs_extent_busy_flush(args->mp,
+							args->pag, busy_gen);
 				goto restart;
 			}
 		}
@@ -1509,8 +1455,8 @@ restart:
 			XFS_WANT_CORRUPTED_GOTO(args->mp, i == 1, error0);
 			if (flen < bestrlen)
 				break;
-			xfs_alloc_compute_aligned(args, fbno, flen,
-						  &rbno, &rlen);
+			busy = xfs_alloc_compute_aligned(args, fbno, flen,
+					&rbno, &rlen, &busy_gen);
 			rlen = XFS_EXTLEN_MIN(args->maxlen, rlen);
 			XFS_WANT_CORRUPTED_GOTO(args->mp, rlen == 0 ||
 				(rlen <= flen && rbno + rlen <= fbno + flen),
@@ -1539,18 +1485,16 @@ restart:
 	 */
 	args->len = rlen;
 	if (rlen < args->minlen) {
-		if (!forced++) {
+		if (busy) {
 			xfs_btree_del_cursor(cnt_cur, XFS_BTREE_NOERROR);
 			trace_xfs_alloc_size_busy(args);
-			xfs_log_force(args->mp, XFS_LOG_SYNC);
+			xfs_extent_busy_flush(args->mp, args->pag, busy_gen);
 			goto restart;
 		}
 		goto out_nominleft;
 	}
 	xfs_alloc_fix_len(args);
 
-	if (!xfs_alloc_fix_minleft(args))
-		goto out_nominleft;
 	rlen = args->len;
 	XFS_WANT_CORRUPTED_GOTO(args->mp, rlen <= flen, error0);
 	/*
@@ -1636,6 +1580,10 @@ xfs_alloc_ag_vextent_small(
 
 				bp = xfs_btree_get_bufs(args->mp, args->tp,
 					args->agno, fbno, 0);
+				if (!bp) {
+					error = -EFSCORRUPTED;
+					goto error0;
+				}
 				xfs_trans_binval(args->tp, bp);
 			}
 			args->len = 1;
@@ -2052,7 +2000,7 @@ xfs_alloc_space_available(
 	int			flags)
 {
 	struct xfs_perag	*pag = args->pag;
-	xfs_extlen_t		longest;
+	xfs_extlen_t		alloc_len, longest;
 	xfs_extlen_t		reservation; /* blocks that are still reserved */
 	int			available;
 
@@ -2062,17 +2010,28 @@ xfs_alloc_space_available(
 	reservation = xfs_ag_resv_needed(pag, args->resv);
 
 	/* do we have enough contiguous free space for the allocation? */
+	alloc_len = args->minlen + (args->alignment - 1) + args->minalignslop;
 	longest = xfs_alloc_longest_free_extent(args->mp, pag, min_free,
 			reservation);
-	if ((args->minlen + args->alignment + args->minalignslop - 1) > longest)
+	if (longest < alloc_len)
 		return false;
 
 	/* do we have enough free space remaining for the allocation? */
 	available = (int)(pag->pagf_freeblks + pag->pagf_flcount -
-			  reservation - min_free - args->total);
-	if (available < (int)args->minleft || available <= 0)
+			  reservation - min_free - args->minleft);
+	if (available < (int)max(args->total, alloc_len))
 		return false;
 
+	/*
+	 * Clamp maxlen to the amount of free space available for the actual
+	 * extent allocation.
+	 */
+	if (available < (int)args->maxlen && !(flags & XFS_ALLOC_FLAG_CHECK)) {
+		args->maxlen = available;
+		ASSERT(args->maxlen > 0);
+		ASSERT(args->maxlen >= args->minlen);
+	}
+
 	return true;
 }
 
@@ -2118,7 +2077,8 @@ xfs_alloc_fix_freelist(
 	}
 
 	need = xfs_alloc_min_freelist(mp, pag);
-	if (!xfs_alloc_space_available(args, need, flags))
+	if (!xfs_alloc_space_available(args, need, flags |
+			XFS_ALLOC_FLAG_CHECK))
 		goto out_agbp_relse;
 
 	/*
@@ -2181,6 +2141,10 @@ xfs_alloc_fix_freelist(
 		if (error)
 			goto out_agbp_relse;
 		bp = xfs_btree_get_bufs(mp, tp, args->agno, bno, 0);
+		if (!bp) {
+			error = -EFSCORRUPTED;
+			goto out_agbp_relse;
+		}
 		xfs_trans_binval(tp, bp);
 	}
 
@@ -2451,12 +2415,15 @@ xfs_agf_verify(
 	      be32_to_cpu(agf->agf_flcount) <= XFS_AGFL_SIZE(mp)))
 		return false;
 
-	if (be32_to_cpu(agf->agf_levels[XFS_BTNUM_BNO]) > XFS_BTREE_MAXLEVELS ||
+	if (be32_to_cpu(agf->agf_levels[XFS_BTNUM_BNO]) < 1 ||
+	    be32_to_cpu(agf->agf_levels[XFS_BTNUM_CNT]) < 1 ||
+	    be32_to_cpu(agf->agf_levels[XFS_BTNUM_BNO]) > XFS_BTREE_MAXLEVELS ||
 	    be32_to_cpu(agf->agf_levels[XFS_BTNUM_CNT]) > XFS_BTREE_MAXLEVELS)
 		return false;
 
 	if (xfs_sb_version_hasrmapbt(&mp->m_sb) &&
-	    be32_to_cpu(agf->agf_levels[XFS_BTNUM_RMAP]) > XFS_BTREE_MAXLEVELS)
+	    (be32_to_cpu(agf->agf_levels[XFS_BTNUM_RMAP]) < 1 ||
+	     be32_to_cpu(agf->agf_levels[XFS_BTNUM_RMAP]) > XFS_BTREE_MAXLEVELS))
 		return false;
 
 	/*
@@ -2473,7 +2440,8 @@ xfs_agf_verify(
 		return false;
 
 	if (xfs_sb_version_hasreflink(&mp->m_sb) &&
-	    be32_to_cpu(agf->agf_refcount_level) > XFS_BTREE_MAXLEVELS)
+	    (be32_to_cpu(agf->agf_refcount_level) < 1 ||
+	     be32_to_cpu(agf->agf_refcount_level) > XFS_BTREE_MAXLEVELS))
 		return false;
 
 	return true;;
@@ -2490,8 +2458,7 @@ xfs_agf_read_verify(
 	    !xfs_buf_verify_cksum(bp, XFS_AGF_CRC_OFF))
 		xfs_buf_ioerror(bp, -EFSBADCRC);
 	else if (XFS_TEST_ERROR(!xfs_agf_verify(mp, bp), mp,
-				XFS_ERRTAG_ALLOC_READ_AGF,
-				XFS_RANDOM_ALLOC_READ_AGF))
+				XFS_ERRTAG_ALLOC_READ_AGF))
 		xfs_buf_ioerror(bp, -EFSCORRUPTED);
 
 	if (bp->b_error)
@@ -2631,12 +2598,10 @@ xfs_alloc_vextent(
 	xfs_agblock_t	agsize;	/* allocation group size */
 	int		error;
 	int		flags;	/* XFS_ALLOC_FLAG_... locking flags */
-	xfs_extlen_t	minleft;/* minimum left value, temp copy */
 	xfs_mount_t	*mp;	/* mount structure pointer */
 	xfs_agnumber_t	sagno;	/* starting allocation group number */
 	xfs_alloctype_t	type;	/* input allocation type */
 	int		bump_rotor = 0;
-	int		no_min = 0;
 	xfs_agnumber_t	rotorstep = xfs_rotorstep; /* inode32 agf stepper */
 
 	mp = args->mp;
@@ -2665,7 +2630,6 @@ xfs_alloc_vextent(
 		trace_xfs_alloc_vextent_badargs(args);
 		return 0;
 	}
-	minleft = args->minleft;
 
 	switch (type) {
 	case XFS_ALLOCTYPE_THIS_AG:
@@ -2676,9 +2640,7 @@ xfs_alloc_vextent(
 		 */
 		args->agno = XFS_FSB_TO_AGNO(mp, args->fsbno);
 		args->pag = xfs_perag_get(mp, args->agno);
-		args->minleft = 0;
 		error = xfs_alloc_fix_freelist(args, 0);
-		args->minleft = minleft;
 		if (error) {
 			trace_xfs_alloc_vextent_nofix(args);
 			goto error0;
@@ -2706,21 +2668,11 @@ xfs_alloc_vextent(
 		args->agbno = XFS_FSB_TO_AGBNO(mp, args->fsbno);
 		args->type = XFS_ALLOCTYPE_NEAR_BNO;
 		/* FALLTHROUGH */
-	case XFS_ALLOCTYPE_ANY_AG:
-	case XFS_ALLOCTYPE_START_AG:
 	case XFS_ALLOCTYPE_FIRST_AG:
 		/*
 		 * Rotate through the allocation groups looking for a winner.
 		 */
-		if (type == XFS_ALLOCTYPE_ANY_AG) {
-			/*
-			 * Start with the last place we left off.
-			 */
-			args->agno = sagno = (mp->m_agfrotor / rotorstep) %
-					mp->m_sb.sb_agcount;
-			args->type = XFS_ALLOCTYPE_THIS_AG;
-			flags = XFS_ALLOC_FLAG_TRYLOCK;
-		} else if (type == XFS_ALLOCTYPE_FIRST_AG) {
+		if (type == XFS_ALLOCTYPE_FIRST_AG) {
 			/*
 			 * Start with allocation group given by bno.
 			 */
@@ -2729,8 +2681,6 @@ xfs_alloc_vextent(
 			sagno = 0;
 			flags = 0;
 		} else {
-			if (type == XFS_ALLOCTYPE_START_AG)
-				args->type = XFS_ALLOCTYPE_THIS_AG;
 			/*
 			 * Start with the given allocation group.
 			 */
@@ -2743,9 +2693,7 @@ xfs_alloc_vextent(
 		 */
 		for (;;) {
 			args->pag = xfs_perag_get(mp, args->agno);
-			if (no_min) args->minleft = 0;
 			error = xfs_alloc_fix_freelist(args, flags);
-			args->minleft = minleft;
 			if (error) {
 				trace_xfs_alloc_vextent_nofix(args);
 				goto error0;
@@ -2785,25 +2733,22 @@ xfs_alloc_vextent(
 			 * or switch to non-trylock mode.
 			 */
 			if (args->agno == sagno) {
-				if (no_min == 1) {
+				if (flags == 0) {
 					args->agbno = NULLAGBLOCK;
 					trace_xfs_alloc_vextent_allfailed(args);
 					break;
 				}
-				if (flags == 0) {
-					no_min = 1;
-				} else {
-					flags = 0;
-					if (type == XFS_ALLOCTYPE_START_BNO) {
-						args->agbno = XFS_FSB_TO_AGBNO(mp,
-							args->fsbno);
-						args->type = XFS_ALLOCTYPE_NEAR_BNO;
-					}
+
+				flags = 0;
+				if (type == XFS_ALLOCTYPE_START_BNO) {
+					args->agbno = XFS_FSB_TO_AGBNO(mp,
+						args->fsbno);
+					args->type = XFS_ALLOCTYPE_NEAR_BNO;
 				}
 			}
 			xfs_perag_put(args->pag);
 		}
-		if (bump_rotor || (type == XFS_ALLOCTYPE_ANY_AG)) {
+		if (bump_rotor) {
 			if (args->agno == sagno)
 				mp->m_agfrotor = (mp->m_agfrotor + 1) %
 					(mp->m_sb.sb_agcount * rotorstep);
@@ -2901,8 +2846,7 @@ xfs_free_extent(
 	ASSERT(type != XFS_AG_RESV_AGFL);
 
 	if (XFS_TEST_ERROR(false, mp,
-			XFS_ERRTAG_FREE_EXTENT,
-			XFS_RANDOM_FREE_EXTENT))
+			XFS_ERRTAG_FREE_EXTENT))
 		return -EIO;
 
 	error = xfs_free_extent_fix_freelist(tp, agno, &agbp);
@@ -2927,3 +2871,60 @@ err:
 	xfs_trans_brelse(tp, agbp);
 	return error;
 }
+
+struct xfs_alloc_query_range_info {
+	xfs_alloc_query_range_fn	fn;
+	void				*priv;
+};
+
+/* Format btree record and pass to our callback. */
+STATIC int
+xfs_alloc_query_range_helper(
+	struct xfs_btree_cur		*cur,
+	union xfs_btree_rec		*rec,
+	void				*priv)
+{
+	struct xfs_alloc_query_range_info	*query = priv;
+	struct xfs_alloc_rec_incore		irec;
+
+	irec.ar_startblock = be32_to_cpu(rec->alloc.ar_startblock);
+	irec.ar_blockcount = be32_to_cpu(rec->alloc.ar_blockcount);
+	return query->fn(cur, &irec, query->priv);
+}
+
+/* Find all free space within a given range of blocks. */
+int
+xfs_alloc_query_range(
+	struct xfs_btree_cur			*cur,
+	struct xfs_alloc_rec_incore		*low_rec,
+	struct xfs_alloc_rec_incore		*high_rec,
+	xfs_alloc_query_range_fn		fn,
+	void					*priv)
+{
+	union xfs_btree_irec			low_brec;
+	union xfs_btree_irec			high_brec;
+	struct xfs_alloc_query_range_info	query;
+
+	ASSERT(cur->bc_btnum == XFS_BTNUM_BNO);
+	low_brec.a = *low_rec;
+	high_brec.a = *high_rec;
+	query.priv = priv;
+	query.fn = fn;
+	return xfs_btree_query_range(cur, &low_brec, &high_brec,
+			xfs_alloc_query_range_helper, &query);
+}
+
+/* Find all free space records. */
+int
+xfs_alloc_query_all(
+	struct xfs_btree_cur			*cur,
+	xfs_alloc_query_range_fn		fn,
+	void					*priv)
+{
+	struct xfs_alloc_query_range_info	query;
+
+	ASSERT(cur->bc_btnum == XFS_BTNUM_BNO);
+	query.priv = priv;
+	query.fn = fn;
+	return xfs_btree_query_all(cur, xfs_alloc_query_range_helper, &query);
+}
diff -urpN xfsprogs-4.9.0/libxfs/xfs_alloc.h xfsprogs-4.14.0/libxfs/xfs_alloc.h
--- xfsprogs-4.9.0/libxfs/xfs_alloc.h	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/libxfs/xfs_alloc.h	2017-11-27 17:57:52.000000000 +0100
@@ -29,9 +29,7 @@ extern struct workqueue_struct *xfs_allo
 /*
  * Freespace allocation types.  Argument to xfs_alloc_[v]extent.
  */
-#define XFS_ALLOCTYPE_ANY_AG	0x01	/* allocate anywhere, use rotor */
 #define XFS_ALLOCTYPE_FIRST_AG	0x02	/* ... start at ag 0 */
-#define XFS_ALLOCTYPE_START_AG	0x04	/* anywhere, start in this a.g. */
 #define XFS_ALLOCTYPE_THIS_AG	0x08	/* anywhere in this a.g. */
 #define XFS_ALLOCTYPE_START_BNO	0x10	/* near this block else anywhere */
 #define XFS_ALLOCTYPE_NEAR_BNO	0x20	/* in this a.g. and near this block */
@@ -41,9 +39,7 @@ extern struct workqueue_struct *xfs_allo
 typedef unsigned int xfs_alloctype_t;
 
 #define XFS_ALLOC_TYPES \
-	{ XFS_ALLOCTYPE_ANY_AG,		"ANY_AG" }, \
 	{ XFS_ALLOCTYPE_FIRST_AG,	"FIRST_AG" }, \
-	{ XFS_ALLOCTYPE_START_AG,	"START_AG" }, \
 	{ XFS_ALLOCTYPE_THIS_AG,	"THIS_AG" }, \
 	{ XFS_ALLOCTYPE_START_BNO,	"START_BNO" }, \
 	{ XFS_ALLOCTYPE_NEAR_BNO,	"NEAR_BNO" }, \
@@ -56,7 +52,7 @@ typedef unsigned int xfs_alloctype_t;
 #define	XFS_ALLOC_FLAG_FREEING	0x00000002  /* indicate caller is freeing extents*/
 #define	XFS_ALLOC_FLAG_NORMAP	0x00000004  /* don't modify the rmapbt */
 #define	XFS_ALLOC_FLAG_NOSHRINK	0x00000008  /* don't shrink the freelist */
-
+#define	XFS_ALLOC_FLAG_CHECK	0x00000010  /* test only, don't modify args */
 
 /*
  * Argument structure for xfs_alloc routines.
@@ -217,10 +213,24 @@ xfs_alloc_get_rec(
 
 int xfs_read_agf(struct xfs_mount *mp, struct xfs_trans *tp,
 			xfs_agnumber_t agno, int flags, struct xfs_buf **bpp);
+int xfs_alloc_read_agfl(struct xfs_mount *mp, struct xfs_trans *tp,
+			xfs_agnumber_t agno, struct xfs_buf **bpp);
 int xfs_alloc_fix_freelist(struct xfs_alloc_arg *args, int flags);
 int xfs_free_extent_fix_freelist(struct xfs_trans *tp, xfs_agnumber_t agno,
 		struct xfs_buf **agbp);
 
 xfs_extlen_t xfs_prealloc_blocks(struct xfs_mount *mp);
 
+typedef int (*xfs_alloc_query_range_fn)(
+	struct xfs_btree_cur		*cur,
+	struct xfs_alloc_rec_incore	*rec,
+	void				*priv);
+
+int xfs_alloc_query_range(struct xfs_btree_cur *cur,
+		struct xfs_alloc_rec_incore *low_rec,
+		struct xfs_alloc_rec_incore *high_rec,
+		xfs_alloc_query_range_fn fn, void *priv);
+int xfs_alloc_query_all(struct xfs_btree_cur *cur, xfs_alloc_query_range_fn fn,
+		void *priv);
+
 #endif	/* __XFS_ALLOC_H__ */
diff -urpN xfsprogs-4.9.0/libxfs/xfs_alloc_btree.c xfsprogs-4.14.0/libxfs/xfs_alloc_btree.c
--- xfsprogs-4.9.0/libxfs/xfs_alloc_btree.c	2017-01-05 18:41:55.000000000 +0100
+++ xfsprogs-4.14.0/libxfs/xfs_alloc_btree.c	2017-11-20 01:14:14.000000000 +0100
@@ -203,19 +203,37 @@ xfs_allocbt_init_key_from_rec(
 	union xfs_btree_key	*key,
 	union xfs_btree_rec	*rec)
 {
-	ASSERT(rec->alloc.ar_startblock != 0);
-
 	key->alloc.ar_startblock = rec->alloc.ar_startblock;
 	key->alloc.ar_blockcount = rec->alloc.ar_blockcount;
 }
 
 STATIC void
+xfs_bnobt_init_high_key_from_rec(
+	union xfs_btree_key	*key,
+	union xfs_btree_rec	*rec)
+{
+	__u32			x;
+
+	x = be32_to_cpu(rec->alloc.ar_startblock);
+	x += be32_to_cpu(rec->alloc.ar_blockcount) - 1;
+	key->alloc.ar_startblock = cpu_to_be32(x);
+	key->alloc.ar_blockcount = 0;
+}
+
+STATIC void
+xfs_cntbt_init_high_key_from_rec(
+	union xfs_btree_key	*key,
+	union xfs_btree_rec	*rec)
+{
+	key->alloc.ar_blockcount = rec->alloc.ar_blockcount;
+	key->alloc.ar_startblock = 0;
+}
+
+STATIC void
 xfs_allocbt_init_rec_from_cur(
 	struct xfs_btree_cur	*cur,
 	union xfs_btree_rec	*rec)
 {
-	ASSERT(cur->bc_rec.a.ar_startblock != 0);
-
 	rec->alloc.ar_startblock = cpu_to_be32(cur->bc_rec.a.ar_startblock);
 	rec->alloc.ar_blockcount = cpu_to_be32(cur->bc_rec.a.ar_blockcount);
 }
@@ -233,25 +251,58 @@ xfs_allocbt_init_ptr_from_cur(
 	ptr->s = agf->agf_roots[cur->bc_btnum];
 }
 
-STATIC __int64_t
-xfs_allocbt_key_diff(
+STATIC int64_t
+xfs_bnobt_key_diff(
 	struct xfs_btree_cur	*cur,
 	union xfs_btree_key	*key)
 {
 	xfs_alloc_rec_incore_t	*rec = &cur->bc_rec.a;
 	xfs_alloc_key_t		*kp = &key->alloc;
-	__int64_t		diff;
 
-	if (cur->bc_btnum == XFS_BTNUM_BNO) {
-		return (__int64_t)be32_to_cpu(kp->ar_startblock) -
-				rec->ar_startblock;
-	}
+	return (int64_t)be32_to_cpu(kp->ar_startblock) - rec->ar_startblock;
+}
+
+STATIC int64_t
+xfs_cntbt_key_diff(
+	struct xfs_btree_cur	*cur,
+	union xfs_btree_key	*key)
+{
+	xfs_alloc_rec_incore_t	*rec = &cur->bc_rec.a;
+	xfs_alloc_key_t		*kp = &key->alloc;
+	int64_t			diff;
+
+	diff = (int64_t)be32_to_cpu(kp->ar_blockcount) - rec->ar_blockcount;
+	if (diff)
+		return diff;
+
+	return (int64_t)be32_to_cpu(kp->ar_startblock) - rec->ar_startblock;
+}
+
+STATIC int64_t
+xfs_bnobt_diff_two_keys(
+	struct xfs_btree_cur	*cur,
+	union xfs_btree_key	*k1,
+	union xfs_btree_key	*k2)
+{
+	return (int64_t)be32_to_cpu(k1->alloc.ar_startblock) -
+			  be32_to_cpu(k2->alloc.ar_startblock);
+}
+
+STATIC int64_t
+xfs_cntbt_diff_two_keys(
+	struct xfs_btree_cur	*cur,
+	union xfs_btree_key	*k1,
+	union xfs_btree_key	*k2)
+{
+	int64_t			diff;
 
-	diff = (__int64_t)be32_to_cpu(kp->ar_blockcount) - rec->ar_blockcount;
+	diff =  be32_to_cpu(k1->alloc.ar_blockcount) -
+		be32_to_cpu(k2->alloc.ar_blockcount);
 	if (diff)
 		return diff;
 
-	return (__int64_t)be32_to_cpu(kp->ar_startblock) - rec->ar_startblock;
+	return  be32_to_cpu(k1->alloc.ar_startblock) -
+		be32_to_cpu(k2->alloc.ar_startblock);
 }
 
 static bool
@@ -278,8 +329,6 @@ xfs_allocbt_verify(
 	level = be16_to_cpu(block->bb_level);
 	switch (block->bb_magic) {
 	case cpu_to_be32(XFS_ABTB_CRC_MAGIC):
-		if (!xfs_sb_version_hascrc(&mp->m_sb))
-			return false;
 		if (!xfs_btree_sblock_v5hdr_verify(bp))
 			return false;
 		/* fall through */
@@ -291,8 +340,6 @@ xfs_allocbt_verify(
 			return false;
 		break;
 	case cpu_to_be32(XFS_ABTC_CRC_MAGIC):
-		if (!xfs_sb_version_hascrc(&mp->m_sb))
-			return false;
 		if (!xfs_btree_sblock_v5hdr_verify(bp))
 			return false;
 		/* fall through */
@@ -346,46 +393,76 @@ const struct xfs_buf_ops xfs_allocbt_buf
 };
 
 
-#if defined(DEBUG) || defined(XFS_WARN)
 STATIC int
-xfs_allocbt_keys_inorder(
+xfs_bnobt_keys_inorder(
 	struct xfs_btree_cur	*cur,
 	union xfs_btree_key	*k1,
 	union xfs_btree_key	*k2)
 {
-	if (cur->bc_btnum == XFS_BTNUM_BNO) {
-		return be32_to_cpu(k1->alloc.ar_startblock) <
-		       be32_to_cpu(k2->alloc.ar_startblock);
-	} else {
-		return be32_to_cpu(k1->alloc.ar_blockcount) <
-			be32_to_cpu(k2->alloc.ar_blockcount) ||
-			(k1->alloc.ar_blockcount == k2->alloc.ar_blockcount &&
-			 be32_to_cpu(k1->alloc.ar_startblock) <
-			 be32_to_cpu(k2->alloc.ar_startblock));
-	}
+	return be32_to_cpu(k1->alloc.ar_startblock) <
+	       be32_to_cpu(k2->alloc.ar_startblock);
 }
 
 STATIC int
-xfs_allocbt_recs_inorder(
+xfs_bnobt_recs_inorder(
 	struct xfs_btree_cur	*cur,
 	union xfs_btree_rec	*r1,
 	union xfs_btree_rec	*r2)
 {
-	if (cur->bc_btnum == XFS_BTNUM_BNO) {
-		return be32_to_cpu(r1->alloc.ar_startblock) +
-			be32_to_cpu(r1->alloc.ar_blockcount) <=
-			be32_to_cpu(r2->alloc.ar_startblock);
-	} else {
-		return be32_to_cpu(r1->alloc.ar_blockcount) <
-			be32_to_cpu(r2->alloc.ar_blockcount) ||
-			(r1->alloc.ar_blockcount == r2->alloc.ar_blockcount &&
-			 be32_to_cpu(r1->alloc.ar_startblock) <
-			 be32_to_cpu(r2->alloc.ar_startblock));
-	}
+	return be32_to_cpu(r1->alloc.ar_startblock) +
+		be32_to_cpu(r1->alloc.ar_blockcount) <=
+		be32_to_cpu(r2->alloc.ar_startblock);
+}
+
+STATIC int
+xfs_cntbt_keys_inorder(
+	struct xfs_btree_cur	*cur,
+	union xfs_btree_key	*k1,
+	union xfs_btree_key	*k2)
+{
+	return be32_to_cpu(k1->alloc.ar_blockcount) <
+		be32_to_cpu(k2->alloc.ar_blockcount) ||
+		(k1->alloc.ar_blockcount == k2->alloc.ar_blockcount &&
+		 be32_to_cpu(k1->alloc.ar_startblock) <
+		 be32_to_cpu(k2->alloc.ar_startblock));
+}
+
+STATIC int
+xfs_cntbt_recs_inorder(
+	struct xfs_btree_cur	*cur,
+	union xfs_btree_rec	*r1,
+	union xfs_btree_rec	*r2)
+{
+	return be32_to_cpu(r1->alloc.ar_blockcount) <
+		be32_to_cpu(r2->alloc.ar_blockcount) ||
+		(r1->alloc.ar_blockcount == r2->alloc.ar_blockcount &&
+		 be32_to_cpu(r1->alloc.ar_startblock) <
+		 be32_to_cpu(r2->alloc.ar_startblock));
 }
-#endif	/* DEBUG */
 
-static const struct xfs_btree_ops xfs_allocbt_ops = {
+static const struct xfs_btree_ops xfs_bnobt_ops = {
+	.rec_len		= sizeof(xfs_alloc_rec_t),
+	.key_len		= sizeof(xfs_alloc_key_t),
+
+	.dup_cursor		= xfs_allocbt_dup_cursor,
+	.set_root		= xfs_allocbt_set_root,
+	.alloc_block		= xfs_allocbt_alloc_block,
+	.free_block		= xfs_allocbt_free_block,
+	.update_lastrec		= xfs_allocbt_update_lastrec,
+	.get_minrecs		= xfs_allocbt_get_minrecs,
+	.get_maxrecs		= xfs_allocbt_get_maxrecs,
+	.init_key_from_rec	= xfs_allocbt_init_key_from_rec,
+	.init_high_key_from_rec	= xfs_bnobt_init_high_key_from_rec,
+	.init_rec_from_cur	= xfs_allocbt_init_rec_from_cur,
+	.init_ptr_from_cur	= xfs_allocbt_init_ptr_from_cur,
+	.key_diff		= xfs_bnobt_key_diff,
+	.buf_ops		= &xfs_allocbt_buf_ops,
+	.diff_two_keys		= xfs_bnobt_diff_two_keys,
+	.keys_inorder		= xfs_bnobt_keys_inorder,
+	.recs_inorder		= xfs_bnobt_recs_inorder,
+};
+
+static const struct xfs_btree_ops xfs_cntbt_ops = {
 	.rec_len		= sizeof(xfs_alloc_rec_t),
 	.key_len		= sizeof(xfs_alloc_key_t),
 
@@ -397,14 +474,14 @@ static const struct xfs_btree_ops xfs_al
 	.get_minrecs		= xfs_allocbt_get_minrecs,
 	.get_maxrecs		= xfs_allocbt_get_maxrecs,
 	.init_key_from_rec	= xfs_allocbt_init_key_from_rec,
+	.init_high_key_from_rec	= xfs_cntbt_init_high_key_from_rec,
 	.init_rec_from_cur	= xfs_allocbt_init_rec_from_cur,
 	.init_ptr_from_cur	= xfs_allocbt_init_ptr_from_cur,
-	.key_diff		= xfs_allocbt_key_diff,
+	.key_diff		= xfs_cntbt_key_diff,
 	.buf_ops		= &xfs_allocbt_buf_ops,
-#if defined(DEBUG) || defined(XFS_WARN)
-	.keys_inorder		= xfs_allocbt_keys_inorder,
-	.recs_inorder		= xfs_allocbt_recs_inorder,
-#endif
+	.diff_two_keys		= xfs_cntbt_diff_two_keys,
+	.keys_inorder		= xfs_cntbt_keys_inorder,
+	.recs_inorder		= xfs_cntbt_recs_inorder,
 };
 
 /*
@@ -423,18 +500,21 @@ xfs_allocbt_init_cursor(
 
 	ASSERT(btnum == XFS_BTNUM_BNO || btnum == XFS_BTNUM_CNT);
 
-	cur = kmem_zone_zalloc(xfs_btree_cur_zone, KM_SLEEP);
+	cur = kmem_zone_zalloc(xfs_btree_cur_zone, KM_NOFS);
 
 	cur->bc_tp = tp;
 	cur->bc_mp = mp;
 	cur->bc_btnum = btnum;
 	cur->bc_blocklog = mp->m_sb.sb_blocklog;
-	cur->bc_ops = &xfs_allocbt_ops;
 
 	if (btnum == XFS_BTNUM_CNT) {
+		cur->bc_statoff = XFS_STATS_CALC_INDEX(xs_abtc_2);
+		cur->bc_ops = &xfs_cntbt_ops;
 		cur->bc_nlevels = be32_to_cpu(agf->agf_levels[XFS_BTNUM_CNT]);
 		cur->bc_flags = XFS_BTREE_LASTREC_UPDATE;
 	} else {
+		cur->bc_statoff = XFS_STATS_CALC_INDEX(xs_abtb_2);
+		cur->bc_ops = &xfs_bnobt_ops;
 		cur->bc_nlevels = be32_to_cpu(agf->agf_levels[XFS_BTNUM_BNO]);
 	}
 
diff -urpN xfsprogs-4.9.0/libxfs/xfs_attr.c xfsprogs-4.14.0/libxfs/xfs_attr.c
--- xfsprogs-4.9.0/libxfs/xfs_attr.c	2017-01-05 18:41:55.000000000 +0100
+++ xfsprogs-4.14.0/libxfs/xfs_attr.c	2017-11-27 17:57:55.000000000 +0100
@@ -109,6 +109,25 @@ xfs_inode_hasattr(
  * Overall external interface routines.
  *========================================================================*/
 
+/* Retrieve an extended attribute and its value.  Must have ilock. */
+int
+xfs_attr_get_ilocked(
+	struct xfs_inode	*ip,
+	struct xfs_da_args	*args)
+{
+	ASSERT(xfs_isilocked(ip, XFS_ILOCK_SHARED | XFS_ILOCK_EXCL));
+
+	if (!xfs_inode_hasattr(ip))
+		return -ENOATTR;
+	else if (ip->i_d.di_aformat == XFS_DINODE_FMT_LOCAL)
+		return xfs_attr_shortform_getvalue(args);
+	else if (xfs_bmap_one_block(ip, XFS_ATTR_FORK))
+		return xfs_attr_leaf_get(args);
+	else
+		return xfs_attr_node_get(args);
+}
+
+/* Retrieve an extended attribute by name, and its value. */
 int
 xfs_attr_get(
 	struct xfs_inode	*ip,
@@ -126,25 +145,17 @@ xfs_attr_get(
 	if (XFS_FORCED_SHUTDOWN(ip->i_mount))
 		return -EIO;
 
-	if (!xfs_inode_hasattr(ip))
-		return -ENOATTR;
-
 	error = xfs_attr_args_init(&args, ip, name, flags);
 	if (error)
 		return error;
 
 	args.value = value;
 	args.valuelen = *valuelenp;
+	/* Entirely possible to look up a name which doesn't exist */
+	args.op_flags = XFS_DA_OP_OKNOENT;
 
 	lock_mode = xfs_ilock_attr_map_shared(ip);
-	if (!xfs_inode_hasattr(ip))
-		error = -ENOATTR;
-	else if (ip->i_d.di_aformat == XFS_DINODE_FMT_LOCAL)
-		error = xfs_attr_shortform_getvalue(&args);
-	else if (xfs_bmap_one_block(ip, XFS_ATTR_FORK))
-		error = xfs_attr_leaf_get(&args);
-	else
-		error = xfs_attr_node_get(&args);
+	error = xfs_attr_get_ilocked(ip, &args);
 	xfs_iunlock(ip, lock_mode);
 
 	*valuelenp = args.valuelen;
@@ -312,20 +323,19 @@ xfs_attr_set(
 		 */
 		xfs_defer_init(args.dfops, args.firstblock);
 		error = xfs_attr_shortform_to_leaf(&args);
-		if (!error)
-			error = xfs_defer_finish(&args.trans, args.dfops, dp);
-		if (error) {
-			args.trans = NULL;
-			xfs_defer_cancel(&dfops);
-			goto out;
-		}
+		if (error)
+			goto out_defer_cancel;
+		xfs_defer_ijoin(args.dfops, dp);
+		error = xfs_defer_finish(&args.trans, args.dfops);
+		if (error)
+			goto out_defer_cancel;
 
 		/*
 		 * Commit the leaf transformation.  We'll need another (linked)
 		 * transaction to add the new attribute to the leaf.
 		 */
 
-		error = xfs_trans_roll(&args.trans, dp);
+		error = xfs_trans_roll_inode(&args.trans, dp);
 		if (error)
 			goto out;
 
@@ -357,6 +367,9 @@ xfs_attr_set(
 
 	return error;
 
+out_defer_cancel:
+	xfs_defer_cancel(&dfops);
+	args.trans = NULL;
 out:
 	if (args.trans)
 		xfs_trans_cancel(args.trans);
@@ -385,9 +398,6 @@ xfs_attr_remove(
 	if (XFS_FORCED_SHUTDOWN(dp->i_mount))
 		return -EIO;
 
-	if (!xfs_inode_hasattr(dp))
-		return -ENOATTR;
-
 	error = xfs_attr_args_init(&args, dp, name, flags);
 	if (error)
 		return error;
@@ -580,19 +590,18 @@ xfs_attr_leaf_addname(xfs_da_args_t *arg
 		 */
 		xfs_defer_init(args->dfops, args->firstblock);
 		error = xfs_attr3_leaf_to_node(args);
-		if (!error)
-			error = xfs_defer_finish(&args->trans, args->dfops, dp);
-		if (error) {
-			args->trans = NULL;
-			xfs_defer_cancel(args->dfops);
-			return error;
-		}
+		if (error)
+			goto out_defer_cancel;
+		xfs_defer_ijoin(args->dfops, dp);
+		error = xfs_defer_finish(&args->trans, args->dfops);
+		if (error)
+			goto out_defer_cancel;
 
 		/*
 		 * Commit the current trans (including the inode) and start
 		 * a new one.
 		 */
-		error = xfs_trans_roll(&args->trans, dp);
+		error = xfs_trans_roll_inode(&args->trans, dp);
 		if (error)
 			return error;
 
@@ -607,7 +616,7 @@ xfs_attr_leaf_addname(xfs_da_args_t *arg
 	 * Commit the transaction that added the attr name so that
 	 * later routines can manage their own transactions.
 	 */
-	error = xfs_trans_roll(&args->trans, dp);
+	error = xfs_trans_roll_inode(&args->trans, dp);
 	if (error)
 		return error;
 
@@ -671,20 +680,18 @@ xfs_attr_leaf_addname(xfs_da_args_t *arg
 			xfs_defer_init(args->dfops, args->firstblock);
 			error = xfs_attr3_leaf_to_shortform(bp, args, forkoff);
 			/* bp is gone due to xfs_da_shrink_inode */
-			if (!error)
-				error = xfs_defer_finish(&args->trans,
-							args->dfops, dp);
-			if (error) {
-				args->trans = NULL;
-				xfs_defer_cancel(args->dfops);
-				return error;
-			}
+			if (error)
+				goto out_defer_cancel;
+			xfs_defer_ijoin(args->dfops, dp);
+			error = xfs_defer_finish(&args->trans, args->dfops);
+			if (error)
+				goto out_defer_cancel;
 		}
 
 		/*
 		 * Commit the remove and start the next trans in series.
 		 */
-		error = xfs_trans_roll(&args->trans, dp);
+		error = xfs_trans_roll_inode(&args->trans, dp);
 
 	} else if (args->rmtblkno > 0) {
 		/*
@@ -693,6 +700,10 @@ xfs_attr_leaf_addname(xfs_da_args_t *arg
 		error = xfs_attr3_leaf_clearflag(args);
 	}
 	return error;
+out_defer_cancel:
+	xfs_defer_cancel(args->dfops);
+	args->trans = NULL;
+	return error;
 }
 
 /*
@@ -734,15 +745,18 @@ xfs_attr_leaf_removename(xfs_da_args_t *
 		xfs_defer_init(args->dfops, args->firstblock);
 		error = xfs_attr3_leaf_to_shortform(bp, args, forkoff);
 		/* bp is gone due to xfs_da_shrink_inode */
-		if (!error)
-			error = xfs_defer_finish(&args->trans, args->dfops, dp);
-		if (error) {
-			args->trans = NULL;
-			xfs_defer_cancel(args->dfops);
-			return error;
-		}
+		if (error)
+			goto out_defer_cancel;
+		xfs_defer_ijoin(args->dfops, dp);
+		error = xfs_defer_finish(&args->trans, args->dfops);
+		if (error)
+			goto out_defer_cancel;
 	}
 	return 0;
+out_defer_cancel:
+	xfs_defer_cancel(args->dfops);
+	args->trans = NULL;
+	return error;
 }
 
 /*
@@ -859,20 +873,18 @@ restart:
 			state = NULL;
 			xfs_defer_init(args->dfops, args->firstblock);
 			error = xfs_attr3_leaf_to_node(args);
-			if (!error)
-				error = xfs_defer_finish(&args->trans,
-							args->dfops, dp);
-			if (error) {
-				args->trans = NULL;
-				xfs_defer_cancel(args->dfops);
-				goto out;
-			}
+			if (error)
+				goto out_defer_cancel;
+			xfs_defer_ijoin(args->dfops, dp);
+			error = xfs_defer_finish(&args->trans, args->dfops);
+			if (error)
+				goto out_defer_cancel;
 
 			/*
 			 * Commit the node conversion and start the next
 			 * trans in the chain.
 			 */
-			error = xfs_trans_roll(&args->trans, dp);
+			error = xfs_trans_roll_inode(&args->trans, dp);
 			if (error)
 				goto out;
 
@@ -887,13 +899,12 @@ restart:
 		 */
 		xfs_defer_init(args->dfops, args->firstblock);
 		error = xfs_da3_split(state);
-		if (!error)
-			error = xfs_defer_finish(&args->trans, args->dfops, dp);
-		if (error) {
-			args->trans = NULL;
-			xfs_defer_cancel(args->dfops);
-			goto out;
-		}
+		if (error)
+			goto out_defer_cancel;
+		xfs_defer_ijoin(args->dfops, dp);
+		error = xfs_defer_finish(&args->trans, args->dfops);
+		if (error)
+			goto out_defer_cancel;
 	} else {
 		/*
 		 * Addition succeeded, update Btree hashvals.
@@ -912,7 +923,7 @@ restart:
 	 * Commit the leaf addition or btree split and start the next
 	 * trans in the chain.
 	 */
-	error = xfs_trans_roll(&args->trans, dp);
+	error = xfs_trans_roll_inode(&args->trans, dp);
 	if (error)
 		goto out;
 
@@ -986,20 +997,18 @@ restart:
 		if (retval && (state->path.active > 1)) {
 			xfs_defer_init(args->dfops, args->firstblock);
 			error = xfs_da3_join(state);
-			if (!error)
-				error = xfs_defer_finish(&args->trans,
-							args->dfops, dp);
-			if (error) {
-				args->trans = NULL;
-				xfs_defer_cancel(args->dfops);
-				goto out;
-			}
+			if (error)
+				goto out_defer_cancel;
+			xfs_defer_ijoin(args->dfops, dp);
+			error = xfs_defer_finish(&args->trans, args->dfops);
+			if (error)
+				goto out_defer_cancel;
 		}
 
 		/*
 		 * Commit and start the next trans in the chain.
 		 */
-		error = xfs_trans_roll(&args->trans, dp);
+		error = xfs_trans_roll_inode(&args->trans, dp);
 		if (error)
 			goto out;
 
@@ -1019,6 +1028,10 @@ out:
 	if (error)
 		return error;
 	return retval;
+out_defer_cancel:
+	xfs_defer_cancel(args->dfops);
+	args->trans = NULL;
+	goto out;
 }
 
 /*
@@ -1109,17 +1122,16 @@ xfs_attr_node_removename(xfs_da_args_t *
 	if (retval && (state->path.active > 1)) {
 		xfs_defer_init(args->dfops, args->firstblock);
 		error = xfs_da3_join(state);
-		if (!error)
-			error = xfs_defer_finish(&args->trans, args->dfops, dp);
-		if (error) {
-			args->trans = NULL;
-			xfs_defer_cancel(args->dfops);
-			goto out;
-		}
+		if (error)
+			goto out_defer_cancel;
+		xfs_defer_ijoin(args->dfops, dp);
+		error = xfs_defer_finish(&args->trans, args->dfops);
+		if (error)
+			goto out_defer_cancel;
 		/*
 		 * Commit the Btree join operation and start a new trans.
 		 */
-		error = xfs_trans_roll(&args->trans, dp);
+		error = xfs_trans_roll_inode(&args->trans, dp);
 		if (error)
 			goto out;
 	}
@@ -1143,14 +1155,12 @@ xfs_attr_node_removename(xfs_da_args_t *
 			xfs_defer_init(args->dfops, args->firstblock);
 			error = xfs_attr3_leaf_to_shortform(bp, args, forkoff);
 			/* bp is gone due to xfs_da_shrink_inode */
-			if (!error)
-				error = xfs_defer_finish(&args->trans,
-							args->dfops, dp);
-			if (error) {
-				args->trans = NULL;
-				xfs_defer_cancel(args->dfops);
-				goto out;
-			}
+			if (error)
+				goto out_defer_cancel;
+			xfs_defer_ijoin(args->dfops, dp);
+			error = xfs_defer_finish(&args->trans, args->dfops);
+			if (error)
+				goto out_defer_cancel;
 		} else
 			xfs_trans_brelse(args->trans, bp);
 	}
@@ -1159,6 +1169,10 @@ xfs_attr_node_removename(xfs_da_args_t *
 out:
 	xfs_da_state_free(state);
 	return error;
+out_defer_cancel:
+	xfs_defer_cancel(args->dfops);
+	args->trans = NULL;
+	goto out;
 }
 
 /*
diff -urpN xfsprogs-4.9.0/libxfs/xfs_attr_leaf.c xfsprogs-4.14.0/libxfs/xfs_attr_leaf.c
--- xfsprogs-4.9.0/libxfs/xfs_attr_leaf.c	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/libxfs/xfs_attr_leaf.c	2017-11-27 17:57:55.000000000 +0100
@@ -248,6 +248,7 @@ xfs_attr3_leaf_verify(
 {
 	struct xfs_mount	*mp = bp->b_target->bt_mount;
 	struct xfs_attr_leafblock *leaf = bp->b_addr;
+	struct xfs_perag *pag = bp->b_pag;
 	struct xfs_attr3_icleaf_hdr ichdr;
 
 	xfs_attr3_leaf_hdr_from_disk(mp->m_attr_geo, &ichdr, leaf);
@@ -268,7 +269,12 @@ xfs_attr3_leaf_verify(
 		if (ichdr.magic != XFS_ATTR_LEAF_MAGIC)
 			return false;
 	}
-	if (ichdr.count == 0)
+	/*
+	 * In recovery there is a transient state where count == 0 is valid
+	 * because we may have transitioned an empty shortform attr to a leaf
+	 * if the attr didn't fit in shortform.
+	 */
+	if (pag && pag->pagf_init && ichdr.count == 0)
 		return false;
 
 	/* XXX: need to range check rest of attr header values */
@@ -340,7 +346,7 @@ xfs_attr3_leaf_read(
 
 	err = xfs_da_read_buf(tp, dp, bno, mappedbno, bpp,
 				XFS_ATTR_FORK, &xfs_attr3_leaf_buf_ops);
-	if (!err && tp)
+	if (!err && tp && *bpp)
 		xfs_trans_buf_set_type(tp, *bpp, XFS_BLFT_ATTR_LEAF_BUF);
 	return err;
 }
@@ -2597,7 +2603,7 @@ xfs_attr3_leaf_clearflag(
 	/*
 	 * Commit the flag value change and start the next trans in series.
 	 */
-	return xfs_trans_roll(&args->trans, args->dp);
+	return xfs_trans_roll_inode(&args->trans, args->dp);
 }
 
 /*
@@ -2648,7 +2654,7 @@ xfs_attr3_leaf_setflag(
 	/*
 	 * Commit the flag value change and start the next trans in series.
 	 */
-	return xfs_trans_roll(&args->trans, args->dp);
+	return xfs_trans_roll_inode(&args->trans, args->dp);
 }
 
 /*
@@ -2766,7 +2772,7 @@ xfs_attr3_leaf_flipflags(
 	/*
 	 * Commit the flag value change and start the next trans in series.
 	 */
-	error = xfs_trans_roll(&args->trans, args->dp);
+	error = xfs_trans_roll_inode(&args->trans, args->dp);
 
 	return error;
 }
diff -urpN xfsprogs-4.9.0/libxfs/xfs_attr_leaf.h xfsprogs-4.14.0/libxfs/xfs_attr_leaf.h
--- xfsprogs-4.9.0/libxfs/xfs_attr_leaf.h	2017-01-05 18:41:55.000000000 +0100
+++ xfsprogs-4.14.0/libxfs/xfs_attr_leaf.h	2017-11-20 01:14:14.000000000 +0100
@@ -77,7 +77,7 @@ int	xfs_attr3_leaf_add(struct xfs_buf *l
 				 struct xfs_da_args *args);
 int	xfs_attr3_leaf_remove(struct xfs_buf *leaf_buffer,
 				    struct xfs_da_args *args);
-int	xfs_attr3_leaf_list_int(struct xfs_buf *bp,
+void	xfs_attr3_leaf_list_int(struct xfs_buf *bp,
 				      struct xfs_attr_list_context *context);
 
 /*
diff -urpN xfsprogs-4.9.0/libxfs/xfs_attr_remote.c xfsprogs-4.14.0/libxfs/xfs_attr_remote.c
--- xfsprogs-4.9.0/libxfs/xfs_attr_remote.c	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/libxfs/xfs_attr_remote.c	2017-11-27 17:57:55.000000000 +0100
@@ -248,7 +248,7 @@ xfs_attr_rmtval_copyout(
 	xfs_ino_t	ino,
 	int		*offset,
 	int		*valuelen,
-	__uint8_t	**dst)
+	uint8_t		**dst)
 {
 	char		*src = bp->b_addr;
 	xfs_daddr_t	bno = bp->b_bn;
@@ -296,7 +296,7 @@ xfs_attr_rmtval_copyin(
 	xfs_ino_t	ino,
 	int		*offset,
 	int		*valuelen,
-	__uint8_t	**src)
+	uint8_t		**src)
 {
 	char		*dst = bp->b_addr;
 	xfs_daddr_t	bno = bp->b_bn;
@@ -350,7 +350,7 @@ xfs_attr_rmtval_get(
 	struct xfs_mount	*mp = args->dp->i_mount;
 	struct xfs_buf		*bp;
 	xfs_dablk_t		lblkno = args->rmtblkno;
-	__uint8_t		*dst = args->value;
+	uint8_t			*dst = args->value;
 	int			valuelen;
 	int			nmap;
 	int			error;
@@ -381,7 +381,8 @@ xfs_attr_rmtval_get(
 			       (map[i].br_startblock != HOLESTARTBLOCK));
 			dblkno = XFS_FSB_TO_DADDR(mp, map[i].br_startblock);
 			dblkcnt = XFS_FSB_TO_BB(mp, map[i].br_blockcount);
-			error = xfs_trans_read_buf(mp, NULL, mp->m_ddev_targp,
+			error = xfs_trans_read_buf(mp, args->trans,
+						   mp->m_ddev_targp,
 						   dblkno, dblkcnt, 0, &bp,
 						   &xfs_attr3_rmt_buf_ops);
 			if (error)
@@ -390,7 +391,7 @@ xfs_attr_rmtval_get(
 			error = xfs_attr_rmtval_copyout(mp, bp, args->dp->i_ino,
 							&offset, &valuelen,
 							&dst);
-			xfs_buf_relse(bp);
+			xfs_trans_brelse(args->trans, bp);
 			if (error)
 				return error;
 
@@ -416,7 +417,7 @@ xfs_attr_rmtval_set(
 	struct xfs_bmbt_irec	map;
 	xfs_dablk_t		lblkno;
 	xfs_fileoff_t		lfileoff = 0;
-	__uint8_t		*src = args->value;
+	uint8_t			*src = args->value;
 	int			blkcnt;
 	int			valuelen;
 	int			nmap;
@@ -461,13 +462,12 @@ xfs_attr_rmtval_set(
 		error = xfs_bmapi_write(args->trans, dp, (xfs_fileoff_t)lblkno,
 				  blkcnt, XFS_BMAPI_ATTRFORK, args->firstblock,
 				  args->total, &map, &nmap, args->dfops);
-		if (!error)
-			error = xfs_defer_finish(&args->trans, args->dfops, dp);
-		if (error) {
-			args->trans = NULL;
-			xfs_defer_cancel(args->dfops);
-			return error;
-		}
+		if (error)
+			goto out_defer_cancel;
+		xfs_defer_ijoin(args->dfops, dp);
+		error = xfs_defer_finish(&args->trans, args->dfops);
+		if (error)
+			goto out_defer_cancel;
 
 		ASSERT(nmap == 1);
 		ASSERT((map.br_startblock != DELAYSTARTBLOCK) &&
@@ -478,7 +478,7 @@ xfs_attr_rmtval_set(
 		/*
 		 * Start the next trans in the chain.
 		 */
-		error = xfs_trans_roll(&args->trans, dp);
+		error = xfs_trans_roll_inode(&args->trans, dp);
 		if (error)
 			return error;
 	}
@@ -533,6 +533,10 @@ xfs_attr_rmtval_set(
 	}
 	ASSERT(valuelen == 0);
 	return 0;
+out_defer_cancel:
+	xfs_defer_cancel(args->dfops);
+	args->trans = NULL;
+	return error;
 }
 
 /*
@@ -603,21 +607,23 @@ xfs_attr_rmtval_remove(
 		error = xfs_bunmapi(args->trans, args->dp, lblkno, blkcnt,
 				    XFS_BMAPI_ATTRFORK, 1, args->firstblock,
 				    args->dfops, &done);
-		if (!error)
-			error = xfs_defer_finish(&args->trans, args->dfops,
-						args->dp);
-		if (error) {
-			args->trans = NULL;
-			xfs_defer_cancel(args->dfops);
-			return error;
-		}
+		if (error)
+			goto out_defer_cancel;
+		xfs_defer_ijoin(args->dfops, args->dp);
+		error = xfs_defer_finish(&args->trans, args->dfops);
+		if (error)
+			goto out_defer_cancel;
 
 		/*
 		 * Close out trans and start the next one in the chain.
 		 */
-		error = xfs_trans_roll(&args->trans, args->dp);
+		error = xfs_trans_roll_inode(&args->trans, args->dp);
 		if (error)
 			return error;
 	}
 	return 0;
+out_defer_cancel:
+	xfs_defer_cancel(args->dfops);
+	args->trans = NULL;
+	return error;
 }
diff -urpN xfsprogs-4.9.0/libxfs/xfs_attr_sf.h xfsprogs-4.14.0/libxfs/xfs_attr_sf.h
--- xfsprogs-4.9.0/libxfs/xfs_attr_sf.h	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/libxfs/xfs_attr_sf.h	2017-11-20 01:14:14.000000000 +0100
@@ -31,10 +31,10 @@ typedef struct xfs_attr_sf_entry xfs_att
  * We generate this then sort it, attr_list() must return things in hash-order.
  */
 typedef struct xfs_attr_sf_sort {
-	__uint8_t	entno;		/* entry number in original list */
-	__uint8_t	namelen;	/* length of name value (no null) */
-	__uint8_t	valuelen;	/* length of value */
-	__uint8_t	flags;		/* flags bits (see xfs_attr_leaf.h) */
+	uint8_t		entno;		/* entry number in original list */
+	uint8_t		namelen;	/* length of name value (no null) */
+	uint8_t		valuelen;	/* length of value */
+	uint8_t		flags;		/* flags bits (see xfs_attr_leaf.h) */
 	xfs_dahash_t	hash;		/* this entry's hash value */
 	unsigned char	*name;		/* name value, pointer into buffer */
 } xfs_attr_sf_sort_t;
@@ -42,7 +42,7 @@ typedef struct xfs_attr_sf_sort {
 #define XFS_ATTR_SF_ENTSIZE_BYNAME(nlen,vlen)	/* space name/value uses */ \
 	(((int)sizeof(xfs_attr_sf_entry_t)-1 + (nlen)+(vlen)))
 #define XFS_ATTR_SF_ENTSIZE_MAX			/* max space for name&value */ \
-	((1 << (NBBY*(int)sizeof(__uint8_t))) - 1)
+	((1 << (NBBY*(int)sizeof(uint8_t))) - 1)
 #define XFS_ATTR_SF_ENTSIZE(sfep)		/* space an entry uses */ \
 	((int)sizeof(xfs_attr_sf_entry_t)-1 + (sfep)->namelen+(sfep)->valuelen)
 #define XFS_ATTR_SF_NEXTENTRY(sfep)		/* next entry in struct */ \
diff -urpN xfsprogs-4.9.0/libxfs/xfs_bit.h xfsprogs-4.14.0/libxfs/xfs_bit.h
--- xfsprogs-4.9.0/libxfs/xfs_bit.h	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/libxfs/xfs_bit.h	2017-11-20 01:14:14.000000000 +0100
@@ -25,47 +25,47 @@
 /*
  * masks with n high/low bits set, 64-bit values
  */
-static inline __uint64_t xfs_mask64hi(int n)
+static inline uint64_t xfs_mask64hi(int n)
 {
-	return (__uint64_t)-1 << (64 - (n));
+	return (uint64_t)-1 << (64 - (n));
 }
-static inline __uint32_t xfs_mask32lo(int n)
+static inline uint32_t xfs_mask32lo(int n)
 {
-	return ((__uint32_t)1 << (n)) - 1;
+	return ((uint32_t)1 << (n)) - 1;
 }
-static inline __uint64_t xfs_mask64lo(int n)
+static inline uint64_t xfs_mask64lo(int n)
 {
-	return ((__uint64_t)1 << (n)) - 1;
+	return ((uint64_t)1 << (n)) - 1;
 }
 
 /* Get high bit set out of 32-bit argument, -1 if none set */
-static inline int xfs_highbit32(__uint32_t v)
+static inline int xfs_highbit32(uint32_t v)
 {
 	return fls(v) - 1;
 }
 
 /* Get high bit set out of 64-bit argument, -1 if none set */
-static inline int xfs_highbit64(__uint64_t v)
+static inline int xfs_highbit64(uint64_t v)
 {
 	return fls64(v) - 1;
 }
 
 /* Get low bit set out of 32-bit argument, -1 if none set */
-static inline int xfs_lowbit32(__uint32_t v)
+static inline int xfs_lowbit32(uint32_t v)
 {
 	return ffs(v) - 1;
 }
 
 /* Get low bit set out of 64-bit argument, -1 if none set */
-static inline int xfs_lowbit64(__uint64_t v)
+static inline int xfs_lowbit64(uint64_t v)
 {
-	__uint32_t	w = (__uint32_t)v;
+	uint32_t	w = (uint32_t)v;
 	int		n = 0;
 
 	if (w) {	/* lower bits */
 		n = ffs(w);
 	} else {	/* upper bits */
-		w = (__uint32_t)(v >> 32);
+		w = (uint32_t)(v >> 32);
 		if (w) {
 			n = ffs(w);
 			if (n)
diff -urpN xfsprogs-4.9.0/libxfs/xfs_bmap.c xfsprogs-4.14.0/libxfs/xfs_bmap.c
--- xfsprogs-4.9.0/libxfs/xfs_bmap.c	2017-01-05 18:41:55.000000000 +0100
+++ xfsprogs-4.14.0/libxfs/xfs_bmap.c	2017-11-27 17:57:55.000000000 +0100
@@ -496,7 +496,7 @@ void
 xfs_bmap_trace_exlist(
 	xfs_inode_t	*ip,		/* incore inode pointer */
 	xfs_extnum_t	cnt,		/* count of entries in the list */
-	int		whichfork,	/* data or attr fork */
+	int		whichfork,	/* data or attr or cow fork */
 	unsigned long	caller_ip)
 {
 	xfs_extnum_t	idx;		/* extent record index */
@@ -505,11 +505,13 @@ xfs_bmap_trace_exlist(
 
 	if (whichfork == XFS_ATTR_FORK)
 		state |= BMAP_ATTRFORK;
+	else if (whichfork == XFS_COW_FORK)
+		state |= BMAP_COWFORK;
 
 	ifp = XFS_IFORK_PTR(ip, whichfork);
-	ASSERT(cnt == (ifp->if_bytes / (uint)sizeof(xfs_bmbt_rec_t)));
+	ASSERT(cnt == xfs_iext_count(ifp));
 	for (idx = 0; idx < cnt; idx++)
-		trace_xfs_extlist(ip, idx, whichfork, caller_ip);
+		trace_xfs_extlist(ip, idx, state, caller_ip);
 }
 
 /*
@@ -555,7 +557,7 @@ xfs_bmap_validate_ret(
 
 #else
 #define xfs_bmap_check_leaf_extents(cur, ip, whichfork)		do { } while (0)
-#define	xfs_bmap_validate_ret(bno,len,flags,mval,onmap,nmap)
+#define	xfs_bmap_validate_ret(bno,len,flags,mval,onmap,nmap)	do { } while (0)
 #endif /* DEBUG */
 
 /*
@@ -716,15 +718,9 @@ xfs_bmap_extents_to_btree(
 	 * Fill in the root.
 	 */
 	block = ifp->if_broot;
-	if (xfs_sb_version_hascrc(&mp->m_sb))
-		xfs_btree_init_block_int(mp, block, XFS_BUF_DADDR_NULL,
-				 XFS_BMAP_CRC_MAGIC, 1, 1, ip->i_ino,
-				 XFS_BTREE_LONG_PTRS | XFS_BTREE_CRC_BLOCKS);
-	else
-		xfs_btree_init_block_int(mp, block, XFS_BUF_DADDR_NULL,
-				 XFS_BMAP_MAGIC, 1, 1, ip->i_ino,
+	xfs_btree_init_block_int(mp, block, XFS_BUF_DADDR_NULL,
+				 XFS_BTNUM_BMAP, 1, 1, ip->i_ino,
 				 XFS_BTREE_LONG_PTRS);
-
 	/*
 	 * Need a cursor.  Can't allocate until bb_level is filled in.
 	 */
@@ -745,7 +741,6 @@ xfs_bmap_extents_to_btree(
 		args.type = XFS_ALLOCTYPE_START_BNO;
 		args.fsbno = XFS_INO_TO_FSB(mp, ip->i_ino);
 	} else if (dfops->dop_low) {
-try_another_ag:
 		args.type = XFS_ALLOCTYPE_START_BNO;
 		args.fsbno = *firstblock;
 	} else {
@@ -761,28 +756,16 @@ try_another_ag:
 		return error;
 	}
 
-	/*
-	 * During a CoW operation, the allocation and bmbt updates occur in
-	 * different transactions.  The mapping code tries to put new bmbt
-	 * blocks near extents being mapped, but the only way to guarantee this
-	 * is if the alloc and the mapping happen in a single transaction that
-	 * has a block reservation.  That isn't the case here, so if we run out
-	 * of space we'll try again with another AG.
-	 */
-	if (xfs_sb_version_hasreflink(&cur->bc_mp->m_sb) &&
-	    args.fsbno == NULLFSBLOCK &&
-	    args.type == XFS_ALLOCTYPE_NEAR_BNO) {
-		dfops->dop_low = true;
-		goto try_another_ag;
+	if (WARN_ON_ONCE(args.fsbno == NULLFSBLOCK)) {
+		xfs_iroot_realloc(ip, -1, whichfork);
+		xfs_btree_del_cursor(cur, XFS_BTREE_ERROR);
+		return -ENOSPC;
 	}
 	/*
 	 * Allocation can't fail, the space was reserved.
 	 */
-	ASSERT(args.fsbno != NULLFSBLOCK);
 	ASSERT(*firstblock == NULLFSBLOCK ||
-	       args.agno == XFS_FSB_TO_AGNO(mp, *firstblock) ||
-	       (dfops->dop_low &&
-		args.agno > XFS_FSB_TO_AGNO(mp, *firstblock)));
+	       args.agno >= XFS_FSB_TO_AGNO(mp, *firstblock));
 	*firstblock = cur->bc_private.b.firstblock = args.fsbno;
 	cur->bc_private.b.allocated++;
 	ip->i_d.di_nblocks++;
@@ -793,17 +776,12 @@ try_another_ag:
 	 */
 	abp->b_ops = &xfs_bmbt_buf_ops;
 	ablock = XFS_BUF_TO_BLOCK(abp);
-	if (xfs_sb_version_hascrc(&mp->m_sb))
-		xfs_btree_init_block_int(mp, ablock, abp->b_bn,
-				XFS_BMAP_CRC_MAGIC, 0, 0, ip->i_ino,
-				XFS_BTREE_LONG_PTRS | XFS_BTREE_CRC_BLOCKS);
-	else
-		xfs_btree_init_block_int(mp, ablock, abp->b_bn,
-				XFS_BMAP_MAGIC, 0, 0, ip->i_ino,
+	xfs_btree_init_block_int(mp, ablock, abp->b_bn,
+				XFS_BTNUM_BMAP, 0, 0, ip->i_ino,
 				XFS_BTREE_LONG_PTRS);
 
 	arp = XFS_BMBT_REC_ADDR(mp, ablock, 1);
-	nextents = ifp->if_bytes / (uint)sizeof(xfs_bmbt_rec_t);
+	nextents =  xfs_iext_count(ifp);
 	for (cnt = i = 0; i < nextents; i++) {
 		ep = xfs_iext_get_ext(ifp, i);
 		if (!isnullstartblock(xfs_bmbt_get_startblock(ep))) {
@@ -880,7 +858,7 @@ xfs_bmap_local_to_extents(
 	xfs_ifork_t	*ifp;		/* inode fork pointer */
 	xfs_alloc_arg_t	args;		/* allocation arguments */
 	xfs_buf_t	*bp;		/* buffer for extent block */
-	xfs_bmbt_rec_host_t *ep;	/* extent record pointer */
+	struct xfs_bmbt_irec rec;
 
 	/*
 	 * We don't want to deal with the case of keeping inode data inline yet.
@@ -910,7 +888,6 @@ xfs_bmap_local_to_extents(
 	 * file currently fits in an inode.
 	 */
 	if (*firstblock == NULLFSBLOCK) {
-try_another_ag:
 		args.fsbno = XFS_INO_TO_FSB(args.mp, ip->i_ino);
 		args.type = XFS_ALLOCTYPE_START_BNO;
 	} else {
@@ -923,19 +900,6 @@ try_another_ag:
 	if (error)
 		goto done;
 
-	/*
-	 * During a CoW operation, the allocation and bmbt updates occur in
-	 * different transactions.  The mapping code tries to put new bmbt
-	 * blocks near extents being mapped, but the only way to guarantee this
-	 * is if the alloc and the mapping happen in a single transaction that
-	 * has a block reservation.  That isn't the case here, so if we run out
-	 * of space we'll try again with another AG.
-	 */
-	if (xfs_sb_version_hasreflink(&ip->i_mount->m_sb) &&
-	    args.fsbno == NULLFSBLOCK &&
-	    args.type == XFS_ALLOCTYPE_NEAR_BNO) {
-		goto try_another_ag;
-	}
 	/* Can't fail, the space was reserved. */
 	ASSERT(args.fsbno != NULLFSBLOCK);
 	ASSERT(args.len == 1);
@@ -957,9 +921,12 @@ try_another_ag:
 	xfs_bmap_local_to_extents_empty(ip, whichfork);
 	flags |= XFS_ILOG_CORE;
 
-	xfs_iext_add(ifp, 0, 1);
-	ep = xfs_iext_get_ext(ifp, 0);
-	xfs_bmbt_set_allf(ep, 0, args.fsbno, 1, XFS_EXT_NORM);
+	rec.br_startoff = 0;
+	rec.br_startblock = args.fsbno;
+	rec.br_blockcount = 1;
+	rec.br_state = XFS_EXT_NORM;
+	xfs_iext_insert(ip, 0, 1, &rec, 0);
+
 	trace_xfs_bmap_post_update(ip, 0,
 			whichfork == XFS_ATTR_FORK ? BMAP_ATTRFORK : 0,
 			_THIS_IP_);
@@ -1129,6 +1096,10 @@ xfs_bmap_add_attrfork(
 		goto trans_cancel;
 	if (XFS_IFORK_Q(ip))
 		goto trans_cancel;
+	if (ip->i_d.di_anextents != 0) {
+		error = -EFSCORRUPTED;
+		goto trans_cancel;
+	}
 	if (ip->i_d.di_aformat != XFS_DINODE_FMT_EXTENTS) {
 		/*
 		 * For inodes coming from pre-6.2 filesystems.
@@ -1136,7 +1107,6 @@ xfs_bmap_add_attrfork(
 		ASSERT(ip->i_d.di_aformat == 0);
 		ip->i_d.di_aformat = XFS_DINODE_FMT_EXTENTS;
 	}
-	ASSERT(ip->i_d.di_anextents == 0);
 
 	xfs_trans_ijoin(tp, ip, 0);
 	xfs_trans_log_inode(tp, ip, XFS_ILOG_CORE);
@@ -1207,7 +1177,7 @@ xfs_bmap_add_attrfork(
 			xfs_log_sb(tp);
 	}
 
-	error = xfs_defer_finish(&tp, &dfops, NULL);
+	error = xfs_defer_finish(&tp, &dfops);
 	if (error)
 		goto bmap_cancel;
 	error = xfs_trans_commit(tp);
@@ -1242,7 +1212,6 @@ xfs_bmap_read_extents(
 	xfs_fsblock_t		bno;	/* block # of "block" */
 	xfs_buf_t		*bp;	/* buffer for "block" */
 	int			error;	/* error return value */
-	xfs_exntfmt_t		exntf;	/* XFS_EXTFMT_NOSTATE, if checking */
 	xfs_extnum_t		i, j;	/* index into the extents list */
 	xfs_ifork_t		*ifp;	/* fork structure */
 	int			level;	/* btree level, for checking */
@@ -1251,11 +1220,8 @@ xfs_bmap_read_extents(
 	/* REFERENCED */
 	xfs_extnum_t		room;	/* number of entries there's room for */
 
-	bno = NULLFSBLOCK;
 	mp = ip->i_mount;
 	ifp = XFS_IFORK_PTR(ip, whichfork);
-	exntf = (whichfork != XFS_DATA_FORK) ? XFS_EXTFMT_NOSTATE :
-					XFS_EXTFMT_INODE(ip);
 	block = ifp->if_broot;
 	/*
 	 * Root level must use BMAP_BROOT_PTR_ADDR macro to get ptr out.
@@ -1264,9 +1230,7 @@ xfs_bmap_read_extents(
 	ASSERT(level > 0);
 	pp = XFS_BMAP_BROOT_PTR_ADDR(mp, block, 1, ifp->if_broot_bytes);
 	bno = be64_to_cpu(*pp);
-	ASSERT(bno != NULLFSBLOCK);
-	ASSERT(XFS_FSB_TO_AGNO(mp, bno) < mp->m_sb.sb_agcount);
-	ASSERT(XFS_FSB_TO_AGBNO(mp, bno) < mp->m_sb.sb_agblocks);
+
 	/*
 	 * Go down the tree until leaf level is reached, following the first
 	 * pointer (leftmost) at each level.
@@ -1288,7 +1252,7 @@ xfs_bmap_read_extents(
 	/*
 	 * Here with bp and block set to the leftmost leaf node in the tree.
 	 */
-	room = ifp->if_bytes / (uint)sizeof(xfs_bmbt_rec_t);
+	room = xfs_iext_count(ifp);
 	i = 0;
 	/*
 	 * Loop over all leaf nodes.  Copy information to the extent records.
@@ -1297,7 +1261,6 @@ xfs_bmap_read_extents(
 		xfs_bmbt_rec_t	*frp;
 		xfs_fsblock_t	nextbno;
 		xfs_extnum_t	num_recs;
-		xfs_extnum_t	start;
 
 		num_recs = xfs_btree_get_numrecs(block);
 		if (unlikely(i + num_recs > room)) {
@@ -1320,23 +1283,13 @@ xfs_bmap_read_extents(
 		 * Copy records into the extent records.
 		 */
 		frp = XFS_BMBT_REC_ADDR(mp, block, 1);
-		start = i;
 		for (j = 0; j < num_recs; j++, i++, frp++) {
 			xfs_bmbt_rec_host_t *trp = xfs_iext_get_ext(ifp, i);
 			trp->l0 = be64_to_cpu(frp->l0);
 			trp->l1 = be64_to_cpu(frp->l1);
-		}
-		if (exntf == XFS_EXTFMT_NOSTATE) {
-			/*
-			 * Check all attribute bmap btree records and
-			 * any "older" data bmap btree records for a
-			 * set bit in the "extent flag" position.
-			 */
-			if (unlikely(xfs_check_nostate_extents(ifp,
-					start, num_recs))) {
+			if (!xfs_bmbt_validate_extent(mp, whichfork, trp)) {
 				XFS_ERROR_REPORT("xfs_bmap_read_extents(2)",
-						 XFS_ERRLEVEL_LOW,
-						 ip->i_mount);
+						 XFS_ERRLEVEL_LOW, mp);
 				goto error0;
 			}
 		}
@@ -1353,8 +1306,9 @@ xfs_bmap_read_extents(
 			return error;
 		block = XFS_BUF_TO_BLOCK(bp);
 	}
-	ASSERT(i == (ifp->if_bytes / (uint)sizeof(xfs_bmbt_rec_t)));
-	ASSERT(i == XFS_IFORK_NEXTENTS(ip, whichfork));
+	if (i != XFS_IFORK_NEXTENTS(ip, whichfork))
+		return -EFSCORRUPTED;
+	ASSERT(i == xfs_iext_count(ifp));
 	XFS_BMAP_TRACE_EXLIST(ip, i, whichfork);
 	return 0;
 error0:
@@ -1362,97 +1316,6 @@ error0:
 	return -EFSCORRUPTED;
 }
 
-
-/*
- * Search the extent records for the entry containing block bno.
- * If bno lies in a hole, point to the next entry.  If bno lies
- * past eof, *eofp will be set, and *prevp will contain the last
- * entry (null if none).  Else, *lastxp will be set to the index
- * of the found entry; *gotp will contain the entry.
- */
-STATIC xfs_bmbt_rec_host_t *		/* pointer to found extent entry */
-xfs_bmap_search_multi_extents(
-	xfs_ifork_t	*ifp,		/* inode fork pointer */
-	xfs_fileoff_t	bno,		/* block number searched for */
-	int		*eofp,		/* out: end of file found */
-	xfs_extnum_t	*lastxp,	/* out: last extent index */
-	xfs_bmbt_irec_t	*gotp,		/* out: extent entry found */
-	xfs_bmbt_irec_t	*prevp)		/* out: previous extent entry found */
-{
-	xfs_bmbt_rec_host_t *ep;		/* extent record pointer */
-	xfs_extnum_t	lastx;		/* last extent index */
-
-	/*
-	 * Initialize the extent entry structure to catch access to
-	 * uninitialized br_startblock field.
-	 */
-	gotp->br_startoff = 0xffa5a5a5a5a5a5a5LL;
-	gotp->br_blockcount = 0xa55a5a5a5a5a5a5aLL;
-	gotp->br_state = XFS_EXT_INVALID;
-	gotp->br_startblock = 0xffffa5a5a5a5a5a5LL;
-	prevp->br_startoff = NULLFILEOFF;
-
-	ep = xfs_iext_bno_to_ext(ifp, bno, &lastx);
-	if (lastx > 0) {
-		xfs_bmbt_get_all(xfs_iext_get_ext(ifp, lastx - 1), prevp);
-	}
-	if (lastx < (ifp->if_bytes / (uint)sizeof(xfs_bmbt_rec_t))) {
-		xfs_bmbt_get_all(ep, gotp);
-		*eofp = 0;
-	} else {
-		if (lastx > 0) {
-			*gotp = *prevp;
-		}
-		*eofp = 1;
-		ep = NULL;
-	}
-	*lastxp = lastx;
-	return ep;
-}
-
-/*
- * Search the extents list for the inode, for the extent containing bno.
- * If bno lies in a hole, point to the next entry.  If bno lies past eof,
- * *eofp will be set, and *prevp will contain the last entry (null if none).
- * Else, *lastxp will be set to the index of the found
- * entry; *gotp will contain the entry.
- */
-xfs_bmbt_rec_host_t *                 /* pointer to found extent entry */
-xfs_bmap_search_extents(
-	xfs_inode_t     *ip,            /* incore inode pointer */
-	xfs_fileoff_t   bno,            /* block number searched for */
-	int             fork,      	/* data or attr fork */
-	int             *eofp,          /* out: end of file found */
-	xfs_extnum_t    *lastxp,        /* out: last extent index */
-	xfs_bmbt_irec_t *gotp,          /* out: extent entry found */
-	xfs_bmbt_irec_t *prevp)         /* out: previous extent entry found */
-{
-	xfs_ifork_t	*ifp;		/* inode fork pointer */
-	xfs_bmbt_rec_host_t  *ep;            /* extent record pointer */
-
-	XFS_STATS_INC(ip->i_mount, xs_look_exlist);
-	ifp = XFS_IFORK_PTR(ip, fork);
-
-	ep = xfs_bmap_search_multi_extents(ifp, bno, eofp, lastxp, gotp, prevp);
-
-	if (unlikely(!(gotp->br_startblock) && (*lastxp != NULLEXTNUM) &&
-		     !(XFS_IS_REALTIME_INODE(ip) && fork == XFS_DATA_FORK))) {
-		xfs_alert_tag(ip->i_mount, XFS_PTAG_FSBLOCK_ZERO,
-				"Access to block zero in inode %llu "
-				"start_block: %llx start_off: %llx "
-				"blkcnt: %llx extent-state: %x lastx: %x",
-			(unsigned long long)ip->i_ino,
-			(unsigned long long)gotp->br_startblock,
-			(unsigned long long)gotp->br_startoff,
-			(unsigned long long)gotp->br_blockcount,
-			gotp->br_state, *lastxp);
-		*lastxp = NULLEXTNUM;
-		*eofp = 1;
-		return NULL;
-	}
-	return ep;
-}
-
 /*
  * Returns the file-relative block number of the first unused block(s)
  * in the file with at least "len" logically contiguous blocks free.
@@ -1474,7 +1337,6 @@ xfs_bmap_first_unused(
 	xfs_fileoff_t	lastaddr;		/* last block number seen */
 	xfs_fileoff_t	lowest;			/* lowest useful block */
 	xfs_fileoff_t	max;			/* starting useful block */
-	xfs_fileoff_t	off;			/* offset for this block */
 	xfs_extnum_t	nextents;		/* number of extent entries */
 
 	ASSERT(XFS_IFORK_FORMAT(ip, whichfork) == XFS_DINODE_FMT_BTREE ||
@@ -1489,18 +1351,21 @@ xfs_bmap_first_unused(
 	    (error = xfs_iread_extents(tp, ip, whichfork)))
 		return error;
 	lowest = *first_unused;
-	nextents = ifp->if_bytes / (uint)sizeof(xfs_bmbt_rec_t);
+	nextents = xfs_iext_count(ifp);
 	for (idx = 0, lastaddr = 0, max = lowest; idx < nextents; idx++) {
-		xfs_bmbt_rec_host_t *ep = xfs_iext_get_ext(ifp, idx);
-		off = xfs_bmbt_get_startoff(ep);
+		struct xfs_bmbt_irec got;
+
+		xfs_iext_get_extent(ifp, idx, &got);
+
 		/*
 		 * See if the hole before this extent will work.
 		 */
-		if (off >= lowest + len && off - max >= len) {
+		if (got.br_startoff >= lowest + len &&
+		    got.br_startoff - max >= len) {
 			*first_unused = max;
 			return 0;
 		}
-		lastaddr = off + xfs_bmbt_get_blockcount(ep);
+		lastaddr = got.br_startoff + got.br_blockcount;
 		max = XFS_FILEOFF_MAX(lastaddr, lowest);
 	}
 	*first_unused = max;
@@ -1515,44 +1380,44 @@ xfs_bmap_first_unused(
  */
 int						/* error */
 xfs_bmap_last_before(
-	xfs_trans_t	*tp,			/* transaction pointer */
-	xfs_inode_t	*ip,			/* incore inode */
-	xfs_fileoff_t	*last_block,		/* last block */
-	int		whichfork)		/* data or attr fork */
+	struct xfs_trans	*tp,		/* transaction pointer */
+	struct xfs_inode	*ip,		/* incore inode */
+	xfs_fileoff_t		*last_block,	/* last block */
+	int			whichfork)	/* data or attr fork */
 {
-	xfs_fileoff_t	bno;			/* input file offset */
-	int		eof;			/* hit end of file */
-	xfs_bmbt_rec_host_t *ep;		/* pointer to last extent */
-	int		error;			/* error return value */
-	xfs_bmbt_irec_t	got;			/* current extent value */
-	xfs_ifork_t	*ifp;			/* inode fork pointer */
-	xfs_extnum_t	lastx;			/* last extent used */
-	xfs_bmbt_irec_t	prev;			/* previous extent value */
+	struct xfs_ifork	*ifp = XFS_IFORK_PTR(ip, whichfork);
+	struct xfs_bmbt_irec	got;
+	xfs_extnum_t		idx;
+	int			error;
 
-	if (XFS_IFORK_FORMAT(ip, whichfork) != XFS_DINODE_FMT_BTREE &&
-	    XFS_IFORK_FORMAT(ip, whichfork) != XFS_DINODE_FMT_EXTENTS &&
-	    XFS_IFORK_FORMAT(ip, whichfork) != XFS_DINODE_FMT_LOCAL)
-	       return -EIO;
-	if (XFS_IFORK_FORMAT(ip, whichfork) == XFS_DINODE_FMT_LOCAL) {
+	switch (XFS_IFORK_FORMAT(ip, whichfork)) {
+	case XFS_DINODE_FMT_LOCAL:
 		*last_block = 0;
 		return 0;
+	case XFS_DINODE_FMT_BTREE:
+	case XFS_DINODE_FMT_EXTENTS:
+		break;
+	default:
+		return -EIO;
 	}
-	ifp = XFS_IFORK_PTR(ip, whichfork);
-	if (!(ifp->if_flags & XFS_IFEXTENTS) &&
-	    (error = xfs_iread_extents(tp, ip, whichfork)))
-		return error;
-	bno = *last_block - 1;
-	ep = xfs_bmap_search_extents(ip, bno, whichfork, &eof, &lastx, &got,
-		&prev);
-	if (eof || xfs_bmbt_get_startoff(ep) > bno) {
-		if (prev.br_startoff == NULLFILEOFF)
-			*last_block = 0;
-		else
-			*last_block = prev.br_startoff + prev.br_blockcount;
+
+	if (!(ifp->if_flags & XFS_IFEXTENTS)) {
+		error = xfs_iread_extents(tp, ip, whichfork);
+		if (error)
+			return error;
 	}
-	/*
-	 * Otherwise *last_block is already the right answer.
-	 */
+
+	if (xfs_iext_lookup_extent(ip, ifp, *last_block - 1, &idx, &got)) {
+		if (got.br_startoff <= *last_block - 1)
+			return 0;
+	}
+
+	if (xfs_iext_get_extent(ifp, idx - 1, &got)) {
+		*last_block = got.br_startoff + got.br_blockcount;
+		return 0;
+	}
+
+	*last_block = 0;
 	return 0;
 }
 
@@ -1574,7 +1439,7 @@ xfs_bmap_last_extent(
 			return error;
 	}
 
-	nextents = ifp->if_bytes / sizeof(xfs_bmbt_rec_t);
+	nextents = xfs_iext_count(ifp);
 	if (nextents == 0) {
 		*is_empty = 1;
 		return 0;
@@ -1603,14 +1468,14 @@ xfs_bmap_isaeof(
 	int			is_empty;
 	int			error;
 
-	bma->aeof = 0;
+	bma->aeof = false;
 	error = xfs_bmap_last_extent(NULL, bma->ip, whichfork, &rec,
 				     &is_empty);
 	if (error)
 		return error;
 
 	if (is_empty) {
-		bma->aeof = 1;
+		bma->aeof = true;
 		return 0;
 	}
 
@@ -1727,7 +1592,7 @@ xfs_bmap_add_extent_delay_real(
 						&bma->ip->i_d.di_nextents);
 
 	ASSERT(bma->idx >= 0);
-	ASSERT(bma->idx <= ifp->if_bytes / sizeof(struct xfs_bmbt_rec));
+	ASSERT(bma->idx <= xfs_iext_count(ifp));
 	ASSERT(!isnullstartblock(new->br_startblock));
 	ASSERT(!bma->cur ||
 	       (bma->cur->bc_private.b.flags & XFS_BTCUR_BPRV_WASDEL));
@@ -1786,7 +1651,7 @@ xfs_bmap_add_extent_delay_real(
 	 * Don't set contiguous if the combined extent would be too large.
 	 * Also check for all-three-contiguous being too large.
 	 */
-	if (bma->idx < ifp->if_bytes / (uint)sizeof(xfs_bmbt_rec_t) - 1) {
+	if (bma->idx < xfs_iext_count(ifp) - 1) {
 		state |= BMAP_RIGHT_VALID;
 		xfs_bmbt_get_all(xfs_iext_get_ext(ifp, bma->idx + 1), &RIGHT);
 
@@ -1927,6 +1792,7 @@ xfs_bmap_add_extent_delay_real(
 		 */
 		trace_xfs_bmap_pre_update(bma->ip, bma->idx, state, _THIS_IP_);
 		xfs_bmbt_set_startblock(ep, new->br_startblock);
+		xfs_bmbt_set_state(ep, new->br_state);
 		trace_xfs_bmap_post_update(bma->ip, bma->idx, state, _THIS_IP_);
 
 		(*nextents)++;
@@ -2180,8 +2046,10 @@ xfs_bmap_add_extent_delay_real(
 		}
 		temp = xfs_bmap_worst_indlen(bma->ip, temp);
 		temp2 = xfs_bmap_worst_indlen(bma->ip, temp2);
-		diff = (int)(temp + temp2 - startblockval(PREV.br_startblock) -
-			(bma->cur ? bma->cur->bc_private.b.allocated : 0));
+		diff = (int)(temp + temp2 -
+			     (startblockval(PREV.br_startblock) -
+			      (bma->cur ?
+			       bma->cur->bc_private.b.allocated : 0)));
 		if (diff > 0) {
 			error = xfs_mod_fdblocks(bma->ip->i_mount,
 						 -((int64_t)diff), false);
@@ -2238,7 +2106,6 @@ xfs_bmap_add_extent_delay_real(
 		temp = da_new;
 		if (bma->cur)
 			temp += bma->cur->bc_private.b.allocated;
-		ASSERT(temp <= da_old);
 		if (temp < da_old)
 			xfs_mod_fdblocks(bma->ip->i_mount,
 					(int64_t)(da_old - temp), false);
@@ -2265,6 +2132,7 @@ STATIC int				/* error */
 xfs_bmap_add_extent_unwritten_real(
 	struct xfs_trans	*tp,
 	xfs_inode_t		*ip,	/* incore inode pointer */
+	int			whichfork,
 	xfs_extnum_t		*idx,	/* extent number to update/insert */
 	xfs_btree_cur_t		**curp,	/* if *curp is null, not a btree */
 	xfs_bmbt_irec_t		*new,	/* new data to add to file extents */
@@ -2284,15 +2152,17 @@ xfs_bmap_add_extent_unwritten_real(
 					/* left is 0, right is 1, prev is 2 */
 	int			rval=0;	/* return value (logging flags) */
 	int			state = 0;/* state bits, accessed thru macros */
-	struct xfs_mount	*mp = tp->t_mountp;
+	struct xfs_mount	*mp = ip->i_mount;
 
 	*logflagsp = 0;
 
 	cur = *curp;
-	ifp = XFS_IFORK_PTR(ip, XFS_DATA_FORK);
+	ifp = XFS_IFORK_PTR(ip, whichfork);
+	if (whichfork == XFS_COW_FORK)
+		state |= BMAP_COWFORK;
 
 	ASSERT(*idx >= 0);
-	ASSERT(*idx <= ifp->if_bytes / sizeof(struct xfs_bmbt_rec));
+	ASSERT(*idx <= xfs_iext_count(ifp));
 	ASSERT(!isnullstartblock(new->br_startblock));
 
 	XFS_STATS_INC(mp, xs_add_exlist);
@@ -2348,7 +2218,7 @@ xfs_bmap_add_extent_unwritten_real(
 	 * Don't set contiguous if the combined extent would be too large.
 	 * Also check for all-three-contiguous being too large.
 	 */
-	if (*idx < ip->i_df.if_bytes / (uint)sizeof(xfs_bmbt_rec_t) - 1) {
+	if (*idx < xfs_iext_count(ifp) - 1) {
 		state |= BMAP_RIGHT_VALID;
 		xfs_bmbt_get_all(xfs_iext_get_ext(ifp, *idx + 1), &RIGHT);
 		if (isnullstartblock(RIGHT.br_startblock))
@@ -2388,7 +2258,8 @@ xfs_bmap_add_extent_unwritten_real(
 		trace_xfs_bmap_post_update(ip, *idx, state, _THIS_IP_);
 
 		xfs_iext_remove(ip, *idx + 1, 2, state);
-		ip->i_d.di_nextents -= 2;
+		XFS_IFORK_NEXT_SET(ip, whichfork,
+				XFS_IFORK_NEXTENTS(ip, whichfork) - 2);
 		if (cur == NULL)
 			rval = XFS_ILOG_CORE | XFS_ILOG_DEXT;
 		else {
@@ -2431,7 +2302,8 @@ xfs_bmap_add_extent_unwritten_real(
 		trace_xfs_bmap_post_update(ip, *idx, state, _THIS_IP_);
 
 		xfs_iext_remove(ip, *idx + 1, 1, state);
-		ip->i_d.di_nextents--;
+		XFS_IFORK_NEXT_SET(ip, whichfork,
+				XFS_IFORK_NEXTENTS(ip, whichfork) - 1);
 		if (cur == NULL)
 			rval = XFS_ILOG_CORE | XFS_ILOG_DEXT;
 		else {
@@ -2466,7 +2338,8 @@ xfs_bmap_add_extent_unwritten_real(
 		xfs_bmbt_set_state(ep, newext);
 		trace_xfs_bmap_post_update(ip, *idx, state, _THIS_IP_);
 		xfs_iext_remove(ip, *idx + 1, 1, state);
-		ip->i_d.di_nextents--;
+		XFS_IFORK_NEXT_SET(ip, whichfork,
+				XFS_IFORK_NEXTENTS(ip, whichfork) - 1);
 		if (cur == NULL)
 			rval = XFS_ILOG_CORE | XFS_ILOG_DEXT;
 		else {
@@ -2578,7 +2451,8 @@ xfs_bmap_add_extent_unwritten_real(
 		trace_xfs_bmap_post_update(ip, *idx, state, _THIS_IP_);
 
 		xfs_iext_insert(ip, *idx, 1, new, state);
-		ip->i_d.di_nextents++;
+		XFS_IFORK_NEXT_SET(ip, whichfork,
+				XFS_IFORK_NEXTENTS(ip, whichfork) + 1);
 		if (cur == NULL)
 			rval = XFS_ILOG_CORE | XFS_ILOG_DEXT;
 		else {
@@ -2656,7 +2530,8 @@ xfs_bmap_add_extent_unwritten_real(
 		++*idx;
 		xfs_iext_insert(ip, *idx, 1, new, state);
 
-		ip->i_d.di_nextents++;
+		XFS_IFORK_NEXT_SET(ip, whichfork,
+				XFS_IFORK_NEXTENTS(ip, whichfork) + 1);
 		if (cur == NULL)
 			rval = XFS_ILOG_CORE | XFS_ILOG_DEXT;
 		else {
@@ -2704,7 +2579,8 @@ xfs_bmap_add_extent_unwritten_real(
 		++*idx;
 		xfs_iext_insert(ip, *idx, 2, &r[0], state);
 
-		ip->i_d.di_nextents += 2;
+		XFS_IFORK_NEXT_SET(ip, whichfork,
+				XFS_IFORK_NEXTENTS(ip, whichfork) + 2);
 		if (cur == NULL)
 			rval = XFS_ILOG_CORE | XFS_ILOG_DEXT;
 		else {
@@ -2758,17 +2634,17 @@ xfs_bmap_add_extent_unwritten_real(
 	}
 
 	/* update reverse mappings */
-	error = xfs_rmap_convert_extent(mp, dfops, ip, XFS_DATA_FORK, new);
+	error = xfs_rmap_convert_extent(mp, dfops, ip, whichfork, new);
 	if (error)
 		goto done;
 
 	/* convert to a btree if necessary */
-	if (xfs_bmap_needs_btree(ip, XFS_DATA_FORK)) {
+	if (xfs_bmap_needs_btree(ip, whichfork)) {
 		int	tmp_logflags;	/* partial log flag return val */
 
 		ASSERT(cur == NULL);
 		error = xfs_bmap_extents_to_btree(tp, ip, first, dfops, &cur,
-				0, &tmp_logflags, XFS_DATA_FORK);
+				0, &tmp_logflags, whichfork);
 		*logflagsp |= tmp_logflags;
 		if (error)
 			goto done;
@@ -2780,7 +2656,7 @@ xfs_bmap_add_extent_unwritten_real(
 		*curp = cur;
 	}
 
-	xfs_bmap_check_leaf_extents(*curp, ip, XFS_DATA_FORK);
+	xfs_bmap_check_leaf_extents(*curp, ip, whichfork);
 done:
 	*logflagsp |= rval;
 	return error;
@@ -2828,7 +2704,7 @@ xfs_bmap_add_extent_hole_delay(
 	 * Check and set flags if the current (right) segment exists.
 	 * If it doesn't exist, we're converting the hole at end-of-file.
 	 */
-	if (*idx < ifp->if_bytes / (uint)sizeof(xfs_bmbt_rec_t)) {
+	if (*idx < xfs_iext_count(ifp)) {
 		state |= BMAP_RIGHT_VALID;
 		xfs_bmbt_get_all(xfs_iext_get_ext(ifp, *idx), &right);
 
@@ -2872,7 +2748,8 @@ xfs_bmap_add_extent_hole_delay(
 		oldlen = startblockval(left.br_startblock) +
 			startblockval(new->br_startblock) +
 			startblockval(right.br_startblock);
-		newlen = xfs_bmap_worst_indlen(ip, temp);
+		newlen = XFS_FILBLKS_MIN(xfs_bmap_worst_indlen(ip, temp),
+					 oldlen);
 		xfs_bmbt_set_startblock(xfs_iext_get_ext(ifp, *idx),
 			nullstartblock((int)newlen));
 		trace_xfs_bmap_post_update(ip, *idx, state, _THIS_IP_);
@@ -2893,7 +2770,8 @@ xfs_bmap_add_extent_hole_delay(
 		xfs_bmbt_set_blockcount(xfs_iext_get_ext(ifp, *idx), temp);
 		oldlen = startblockval(left.br_startblock) +
 			startblockval(new->br_startblock);
-		newlen = xfs_bmap_worst_indlen(ip, temp);
+		newlen = XFS_FILBLKS_MIN(xfs_bmap_worst_indlen(ip, temp),
+					 oldlen);
 		xfs_bmbt_set_startblock(xfs_iext_get_ext(ifp, *idx),
 			nullstartblock((int)newlen));
 		trace_xfs_bmap_post_update(ip, *idx, state, _THIS_IP_);
@@ -2909,7 +2787,8 @@ xfs_bmap_add_extent_hole_delay(
 		temp = new->br_blockcount + right.br_blockcount;
 		oldlen = startblockval(new->br_startblock) +
 			startblockval(right.br_startblock);
-		newlen = xfs_bmap_worst_indlen(ip, temp);
+		newlen = XFS_FILBLKS_MIN(xfs_bmap_worst_indlen(ip, temp),
+					 oldlen);
 		xfs_bmbt_set_allf(xfs_iext_get_ext(ifp, *idx),
 			new->br_startoff,
 			nullstartblock((int)newlen), temp, right.br_state);
@@ -2941,41 +2820,45 @@ xfs_bmap_add_extent_hole_delay(
  */
 STATIC int				/* error */
 xfs_bmap_add_extent_hole_real(
-	struct xfs_bmalloca	*bma,
-	int			whichfork)
+	struct xfs_trans	*tp,
+	struct xfs_inode	*ip,
+	int			whichfork,
+	xfs_extnum_t		*idx,
+	struct xfs_btree_cur	**curp,
+	struct xfs_bmbt_irec	*new,
+	xfs_fsblock_t		*first,
+	struct xfs_defer_ops	*dfops,
+	int			*logflagsp)
 {
-	struct xfs_bmbt_irec	*new = &bma->got;
+	struct xfs_ifork	*ifp = XFS_IFORK_PTR(ip, whichfork);
+	struct xfs_mount	*mp = ip->i_mount;
+	struct xfs_btree_cur	*cur = *curp;
 	int			error;	/* error return value */
 	int			i;	/* temp state */
-	xfs_ifork_t		*ifp;	/* inode fork pointer */
 	xfs_bmbt_irec_t		left;	/* left neighbor extent entry */
 	xfs_bmbt_irec_t		right;	/* right neighbor extent entry */
 	int			rval=0;	/* return value (logging flags) */
 	int			state;	/* state bits, accessed thru macros */
-	struct xfs_mount	*mp;
-
-	mp = bma->ip->i_mount;
-	ifp = XFS_IFORK_PTR(bma->ip, whichfork);
 
-	ASSERT(bma->idx >= 0);
-	ASSERT(bma->idx <= ifp->if_bytes / sizeof(struct xfs_bmbt_rec));
+	ASSERT(*idx >= 0);
+	ASSERT(*idx <= xfs_iext_count(ifp));
 	ASSERT(!isnullstartblock(new->br_startblock));
-	ASSERT(!bma->cur ||
-	       !(bma->cur->bc_private.b.flags & XFS_BTCUR_BPRV_WASDEL));
-	ASSERT(whichfork != XFS_COW_FORK);
+	ASSERT(!cur || !(cur->bc_private.b.flags & XFS_BTCUR_BPRV_WASDEL));
 
 	XFS_STATS_INC(mp, xs_add_exlist);
 
 	state = 0;
 	if (whichfork == XFS_ATTR_FORK)
 		state |= BMAP_ATTRFORK;
+	if (whichfork == XFS_COW_FORK)
+		state |= BMAP_COWFORK;
 
 	/*
 	 * Check and set flags if this segment has a left neighbor.
 	 */
-	if (bma->idx > 0) {
+	if (*idx > 0) {
 		state |= BMAP_LEFT_VALID;
-		xfs_bmbt_get_all(xfs_iext_get_ext(ifp, bma->idx - 1), &left);
+		xfs_bmbt_get_all(xfs_iext_get_ext(ifp, *idx - 1), &left);
 		if (isnullstartblock(left.br_startblock))
 			state |= BMAP_LEFT_DELAY;
 	}
@@ -2984,9 +2867,9 @@ xfs_bmap_add_extent_hole_real(
 	 * Check and set flags if this segment has a current value.
 	 * Not true if we're inserting into the "hole" at eof.
 	 */
-	if (bma->idx < ifp->if_bytes / (uint)sizeof(xfs_bmbt_rec_t)) {
+	if (*idx < xfs_iext_count(ifp)) {
 		state |= BMAP_RIGHT_VALID;
-		xfs_bmbt_get_all(xfs_iext_get_ext(ifp, bma->idx), &right);
+		xfs_bmbt_get_all(xfs_iext_get_ext(ifp, *idx), &right);
 		if (isnullstartblock(right.br_startblock))
 			state |= BMAP_RIGHT_DELAY;
 	}
@@ -3023,36 +2906,36 @@ xfs_bmap_add_extent_hole_real(
 		 * left and on the right.
 		 * Merge all three into a single extent record.
 		 */
-		--bma->idx;
-		trace_xfs_bmap_pre_update(bma->ip, bma->idx, state, _THIS_IP_);
-		xfs_bmbt_set_blockcount(xfs_iext_get_ext(ifp, bma->idx),
+		--*idx;
+		trace_xfs_bmap_pre_update(ip, *idx, state, _THIS_IP_);
+		xfs_bmbt_set_blockcount(xfs_iext_get_ext(ifp, *idx),
 			left.br_blockcount + new->br_blockcount +
 			right.br_blockcount);
-		trace_xfs_bmap_post_update(bma->ip, bma->idx, state, _THIS_IP_);
+		trace_xfs_bmap_post_update(ip, *idx, state, _THIS_IP_);
 
-		xfs_iext_remove(bma->ip, bma->idx + 1, 1, state);
+		xfs_iext_remove(ip, *idx + 1, 1, state);
 
-		XFS_IFORK_NEXT_SET(bma->ip, whichfork,
-			XFS_IFORK_NEXTENTS(bma->ip, whichfork) - 1);
-		if (bma->cur == NULL) {
+		XFS_IFORK_NEXT_SET(ip, whichfork,
+			XFS_IFORK_NEXTENTS(ip, whichfork) - 1);
+		if (cur == NULL) {
 			rval = XFS_ILOG_CORE | xfs_ilog_fext(whichfork);
 		} else {
 			rval = XFS_ILOG_CORE;
-			error = xfs_bmbt_lookup_eq(bma->cur, right.br_startoff,
+			error = xfs_bmbt_lookup_eq(cur, right.br_startoff,
 					right.br_startblock, right.br_blockcount,
 					&i);
 			if (error)
 				goto done;
 			XFS_WANT_CORRUPTED_GOTO(mp, i == 1, done);
-			error = xfs_btree_delete(bma->cur, &i);
+			error = xfs_btree_delete(cur, &i);
 			if (error)
 				goto done;
 			XFS_WANT_CORRUPTED_GOTO(mp, i == 1, done);
-			error = xfs_btree_decrement(bma->cur, 0, &i);
+			error = xfs_btree_decrement(cur, 0, &i);
 			if (error)
 				goto done;
 			XFS_WANT_CORRUPTED_GOTO(mp, i == 1, done);
-			error = xfs_bmbt_update(bma->cur, left.br_startoff,
+			error = xfs_bmbt_update(cur, left.br_startoff,
 					left.br_startblock,
 					left.br_blockcount +
 						new->br_blockcount +
@@ -3069,23 +2952,23 @@ xfs_bmap_add_extent_hole_real(
 		 * on the left.
 		 * Merge the new allocation with the left neighbor.
 		 */
-		--bma->idx;
-		trace_xfs_bmap_pre_update(bma->ip, bma->idx, state, _THIS_IP_);
-		xfs_bmbt_set_blockcount(xfs_iext_get_ext(ifp, bma->idx),
+		--*idx;
+		trace_xfs_bmap_pre_update(ip, *idx, state, _THIS_IP_);
+		xfs_bmbt_set_blockcount(xfs_iext_get_ext(ifp, *idx),
 			left.br_blockcount + new->br_blockcount);
-		trace_xfs_bmap_post_update(bma->ip, bma->idx, state, _THIS_IP_);
+		trace_xfs_bmap_post_update(ip, *idx, state, _THIS_IP_);
 
-		if (bma->cur == NULL) {
+		if (cur == NULL) {
 			rval = xfs_ilog_fext(whichfork);
 		} else {
 			rval = 0;
-			error = xfs_bmbt_lookup_eq(bma->cur, left.br_startoff,
+			error = xfs_bmbt_lookup_eq(cur, left.br_startoff,
 					left.br_startblock, left.br_blockcount,
 					&i);
 			if (error)
 				goto done;
 			XFS_WANT_CORRUPTED_GOTO(mp, i == 1, done);
-			error = xfs_bmbt_update(bma->cur, left.br_startoff,
+			error = xfs_bmbt_update(cur, left.br_startoff,
 					left.br_startblock,
 					left.br_blockcount +
 						new->br_blockcount,
@@ -3101,25 +2984,25 @@ xfs_bmap_add_extent_hole_real(
 		 * on the right.
 		 * Merge the new allocation with the right neighbor.
 		 */
-		trace_xfs_bmap_pre_update(bma->ip, bma->idx, state, _THIS_IP_);
-		xfs_bmbt_set_allf(xfs_iext_get_ext(ifp, bma->idx),
+		trace_xfs_bmap_pre_update(ip, *idx, state, _THIS_IP_);
+		xfs_bmbt_set_allf(xfs_iext_get_ext(ifp, *idx),
 			new->br_startoff, new->br_startblock,
 			new->br_blockcount + right.br_blockcount,
 			right.br_state);
-		trace_xfs_bmap_post_update(bma->ip, bma->idx, state, _THIS_IP_);
+		trace_xfs_bmap_post_update(ip, *idx, state, _THIS_IP_);
 
-		if (bma->cur == NULL) {
+		if (cur == NULL) {
 			rval = xfs_ilog_fext(whichfork);
 		} else {
 			rval = 0;
-			error = xfs_bmbt_lookup_eq(bma->cur,
+			error = xfs_bmbt_lookup_eq(cur,
 					right.br_startoff,
 					right.br_startblock,
 					right.br_blockcount, &i);
 			if (error)
 				goto done;
 			XFS_WANT_CORRUPTED_GOTO(mp, i == 1, done);
-			error = xfs_bmbt_update(bma->cur, new->br_startoff,
+			error = xfs_bmbt_update(cur, new->br_startoff,
 					new->br_startblock,
 					new->br_blockcount +
 						right.br_blockcount,
@@ -3135,22 +3018,22 @@ xfs_bmap_add_extent_hole_real(
 		 * real allocation.
 		 * Insert a new entry.
 		 */
-		xfs_iext_insert(bma->ip, bma->idx, 1, new, state);
-		XFS_IFORK_NEXT_SET(bma->ip, whichfork,
-			XFS_IFORK_NEXTENTS(bma->ip, whichfork) + 1);
-		if (bma->cur == NULL) {
+		xfs_iext_insert(ip, *idx, 1, new, state);
+		XFS_IFORK_NEXT_SET(ip, whichfork,
+			XFS_IFORK_NEXTENTS(ip, whichfork) + 1);
+		if (cur == NULL) {
 			rval = XFS_ILOG_CORE | xfs_ilog_fext(whichfork);
 		} else {
 			rval = XFS_ILOG_CORE;
-			error = xfs_bmbt_lookup_eq(bma->cur,
+			error = xfs_bmbt_lookup_eq(cur,
 					new->br_startoff,
 					new->br_startblock,
 					new->br_blockcount, &i);
 			if (error)
 				goto done;
 			XFS_WANT_CORRUPTED_GOTO(mp, i == 0, done);
-			bma->cur->bc_rec.b.br_state = new->br_state;
-			error = xfs_btree_insert(bma->cur, &i);
+			cur->bc_rec.b.br_state = new->br_state;
+			error = xfs_btree_insert(cur, &i);
 			if (error)
 				goto done;
 			XFS_WANT_CORRUPTED_GOTO(mp, i == 1, done);
@@ -3159,30 +3042,30 @@ xfs_bmap_add_extent_hole_real(
 	}
 
 	/* add reverse mapping */
-	error = xfs_rmap_map_extent(mp, bma->dfops, bma->ip, whichfork, new);
+	error = xfs_rmap_map_extent(mp, dfops, ip, whichfork, new);
 	if (error)
 		goto done;
 
 	/* convert to a btree if necessary */
-	if (xfs_bmap_needs_btree(bma->ip, whichfork)) {
+	if (xfs_bmap_needs_btree(ip, whichfork)) {
 		int	tmp_logflags;	/* partial log flag return val */
 
-		ASSERT(bma->cur == NULL);
-		error = xfs_bmap_extents_to_btree(bma->tp, bma->ip,
-				bma->firstblock, bma->dfops, &bma->cur,
+		ASSERT(cur == NULL);
+		error = xfs_bmap_extents_to_btree(tp, ip, first, dfops, curp,
 				0, &tmp_logflags, whichfork);
-		bma->logflags |= tmp_logflags;
+		*logflagsp |= tmp_logflags;
+		cur = *curp;
 		if (error)
 			goto done;
 	}
 
 	/* clear out the allocated field, done with it now in any case. */
-	if (bma->cur)
-		bma->cur->bc_private.b.allocated = 0;
+	if (cur)
+		cur->bc_private.b.allocated = 0;
 
-	xfs_bmap_check_leaf_extents(bma->cur, bma->ip, whichfork);
+	xfs_bmap_check_leaf_extents(cur, ip, whichfork);
 done:
-	bma->logflags |= rval;
+	*logflagsp |= rval;
 	return error;
 }
 
@@ -3692,7 +3575,7 @@ xfs_bmap_btalloc(
 		align = xfs_get_cowextsz_hint(ap->ip);
 	else if (xfs_alloc_is_userdata(ap->datatype))
 		align = xfs_get_extsz_hint(ap->ip);
-	if (unlikely(align)) {
+	if (align) {
 		error = xfs_bmap_extsize_align(mp, &ap->got, &ap->prev,
 						align, 0, ap->eof, 0, ap->conv,
 						&ap->offset, &ap->length);
@@ -3764,7 +3647,7 @@ xfs_bmap_btalloc(
 		args.minlen = ap->minlen;
 	}
 	/* apply extent size hints if obtained earlier */
-	if (unlikely(align)) {
+	if (align) {
 		args.prod = align;
 		if ((args.mod = (xfs_extlen_t)do_mod(ap->offset, args.prod)))
 			args.mod = (xfs_extlen_t)(args.prod - args.mod);
@@ -3875,7 +3758,6 @@ xfs_bmap_btalloc(
 		args.fsbno = 0;
 		args.type = XFS_ALLOCTYPE_FIRST_AG;
 		args.total = ap->minlen;
-		args.minleft = 0;
 		if ((error = xfs_alloc_vextent(&args)))
 			return error;
 		ap->dfops->dop_low = true;
@@ -3886,17 +3768,13 @@ xfs_bmap_btalloc(
 		 * the first block that was allocated.
 		 */
 		ASSERT(*ap->firstblock == NULLFSBLOCK ||
-		       XFS_FSB_TO_AGNO(mp, *ap->firstblock) ==
-		       XFS_FSB_TO_AGNO(mp, args.fsbno) ||
-		       (ap->dfops->dop_low &&
-			XFS_FSB_TO_AGNO(mp, *ap->firstblock) <
-			XFS_FSB_TO_AGNO(mp, args.fsbno)));
+		       XFS_FSB_TO_AGNO(mp, *ap->firstblock) <=
+		       XFS_FSB_TO_AGNO(mp, args.fsbno));
 
 		ap->blkno = args.fsbno;
 		if (*ap->firstblock == NULLFSBLOCK)
 			*ap->firstblock = args.fsbno;
-		ASSERT(nullfb || fb_agno == args.agno ||
-		       (ap->dfops->dop_low && fb_agno < args.agno));
+		ASSERT(nullfb || fb_agno <= args.agno);
 		ap->length = args.len;
 		if (!(ap->flags & XFS_BMAPI_COWFORK))
 			ap->ip->i_d.di_nblocks += args.len;
@@ -3919,60 +3797,6 @@ xfs_bmap_btalloc(
 }
 
 /*
- * For a remap operation, just "allocate" an extent at the address that the
- * caller passed in, and ensure that the AGFL is the right size.  The caller
- * will then map the "allocated" extent into the file somewhere.
- */
-STATIC int
-xfs_bmap_remap_alloc(
-	struct xfs_bmalloca	*ap)
-{
-	struct xfs_trans	*tp = ap->tp;
-	struct xfs_mount	*mp = tp->t_mountp;
-	xfs_agblock_t		bno;
-	struct xfs_alloc_arg	args;
-	int			error;
-
-	/*
-	 * validate that the block number is legal - the enables us to detect
-	 * and handle a silent filesystem corruption rather than crashing.
-	 */
-	memset(&args, 0, sizeof(struct xfs_alloc_arg));
-	args.tp = ap->tp;
-	args.mp = ap->tp->t_mountp;
-	bno = *ap->firstblock;
-	args.agno = XFS_FSB_TO_AGNO(mp, bno);
-	args.agbno = XFS_FSB_TO_AGBNO(mp, bno);
-	if (args.agno >= mp->m_sb.sb_agcount ||
-	    args.agbno >= mp->m_sb.sb_agblocks)
-		return -EFSCORRUPTED;
-
-	/* "Allocate" the extent from the range we passed in. */
-	trace_xfs_bmap_remap_alloc(ap->ip, *ap->firstblock, ap->length);
-	ap->blkno = bno;
-	ap->ip->i_d.di_nblocks += ap->length;
-	xfs_trans_log_inode(ap->tp, ap->ip, XFS_ILOG_CORE);
-
-	/* Fix the freelist, like a real allocator does. */
-	args.datatype = ap->datatype;
-	args.pag = xfs_perag_get(args.mp, args.agno);
-	ASSERT(args.pag);
-
-	/*
-	 * The freelist fixing code will decline the allocation if
-	 * the size and shape of the free space doesn't allow for
-	 * allocating the extent and updating all the metadata that
-	 * happens during an allocation.  We're remapping, not
-	 * allocating, so skip that check by pretending to be freeing.
-	 */
-	error = xfs_alloc_fix_freelist(&args, XFS_ALLOC_FLAG_FREEING);
-	xfs_perag_put(args.pag);
-	if (error)
-		trace_xfs_bmap_remap_alloc_error(ap->ip, error, _RET_IP_);
-	return error;
-}
-
-/*
  * xfs_bmap_alloc is called by xfs_bmapi to allocate an extent for a file.
  * It figures out where to ask the underlying allocator to put the new extent.
  */
@@ -3980,8 +3804,6 @@ STATIC int
 xfs_bmap_alloc(
 	struct xfs_bmalloca	*ap)	/* bmap alloc argument struct */
 {
-	if (ap->flags & XFS_BMAPI_REMAP)
-		return xfs_bmap_remap_alloc(ap);
 	if (XFS_IS_REALTIME_INODE(ap->ip) &&
 	    xfs_alloc_is_userdata(ap->datatype))
 		return xfs_bmap_rtalloc(ap);
@@ -4021,6 +3843,17 @@ xfs_trim_extent(
 	}
 }
 
+/* trim extent to within eof */
+void
+xfs_trim_extent_eof(
+	struct xfs_bmbt_irec	*irec,
+	struct xfs_inode	*ip)
+
+{
+	xfs_trim_extent(irec, 0, XFS_B_TO_FSB(ip->i_mount,
+					      i_size_read(VFS_I(ip))));
+}
+
 /*
  * Trim the returned map to the required bounds
  */
@@ -4137,12 +3970,11 @@ xfs_bmapi_read(
 	struct xfs_mount	*mp = ip->i_mount;
 	struct xfs_ifork	*ifp;
 	struct xfs_bmbt_irec	got;
-	struct xfs_bmbt_irec	prev;
 	xfs_fileoff_t		obno;
 	xfs_fileoff_t		end;
-	xfs_extnum_t		lastx;
+	xfs_extnum_t		idx;
 	int			error;
-	int			eof;
+	bool			eof = false;
 	int			n = 0;
 	int			whichfork = xfs_bmapi_whichfork(flags);
 
@@ -4154,7 +3986,7 @@ xfs_bmapi_read(
 	if (unlikely(XFS_TEST_ERROR(
 	    (XFS_IFORK_FORMAT(ip, whichfork) != XFS_DINODE_FMT_EXTENTS &&
 	     XFS_IFORK_FORMAT(ip, whichfork) != XFS_DINODE_FMT_BTREE),
-	     mp, XFS_ERRTAG_BMAPIFORMAT, XFS_RANDOM_BMAPIFORMAT))) {
+	     mp, XFS_ERRTAG_BMAPIFORMAT))) {
 		XFS_ERROR_REPORT("xfs_bmapi_read", XFS_ERRLEVEL_LOW, mp);
 		return -EFSCORRUPTED;
 	}
@@ -4182,7 +4014,8 @@ xfs_bmapi_read(
 			return error;
 	}
 
-	xfs_bmap_search_extents(ip, bno, whichfork, &eof, &lastx, &got, &prev);
+	if (!xfs_iext_lookup_extent(ip, ifp, bno, &idx, &got))
+		eof = true;
 	end = bno + len;
 	obno = bno;
 
@@ -4213,23 +4046,34 @@ xfs_bmapi_read(
 			break;
 
 		/* Else go on to the next record. */
-		if (++lastx < ifp->if_bytes / sizeof(xfs_bmbt_rec_t))
-			xfs_bmbt_get_all(xfs_iext_get_ext(ifp, lastx), &got);
-		else
-			eof = 1;
+		if (!xfs_iext_get_extent(ifp, ++idx, &got))
+			eof = true;
 	}
 	*nmap = n;
 	return 0;
 }
 
+/*
+ * Add a delayed allocation extent to an inode. Blocks are reserved from the
+ * global pool and the extent inserted into the inode in-core extent tree.
+ *
+ * On entry, got refers to the first extent beyond the offset of the extent to
+ * allocate or eof is specified if no such extent exists. On return, got refers
+ * to the extent record that was inserted to the inode fork.
+ *
+ * Note that the allocated extent may have been merged with contiguous extents
+ * during insertion into the inode fork. Thus, got does not reflect the current
+ * state of the inode fork on return. If necessary, the caller can use lastx to
+ * look up the updated record in the inode fork.
+ */
 int
 xfs_bmapi_reserve_delalloc(
 	struct xfs_inode	*ip,
 	int			whichfork,
-	xfs_fileoff_t		aoff,
+	xfs_fileoff_t		off,
 	xfs_filblks_t		len,
+	xfs_filblks_t		prealloc,
 	struct xfs_bmbt_irec	*got,
-	struct xfs_bmbt_irec	*prev,
 	xfs_extnum_t		*lastx,
 	int			eof)
 {
@@ -4240,10 +4084,17 @@ xfs_bmapi_reserve_delalloc(
 	char			rt = XFS_IS_REALTIME_INODE(ip);
 	xfs_extlen_t		extsz;
 	int			error;
+	xfs_fileoff_t		aoff = off;
 
-	alen = XFS_FILBLKS_MIN(len, MAXEXTLEN);
+	/*
+	 * Cap the alloc length. Keep track of prealloc so we know whether to
+	 * tag the inode before we return.
+	 */
+	alen = XFS_FILBLKS_MIN(len + prealloc, MAXEXTLEN);
 	if (!eof)
 		alen = XFS_FILBLKS_MIN(alen, got->br_startoff - aoff);
+	if (prealloc && alen >= len)
+		prealloc = alen - len;
 
 	/* Figure out the extent size, adjust alen */
 	if (whichfork == XFS_COW_FORK)
@@ -4251,7 +4102,12 @@ xfs_bmapi_reserve_delalloc(
 	else
 		extsz = xfs_get_extsz_hint(ip);
 	if (extsz) {
-		error = xfs_bmap_extsize_align(mp, got, prev, extsz, rt, eof,
+		struct xfs_bmbt_irec	prev;
+
+		if (!xfs_iext_get_extent(ifp, *lastx - 1, &prev))
+			prev.br_startoff = NULLFILEOFF;
+
+		error = xfs_bmap_extsize_align(mp, got, &prev, extsz, rt, eof,
 					       1, 0, &aoff, &alen);
 		ASSERT(!error);
 	}
@@ -4296,18 +4152,19 @@ xfs_bmapi_reserve_delalloc(
 	got->br_startblock = nullstartblock(indlen);
 	got->br_blockcount = alen;
 	got->br_state = XFS_EXT_NORM;
+
 	xfs_bmap_add_extent_hole_delay(ip, whichfork, lastx, got);
 
 	/*
-	 * Update our extent pointer, given that xfs_bmap_add_extent_hole_delay
-	 * might have merged it into one of the neighbouring ones.
-	 */
-	xfs_bmbt_get_all(xfs_iext_get_ext(ifp, *lastx), got);
+	 * Tag the inode if blocks were preallocated. Note that COW fork
+	 * preallocation can occur at the start or end of the extent, even when
+	 * prealloc == 0, so we must also check the aligned offset and length.
+	 */
+	if (whichfork == XFS_DATA_FORK && prealloc)
+		xfs_inode_set_eofblocks_tag(ip);
+	if (whichfork == XFS_COW_FORK && (prealloc || aoff < off || alen > len))
+		xfs_inode_set_cowblocks_tag(ip);
 
-	ASSERT(got->br_startoff <= aoff);
-	ASSERT(got->br_startoff + got->br_blockcount >= aoff + alen);
-	ASSERT(isnullstartblock(got->br_startblock));
-	ASSERT(got->br_state == XFS_EXT_NORM);
 	return 0;
 
 out_unreserve_blocks:
@@ -4341,7 +4198,7 @@ xfs_bmapi_allocate(
 	if (bma->wasdel) {
 		bma->length = (xfs_extlen_t)bma->got.br_blockcount;
 		bma->offset = bma->got.br_startoff;
-		if (bma->idx != NULLEXTNUM && bma->idx) {
+		if (bma->idx) {
 			xfs_bmbt_get_all(xfs_iext_get_ext(ifp, bma->idx - 1),
 					 &bma->prev);
 		}
@@ -4387,8 +4244,6 @@ xfs_bmapi_allocate(
 	if (error)
 		return error;
 
-	if (bma->dfops->dop_low)
-		bma->minleft = 0;
 	if (bma->cur)
 		bma->cur->bc_private.b.firstblock = *bma->firstblock;
 	if (bma->blkno == NULLFSBLOCK)
@@ -4414,17 +4269,25 @@ xfs_bmapi_allocate(
 	bma->got.br_state = XFS_EXT_NORM;
 
 	/*
-	 * A wasdelay extent has been initialized, so shouldn't be flagged
-	 * as unwritten.
+	 * In the data fork, a wasdelay extent has been initialized, so
+	 * shouldn't be flagged as unwritten.
+	 *
+	 * For the cow fork, however, we convert delalloc reservations
+	 * (extents allocated for speculative preallocation) to
+	 * allocated unwritten extents, and only convert the unwritten
+	 * extents to real extents when we're about to write the data.
 	 */
-	if (!bma->wasdel && (bma->flags & XFS_BMAPI_PREALLOC) &&
+	if ((!bma->wasdel || (bma->flags & XFS_BMAPI_COWFORK)) &&
+	    (bma->flags & XFS_BMAPI_PREALLOC) &&
 	    xfs_sb_version_hasextflgbit(&mp->m_sb))
 		bma->got.br_state = XFS_EXT_UNWRITTEN;
 
 	if (bma->wasdel)
 		error = xfs_bmap_add_extent_delay_real(bma, whichfork);
 	else
-		error = xfs_bmap_add_extent_hole_real(bma, whichfork);
+		error = xfs_bmap_add_extent_hole_real(bma->tp, bma->ip,
+				whichfork, &bma->idx, &bma->cur, &bma->got,
+				bma->firstblock, bma->dfops, &bma->logflags);
 
 	bma->logflags |= tmp_logflags;
 	if (error)
@@ -4468,8 +4331,6 @@ xfs_bmapi_convert_unwritten(
 			(XFS_BMAPI_PREALLOC | XFS_BMAPI_CONVERT))
 		return 0;
 
-	ASSERT(whichfork != XFS_COW_FORK);
-
 	/*
 	 * Modify (by adding) the state flag, if writing.
 	 */
@@ -4494,8 +4355,8 @@ xfs_bmapi_convert_unwritten(
 			return error;
 	}
 
-	error = xfs_bmap_add_extent_unwritten_real(bma->tp, bma->ip, &bma->idx,
-			&bma->cur, mval, bma->firstblock, bma->dfops,
+	error = xfs_bmap_add_extent_unwritten_real(bma->tp, bma->ip, whichfork,
+			&bma->idx, &bma->cur, mval, bma->firstblock, bma->dfops,
 			&tmp_logflags);
 	/*
 	 * Log the inode core unconditionally in the unwritten extent conversion
@@ -4504,8 +4365,12 @@ xfs_bmapi_convert_unwritten(
 	 * in the transaction for the sake of fsync(), even if nothing has
 	 * changed, because fsync() will not force the log for this transaction
 	 * unless it sees the inode pinned.
+	 *
+	 * Note: If we're only converting cow fork extents, there aren't
+	 * any on-disk updates to make, so we don't need to log anything.
 	 */
-	bma->logflags |= tmp_logflags | XFS_ILOG_CORE;
+	if (whichfork != XFS_COW_FORK)
+		bma->logflags |= tmp_logflags | XFS_ILOG_CORE;
 	if (error)
 		return error;
 
@@ -4555,13 +4420,11 @@ xfs_bmapi_write(
 	struct xfs_ifork	*ifp;
 	struct xfs_bmalloca	bma = { NULL };	/* args for xfs_bmap_alloc */
 	xfs_fileoff_t		end;		/* end of mapped file region */
-	int			eof;		/* after the end of extents */
+	bool			eof = false;	/* after the end of extents */
 	int			error;		/* error return */
 	int			n;		/* current extent index */
 	xfs_fileoff_t		obno;		/* old block number (offset) */
 	int			whichfork;	/* data or attr fork */
-	char			inhole;		/* current location is hole in file */
-	char			wasdelay;	/* old extent was delayed */
 
 #ifdef DEBUG
 	xfs_fileoff_t		orig_bno;	/* original block number value */
@@ -4581,15 +4444,13 @@ xfs_bmapi_write(
 	ASSERT(*nmap >= 1);
 	ASSERT(*nmap <= XFS_BMAP_MAX_NMAP);
 	ASSERT(!(flags & XFS_BMAPI_IGSTATE));
-	ASSERT(tp != NULL);
+	ASSERT(tp != NULL ||
+	       (flags & (XFS_BMAPI_CONVERT | XFS_BMAPI_COWFORK)) ==
+			(XFS_BMAPI_CONVERT | XFS_BMAPI_COWFORK));
 	ASSERT(len > 0);
 	ASSERT(XFS_IFORK_FORMAT(ip, whichfork) != XFS_DINODE_FMT_LOCAL);
 	ASSERT(xfs_isilocked(ip, XFS_ILOCK_EXCL));
-	ASSERT(!(flags & XFS_BMAPI_REMAP) || whichfork == XFS_DATA_FORK);
-	ASSERT(!(flags & XFS_BMAPI_PREALLOC) || !(flags & XFS_BMAPI_REMAP));
-	ASSERT(!(flags & XFS_BMAPI_CONVERT) || !(flags & XFS_BMAPI_REMAP));
-	ASSERT(!(flags & XFS_BMAPI_PREALLOC) || whichfork != XFS_COW_FORK);
-	ASSERT(!(flags & XFS_BMAPI_CONVERT) || whichfork != XFS_COW_FORK);
+	ASSERT(!(flags & XFS_BMAPI_REMAP));
 
 	/* zeroing is for currently only for data extents, not metadata */
 	ASSERT((flags & (XFS_BMAPI_METADATA | XFS_BMAPI_ZERO)) !=
@@ -4606,7 +4467,7 @@ xfs_bmapi_write(
 	if (unlikely(XFS_TEST_ERROR(
 	    (XFS_IFORK_FORMAT(ip, whichfork) != XFS_DINODE_FMT_EXTENTS &&
 	     XFS_IFORK_FORMAT(ip, whichfork) != XFS_DINODE_FMT_BTREE),
-	     mp, XFS_ERRTAG_BMAPIFORMAT, XFS_RANDOM_BMAPIFORMAT))) {
+	     mp, XFS_ERRTAG_BMAPIFORMAT))) {
 		XFS_ERROR_REPORT("xfs_bmapi_write", XFS_ERRLEVEL_LOW, mp);
 		return -EFSCORRUPTED;
 	}
@@ -4633,12 +4494,14 @@ xfs_bmapi_write(
 			goto error0;
 	}
 
-	xfs_bmap_search_extents(ip, bno, whichfork, &eof, &bma.idx, &bma.got,
-				&bma.prev);
 	n = 0;
 	end = bno + len;
 	obno = bno;
 
+	if (!xfs_iext_lookup_extent(ip, ifp, bno, &bma.idx, &bma.got))
+		eof = true;
+	if (!xfs_iext_get_extent(ifp, bma.idx - 1, &bma.prev))
+		bma.prev.br_startoff = NULLFILEOFF;
 	bma.tp = tp;
 	bma.ip = ip;
 	bma.total = total;
@@ -4647,22 +4510,39 @@ xfs_bmapi_write(
 	bma.firstblock = firstblock;
 
 	while (bno < end && n < *nmap) {
-		inhole = eof || bma.got.br_startoff > bno;
-		wasdelay = !inhole && isnullstartblock(bma.got.br_startblock);
+		bool			need_alloc = false, wasdelay = false;
 
-		/*
-		 * Make sure we only reflink into a hole.
-		 */
-		if (flags & XFS_BMAPI_REMAP)
-			ASSERT(inhole);
-		if (flags & XFS_BMAPI_COWFORK)
-			ASSERT(!inhole);
+		/* in hole or beyoned EOF? */
+		if (eof || bma.got.br_startoff > bno) {
+			if (flags & XFS_BMAPI_DELALLOC) {
+				/*
+				 * For the COW fork we can reasonably get a
+				 * request for converting an extent that races
+				 * with other threads already having converted
+				 * part of it, as there converting COW to
+				 * regular blocks is not protected using the
+				 * IOLOCK.
+				 */
+				ASSERT(flags & XFS_BMAPI_COWFORK);
+				if (!(flags & XFS_BMAPI_COWFORK)) {
+					error = -EIO;
+					goto error0;
+				}
+
+				if (eof || bno >= end)
+					break;
+			} else {
+				need_alloc = true;
+			}
+		} else if (isnullstartblock(bma.got.br_startblock)) {
+			wasdelay = true;
+		}
 
 		/*
 		 * First, deal with the hole before the allocated space
 		 * that we found, if any.
 		 */
-		if (inhole || wasdelay) {
+		if (need_alloc || wasdelay) {
 			bma.eof = eof;
 			bma.conv = !!(flags & XFS_BMAPI_CONVERT);
 			bma.wasdel = wasdelay;
@@ -4725,11 +4605,8 @@ xfs_bmapi_write(
 
 		/* Else go on to the next record. */
 		bma.prev = bma.got;
-		if (++bma.idx < ifp->if_bytes / sizeof(xfs_bmbt_rec_t)) {
-			xfs_bmbt_get_all(xfs_iext_get_ext(ifp, bma.idx),
-					 &bma.got);
-		} else
-			eof = 1;
+		if (!xfs_iext_get_extent(ifp, ++bma.idx, &bma.got))
+			eof = true;
 	}
 	*nmap = n;
 
@@ -4773,13 +4650,9 @@ error0:
 	if (bma.cur) {
 		if (!error) {
 			ASSERT(*firstblock == NULLFSBLOCK ||
-			       XFS_FSB_TO_AGNO(mp, *firstblock) ==
+			       XFS_FSB_TO_AGNO(mp, *firstblock) <=
 			       XFS_FSB_TO_AGNO(mp,
-				       bma.cur->bc_private.b.firstblock) ||
-			       (dfops->dop_low &&
-				XFS_FSB_TO_AGNO(mp, *firstblock) <
-				XFS_FSB_TO_AGNO(mp,
-					bma.cur->bc_private.b.firstblock)));
+				       bma.cur->bc_private.b.firstblock));
 			*firstblock = bma.cur->bc_private.b.firstblock;
 		}
 		xfs_btree_del_cursor(bma.cur,
@@ -4791,6 +4664,93 @@ error0:
 	return error;
 }
 
+static int
+xfs_bmapi_remap(
+	struct xfs_trans	*tp,
+	struct xfs_inode	*ip,
+	xfs_fileoff_t		bno,
+	xfs_filblks_t		len,
+	xfs_fsblock_t		startblock,
+	struct xfs_defer_ops	*dfops)
+{
+	struct xfs_mount	*mp = ip->i_mount;
+	struct xfs_ifork	*ifp = XFS_IFORK_PTR(ip, XFS_DATA_FORK);
+	struct xfs_btree_cur	*cur = NULL;
+	xfs_fsblock_t		firstblock = NULLFSBLOCK;
+	struct xfs_bmbt_irec	got;
+	xfs_extnum_t		idx;
+	int			logflags = 0, error;
+
+	ASSERT(len > 0);
+	ASSERT(len <= (xfs_filblks_t)MAXEXTLEN);
+	ASSERT(xfs_isilocked(ip, XFS_ILOCK_EXCL));
+
+	if (unlikely(XFS_TEST_ERROR(
+	    (XFS_IFORK_FORMAT(ip, XFS_DATA_FORK) != XFS_DINODE_FMT_EXTENTS &&
+	     XFS_IFORK_FORMAT(ip, XFS_DATA_FORK) != XFS_DINODE_FMT_BTREE),
+	     mp, XFS_ERRTAG_BMAPIFORMAT))) {
+		XFS_ERROR_REPORT("xfs_bmapi_remap", XFS_ERRLEVEL_LOW, mp);
+		return -EFSCORRUPTED;
+	}
+
+	if (XFS_FORCED_SHUTDOWN(mp))
+		return -EIO;
+
+	if (!(ifp->if_flags & XFS_IFEXTENTS)) {
+		error = xfs_iread_extents(NULL, ip, XFS_DATA_FORK);
+		if (error)
+			return error;
+	}
+
+	if (xfs_iext_lookup_extent(ip, ifp, bno, &idx, &got)) {
+		/* make sure we only reflink into a hole. */
+		ASSERT(got.br_startoff > bno);
+		ASSERT(got.br_startoff - bno >= len);
+	}
+
+	ip->i_d.di_nblocks += len;
+	xfs_trans_log_inode(tp, ip, XFS_ILOG_CORE);
+
+	if (ifp->if_flags & XFS_IFBROOT) {
+		cur = xfs_bmbt_init_cursor(mp, tp, ip, XFS_DATA_FORK);
+		cur->bc_private.b.firstblock = firstblock;
+		cur->bc_private.b.dfops = dfops;
+		cur->bc_private.b.flags = 0;
+	}
+
+	got.br_startoff = bno;
+	got.br_startblock = startblock;
+	got.br_blockcount = len;
+	got.br_state = XFS_EXT_NORM;
+
+	error = xfs_bmap_add_extent_hole_real(tp, ip, XFS_DATA_FORK, &idx, &cur,
+			&got, &firstblock, dfops, &logflags);
+	if (error)
+		goto error0;
+
+	if (xfs_bmap_wants_extents(ip, XFS_DATA_FORK)) {
+		int		tmp_logflags = 0;
+
+		error = xfs_bmap_btree_to_extents(tp, ip, cur,
+			&tmp_logflags, XFS_DATA_FORK);
+		logflags |= tmp_logflags;
+	}
+
+error0:
+	if (ip->i_d.di_format != XFS_DINODE_FMT_EXTENTS)
+		logflags &= ~XFS_ILOG_DEXT;
+	else if (ip->i_d.di_format != XFS_DINODE_FMT_BTREE)
+		logflags &= ~XFS_ILOG_DBROOT;
+
+	if (logflags)
+		xfs_trans_log_inode(tp, ip, logflags);
+	if (cur) {
+		xfs_btree_del_cursor(cur,
+				error ? XFS_BTREE_ERROR : XFS_BTREE_NOERROR);
+	}
+	return error;
+}
+
 /*
  * When a delalloc extent is split (e.g., due to a hole punch), the original
  * indlen reservation must be shared across the two new extents that are left
@@ -4814,34 +4774,59 @@ xfs_bmap_split_indlen(
 	xfs_filblks_t			len2 = *indlen2;
 	xfs_filblks_t			nres = len1 + len2; /* new total res. */
 	xfs_filblks_t			stolen = 0;
+	xfs_filblks_t			resfactor;
 
 	/*
 	 * Steal as many blocks as we can to try and satisfy the worst case
 	 * indlen for both new extents.
 	 */
-	while (nres > ores && avail) {
-		nres--;
-		avail--;
-		stolen++;
-	}
-
-	/*
-	 * The only blocks available are those reserved for the original
-	 * extent and what we can steal from the extent being removed.
-	 * If this still isn't enough to satisfy the combined
-	 * requirements for the two new extents, skim blocks off of each
-	 * of the new reservations until they match what is available.
-	 */
-	while (nres > ores) {
-		if (len1) {
-			len1--;
-			nres--;
+	if (ores < nres && avail)
+		stolen = XFS_FILBLKS_MIN(nres - ores, avail);
+	ores += stolen;
+
+	 /* nothing else to do if we've satisfied the new reservation */
+	if (ores >= nres)
+		return stolen;
+
+	/*
+	 * We can't meet the total required reservation for the two extents.
+	 * Calculate the percent of the overall shortage between both extents
+	 * and apply this percentage to each of the requested indlen values.
+	 * This distributes the shortage fairly and reduces the chances that one
+	 * of the two extents is left with nothing when extents are repeatedly
+	 * split.
+	 */
+	resfactor = (ores * 100);
+	do_div(resfactor, nres);
+	len1 *= resfactor;
+	do_div(len1, 100);
+	len2 *= resfactor;
+	do_div(len2, 100);
+	ASSERT(len1 + len2 <= ores);
+	ASSERT(len1 < *indlen1 && len2 < *indlen2);
+
+	/*
+	 * Hand out the remainder to each extent. If one of the two reservations
+	 * is zero, we want to make sure that one gets a block first. The loop
+	 * below starts with len1, so hand len2 a block right off the bat if it
+	 * is zero.
+	 */
+	ores -= (len1 + len2);
+	ASSERT((*indlen1 - len1) + (*indlen2 - len2) >= ores);
+	if (ores && !len2 && *indlen2) {
+		len2++;
+		ores--;
+	}
+	while (ores) {
+		if (len1 < *indlen1) {
+			len1++;
+			ores--;
 		}
-		if (nres == ores)
+		if (!ores)
 			break;
-		if (len2) {
-			len2--;
-			nres--;
+		if (len2 < *indlen2) {
+			len2++;
+			ores--;
 		}
 	}
 
@@ -4877,13 +4862,13 @@ xfs_bmap_del_extent_delay(
 	da_new = 0;
 
 	ASSERT(*idx >= 0);
-	ASSERT(*idx < ifp->if_bytes / sizeof(struct xfs_bmbt_rec));
+	ASSERT(*idx <= xfs_iext_count(ifp));
 	ASSERT(del->br_blockcount > 0);
 	ASSERT(got->br_startoff <= del->br_startoff);
 	ASSERT(got_endoff >= del_endoff);
 
 	if (isrt) {
-		int64_t rtexts = XFS_FSB_TO_B(mp, del->br_blockcount);
+		uint64_t rtexts = XFS_FSB_TO_B(mp, del->br_blockcount);
 
 		do_div(rtexts, mp->m_sb.sb_rextsize);
 		xfs_mod_frextents(mp, rtexts);
@@ -4897,6 +4882,8 @@ xfs_bmap_del_extent_delay(
 	error = xfs_trans_reserve_quota_nblks(NULL, ip,
 			-((long)del->br_blockcount), 0,
 			isrt ? XFS_QMOPT_RES_RTBLKS : XFS_QMOPT_RES_REGBLKS);
+	if (error)
+		return error;
 	ip->i_delayed_blks -= del->br_blockcount;
 
 	if (whichfork == XFS_COW_FORK)
@@ -4925,7 +4912,7 @@ xfs_bmap_del_extent_delay(
 		da_new = XFS_FILBLKS_MIN(xfs_bmap_worst_indlen(ip,
 				got->br_blockcount), da_old);
 		got->br_startblock = nullstartblock((int)da_new);
-		xfs_bmbt_set_all(xfs_iext_get_ext(ifp, *idx), got);
+		xfs_iext_update_extent(ifp, *idx, got);
 		trace_xfs_bmap_post_update(ip, *idx, state, _THIS_IP_);
 		break;
 	case BMAP_RIGHT_CONTIG:
@@ -4937,7 +4924,7 @@ xfs_bmap_del_extent_delay(
 		da_new = XFS_FILBLKS_MIN(xfs_bmap_worst_indlen(ip,
 				got->br_blockcount), da_old);
 		got->br_startblock = nullstartblock((int)da_new);
-		xfs_bmbt_set_all(xfs_iext_get_ext(ifp, *idx), got);
+		xfs_iext_update_extent(ifp, *idx, got);
 		trace_xfs_bmap_post_update(ip, *idx, state, _THIS_IP_);
 		break;
 	case 0:
@@ -4963,7 +4950,7 @@ xfs_bmap_del_extent_delay(
 						       del->br_blockcount);
 
 		got->br_startblock = nullstartblock((int)got_indlen);
-		xfs_bmbt_set_all(xfs_iext_get_ext(ifp, *idx), got);
+		xfs_iext_update_extent(ifp, *idx, got);
 		trace_xfs_bmap_post_update(ip, *idx, 0, _THIS_IP_);
 
 		new.br_startoff = del_endoff;
@@ -5006,7 +4993,7 @@ xfs_bmap_del_extent_cow(
 	got_endoff = got->br_startoff + got->br_blockcount;
 
 	ASSERT(*idx >= 0);
-	ASSERT(*idx < ifp->if_bytes / sizeof(struct xfs_bmbt_rec));
+	ASSERT(*idx <= xfs_iext_count(ifp));
 	ASSERT(del->br_blockcount > 0);
 	ASSERT(got->br_startoff <= del->br_startoff);
 	ASSERT(got_endoff >= del_endoff);
@@ -5033,7 +5020,7 @@ xfs_bmap_del_extent_cow(
 		got->br_startoff = del_endoff;
 		got->br_blockcount -= del->br_blockcount;
 		got->br_startblock = del->br_startblock + del->br_blockcount;
-		xfs_bmbt_set_all(xfs_iext_get_ext(ifp, *idx), got);
+		xfs_iext_update_extent(ifp, *idx, got);
 		trace_xfs_bmap_post_update(ip, *idx, state, _THIS_IP_);
 		break;
 	case BMAP_RIGHT_CONTIG:
@@ -5042,7 +5029,7 @@ xfs_bmap_del_extent_cow(
 		 */
 		trace_xfs_bmap_pre_update(ip, *idx, state, _THIS_IP_);
 		got->br_blockcount -= del->br_blockcount;
-		xfs_bmbt_set_all(xfs_iext_get_ext(ifp, *idx), got);
+		xfs_iext_update_extent(ifp, *idx, got);
 		trace_xfs_bmap_post_update(ip, *idx, state, _THIS_IP_);
 		break;
 	case 0:
@@ -5051,7 +5038,7 @@ xfs_bmap_del_extent_cow(
 		 */
 		trace_xfs_bmap_pre_update(ip, *idx, state, _THIS_IP_);
 		got->br_blockcount = del->br_startoff - got->br_startoff;
-		xfs_bmbt_set_all(xfs_iext_get_ext(ifp, *idx), got);
+		xfs_iext_update_extent(ifp, *idx, got);
 		trace_xfs_bmap_post_update(ip, *idx, state, _THIS_IP_);
 
 		new.br_startoff = del_endoff;
@@ -5112,8 +5099,7 @@ xfs_bmap_del_extent(
 		state |= BMAP_COWFORK;
 
 	ifp = XFS_IFORK_PTR(ip, whichfork);
-	ASSERT((*idx >= 0) && (*idx < ifp->if_bytes /
-		(uint)sizeof(xfs_bmbt_rec_t)));
+	ASSERT((*idx >= 0) && (*idx < xfs_iext_count(ifp)));
 	ASSERT(del->br_blockcount > 0);
 	ep = xfs_iext_get_ext(ifp, *idx);
 	xfs_bmbt_get_all(ep, &got);
@@ -5427,8 +5413,6 @@ __xfs_bunmapi(
 {
 	xfs_btree_cur_t		*cur;		/* bmap btree cursor */
 	xfs_bmbt_irec_t		del;		/* extent being deleted */
-	int			eof;		/* is deleting at eof */
-	xfs_bmbt_rec_host_t	*ep;		/* extent record pointer */
 	int			error;		/* error return value */
 	xfs_extnum_t		extno;		/* extent number in list */
 	xfs_bmbt_irec_t		got;		/* current extent record */
@@ -5438,14 +5422,14 @@ __xfs_bunmapi(
 	int			logflags;	/* transaction logging flags */
 	xfs_extlen_t		mod;		/* rt extent offset */
 	xfs_mount_t		*mp;		/* mount structure */
-	xfs_extnum_t		nextents;	/* number of file extents */
-	xfs_bmbt_irec_t		prev;		/* previous extent record */
 	xfs_fileoff_t		start;		/* first file offset deleted */
 	int			tmp_logflags;	/* partial logging flags */
 	int			wasdel;		/* was a delayed alloc extent */
 	int			whichfork;	/* data or attribute fork */
 	xfs_fsblock_t		sum;
 	xfs_filblks_t		len = *rlen;	/* length to unmap in file */
+	xfs_fileoff_t		max_len;
+	xfs_agnumber_t		prev_agno = NULLAGNUMBER, agno;
 
 	trace_xfs_bunmap(ip, bno, len, flags, _RET_IP_);
 
@@ -5467,11 +5451,20 @@ __xfs_bunmapi(
 	ASSERT(len > 0);
 	ASSERT(nexts >= 0);
 
+	/*
+	 * Guesstimate how many blocks we can unmap without running the risk of
+	 * blowing out the transaction with a mix of EFIs and reflink
+	 * adjustments.
+	 */
+	if (xfs_is_reflink_inode(ip) && whichfork == XFS_DATA_FORK)
+		max_len = min(len, xfs_refcount_max_unmap(tp->t_log_res));
+	else
+		max_len = len;
+
 	if (!(ifp->if_flags & XFS_IFEXTENTS) &&
 	    (error = xfs_iread_extents(tp, ip, whichfork)))
 		return error;
-	nextents = ifp->if_bytes / (uint)sizeof(xfs_bmbt_rec_t);
-	if (nextents == 0) {
+	if (xfs_iext_count(ifp) == 0) {
 		*rlen = 0;
 		return 0;
 	}
@@ -5479,18 +5472,17 @@ __xfs_bunmapi(
 	isrt = (whichfork == XFS_DATA_FORK) && XFS_IS_REALTIME_INODE(ip);
 	start = bno;
 	bno = start + len - 1;
-	ep = xfs_bmap_search_extents(ip, bno, whichfork, &eof, &lastx, &got,
-		&prev);
 
 	/*
 	 * Check to see if the given block number is past the end of the
 	 * file, back up to the last block if so...
 	 */
-	if (eof) {
-		ep = xfs_iext_get_ext(ifp, --lastx);
-		xfs_bmbt_get_all(ep, &got);
+	if (!xfs_iext_lookup_extent(ip, ifp, bno, &lastx, &got)) {
+		ASSERT(lastx > 0);
+		xfs_iext_get_extent(ifp, --lastx, &got);
 		bno = got.br_startoff + got.br_blockcount - 1;
 	}
+
 	logflags = 0;
 	if (ifp->if_flags & XFS_IFBROOT) {
 		ASSERT(XFS_IFORK_FORMAT(ip, whichfork) == XFS_DINODE_FMT_BTREE);
@@ -5513,7 +5505,7 @@ __xfs_bunmapi(
 
 	extno = 0;
 	while (bno != (xfs_fileoff_t)-1 && bno >= start && lastx >= 0 &&
-	       (nexts == 0 || extno < nexts)) {
+	       (nexts == 0 || extno < nexts) && max_len > 0) {
 		/*
 		 * Is the found extent after a hole in which bno lives?
 		 * Just back up to the previous extent, if so.
@@ -5521,8 +5513,7 @@ __xfs_bunmapi(
 		if (got.br_startoff > bno) {
 			if (--lastx < 0)
 				break;
-			ep = xfs_iext_get_ext(ifp, lastx);
-			xfs_bmbt_get_all(ep, &got);
+			xfs_iext_get_extent(ifp, lastx, &got);
 		}
 		/*
 		 * Is the last block of this extent before the range
@@ -5536,9 +5527,19 @@ __xfs_bunmapi(
 		 * Then deal with the (possibly delayed) allocated space
 		 * we found.
 		 */
-		ASSERT(ep != NULL);
 		del = got;
 		wasdel = isnullstartblock(del.br_startblock);
+
+		/*
+		 * Make sure we don't touch multiple AGF headers out of order
+		 * in a single transaction, as that could cause AB-BA deadlocks.
+		 */
+		if (!wasdel) {
+			agno = XFS_FSB_TO_AGNO(mp, del.br_startblock);
+			if (prev_agno != NULLAGNUMBER && prev_agno > agno)
+				break;
+			prev_agno = agno;
+		}
 		if (got.br_startoff < start) {
 			del.br_startoff = start;
 			del.br_blockcount -= start - got.br_startoff;
@@ -5547,6 +5548,15 @@ __xfs_bunmapi(
 		}
 		if (del.br_startoff + del.br_blockcount > bno + 1)
 			del.br_blockcount = bno + 1 - del.br_startoff;
+
+		/* How much can we safely unmap? */
+		if (max_len < del.br_blockcount) {
+			del.br_startoff += del.br_blockcount - max_len;
+			if (!wasdel)
+				del.br_startblock += del.br_blockcount - max_len;
+			del.br_blockcount = max_len;
+		}
+
 		sum = del.br_startblock + del.br_blockcount;
 		if (isrt &&
 		    (mod = do_mod(sum, mp->m_sb.sb_rextsize))) {
@@ -5590,8 +5600,8 @@ __xfs_bunmapi(
 			}
 			del.br_state = XFS_EXT_UNWRITTEN;
 			error = xfs_bmap_add_extent_unwritten_real(tp, ip,
-					&lastx, &cur, &del, firstblock, dfops,
-					&logflags);
+					whichfork, &lastx, &cur, &del,
+					firstblock, dfops, &logflags);
 			if (error)
 				goto error0;
 			goto nodelete;
@@ -5617,15 +5627,12 @@ __xfs_bunmapi(
 				 */
 				ASSERT(bno >= del.br_blockcount);
 				bno -= del.br_blockcount;
-				if (got.br_startoff > bno) {
-					if (--lastx >= 0) {
-						ep = xfs_iext_get_ext(ifp,
-								      lastx);
-						xfs_bmbt_get_all(ep, &got);
-					}
-				}
+				if (got.br_startoff > bno && --lastx >= 0)
+					xfs_iext_get_extent(ifp, lastx, &got);
 				continue;
 			} else if (del.br_state == XFS_EXT_UNWRITTEN) {
+				struct xfs_bmbt_irec	prev;
+
 				/*
 				 * This one is already unwritten.
 				 * It must have a written left neighbor.
@@ -5633,8 +5640,7 @@ __xfs_bunmapi(
 				 * try again.
 				 */
 				ASSERT(lastx > 0);
-				xfs_bmbt_get_all(xfs_iext_get_ext(ifp,
-						lastx - 1), &prev);
+				xfs_iext_get_extent(ifp, lastx - 1, &prev);
 				ASSERT(prev.br_state == XFS_EXT_NORM);
 				ASSERT(!isnullstartblock(prev.br_startblock));
 				ASSERT(del.br_startblock ==
@@ -5648,8 +5654,9 @@ __xfs_bunmapi(
 				prev.br_state = XFS_EXT_UNWRITTEN;
 				lastx--;
 				error = xfs_bmap_add_extent_unwritten_real(tp,
-						ip, &lastx, &cur, &prev,
-						firstblock, dfops, &logflags);
+						ip, whichfork, &lastx, &cur,
+						&prev, firstblock, dfops,
+						&logflags);
 				if (error)
 					goto error0;
 				goto nodelete;
@@ -5657,8 +5664,9 @@ __xfs_bunmapi(
 				ASSERT(del.br_state == XFS_EXT_NORM);
 				del.br_state = XFS_EXT_UNWRITTEN;
 				error = xfs_bmap_add_extent_unwritten_real(tp,
-						ip, &lastx, &cur, &del,
-						firstblock, dfops, &logflags);
+						ip, whichfork, &lastx, &cur,
+						&del, firstblock, dfops,
+						&logflags);
 				if (error)
 					goto error0;
 				goto nodelete;
@@ -5725,6 +5733,7 @@ __xfs_bunmapi(
 		if (!isrt && wasdel)
 			xfs_mod_fdblocks(mp, (int64_t)del.br_blockcount, false);
 
+		max_len -= del.br_blockcount;
 		bno = del.br_startoff - 1;
 nodelete:
 		/*
@@ -5732,13 +5741,9 @@ nodelete:
 		 */
 		if (bno != (xfs_fileoff_t)-1 && bno >= start) {
 			if (lastx >= 0) {
-				ep = xfs_iext_get_ext(ifp, lastx);
-				if (xfs_bmbt_get_startoff(ep) > bno) {
-					if (--lastx >= 0)
-						ep = xfs_iext_get_ext(ifp,
-								      lastx);
-				}
-				xfs_bmbt_get_all(ep, &got);
+				xfs_iext_get_extent(ifp, lastx, &got);
+				if (got.br_startoff > bno && --lastx >= 0)
+					xfs_iext_get_extent(ifp, lastx, &got);
 			}
 			extno++;
 		}
@@ -5865,32 +5870,26 @@ xfs_bmse_merge(
 	int				whichfork,
 	xfs_fileoff_t			shift,		/* shift fsb */
 	int				current_ext,	/* idx of gotp */
-	struct xfs_bmbt_rec_host	*gotp,		/* extent to shift */
-	struct xfs_bmbt_rec_host	*leftp,		/* preceding extent */
+	struct xfs_bmbt_irec		*got,		/* extent to shift */
+	struct xfs_bmbt_irec		*left,		/* preceding extent */
 	struct xfs_btree_cur		*cur,
-	int				*logflags)	/* output */
+	int				*logflags,	/* output */
+	struct xfs_defer_ops		*dfops)
 {
-	struct xfs_bmbt_irec		got;
-	struct xfs_bmbt_irec		left;
+	struct xfs_ifork		*ifp = XFS_IFORK_PTR(ip, whichfork);
+	struct xfs_bmbt_irec		new;
 	xfs_filblks_t			blockcount;
 	int				error, i;
 	struct xfs_mount		*mp = ip->i_mount;
 
-	xfs_bmbt_get_all(gotp, &got);
-	xfs_bmbt_get_all(leftp, &left);
-	blockcount = left.br_blockcount + got.br_blockcount;
+	blockcount = left->br_blockcount + got->br_blockcount;
 
 	ASSERT(xfs_isilocked(ip, XFS_IOLOCK_EXCL));
 	ASSERT(xfs_isilocked(ip, XFS_ILOCK_EXCL));
-	ASSERT(xfs_bmse_can_merge(&left, &got, shift));
+	ASSERT(xfs_bmse_can_merge(left, got, shift));
 
-	/*
-	 * Merge the in-core extents. Note that the host record pointers and
-	 * current_ext index are invalid once the extent has been removed via
-	 * xfs_iext_remove().
-	 */
-	xfs_bmbt_set_blockcount(leftp, blockcount);
-	xfs_iext_remove(ip, current_ext, 1, 0);
+	new = *left;
+	new.br_blockcount = blockcount;
 
 	/*
 	 * Update the on-disk extent count, the btree if necessary and log the
@@ -5901,12 +5900,12 @@ xfs_bmse_merge(
 	*logflags |= XFS_ILOG_CORE;
 	if (!cur) {
 		*logflags |= XFS_ILOG_DEXT;
-		return 0;
+		goto done;
 	}
 
 	/* lookup and remove the extent to merge */
-	error = xfs_bmbt_lookup_eq(cur, got.br_startoff, got.br_startblock,
-				   got.br_blockcount, &i);
+	error = xfs_bmbt_lookup_eq(cur, got->br_startoff, got->br_startblock,
+				   got->br_blockcount, &i);
 	if (error)
 		return error;
 	XFS_WANT_CORRUPTED_RETURN(mp, i == 1);
@@ -5917,16 +5916,28 @@ xfs_bmse_merge(
 	XFS_WANT_CORRUPTED_RETURN(mp, i == 1);
 
 	/* lookup and update size of the previous extent */
-	error = xfs_bmbt_lookup_eq(cur, left.br_startoff, left.br_startblock,
-				   left.br_blockcount, &i);
+	error = xfs_bmbt_lookup_eq(cur, left->br_startoff, left->br_startblock,
+				   left->br_blockcount, &i);
 	if (error)
 		return error;
 	XFS_WANT_CORRUPTED_RETURN(mp, i == 1);
 
-	left.br_blockcount = blockcount;
+	error = xfs_bmbt_update(cur, new.br_startoff, new.br_startblock,
+			        new.br_blockcount, new.br_state);
+	if (error)
+		return error;
+
+done:
+	xfs_iext_update_extent(ifp, current_ext - 1, &new);
+	xfs_iext_remove(ip, current_ext, 1, 0);
 
-	return xfs_bmbt_update(cur, left.br_startoff, left.br_startblock,
-			       left.br_blockcount, left.br_state);
+	/* update reverse mapping. rmap functions merge the rmaps for us */
+	error = xfs_rmap_unmap_extent(mp, dfops, ip, whichfork, got);
+	if (error)
+		return error;
+	memcpy(&new, got, sizeof(new));
+	new.br_startoff = left->br_startoff + left->br_blockcount;
+	return xfs_rmap_map_extent(mp, dfops, ip, whichfork, &new);
 }
 
 /*
@@ -5938,7 +5949,7 @@ xfs_bmse_shift_one(
 	int				whichfork,
 	xfs_fileoff_t			offset_shift_fsb,
 	int				*current_ext,
-	struct xfs_bmbt_rec_host	*gotp,
+	struct xfs_bmbt_irec		*got,
 	struct xfs_btree_cur		*cur,
 	int				*logflags,
 	enum shift_direction		direction,
@@ -5947,24 +5958,20 @@ xfs_bmse_shift_one(
 	struct xfs_ifork		*ifp;
 	struct xfs_mount		*mp;
 	xfs_fileoff_t			startoff;
-	struct xfs_bmbt_rec_host	*adj_irecp;
-	struct xfs_bmbt_irec		got;
-	struct xfs_bmbt_irec		adj_irec;
+	struct xfs_bmbt_irec		adj_irec, new;
 	int				error;
 	int				i;
 	int				total_extents;
 
 	mp = ip->i_mount;
 	ifp = XFS_IFORK_PTR(ip, whichfork);
-	total_extents = ifp->if_bytes / sizeof(xfs_bmbt_rec_t);
-
-	xfs_bmbt_get_all(gotp, &got);
+	total_extents = xfs_iext_count(ifp);
 
 	/* delalloc extents should be prevented by caller */
-	XFS_WANT_CORRUPTED_RETURN(mp, !isnullstartblock(got.br_startblock));
+	XFS_WANT_CORRUPTED_RETURN(mp, !isnullstartblock(got->br_startblock));
 
 	if (direction == SHIFT_LEFT) {
-		startoff = got.br_startoff - offset_shift_fsb;
+		startoff = got->br_startoff - offset_shift_fsb;
 
 		/*
 		 * Check for merge if we've got an extent to the left,
@@ -5972,46 +5979,39 @@ xfs_bmse_shift_one(
 		 * of the file for the shift.
 		 */
 		if (!*current_ext) {
-			if (got.br_startoff < offset_shift_fsb)
+			if (got->br_startoff < offset_shift_fsb)
 				return -EINVAL;
 			goto update_current_ext;
 		}
+
 		/*
-		 * grab the left extent and check for a large
-		 * enough hole.
+		 * grab the left extent and check for a large enough hole.
 		 */
-		adj_irecp = xfs_iext_get_ext(ifp, *current_ext - 1);
-		xfs_bmbt_get_all(adj_irecp, &adj_irec);
-
-		if (startoff <
-		    adj_irec.br_startoff + adj_irec.br_blockcount)
+		xfs_iext_get_extent(ifp, *current_ext - 1, &adj_irec);
+		if (startoff < adj_irec.br_startoff + adj_irec.br_blockcount)
 			return -EINVAL;
 
 		/* check whether to merge the extent or shift it down */
-		if (xfs_bmse_can_merge(&adj_irec, &got,
-				       offset_shift_fsb)) {
-			error = xfs_bmse_merge(ip, whichfork, offset_shift_fsb,
-					       *current_ext, gotp, adj_irecp,
-					       cur, logflags);
-			if (error)
-				return error;
-			adj_irec = got;
-			goto update_rmap;
+		if (xfs_bmse_can_merge(&adj_irec, got, offset_shift_fsb)) {
+			return xfs_bmse_merge(ip, whichfork, offset_shift_fsb,
+					      *current_ext, got, &adj_irec,
+					      cur, logflags, dfops);
 		}
 	} else {
-		startoff = got.br_startoff + offset_shift_fsb;
+		startoff = got->br_startoff + offset_shift_fsb;
 		/* nothing to move if this is the last extent */
 		if (*current_ext >= (total_extents - 1))
 			goto update_current_ext;
+
 		/*
 		 * If this is not the last extent in the file, make sure there
 		 * is enough room between current extent and next extent for
 		 * accommodating the shift.
 		 */
-		adj_irecp = xfs_iext_get_ext(ifp, *current_ext + 1);
-		xfs_bmbt_get_all(adj_irecp, &adj_irec);
-		if (startoff + got.br_blockcount > adj_irec.br_startoff)
+		xfs_iext_get_extent(ifp, *current_ext + 1, &adj_irec);
+		if (startoff + got->br_blockcount > adj_irec.br_startoff)
 			return -EINVAL;
+
 		/*
 		 * Unlike a left shift (which involves a hole punch),
 		 * a right shift does not modify extent neighbors
@@ -6019,45 +6019,48 @@ xfs_bmse_shift_one(
 		 * in this scenario. Check anyways and warn if we
 		 * encounter two extents that could be one.
 		 */
-		if (xfs_bmse_can_merge(&got, &adj_irec, offset_shift_fsb))
+		if (xfs_bmse_can_merge(got, &adj_irec, offset_shift_fsb))
 			WARN_ON_ONCE(1);
 	}
+
 	/*
 	 * Increment the extent index for the next iteration, update the start
 	 * offset of the in-core extent and update the btree if applicable.
 	 */
 update_current_ext:
-	if (direction == SHIFT_LEFT)
-		(*current_ext)++;
-	else
-		(*current_ext)--;
-	xfs_bmbt_set_startoff(gotp, startoff);
 	*logflags |= XFS_ILOG_CORE;
-	adj_irec = got;
-	if (!cur) {
+
+	new = *got;
+	new.br_startoff = startoff;
+
+	if (cur) {
+		error = xfs_bmbt_lookup_eq(cur, got->br_startoff,
+				got->br_startblock, got->br_blockcount, &i);
+		if (error)
+			return error;
+		XFS_WANT_CORRUPTED_RETURN(mp, i == 1);
+
+		error = xfs_bmbt_update(cur, new.br_startoff,
+				new.br_startblock, new.br_blockcount,
+				new.br_state);
+		if (error)
+			return error;
+	} else {
 		*logflags |= XFS_ILOG_DEXT;
-		goto update_rmap;
 	}
 
-	error = xfs_bmbt_lookup_eq(cur, got.br_startoff, got.br_startblock,
-				   got.br_blockcount, &i);
-	if (error)
-		return error;
-	XFS_WANT_CORRUPTED_RETURN(mp, i == 1);
+	xfs_iext_update_extent(ifp, *current_ext, &new);
 
-	got.br_startoff = startoff;
-	error = xfs_bmbt_update(cur, got.br_startoff, got.br_startblock,
-			got.br_blockcount, got.br_state);
-	if (error)
-		return error;
+	if (direction == SHIFT_LEFT)
+		(*current_ext)++;
+	else
+		(*current_ext)--;
 
-update_rmap:
 	/* update reverse mapping */
-	error = xfs_rmap_unmap_extent(mp, dfops, ip, whichfork, &adj_irec);
+	error = xfs_rmap_unmap_extent(mp, dfops, ip, whichfork, got);
 	if (error)
 		return error;
-	adj_irec.br_startoff = startoff;
-	return xfs_rmap_map_extent(mp, dfops, ip, whichfork, &adj_irec);
+	return xfs_rmap_map_extent(mp, dfops, ip, whichfork, &new);
 }
 
 /*
@@ -6084,7 +6087,6 @@ xfs_bmap_shift_extents(
 	int			num_exts)
 {
 	struct xfs_btree_cur		*cur = NULL;
-	struct xfs_bmbt_rec_host	*gotp;
 	struct xfs_bmbt_irec            got;
 	struct xfs_mount		*mp = ip->i_mount;
 	struct xfs_ifork		*ifp;
@@ -6099,7 +6101,7 @@ xfs_bmap_shift_extents(
 	if (unlikely(XFS_TEST_ERROR(
 	    (XFS_IFORK_FORMAT(ip, whichfork) != XFS_DINODE_FMT_EXTENTS &&
 	     XFS_IFORK_FORMAT(ip, whichfork) != XFS_DINODE_FMT_BTREE),
-	     mp, XFS_ERRTAG_BMAPIFORMAT, XFS_RANDOM_BMAPIFORMAT))) {
+	     mp, XFS_ERRTAG_BMAPIFORMAT))) {
 		XFS_ERROR_REPORT("xfs_bmap_shift_extents",
 				 XFS_ERRLEVEL_LOW, mp);
 		return -EFSCORRUPTED;
@@ -6111,7 +6113,6 @@ xfs_bmap_shift_extents(
 	ASSERT(xfs_isilocked(ip, XFS_IOLOCK_EXCL));
 	ASSERT(xfs_isilocked(ip, XFS_ILOCK_EXCL));
 	ASSERT(direction == SHIFT_LEFT || direction == SHIFT_RIGHT);
-	ASSERT(*next_fsb != NULLFSBLOCK || direction == SHIFT_RIGHT);
 
 	ifp = XFS_IFORK_PTR(ip, whichfork);
 	if (!(ifp->if_flags & XFS_IFEXTENTS)) {
@@ -6133,7 +6134,7 @@ xfs_bmap_shift_extents(
 	 * are collapsing out, so we cannot use the count of real extents here.
 	 * Instead we have to calculate it from the incore fork.
 	 */
-	total_extents = ifp->if_bytes / sizeof(xfs_bmbt_rec_t);
+	total_extents = xfs_iext_count(ifp);
 	if (total_extents == 0) {
 		*done = 1;
 		goto del_cursor;
@@ -6143,10 +6144,26 @@ xfs_bmap_shift_extents(
 	 * In case of first right shift, we need to initialize next_fsb
 	 */
 	if (*next_fsb == NULLFSBLOCK) {
-		gotp = xfs_iext_get_ext(ifp, total_extents - 1);
-		xfs_bmbt_get_all(gotp, &got);
+		ASSERT(direction == SHIFT_RIGHT);
+
+		current_ext = total_extents - 1;
+		xfs_iext_get_extent(ifp, current_ext, &got);
+		if (stop_fsb > got.br_startoff) {
+			*done = 1;
+			goto del_cursor;
+		}
 		*next_fsb = got.br_startoff;
-		if (stop_fsb > *next_fsb) {
+	} else {
+		/*
+		 * Look up the extent index for the fsb where we start shifting. We can
+		 * henceforth iterate with current_ext as extent list changes are locked
+		 * out via ilock.
+		 *
+		 * If next_fsb lies in a hole beyond which there are no extents we are
+		 * done.
+		 */
+		if (!xfs_iext_lookup_extent(ip, ifp, *next_fsb, &current_ext,
+				&got)) {
 			*done = 1;
 			goto del_cursor;
 		}
@@ -6154,37 +6171,26 @@ xfs_bmap_shift_extents(
 
 	/* Lookup the extent index at which we have to stop */
 	if (direction == SHIFT_RIGHT) {
-		gotp = xfs_iext_bno_to_ext(ifp, stop_fsb, &stop_extent);
+		struct xfs_bmbt_irec s;
+
+		xfs_iext_lookup_extent(ip, ifp, stop_fsb, &stop_extent, &s);
 		/* Make stop_extent exclusive of shift range */
 		stop_extent--;
-	} else
+		if (current_ext <= stop_extent) {
+			error = -EIO;
+			goto del_cursor;
+		}
+	} else {
 		stop_extent = total_extents;
-
-	/*
-	 * Look up the extent index for the fsb where we start shifting. We can
-	 * henceforth iterate with current_ext as extent list changes are locked
-	 * out via ilock.
-	 *
-	 * gotp can be null in 2 cases: 1) if there are no extents or 2)
-	 * *next_fsb lies in a hole beyond which there are no extents. Either
-	 * way, we are done.
-	 */
-	gotp = xfs_iext_bno_to_ext(ifp, *next_fsb, &current_ext);
-	if (!gotp) {
-		*done = 1;
-		goto del_cursor;
-	}
-
-	/* some sanity checking before we finally start shifting extents */
-	if ((direction == SHIFT_LEFT && current_ext >= stop_extent) ||
-	     (direction == SHIFT_RIGHT && current_ext <= stop_extent)) {
-		error = -EIO;
-		goto del_cursor;
+		if (current_ext >= stop_extent) {
+			error = -EIO;
+			goto del_cursor;
+		}
 	}
 
 	while (nexts++ < num_exts) {
 		error = xfs_bmse_shift_one(ip, whichfork, offset_shift_fsb,
-					   &current_ext, gotp, cur, &logflags,
+					   &current_ext, &got, cur, &logflags,
 					   direction, dfops);
 		if (error)
 			goto del_cursor;
@@ -6193,7 +6199,7 @@ xfs_bmap_shift_extents(
 		 * count can change. Update the total and grade the next record.
 		 */
 		if (direction == SHIFT_LEFT) {
-			total_extents = ifp->if_bytes / sizeof(xfs_bmbt_rec_t);
+			total_extents = xfs_iext_count(ifp);
 			stop_extent = total_extents;
 		}
 
@@ -6202,13 +6208,11 @@ xfs_bmap_shift_extents(
 			*next_fsb = NULLFSBLOCK;
 			break;
 		}
-		gotp = xfs_iext_get_ext(ifp, current_ext);
+		xfs_iext_get_extent(ifp, current_ext, &got);
 	}
 
-	if (!*done) {
-		xfs_bmbt_get_all(gotp, &got);
+	if (!*done)
 		*next_fsb = got.br_startoff;
-	}
 
 del_cursor:
 	if (cur)
@@ -6237,7 +6241,6 @@ xfs_bmap_split_extent_at(
 {
 	int				whichfork = XFS_DATA_FORK;
 	struct xfs_btree_cur		*cur = NULL;
-	struct xfs_bmbt_rec_host	*gotp;
 	struct xfs_bmbt_irec		got;
 	struct xfs_bmbt_irec		new; /* split extent */
 	struct xfs_mount		*mp = ip->i_mount;
@@ -6251,7 +6254,7 @@ xfs_bmap_split_extent_at(
 	if (unlikely(XFS_TEST_ERROR(
 	    (XFS_IFORK_FORMAT(ip, whichfork) != XFS_DINODE_FMT_EXTENTS &&
 	     XFS_IFORK_FORMAT(ip, whichfork) != XFS_DINODE_FMT_BTREE),
-	     mp, XFS_ERRTAG_BMAPIFORMAT, XFS_RANDOM_BMAPIFORMAT))) {
+	     mp, XFS_ERRTAG_BMAPIFORMAT))) {
 		XFS_ERROR_REPORT("xfs_bmap_split_extent_at",
 				 XFS_ERRLEVEL_LOW, mp);
 		return -EFSCORRUPTED;
@@ -6269,21 +6272,10 @@ xfs_bmap_split_extent_at(
 	}
 
 	/*
-	 * gotp can be null in 2 cases: 1) if there are no extents
-	 * or 2) split_fsb lies in a hole beyond which there are
-	 * no extents. Either way, we are done.
-	 */
-	gotp = xfs_iext_bno_to_ext(ifp, split_fsb, &current_ext);
-	if (!gotp)
-		return 0;
-
-	xfs_bmbt_get_all(gotp, &got);
-
-	/*
-	 * Check split_fsb lies in a hole or the start boundary offset
-	 * of the extent.
+	 * If there are not extents, or split_fsb lies in a hole we are done.
 	 */
-	if (got.br_startoff >= split_fsb)
+	if (!xfs_iext_lookup_extent(ip, ifp, split_fsb, &current_ext, &got) ||
+	    got.br_startoff >= split_fsb)
 		return 0;
 
 	gotblkcnt = split_fsb - got.br_startoff;
@@ -6306,8 +6298,8 @@ xfs_bmap_split_extent_at(
 		XFS_WANT_CORRUPTED_GOTO(mp, i == 1, del_cursor);
 	}
 
-	xfs_bmbt_set_blockcount(gotp, gotblkcnt);
 	got.br_blockcount = gotblkcnt;
+	xfs_iext_update_extent(ifp, current_ext, &got);
 
 	logflags = XFS_ILOG_CORE;
 	if (cur) {
@@ -6391,7 +6383,7 @@ xfs_bmap_split_extent(
 	if (error)
 		goto out;
 
-	error = xfs_defer_finish(&tp, &dfops, NULL);
+	error = xfs_defer_finish(&tp, &dfops);
 	if (error)
 		goto out;
 
@@ -6441,7 +6433,7 @@ __xfs_bmap_add(
 	bi->bi_whichfork = whichfork;
 	bi->bi_bmap = *bmap;
 
-	error = xfs_defer_join(dfops, bi->bi_owner);
+	error = xfs_defer_ijoin(dfops, bi->bi_owner);
 	if (error) {
 		kmem_free(bi);
 		return error;
@@ -6494,49 +6486,42 @@ xfs_bmap_finish_one(
 	int				whichfork,
 	xfs_fileoff_t			startoff,
 	xfs_fsblock_t			startblock,
-	xfs_filblks_t			blockcount,
+	xfs_filblks_t			*blockcount,
 	xfs_exntst_t			state)
 {
-	struct xfs_bmbt_irec		bmap;
-	int				nimaps = 1;
 	xfs_fsblock_t			firstfsb;
-	int				flags = XFS_BMAPI_REMAP;
-	int				done;
 	int				error = 0;
 
-	bmap.br_startblock = startblock;
-	bmap.br_startoff = startoff;
-	bmap.br_blockcount = blockcount;
-	bmap.br_state = state;
+	/*
+	 * firstfsb is tied to the transaction lifetime and is used to
+	 * ensure correct AG locking order and schedule work item
+	 * continuations.  XFS_BUI_MAX_FAST_EXTENTS (== 1) restricts us
+	 * to only making one bmap call per transaction, so it should
+	 * be safe to have it as a local variable here.
+	 */
+	firstfsb = NULLFSBLOCK;
 
 	trace_xfs_bmap_deferred(tp->t_mountp,
 			XFS_FSB_TO_AGNO(tp->t_mountp, startblock), type,
 			XFS_FSB_TO_AGBNO(tp->t_mountp, startblock),
-			ip->i_ino, whichfork, startoff, blockcount, state);
+			ip->i_ino, whichfork, startoff, *blockcount, state);
 
-	if (whichfork != XFS_DATA_FORK && whichfork != XFS_ATTR_FORK)
+	if (WARN_ON_ONCE(whichfork != XFS_DATA_FORK))
 		return -EFSCORRUPTED;
-	if (whichfork == XFS_ATTR_FORK)
-		flags |= XFS_BMAPI_ATTRFORK;
 
 	if (XFS_TEST_ERROR(false, tp->t_mountp,
-			XFS_ERRTAG_BMAP_FINISH_ONE,
-			XFS_RANDOM_BMAP_FINISH_ONE))
+			XFS_ERRTAG_BMAP_FINISH_ONE))
 		return -EIO;
 
 	switch (type) {
 	case XFS_BMAP_MAP:
-		firstfsb = bmap.br_startblock;
-		error = xfs_bmapi_write(tp, ip, bmap.br_startoff,
-					bmap.br_blockcount, flags, &firstfsb,
-					bmap.br_blockcount, &bmap, &nimaps,
-					dfops);
+		error = xfs_bmapi_remap(tp, ip, startoff, *blockcount,
+				startblock, dfops);
+		*blockcount = 0;
 		break;
 	case XFS_BMAP_UNMAP:
-		error = xfs_bunmapi(tp, ip, bmap.br_startoff,
-				bmap.br_blockcount, flags, 1, &firstfsb,
-				dfops, &done);
-		ASSERT(done);
+		error = __xfs_bunmapi(tp, ip, startoff, blockcount,
+				XFS_BMAPI_REMAP, 1, &firstfsb, dfops);
 		break;
 	default:
 		ASSERT(0);
diff -urpN xfsprogs-4.9.0/libxfs/xfs_bmap.h xfsprogs-4.14.0/libxfs/xfs_bmap.h
--- xfsprogs-4.9.0/libxfs/xfs_bmap.h	2017-01-05 18:41:55.000000000 +0100
+++ xfsprogs-4.14.0/libxfs/xfs_bmap.h	2017-11-27 17:57:55.000000000 +0100
@@ -110,6 +110,9 @@ struct xfs_extent_free_item
 /* Map something in the CoW fork. */
 #define XFS_BMAPI_COWFORK	0x200
 
+/* Only convert delalloc space, don't allocate entirely new extents */
+#define XFS_BMAPI_DELALLOC	0x400
+
 #define XFS_BMAPI_FLAGS \
 	{ XFS_BMAPI_ENTIRE,	"ENTIRE" }, \
 	{ XFS_BMAPI_METADATA,	"METADATA" }, \
@@ -120,7 +123,8 @@ struct xfs_extent_free_item
 	{ XFS_BMAPI_CONVERT,	"CONVERT" }, \
 	{ XFS_BMAPI_ZERO,	"ZERO" }, \
 	{ XFS_BMAPI_REMAP,	"REMAP" }, \
-	{ XFS_BMAPI_COWFORK,	"COWFORK" }
+	{ XFS_BMAPI_COWFORK,	"COWFORK" }, \
+	{ XFS_BMAPI_DELALLOC,	"DELALLOC" }
 
 
 static inline int xfs_bmapi_aflag(int w)
@@ -168,6 +172,18 @@ static inline int xfs_bmapi_whichfork(in
 
 
 /*
+ * Return true if the extent is a real, allocated extent, or false if it is  a
+ * delayed allocation, and unwritten extent or a hole.
+ */
+static inline bool xfs_bmap_is_real_extent(struct xfs_bmbt_irec *irec)
+{
+	return irec->br_state != XFS_EXT_UNWRITTEN &&
+		irec->br_startblock != HOLESTARTBLOCK &&
+		irec->br_startblock != DELAYSTARTBLOCK &&
+		!isnullstartblock(irec->br_startblock);
+}
+
+/*
  * This macro is used to determine how many extents will be shifted
  * in one write transaction. We could require two splits,
  * an extent move on the first and an extent merge on the second,
@@ -192,6 +208,7 @@ void	xfs_bmap_trace_exlist(struct xfs_in
 
 void	xfs_trim_extent(struct xfs_bmbt_irec *irec, xfs_fileoff_t bno,
 		xfs_filblks_t len);
+void	xfs_trim_extent_eof(struct xfs_bmbt_irec *, struct xfs_inode *);
 int	xfs_bmap_add_attrfork(struct xfs_inode *ip, int size, int rsvd);
 void	xfs_bmap_local_to_extents_empty(struct xfs_inode *ip, int whichfork);
 void	xfs_bmap_add_free(struct xfs_mount *mp, struct xfs_defer_ops *dfops,
@@ -228,8 +245,6 @@ int	xfs_bmap_del_extent_delay(struct xfs
 		struct xfs_bmbt_irec *del);
 void	xfs_bmap_del_extent_cow(struct xfs_inode *ip, xfs_extnum_t *idx,
 		struct xfs_bmbt_irec *got, struct xfs_bmbt_irec *del);
-int	xfs_check_nostate_extents(struct xfs_ifork *ifp, xfs_extnum_t idx,
-		xfs_extnum_t num);
 uint	xfs_default_attroffset(struct xfs_inode *ip);
 int	xfs_bmap_shift_extents(struct xfs_trans *tp, struct xfs_inode *ip,
 		xfs_fileoff_t *next_fsb, xfs_fileoff_t offset_shift_fsb,
@@ -237,21 +252,9 @@ int	xfs_bmap_shift_extents(struct xfs_tr
 		struct xfs_defer_ops *dfops, enum shift_direction direction,
 		int num_exts);
 int	xfs_bmap_split_extent(struct xfs_inode *ip, xfs_fileoff_t split_offset);
-struct xfs_bmbt_rec_host *
-	xfs_bmap_search_extents(struct xfs_inode *ip, xfs_fileoff_t bno,
-		int fork, int *eofp, xfs_extnum_t *lastxp,
-		struct xfs_bmbt_irec *gotp, struct xfs_bmbt_irec *prevp);
 int	xfs_bmapi_reserve_delalloc(struct xfs_inode *ip, int whichfork,
-		xfs_fileoff_t aoff, xfs_filblks_t len,
-		struct xfs_bmbt_irec *got, struct xfs_bmbt_irec *prev,
-		xfs_extnum_t *lastx, int eof);
-
-struct xfs_bmbt_rec_host *
-	xfs_bmap_search_extents(struct xfs_inode *ip, xfs_fileoff_t bno,
-				int fork, int *eofp, xfs_extnum_t *lastxp,
-				struct xfs_bmbt_irec *gotp,
-				struct xfs_bmbt_irec *prevp);
-
+		xfs_fileoff_t off, xfs_filblks_t len, xfs_filblks_t prealloc,
+		struct xfs_bmbt_irec *got, xfs_extnum_t *lastx, int eof);
 
 enum xfs_bmap_intent_type {
 	XFS_BMAP_MAP = 1,
@@ -269,7 +272,7 @@ struct xfs_bmap_intent {
 int	xfs_bmap_finish_one(struct xfs_trans *tp, struct xfs_defer_ops *dfops,
 		struct xfs_inode *ip, enum xfs_bmap_intent_type type,
 		int whichfork, xfs_fileoff_t startoff, xfs_fsblock_t startblock,
-		xfs_filblks_t blockcount, xfs_exntst_t state);
+		xfs_filblks_t *blockcount, xfs_exntst_t state);
 int	xfs_bmap_map_extent(struct xfs_mount *mp, struct xfs_defer_ops *dfops,
 		struct xfs_inode *ip, struct xfs_bmbt_irec *imap);
 int	xfs_bmap_unmap_extent(struct xfs_mount *mp, struct xfs_defer_ops *dfops,
diff -urpN xfsprogs-4.9.0/libxfs/xfs_bmap_btree.c xfsprogs-4.14.0/libxfs/xfs_bmap_btree.c
--- xfsprogs-4.9.0/libxfs/xfs_bmap_btree.c	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/libxfs/xfs_bmap_btree.c	2017-11-27 17:57:55.000000000 +0100
@@ -68,15 +68,9 @@ xfs_bmdr_to_bmbt(
 	xfs_bmbt_key_t		*tkp;
 	__be64			*tpp;
 
-	if (xfs_sb_version_hascrc(&mp->m_sb))
-		xfs_btree_init_block_int(mp, rblock, XFS_BUF_DADDR_NULL,
-				 XFS_BMAP_CRC_MAGIC, 0, 0, ip->i_ino,
-				 XFS_BTREE_LONG_PTRS | XFS_BTREE_CRC_BLOCKS);
-	else
-		xfs_btree_init_block_int(mp, rblock, XFS_BUF_DADDR_NULL,
-				 XFS_BMAP_MAGIC, 0, 0, ip->i_ino,
+	xfs_btree_init_block_int(mp, rblock, XFS_BUF_DADDR_NULL,
+				 XFS_BTNUM_BMAP, 0, 0, ip->i_ino,
 				 XFS_BTREE_LONG_PTRS);
-
 	rblock->bb_level = dblock->bb_level;
 	ASSERT(be16_to_cpu(rblock->bb_level) > 0);
 	rblock->bb_numrecs = dblock->bb_numrecs;
@@ -97,8 +91,8 @@ xfs_bmdr_to_bmbt(
  */
 STATIC void
 __xfs_bmbt_get_all(
-		__uint64_t l0,
-		__uint64_t l1,
+		uint64_t l0,
+		uint64_t l1,
 		xfs_bmbt_irec_t *s)
 {
 	int	ext_flag;
@@ -369,32 +363,6 @@ xfs_bmbt_to_bmdr(
 	memcpy(tpp, fpp, sizeof(*fpp) * dmxr);
 }
 
-/*
- * Check extent records, which have just been read, for
- * any bit in the extent flag field. ASSERT on debug
- * kernels, as this condition should not occur.
- * Return an error condition (1) if any flags found,
- * otherwise return 0.
- */
-
-int
-xfs_check_nostate_extents(
-	xfs_ifork_t		*ifp,
-	xfs_extnum_t		idx,
-	xfs_extnum_t		num)
-{
-	for (; num > 0; num--, idx++) {
-		xfs_bmbt_rec_host_t *ep = xfs_iext_get_ext(ifp, idx);
-		if ((ep->l0 >>
-		     (64 - BMBT_EXNTFLAG_BITLEN)) != 0) {
-			ASSERT(0);
-			return 1;
-		}
-	}
-	return 0;
-}
-
-
 STATIC struct xfs_btree_cur *
 xfs_bmbt_dup_cursor(
 	struct xfs_btree_cur	*cur)
@@ -450,7 +418,6 @@ xfs_bmbt_alloc_block(
 
 	if (args.fsbno == NULLFSBLOCK) {
 		args.fsbno = be64_to_cpu(start->l);
-try_another_ag:
 		args.type = XFS_ALLOCTYPE_START_BNO;
 		/*
 		 * Make sure there is sufficient room left in the AG to
@@ -480,37 +447,20 @@ try_another_ag:
 	if (error)
 		goto error0;
 
-	/*
-	 * During a CoW operation, the allocation and bmbt updates occur in
-	 * different transactions.  The mapping code tries to put new bmbt
-	 * blocks near extents being mapped, but the only way to guarantee this
-	 * is if the alloc and the mapping happen in a single transaction that
-	 * has a block reservation.  That isn't the case here, so if we run out
-	 * of space we'll try again with another AG.
-	 */
-	if (xfs_sb_version_hasreflink(&cur->bc_mp->m_sb) &&
-	    args.fsbno == NULLFSBLOCK &&
-	    args.type == XFS_ALLOCTYPE_NEAR_BNO) {
-		cur->bc_private.b.dfops->dop_low = true;
-		args.fsbno = cur->bc_private.b.firstblock;
-		goto try_another_ag;
-	}
-
 	if (args.fsbno == NULLFSBLOCK && args.minleft) {
 		/*
 		 * Could not find an AG with enough free space to satisfy
-		 * a full btree split.  Try again without minleft and if
+		 * a full btree split.  Try again and if
 		 * successful activate the lowspace algorithm.
 		 */
 		args.fsbno = 0;
 		args.type = XFS_ALLOCTYPE_FIRST_AG;
-		args.minleft = 0;
 		error = xfs_alloc_vextent(&args);
 		if (error)
 			goto error0;
 		cur->bc_private.b.dfops->dop_low = true;
 	}
-	if (args.fsbno == NULLFSBLOCK) {
+	if (WARN_ON_ONCE(args.fsbno == NULLFSBLOCK)) {
 		XFS_BTREE_TRACE_CURSOR(cur, XBT_EXIT);
 		*stat = 0;
 		return 0;
@@ -620,6 +570,16 @@ xfs_bmbt_init_key_from_rec(
 }
 
 STATIC void
+xfs_bmbt_init_high_key_from_rec(
+	union xfs_btree_key	*key,
+	union xfs_btree_rec	*rec)
+{
+	key->bmbt.br_startoff = cpu_to_be64(
+			xfs_bmbt_disk_get_startoff(&rec->bmbt) +
+			xfs_bmbt_disk_get_blockcount(&rec->bmbt) - 1);
+}
+
+STATIC void
 xfs_bmbt_init_rec_from_cur(
 	struct xfs_btree_cur	*cur,
 	union xfs_btree_rec	*rec)
@@ -635,15 +595,25 @@ xfs_bmbt_init_ptr_from_cur(
 	ptr->l = 0;
 }
 
-STATIC __int64_t
+STATIC int64_t
 xfs_bmbt_key_diff(
 	struct xfs_btree_cur	*cur,
 	union xfs_btree_key	*key)
 {
-	return (__int64_t)be64_to_cpu(key->bmbt.br_startoff) -
+	return (int64_t)be64_to_cpu(key->bmbt.br_startoff) -
 				      cur->bc_rec.b.br_startoff;
 }
 
+STATIC int64_t
+xfs_bmbt_diff_two_keys(
+	struct xfs_btree_cur	*cur,
+	union xfs_btree_key	*k1,
+	union xfs_btree_key	*k2)
+{
+	return (int64_t)be64_to_cpu(k1->bmbt.br_startoff) -
+			  be64_to_cpu(k2->bmbt.br_startoff);
+}
+
 static bool
 xfs_bmbt_verify(
 	struct xfs_buf		*bp)
@@ -734,7 +704,6 @@ const struct xfs_buf_ops xfs_bmbt_buf_op
 };
 
 
-#if defined(DEBUG) || defined(XFS_WARN)
 STATIC int
 xfs_bmbt_keys_inorder(
 	struct xfs_btree_cur	*cur,
@@ -755,7 +724,6 @@ xfs_bmbt_recs_inorder(
 		xfs_bmbt_disk_get_blockcount(&r1->bmbt) <=
 		xfs_bmbt_disk_get_startoff(&r2->bmbt);
 }
-#endif	/* DEBUG */
 
 static const struct xfs_btree_ops xfs_bmbt_ops = {
 	.rec_len		= sizeof(xfs_bmbt_rec_t),
@@ -769,14 +737,14 @@ static const struct xfs_btree_ops xfs_bm
 	.get_minrecs		= xfs_bmbt_get_minrecs,
 	.get_dmaxrecs		= xfs_bmbt_get_dmaxrecs,
 	.init_key_from_rec	= xfs_bmbt_init_key_from_rec,
+	.init_high_key_from_rec	= xfs_bmbt_init_high_key_from_rec,
 	.init_rec_from_cur	= xfs_bmbt_init_rec_from_cur,
 	.init_ptr_from_cur	= xfs_bmbt_init_ptr_from_cur,
 	.key_diff		= xfs_bmbt_key_diff,
+	.diff_two_keys		= xfs_bmbt_diff_two_keys,
 	.buf_ops		= &xfs_bmbt_buf_ops,
-#if defined(DEBUG) || defined(XFS_WARN)
 	.keys_inorder		= xfs_bmbt_keys_inorder,
 	.recs_inorder		= xfs_bmbt_recs_inorder,
-#endif
 };
 
 /*
@@ -793,13 +761,14 @@ xfs_bmbt_init_cursor(
 	struct xfs_btree_cur	*cur;
 	ASSERT(whichfork != XFS_COW_FORK);
 
-	cur = kmem_zone_zalloc(xfs_btree_cur_zone, KM_SLEEP);
+	cur = kmem_zone_zalloc(xfs_btree_cur_zone, KM_NOFS);
 
 	cur->bc_tp = tp;
 	cur->bc_mp = mp;
 	cur->bc_nlevels = be16_to_cpu(ifp->if_broot->bb_level) + 1;
 	cur->bc_btnum = XFS_BTNUM_BMAP;
 	cur->bc_blocklog = mp->m_sb.sb_blocklog;
+	cur->bc_statoff = XFS_STATS_CALC_INDEX(xs_bmbt_2);
 
 	cur->bc_ops = &xfs_bmbt_ops;
 	cur->bc_flags = XFS_BTREE_LONG_PTRS | XFS_BTREE_ROOT_IN_INODE;
@@ -886,6 +855,7 @@ xfs_bmbt_change_owner(
 	cur = xfs_bmbt_init_cursor(ip->i_mount, tp, ip, whichfork);
 	if (!cur)
 		return -ENOMEM;
+	cur->bc_private.b.flags |= XFS_BTCUR_BPRV_INVALID_OWNER;
 
 	error = xfs_btree_change_owner(cur, new_owner, buffer_list);
 	xfs_btree_del_cursor(cur, error ? XFS_BTREE_ERROR : XFS_BTREE_NOERROR);
diff -urpN xfsprogs-4.9.0/libxfs/xfs_bmap_btree.h xfsprogs-4.14.0/libxfs/xfs_bmap_btree.h
--- xfsprogs-4.9.0/libxfs/xfs_bmap_btree.h	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/libxfs/xfs_bmap_btree.h	2017-11-27 17:57:52.000000000 +0100
@@ -25,14 +25,6 @@ struct xfs_inode;
 struct xfs_trans;
 
 /*
- * Extent state and extent format macros.
- */
-#define XFS_EXTFMT_INODE(x)	\
-	(xfs_sb_version_hasextflgbit(&((x)->i_mount->m_sb)) ? \
-		XFS_EXTFMT_HASSTATE : XFS_EXTFMT_NOSTATE)
-#define ISUNWRITTEN(x)	((x)->br_state == XFS_EXT_UNWRITTEN)
-
-/*
  * Btree block header size depends on a superblock flag.
  */
 #define XFS_BMBT_BLOCK_LEN(mp) \
@@ -140,4 +132,18 @@ extern int xfs_bmbt_change_owner(struct
 extern struct xfs_btree_cur *xfs_bmbt_init_cursor(struct xfs_mount *,
 		struct xfs_trans *, struct xfs_inode *, int);
 
+/*
+ * Check that the extent does not contain an invalid unwritten extent flag.
+ */
+static inline bool xfs_bmbt_validate_extent(struct xfs_mount *mp, int whichfork,
+		struct xfs_bmbt_rec_host *ep)
+{
+	if (ep->l0 >> (64 - BMBT_EXNTFLAG_BITLEN) == 0)
+		return true;
+	if (whichfork == XFS_DATA_FORK &&
+	    xfs_sb_version_hasextflgbit(&mp->m_sb))
+		return true;
+	return false;
+}
+
 #endif	/* __XFS_BMAP_BTREE_H__ */
diff -urpN xfsprogs-4.9.0/libxfs/xfs_btree.c xfsprogs-4.14.0/libxfs/xfs_btree.c
--- xfsprogs-4.9.0/libxfs/xfs_btree.c	2017-01-05 18:41:55.000000000 +0100
+++ xfsprogs-4.14.0/libxfs/xfs_btree.c	2017-11-27 17:57:55.000000000 +0100
@@ -39,15 +39,25 @@ kmem_zone_t	*xfs_btree_cur_zone;
 /*
  * Btree magic numbers.
  */
-static const __uint32_t xfs_magics[2][XFS_BTNUM_MAX] = {
+static const uint32_t xfs_magics[2][XFS_BTNUM_MAX] = {
 	{ XFS_ABTB_MAGIC, XFS_ABTC_MAGIC, 0, XFS_BMAP_MAGIC, XFS_IBT_MAGIC,
 	  XFS_FIBT_MAGIC, 0 },
 	{ XFS_ABTB_CRC_MAGIC, XFS_ABTC_CRC_MAGIC, XFS_RMAP_CRC_MAGIC,
 	  XFS_BMAP_CRC_MAGIC, XFS_IBT_CRC_MAGIC, XFS_FIBT_CRC_MAGIC,
 	  XFS_REFC_CRC_MAGIC }
 };
-#define xfs_btree_magic(cur) \
-	xfs_magics[!!((cur)->bc_flags & XFS_BTREE_CRC_BLOCKS)][cur->bc_btnum]
+
+uint32_t
+xfs_btree_magic(
+	int			crc,
+	xfs_btnum_t		btnum)
+{
+	uint32_t		magic = xfs_magics[crc][btnum];
+
+	/* Ensure we asked for crc for crc-only magics. */
+	ASSERT(magic != 0);
+	return magic;
+}
 
 STATIC int				/* error (0 or EFSCORRUPTED) */
 xfs_btree_check_lblock(
@@ -58,10 +68,13 @@ xfs_btree_check_lblock(
 {
 	int			lblock_ok = 1; /* block passes checks */
 	struct xfs_mount	*mp;	/* file system mount point */
+	xfs_btnum_t		btnum = cur->bc_btnum;
+	int			crc;
 
 	mp = cur->bc_mp;
+	crc = xfs_sb_version_hascrc(&mp->m_sb);
 
-	if (xfs_sb_version_hascrc(&mp->m_sb)) {
+	if (crc) {
 		lblock_ok = lblock_ok &&
 			uuid_equal(&block->bb_u.l.bb_uuid,
 				   &mp->m_sb.sb_meta_uuid) &&
@@ -70,7 +83,7 @@ xfs_btree_check_lblock(
 	}
 
 	lblock_ok = lblock_ok &&
-		be32_to_cpu(block->bb_magic) == xfs_btree_magic(cur) &&
+		be32_to_cpu(block->bb_magic) == xfs_btree_magic(crc, btnum) &&
 		be16_to_cpu(block->bb_level) == level &&
 		be16_to_cpu(block->bb_numrecs) <=
 			cur->bc_ops->get_maxrecs(cur, level) &&
@@ -84,8 +97,7 @@ xfs_btree_check_lblock(
 			be64_to_cpu(block->bb_u.l.bb_rightsib)));
 
 	if (unlikely(XFS_TEST_ERROR(!lblock_ok, mp,
-			XFS_ERRTAG_BTREE_CHECK_LBLOCK,
-			XFS_RANDOM_BTREE_CHECK_LBLOCK))) {
+			XFS_ERRTAG_BTREE_CHECK_LBLOCK))) {
 		if (bp)
 			trace_xfs_btree_corrupt(bp, _RET_IP_);
 		XFS_ERROR_REPORT(__func__, XFS_ERRLEVEL_LOW, mp);
@@ -106,13 +118,16 @@ xfs_btree_check_sblock(
 	struct xfs_agf		*agf;	/* ag. freespace structure */
 	xfs_agblock_t		agflen;	/* native ag. freespace length */
 	int			sblock_ok = 1; /* block passes checks */
+	xfs_btnum_t		btnum = cur->bc_btnum;
+	int			crc;
 
 	mp = cur->bc_mp;
+	crc = xfs_sb_version_hascrc(&mp->m_sb);
 	agbp = cur->bc_private.a.agbp;
 	agf = XFS_BUF_TO_AGF(agbp);
 	agflen = be32_to_cpu(agf->agf_length);
 
-	if (xfs_sb_version_hascrc(&mp->m_sb)) {
+	if (crc) {
 		sblock_ok = sblock_ok &&
 			uuid_equal(&block->bb_u.s.bb_uuid,
 				   &mp->m_sb.sb_meta_uuid) &&
@@ -121,7 +136,7 @@ xfs_btree_check_sblock(
 	}
 
 	sblock_ok = sblock_ok &&
-		be32_to_cpu(block->bb_magic) == xfs_btree_magic(cur) &&
+		be32_to_cpu(block->bb_magic) == xfs_btree_magic(crc, btnum) &&
 		be16_to_cpu(block->bb_level) == level &&
 		be16_to_cpu(block->bb_numrecs) <=
 			cur->bc_ops->get_maxrecs(cur, level) &&
@@ -133,8 +148,7 @@ xfs_btree_check_sblock(
 		block->bb_u.s.bb_rightsib;
 
 	if (unlikely(XFS_TEST_ERROR(!sblock_ok, mp,
-			XFS_ERRTAG_BTREE_CHECK_SBLOCK,
-			XFS_RANDOM_BTREE_CHECK_SBLOCK))) {
+			XFS_ERRTAG_BTREE_CHECK_SBLOCK))) {
 		if (bp)
 			trace_xfs_btree_corrupt(bp, _RET_IP_);
 		XFS_ERROR_REPORT(__func__, XFS_ERRLEVEL_LOW, mp);
@@ -244,7 +258,7 @@ xfs_btree_lblock_verify_crc(
 	struct xfs_btree_block	*block = XFS_BUF_TO_BLOCK(bp);
 	struct xfs_mount	*mp = bp->b_target->bt_mount;
 
-	if (xfs_sb_version_hascrc(&bp->b_target->bt_mount->m_sb)) {
+	if (xfs_sb_version_hascrc(&mp->m_sb)) {
 		if (!xfs_log_check_lsn(mp, be64_to_cpu(block->bb_u.l.bb_lsn)))
 			return false;
 		return xfs_buf_verify_cksum(bp, XFS_BTREE_LBLOCK_CRC_OFF);
@@ -282,7 +296,7 @@ xfs_btree_sblock_verify_crc(
 	struct xfs_btree_block  *block = XFS_BUF_TO_BLOCK(bp);
 	struct xfs_mount	*mp = bp->b_target->bt_mount;
 
-	if (xfs_sb_version_hascrc(&bp->b_target->bt_mount->m_sb)) {
+	if (xfs_sb_version_hascrc(&mp->m_sb)) {
 		if (!xfs_log_check_lsn(mp, be64_to_cpu(block->bb_u.s.bb_lsn)))
 			return false;
 		return xfs_buf_verify_cksum(bp, XFS_BTREE_SBLOCK_CRC_OFF);
@@ -548,7 +562,7 @@ xfs_btree_ptr_offset(
 /*
  * Return a pointer to the n-th record in the btree block.
  */
-STATIC union xfs_btree_rec *
+union xfs_btree_rec *
 xfs_btree_rec_addr(
 	struct xfs_btree_cur	*cur,
 	int			n,
@@ -561,7 +575,7 @@ xfs_btree_rec_addr(
 /*
  * Return a pointer to the n-th key in the btree block.
  */
-STATIC union xfs_btree_key *
+union xfs_btree_key *
 xfs_btree_key_addr(
 	struct xfs_btree_cur	*cur,
 	int			n,
@@ -574,7 +588,7 @@ xfs_btree_key_addr(
 /*
  * Return a pointer to the n-th high key in the btree block.
  */
-STATIC union xfs_btree_key *
+union xfs_btree_key *
 xfs_btree_high_key_addr(
 	struct xfs_btree_cur	*cur,
 	int			n,
@@ -587,7 +601,7 @@ xfs_btree_high_key_addr(
 /*
  * Return a pointer to the n-th block pointer in the btree block.
  */
-STATIC union xfs_btree_ptr *
+union xfs_btree_ptr *
 xfs_btree_ptr_addr(
 	struct xfs_btree_cur	*cur,
 	int			n,
@@ -621,7 +635,7 @@ xfs_btree_get_iroot(
  * Retrieve the block pointer from the cursor at the given level.
  * This may be an inode btree root or from a buffer.
  */
-STATIC struct xfs_btree_block *		/* generic btree block pointer */
+struct xfs_btree_block *		/* generic btree block pointer */
 xfs_btree_get_block(
 	struct xfs_btree_cur	*cur,	/* btree cursor */
 	int			level,	/* level in btree */
@@ -710,7 +724,8 @@ xfs_btree_firstrec(
 	 * Get the block pointer for this level.
 	 */
 	block = xfs_btree_get_block(cur, level, &bp);
-	xfs_btree_check_block(cur, block, level, bp);
+	if (xfs_btree_check_block(cur, block, level, bp))
+		return 0;
 	/*
 	 * It's empty, there is no such record.
 	 */
@@ -739,7 +754,8 @@ xfs_btree_lastrec(
 	 * Get the block pointer for this level.
 	 */
 	block = xfs_btree_get_block(cur, level, &bp);
-	xfs_btree_check_block(cur, block, level, bp);
+	if (xfs_btree_check_block(cur, block, level, bp))
+		return 0;
 	/*
 	 * It's empty, there is no such record.
 	 */
@@ -758,14 +774,14 @@ xfs_btree_lastrec(
  */
 void
 xfs_btree_offsets(
-	__int64_t	fields,		/* bitmask of fields */
+	int64_t		fields,		/* bitmask of fields */
 	const short	*offsets,	/* table of field offsets */
 	int		nbits,		/* number of bits to inspect */
 	int		*first,		/* output: first byte offset */
 	int		*last)		/* output: last byte offset */
 {
 	int		i;		/* current bit number */
-	__int64_t	imask;		/* mask for current bit number */
+	int64_t		imask;		/* mask for current bit number */
 
 	ASSERT(fields != 0);
 	/*
@@ -806,7 +822,8 @@ xfs_btree_read_bufl(
 	xfs_daddr_t		d;		/* real disk block address */
 	int			error;
 
-	ASSERT(fsbno != NULLFSBLOCK);
+	if (!XFS_FSB_SANITY_CHECK(mp, fsbno))
+		return -EFSCORRUPTED;
 	d = XFS_FSB_TO_DADDR(mp, fsbno);
 	error = xfs_trans_read_buf(mp, tp, mp->m_ddev_targp, d,
 				   mp->m_bsize, lock, &bp, ops);
@@ -1080,12 +1097,15 @@ xfs_btree_init_block_int(
 	struct xfs_mount	*mp,
 	struct xfs_btree_block	*buf,
 	xfs_daddr_t		blkno,
-	__u32			magic,
+	xfs_btnum_t		btnum,
 	__u16			level,
 	__u16			numrecs,
 	__u64			owner,
 	unsigned int		flags)
 {
+	int			crc = xfs_sb_version_hascrc(&mp->m_sb);
+	__u32			magic = xfs_btree_magic(crc, btnum);
+
 	buf->bb_magic = cpu_to_be32(magic);
 	buf->bb_level = cpu_to_be16(level);
 	buf->bb_numrecs = cpu_to_be16(numrecs);
@@ -1093,7 +1113,7 @@ xfs_btree_init_block_int(
 	if (flags & XFS_BTREE_LONG_PTRS) {
 		buf->bb_u.l.bb_leftsib = cpu_to_be64(NULLFSBLOCK);
 		buf->bb_u.l.bb_rightsib = cpu_to_be64(NULLFSBLOCK);
-		if (flags & XFS_BTREE_CRC_BLOCKS) {
+		if (crc) {
 			buf->bb_u.l.bb_blkno = cpu_to_be64(blkno);
 			buf->bb_u.l.bb_owner = cpu_to_be64(owner);
 			uuid_copy(&buf->bb_u.l.bb_uuid, &mp->m_sb.sb_meta_uuid);
@@ -1106,7 +1126,7 @@ xfs_btree_init_block_int(
 
 		buf->bb_u.s.bb_leftsib = cpu_to_be32(NULLAGBLOCK);
 		buf->bb_u.s.bb_rightsib = cpu_to_be32(NULLAGBLOCK);
-		if (flags & XFS_BTREE_CRC_BLOCKS) {
+		if (crc) {
 			buf->bb_u.s.bb_blkno = cpu_to_be64(blkno);
 			buf->bb_u.s.bb_owner = cpu_to_be32(__owner);
 			uuid_copy(&buf->bb_u.s.bb_uuid, &mp->m_sb.sb_meta_uuid);
@@ -1119,14 +1139,14 @@ void
 xfs_btree_init_block(
 	struct xfs_mount *mp,
 	struct xfs_buf	*bp,
-	__u32		magic,
+	xfs_btnum_t	btnum,
 	__u16		level,
 	__u16		numrecs,
 	__u64		owner,
 	unsigned int	flags)
 {
 	xfs_btree_init_block_int(mp, XFS_BUF_TO_BLOCK(bp), bp->b_bn,
-				 magic, level, numrecs, owner, flags);
+				 btnum, level, numrecs, owner, flags);
 }
 
 STATIC void
@@ -1136,7 +1156,7 @@ xfs_btree_init_block_cur(
 	int			level,
 	int			numrecs)
 {
-	__u64 owner;
+	__u64			owner;
 
 	/*
 	 * we can pull the owner from the cursor right now as the different
@@ -1150,7 +1170,7 @@ xfs_btree_init_block_cur(
 		owner = cur->bc_private.a.agno;
 
 	xfs_btree_init_block_int(cur->bc_mp, XFS_BUF_TO_BLOCK(bp), bp->b_bn,
-				 xfs_btree_magic(cur), level, numrecs,
+				 cur->bc_btnum, level, numrecs,
 				 owner, cur->bc_flags);
 }
 
@@ -1732,7 +1752,7 @@ error0:
 	return error;
 }
 
-STATIC int
+int
 xfs_btree_lookup_get_block(
 	struct xfs_btree_cur	*cur,	/* btree cursor */
 	int			level,	/* level in the btree */
@@ -1765,8 +1785,29 @@ xfs_btree_lookup_get_block(
 	if (error)
 		return error;
 
+	/* Check the inode owner since the verifiers don't. */
+	if (xfs_sb_version_hascrc(&cur->bc_mp->m_sb) &&
+	    !(cur->bc_private.b.flags & XFS_BTCUR_BPRV_INVALID_OWNER) &&
+	    (cur->bc_flags & XFS_BTREE_LONG_PTRS) &&
+	    be64_to_cpu((*blkp)->bb_u.l.bb_owner) !=
+			cur->bc_private.b.ip->i_ino)
+		goto out_bad;
+
+	/* Did we get the level we were looking for? */
+	if (be16_to_cpu((*blkp)->bb_level) != level)
+		goto out_bad;
+
+	/* Check that internal nodes have at least one record. */
+	if (level != 0 && be16_to_cpu((*blkp)->bb_numrecs) == 0)
+		goto out_bad;
+
 	xfs_btree_setbuf(cur, level, bp);
 	return 0;
+
+out_bad:
+	*blkp = NULL;
+	xfs_trans_brelse(cur->bc_tp, bp);
+	return -EFSCORRUPTED;
 }
 
 /*
@@ -1802,7 +1843,7 @@ xfs_btree_lookup(
 	int			*stat)	/* success/failure */
 {
 	struct xfs_btree_block	*block;	/* current btree block */
-	__int64_t		diff;	/* difference for the current key */
+	int64_t			diff;	/* difference for the current key */
 	int			error;	/* error return value */
 	int			keyno;	/* current key number */
 	int			level;	/* level in the btree */
@@ -2843,7 +2884,7 @@ xfs_btree_split_worker(
 	struct xfs_btree_split_args	*args = container_of(work,
 						struct xfs_btree_split_args, work);
 	unsigned long		pflags;
-	unsigned long		new_pflags = PF_FSTRANS;
+	unsigned long		new_pflags = PF_MEMALLOC_NOFS;
 
 	/*
 	 * we are in a transaction context here, but may also be doing work
@@ -4355,7 +4396,7 @@ xfs_btree_visit_blocks(
 			xfs_btree_readahead_ptr(cur, ptr, 1);
 
 			/* save for the next iteration of the loop */
-			lptr = *ptr;
+			xfs_btree_copy_ptrs(cur, &lptr, ptr, 1);
 		}
 
 		/* for each buffer in the level */
@@ -4395,7 +4436,7 @@ xfs_btree_visit_blocks(
  * recovery completion writes the changes to disk.
  */
 struct xfs_btree_block_change_owner_info {
-	__uint64_t		new_owner;
+	uint64_t		new_owner;
 	struct list_head	*buffer_list;
 };
 
@@ -4411,10 +4452,15 @@ xfs_btree_block_change_owner(
 
 	/* modify the owner */
 	block = xfs_btree_get_block(cur, level, &bp);
-	if (cur->bc_flags & XFS_BTREE_LONG_PTRS)
+	if (cur->bc_flags & XFS_BTREE_LONG_PTRS) {
+		if (block->bb_u.l.bb_owner == cpu_to_be64(bbcoi->new_owner))
+			return 0;
 		block->bb_u.l.bb_owner = cpu_to_be64(bbcoi->new_owner);
-	else
+	} else {
+		if (block->bb_u.s.bb_owner == cpu_to_be32(bbcoi->new_owner))
+			return 0;
 		block->bb_u.s.bb_owner = cpu_to_be32(bbcoi->new_owner);
+	}
 
 	/*
 	 * If the block is a root block hosted in an inode, we might not have a
@@ -4423,16 +4469,19 @@ xfs_btree_block_change_owner(
 	 * block is formatted into the on-disk inode fork. We still change it,
 	 * though, so everything is consistent in memory.
 	 */
-	if (bp) {
-		if (cur->bc_tp) {
-			xfs_trans_ordered_buf(cur->bc_tp, bp);
+	if (!bp) {
+		ASSERT(cur->bc_flags & XFS_BTREE_ROOT_IN_INODE);
+		ASSERT(level == cur->bc_nlevels - 1);
+		return 0;
+	}
+
+	if (cur->bc_tp) {
+		if (!xfs_trans_ordered_buf(cur->bc_tp, bp)) {
 			xfs_btree_log_block(cur, bp, XFS_BB_OWNER);
-		} else {
-			xfs_buf_delwri_queue(bp, bbcoi->buffer_list);
+			return -EAGAIN;
 		}
 	} else {
-		ASSERT(cur->bc_flags & XFS_BTREE_ROOT_IN_INODE);
-		ASSERT(level == cur->bc_nlevels - 1);
+		xfs_buf_delwri_queue(bp, bbcoi->buffer_list);
 	}
 
 	return 0;
@@ -4441,7 +4490,7 @@ xfs_btree_block_change_owner(
 int
 xfs_btree_change_owner(
 	struct xfs_btree_cur	*cur,
-	__uint64_t		new_owner,
+	uint64_t		new_owner,
 	struct list_head	*buffer_list)
 {
 	struct xfs_btree_block_change_owner_info	bbcoi;
@@ -4545,7 +4594,7 @@ xfs_btree_simple_query_range(
 {
 	union xfs_btree_rec		*recp;
 	union xfs_btree_key		rec_key;
-	__int64_t			diff;
+	int64_t				diff;
 	int				stat;
 	bool				firstrec = true;
 	int				error;
@@ -4642,8 +4691,8 @@ xfs_btree_overlapped_query_range(
 	union xfs_btree_key		*hkp;
 	union xfs_btree_rec		*recp;
 	struct xfs_btree_block		*block;
-	__int64_t			ldiff;
-	__int64_t			hdiff;
+	int64_t				ldiff;
+	int64_t				hdiff;
 	int				level;
 	struct xfs_buf			*bp;
 	int				i;
@@ -4802,6 +4851,23 @@ xfs_btree_query_range(
 			fn, priv);
 }
 
+/* Query a btree for all records. */
+int
+xfs_btree_query_all(
+	struct xfs_btree_cur		*cur,
+	xfs_btree_query_range_fn	fn,
+	void				*priv)
+{
+	union xfs_btree_key		low_key;
+	union xfs_btree_key		high_key;
+
+	memset(&cur->bc_rec, 0, sizeof(cur->bc_rec));
+	memset(&low_key, 0, sizeof(low_key));
+	memset(&high_key, 0xFF, sizeof(high_key));
+
+	return xfs_btree_simple_query_range(cur, &low_key, &high_key, fn, priv);
+}
+
 /*
  * Calculate the number of blocks needed to store a given number of records
  * in a short-format (per-AG metadata) btree.
diff -urpN xfsprogs-4.9.0/libxfs/xfs_btree.h xfsprogs-4.14.0/libxfs/xfs_btree.h
--- xfsprogs-4.9.0/libxfs/xfs_btree.h	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/libxfs/xfs_btree.h	2017-11-27 17:57:55.000000000 +0100
@@ -76,6 +76,8 @@ union xfs_btree_rec {
 #define	XFS_BTNUM_RMAP	((xfs_btnum_t)XFS_BTNUM_RMAPi)
 #define	XFS_BTNUM_REFC	((xfs_btnum_t)XFS_BTNUM_REFCi)
 
+uint32_t xfs_btree_magic(int crc, xfs_btnum_t btnum);
+
 /*
  * For logging record fields.
  */
@@ -96,46 +98,10 @@ union xfs_btree_rec {
 /*
  * Generic stats interface
  */
-#define __XFS_BTREE_STATS_INC(mp, type, stat) \
-	XFS_STATS_INC(mp, xs_ ## type ## _2_ ## stat)
 #define XFS_BTREE_STATS_INC(cur, stat)	\
-do {    \
-	struct xfs_mount *__mp = cur->bc_mp; \
-	switch (cur->bc_btnum) {  \
-	case XFS_BTNUM_BNO: __XFS_BTREE_STATS_INC(__mp, abtb, stat); break; \
-	case XFS_BTNUM_CNT: __XFS_BTREE_STATS_INC(__mp, abtc, stat); break; \
-	case XFS_BTNUM_BMAP: __XFS_BTREE_STATS_INC(__mp, bmbt, stat); break; \
-	case XFS_BTNUM_INO: __XFS_BTREE_STATS_INC(__mp, ibt, stat); break; \
-	case XFS_BTNUM_FINO: __XFS_BTREE_STATS_INC(__mp, fibt, stat); break; \
-	case XFS_BTNUM_RMAP: __XFS_BTREE_STATS_INC(__mp, rmap, stat); break; \
-	case XFS_BTNUM_REFC: __XFS_BTREE_STATS_INC(__mp, refcbt, stat); break; \
-	case XFS_BTNUM_MAX: ASSERT(0); __mp = __mp /* fucking gcc */ ; break; \
-	}       \
-} while (0)
-
-#define __XFS_BTREE_STATS_ADD(mp, type, stat, val) \
-	XFS_STATS_ADD(mp, xs_ ## type ## _2_ ## stat, val)
-#define XFS_BTREE_STATS_ADD(cur, stat, val)  \
-do {    \
-	struct xfs_mount *__mp = cur->bc_mp; \
-	switch (cur->bc_btnum) {  \
-	case XFS_BTNUM_BNO:	\
-		__XFS_BTREE_STATS_ADD(__mp, abtb, stat, val); break; \
-	case XFS_BTNUM_CNT:	\
-		__XFS_BTREE_STATS_ADD(__mp, abtc, stat, val); break; \
-	case XFS_BTNUM_BMAP:	\
-		__XFS_BTREE_STATS_ADD(__mp, bmbt, stat, val); break; \
-	case XFS_BTNUM_INO:	\
-		__XFS_BTREE_STATS_ADD(__mp, ibt, stat, val); break; \
-	case XFS_BTNUM_FINO:	\
-		__XFS_BTREE_STATS_ADD(__mp, fibt, stat, val); break; \
-	case XFS_BTNUM_RMAP:	\
-		__XFS_BTREE_STATS_ADD(__mp, rmap, stat, val); break; \
-	case XFS_BTNUM_REFC:	\
-		__XFS_BTREE_STATS_ADD(__mp, refcbt, stat, val); break; \
-	case XFS_BTNUM_MAX: ASSERT(0); __mp = __mp /* fucking gcc */ ; break; \
-	}       \
-} while (0)
+	XFS_STATS_INC_OFF((cur)->bc_mp, (cur)->bc_statoff + __XBTS_ ## stat)
+#define XFS_BTREE_STATS_ADD(cur, stat, val)    \
+	XFS_STATS_ADD_OFF((cur)->bc_mp, (cur)->bc_statoff + __XBTS_ ## stat, val)
 
 #define	XFS_BTREE_MAXLEVELS	9	/* max of all btrees */
 
@@ -184,20 +150,19 @@ struct xfs_btree_ops {
 					  union xfs_btree_rec *rec);
 
 	/* difference between key value and cursor value */
-	__int64_t (*key_diff)(struct xfs_btree_cur *cur,
+	int64_t (*key_diff)(struct xfs_btree_cur *cur,
 			      union xfs_btree_key *key);
 
 	/*
 	 * Difference between key2 and key1 -- positive if key1 > key2,
 	 * negative if key1 < key2, and zero if equal.
 	 */
-	__int64_t (*diff_two_keys)(struct xfs_btree_cur *cur,
+	int64_t (*diff_two_keys)(struct xfs_btree_cur *cur,
 				   union xfs_btree_key *key1,
 				   union xfs_btree_key *key2);
 
 	const struct xfs_buf_ops	*buf_ops;
 
-#if defined(DEBUG) || defined(XFS_WARN)
 	/* check that k1 is lower than k2 */
 	int	(*keys_inorder)(struct xfs_btree_cur *cur,
 				union xfs_btree_key *k1,
@@ -207,7 +172,6 @@ struct xfs_btree_ops {
 	int	(*recs_inorder)(struct xfs_btree_cur *cur,
 				union xfs_btree_rec *r1,
 				union xfs_btree_rec *r2);
-#endif
 };
 
 /*
@@ -247,12 +211,13 @@ typedef struct xfs_btree_cur
 	union xfs_btree_irec	bc_rec;	/* current insert/search record value */
 	struct xfs_buf	*bc_bufs[XFS_BTREE_MAXLEVELS];	/* buf ptr per level */
 	int		bc_ptrs[XFS_BTREE_MAXLEVELS];	/* key/record # */
-	__uint8_t	bc_ra[XFS_BTREE_MAXLEVELS];	/* readahead bits */
+	uint8_t		bc_ra[XFS_BTREE_MAXLEVELS];	/* readahead bits */
 #define	XFS_BTCUR_LEFTRA	1	/* left sibling has been read-ahead */
 #define	XFS_BTCUR_RIGHTRA	2	/* right sibling has been read-ahead */
-	__uint8_t	bc_nlevels;	/* number of levels in the tree */
-	__uint8_t	bc_blocklog;	/* log2(blocksize) of btree blocks */
+	uint8_t		bc_nlevels;	/* number of levels in the tree */
+	uint8_t		bc_blocklog;	/* log2(blocksize) of btree blocks */
 	xfs_btnum_t	bc_btnum;	/* identifies which btree type */
+	int		bc_statoff;	/* offset of btre stats array */
 	union {
 		struct {			/* needed for BNO, CNT, INO */
 			struct xfs_buf	*agbp;	/* agf/agi buffer pointer */
@@ -268,7 +233,8 @@ typedef struct xfs_btree_cur
 			short		forksize;	/* fork's inode space */
 			char		whichfork;	/* data or attr fork */
 			char		flags;		/* flags */
-#define	XFS_BTCUR_BPRV_WASDEL	1			/* was delayed */
+#define	XFS_BTCUR_BPRV_WASDEL		(1<<0)		/* was delayed */
+#define	XFS_BTCUR_BPRV_INVALID_OWNER	(1<<1)		/* for ext swap */
 		} b;
 	}		bc_private;	/* per-btree type data */
 } xfs_btree_cur_t;
@@ -363,7 +329,7 @@ xfs_btree_islastblock(
  */
 void
 xfs_btree_offsets(
-	__int64_t		fields,	/* bitmask of fields */
+	int64_t			fields,	/* bitmask of fields */
 	const short		*offsets,/* table of field offsets */
 	int			nbits,	/* number of bits to inspect */
 	int			*first,	/* output: first byte offset */
@@ -413,7 +379,7 @@ void
 xfs_btree_init_block(
 	struct xfs_mount *mp,
 	struct xfs_buf	*bp,
-	__u32		magic,
+	xfs_btnum_t	btnum,
 	__u16		level,
 	__u16		numrecs,
 	__u64		owner,
@@ -424,7 +390,7 @@ xfs_btree_init_block_int(
 	struct xfs_mount	*mp,
 	struct xfs_btree_block	*buf,
 	xfs_daddr_t		blkno,
-	__u32			magic,
+	xfs_btnum_t		btnum,
 	__u16			level,
 	__u16			numrecs,
 	__u64			owner,
@@ -441,7 +407,7 @@ int xfs_btree_new_iroot(struct xfs_btree
 int xfs_btree_insert(struct xfs_btree_cur *, int *);
 int xfs_btree_delete(struct xfs_btree_cur *, int *);
 int xfs_btree_get_rec(struct xfs_btree_cur *, union xfs_btree_rec **, int *);
-int xfs_btree_change_owner(struct xfs_btree_cur *cur, __uint64_t new_owner,
+int xfs_btree_change_owner(struct xfs_btree_cur *cur, uint64_t new_owner,
 			   struct list_head *buffer_list);
 
 /*
@@ -467,7 +433,7 @@ static inline int xfs_btree_get_numrecs(
 }
 
 static inline void xfs_btree_set_numrecs(struct xfs_btree_block *block,
-		__uint16_t numrecs)
+		uint16_t numrecs)
 {
 	block->bb_numrecs = cpu_to_be16(numrecs);
 }
@@ -491,7 +457,7 @@ static inline int xfs_btree_get_level(st
 #define	XFS_FILBLKS_MAX(a,b)	max_t(xfs_filblks_t, (a), (b))
 
 #define	XFS_FSB_SANITY_CHECK(mp,fsb)	\
-	(XFS_FSB_TO_AGNO(mp, fsb) < mp->m_sb.sb_agcount && \
+	(fsb && XFS_FSB_TO_AGNO(mp, fsb) < mp->m_sb.sb_agcount && \
 		XFS_FSB_TO_AGBNO(mp, fsb) < mp->m_sb.sb_agblocks)
 
 /*
@@ -529,6 +495,8 @@ typedef int (*xfs_btree_query_range_fn)(
 int xfs_btree_query_range(struct xfs_btree_cur *cur,
 		union xfs_btree_irec *low_rec, union xfs_btree_irec *high_rec,
 		xfs_btree_query_range_fn fn, void *priv);
+int xfs_btree_query_all(struct xfs_btree_cur *cur, xfs_btree_query_range_fn fn,
+		void *priv);
 
 typedef int (*xfs_btree_visit_blocks_fn)(struct xfs_btree_cur *cur, int level,
 		void *data);
@@ -537,4 +505,17 @@ int xfs_btree_visit_blocks(struct xfs_bt
 
 int xfs_btree_count_blocks(struct xfs_btree_cur *cur, xfs_extlen_t *blocks);
 
+union xfs_btree_rec *xfs_btree_rec_addr(struct xfs_btree_cur *cur, int n,
+		struct xfs_btree_block *block);
+union xfs_btree_key *xfs_btree_key_addr(struct xfs_btree_cur *cur, int n,
+		struct xfs_btree_block *block);
+union xfs_btree_key *xfs_btree_high_key_addr(struct xfs_btree_cur *cur, int n,
+		struct xfs_btree_block *block);
+union xfs_btree_ptr *xfs_btree_ptr_addr(struct xfs_btree_cur *cur, int n,
+		struct xfs_btree_block *block);
+int xfs_btree_lookup_get_block(struct xfs_btree_cur *cur, int level,
+		union xfs_btree_ptr *pp, struct xfs_btree_block **blkp);
+struct xfs_btree_block *xfs_btree_get_block(struct xfs_btree_cur *cur,
+		int level, struct xfs_buf **bpp);
+
 #endif	/* __XFS_BTREE_H__ */
diff -urpN xfsprogs-4.9.0/libxfs/xfs_cksum.h xfsprogs-4.14.0/libxfs/xfs_cksum.h
--- xfsprogs-4.9.0/libxfs/xfs_cksum.h	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/libxfs/xfs_cksum.h	2017-11-20 01:14:14.000000000 +0100
@@ -1,18 +1,19 @@
 #ifndef _XFS_CKSUM_H
 #define _XFS_CKSUM_H 1
 
-#define XFS_CRC_SEED	(~(__uint32_t)0)
+#define XFS_CRC_SEED	(~(uint32_t)0)
 
 /*
  * Calculate the intermediate checksum for a buffer that has the CRC field
  * inside it.  The offset of the 32bit crc fields is passed as the
- * cksum_offset parameter.
+ * cksum_offset parameter. We do not modify the buffer during verification,
+ * hence we have to split the CRC calculation across the cksum_offset.
  */
-static inline __uint32_t
-xfs_start_cksum(char *buffer, size_t length, unsigned long cksum_offset)
+static inline uint32_t
+xfs_start_cksum_safe(char *buffer, size_t length, unsigned long cksum_offset)
 {
-	__uint32_t zero = 0;
-	__uint32_t crc;
+	uint32_t zero = 0;
+	uint32_t crc;
 
 	/* Calculate CRC up to the checksum. */
 	crc = crc32c(XFS_CRC_SEED, buffer, cksum_offset);
@@ -26,6 +27,20 @@ xfs_start_cksum(char *buffer, size_t len
 }
 
 /*
+ * Fast CRC method where the buffer is modified. Callers must have exclusive
+ * access to the buffer while the calculation takes place.
+ */
+static inline uint32_t
+xfs_start_cksum_update(char *buffer, size_t length, unsigned long cksum_offset)
+{
+	/* zero the CRC field */
+	*(__le32 *)(buffer + cksum_offset) = 0;
+
+	/* single pass CRC calculation for the entire buffer */
+	return crc32c(XFS_CRC_SEED, buffer, length);
+}
+
+/*
  * Convert the intermediate checksum to the final ondisk format.
  *
  * The CRC32c calculation uses LE format even on BE machines, but returns the
@@ -33,18 +48,21 @@ xfs_start_cksum(char *buffer, size_t len
  * so that it is consistent on disk.
  */
 static inline __le32
-xfs_end_cksum(__uint32_t crc)
+xfs_end_cksum(uint32_t crc)
 {
 	return ~cpu_to_le32(crc);
 }
 
 /*
  * Helper to generate the checksum for a buffer.
+ *
+ * This modifies the buffer temporarily - callers must have exclusive
+ * access to the buffer while the calculation takes place.
  */
 static inline void
 xfs_update_cksum(char *buffer, size_t length, unsigned long cksum_offset)
 {
-	__uint32_t crc = xfs_start_cksum(buffer, length, cksum_offset);
+	uint32_t crc = xfs_start_cksum_update(buffer, length, cksum_offset);
 
 	*(__le32 *)(buffer + cksum_offset) = xfs_end_cksum(crc);
 }
@@ -55,7 +73,7 @@ xfs_update_cksum(char *buffer, size_t le
 static inline int
 xfs_verify_cksum(char *buffer, size_t length, unsigned long cksum_offset)
 {
-	__uint32_t crc = xfs_start_cksum(buffer, length, cksum_offset);
+	uint32_t crc = xfs_start_cksum_safe(buffer, length, cksum_offset);
 
 	return *(__le32 *)(buffer + cksum_offset) == xfs_end_cksum(crc);
 }
diff -urpN xfsprogs-4.9.0/libxfs/xfs_da_btree.c xfsprogs-4.14.0/libxfs/xfs_da_btree.c
--- xfsprogs-4.9.0/libxfs/xfs_da_btree.c	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/libxfs/xfs_da_btree.c	2017-11-27 17:57:52.000000000 +0100
@@ -258,7 +258,7 @@ xfs_da3_node_read(
 
 	err = xfs_da_read_buf(tp, dp, bno, mappedbno, bpp,
 					which_fork, &xfs_da3_node_buf_ops);
-	if (!err && tp) {
+	if (!err && tp && *bpp) {
 		struct xfs_da_blkinfo	*info = (*bpp)->b_addr;
 		int			type;
 
@@ -1277,7 +1277,7 @@ xfs_da3_fixhashpath(
 			return;
 		break;
 	case XFS_DIR2_LEAFN_MAGIC:
-		lasthash = xfs_dir2_leafn_lasthash(dp, blk->bp, &count);
+		lasthash = xfs_dir2_leaf_lasthash(dp, blk->bp, &count);
 		if (count == 0)
 			return;
 		break;
@@ -1497,8 +1497,8 @@ xfs_da3_node_lookup_int(
 		if (blk->magic == XFS_DIR2_LEAFN_MAGIC ||
 		    blk->magic == XFS_DIR3_LEAFN_MAGIC) {
 			blk->magic = XFS_DIR2_LEAFN_MAGIC;
-			blk->hashval = xfs_dir2_leafn_lasthash(args->dp,
-							       blk->bp, NULL);
+			blk->hashval = xfs_dir2_leaf_lasthash(args->dp,
+							      blk->bp, NULL);
 			break;
 		}
 
@@ -1924,8 +1924,8 @@ xfs_da3_path_shift(
 			blk->magic = XFS_DIR2_LEAFN_MAGIC;
 			ASSERT(level == path->active-1);
 			blk->index = 0;
-			blk->hashval = xfs_dir2_leafn_lasthash(args->dp,
-							       blk->bp, NULL);
+			blk->hashval = xfs_dir2_leaf_lasthash(args->dp,
+							      blk->bp, NULL);
 			break;
 		default:
 			ASSERT(0);
@@ -1947,7 +1947,7 @@ xfs_da3_path_shift(
  * This is implemented with some source-level loop unrolling.
  */
 xfs_dahash_t
-xfs_da_hashname(const __uint8_t *name, int namelen)
+xfs_da_hashname(const uint8_t *name, int namelen)
 {
 	xfs_dahash_t hash;
 
@@ -2628,7 +2628,7 @@ out_free:
 /*
  * Readahead the dir/attr block.
  */
-xfs_daddr_t
+int
 xfs_da_reada_buf(
 	struct xfs_inode	*dp,
 	xfs_dablk_t		bno,
@@ -2659,7 +2659,5 @@ out_free:
 	if (mapp != &map)
 		kmem_free(mapp);
 
-	if (error)
-		return -1;
-	return mappedbno;
+	return error;
 }
diff -urpN xfsprogs-4.9.0/libxfs/xfs_da_btree.h xfsprogs-4.14.0/libxfs/xfs_da_btree.h
--- xfsprogs-4.9.0/libxfs/xfs_da_btree.h	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/libxfs/xfs_da_btree.h	2017-11-20 01:14:14.000000000 +0100
@@ -60,10 +60,10 @@ enum xfs_dacmp {
  */
 typedef struct xfs_da_args {
 	struct xfs_da_geometry *geo;	/* da block geometry */
-	const __uint8_t	*name;		/* string (maybe not NULL terminated) */
+	const uint8_t		*name;		/* string (maybe not NULL terminated) */
 	int		namelen;	/* length of string (maybe no NULL) */
-	__uint8_t	filetype;	/* filetype of inode for directories */
-	__uint8_t	*value;		/* set of bytes (maybe contain NULLs) */
+	uint8_t		filetype;	/* filetype of inode for directories */
+	uint8_t		*value;		/* set of bytes (maybe contain NULLs) */
 	int		valuelen;	/* length of value */
 	int		flags;		/* argument flags (eg: ATTR_NOCREATE) */
 	xfs_dahash_t	hashval;	/* hash value of name */
@@ -201,13 +201,13 @@ int	xfs_da_read_buf(struct xfs_trans *tr
 			       xfs_dablk_t bno, xfs_daddr_t mappedbno,
 			       struct xfs_buf **bpp, int whichfork,
 			       const struct xfs_buf_ops *ops);
-xfs_daddr_t	xfs_da_reada_buf(struct xfs_inode *dp, xfs_dablk_t bno,
+int	xfs_da_reada_buf(struct xfs_inode *dp, xfs_dablk_t bno,
 				xfs_daddr_t mapped_bno, int whichfork,
 				const struct xfs_buf_ops *ops);
 int	xfs_da_shrink_inode(xfs_da_args_t *args, xfs_dablk_t dead_blkno,
 					  struct xfs_buf *dead_buf);
 
-uint xfs_da_hashname(const __uint8_t *name_string, int name_length);
+uint xfs_da_hashname(const uint8_t *name_string, int name_length);
 enum xfs_dacmp xfs_da_compname(struct xfs_da_args *args,
 				const unsigned char *name, int len);
 
diff -urpN xfsprogs-4.9.0/libxfs/xfs_da_format.c xfsprogs-4.14.0/libxfs/xfs_da_format.c
--- xfsprogs-4.9.0/libxfs/xfs_da_format.c	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/libxfs/xfs_da_format.c	2017-11-20 01:14:14.000000000 +0100
@@ -49,7 +49,7 @@ xfs_dir3_sf_entsize(
 	struct xfs_dir2_sf_hdr	*hdr,
 	int			len)
 {
-	return xfs_dir2_sf_entsize(hdr, len) + sizeof(__uint8_t);
+	return xfs_dir2_sf_entsize(hdr, len) + sizeof(uint8_t);
 }
 
 static struct xfs_dir2_sf_entry *
@@ -77,7 +77,7 @@ xfs_dir3_sf_nextentry(
  * not necessary. For non-filetype enable directories, the type is always
  * unknown and we never store the value.
  */
-static __uint8_t
+static uint8_t
 xfs_dir2_sfe_get_ftype(
 	struct xfs_dir2_sf_entry *sfep)
 {
@@ -87,16 +87,16 @@ xfs_dir2_sfe_get_ftype(
 static void
 xfs_dir2_sfe_put_ftype(
 	struct xfs_dir2_sf_entry *sfep,
-	__uint8_t		ftype)
+	uint8_t			ftype)
 {
 	ASSERT(ftype < XFS_DIR3_FT_MAX);
 }
 
-static __uint8_t
+static uint8_t
 xfs_dir3_sfe_get_ftype(
 	struct xfs_dir2_sf_entry *sfep)
 {
-	__uint8_t	ftype;
+	uint8_t		ftype;
 
 	ftype = sfep->name[sfep->namelen];
 	if (ftype >= XFS_DIR3_FT_MAX)
@@ -107,7 +107,7 @@ xfs_dir3_sfe_get_ftype(
 static void
 xfs_dir3_sfe_put_ftype(
 	struct xfs_dir2_sf_entry *sfep,
-	__uint8_t		ftype)
+	uint8_t			ftype)
 {
 	ASSERT(ftype < XFS_DIR3_FT_MAX);
 
@@ -124,7 +124,7 @@ xfs_dir3_sfe_put_ftype(
 static xfs_ino_t
 xfs_dir2_sf_get_ino(
 	struct xfs_dir2_sf_hdr	*hdr,
-	__uint8_t		*from)
+	uint8_t			*from)
 {
 	if (hdr->i8count)
 		return get_unaligned_be64(from) & 0x00ffffffffffffffULL;
@@ -135,7 +135,7 @@ xfs_dir2_sf_get_ino(
 static void
 xfs_dir2_sf_put_ino(
 	struct xfs_dir2_sf_hdr	*hdr,
-	__uint8_t		*to,
+	uint8_t			*to,
 	xfs_ino_t		ino)
 {
 	ASSERT((ino & 0xff00000000000000ULL) == 0);
@@ -225,7 +225,7 @@ xfs_dir3_sfe_put_ino(
 
 #define XFS_DIR3_DATA_ENTSIZE(n)					\
 	round_up((offsetof(struct xfs_dir2_data_entry, name[0]) + (n) +	\
-		 sizeof(xfs_dir2_data_off_t) + sizeof(__uint8_t)),	\
+		 sizeof(xfs_dir2_data_off_t) + sizeof(uint8_t)),	\
 		XFS_DIR2_DATA_ALIGN)
 
 static int
@@ -242,7 +242,7 @@ xfs_dir3_data_entsize(
 	return XFS_DIR3_DATA_ENTSIZE(n);
 }
 
-static __uint8_t
+static uint8_t
 xfs_dir2_data_get_ftype(
 	struct xfs_dir2_data_entry *dep)
 {
@@ -252,16 +252,16 @@ xfs_dir2_data_get_ftype(
 static void
 xfs_dir2_data_put_ftype(
 	struct xfs_dir2_data_entry *dep,
-	__uint8_t		ftype)
+	uint8_t			ftype)
 {
 	ASSERT(ftype < XFS_DIR3_FT_MAX);
 }
 
-static __uint8_t
+static uint8_t
 xfs_dir3_data_get_ftype(
 	struct xfs_dir2_data_entry *dep)
 {
-	__uint8_t	ftype = dep->name[dep->namelen];
+	uint8_t		ftype = dep->name[dep->namelen];
 
 	if (ftype >= XFS_DIR3_FT_MAX)
 		return XFS_DIR3_FT_UNKNOWN;
@@ -271,7 +271,7 @@ xfs_dir3_data_get_ftype(
 static void
 xfs_dir3_data_put_ftype(
 	struct xfs_dir2_data_entry *dep,
-	__uint8_t		type)
+	uint8_t			type)
 {
 	ASSERT(type < XFS_DIR3_FT_MAX);
 	ASSERT(dep->namelen != 0);
diff -urpN xfsprogs-4.9.0/libxfs/xfs_da_format.h xfsprogs-4.14.0/libxfs/xfs_da_format.h
--- xfsprogs-4.9.0/libxfs/xfs_da_format.h	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/libxfs/xfs_da_format.h	2017-11-20 01:14:14.000000000 +0100
@@ -111,11 +111,11 @@ struct xfs_da3_intnode {
  * appropriate.
  */
 struct xfs_da3_icnode_hdr {
-	__uint32_t	forw;
-	__uint32_t	back;
-	__uint16_t	magic;
-	__uint16_t	count;
-	__uint16_t	level;
+	uint32_t	forw;
+	uint32_t	back;
+	uint16_t	magic;
+	uint16_t	count;
+	uint16_t	level;
 };
 
 /*
@@ -187,14 +187,14 @@ struct xfs_da3_icnode_hdr {
 /*
  * Byte offset in data block and shortform entry.
  */
-typedef	__uint16_t	xfs_dir2_data_off_t;
+typedef uint16_t	xfs_dir2_data_off_t;
 #define	NULLDATAOFF	0xffffU
 typedef uint		xfs_dir2_data_aoff_t;	/* argument form */
 
 /*
  * Offset in data space of a data entry.
  */
-typedef	__uint32_t	xfs_dir2_dataptr_t;
+typedef uint32_t	xfs_dir2_dataptr_t;
 #define	XFS_DIR2_MAX_DATAPTR	((xfs_dir2_dataptr_t)0xffffffff)
 #define	XFS_DIR2_NULL_DATAPTR	((xfs_dir2_dataptr_t)0)
 
@@ -206,7 +206,7 @@ typedef	xfs_off_t	xfs_dir2_off_t;
 /*
  * Directory block number (logical dirblk in file)
  */
-typedef	__uint32_t	xfs_dir2_db_t;
+typedef uint32_t	xfs_dir2_db_t;
 
 #define XFS_INO32_SIZE	4
 #define XFS_INO64_SIZE	8
@@ -226,9 +226,9 @@ typedef	__uint32_t	xfs_dir2_db_t;
  * over them.
  */
 typedef struct xfs_dir2_sf_hdr {
-	__uint8_t		count;		/* count of entries */
-	__uint8_t		i8count;	/* count of 8-byte inode #s */
-	__uint8_t		parent[8];	/* parent dir inode number */
+	uint8_t			count;		/* count of entries */
+	uint8_t			i8count;	/* count of 8-byte inode #s */
+	uint8_t			parent[8];	/* parent dir inode number */
 } __packed xfs_dir2_sf_hdr_t;
 
 typedef struct xfs_dir2_sf_entry {
@@ -447,11 +447,11 @@ struct xfs_dir3_leaf_hdr {
 };
 
 struct xfs_dir3_icleaf_hdr {
-	__uint32_t		forw;
-	__uint32_t		back;
-	__uint16_t		magic;
-	__uint16_t		count;
-	__uint16_t		stale;
+	uint32_t		forw;
+	uint32_t		back;
+	uint16_t		magic;
+	uint16_t		count;
+	uint16_t		stale;
 };
 
 /*
@@ -538,10 +538,10 @@ struct xfs_dir3_free {
  * xfs_dir3_free_hdr_from_disk/xfs_dir3_free_hdr_to_disk.
  */
 struct xfs_dir3_icfree_hdr {
-	__uint32_t	magic;
-	__uint32_t	firstdb;
-	__uint32_t	nvalid;
-	__uint32_t	nused;
+	uint32_t	magic;
+	uint32_t	firstdb;
+	uint32_t	nvalid;
+	uint32_t	nused;
 
 };
 
@@ -632,10 +632,10 @@ typedef struct xfs_attr_shortform {
 		__u8	padding;
 	} hdr;
 	struct xfs_attr_sf_entry {
-		__uint8_t namelen;	/* actual length of name (no NULL) */
-		__uint8_t valuelen;	/* actual length of value (no NULL) */
-		__uint8_t flags;	/* flags bits (see xfs_attr_leaf.h) */
-		__uint8_t nameval[1];	/* name & value bytes concatenated */
+		uint8_t namelen;	/* actual length of name (no NULL) */
+		uint8_t valuelen;	/* actual length of value (no NULL) */
+		uint8_t flags;	/* flags bits (see xfs_attr_leaf.h) */
+		uint8_t nameval[1];	/* name & value bytes concatenated */
 	} list[1];			/* variable sized array */
 } xfs_attr_shortform_t;
 
@@ -725,22 +725,22 @@ struct xfs_attr3_leafblock {
  * incore, neutral version of the attribute leaf header
  */
 struct xfs_attr3_icleaf_hdr {
-	__uint32_t	forw;
-	__uint32_t	back;
-	__uint16_t	magic;
-	__uint16_t	count;
-	__uint16_t	usedbytes;
+	uint32_t	forw;
+	uint32_t	back;
+	uint16_t	magic;
+	uint16_t	count;
+	uint16_t	usedbytes;
 	/*
 	 * firstused is 32-bit here instead of 16-bit like the on-disk variant
 	 * to support maximum fsb size of 64k without overflow issues throughout
 	 * the attr code. Instead, the overflow condition is handled on
 	 * conversion to/from disk.
 	 */
-	__uint32_t	firstused;
+	uint32_t	firstused;
 	__u8		holes;
 	struct {
-		__uint16_t	base;
-		__uint16_t	size;
+		uint16_t	base;
+		uint16_t	size;
 	} freemap[XFS_ATTR_LEAF_MAPSIZE];
 };
 
diff -urpN xfsprogs-4.9.0/libxfs/xfs_defer.c xfsprogs-4.14.0/libxfs/xfs_defer.c
--- xfsprogs-4.9.0/libxfs/xfs_defer.c	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/libxfs/xfs_defer.c	2017-11-27 17:57:55.000000000 +0100
@@ -240,23 +240,19 @@ xfs_defer_trans_abort(
 STATIC int
 xfs_defer_trans_roll(
 	struct xfs_trans		**tp,
-	struct xfs_defer_ops		*dop,
-	struct xfs_inode		*ip)
+	struct xfs_defer_ops		*dop)
 {
 	int				i;
 	int				error;
 
-	/* Log all the joined inodes except the one we passed in. */
-	for (i = 0; i < XFS_DEFER_OPS_NR_INODES && dop->dop_inodes[i]; i++) {
-		if (dop->dop_inodes[i] == ip)
-			continue;
+	/* Log all the joined inodes. */
+	for (i = 0; i < XFS_DEFER_OPS_NR_INODES && dop->dop_inodes[i]; i++)
 		xfs_trans_log_inode(*tp, dop->dop_inodes[i], XFS_ILOG_CORE);
-	}
 
 	trace_xfs_defer_trans_roll((*tp)->t_mountp, dop);
 
 	/* Roll the transaction. */
-	error = xfs_trans_roll(tp, ip);
+	error = xfs_trans_roll(tp);
 	if (error) {
 		trace_xfs_defer_trans_roll_error((*tp)->t_mountp, dop, error);
 		xfs_defer_trans_abort(*tp, dop, error);
@@ -264,12 +260,9 @@ xfs_defer_trans_roll(
 	}
 	dop->dop_committed = true;
 
-	/* Rejoin the joined inodes except the one we passed in. */
-	for (i = 0; i < XFS_DEFER_OPS_NR_INODES && dop->dop_inodes[i]; i++) {
-		if (dop->dop_inodes[i] == ip)
-			continue;
+	/* Rejoin the joined inodes. */
+	for (i = 0; i < XFS_DEFER_OPS_NR_INODES && dop->dop_inodes[i]; i++)
 		xfs_trans_ijoin(*tp, dop->dop_inodes[i], 0);
-	}
 
 	return error;
 }
@@ -284,11 +277,10 @@ xfs_defer_has_unfinished_work(
 
 /*
  * Add this inode to the deferred op.  Each joined inode is relogged
- * each time we roll the transaction, in addition to any inode passed
- * to xfs_defer_finish().
+ * each time we roll the transaction.
  */
 int
-xfs_defer_join(
+xfs_defer_ijoin(
 	struct xfs_defer_ops		*dop,
 	struct xfs_inode		*ip)
 {
@@ -317,8 +309,7 @@ xfs_defer_join(
 int
 xfs_defer_finish(
 	struct xfs_trans		**tp,
-	struct xfs_defer_ops		*dop,
-	struct xfs_inode		*ip)
+	struct xfs_defer_ops		*dop)
 {
 	struct xfs_defer_pending	*dfp;
 	struct list_head		*li;
@@ -337,7 +328,7 @@ xfs_defer_finish(
 		xfs_defer_intake_work(*tp, dop);
 
 		/* Roll the transaction. */
-		error = xfs_defer_trans_roll(tp, dop, ip);
+		error = xfs_defer_trans_roll(tp, dop);
 		if (error)
 			goto out;
 
diff -urpN xfsprogs-4.9.0/libxfs/xfs_defer.h xfsprogs-4.14.0/libxfs/xfs_defer.h
--- xfsprogs-4.9.0/libxfs/xfs_defer.h	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/libxfs/xfs_defer.h	2017-11-27 17:57:55.000000000 +0100
@@ -72,12 +72,11 @@ struct xfs_defer_ops {
 
 void xfs_defer_add(struct xfs_defer_ops *dop, enum xfs_defer_ops_type type,
 		struct list_head *h);
-int xfs_defer_finish(struct xfs_trans **tp, struct xfs_defer_ops *dop,
-		struct xfs_inode *ip);
+int xfs_defer_finish(struct xfs_trans **tp, struct xfs_defer_ops *dop);
 void xfs_defer_cancel(struct xfs_defer_ops *dop);
 void xfs_defer_init(struct xfs_defer_ops *dop, xfs_fsblock_t *fbp);
 bool xfs_defer_has_unfinished_work(struct xfs_defer_ops *dop);
-int xfs_defer_join(struct xfs_defer_ops *dop, struct xfs_inode *ip);
+int xfs_defer_ijoin(struct xfs_defer_ops *dop, struct xfs_inode *ip);
 
 /* Description of a deferred type. */
 struct xfs_defer_op_type {
diff -urpN xfsprogs-4.9.0/libxfs/xfs_dir2.c xfsprogs-4.14.0/libxfs/xfs_dir2.c
--- xfsprogs-4.9.0/libxfs/xfs_dir2.c	2017-01-05 18:41:55.000000000 +0100
+++ xfsprogs-4.14.0/libxfs/xfs_dir2.c	2017-11-27 17:57:52.000000000 +0100
@@ -34,21 +34,29 @@
 struct xfs_name xfs_name_dotdot = { (unsigned char *)"..", 2, XFS_DIR3_FT_DIR };
 
 /*
- * @mode, if set, indicates that the type field needs to be set up.
- * This uses the transformation from file mode to DT_* as defined in linux/fs.h
- * for file type specification. This will be propagated into the directory
- * structure if appropriate for the given operation and filesystem config.
- */
-const unsigned char xfs_mode_to_ftype[S_IFMT >> S_SHIFT] = {
-	[0]			= XFS_DIR3_FT_UNKNOWN,
-	[S_IFREG >> S_SHIFT]    = XFS_DIR3_FT_REG_FILE,
-	[S_IFDIR >> S_SHIFT]    = XFS_DIR3_FT_DIR,
-	[S_IFCHR >> S_SHIFT]    = XFS_DIR3_FT_CHRDEV,
-	[S_IFBLK >> S_SHIFT]    = XFS_DIR3_FT_BLKDEV,
-	[S_IFIFO >> S_SHIFT]    = XFS_DIR3_FT_FIFO,
-	[S_IFSOCK >> S_SHIFT]   = XFS_DIR3_FT_SOCK,
-	[S_IFLNK >> S_SHIFT]    = XFS_DIR3_FT_SYMLINK,
-};
+ * Convert inode mode to directory entry filetype
+ */
+unsigned char xfs_mode_to_ftype(int mode)
+{
+	switch (mode & S_IFMT) {
+	case S_IFREG:
+		return XFS_DIR3_FT_REG_FILE;
+	case S_IFDIR:
+		return XFS_DIR3_FT_DIR;
+	case S_IFCHR:
+		return XFS_DIR3_FT_CHRDEV;
+	case S_IFBLK:
+		return XFS_DIR3_FT_BLKDEV;
+	case S_IFIFO:
+		return XFS_DIR3_FT_FIFO;
+	case S_IFSOCK:
+		return XFS_DIR3_FT_SOCK;
+	case S_IFLNK:
+		return XFS_DIR3_FT_SYMLINK;
+	default:
+		return XFS_DIR3_FT_UNKNOWN;
+	}
+}
 
 /*
  * ASCII case-insensitive (ie. A-Z) support for directories that was
@@ -91,7 +99,7 @@ xfs_ascii_ci_compname(
 	return result;
 }
 
-static struct xfs_nameops xfs_ascii_ci_nameops = {
+static const struct xfs_nameops xfs_ascii_ci_nameops = {
 	.hashname	= xfs_ascii_ci_hashname,
 	.compname	= xfs_ascii_ci_compname,
 };
@@ -208,8 +216,7 @@ xfs_dir_ino_validate(
 		agblkno != 0 &&
 		ioff < (1 << mp->m_sb.sb_inopblog) &&
 		XFS_AGINO_TO_INO(mp, agno, agino) == ino;
-	if (unlikely(XFS_TEST_ERROR(!ino_ok, mp, XFS_ERRTAG_DIR_INO_VALIDATE,
-			XFS_RANDOM_DIR_INO_VALIDATE))) {
+	if (unlikely(XFS_TEST_ERROR(!ino_ok, mp, XFS_ERRTAG_DIR_INO_VALIDATE))) {
 		xfs_warn(mp, "Invalid inode number 0x%Lx",
 				(unsigned long long) ino);
 		XFS_ERROR_REPORT("xfs_dir_ino_validate", XFS_ERRLEVEL_LOW, mp);
@@ -629,7 +636,8 @@ xfs_dir2_isblock(
 	if ((rval = xfs_bmap_last_offset(args->dp, &last, XFS_DATA_FORK)))
 		return rval;
 	rval = XFS_FSB_TO_B(args->dp->i_mount, last) == args->geo->blksize;
-	ASSERT(rval == 0 || args->dp->i_d.di_size == args->geo->blksize);
+	if (rval != 0 && args->dp->i_d.di_size != args->geo->blksize)
+		return -EFSCORRUPTED;
 	*vp = rval;
 	return 0;
 }
diff -urpN xfsprogs-4.9.0/libxfs/xfs_dir2.h xfsprogs-4.14.0/libxfs/xfs_dir2.h
--- xfsprogs-4.9.0/libxfs/xfs_dir2.h	2017-01-05 18:41:55.000000000 +0100
+++ xfsprogs-4.14.0/libxfs/xfs_dir2.h	2017-11-27 17:57:52.000000000 +0100
@@ -18,6 +18,9 @@
 #ifndef __XFS_DIR2_H__
 #define __XFS_DIR2_H__
 
+#include "xfs_da_format.h"
+#include "xfs_da_btree.h"
+
 struct xfs_defer_ops;
 struct xfs_da_args;
 struct xfs_inode;
@@ -32,10 +35,9 @@ struct xfs_dir2_data_unused;
 extern struct xfs_name	xfs_name_dotdot;
 
 /*
- * directory filetype conversion tables.
+ * Convert inode mode to directory entry filetype
  */
-#define S_SHIFT 12
-extern const unsigned char xfs_mode_to_ftype[];
+extern unsigned char xfs_mode_to_ftype(int mode);
 
 /*
  * directory operations vector for encode/decode routines
@@ -45,9 +47,9 @@ struct xfs_dir_ops {
 	struct xfs_dir2_sf_entry *
 		(*sf_nextentry)(struct xfs_dir2_sf_hdr *hdr,
 				struct xfs_dir2_sf_entry *sfep);
-	__uint8_t (*sf_get_ftype)(struct xfs_dir2_sf_entry *sfep);
+	uint8_t (*sf_get_ftype)(struct xfs_dir2_sf_entry *sfep);
 	void	(*sf_put_ftype)(struct xfs_dir2_sf_entry *sfep,
-				__uint8_t ftype);
+				uint8_t ftype);
 	xfs_ino_t (*sf_get_ino)(struct xfs_dir2_sf_hdr *hdr,
 				struct xfs_dir2_sf_entry *sfep);
 	void	(*sf_put_ino)(struct xfs_dir2_sf_hdr *hdr,
@@ -58,9 +60,9 @@ struct xfs_dir_ops {
 				     xfs_ino_t ino);
 
 	int	(*data_entsize)(int len);
-	__uint8_t (*data_get_ftype)(struct xfs_dir2_data_entry *dep);
+	uint8_t (*data_get_ftype)(struct xfs_dir2_data_entry *dep);
 	void	(*data_put_ftype)(struct xfs_dir2_data_entry *dep,
-				__uint8_t ftype);
+				uint8_t ftype);
 	__be16 * (*data_entry_tag_p)(struct xfs_dir2_data_entry *dep);
 	struct xfs_dir2_data_free *
 		(*data_bestfree_p)(struct xfs_dir2_data_hdr *hdr);
@@ -157,9 +159,11 @@ extern int xfs_dir2_isleaf(struct xfs_da
 extern int xfs_dir2_shrink_inode(struct xfs_da_args *args, xfs_dir2_db_t db,
 				struct xfs_buf *bp);
 
-extern void __xfs_dir2_data_freescan(struct xfs_da_geometry *geo,
+extern void xfs_dir2_data_freescan_int(struct xfs_da_geometry *geo,
 		const struct xfs_dir_ops *ops,
 		struct xfs_dir2_data_hdr *hdr, int *loghead);
+extern void xfs_dir2_data_freescan(struct xfs_inode *dp,
+		struct xfs_dir2_data_hdr *hdr, int *loghead);
 extern void xfs_dir2_data_log_entry(struct xfs_da_args *args,
 		struct xfs_buf *bp, struct xfs_dir2_data_entry *dep);
 extern void xfs_dir2_data_log_header(struct xfs_da_args *args,
diff -urpN xfsprogs-4.9.0/libxfs/xfs_dir2_block.c xfsprogs-4.14.0/libxfs/xfs_dir2_block.c
--- xfsprogs-4.9.0/libxfs/xfs_dir2_block.c	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/libxfs/xfs_dir2_block.c	2017-11-20 01:14:14.000000000 +0100
@@ -135,7 +135,7 @@ xfs_dir3_block_read(
 
 	err = xfs_da_read_buf(tp, dp, mp->m_dir_geo->datablk, -1, bpp,
 				XFS_DATA_FORK, &xfs_dir3_block_buf_ops);
-	if (!err && tp)
+	if (!err && tp && *bpp)
 		xfs_trans_buf_set_type(tp, *bpp, XFS_BLFT_DIR_BLOCK_BUF);
 	return err;
 }
diff -urpN xfsprogs-4.9.0/libxfs/xfs_dir2_data.c xfsprogs-4.14.0/libxfs/xfs_dir2_data.c
--- xfsprogs-4.9.0/libxfs/xfs_dir2_data.c	2017-01-05 18:41:55.000000000 +0100
+++ xfsprogs-4.14.0/libxfs/xfs_dir2_data.c	2017-11-20 01:14:14.000000000 +0100
@@ -133,6 +133,8 @@ __xfs_dir3_data_check(
 		 */
 		if (be16_to_cpu(dup->freetag) == XFS_DIR2_DATA_FREE_TAG) {
 			XFS_WANT_CORRUPTED_RETURN(mp, lastfree == 0);
+			XFS_WANT_CORRUPTED_RETURN(mp, endp >=
+					p + be16_to_cpu(dup->length));
 			XFS_WANT_CORRUPTED_RETURN(mp,
 				be16_to_cpu(*xfs_dir2_data_unused_tag_p(dup)) ==
 					       (char *)dup - (char *)hdr);
@@ -161,6 +163,8 @@ __xfs_dir3_data_check(
 		XFS_WANT_CORRUPTED_RETURN(mp, dep->namelen != 0);
 		XFS_WANT_CORRUPTED_RETURN(mp,
 			!xfs_dir_ino_validate(mp, be64_to_cpu(dep->inumber)));
+		XFS_WANT_CORRUPTED_RETURN(mp, endp >=
+				p + ops->data_entsize(dep->namelen));
 		XFS_WANT_CORRUPTED_RETURN(mp,
 			be16_to_cpu(*ops->data_entry_tag_p(dep)) ==
 					       (char *)dep - (char *)hdr);
@@ -326,7 +330,7 @@ xfs_dir3_data_read(
 
 	err = xfs_da_read_buf(tp, dp, bno, mapped_bno, bpp,
 				XFS_DATA_FORK, &xfs_dir3_data_buf_ops);
-	if (!err && tp)
+	if (!err && tp && *bpp)
 		xfs_trans_buf_set_type(tp, *bpp, XFS_BLFT_DIR_DATA_BUF);
 	return err;
 }
@@ -502,7 +506,7 @@ xfs_dir2_data_freeremove(
  * Given a data block, reconstruct its bestfree map.
  */
 void
-__xfs_dir2_data_freescan(
+xfs_dir2_data_freescan_int(
 	struct xfs_da_geometry	*geo,
 	const struct xfs_dir_ops *ops,
 	struct xfs_dir2_data_hdr *hdr,
@@ -562,6 +566,16 @@ __xfs_dir2_data_freescan(
 	}
 }
 
+void
+xfs_dir2_data_freescan(
+	struct xfs_inode	*dp,
+	struct xfs_dir2_data_hdr *hdr,
+	int			*loghead)
+{
+	return xfs_dir2_data_freescan_int(dp->i_mount->m_dir_geo, dp->d_ops,
+			hdr, loghead);
+}
+
 /*
  * Initialize a data block at the given block number in the directory.
  * Give back the buffer for the created block.
diff -urpN xfsprogs-4.9.0/libxfs/xfs_dir2_leaf.c xfsprogs-4.14.0/libxfs/xfs_dir2_leaf.c
--- xfsprogs-4.9.0/libxfs/xfs_dir2_leaf.c	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/libxfs/xfs_dir2_leaf.c	2017-11-20 01:14:14.000000000 +0100
@@ -142,7 +142,7 @@ xfs_dir3_leaf_check_int(
 static bool
 xfs_dir3_leaf_verify(
 	struct xfs_buf		*bp,
-	__uint16_t		magic)
+	uint16_t		magic)
 {
 	struct xfs_mount	*mp = bp->b_target->bt_mount;
 	struct xfs_dir2_leaf	*leaf = bp->b_addr;
@@ -151,7 +151,7 @@ xfs_dir3_leaf_verify(
 
 	if (xfs_sb_version_hascrc(&mp->m_sb)) {
 		struct xfs_dir3_leaf_hdr *leaf3 = bp->b_addr;
-		__uint16_t		magic3;
+		uint16_t		magic3;
 
 		magic3 = (magic == XFS_DIR2_LEAF1_MAGIC) ? XFS_DIR3_LEAF1_MAGIC
 							 : XFS_DIR3_LEAFN_MAGIC;
@@ -175,7 +175,7 @@ xfs_dir3_leaf_verify(
 static void
 __read_verify(
 	struct xfs_buf  *bp,
-	__uint16_t	magic)
+	uint16_t	magic)
 {
 	struct xfs_mount	*mp = bp->b_target->bt_mount;
 
@@ -192,7 +192,7 @@ __read_verify(
 static void
 __write_verify(
 	struct xfs_buf  *bp,
-	__uint16_t	magic)
+	uint16_t	magic)
 {
 	struct xfs_mount	*mp = bp->b_target->bt_mount;
 	struct xfs_buf_log_item	*bip = bp->b_fspriv;
@@ -253,7 +253,7 @@ const struct xfs_buf_ops xfs_dir3_leafn_
 	.verify_write = xfs_dir3_leafn_write_verify,
 };
 
-static int
+int
 xfs_dir3_leaf_read(
 	struct xfs_trans	*tp,
 	struct xfs_inode	*dp,
@@ -265,7 +265,7 @@ xfs_dir3_leaf_read(
 
 	err = xfs_da_read_buf(tp, dp, fbno, mappedbno, bpp,
 				XFS_DATA_FORK, &xfs_dir3_leaf1_buf_ops);
-	if (!err && tp)
+	if (!err && tp && *bpp)
 		xfs_trans_buf_set_type(tp, *bpp, XFS_BLFT_DIR_LEAF1_BUF);
 	return err;
 }
@@ -282,7 +282,7 @@ xfs_dir3_leafn_read(
 
 	err = xfs_da_read_buf(tp, dp, fbno, mappedbno, bpp,
 				XFS_DATA_FORK, &xfs_dir3_leafn_buf_ops);
-	if (!err && tp)
+	if (!err && tp && *bpp)
 		xfs_trans_buf_set_type(tp, *bpp, XFS_BLFT_DIR_LEAFN_BUF);
 	return err;
 }
@@ -296,7 +296,7 @@ xfs_dir3_leaf_init(
 	struct xfs_trans	*tp,
 	struct xfs_buf		*bp,
 	xfs_ino_t		owner,
-	__uint16_t		type)
+	uint16_t		type)
 {
 	struct xfs_dir2_leaf	*leaf = bp->b_addr;
 
@@ -340,7 +340,7 @@ xfs_dir3_leaf_get_buf(
 	xfs_da_args_t		*args,
 	xfs_dir2_db_t		bno,
 	struct xfs_buf		**bpp,
-	__uint16_t		magic)
+	uint16_t		magic)
 {
 	struct xfs_inode	*dp = args->dp;
 	struct xfs_trans	*tp = args->trans;
diff -urpN xfsprogs-4.9.0/libxfs/xfs_dir2_node.c xfsprogs-4.14.0/libxfs/xfs_dir2_node.c
--- xfsprogs-4.9.0/libxfs/xfs_dir2_node.c	2017-01-05 18:41:55.000000000 +0100
+++ xfsprogs-4.14.0/libxfs/xfs_dir2_node.c	2017-11-20 01:14:14.000000000 +0100
@@ -152,6 +152,42 @@ const struct xfs_buf_ops xfs_dir3_free_b
 	.verify_write = xfs_dir3_free_write_verify,
 };
 
+/* Everything ok in the free block header? */
+static bool
+xfs_dir3_free_header_check(
+	struct xfs_inode	*dp,
+	xfs_dablk_t		fbno,
+	struct xfs_buf		*bp)
+{
+	struct xfs_mount	*mp = dp->i_mount;
+	unsigned int		firstdb;
+	int			maxbests;
+
+	maxbests = dp->d_ops->free_max_bests(mp->m_dir_geo);
+	firstdb = (xfs_dir2_da_to_db(mp->m_dir_geo, fbno) -
+		   xfs_dir2_byte_to_db(mp->m_dir_geo, XFS_DIR2_FREE_OFFSET)) *
+			maxbests;
+	if (xfs_sb_version_hascrc(&mp->m_sb)) {
+		struct xfs_dir3_free_hdr *hdr3 = bp->b_addr;
+
+		if (be32_to_cpu(hdr3->firstdb) != firstdb)
+			return false;
+		if (be32_to_cpu(hdr3->nvalid) > maxbests)
+			return false;
+		if (be32_to_cpu(hdr3->nvalid) < be32_to_cpu(hdr3->nused))
+			return false;
+	} else {
+		struct xfs_dir2_free_hdr *hdr = bp->b_addr;
+
+		if (be32_to_cpu(hdr->firstdb) != firstdb)
+			return false;
+		if (be32_to_cpu(hdr->nvalid) > maxbests)
+			return false;
+		if (be32_to_cpu(hdr->nvalid) < be32_to_cpu(hdr->nused))
+			return false;
+	}
+	return true;
+}
 
 static int
 __xfs_dir3_free_read(
@@ -165,11 +201,22 @@ __xfs_dir3_free_read(
 
 	err = xfs_da_read_buf(tp, dp, fbno, mappedbno, bpp,
 				XFS_DATA_FORK, &xfs_dir3_free_buf_ops);
+	if (err || !*bpp)
+		return err;
+
+	/* Check things that we can't do in the verifier. */
+	if (!xfs_dir3_free_header_check(dp, fbno, *bpp)) {
+		xfs_buf_ioerror(*bpp, -EFSCORRUPTED);
+		xfs_verifier_error(*bpp);
+		xfs_trans_brelse(tp, *bpp);
+		return -EFSCORRUPTED;
+	}
 
 	/* try read returns without an error or *bpp if it lands in a hole */
-	if (!err && tp && *bpp)
+	if (tp)
 		xfs_trans_buf_set_type(tp, *bpp, XFS_BLFT_DIR_FREE_BUF);
-	return err;
+
+	return 0;
 }
 
 int
@@ -478,7 +525,7 @@ xfs_dir2_free_hdr_check(
  * Stale entries are ok.
  */
 xfs_dahash_t					/* hash value */
-xfs_dir2_leafn_lasthash(
+xfs_dir2_leaf_lasthash(
 	struct xfs_inode *dp,
 	struct xfs_buf	*bp,			/* leaf buffer */
 	int		*count)			/* count of entries in leaf */
@@ -490,7 +537,9 @@ xfs_dir2_leafn_lasthash(
 	dp->d_ops->leaf_hdr_from_disk(&leafhdr, leaf);
 
 	ASSERT(leafhdr.magic == XFS_DIR2_LEAFN_MAGIC ||
-	       leafhdr.magic == XFS_DIR3_LEAFN_MAGIC);
+	       leafhdr.magic == XFS_DIR3_LEAFN_MAGIC ||
+	       leafhdr.magic == XFS_DIR2_LEAF1_MAGIC ||
+	       leafhdr.magic == XFS_DIR3_LEAF1_MAGIC);
 
 	if (count)
 		*count = leafhdr.count;
@@ -1355,8 +1404,8 @@ xfs_dir2_leafn_split(
 	/*
 	 * Update last hashval in each block since we added the name.
 	 */
-	oldblk->hashval = xfs_dir2_leafn_lasthash(dp, oldblk->bp, NULL);
-	newblk->hashval = xfs_dir2_leafn_lasthash(dp, newblk->bp, NULL);
+	oldblk->hashval = xfs_dir2_leaf_lasthash(dp, oldblk->bp, NULL);
+	newblk->hashval = xfs_dir2_leaf_lasthash(dp, newblk->bp, NULL);
 	xfs_dir3_leaf_check(dp, oldblk->bp);
 	xfs_dir3_leaf_check(dp, newblk->bp);
 	return error;
@@ -2146,12 +2195,14 @@ xfs_dir2_node_replace(
 	state = xfs_da_state_alloc();
 	state->args = args;
 	state->mp = args->dp->i_mount;
+
 	/*
 	 * We have to save new inode number and ftype since
 	 * xfs_da3_node_lookup_int() is going to overwrite them
 	 */
 	inum = args->inumber;
 	ftype = args->filetype;
+
 	/*
 	 * Lookup the entry to change in the btree.
 	 */
diff -urpN xfsprogs-4.9.0/libxfs/xfs_dir2_priv.h xfsprogs-4.14.0/libxfs/xfs_dir2_priv.h
--- xfsprogs-4.9.0/libxfs/xfs_dir2_priv.h	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/libxfs/xfs_dir2_priv.h	2017-11-20 01:14:14.000000000 +0100
@@ -58,6 +58,8 @@ extern int xfs_dir3_data_init(struct xfs
 		struct xfs_buf **bpp);
 
 /* xfs_dir2_leaf.c */
+extern int xfs_dir3_leaf_read(struct xfs_trans *tp, struct xfs_inode *dp,
+		xfs_dablk_t fbno, xfs_daddr_t mappedbno, struct xfs_buf **bpp);
 extern int xfs_dir3_leafn_read(struct xfs_trans *tp, struct xfs_inode *dp,
 		xfs_dablk_t fbno, xfs_daddr_t mappedbno, struct xfs_buf **bpp);
 extern int xfs_dir2_block_to_leaf(struct xfs_da_args *args,
@@ -69,7 +71,7 @@ extern void xfs_dir3_leaf_compact_x1(str
 		struct xfs_dir2_leaf_entry *ents, int *indexp,
 		int *lowstalep, int *highstalep, int *lowlogp, int *highlogp);
 extern int xfs_dir3_leaf_get_buf(struct xfs_da_args *args, xfs_dir2_db_t bno,
-		struct xfs_buf **bpp, __uint16_t magic);
+		struct xfs_buf **bpp, uint16_t magic);
 extern void xfs_dir3_leaf_log_ents(struct xfs_da_args *args,
 		struct xfs_buf *bp, int first, int last);
 extern void xfs_dir3_leaf_log_header(struct xfs_da_args *args,
@@ -93,7 +95,7 @@ extern bool xfs_dir3_leaf_check_int(stru
 /* xfs_dir2_node.c */
 extern int xfs_dir2_leaf_to_node(struct xfs_da_args *args,
 		struct xfs_buf *lbp);
-extern xfs_dahash_t xfs_dir2_leafn_lasthash(struct xfs_inode *dp,
+extern xfs_dahash_t xfs_dir2_leaf_lasthash(struct xfs_inode *dp,
 		struct xfs_buf *bp, int *count);
 extern int xfs_dir2_leafn_lookup_int(struct xfs_buf *bp,
 		struct xfs_da_args *args, int *indexp,
@@ -125,9 +127,10 @@ extern int xfs_dir2_sf_create(struct xfs
 extern int xfs_dir2_sf_lookup(struct xfs_da_args *args);
 extern int xfs_dir2_sf_removename(struct xfs_da_args *args);
 extern int xfs_dir2_sf_replace(struct xfs_da_args *args);
+extern int xfs_dir2_sf_verify(struct xfs_inode *ip);
 
 /* xfs_dir2_readdir.c */
-extern int xfs_readdir(struct xfs_inode *dp, struct dir_context *ctx,
-		       size_t bufsize);
+extern int xfs_readdir(struct xfs_trans *tp, struct xfs_inode *dp,
+		       struct dir_context *ctx, size_t bufsize);
 
 #endif /* __XFS_DIR2_PRIV_H__ */
diff -urpN xfsprogs-4.9.0/libxfs/xfs_dir2_sf.c xfsprogs-4.14.0/libxfs/xfs_dir2_sf.c
--- xfsprogs-4.9.0/libxfs/xfs_dir2_sf.c	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/libxfs/xfs_dir2_sf.c	2017-11-20 01:14:14.000000000 +0100
@@ -125,7 +125,7 @@ xfs_dir2_block_sfsize(
 		 * Calculate the new size, see if we should give up yet.
 		 */
 		size = xfs_dir2_sf_hdr_size(i8count) +	/* header */
-		       count * 3 * sizeof(__u8) +	/* namelen + offset */
+		       count * 3 * sizeof(u8) +		/* namelen + offset */
 		       namelen +			/* name */
 		       (i8count ?			/* inumber */
 				count * XFS_INO64_SIZE :
@@ -627,6 +627,112 @@ xfs_dir2_sf_check(
 }
 #endif	/* DEBUG */
 
+/* Verify the consistency of an inline directory. */
+int
+xfs_dir2_sf_verify(
+	struct xfs_inode		*ip)
+{
+	struct xfs_mount		*mp = ip->i_mount;
+	struct xfs_dir2_sf_hdr		*sfp;
+	struct xfs_dir2_sf_entry	*sfep;
+	struct xfs_dir2_sf_entry	*next_sfep;
+	char				*endp;
+	const struct xfs_dir_ops	*dops;
+	struct xfs_ifork		*ifp;
+	xfs_ino_t			ino;
+	int				i;
+	int				i8count;
+	int				offset;
+	int				size;
+	int				error;
+	uint8_t				filetype;
+
+	ASSERT(ip->i_d.di_format == XFS_DINODE_FMT_LOCAL);
+	/*
+	 * xfs_iread calls us before xfs_setup_inode sets up ip->d_ops,
+	 * so we can only trust the mountpoint to have the right pointer.
+	 */
+	dops = xfs_dir_get_ops(mp, NULL);
+
+	ifp = XFS_IFORK_PTR(ip, XFS_DATA_FORK);
+	sfp = (struct xfs_dir2_sf_hdr *)ifp->if_u1.if_data;
+	size = ifp->if_bytes;
+
+	/*
+	 * Give up if the directory is way too short.
+	 */
+	if (size <= offsetof(struct xfs_dir2_sf_hdr, parent) ||
+	    size < xfs_dir2_sf_hdr_size(sfp->i8count))
+		return -EFSCORRUPTED;
+
+	endp = (char *)sfp + size;
+
+	/* Check .. entry */
+	ino = dops->sf_get_parent_ino(sfp);
+	i8count = ino > XFS_DIR2_MAX_SHORT_INUM;
+	error = xfs_dir_ino_validate(mp, ino);
+	if (error)
+		return error;
+	offset = dops->data_first_offset;
+
+	/* Check all reported entries */
+	sfep = xfs_dir2_sf_firstentry(sfp);
+	for (i = 0; i < sfp->count; i++) {
+		/*
+		 * struct xfs_dir2_sf_entry has a variable length.
+		 * Check the fixed-offset parts of the structure are
+		 * within the data buffer.
+		 */
+		if (((char *)sfep + sizeof(*sfep)) >= endp)
+			return -EFSCORRUPTED;
+
+		/* Don't allow names with known bad length. */
+		if (sfep->namelen == 0)
+			return -EFSCORRUPTED;
+
+		/*
+		 * Check that the variable-length part of the structure is
+		 * within the data buffer.  The next entry starts after the
+		 * name component, so nextentry is an acceptable test.
+		 */
+		next_sfep = dops->sf_nextentry(sfp, sfep);
+		if (endp < (char *)next_sfep)
+			return -EFSCORRUPTED;
+
+		/* Check that the offsets always increase. */
+		if (xfs_dir2_sf_get_offset(sfep) < offset)
+			return -EFSCORRUPTED;
+
+		/* Check the inode number. */
+		ino = dops->sf_get_ino(sfp, sfep);
+		i8count += ino > XFS_DIR2_MAX_SHORT_INUM;
+		error = xfs_dir_ino_validate(mp, ino);
+		if (error)
+			return error;
+
+		/* Check the file type. */
+		filetype = dops->sf_get_ftype(sfep);
+		if (filetype >= XFS_DIR3_FT_MAX)
+			return -EFSCORRUPTED;
+
+		offset = xfs_dir2_sf_get_offset(sfep) +
+				dops->data_entsize(sfep->namelen);
+
+		sfep = next_sfep;
+	}
+	if (i8count != sfp->i8count)
+		return -EFSCORRUPTED;
+	if ((void *)sfep != (void *)endp)
+		return -EFSCORRUPTED;
+
+	/* Make sure this whole thing ought to be in local format. */
+	if (offset + (sfp->count + 2) * (uint)sizeof(xfs_dir2_leaf_entry_t) +
+	    (uint)sizeof(xfs_dir2_block_tail_t) > mp->m_dir_geo->blksize)
+		return -EFSCORRUPTED;
+
+	return 0;
+}
+
 /*
  * Create a new (shortform) directory.
  */
diff -urpN xfsprogs-4.9.0/libxfs/xfs_dquot_buf.c xfsprogs-4.14.0/libxfs/xfs_dquot_buf.c
--- xfsprogs-4.9.0/libxfs/xfs_dquot_buf.c	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/libxfs/xfs_dquot_buf.c	2017-11-20 01:14:14.000000000 +0100
@@ -29,27 +29,12 @@
 #include "xfs_trace.h"
 #include "xfs_quota_defs.h"
 
-/*
- * XXX: kernel implementation causes ndquots calc to go real
- * bad. Just leaving the existing userspace calc here right now.
- */
 int
 xfs_calc_dquots_per_chunk(
 	unsigned int		nbblks)	/* basic block units */
 {
-
 	ASSERT(nbblks > 0);
 	return BBTOB(nbblks) / sizeof(xfs_dqblk_t);
-
-#if 0	/* kernel code that goes wrong in userspace! */
-	unsigned int	ndquots;
-
-	ASSERT(nbblks > 0);
-	ndquots = BBTOB(nbblks);
-	do_div(ndquots, sizeof(xfs_dqblk_t));
-
-	return ndquots;
-#endif
 }
 
 /*
diff -urpN xfsprogs-4.9.0/libxfs/xfs_format.h xfsprogs-4.14.0/libxfs/xfs_format.h
--- xfsprogs-4.9.0/libxfs/xfs_format.h	2017-01-05 18:41:55.000000000 +0100
+++ xfsprogs-4.14.0/libxfs/xfs_format.h	2017-11-27 17:57:55.000000000 +0100
@@ -103,8 +103,8 @@ struct xfs_ifork;
  * Must be padded to 64 bit alignment.
  */
 typedef struct xfs_sb {
-	__uint32_t	sb_magicnum;	/* magic number == XFS_SB_MAGIC */
-	__uint32_t	sb_blocksize;	/* logical block size, bytes */
+	uint32_t	sb_magicnum;	/* magic number == XFS_SB_MAGIC */
+	uint32_t	sb_blocksize;	/* logical block size, bytes */
 	xfs_rfsblock_t	sb_dblocks;	/* number of data blocks */
 	xfs_rfsblock_t	sb_rblocks;	/* number of realtime blocks */
 	xfs_rtblock_t	sb_rextents;	/* number of realtime extents */
@@ -118,45 +118,45 @@ typedef struct xfs_sb {
 	xfs_agnumber_t	sb_agcount;	/* number of allocation groups */
 	xfs_extlen_t	sb_rbmblocks;	/* number of rt bitmap blocks */
 	xfs_extlen_t	sb_logblocks;	/* number of log blocks */
-	__uint16_t	sb_versionnum;	/* header version == XFS_SB_VERSION */
-	__uint16_t	sb_sectsize;	/* volume sector size, bytes */
-	__uint16_t	sb_inodesize;	/* inode size, bytes */
-	__uint16_t	sb_inopblock;	/* inodes per block */
+	uint16_t	sb_versionnum;	/* header version == XFS_SB_VERSION */
+	uint16_t	sb_sectsize;	/* volume sector size, bytes */
+	uint16_t	sb_inodesize;	/* inode size, bytes */
+	uint16_t	sb_inopblock;	/* inodes per block */
 	char		sb_fname[12];	/* file system name */
-	__uint8_t	sb_blocklog;	/* log2 of sb_blocksize */
-	__uint8_t	sb_sectlog;	/* log2 of sb_sectsize */
-	__uint8_t	sb_inodelog;	/* log2 of sb_inodesize */
-	__uint8_t	sb_inopblog;	/* log2 of sb_inopblock */
-	__uint8_t	sb_agblklog;	/* log2 of sb_agblocks (rounded up) */
-	__uint8_t	sb_rextslog;	/* log2 of sb_rextents */
-	__uint8_t	sb_inprogress;	/* mkfs is in progress, don't mount */
-	__uint8_t	sb_imax_pct;	/* max % of fs for inode space */
+	uint8_t		sb_blocklog;	/* log2 of sb_blocksize */
+	uint8_t		sb_sectlog;	/* log2 of sb_sectsize */
+	uint8_t		sb_inodelog;	/* log2 of sb_inodesize */
+	uint8_t		sb_inopblog;	/* log2 of sb_inopblock */
+	uint8_t		sb_agblklog;	/* log2 of sb_agblocks (rounded up) */
+	uint8_t		sb_rextslog;	/* log2 of sb_rextents */
+	uint8_t		sb_inprogress;	/* mkfs is in progress, don't mount */
+	uint8_t		sb_imax_pct;	/* max % of fs for inode space */
 					/* statistics */
 	/*
 	 * These fields must remain contiguous.  If you really
 	 * want to change their layout, make sure you fix the
 	 * code in xfs_trans_apply_sb_deltas().
 	 */
-	__uint64_t	sb_icount;	/* allocated inodes */
-	__uint64_t	sb_ifree;	/* free inodes */
-	__uint64_t	sb_fdblocks;	/* free data blocks */
-	__uint64_t	sb_frextents;	/* free realtime extents */
+	uint64_t	sb_icount;	/* allocated inodes */
+	uint64_t	sb_ifree;	/* free inodes */
+	uint64_t	sb_fdblocks;	/* free data blocks */
+	uint64_t	sb_frextents;	/* free realtime extents */
 	/*
 	 * End contiguous fields.
 	 */
 	xfs_ino_t	sb_uquotino;	/* user quota inode */
 	xfs_ino_t	sb_gquotino;	/* group quota inode */
-	__uint16_t	sb_qflags;	/* quota flags */
-	__uint8_t	sb_flags;	/* misc. flags */
-	__uint8_t	sb_shared_vn;	/* shared version number */
+	uint16_t	sb_qflags;	/* quota flags */
+	uint8_t		sb_flags;	/* misc. flags */
+	uint8_t		sb_shared_vn;	/* shared version number */
 	xfs_extlen_t	sb_inoalignmt;	/* inode chunk alignment, fsblocks */
-	__uint32_t	sb_unit;	/* stripe or raid unit */
-	__uint32_t	sb_width;	/* stripe or raid width */
-	__uint8_t	sb_dirblklog;	/* log2 of dir block size (fsbs) */
-	__uint8_t	sb_logsectlog;	/* log2 of the log sector size */
-	__uint16_t	sb_logsectsize;	/* sector size for the log, bytes */
-	__uint32_t	sb_logsunit;	/* stripe unit size for the log */
-	__uint32_t	sb_features2;	/* additional feature bits */
+	uint32_t	sb_unit;	/* stripe or raid unit */
+	uint32_t	sb_width;	/* stripe or raid width */
+	uint8_t		sb_dirblklog;	/* log2 of dir block size (fsbs) */
+	uint8_t		sb_logsectlog;	/* log2 of the log sector size */
+	uint16_t	sb_logsectsize;	/* sector size for the log, bytes */
+	uint32_t	sb_logsunit;	/* stripe unit size for the log */
+	uint32_t	sb_features2;	/* additional feature bits */
 
 	/*
 	 * bad features2 field as a result of failing to pad the sb structure to
@@ -167,17 +167,17 @@ typedef struct xfs_sb {
 	 * the value in sb_features2 when formatting the incore superblock to
 	 * the disk buffer.
 	 */
-	__uint32_t	sb_bad_features2;
+	uint32_t	sb_bad_features2;
 
 	/* version 5 superblock fields start here */
 
 	/* feature masks */
-	__uint32_t	sb_features_compat;
-	__uint32_t	sb_features_ro_compat;
-	__uint32_t	sb_features_incompat;
-	__uint32_t	sb_features_log_incompat;
+	uint32_t	sb_features_compat;
+	uint32_t	sb_features_ro_compat;
+	uint32_t	sb_features_incompat;
+	uint32_t	sb_features_log_incompat;
 
-	__uint32_t	sb_crc;		/* superblock crc */
+	uint32_t	sb_crc;		/* superblock crc */
 	xfs_extlen_t	sb_spino_align;	/* sparse inode chunk alignment */
 
 	xfs_ino_t	sb_pquotino;	/* project quota inode */
@@ -449,7 +449,7 @@ static inline void xfs_sb_version_addpro
 static inline bool
 xfs_sb_has_compat_feature(
 	struct xfs_sb	*sbp,
-	__uint32_t	feature)
+	uint32_t	feature)
 {
 	return (sbp->sb_features_compat & feature) != 0;
 }
@@ -465,7 +465,7 @@ xfs_sb_has_compat_feature(
 static inline bool
 xfs_sb_has_ro_compat_feature(
 	struct xfs_sb	*sbp,
-	__uint32_t	feature)
+	uint32_t	feature)
 {
 	return (sbp->sb_features_ro_compat & feature) != 0;
 }
@@ -473,7 +473,6 @@ xfs_sb_has_ro_compat_feature(
 #define XFS_SB_FEAT_INCOMPAT_FTYPE	(1 << 0)	/* filetype in dirent */
 #define XFS_SB_FEAT_INCOMPAT_SPINODES	(1 << 1)	/* sparse inode chunks */
 #define XFS_SB_FEAT_INCOMPAT_META_UUID	(1 << 2)	/* metadata UUID */
-
 #define XFS_SB_FEAT_INCOMPAT_ALL \
 		(XFS_SB_FEAT_INCOMPAT_FTYPE|	\
 		 XFS_SB_FEAT_INCOMPAT_SPINODES|	\
@@ -483,7 +482,7 @@ xfs_sb_has_ro_compat_feature(
 static inline bool
 xfs_sb_has_incompat_feature(
 	struct xfs_sb	*sbp,
-	__uint32_t	feature)
+	uint32_t	feature)
 {
 	return (sbp->sb_features_incompat & feature) != 0;
 }
@@ -493,7 +492,7 @@ xfs_sb_has_incompat_feature(
 static inline bool
 xfs_sb_has_incompat_log_feature(
 	struct xfs_sb	*sbp,
-	__uint32_t	feature)
+	uint32_t	feature)
 {
 	return (sbp->sb_features_log_incompat & feature) != 0;
 }
@@ -537,7 +536,7 @@ static inline bool xfs_sb_version_hasspa
  * user-visible UUID to be changed on V5 filesystems which have a
  * filesystem UUID stamped into every piece of metadata.
  */
-static inline int xfs_sb_version_hasmetauuid(xfs_sb_t *sbp)
+static inline bool xfs_sb_version_hasmetauuid(struct xfs_sb *sbp)
 {
 	return (XFS_SB_VERSION_NUM(sbp) == XFS_SB_VERSION_5) &&
 		(sbp->sb_features_incompat & XFS_SB_FEAT_INCOMPAT_META_UUID);
@@ -595,8 +594,8 @@ xfs_is_quota_inode(struct xfs_sb *sbp, x
  */
 #define XFS_FSB_TO_B(mp,fsbno)	((xfs_fsize_t)(fsbno) << (mp)->m_sb.sb_blocklog)
 #define XFS_B_TO_FSB(mp,b)	\
-	((((__uint64_t)(b)) + (mp)->m_blockmask) >> (mp)->m_sb.sb_blocklog)
-#define XFS_B_TO_FSBT(mp,b)	(((__uint64_t)(b)) >> (mp)->m_sb.sb_blocklog)
+	((((uint64_t)(b)) + (mp)->m_blockmask) >> (mp)->m_sb.sb_blocklog)
+#define XFS_B_TO_FSBT(mp,b)	(((uint64_t)(b)) >> (mp)->m_sb.sb_blocklog)
 #define XFS_B_FSB_OFFSET(mp,b)	((b) & (mp)->m_blockmask)
 
 /*
@@ -931,10 +930,8 @@ static inline uint xfs_dinode_size(int v
 /*
  * The 32 bit link count in the inode theoretically maxes out at UINT_MAX.
  * Since the pathconf interface is signed, we use 2^31 - 1 instead.
- * The old inode format had a 16 bit link count, so its maximum is USHRT_MAX.
  */
 #define	XFS_MAXLINK		((1U << 31) - 1U)
-#define	XFS_MAXLINK_1		65535U
 
 /*
  * Values for di_format
@@ -1075,7 +1072,7 @@ static inline void xfs_dinode_put_rdev(s
  * next agno_log bits - ag number
  * high agno_log-agblklog-inopblog bits - 0
  */
-#define	XFS_INO_MASK(k)			(__uint32_t)((1ULL << (k)) - 1)
+#define	XFS_INO_MASK(k)			(uint32_t)((1ULL << (k)) - 1)
 #define	XFS_INO_OFFSET_BITS(mp)		(mp)->m_sb.sb_inopblog
 #define	XFS_INO_AGBNO_BITS(mp)		(mp)->m_sb.sb_agblklog
 #define	XFS_INO_AGINO_BITS(mp)		(mp)->m_agino_log
@@ -1145,7 +1142,7 @@ static inline void xfs_dinode_put_rdev(s
  * Dquot and dquot block format definitions
  */
 #define XFS_DQUOT_MAGIC		0x4451		/* 'DQ' */
-#define XFS_DQUOT_VERSION	(u_int8_t)0x01	/* latest version number */
+#define XFS_DQUOT_VERSION	(uint8_t)0x01	/* latest version number */
 
 /*
  * This is the main portion of the on-disk representation of quota
@@ -1214,6 +1211,7 @@ struct xfs_dsymlink_hdr {
 
 #define XFS_SYMLINK_CRC_OFF	offsetof(struct xfs_dsymlink_hdr, sl_crc)
 
+#define XFS_SYMLINK_MAXLEN	1024
 /*
  * The maximum pathlen is 1024 bytes. Since the minimum file system
  * blocksize is 512 bytes, we can get a max of 3 extents back from
@@ -1272,16 +1270,16 @@ typedef __be32 xfs_alloc_ptr_t;
 #define	XFS_FIBT_MAGIC		0x46494254	/* 'FIBT' */
 #define	XFS_FIBT_CRC_MAGIC	0x46494233	/* 'FIB3' */
 
-typedef	__uint64_t	xfs_inofree_t;
+typedef uint64_t	xfs_inofree_t;
 #define	XFS_INODES_PER_CHUNK		(NBBY * sizeof(xfs_inofree_t))
 #define	XFS_INODES_PER_CHUNK_LOG	(XFS_NBBYLOG + 3)
 #define	XFS_INOBT_ALL_FREE		((xfs_inofree_t)-1)
 #define	XFS_INOBT_MASK(i)		((xfs_inofree_t)1 << (i))
 
 #define XFS_INOBT_HOLEMASK_FULL		0	/* holemask for full chunk */
-#define XFS_INOBT_HOLEMASK_BITS		(NBBY * sizeof(__uint16_t))
+#define XFS_INOBT_HOLEMASK_BITS		(NBBY * sizeof(uint16_t))
 #define XFS_INODES_PER_HOLEMASK_BIT	\
-	(XFS_INODES_PER_CHUNK / (NBBY * sizeof(__uint16_t)))
+	(XFS_INODES_PER_CHUNK / (NBBY * sizeof(uint16_t)))
 
 static inline xfs_inofree_t xfs_inobt_maskn(int i, int n)
 {
@@ -1315,9 +1313,9 @@ typedef struct xfs_inobt_rec {
 
 typedef struct xfs_inobt_rec_incore {
 	xfs_agino_t	ir_startino;	/* starting inode number */
-	__uint16_t	ir_holemask;	/* hole mask for sparse chunks */
-	__uint8_t	ir_count;	/* total inode count */
-	__uint8_t	ir_freecount;	/* count of free inodes (set bits) */
+	uint16_t	ir_holemask;	/* hole mask for sparse chunks */
+	uint8_t		ir_count;	/* total inode count */
+	uint8_t		ir_freecount;	/* count of free inodes (set bits) */
 	xfs_inofree_t	ir_free;	/* free inode mask */
 } xfs_inobt_rec_incore_t;
 
@@ -1400,15 +1398,15 @@ struct xfs_rmap_rec {
  *  rm_offset:54-60 aren't used and should be zero
  *  rm_offset:0-53 is the block offset within the inode
  */
-#define XFS_RMAP_OFF_ATTR_FORK	((__uint64_t)1ULL << 63)
-#define XFS_RMAP_OFF_BMBT_BLOCK	((__uint64_t)1ULL << 62)
-#define XFS_RMAP_OFF_UNWRITTEN	((__uint64_t)1ULL << 61)
+#define XFS_RMAP_OFF_ATTR_FORK	((uint64_t)1ULL << 63)
+#define XFS_RMAP_OFF_BMBT_BLOCK	((uint64_t)1ULL << 62)
+#define XFS_RMAP_OFF_UNWRITTEN	((uint64_t)1ULL << 61)
 
-#define XFS_RMAP_LEN_MAX	((__uint32_t)~0U)
+#define XFS_RMAP_LEN_MAX	((uint32_t)~0U)
 #define XFS_RMAP_OFF_FLAGS	(XFS_RMAP_OFF_ATTR_FORK | \
 				 XFS_RMAP_OFF_BMBT_BLOCK | \
 				 XFS_RMAP_OFF_UNWRITTEN)
-#define XFS_RMAP_OFF_MASK	((__uint64_t)0x3FFFFFFFFFFFFFULL)
+#define XFS_RMAP_OFF_MASK	((uint64_t)0x3FFFFFFFFFFFFFULL)
 
 #define XFS_RMAP_OFF(off)		((off) & XFS_RMAP_OFF_MASK)
 
@@ -1434,8 +1432,8 @@ struct xfs_rmap_rec {
 struct xfs_rmap_irec {
 	xfs_agblock_t	rm_startblock;	/* extent start block */
 	xfs_extlen_t	rm_blockcount;	/* extent length */
-	__uint64_t	rm_owner;	/* extent owner */
-	__uint64_t	rm_offset;	/* offset within the owner */
+	uint64_t	rm_owner;	/* extent owner */
+	uint64_t	rm_offset;	/* offset within the owner */
 	unsigned int	rm_flags;	/* state flags */
 };
 
@@ -1547,11 +1545,11 @@ typedef struct xfs_bmbt_rec {
 	__be64			l0, l1;
 } xfs_bmbt_rec_t;
 
-typedef __uint64_t	xfs_bmbt_rec_base_t;	/* use this for casts */
+typedef uint64_t	xfs_bmbt_rec_base_t;	/* use this for casts */
 typedef xfs_bmbt_rec_t xfs_bmdr_rec_t;
 
 typedef struct xfs_bmbt_rec_host {
-	__uint64_t		l0, l1;
+	uint64_t		l0, l1;
 } xfs_bmbt_rec_host_t;
 
 /*
@@ -1579,19 +1577,10 @@ static inline xfs_filblks_t startblockva
 }
 
 /*
- * Possible extent formats.
- */
-typedef enum {
-	XFS_EXTFMT_NOSTATE = 0,
-	XFS_EXTFMT_HASSTATE
-} xfs_exntfmt_t;
-
-/*
  * Possible extent states.
  */
 typedef enum {
 	XFS_EXT_NORM, XFS_EXT_UNWRITTEN,
-	XFS_EXT_DMAPI_OFFLINE, XFS_EXT_INVALID
 } xfs_exntst_t;
 
 /*
diff -urpN xfsprogs-4.9.0/libxfs/xfs_fs.h xfsprogs-4.14.0/libxfs/xfs_fs.h
--- xfsprogs-4.9.0/libxfs/xfs_fs.h	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/libxfs/xfs_fs.h	2017-11-27 17:57:52.000000000 +0100
@@ -56,9 +56,6 @@ struct dioattr {
 #define	XFS_XFLAG_FILESTREAM	FS_XFLAG_FILESTREAM
 #define	XFS_XFLAG_HASATTR	FS_XFLAG_HASATTR
 
-#define XFS_IOC_FSGETXATTR	FS_IOC_FSGETXATTR
-#define XFS_IOC_FSSETXATTR	FS_IOC_FSSETXATTR
-
 /*
  * Structure for XFS_IOC_GETBMAP.
  * On input, fill in bmv_offset and bmv_length of the first structure
@@ -116,6 +113,18 @@ struct getbmapx {
 #define BMV_OF_LAST		0x4	/* segment is the last in the file */
 #define BMV_OF_SHARED		0x8	/* segment shared with another file */
 
+/*	fmr_owner special values for FS_IOC_GETFSMAP */
+#define XFS_FMR_OWN_FREE	FMR_OWN_FREE      /* free space */
+#define XFS_FMR_OWN_UNKNOWN	FMR_OWN_UNKNOWN   /* unknown owner */
+#define XFS_FMR_OWN_FS		FMR_OWNER('X', 1) /* static fs metadata */
+#define XFS_FMR_OWN_LOG		FMR_OWNER('X', 2) /* journalling log */
+#define XFS_FMR_OWN_AG		FMR_OWNER('X', 3) /* per-AG metadata */
+#define XFS_FMR_OWN_INOBT	FMR_OWNER('X', 4) /* inode btree blocks */
+#define XFS_FMR_OWN_INODES	FMR_OWNER('X', 5) /* inodes */
+#define XFS_FMR_OWN_REFC	FMR_OWNER('X', 6) /* refcount tree */
+#define XFS_FMR_OWN_COW		FMR_OWNER('X', 7) /* cow staging */
+#define XFS_FMR_OWN_DEFECTIVE	FMR_OWNER('X', 8) /* bad blocks */
+
 /*
  * Structure for XFS_IOC_FSSETDM.
  * For use by backup and restore programs to set the XFS on-disk inode
@@ -314,10 +323,10 @@ typedef struct xfs_bstat {
  * and using two 16bit values to hold new 32bit projid was choosen
  * to retain compatibility with "old" filesystems).
  */
-static inline __uint32_t
+static inline uint32_t
 bstat_get_projid(struct xfs_bstat *bs)
 {
-	return (__uint32_t)bs->bs_projid_hi << 16 | bs->bs_projid_lo;
+	return (uint32_t)bs->bs_projid_hi << 16 | bs->bs_projid_lo;
 }
 
 /*
@@ -458,19 +467,15 @@ typedef struct xfs_handle {
 } xfs_handle_t;
 #define ha_fsid ha_u._ha_fsid
 
-#define XFS_HSIZE(handle)	(((char *) &(handle).ha_fid.fid_pad	 \
-				 - (char *) &(handle))			  \
-				 + (handle).ha_fid.fid_len)
-
 /*
  * Structure passed to XFS_IOC_SWAPEXT
  */
 typedef struct xfs_swapext
 {
-	__int64_t	sx_version;	/* version */
+	int64_t		sx_version;	/* version */
 #define XFS_SX_VERSION		0
-	__int64_t	sx_fdtarget;	/* fd of target file */
-	__int64_t	sx_fdtmp;	/* fd of tmp file */
+	int64_t		sx_fdtarget;	/* fd of target file */
+	int64_t		sx_fdtmp;	/* fd of tmp file */
 	xfs_off_t	sx_offset;	/* offset into file */
 	xfs_off_t	sx_length;	/* leng from offset */
 	char		sx_pad[16];	/* pad space, unused */
@@ -508,6 +513,8 @@ typedef struct xfs_swapext
 #define XFS_IOC_ALLOCSP		_IOW ('X', 10, struct xfs_flock64)
 #define XFS_IOC_FREESP		_IOW ('X', 11, struct xfs_flock64)
 #define XFS_IOC_DIOINFO		_IOR ('X', 30, struct dioattr)
+#define XFS_IOC_FSGETXATTR	FS_IOC_FSGETXATTR
+#define XFS_IOC_FSSETXATTR	FS_IOC_FSSETXATTR
 #define XFS_IOC_ALLOCSP64	_IOW ('X', 36, struct xfs_flock64)
 #define XFS_IOC_FREESP64	_IOW ('X', 37, struct xfs_flock64)
 #define XFS_IOC_GETBMAP		_IOWR('X', 38, struct getbmap)
@@ -523,6 +530,7 @@ typedef struct xfs_swapext
 #define XFS_IOC_GETBMAPX	_IOWR('X', 56, struct getbmap)
 #define XFS_IOC_ZERO_RANGE	_IOW ('X', 57, struct xfs_flock64)
 #define XFS_IOC_FREE_EOFBLOCKS	_IOR ('X', 58, struct xfs_fs_eofblocks)
+/*	XFS_IOC_GETFSMAP ------ hoisted 59         */
 
 /*
  * ioctl commands that replace IRIX syssgi()'s
@@ -554,7 +562,7 @@ typedef struct xfs_swapext
 #define XFS_IOC_ATTRLIST_BY_HANDLE   _IOW ('X', 122, struct xfs_fsop_attrlist_handlereq)
 #define XFS_IOC_ATTRMULTI_BY_HANDLE  _IOW ('X', 123, struct xfs_fsop_attrmulti_handlereq)
 #define XFS_IOC_FSGEOMETRY	     _IOR ('X', 124, struct xfs_fsop_geom)
-#define XFS_IOC_GOINGDOWN	     _IOR ('X', 125, __uint32_t)
+#define XFS_IOC_GOINGDOWN	     _IOR ('X', 125, uint32_t)
 /*	XFS_IOC_GETFSUUID ---------- deprecated 140	 */
 
 /* reflink ioctls; these MUST match the btrfs ioctl definitions */
diff -urpN xfsprogs-4.9.0/libxfs/xfs_ialloc.c xfsprogs-4.14.0/libxfs/xfs_ialloc.c
--- xfsprogs-4.9.0/libxfs/xfs_ialloc.c	2017-01-05 18:41:55.000000000 +0100
+++ xfsprogs-4.14.0/libxfs/xfs_ialloc.c	2017-11-27 17:57:55.000000000 +0100
@@ -40,13 +40,12 @@
 /*
  * Allocation group level functions.
  */
-static inline int
+int
 xfs_ialloc_cluster_alignment(
 	struct xfs_mount	*mp)
 {
 	if (xfs_sb_version_hasalign(&mp->m_sb) &&
-	    mp->m_sb.sb_inoalignmt >=
-			XFS_B_TO_FSBT(mp, mp->m_inode_cluster_size))
+	    mp->m_sb.sb_inoalignmt >= xfs_icluster_size_fsb(mp))
 		return mp->m_sb.sb_inoalignmt;
 	return 1;
 }
@@ -93,24 +92,15 @@ xfs_inobt_update(
 	return xfs_btree_update(cur, &rec);
 }
 
-/*
- * Get the data from the pointed-to record.
- */
-int					/* error */
-xfs_inobt_get_rec(
-	struct xfs_btree_cur	*cur,	/* btree cursor */
-	xfs_inobt_rec_incore_t	*irec,	/* btree record */
-	int			*stat)	/* output: success/failure */
+/* Convert on-disk btree record to incore inobt record. */
+void
+xfs_inobt_btrec_to_irec(
+	struct xfs_mount		*mp,
+	union xfs_btree_rec		*rec,
+	struct xfs_inobt_rec_incore	*irec)
 {
-	union xfs_btree_rec	*rec;
-	int			error;
-
-	error = xfs_btree_get_rec(cur, &rec, stat);
-	if (error || *stat == 0)
-		return error;
-
 	irec->ir_startino = be32_to_cpu(rec->inobt.ir_startino);
-	if (xfs_sb_version_hassparseinodes(&cur->bc_mp->m_sb)) {
+	if (xfs_sb_version_hassparseinodes(&mp->m_sb)) {
 		irec->ir_holemask = be16_to_cpu(rec->inobt.ir_u.sp.ir_holemask);
 		irec->ir_count = rec->inobt.ir_u.sp.ir_count;
 		irec->ir_freecount = rec->inobt.ir_u.sp.ir_freecount;
@@ -125,6 +115,25 @@ xfs_inobt_get_rec(
 				be32_to_cpu(rec->inobt.ir_u.f.ir_freecount);
 	}
 	irec->ir_free = be64_to_cpu(rec->inobt.ir_free);
+}
+
+/*
+ * Get the data from the pointed-to record.
+ */
+int
+xfs_inobt_get_rec(
+	struct xfs_btree_cur		*cur,
+	struct xfs_inobt_rec_incore	*irec,
+	int				*stat)
+{
+	union xfs_btree_rec		*rec;
+	int				error;
+
+	error = xfs_btree_get_rec(cur, &rec, stat);
+	if (error || *stat == 0)
+		return error;
+
+	xfs_inobt_btrec_to_irec(cur->bc_mp, rec, irec);
 
 	return 0;
 }
@@ -135,9 +144,9 @@ xfs_inobt_get_rec(
 STATIC int
 xfs_inobt_insert_rec(
 	struct xfs_btree_cur	*cur,
-	__uint16_t		holemask,
-	__uint8_t		count,
-	__int32_t		freecount,
+	uint16_t		holemask,
+	uint8_t			count,
+	int32_t			freecount,
 	xfs_inofree_t		free,
 	int			*stat)
 {
@@ -363,8 +372,6 @@ xfs_ialloc_inode_init(
 				 * transaction and pin the log appropriately.
 				 */
 				xfs_trans_ordered_buf(tp, fbuf);
-				xfs_trans_log_buf(tp, fbuf, 0,
-						  BBTOB(fbuf->b_length) - 1);
 			}
 		} else {
 			fbuf->b_flags |= XBF_DONE;
@@ -1118,6 +1125,7 @@ xfs_dialloc_ag_inobt(
 	int			error;
 	int			offset;
 	int			i, j;
+	int			searchdistance = 10;
 
 	pag = xfs_perag_get(mp, agno);
 
@@ -1144,7 +1152,6 @@ xfs_dialloc_ag_inobt(
 	if (pagno == agno) {
 		int		doneleft;	/* done, to the left */
 		int		doneright;	/* done, to the right */
-		int		searchdistance = 10;
 
 		error = xfs_inobt_lookup(cur, pagino, XFS_LOOKUP_LE, &i);
 		if (error)
@@ -1205,21 +1212,9 @@ xfs_dialloc_ag_inobt(
 		/*
 		 * Loop until we find an inode chunk with a free inode.
 		 */
-		while (!doneleft || !doneright) {
+		while (--searchdistance > 0 && (!doneleft || !doneright)) {
 			int	useleft;  /* using left inode chunk this time */
 
-			if (!--searchdistance) {
-				/*
-				 * Not in range - save last search
-				 * location and allocate a new inode
-				 */
-				xfs_btree_del_cursor(tcur, XFS_BTREE_NOERROR);
-				pag->pagl_leftrec = trec.ir_startino;
-				pag->pagl_rightrec = rec.ir_startino;
-				pag->pagl_pagino = pagino;
-				goto newino;
-			}
-
 			/* figure out the closer block if both are valid. */
 			if (!doneleft && !doneright) {
 				useleft = pagino -
@@ -1231,13 +1226,13 @@ xfs_dialloc_ag_inobt(
 
 			/* free inodes to the left? */
 			if (useleft && trec.ir_freecount) {
-				rec = trec;
 				xfs_btree_del_cursor(cur, XFS_BTREE_NOERROR);
 				cur = tcur;
 
 				pag->pagl_leftrec = trec.ir_startino;
 				pag->pagl_rightrec = rec.ir_startino;
 				pag->pagl_pagino = pagino;
+				rec = trec;
 				goto alloc_inode;
 			}
 
@@ -1263,26 +1258,37 @@ xfs_dialloc_ag_inobt(
 				goto error1;
 		}
 
-		/*
-		 * We've reached the end of the btree. because
-		 * we are only searching a small chunk of the
-		 * btree each search, there is obviously free
-		 * inodes closer to the parent inode than we
-		 * are now. restart the search again.
-		 */
-		pag->pagl_pagino = NULLAGINO;
-		pag->pagl_leftrec = NULLAGINO;
-		pag->pagl_rightrec = NULLAGINO;
-		xfs_btree_del_cursor(tcur, XFS_BTREE_NOERROR);
-		xfs_btree_del_cursor(cur, XFS_BTREE_NOERROR);
-		goto restart_pagno;
+		if (searchdistance <= 0) {
+			/*
+			 * Not in range - save last search
+			 * location and allocate a new inode
+			 */
+			xfs_btree_del_cursor(tcur, XFS_BTREE_NOERROR);
+			pag->pagl_leftrec = trec.ir_startino;
+			pag->pagl_rightrec = rec.ir_startino;
+			pag->pagl_pagino = pagino;
+
+		} else {
+			/*
+			 * We've reached the end of the btree. because
+			 * we are only searching a small chunk of the
+			 * btree each search, there is obviously free
+			 * inodes closer to the parent inode than we
+			 * are now. restart the search again.
+			 */
+			pag->pagl_pagino = NULLAGINO;
+			pag->pagl_leftrec = NULLAGINO;
+			pag->pagl_rightrec = NULLAGINO;
+			xfs_btree_del_cursor(tcur, XFS_BTREE_NOERROR);
+			xfs_btree_del_cursor(cur, XFS_BTREE_NOERROR);
+			goto restart_pagno;
+		}
 	}
 
 	/*
 	 * In a different AG from the parent.
 	 * See if the most recently allocated block has any free.
 	 */
-newino:
 	if (agi->agi_newino != cpu_to_be32(NULLAGINO)) {
 		error = xfs_inobt_lookup(cur, be32_to_cpu(agi->agi_newino),
 					 XFS_LOOKUP_EQ, &i);
@@ -1950,7 +1956,7 @@ xfs_difree_inobt(
 	if (!(mp->m_flags & XFS_MOUNT_IKEEP) &&
 	    rec.ir_free == XFS_INOBT_ALL_FREE &&
 	    mp->m_sb.sb_inopblock <= XFS_INODES_PER_CHUNK) {
-		xic->deleted = 1;
+		xic->deleted = true;
 		xic->first_ino = XFS_AGINO_TO_INO(mp, agno, rec.ir_startino);
 		xic->alloc = xfs_inobt_irec_to_allocmask(&rec);
 
@@ -1977,7 +1983,7 @@ xfs_difree_inobt(
 
 		xfs_difree_inode_chunk(mp, agno, &rec, dfops);
 	} else {
-		xic->deleted = 0;
+		xic->deleted = false;
 
 		error = xfs_inobt_update(cur, &rec);
 		if (error) {
@@ -2232,7 +2238,7 @@ xfs_imap_lookup(
 	}
 
 	xfs_trans_brelse(tp, agbp);
-	xfs_btree_del_cursor(cur, XFS_BTREE_NOERROR);
+	xfs_btree_del_cursor(cur, error ? XFS_BTREE_ERROR : XFS_BTREE_NOERROR);
 	if (error)
 		return error;
 
@@ -2338,7 +2344,8 @@ xfs_imap(
 
 		imap->im_blkno = XFS_AGB_TO_DADDR(mp, agno, agbno);
 		imap->im_len = XFS_FSB_TO_BB(mp, 1);
-		imap->im_boffset = (unsigned short)(offset << mp->m_sb.sb_inodelog);
+		imap->im_boffset = (unsigned short)(offset <<
+							mp->m_sb.sb_inodelog);
 		return 0;
 	}
 
@@ -2444,8 +2451,6 @@ xfs_ialloc_log_agi(
 	ASSERT(agi->agi_magicnum == cpu_to_be32(XFS_AGI_MAGIC));
 #endif
 
-	xfs_trans_buf_set_type(tp, bp, XFS_BLFT_AGI_BUF);
-
 	/*
 	 * Compute byte offsets for the first and last fields in the first
 	 * region and log the agi buffer. This only logs up through
@@ -2506,8 +2511,15 @@ xfs_agi_verify(
 	if (!XFS_AGI_GOOD_VERSION(be32_to_cpu(agi->agi_versionnum)))
 		return false;
 
-	if (be32_to_cpu(agi->agi_level) > XFS_BTREE_MAXLEVELS)
+	if (be32_to_cpu(agi->agi_level) < 1 ||
+	    be32_to_cpu(agi->agi_level) > XFS_BTREE_MAXLEVELS)
 		return false;
+
+	if (xfs_sb_version_hasfinobt(&mp->m_sb) &&
+	    (be32_to_cpu(agi->agi_free_level) < 1 ||
+	     be32_to_cpu(agi->agi_free_level) > XFS_BTREE_MAXLEVELS))
+		return false;
+
 	/*
 	 * during growfs operations, the perag is not fully initialised,
 	 * so we can't use it for any useful checking. growfs ensures we can't
@@ -2531,8 +2543,7 @@ xfs_agi_read_verify(
 	    !xfs_buf_verify_cksum(bp, XFS_AGI_CRC_OFF))
 		xfs_buf_ioerror(bp, -EFSBADCRC);
 	else if (XFS_TEST_ERROR(!xfs_agi_verify(bp), mp,
-				XFS_ERRTAG_IALLOC_READ_AGI,
-				XFS_RANDOM_IALLOC_READ_AGI))
+				XFS_ERRTAG_IALLOC_READ_AGI))
 		xfs_buf_ioerror(bp, -EFSCORRUPTED);
 
 	if (bp->b_error)
@@ -2586,6 +2597,8 @@ xfs_read_agi(
 			XFS_FSS_TO_BB(mp, 1), 0, bpp, &xfs_agi_buf_ops);
 	if (error)
 		return error;
+	if (tp)
+		xfs_trans_buf_set_type(tp, *bpp, XFS_BLFT_AGI_BUF);
 
 	xfs_buf_set_ref(*bpp, XFS_AGI_REF);
 	return 0;
diff -urpN xfsprogs-4.9.0/libxfs/xfs_ialloc.h xfsprogs-4.14.0/libxfs/xfs_ialloc.h
--- xfsprogs-4.9.0/libxfs/xfs_ialloc.h	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/libxfs/xfs_ialloc.h	2017-11-27 17:57:52.000000000 +0100
@@ -168,5 +168,10 @@ int xfs_ialloc_inode_init(struct xfs_mou
 int xfs_read_agi(struct xfs_mount *mp, struct xfs_trans *tp,
 		xfs_agnumber_t agno, struct xfs_buf **bpp);
 
+union xfs_btree_rec;
+void xfs_inobt_btrec_to_irec(struct xfs_mount *mp, union xfs_btree_rec *rec,
+		struct xfs_inobt_rec_incore *irec);
+
+int xfs_ialloc_cluster_alignment(struct xfs_mount *mp);
 
 #endif	/* __XFS_IALLOC_H__ */
diff -urpN xfsprogs-4.9.0/libxfs/xfs_ialloc_btree.c xfsprogs-4.14.0/libxfs/xfs_ialloc_btree.c
--- xfsprogs-4.9.0/libxfs/xfs_ialloc_btree.c	2017-01-05 18:41:55.000000000 +0100
+++ xfsprogs-4.14.0/libxfs/xfs_ialloc_btree.c	2017-11-20 01:14:14.000000000 +0100
@@ -81,11 +81,12 @@ xfs_finobt_set_root(
 }
 
 STATIC int
-xfs_inobt_alloc_block(
+__xfs_inobt_alloc_block(
 	struct xfs_btree_cur	*cur,
 	union xfs_btree_ptr	*start,
 	union xfs_btree_ptr	*new,
-	int			*stat)
+	int			*stat,
+	enum xfs_ag_resv_type	resv)
 {
 	xfs_alloc_arg_t		args;		/* block allocation args */
 	int			error;		/* error return value */
@@ -102,6 +103,7 @@ xfs_inobt_alloc_block(
 	args.maxlen = 1;
 	args.prod = 1;
 	args.type = XFS_ALLOCTYPE_NEAR_BNO;
+	args.resv = resv;
 
 	error = xfs_alloc_vextent(&args);
 	if (error) {
@@ -122,6 +124,27 @@ xfs_inobt_alloc_block(
 }
 
 STATIC int
+xfs_inobt_alloc_block(
+	struct xfs_btree_cur	*cur,
+	union xfs_btree_ptr	*start,
+	union xfs_btree_ptr	*new,
+	int			*stat)
+{
+	return __xfs_inobt_alloc_block(cur, start, new, stat, XFS_AG_RESV_NONE);
+}
+
+STATIC int
+xfs_finobt_alloc_block(
+	struct xfs_btree_cur	*cur,
+	union xfs_btree_ptr	*start,
+	union xfs_btree_ptr	*new,
+	int			*stat)
+{
+	return __xfs_inobt_alloc_block(cur, start, new, stat,
+			XFS_AG_RESV_METADATA);
+}
+
+STATIC int
 xfs_inobt_free_block(
 	struct xfs_btree_cur	*cur,
 	struct xfs_buf		*bp)
@@ -151,6 +174,18 @@ xfs_inobt_init_key_from_rec(
 }
 
 STATIC void
+xfs_inobt_init_high_key_from_rec(
+	union xfs_btree_key	*key,
+	union xfs_btree_rec	*rec)
+{
+	__u32			x;
+
+	x = be32_to_cpu(rec->inobt.ir_startino);
+	x += XFS_INODES_PER_CHUNK - 1;
+	key->inobt.ir_startino = cpu_to_be32(x);
+}
+
+STATIC void
 xfs_inobt_init_rec_from_cur(
 	struct xfs_btree_cur	*cur,
 	union xfs_btree_rec	*rec)
@@ -195,15 +230,25 @@ xfs_finobt_init_ptr_from_cur(
 	ptr->s = agi->agi_free_root;
 }
 
-STATIC __int64_t
+STATIC int64_t
 xfs_inobt_key_diff(
 	struct xfs_btree_cur	*cur,
 	union xfs_btree_key	*key)
 {
-	return (__int64_t)be32_to_cpu(key->inobt.ir_startino) -
+	return (int64_t)be32_to_cpu(key->inobt.ir_startino) -
 			  cur->bc_rec.i.ir_startino;
 }
 
+STATIC int64_t
+xfs_inobt_diff_two_keys(
+	struct xfs_btree_cur	*cur,
+	union xfs_btree_key	*k1,
+	union xfs_btree_key	*k2)
+{
+	return (int64_t)be32_to_cpu(k1->inobt.ir_startino) -
+			  be32_to_cpu(k2->inobt.ir_startino);
+}
+
 static int
 xfs_inobt_verify(
 	struct xfs_buf		*bp)
@@ -225,8 +270,6 @@ xfs_inobt_verify(
 	switch (block->bb_magic) {
 	case cpu_to_be32(XFS_IBT_CRC_MAGIC):
 	case cpu_to_be32(XFS_FIBT_CRC_MAGIC):
-		if (!xfs_sb_version_hascrc(&mp->m_sb))
-			return false;
 		if (!xfs_btree_sblock_v5hdr_verify(bp))
 			return false;
 		/* fall through */
@@ -280,7 +323,6 @@ const struct xfs_buf_ops xfs_inobt_buf_o
 	.verify_write = xfs_inobt_write_verify,
 };
 
-#if defined(DEBUG) || defined(XFS_WARN)
 STATIC int
 xfs_inobt_keys_inorder(
 	struct xfs_btree_cur	*cur,
@@ -300,7 +342,6 @@ xfs_inobt_recs_inorder(
 	return be32_to_cpu(r1->inobt.ir_startino) + XFS_INODES_PER_CHUNK <=
 		be32_to_cpu(r2->inobt.ir_startino);
 }
-#endif	/* DEBUG */
 
 static const struct xfs_btree_ops xfs_inobt_ops = {
 	.rec_len		= sizeof(xfs_inobt_rec_t),
@@ -313,14 +354,14 @@ static const struct xfs_btree_ops xfs_in
 	.get_minrecs		= xfs_inobt_get_minrecs,
 	.get_maxrecs		= xfs_inobt_get_maxrecs,
 	.init_key_from_rec	= xfs_inobt_init_key_from_rec,
+	.init_high_key_from_rec	= xfs_inobt_init_high_key_from_rec,
 	.init_rec_from_cur	= xfs_inobt_init_rec_from_cur,
 	.init_ptr_from_cur	= xfs_inobt_init_ptr_from_cur,
 	.key_diff		= xfs_inobt_key_diff,
 	.buf_ops		= &xfs_inobt_buf_ops,
-#if defined(DEBUG) || defined(XFS_WARN)
+	.diff_two_keys		= xfs_inobt_diff_two_keys,
 	.keys_inorder		= xfs_inobt_keys_inorder,
 	.recs_inorder		= xfs_inobt_recs_inorder,
-#endif
 };
 
 static const struct xfs_btree_ops xfs_finobt_ops = {
@@ -329,19 +370,19 @@ static const struct xfs_btree_ops xfs_fi
 
 	.dup_cursor		= xfs_inobt_dup_cursor,
 	.set_root		= xfs_finobt_set_root,
-	.alloc_block		= xfs_inobt_alloc_block,
+	.alloc_block		= xfs_finobt_alloc_block,
 	.free_block		= xfs_inobt_free_block,
 	.get_minrecs		= xfs_inobt_get_minrecs,
 	.get_maxrecs		= xfs_inobt_get_maxrecs,
 	.init_key_from_rec	= xfs_inobt_init_key_from_rec,
+	.init_high_key_from_rec	= xfs_inobt_init_high_key_from_rec,
 	.init_rec_from_cur	= xfs_inobt_init_rec_from_cur,
 	.init_ptr_from_cur	= xfs_finobt_init_ptr_from_cur,
 	.key_diff		= xfs_inobt_key_diff,
 	.buf_ops		= &xfs_inobt_buf_ops,
-#if defined(DEBUG) || defined(XFS_WARN)
+	.diff_two_keys		= xfs_inobt_diff_two_keys,
 	.keys_inorder		= xfs_inobt_keys_inorder,
 	.recs_inorder		= xfs_inobt_recs_inorder,
-#endif
 };
 
 /*
@@ -358,7 +399,7 @@ xfs_inobt_init_cursor(
 	struct xfs_agi		*agi = XFS_BUF_TO_AGI(agbp);
 	struct xfs_btree_cur	*cur;
 
-	cur = kmem_zone_zalloc(xfs_btree_cur_zone, KM_SLEEP);
+	cur = kmem_zone_zalloc(xfs_btree_cur_zone, KM_NOFS);
 
 	cur->bc_tp = tp;
 	cur->bc_mp = mp;
@@ -366,9 +407,11 @@ xfs_inobt_init_cursor(
 	if (btnum == XFS_BTNUM_INO) {
 		cur->bc_nlevels = be32_to_cpu(agi->agi_level);
 		cur->bc_ops = &xfs_inobt_ops;
+		cur->bc_statoff = XFS_STATS_CALC_INDEX(xs_ibt_2);
 	} else {
 		cur->bc_nlevels = be32_to_cpu(agi->agi_free_level);
 		cur->bc_ops = &xfs_finobt_ops;
+		cur->bc_statoff = XFS_STATS_CALC_INDEX(xs_fibt_2);
 	}
 
 	cur->bc_blocklog = mp->m_sb.sb_blocklog;
@@ -479,3 +522,64 @@ xfs_inobt_rec_check_count(
 	return 0;
 }
 #endif	/* DEBUG */
+
+static xfs_extlen_t
+xfs_inobt_max_size(
+	struct xfs_mount	*mp)
+{
+	/* Bail out if we're uninitialized, which can happen in mkfs. */
+	if (mp->m_inobt_mxr[0] == 0)
+		return 0;
+
+	return xfs_btree_calc_size(mp, mp->m_inobt_mnr,
+		(uint64_t)mp->m_sb.sb_agblocks * mp->m_sb.sb_inopblock /
+				XFS_INODES_PER_CHUNK);
+}
+
+static int
+xfs_inobt_count_blocks(
+	struct xfs_mount	*mp,
+	xfs_agnumber_t		agno,
+	xfs_btnum_t		btnum,
+	xfs_extlen_t		*tree_blocks)
+{
+	struct xfs_buf		*agbp;
+	struct xfs_btree_cur	*cur;
+	int			error;
+
+	error = xfs_ialloc_read_agi(mp, NULL, agno, &agbp);
+	if (error)
+		return error;
+
+	cur = xfs_inobt_init_cursor(mp, NULL, agbp, agno, btnum);
+	error = xfs_btree_count_blocks(cur, tree_blocks);
+	xfs_btree_del_cursor(cur, error ? XFS_BTREE_ERROR : XFS_BTREE_NOERROR);
+	xfs_buf_relse(agbp);
+
+	return error;
+}
+
+/*
+ * Figure out how many blocks to reserve and how many are used by this btree.
+ */
+int
+xfs_finobt_calc_reserves(
+	struct xfs_mount	*mp,
+	xfs_agnumber_t		agno,
+	xfs_extlen_t		*ask,
+	xfs_extlen_t		*used)
+{
+	xfs_extlen_t		tree_len = 0;
+	int			error;
+
+	if (!xfs_sb_version_hasfinobt(&mp->m_sb))
+		return 0;
+
+	error = xfs_inobt_count_blocks(mp, agno, XFS_BTNUM_FINO, &tree_len);
+	if (error)
+		return error;
+
+	*ask += xfs_inobt_max_size(mp);
+	*used += tree_len;
+	return 0;
+}
diff -urpN xfsprogs-4.9.0/libxfs/xfs_ialloc_btree.h xfsprogs-4.14.0/libxfs/xfs_ialloc_btree.h
--- xfsprogs-4.9.0/libxfs/xfs_ialloc_btree.h	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/libxfs/xfs_ialloc_btree.h	2017-11-20 01:14:14.000000000 +0100
@@ -72,4 +72,7 @@ int xfs_inobt_rec_check_count(struct xfs
 #define xfs_inobt_rec_check_count(mp, rec)	0
 #endif	/* DEBUG */
 
+int xfs_finobt_calc_reserves(struct xfs_mount *mp, xfs_agnumber_t agno,
+		xfs_extlen_t *ask, xfs_extlen_t *used);
+
 #endif	/* __XFS_IALLOC_BTREE_H__ */
diff -urpN xfsprogs-4.9.0/libxfs/xfs_inode_buf.c xfsprogs-4.14.0/libxfs/xfs_inode_buf.c
--- xfsprogs-4.9.0/libxfs/xfs_inode_buf.c	2017-01-05 18:41:55.000000000 +0100
+++ xfsprogs-4.14.0/libxfs/xfs_inode_buf.c	2017-11-27 17:57:52.000000000 +0100
@@ -27,6 +27,7 @@
 #include "xfs_cksum.h"
 #include "xfs_trans.h"
 #include "xfs_ialloc.h"
+#include "xfs_dir2.h"
 
 /*
  * Check that none of the inode's in the buffer have a next
@@ -102,8 +103,7 @@ xfs_inode_buf_verify(
 		di_ok = dip->di_magic == cpu_to_be16(XFS_DINODE_MAGIC) &&
 			xfs_dinode_good_version(mp, dip->di_version);
 		if (unlikely(XFS_TEST_ERROR(!di_ok, mp,
-						XFS_ERRTAG_ITOBP_INOTOBP,
-						XFS_RANDOM_ITOBP_INOTOBP))) {
+						XFS_ERRTAG_ITOBP_INOTOBP))) {
 			if (readahead) {
 				bp->b_flags &= ~XBF_DONE;
 				xfs_buf_ioerror(bp, -EIO);
@@ -384,12 +384,25 @@ xfs_dinode_verify(
 	xfs_ino_t		ino,
 	struct xfs_dinode	*dip)
 {
+	uint16_t		mode;
 	uint16_t		flags;
 	uint64_t		flags2;
 
 	if (dip->di_magic != cpu_to_be16(XFS_DINODE_MAGIC))
 		return false;
 
+	/* don't allow invalid i_size */
+	if (be64_to_cpu(dip->di_size) & (1ULL << 63))
+		return false;
+
+	mode = be16_to_cpu(dip->di_mode);
+	if (mode && xfs_mode_to_ftype(mode) == XFS_DIR3_FT_UNKNOWN)
+		return false;
+
+	/* No zero-length symlinks/dirs. */
+	if ((S_ISLNK(mode) || S_ISDIR(mode)) && dip->di_size == 0)
+		return false;
+
 	/* only version 3 or greater inodes are extensively verified here */
 	if (dip->di_version < 3)
 		return true;
@@ -428,13 +441,13 @@ xfs_dinode_calc_crc(
 	struct xfs_mount	*mp,
 	struct xfs_dinode	*dip)
 {
-	__uint32_t		crc;
+	uint32_t		crc;
 
 	if (dip->di_version < 3)
 		return;
 
 	ASSERT(xfs_sb_version_hascrc(&mp->m_sb));
-	crc = xfs_start_cksum((char *)dip, mp->m_sb.sb_inodesize,
+	crc = xfs_start_cksum_update((char *)dip, mp->m_sb.sb_inodesize,
 			      XFS_DINODE_CRC_OFF);
 	dip->di_crc = xfs_end_cksum(crc);
 }
@@ -492,7 +505,7 @@ xfs_iread(
 
 	/* even unallocated inodes are verified */
 	if (!xfs_dinode_verify(mp, ip->i_ino, dip)) {
-		xfs_alert(mp, "%s: validation failed for inode %lld failed",
+		xfs_alert(mp, "%s: validation failed for inode %lld",
 				__func__, ip->i_ino);
 
 		XFS_CORRUPTION_ERROR(__func__, XFS_ERRLEVEL_LOW, mp, dip);
@@ -537,7 +550,6 @@ xfs_iread(
 	}
 
 	ASSERT(ip->i_d.di_version >= 2);
-
 	ip->i_delayed_blks = 0;
 
 	/*
diff -urpN xfsprogs-4.9.0/libxfs/xfs_inode_buf.h xfsprogs-4.14.0/libxfs/xfs_inode_buf.h
--- xfsprogs-4.9.0/libxfs/xfs_inode_buf.h	2017-01-05 18:41:55.000000000 +0100
+++ xfsprogs-4.14.0/libxfs/xfs_inode_buf.h	2017-11-20 01:14:14.000000000 +0100
@@ -28,26 +28,26 @@ struct xfs_dinode;
  * format specific structures at the appropriate time.
  */
 struct xfs_icdinode {
-	__int8_t	di_version;	/* inode version */
-	__int8_t	di_format;	/* format of di_c data */
-	__uint16_t	di_flushiter;	/* incremented on flush */
-	__uint32_t	di_uid;		/* owner's user id */
-	__uint32_t	di_gid;		/* owner's group id */
-	__uint16_t	di_projid_lo;	/* lower part of owner's project id */
-	__uint16_t	di_projid_hi;	/* higher part of owner's project id */
+	int8_t		di_version;	/* inode version */
+	int8_t		di_format;	/* format of di_c data */
+	uint16_t	di_flushiter;	/* incremented on flush */
+	uint32_t	di_uid;		/* owner's user id */
+	uint32_t	di_gid;		/* owner's group id */
+	uint16_t	di_projid_lo;	/* lower part of owner's project id */
+	uint16_t	di_projid_hi;	/* higher part of owner's project id */
 	xfs_fsize_t	di_size;	/* number of bytes in file */
 	xfs_rfsblock_t	di_nblocks;	/* # of direct & btree blocks used */
 	xfs_extlen_t	di_extsize;	/* basic/minimum extent size for file */
 	xfs_extnum_t	di_nextents;	/* number of extents in data fork */
 	xfs_aextnum_t	di_anextents;	/* number of extents in attribute fork*/
-	__uint8_t	di_forkoff;	/* attr fork offs, <<3 for 64b align */
-	__int8_t	di_aformat;	/* format of attr fork's data */
-	__uint32_t	di_dmevmask;	/* DMIG event mask */
-	__uint16_t	di_dmstate;	/* DMIG state info */
-	__uint16_t	di_flags;	/* random flags, XFS_DIFLAG_... */
+	uint8_t		di_forkoff;	/* attr fork offs, <<3 for 64b align */
+	int8_t		di_aformat;	/* format of attr fork's data */
+	uint32_t	di_dmevmask;	/* DMIG event mask */
+	uint16_t	di_dmstate;	/* DMIG state info */
+	uint16_t	di_flags;	/* random flags, XFS_DIFLAG_... */
 
-	__uint64_t	di_flags2;	/* more random flags */
-	__uint32_t	di_cowextsize;	/* basic cow extent size for file */
+	uint64_t	di_flags2;	/* more random flags */
+	uint32_t	di_cowextsize;	/* basic cow extent size for file */
 
 	xfs_ictimestamp_t di_crtime;	/* time created */
 };
@@ -73,8 +73,6 @@ void	xfs_inode_to_disk(struct xfs_inode
 void	xfs_inode_from_disk(struct xfs_inode *ip, struct xfs_dinode *from);
 void	xfs_log_dinode_to_disk(struct xfs_log_dinode *from,
 			       struct xfs_dinode *to);
-bool	xfs_dinode_verify(struct xfs_mount *mp, xfs_ino_t ino,
-			  struct xfs_dinode *dip);
 
 bool	xfs_dinode_good_version(struct xfs_mount *mp, __u8 version);
 
@@ -84,4 +82,7 @@ void	xfs_inobp_check(struct xfs_mount *,
 #define	xfs_inobp_check(mp, bp)
 #endif /* DEBUG */
 
+bool	xfs_dinode_verify(struct xfs_mount *mp, xfs_ino_t ino,
+			  struct xfs_dinode *dip);
+
 #endif	/* __XFS_INODE_BUF_H__ */
diff -urpN xfsprogs-4.9.0/libxfs/xfs_inode_fork.c xfsprogs-4.14.0/libxfs/xfs_inode_fork.c
--- xfsprogs-4.9.0/libxfs/xfs_inode_fork.c	2017-01-05 18:41:55.000000000 +0100
+++ xfsprogs-4.14.0/libxfs/xfs_inode_fork.c	2017-11-27 17:57:55.000000000 +0100
@@ -23,11 +23,15 @@
 #include "xfs_mount.h"
 #include "xfs_inode.h"
 #include "xfs_trans.h"
+#include "xfs_btree.h"
 #include "xfs_bmap_btree.h"
 #include "xfs_bmap.h"
 #include "xfs_trace.h"
 #include "xfs_attr_sf.h"
 #include "xfs_da_format.h"
+#include "xfs_da_btree.h"
+#include "xfs_dir2_priv.h"
+
 
 kmem_zone_t *xfs_ifork_zone;
 
@@ -35,35 +39,6 @@ STATIC int xfs_iformat_local(xfs_inode_t
 STATIC int xfs_iformat_extents(xfs_inode_t *, xfs_dinode_t *, int);
 STATIC int xfs_iformat_btree(xfs_inode_t *, xfs_dinode_t *, int);
 
-#ifdef DEBUG
-/*
- * Make sure that the extents in the given memory buffer
- * are valid.
- */
-void
-xfs_validate_extents(
-	xfs_ifork_t		*ifp,
-	int			nrecs,
-	xfs_exntfmt_t		fmt)
-{
-	xfs_bmbt_irec_t		irec;
-	xfs_bmbt_rec_host_t	rec;
-	int			i;
-
-	for (i = 0; i < nrecs; i++) {
-		xfs_bmbt_rec_host_t *ep = xfs_iext_get_ext(ifp, i);
-		rec.l0 = get_unaligned(&ep->l0);
-		rec.l1 = get_unaligned(&ep->l1);
-		xfs_bmbt_get_all(&rec, &irec);
-		if (fmt == XFS_EXTFMT_NOSTATE)
-			ASSERT(irec.br_state == XFS_EXT_NORM);
-	}
-}
-#else /* DEBUG */
-#define xfs_validate_extents(ifp, nrecs, fmt)
-#endif /* DEBUG */
-
-
 /*
  * Move inode type and inode format specific information from the
  * on-disk inode to the in-core inode.  For fifos, devs, and sockets
@@ -205,6 +180,16 @@ xfs_iformat_fork(
 	if (error)
 		return error;
 
+	/* Check inline dir contents. */
+	if (S_ISDIR(VFS_I(ip)->i_mode) &&
+	    dip->di_format == XFS_DINODE_FMT_LOCAL) {
+		error = xfs_dir2_sf_verify(ip);
+		if (error) {
+			xfs_idestroy_fork(ip, XFS_DATA_FORK);
+			return error;
+		}
+	}
+
 	if (xfs_is_reflink_inode(ip)) {
 		ASSERT(ip->i_cowfp == NULL);
 		xfs_ifork_init_cow(ip);
@@ -315,7 +300,6 @@ xfs_iformat_local(
 	int		whichfork,
 	int		size)
 {
-
 	/*
 	 * If the size is unreasonable, then something
 	 * is wrong and we just bail out rather than crash in
@@ -336,40 +320,33 @@ xfs_iformat_local(
 }
 
 /*
- * The file consists of a set of extents all
- * of which fit into the on-disk inode.
- * If there are few enough extents to fit into
- * the if_inline_ext, then copy them there.
- * Otherwise allocate a buffer for them and copy
- * them into it.  Either way, set if_extents
- * to point at the extents.
+ * The file consists of a set of extents all of which fit into the on-disk
+ * inode.  If there are few enough extents to fit into the if_inline_ext, then
+ * copy them there.  Otherwise allocate a buffer for them and copy them into it.
+ * Either way, set if_extents to point at the extents.
  */
 STATIC int
 xfs_iformat_extents(
-	xfs_inode_t	*ip,
-	xfs_dinode_t	*dip,
-	int		whichfork)
+	struct xfs_inode	*ip,
+	struct xfs_dinode	*dip,
+	int			whichfork)
 {
-	xfs_bmbt_rec_t	*dp;
-	xfs_ifork_t	*ifp;
-	int		nex;
-	int		size;
-	int		i;
-
-	ifp = XFS_IFORK_PTR(ip, whichfork);
-	nex = XFS_DFORK_NEXTENTS(dip, whichfork);
-	size = nex * (uint)sizeof(xfs_bmbt_rec_t);
+	struct xfs_mount	*mp = ip->i_mount;
+	struct xfs_ifork	*ifp = XFS_IFORK_PTR(ip, whichfork);
+	int			nex = XFS_DFORK_NEXTENTS(dip, whichfork);
+	int			size = nex * sizeof(xfs_bmbt_rec_t);
+	struct xfs_bmbt_rec	*dp;
+	int			i;
 
 	/*
-	 * If the number of extents is unreasonable, then something
-	 * is wrong and we just bail out rather than crash in
-	 * kmem_alloc() or memcpy() below.
+	 * If the number of extents is unreasonable, then something is wrong and
+	 * we just bail out rather than crash in kmem_alloc() or memcpy() below.
 	 */
-	if (unlikely(size < 0 || size > XFS_DFORK_SIZE(dip, ip->i_mount, whichfork))) {
+	if (unlikely(size < 0 || size > XFS_DFORK_SIZE(dip, mp, whichfork))) {
 		xfs_warn(ip->i_mount, "corrupt inode %Lu ((a)extents = %d).",
 			(unsigned long long) ip->i_ino, nex);
 		XFS_CORRUPTION_ERROR("xfs_iformat_extents(1)", XFS_ERRLEVEL_LOW,
-				     ip->i_mount, dip);
+				     mp, dip);
 		return -EFSCORRUPTED;
 	}
 
@@ -384,22 +361,17 @@ xfs_iformat_extents(
 	ifp->if_bytes = size;
 	if (size) {
 		dp = (xfs_bmbt_rec_t *) XFS_DFORK_PTR(dip, whichfork);
-		xfs_validate_extents(ifp, nex, XFS_EXTFMT_INODE(ip));
 		for (i = 0; i < nex; i++, dp++) {
 			xfs_bmbt_rec_host_t *ep = xfs_iext_get_ext(ifp, i);
 			ep->l0 = get_unaligned_be64(&dp->l0);
 			ep->l1 = get_unaligned_be64(&dp->l1);
+			if (!xfs_bmbt_validate_extent(mp, whichfork, ep)) {
+				XFS_ERROR_REPORT("xfs_iformat_extents(2)",
+						 XFS_ERRLEVEL_LOW, mp);
+				return -EFSCORRUPTED;
+			}
 		}
 		XFS_BMAP_TRACE_EXLIST(ip, nex, whichfork);
-		if (whichfork != XFS_DATA_FORK ||
-			XFS_EXTFMT_INODE(ip) == XFS_EXTFMT_NOSTATE)
-				if (unlikely(xfs_check_nostate_extents(
-				    ifp, 0, nex))) {
-					XFS_ERROR_REPORT("xfs_iformat_extents(2)",
-							 XFS_ERRLEVEL_LOW,
-							 ip->i_mount);
-					return -EFSCORRUPTED;
-				}
 	}
 	ifp->if_flags |= XFS_IFEXTENTS;
 	return 0;
@@ -425,11 +397,13 @@ xfs_iformat_btree(
 	/* REFERENCED */
 	int			nrecs;
 	int			size;
+	int			level;
 
 	ifp = XFS_IFORK_PTR(ip, whichfork);
 	dfp = (xfs_bmdr_block_t *)XFS_DFORK_PTR(dip, whichfork);
 	size = XFS_BMAP_BROOT_SPACE(mp, dfp);
 	nrecs = be16_to_cpu(dfp->bb_numrecs);
+	level = be16_to_cpu(dfp->bb_level);
 
 	/*
 	 * blow out if -- fork has less extents than can fit in
@@ -442,7 +416,8 @@ xfs_iformat_btree(
 					XFS_IFORK_MAXEXT(ip, whichfork) ||
 		     XFS_BMDR_SPACE_CALC(nrecs) >
 					XFS_DFORK_SIZE(dip, mp, whichfork) ||
-		     XFS_IFORK_NEXTENTS(ip, whichfork) > ip->i_d.di_nblocks)) {
+		     XFS_IFORK_NEXTENTS(ip, whichfork) > ip->i_d.di_nblocks) ||
+		     level == 0 || level > XFS_BTREE_MAXLEVELS) {
 		xfs_warn(mp, "corrupt inode %Lu (btree).",
 					(unsigned long long) ip->i_ino);
 		XFS_CORRUPTION_ERROR("xfs_iformat_btree", XFS_ERRLEVEL_LOW,
@@ -493,15 +468,13 @@ xfs_iread_extents(
 	 * We know that the size is valid (it's checked in iformat_btree)
 	 */
 	ifp->if_bytes = ifp->if_real_bytes = 0;
-	ifp->if_flags |= XFS_IFEXTENTS;
 	xfs_iext_add(ifp, 0, nextents);
 	error = xfs_bmap_read_extents(tp, ip, whichfork);
 	if (error) {
 		xfs_iext_destroy(ifp);
-		ifp->if_flags &= ~XFS_IFEXTENTS;
 		return error;
 	}
-	xfs_validate_extents(ifp, nextents, XFS_EXTFMT_INODE(ip));
+	ifp->if_flags |= XFS_IFEXTENTS;
 	return 0;
 }
 /*
@@ -771,6 +744,13 @@ xfs_idestroy_fork(
 	}
 }
 
+/* Count number of incore extents based on if_bytes */
+xfs_extnum_t
+xfs_iext_count(struct xfs_ifork *ifp)
+{
+	return ifp->if_bytes / (uint)sizeof(xfs_bmbt_rec_t);
+}
+
 /*
  * Convert in-core extents to on-disk form
  *
@@ -799,7 +779,7 @@ xfs_iextents_copy(
 	ASSERT(xfs_isilocked(ip, XFS_ILOCK_EXCL|XFS_ILOCK_SHARED));
 	ASSERT(ifp->if_bytes > 0);
 
-	nrecs = ifp->if_bytes / (uint)sizeof(xfs_bmbt_rec_t);
+	nrecs = xfs_iext_count(ifp);
 	XFS_BMAP_TRACE_EXLIST(ip, nrecs, whichfork);
 	ASSERT(nrecs > 0);
 
@@ -812,6 +792,9 @@ xfs_iextents_copy(
 	copied = 0;
 	for (i = 0; i < nrecs; i++) {
 		xfs_bmbt_rec_host_t *ep = xfs_iext_get_ext(ifp, i);
+
+		ASSERT(xfs_bmbt_validate_extent(ip->i_mount, whichfork, ep));
+
 		start_block = xfs_bmbt_get_startblock(ep);
 		if (isnullstartblock(start_block)) {
 			/*
@@ -827,7 +810,6 @@ xfs_iextents_copy(
 		copied++;
 	}
 	ASSERT(copied != 0);
-	xfs_validate_extents(ifp, copied, XFS_EXTFMT_INODE(ip));
 
 	return (copied * (uint)sizeof(xfs_bmbt_rec_t));
 }
@@ -937,7 +919,7 @@ xfs_iext_get_ext(
 	xfs_extnum_t	idx)		/* index of target extent */
 {
 	ASSERT(idx >= 0);
-	ASSERT(idx < ifp->if_bytes / sizeof(xfs_bmbt_rec_t));
+	ASSERT(idx < xfs_iext_count(ifp));
 
 	if ((ifp->if_flags & XFS_IFEXTIREC) && (idx == 0)) {
 		return ifp->if_u1.if_ext_irec->er_extbuf;
@@ -1013,7 +995,7 @@ xfs_iext_add(
 	int		new_size;	/* size of extents after adding */
 	xfs_extnum_t	nextents;	/* number of extents in file */
 
-	nextents = ifp->if_bytes / (uint)sizeof(xfs_bmbt_rec_t);
+	nextents = xfs_iext_count(ifp);
 	ASSERT((idx >= 0) && (idx <= nextents));
 	byte_diff = ext_diff * sizeof(xfs_bmbt_rec_t);
 	new_size = ifp->if_bytes + byte_diff;
@@ -1237,7 +1219,7 @@ xfs_iext_remove(
 	trace_xfs_iext_remove(ip, idx, state, _RET_IP_);
 
 	ASSERT(ext_diff > 0);
-	nextents = ifp->if_bytes / (uint)sizeof(xfs_bmbt_rec_t);
+	nextents = xfs_iext_count(ifp);
 	new_size = (nextents - ext_diff) * sizeof(xfs_bmbt_rec_t);
 
 	if (new_size == 0) {
@@ -1266,7 +1248,7 @@ xfs_iext_remove_inline(
 
 	ASSERT(!(ifp->if_flags & XFS_IFEXTIREC));
 	ASSERT(idx < XFS_INLINE_EXTS);
-	nextents = ifp->if_bytes / (uint)sizeof(xfs_bmbt_rec_t);
+	nextents = xfs_iext_count(ifp);
 	ASSERT(((nextents - ext_diff) > 0) &&
 		(nextents - ext_diff) < XFS_INLINE_EXTS);
 
@@ -1305,7 +1287,7 @@ xfs_iext_remove_direct(
 	ASSERT(!(ifp->if_flags & XFS_IFEXTIREC));
 	new_size = ifp->if_bytes -
 		(ext_diff * sizeof(xfs_bmbt_rec_t));
-	nextents = ifp->if_bytes / (uint)sizeof(xfs_bmbt_rec_t);
+	nextents = xfs_iext_count(ifp);
 
 	if (new_size == 0) {
 		xfs_iext_destroy(ifp);
@@ -1515,14 +1497,11 @@ xfs_iext_realloc_indirect(
 	int		new_size)	/* new indirection array size */
 {
 #ifdef DEBUG
-	int		nlists;		/* number of irec's (ex lists) */
-	int		size;		/* current indirection array size */
-
 	ASSERT(ifp->if_flags & XFS_IFEXTIREC);
-	nlists = ifp->if_real_bytes / XFS_IEXT_BUFSZ;
-	size = nlists * sizeof(xfs_ext_irec_t);
 	ASSERT(ifp->if_real_bytes);
-	ASSERT((new_size >= 0) && (new_size != size));
+	ASSERT((new_size >= 0) &&
+	       (new_size != ((ifp->if_real_bytes / XFS_IEXT_BUFSZ) *
+			     sizeof(xfs_ext_irec_t))));
 #endif
 	if (new_size == 0) {
 		xfs_iext_destroy(ifp);
@@ -1544,7 +1523,7 @@ xfs_iext_indirect_to_direct(
 	int		size;		/* size of file extents */
 
 	ASSERT(ifp->if_flags & XFS_IFEXTIREC);
-	nextents = ifp->if_bytes / (uint)sizeof(xfs_bmbt_rec_t);
+	nextents = xfs_iext_count(ifp);
 	ASSERT(nextents <= XFS_LINEAR_EXTS);
 	size = nextents * sizeof(xfs_bmbt_rec_t);
 
@@ -1618,7 +1597,7 @@ xfs_iext_bno_to_ext(
 	xfs_extnum_t	nextents;	/* number of file extents */
 	xfs_fileoff_t	startoff = 0;	/* start offset of extent */
 
-	nextents = ifp->if_bytes / (uint)sizeof(xfs_bmbt_rec_t);
+	nextents = xfs_iext_count(ifp);
 	if (nextents == 0) {
 		*idxp = 0;
 		return NULL;
@@ -1731,8 +1710,8 @@ xfs_iext_idx_to_irec(
 
 	ASSERT(ifp->if_flags & XFS_IFEXTIREC);
 	ASSERT(page_idx >= 0);
-	ASSERT(page_idx <= ifp->if_bytes / sizeof(xfs_bmbt_rec_t));
-	ASSERT(page_idx < ifp->if_bytes / sizeof(xfs_bmbt_rec_t) || realloc);
+	ASSERT(page_idx <= xfs_iext_count(ifp));
+	ASSERT(page_idx < xfs_iext_count(ifp) || realloc);
 
 	nlists = ifp->if_real_bytes / XFS_IEXT_BUFSZ;
 	erp_idx = 0;
@@ -1780,7 +1759,7 @@ xfs_iext_irec_init(
 	xfs_extnum_t	nextents;	/* number of extents in file */
 
 	ASSERT(!(ifp->if_flags & XFS_IFEXTIREC));
-	nextents = ifp->if_bytes / (uint)sizeof(xfs_bmbt_rec_t);
+	nextents = xfs_iext_count(ifp);
 	ASSERT(nextents <= XFS_LINEAR_EXTS);
 
 	erp = kmem_alloc(sizeof(xfs_ext_irec_t), KM_NOFS);
@@ -1904,7 +1883,7 @@ xfs_iext_irec_compact(
 
 	ASSERT(ifp->if_flags & XFS_IFEXTIREC);
 	nlists = ifp->if_real_bytes / XFS_IEXT_BUFSZ;
-	nextents = ifp->if_bytes / (uint)sizeof(xfs_bmbt_rec_t);
+	nextents = xfs_iext_count(ifp);
 
 	if (nextents == 0) {
 		xfs_iext_destroy(ifp);
@@ -1994,3 +1973,61 @@ xfs_ifork_init_cow(
 	ip->i_cformat = XFS_DINODE_FMT_EXTENTS;
 	ip->i_cnextents = 0;
 }
+
+/*
+ * Lookup the extent covering bno.
+ *
+ * If there is an extent covering bno return the extent index, and store the
+ * expanded extent structure in *gotp, and the extent index in *idx.
+ * If there is no extent covering bno, but there is an extent after it (e.g.
+ * it lies in a hole) return that extent in *gotp and its index in *idx
+ * instead.
+ * If bno is beyond the last extent return false, and return the index after
+ * the last valid index in *idxp.
+ */
+bool
+xfs_iext_lookup_extent(
+	struct xfs_inode	*ip,
+	struct xfs_ifork	*ifp,
+	xfs_fileoff_t		bno,
+	xfs_extnum_t		*idxp,
+	struct xfs_bmbt_irec	*gotp)
+{
+	struct xfs_bmbt_rec_host *ep;
+
+	XFS_STATS_INC(ip->i_mount, xs_look_exlist);
+
+	ep = xfs_iext_bno_to_ext(ifp, bno, idxp);
+	if (!ep)
+		return false;
+	xfs_bmbt_get_all(ep, gotp);
+	return true;
+}
+
+/*
+ * Return true if there is an extent at index idx, and return the expanded
+ * extent structure at idx in that case.  Else return false.
+ */
+bool
+xfs_iext_get_extent(
+	struct xfs_ifork	*ifp,
+	xfs_extnum_t		idx,
+	struct xfs_bmbt_irec	*gotp)
+{
+	if (idx < 0 || idx >= xfs_iext_count(ifp))
+		return false;
+	xfs_bmbt_get_all(xfs_iext_get_ext(ifp, idx), gotp);
+	return true;
+}
+
+void
+xfs_iext_update_extent(
+	struct xfs_ifork	*ifp,
+	xfs_extnum_t		idx,
+	struct xfs_bmbt_irec	*gotp)
+{
+	ASSERT(idx >= 0);
+	ASSERT(idx < xfs_iext_count(ifp));
+
+	xfs_bmbt_set_all(xfs_iext_get_ext(ifp, idx), gotp);
+}
diff -urpN xfsprogs-4.9.0/libxfs/xfs_inode_fork.h xfsprogs-4.14.0/libxfs/xfs_inode_fork.h
--- xfsprogs-4.9.0/libxfs/xfs_inode_fork.h	2016-12-13 20:38:44.000000000 +0100
+++ xfsprogs-4.14.0/libxfs/xfs_inode_fork.h	2017-11-27 17:57:55.000000000 +0100
@@ -152,6 +152,7 @@ void		xfs_init_local_fork(struct xfs_ino
 
 struct xfs_bmbt_rec_host *
 		xfs_iext_get_ext(struct xfs_ifork *, xfs_extnum_t);
+xfs_extnum_t	xfs_iext_count(struct xfs_ifork *);
 void		xfs_iext_insert(struct xfs_inode *, xfs_extnum_t, xfs_extnum_t,
 				struct xfs_bmbt_irec *, int);
 void		xfs_iext_add(struct xfs_ifork *, xfs_extnum_t, int);
@@ -181,6 +182,14 @@ void		xfs_iext_irec_compact_pages(struct
 void		xfs_iext_irec_compact_full(struct xfs_ifork *);
 void		xfs_iext_irec_update_extoffs(struct xfs_ifork *, int, int);
 
+bool		xfs_iext_lookup_extent(struct xfs_inode *ip,
+			struct xfs_ifork *ifp, xfs_fileoff_t bno,
+			xfs_extnum_t *idxp, struct xfs_bmbt_irec *gotp);
+bool		xfs_iext_get_extent(struct xfs_ifork *ifp, xfs_extnum_t idx,
+			struct xfs_bmbt_irec *gotp);
+void		xfs_iext_update_extent(struct xfs_ifork *ifp, xfs_extnum_t idx,
+			struct xfs_bmbt_irec *gotp);
+
 extern struct kmem_zone	*xfs_ifork_zone;
 
 extern void xfs_ifork_init_cow(struct xfs_inode *ip);
diff -urpN xfsprogs-4.9.0/libxfs/xfs_log_format.h xfsprogs-4.14.0/libxfs/xfs_log_format.h
--- xfsprogs-4.9.0/libxfs/xfs_log_format.h	2016-12-13 04:42:12.000000000 +0100
+++ xfsprogs-4.14.0/libxfs/xfs_log_format.h	2017-11-27 17:57:55.000000000 +0100
@@ -31,7 +31,7 @@ struct xfs_trans_res;
  * through all the log items definitions and everything they encode into the
  * log.
  */
-typedef __uint32_t xlog_tid_t;
+typedef uint32_t xlog_tid_t;
 
 #define XLOG_MIN_ICLOGS		2
 #define XLOG_MAX_ICLOGS		8
@@ -211,7 +211,7 @@ typedef struct xfs_log_iovec {
 typedef struct xfs_trans_header {
 	uint		th_magic;		/* magic number */
 	uint		th_type;		/* transaction type */
-	__int32_t	th_tid;			/* transaction id (unused) */
+	int32_t		th_tid;			/* transaction id (unused) */
 	uint		th_num_items;		/* num items logged by trans */
 } xfs_trans_header_t;
 
@@ -265,53 +265,42 @@ typedef struct xfs_trans_header {
  * must be added on to the end.
  */
 typedef struct xfs_inode_log_format {
-	__uint16_t		ilf_type;	/* inode log item type */
-	__uint16_t		ilf_size;	/* size of this item */
-	__uint32_t		ilf_fields;	/* flags for fields logged */
-	__uint16_t		ilf_asize;	/* size of attr d/ext/root */
-	__uint16_t		ilf_dsize;	/* size of data/ext/root */
-	__uint64_t		ilf_ino;	/* inode number */
+	uint16_t		ilf_type;	/* inode log item type */
+	uint16_t		ilf_size;	/* size of this item */
+	uint32_t		ilf_fields;	/* flags for fields logged */
+	uint16_t		ilf_asize;	/* size of attr d/ext/root */
+	uint16_t		ilf_dsize;	/* size of data/ext/root */
+	uint32_t		ilf_pad;	/* pad for 64 bit boundary */
+	uint64_t		ilf_ino;	/* inode number */
 	union {
-		__uint32_t	ilfu_rdev;	/* rdev value for dev inode*/
+		uint32_t	ilfu_rdev;	/* rdev value for dev inode*/
 		uuid_t		ilfu_uuid;	/* mount point value */
 	} ilf_u;
-	__int64_t		ilf_blkno;	/* blkno of inode buffer */
-	__int32_t		ilf_len;	/* len of inode buffer */
-	__int32_t		ilf_boffset;	/* off of inode in buffer */
+	int64_t			ilf_blkno;	/* blkno of inode buffer */
+	int32_t			ilf_len;	/* len of inode buffer */
+	int32_t			ilf_boffset;	/* off of inode in buffer */
 } xfs_inode_log_format_t;
 
-typedef struct xfs_inode_log_format_32 {
-	__uint16_t		ilf_type;	/* inode log item type */
-	__uint16_t		ilf_size;	/* size of this item */
-	__uint32_t		ilf_fields;	/* flags for fields logged */
-	__uint16_t		ilf_asize;	/* size of attr d/ext/root */
-	__uint16_t		ilf_dsize;	/* size of data/ext/root */
-	__uint64_t		ilf_ino;	/* inode number */
-	union {
-		__uint32_t	ilfu_rdev;	/* rdev value for dev inode*/
-		uuid_t		ilfu_uuid;	/* mount point value */
-	} ilf_u;
-	__int64_t		ilf_blkno;	/* blkno of inode buffer */
-	__int32_t		ilf_len;	/* len of inode buffer */
-	__int32_t		ilf_boffset;	/* off of inode in buffer */
-} __attribute__((packed)) xfs_inode_log_format_32_t;
-
-typedef struct xfs_inode_log_format_64 {
-	__uint16_t		ilf_type;	/* inode log item type */
-	__uint16_t		ilf_size;	/* size of this item */
-	__uint32_t		ilf_fields;	/* flags for fields logged */
-	__uint16_t		ilf_asize;	/* size of attr d/ext/root */
-	__uint16_t		ilf_dsize;	/* size of data/ext/root */
-	__uint32_t		ilf_pad;	/* pad for 64 bit boundary */
-	__uint64_t		ilf_ino;	/* inode number */
+/*
+ * Old 32 bit systems will log in this format without the 64 bit
+ * alignment padding. Recovery will detect this and convert it to the
+ * correct format.
+ */
+struct xfs_inode_log_format_32 {
+	uint16_t		ilf_type;	/* inode log item type */
+	uint16_t		ilf_size;	/* size of this item */
+	uint32_t		ilf_fields;	/* flags for fields logged */
+	uint16_t		ilf_asize;	/* size of attr d/ext/root */
+	uint16_t		ilf_dsize;	/* size of data/ext/root */
+	uint64_t		ilf_ino;	/* inode number */
 	union {
-		__uint32_t	ilfu_rdev;	/* rdev value for dev inode*/
+		uint32_t	ilfu_rdev;	/* rdev value for dev inode*/
 		uuid_t		ilfu_uuid;	/* mount point value */
 	} ilf_u;
-	__int64_t		ilf_blkno;	/* blkno of inode buffer */
-	__int32_t		ilf_len;	/* len of inode buffer */
-	__int32_t		ilf_boffset;	/* off of inode in buffer */
-} xfs_inode_log_format_64_t;
+	int64_t			ilf_blkno;	/* blkno of inode buffer */
+	int32_t			ilf_len;	/* len of inode buffer */
+	int32_t			ilf_boffset;	/* off of inode in buffer */
+} __attribute__((packed));
 
 
 /*
@@ -379,8 +368,8 @@ static inline int xfs_ilog_fdata(int w)
  * information.
  */
 typedef struct xfs_ictimestamp {
-	__int32_t	t_sec;		/* timestamp seconds */
-	__int32_t	t_nsec;		/* timestamp nanoseconds */
+	int32_t		t_sec;		/* timestamp seconds */
+	int32_t		t_nsec;		/* timestamp nanoseconds */
 } xfs_ictimestamp_t;
 
 /*
@@ -388,18 +377,18 @@ typedef struct xfs_ictimestamp {
  * kept identical to struct xfs_dinode except for the endianness annotations.
  */
 struct xfs_log_dinode {
-	__uint16_t	di_magic;	/* inode magic # = XFS_DINODE_MAGIC */
-	__uint16_t	di_mode;	/* mode and type of file */
-	__int8_t	di_version;	/* inode version */
-	__int8_t	di_format;	/* format of di_c data */
-	__uint8_t	di_pad3[2];	/* unused in v2/3 inodes */
-	__uint32_t	di_uid;		/* owner's user id */
-	__uint32_t	di_gid;		/* owner's group id */
-	__uint32_t	di_nlink;	/* number of links to file */
-	__uint16_t	di_projid_lo;	/* lower part of owner's project id */
-	__uint16_t	di_projid_hi;	/* higher part of owner's project id */
-	__uint8_t	di_pad[6];	/* unused, zeroed space */
-	__uint16_t	di_flushiter;	/* incremented on flush */
+	uint16_t	di_magic;	/* inode magic # = XFS_DINODE_MAGIC */
+	uint16_t	di_mode;	/* mode and type of file */
+	int8_t		di_version;	/* inode version */
+	int8_t		di_format;	/* format of di_c data */
+	uint8_t		di_pad3[2];	/* unused in v2/3 inodes */
+	uint32_t	di_uid;		/* owner's user id */
+	uint32_t	di_gid;		/* owner's group id */
+	uint32_t	di_nlink;	/* number of links to file */
+	uint16_t	di_projid_lo;	/* lower part of owner's project id */
+	uint16_t	di_projid_hi;	/* higher part of owner's project id */
+	uint8_t		di_pad[6];	/* unused, zeroed space */
+	uint16_t	di_flushiter;	/* incremented on flush */
 	xfs_ictimestamp_t di_atime;	/* time last accessed */
 	xfs_ictimestamp_t di_mtime;	/* time last modified */
 	xfs_ictimestamp_t di_ctime;	/* time created/inode modified */
@@ -408,23 +397,23 @@ struct xfs_log_dinode {
 	xfs_extlen_t	di_extsize;	/* basic/minimum extent size for file */
 	xfs_extnum_t	di_nextents;	/* number of extents in data fork */
 	xfs_aextnum_t	di_anextents;	/* number of extents in attribute fork*/
-	__uint8_t	di_forkoff;	/* attr fork offs, <<3 for 64b align */
-	__int8_t	di_aformat;	/* format of attr fork's data */
-	__uint32_t	di_dmevmask;	/* DMIG event mask */
-	__uint16_t	di_dmstate;	/* DMIG state info */
-	__uint16_t	di_flags;	/* random flags, XFS_DIFLAG_... */
-	__uint32_t	di_gen;		/* generation number */
+	uint8_t		di_forkoff;	/* attr fork offs, <<3 for 64b align */
+	int8_t		di_aformat;	/* format of attr fork's data */
+	uint32_t	di_dmevmask;	/* DMIG event mask */
+	uint16_t	di_dmstate;	/* DMIG state info */
+	uint16_t	di_flags;	/* random flags, XFS_DIFLAG_... */
+	uint32_t	di_gen;		/* generation number */
 
 	/* di_next_unlinked is the only non-core field in the old dinode */
 	xfs_agino_t	di_next_unlinked;/* agi unlinked list ptr */
 
 	/* start of the extended dinode, writable fields */
-	__uint32_t	di_crc;		/* CRC of the inode */
-	__uint64_t	di_changecount;	/* number of attribute changes */
+	uint32_t	di_crc;		/* CRC of the inode */
+	uint64_t	di_changecount;	/* number of attribute changes */
 	xfs_lsn_t	di_lsn;		/* flush sequence */
-	__uint64_t	di_flags2;	/* more random flags */
-	__uint32_t	di_cowextsize;	/* basic cow extent size for file */
-	__uint8_t	di_pad2[12];	/* more padding for future expansion */
+	uint64_t	di_flags2;	/* more random flags */
+	uint32_t	di_cowextsize;	/* basic cow extent size for file */
+	uint8_t		di_pad2[12];	/* more padding for future expansion */
 
 	/* fields only written to during inode creation */
 	xfs_ictimestamp_t di_crtime;	/* time created */
@@ -483,7 +472,7 @@ typedef struct xfs_buf_log_format {
 	unsigned short	blf_size;	/* size of this item */
 	unsigned short	blf_flags;	/* misc state */
 	unsigned short	blf_len;	/* number of blocks in this buf */
-	__int64_t	blf_blkno;	/* starting blkno of this buf */
+	int64_t		blf_blkno;	/* starting blkno of this buf */
 	unsigned int	blf_map_size;	/* used size of data bitmap in words */
 	unsigned int	blf_data_map[XFS_BLF_DATAMAP_SIZE]; /* dirty bitmap */
 } xfs_buf_log_format_t;
@@ -533,7 +522,7 @@ xfs_blft_to_flags(struct xfs_buf_log_for
 	blf->blf_flags |= ((type << XFS_BLFT_SHIFT) & XFS_BLFT_MASK);
 }
 
-static inline __uint16_t
+static inline uint16_t
 xfs_blft_from_flags(struct xfs_buf_log_format *blf)
 {
 	return (blf->blf_flags & XFS_BLFT_MASK) >> XFS_BLFT_SHIFT;
@@ -554,14 +543,14 @@ typedef struct xfs_extent {
  * conversion routine.
  */
 typedef struct xfs_extent_32 {
-	__uint64_t	ext_start;
-	__uint32_t	ext_len;
+	uint64_t	ext_start;
+	uint32_t	ext_len;
 } __attribute__((packed)) xfs_extent_32_t;
 
 typedef struct xfs_extent_64 {
-	__uint64_t	ext_start;
-	__uint32_t	ext_len;
-	__uint32_t	ext_pad;
+	uint64_t	ext_start;
+	uint32_t	ext_len;
+	uint32_t	ext_pad;
 } xfs_extent_64_t;
 
 /*
@@ -570,26 +559,26 @@ typedef struct xfs_extent_64 {
  * size is given by efi_nextents.
  */
 typedef struct xfs_efi_log_format {
-	__uint16_t		efi_type;	/* efi log item type */
-	__uint16_t		efi_size;	/* size of this item */
-	__uint32_t		efi_nextents;	/* # extents to free */
-	__uint64_t		efi_id;		/* efi identifier */
+	uint16_t		efi_type;	/* efi log item type */
+	uint16_t		efi_size;	/* size of this item */
+	uint32_t		efi_nextents;	/* # extents to free */
+	uint64_t		efi_id;		/* efi identifier */
 	xfs_extent_t		efi_extents[1];	/* array of extents to free */
 } xfs_efi_log_format_t;
 
 typedef struct xfs_efi_log_format_32 {
-	__uint16_t		efi_type;	/* efi log item type */
-	__uint16_t		efi_size;	/* size of this item */
-	__uint32_t		efi_nextents;	/* # extents to free */
-	__uint64_t		efi_id;		/* efi identifier */
+	uint16_t		efi_type;	/* efi log item type */
+	uint16_t		efi_size;	/* size of this item */
+	uint32_t		efi_nextents;	/* # extents to free */
+	uint64_t		efi_id;		/* efi identifier */
 	xfs_extent_32_t		efi_extents[1];	/* array of extents to free */
 } __attribute__((packed)) xfs_efi_log_format_32_t;
 
 typedef struct xfs_efi_log_format_64 {
-	__uint16_t		efi_type;	/* efi log item type */
-	__uint16_t		efi_size;	/* size of this item */
-	__uint32_t		efi_nextents;	/* # extents to free */
-	__uint64_t		efi_id;		/* efi identifier */
+	uint16_t		efi_type;	/* efi log item type */
+	uint16_t		efi_size;	/* size of this item */
+	uint32_t		efi_nextents;	/* # extents to free */
+	uint64_t		efi_id;		/* efi identifier */
 	xfs_extent_64_t		efi_extents[1];	/* array of extents to free */
 } xfs_efi_log_format_64_t;
 
@@ -599,26 +588,26 @@ typedef struct xfs_efi_log_format_64 {
  * size is given by efd_nextents;
  */
 typedef struct xfs_efd_log_format {
-	__uint16_t		efd_type;	/* efd log item type */
-	__uint16_t		efd_size;	/* size of this item */
-	__uint32_t		efd_nextents;	/* # of extents freed */
-	__uint64_t		efd_efi_id;	/* id of corresponding efi */
+	uint16_t		efd_type;	/* efd log item type */
+	uint16_t		efd_size;	/* size of this item */
+	uint32_t		efd_nextents;	/* # of extents freed */
+	uint64_t		efd_efi_id;	/* id of corresponding efi */
 	xfs_extent_t		efd_extents[1];	/* array of extents freed */
 } xfs_efd_log_format_t;
 
 typedef struct xfs_efd_log_format_32 {
-	__uint16_t		efd_type;	/* efd log item type */
-	__uint16_t		efd_size;	/* size of this item */
-	__uint32_t		efd_nextents;	/* # of extents freed */
-	__uint64_t		efd_efi_id;	/* id of corresponding efi */
+	uint16_t		efd_type;	/* efd log item type */
+	uint16_t		efd_size;	/* size of this item */
+	uint32_t		efd_nextents;	/* # of extents freed */
+	uint64_t		efd_efi_id;	/* id of corresponding efi */
 	xfs_extent_32_t		efd_extents[1];	/* array of extents freed */
 } __attribute__((packed)) xfs_efd_log_format_32_t;
 
 typedef struct xfs_efd_log_format_64 {
-	__uint16_t		efd_type;	/* efd log item type */
-	__uint16_t		efd_size;	/* size of this item */
-	__uint32_t		efd_nextents;	/* # of extents freed */
-	__uint64_t		efd_efi_id;	/* id of corresponding efi */
+	uint16_t		efd_type;	/* efd log item type */
+	uint16_t		efd_size;	/* size of this item */
+	uint32_t		efd_nextents;	/* # of extents freed */
+	uint64_t		efd_efi_id;	/* id of corresponding efi */
 	xfs_extent_64_t		efd_extents[1];	/* array of extents freed */
 } xfs_efd_log_format_64_t;
 
@@ -626,11 +615,11 @@ typedef struct xfs_efd_log_format_64 {
  * RUI/RUD (reverse mapping) log format definitions
  */
 struct xfs_map_extent {
-	__uint64_t		me_owner;
-	__uint64_t		me_startblock;
-	__uint64_t		me_startoff;
-	__uint32_t		me_len;
-	__uint32_t		me_flags;
+	uint64_t		me_owner;
+	uint64_t		me_startblock;
+	uint64_t		me_startoff;
+	uint32_t		me_len;
+	uint32_t		me_flags;
 };
 
 /* rmap me_flags: upper bits are flags, lower byte is type code */
@@ -659,10 +648,10 @@ struct xfs_map_extent {
  * size is given by rui_nextents.
  */
 struct xfs_rui_log_format {
-	__uint16_t		rui_type;	/* rui log item type */
-	__uint16_t		rui_size;	/* size of this item */
-	__uint32_t		rui_nextents;	/* # extents to free */
-	__uint64_t		rui_id;		/* rui identifier */
+	uint16_t		rui_type;	/* rui log item type */
+	uint16_t		rui_size;	/* size of this item */
+	uint32_t		rui_nextents;	/* # extents to free */
+	uint64_t		rui_id;		/* rui identifier */
 	struct xfs_map_extent	rui_extents[];	/* array of extents to rmap */
 };
 
@@ -680,19 +669,19 @@ xfs_rui_log_format_sizeof(
  * size is given by rud_nextents;
  */
 struct xfs_rud_log_format {
-	__uint16_t		rud_type;	/* rud log item type */
-	__uint16_t		rud_size;	/* size of this item */
-	__uint32_t		__pad;
-	__uint64_t		rud_rui_id;	/* id of corresponding rui */
+	uint16_t		rud_type;	/* rud log item type */
+	uint16_t		rud_size;	/* size of this item */
+	uint32_t		__pad;
+	uint64_t		rud_rui_id;	/* id of corresponding rui */
 };
 
 /*
  * CUI/CUD (refcount update) log format definitions
  */
 struct xfs_phys_extent {
-	__uint64_t		pe_startblock;
-	__uint32_t		pe_len;
-	__uint32_t		pe_flags;
+	uint64_t		pe_startblock;
+	uint32_t		pe_len;
+	uint32_t		pe_flags;
 };
 
 /* refcount pe_flags: upper bits are flags, lower byte is type code */
@@ -707,10 +696,10 @@ struct xfs_phys_extent {
  * size is given by cui_nextents.
  */
 struct xfs_cui_log_format {
-	__uint16_t		cui_type;	/* cui log item type */
-	__uint16_t		cui_size;	/* size of this item */
-	__uint32_t		cui_nextents;	/* # extents to free */
-	__uint64_t		cui_id;		/* cui identifier */
+	uint16_t		cui_type;	/* cui log item type */
+	uint16_t		cui_size;	/* size of this item */
+	uint32_t		cui_nextents;	/* # extents to free */
+	uint64_t		cui_id;		/* cui identifier */
 	struct xfs_phys_extent	cui_extents[];	/* array of extents */
 };
 
@@ -728,10 +717,10 @@ xfs_cui_log_format_sizeof(
  * size is given by cud_nextents;
  */
 struct xfs_cud_log_format {
-	__uint16_t		cud_type;	/* cud log item type */
-	__uint16_t		cud_size;	/* size of this item */
-	__uint32_t		__pad;
-	__uint64_t		cud_cui_id;	/* id of corresponding cui */
+	uint16_t		cud_type;	/* cud log item type */
+	uint16_t		cud_size;	/* size of this item */
+	uint32_t		__pad;
+	uint64_t		cud_cui_id;	/* id of corresponding cui */
 };
 
 /*
@@ -755,10 +744,10 @@ struct xfs_cud_log_format {
  * size is given by bui_nextents.
  */
 struct xfs_bui_log_format {
-	__uint16_t		bui_type;	/* bui log item type */
-	__uint16_t		bui_size;	/* size of this item */
-	__uint32_t		bui_nextents;	/* # extents to free */
-	__uint64_t		bui_id;		/* bui identifier */
+	uint16_t		bui_type;	/* bui log item type */
+	uint16_t		bui_size;	/* size of this item */
+	uint32_t		bui_nextents;	/* # extents to free */
+	uint64_t		bui_id;		/* bui identifier */
 	struct xfs_map_extent	bui_extents[];	/* array of extents to bmap */
 };
 
@@ -776,10 +765,10 @@ xfs_bui_log_format_sizeof(
  * size is given by bud_nextents;
  */
 struct xfs_bud_log_format {
-	__uint16_t		bud_type;	/* bud log item type */
-	__uint16_t		bud_size;	/* size of this item */
-	__uint32_t		__pad;
-	__uint64_t		bud_bui_id;	/* id of corresponding bui */
+	uint16_t		bud_type;	/* bud log item type */
+	uint16_t		bud_size;	/* size of this item */
+	uint32_t		__pad;
+	uint64_t		bud_bui_id;	/* id of corresponding bui */
 };
 
 /*
@@ -789,12 +778,12 @@ struct xfs_bud_log_format {
  * 32 bits : log_recovery code assumes that.
  */
 typedef struct xfs_dq_logformat {
-	__uint16_t		qlf_type;      /* dquot log item type */
-	__uint16_t		qlf_size;      /* size of this item */
+	uint16_t		qlf_type;      /* dquot log item type */
+	uint16_t		qlf_size;      /* size of this item */
 	xfs_dqid_t		qlf_id;	       /* usr/grp/proj id : 32 bits */
-	__int64_t		qlf_blkno;     /* blkno of dquot buffer */
-	__int32_t		qlf_len;       /* len of dquot buffer */
-	__uint32_t		qlf_boffset;   /* off of dquot in buffer */
+	int64_t			qlf_blkno;     /* blkno of dquot buffer */
+	int32_t			qlf_len;       /* len of dquot buffer */
+	uint32_t		qlf_boffset;   /* off of dquot in buffer */
 } xfs_dq_logformat_t;
 
 /*
@@ -853,8 +842,8 @@ typedef struct xfs_qoff_logformat {
  * decoding can be done correctly.
  */
 struct xfs_icreate_log {
-	__uint16_t	icl_type;	/* type of log format structure */
-	__uint16_t	icl_size;	/* size of log format structure */
+	uint16_t	icl_type;	/* type of log format structure */
+	uint16_t	icl_size;	/* size of log format structure */
 	__be32		icl_ag;		/* ag being allocated in */
 	__be32		icl_agbno;	/* start block of inode range */
 	__be32		icl_count;	/* number of inodes to initialise */
diff -urpN xfsprogs-4.9.0/libxfs/xfs_quota_defs.h xfsprogs-4.14.0/libxfs/xfs_quota_defs.h
--- xfsprogs-4.9.0/libxfs/xfs_quota_defs.h	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/libxfs/xfs_quota_defs.h	2017-11-20 01:14:14.000000000 +0100
@@ -27,8 +27,8 @@
  * they may need 64-bit accounting. Hence, 64-bit quota-counters,
  * and quota-limits. This is a waste in the common case, but hey ...
  */
-typedef __uint64_t	xfs_qcnt_t;
-typedef __uint16_t	xfs_qwarncnt_t;
+typedef uint64_t	xfs_qcnt_t;
+typedef uint16_t	xfs_qwarncnt_t;
 
 /*
  * flags for q_flags field in the dquot.
diff -urpN xfsprogs-4.9.0/libxfs/xfs_refcount.c xfsprogs-4.14.0/libxfs/xfs_refcount.c
--- xfsprogs-4.9.0/libxfs/xfs_refcount.c	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/libxfs/xfs_refcount.c	2017-11-27 17:57:55.000000000 +0100
@@ -783,14 +783,6 @@ xfs_refcount_merge_extents(
 }
 
 /*
- * While we're adjusting the refcounts records of an extent, we have
- * to keep an eye on the number of extents we're dirtying -- run too
- * many in a single transaction and we'll exceed the transaction's
- * reservation and crash the fs.  Each record adds 12 bytes to the
- * log (plus any key updates) so we'll conservatively assume 24 bytes
- * per record.  We must also leave space for btree splits on both ends
- * of the range and space for the CUD and a new CUI.
- *
  * XXX: This is a pretty hand-wavy estimate.  The penalty for guessing
  * true incorrectly is a shutdown FS; the penalty for guessing false
  * incorrectly is more transaction rolls than might be necessary.
@@ -812,8 +804,7 @@ xfs_refcount_still_have_space(
 	 */
 	if (cur->bc_private.a.priv.refc.nr_ops > 2 &&
 	    XFS_TEST_ERROR(false, cur->bc_mp,
-			XFS_ERRTAG_REFCOUNT_CONTINUE_UPDATE,
-			XFS_RANDOM_REFCOUNT_CONTINUE_UPDATE))
+			XFS_ERRTAG_REFCOUNT_CONTINUE_UPDATE))
 		return false;
 
 	if (cur->bc_private.a.priv.refc.nr_ops == 0)
@@ -821,7 +812,7 @@ xfs_refcount_still_have_space(
 	else if (overhead > cur->bc_tp->t_log_res)
 		return false;
 	return  cur->bc_tp->t_log_res - overhead >
-		cur->bc_private.a.priv.refc.nr_ops * 32;
+		cur->bc_private.a.priv.refc.nr_ops * XFS_REFCOUNT_ITEM_OVERHEAD;
 }
 
 /*
@@ -1075,8 +1066,7 @@ xfs_refcount_finish_one(
 			blockcount);
 
 	if (XFS_TEST_ERROR(false, mp,
-			XFS_ERRTAG_REFCOUNT_FINISH_ONE,
-			XFS_RANDOM_REFCOUNT_FINISH_ONE))
+			XFS_ERRTAG_REFCOUNT_FINISH_ONE))
 		return -EIO;
 
 	/*
@@ -1628,13 +1618,32 @@ xfs_refcount_recover_cow_leftovers(
 	if (mp->m_sb.sb_agblocks >= XFS_REFC_COW_START)
 		return -EOPNOTSUPP;
 
-	error = xfs_alloc_read_agf(mp, NULL, agno, 0, &agbp);
+	INIT_LIST_HEAD(&debris);
+
+	/*
+	 * In this first part, we use an empty transaction to gather up
+	 * all the leftover CoW extents so that we can subsequently
+	 * delete them.  The empty transaction is used to avoid
+	 * a buffer lock deadlock if there happens to be a loop in the
+	 * refcountbt because we're allowed to re-grab a buffer that is
+	 * already attached to our transaction.  When we're done
+	 * recording the CoW debris we cancel the (empty) transaction
+	 * and everything goes away cleanly.
+	 */
+	error = xfs_trans_alloc_empty(mp, &tp);
 	if (error)
 		return error;
-	cur = xfs_refcountbt_init_cursor(mp, NULL, agbp, agno, NULL);
+
+	error = xfs_alloc_read_agf(mp, tp, agno, 0, &agbp);
+	if (error)
+		goto out_trans;
+	if (!agbp) {
+		error = -ENOMEM;
+		goto out_trans;
+	}
+	cur = xfs_refcountbt_init_cursor(mp, tp, agbp, agno, NULL);
 
 	/* Find all the leftover CoW staging extents. */
-	INIT_LIST_HEAD(&debris);
 	memset(&low, 0, sizeof(low));
 	memset(&high, 0, sizeof(high));
 	low.rc.rc_startblock = XFS_REFC_COW_START;
@@ -1644,10 +1653,11 @@ xfs_refcount_recover_cow_leftovers(
 	if (error)
 		goto out_cursor;
 	xfs_btree_del_cursor(cur, XFS_BTREE_NOERROR);
-	xfs_buf_relse(agbp);
+	xfs_trans_brelse(tp, agbp);
+	xfs_trans_cancel(tp);
 
 	/* Now iterate the list to free the leftovers */
-	list_for_each_entry(rr, &debris, rr_list) {
+	list_for_each_entry_safe(rr, n, &debris, rr_list) {
 		/* Set up transaction. */
 		error = xfs_trans_alloc(mp, &M_RES(mp)->tr_write, 0, 0, 0, &tp);
 		if (error)
@@ -1668,15 +1678,23 @@ xfs_refcount_recover_cow_leftovers(
 		xfs_bmap_add_free(mp, &dfops, fsb,
 				rr->rr_rrec.rc_blockcount, NULL);
 
-		error = xfs_defer_finish(&tp, &dfops, NULL);
+		error = xfs_defer_finish(&tp, &dfops);
 		if (error)
 			goto out_defer;
 
 		error = xfs_trans_commit(tp);
 		if (error)
 			goto out_free;
+
+		list_del(&rr->rr_list);
+		kmem_free(rr);
 	}
 
+	return error;
+out_defer:
+	xfs_defer_cancel(&dfops);
+out_trans:
+	xfs_trans_cancel(tp);
 out_free:
 	/* Free the leftover list */
 	list_for_each_entry_safe(rr, n, &debris, rr_list) {
@@ -1687,11 +1705,6 @@ out_free:
 
 out_cursor:
 	xfs_btree_del_cursor(cur, XFS_BTREE_ERROR);
-	xfs_buf_relse(agbp);
-	goto out_free;
-
-out_defer:
-	xfs_defer_cancel(&dfops);
-	xfs_trans_cancel(tp);
-	goto out_free;
+	xfs_trans_brelse(tp, agbp);
+	goto out_trans;
 }
diff -urpN xfsprogs-4.9.0/libxfs/xfs_refcount.h xfsprogs-4.14.0/libxfs/xfs_refcount.h
--- xfsprogs-4.9.0/libxfs/xfs_refcount.h	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/libxfs/xfs_refcount.h	2017-11-20 01:14:14.000000000 +0100
@@ -67,4 +67,20 @@ extern int xfs_refcount_free_cow_extent(
 extern int xfs_refcount_recover_cow_leftovers(struct xfs_mount *mp,
 		xfs_agnumber_t agno);
 
+/*
+ * While we're adjusting the refcounts records of an extent, we have
+ * to keep an eye on the number of extents we're dirtying -- run too
+ * many in a single transaction and we'll exceed the transaction's
+ * reservation and crash the fs.  Each record adds 12 bytes to the
+ * log (plus any key updates) so we'll conservatively assume 32 bytes
+ * per record.  We must also leave space for btree splits on both ends
+ * of the range and space for the CUD and a new CUI.
+ */
+#define XFS_REFCOUNT_ITEM_OVERHEAD	32
+
+static inline xfs_fileoff_t xfs_refcount_max_unmap(int log_res)
+{
+	return (log_res * 3 / 4) / XFS_REFCOUNT_ITEM_OVERHEAD;
+}
+
 #endif	/* __XFS_REFCOUNT_H__ */
diff -urpN xfsprogs-4.9.0/libxfs/xfs_refcount_btree.c xfsprogs-4.14.0/libxfs/xfs_refcount_btree.c
--- xfsprogs-4.9.0/libxfs/xfs_refcount_btree.c	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/libxfs/xfs_refcount_btree.c	2017-11-20 01:14:14.000000000 +0100
@@ -201,7 +201,7 @@ xfs_refcountbt_init_ptr_from_cur(
 	ptr->s = agf->agf_refcount_root;
 }
 
-STATIC __int64_t
+STATIC int64_t
 xfs_refcountbt_key_diff(
 	struct xfs_btree_cur	*cur,
 	union xfs_btree_key	*key)
@@ -209,16 +209,16 @@ xfs_refcountbt_key_diff(
 	struct xfs_refcount_irec	*rec = &cur->bc_rec.rc;
 	struct xfs_refcount_key		*kp = &key->refc;
 
-	return (__int64_t)be32_to_cpu(kp->rc_startblock) - rec->rc_startblock;
+	return (int64_t)be32_to_cpu(kp->rc_startblock) - rec->rc_startblock;
 }
 
-STATIC __int64_t
+STATIC int64_t
 xfs_refcountbt_diff_two_keys(
 	struct xfs_btree_cur	*cur,
 	union xfs_btree_key	*k1,
 	union xfs_btree_key	*k2)
 {
-	return (__int64_t)be32_to_cpu(k1->refc.rc_startblock) -
+	return (int64_t)be32_to_cpu(k1->refc.rc_startblock) -
 			  be32_to_cpu(k2->refc.rc_startblock);
 }
 
@@ -284,7 +284,6 @@ const struct xfs_buf_ops xfs_refcountbt_
 	.verify_write		= xfs_refcountbt_write_verify,
 };
 
-#if defined(DEBUG) || defined(XFS_WARN)
 STATIC int
 xfs_refcountbt_keys_inorder(
 	struct xfs_btree_cur	*cur,
@@ -305,7 +304,6 @@ xfs_refcountbt_recs_inorder(
 		be32_to_cpu(r1->refc.rc_blockcount) <=
 		be32_to_cpu(r2->refc.rc_startblock);
 }
-#endif
 
 static const struct xfs_btree_ops xfs_refcountbt_ops = {
 	.rec_len		= sizeof(struct xfs_refcount_rec),
@@ -324,10 +322,8 @@ static const struct xfs_btree_ops xfs_re
 	.key_diff		= xfs_refcountbt_key_diff,
 	.buf_ops		= &xfs_refcountbt_buf_ops,
 	.diff_two_keys		= xfs_refcountbt_diff_two_keys,
-#if defined(DEBUG) || defined(XFS_WARN)
 	.keys_inorder		= xfs_refcountbt_keys_inorder,
 	.recs_inorder		= xfs_refcountbt_recs_inorder,
-#endif
 };
 
 /*
@@ -353,6 +349,7 @@ xfs_refcountbt_init_cursor(
 	cur->bc_btnum = XFS_BTNUM_REFC;
 	cur->bc_blocklog = mp->m_sb.sb_blocklog;
 	cur->bc_ops = &xfs_refcountbt_ops;
+	cur->bc_statoff = XFS_STATS_CALC_INDEX(xs_refcbt_2);
 
 	cur->bc_nlevels = be32_to_cpu(agf->agf_refcount_level);
 
@@ -407,13 +404,14 @@ xfs_refcountbt_calc_size(
  */
 xfs_extlen_t
 xfs_refcountbt_max_size(
-	struct xfs_mount	*mp)
+	struct xfs_mount	*mp,
+	xfs_agblock_t		agblocks)
 {
 	/* Bail out if we're uninitialized, which can happen in mkfs. */
 	if (mp->m_refc_mxr[0] == 0)
 		return 0;
 
-	return xfs_refcountbt_calc_size(mp, mp->m_sb.sb_agblocks);
+	return xfs_refcountbt_calc_size(mp, agblocks);
 }
 
 /*
@@ -428,22 +426,24 @@ xfs_refcountbt_calc_reserves(
 {
 	struct xfs_buf		*agbp;
 	struct xfs_agf		*agf;
+	xfs_agblock_t		agblocks;
 	xfs_extlen_t		tree_len;
 	int			error;
 
 	if (!xfs_sb_version_hasreflink(&mp->m_sb))
 		return 0;
 
-	*ask += xfs_refcountbt_max_size(mp);
 
 	error = xfs_alloc_read_agf(mp, NULL, agno, 0, &agbp);
 	if (error)
 		return error;
 
 	agf = XFS_BUF_TO_AGF(agbp);
+	agblocks = be32_to_cpu(agf->agf_length);
 	tree_len = be32_to_cpu(agf->agf_refcount_blocks);
 	xfs_buf_relse(agbp);
 
+	*ask += xfs_refcountbt_max_size(mp, agblocks);
 	*used += tree_len;
 
 	return error;
diff -urpN xfsprogs-4.9.0/libxfs/xfs_refcount_btree.h xfsprogs-4.14.0/libxfs/xfs_refcount_btree.h
--- xfsprogs-4.9.0/libxfs/xfs_refcount_btree.h	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/libxfs/xfs_refcount_btree.h	2017-11-20 01:14:14.000000000 +0100
@@ -66,7 +66,8 @@ extern void xfs_refcountbt_compute_maxle
 
 extern xfs_extlen_t xfs_refcountbt_calc_size(struct xfs_mount *mp,
 		unsigned long long len);
-extern xfs_extlen_t xfs_refcountbt_max_size(struct xfs_mount *mp);
+extern xfs_extlen_t xfs_refcountbt_max_size(struct xfs_mount *mp,
+		xfs_agblock_t agblocks);
 
 extern int xfs_refcountbt_calc_reserves(struct xfs_mount *mp,
 		xfs_agnumber_t agno, xfs_extlen_t *ask, xfs_extlen_t *used);
diff -urpN xfsprogs-4.9.0/libxfs/xfs_rmap.c xfsprogs-4.14.0/libxfs/xfs_rmap.c
--- xfsprogs-4.9.0/libxfs/xfs_rmap.c	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/libxfs/xfs_rmap.c	2017-11-27 17:57:52.000000000 +0100
@@ -177,7 +177,8 @@ done:
 	return error;
 }
 
-static int
+/* Convert an internal btree record to an rmap record. */
+int
 xfs_rmap_btrec_to_irec(
 	union xfs_btree_rec	*rec,
 	struct xfs_rmap_irec	*irec)
@@ -1999,14 +2000,14 @@ xfs_rmap_query_range_helper(
 /* Find all rmaps between two keys. */
 int
 xfs_rmap_query_range(
-	struct xfs_btree_cur		*cur,
-	struct xfs_rmap_irec		*low_rec,
-	struct xfs_rmap_irec		*high_rec,
-	xfs_rmap_query_range_fn	fn,
-	void				*priv)
+	struct xfs_btree_cur			*cur,
+	struct xfs_rmap_irec			*low_rec,
+	struct xfs_rmap_irec			*high_rec,
+	xfs_rmap_query_range_fn			fn,
+	void					*priv)
 {
-	union xfs_btree_irec		low_brec;
-	union xfs_btree_irec		high_brec;
+	union xfs_btree_irec			low_brec;
+	union xfs_btree_irec			high_brec;
 	struct xfs_rmap_query_range_info	query;
 
 	low_brec.r = *low_rec;
@@ -2017,6 +2018,20 @@ xfs_rmap_query_range(
 			xfs_rmap_query_range_helper, &query);
 }
 
+/* Find all rmaps. */
+int
+xfs_rmap_query_all(
+	struct xfs_btree_cur			*cur,
+	xfs_rmap_query_range_fn			fn,
+	void					*priv)
+{
+	struct xfs_rmap_query_range_info	query;
+
+	query.priv = priv;
+	query.fn = fn;
+	return xfs_btree_query_all(cur, xfs_rmap_query_range_helper, &query);
+}
+
 /* Clean up after calling xfs_rmap_finish_one. */
 void
 xfs_rmap_finish_one_cleanup(
@@ -2045,7 +2060,7 @@ int
 xfs_rmap_finish_one(
 	struct xfs_trans		*tp,
 	enum xfs_rmap_intent_type	type,
-	__uint64_t			owner,
+	uint64_t			owner,
 	int				whichfork,
 	xfs_fileoff_t			startoff,
 	xfs_fsblock_t			startblock,
@@ -2070,8 +2085,7 @@ xfs_rmap_finish_one(
 			startoff, blockcount, state);
 
 	if (XFS_TEST_ERROR(false, mp,
-			XFS_ERRTAG_RMAP_FINISH_ONE,
-			XFS_RANDOM_RMAP_FINISH_ONE))
+			XFS_ERRTAG_RMAP_FINISH_ONE))
 		return -EIO;
 
 	/*
@@ -2166,7 +2180,7 @@ __xfs_rmap_add(
 	struct xfs_mount		*mp,
 	struct xfs_defer_ops		*dfops,
 	enum xfs_rmap_intent_type	type,
-	__uint64_t			owner,
+	uint64_t			owner,
 	int				whichfork,
 	struct xfs_bmbt_irec		*bmap)
 {
@@ -2250,7 +2264,7 @@ xfs_rmap_alloc_extent(
 	xfs_agnumber_t		agno,
 	xfs_agblock_t		bno,
 	xfs_extlen_t		len,
-	__uint64_t		owner)
+	uint64_t		owner)
 {
 	struct xfs_bmbt_irec	bmap;
 
@@ -2274,7 +2288,7 @@ xfs_rmap_free_extent(
 	xfs_agnumber_t		agno,
 	xfs_agblock_t		bno,
 	xfs_extlen_t		len,
-	__uint64_t		owner)
+	uint64_t		owner)
 {
 	struct xfs_bmbt_irec	bmap;
 
@@ -2289,3 +2303,31 @@ xfs_rmap_free_extent(
 	return __xfs_rmap_add(mp, dfops, XFS_RMAP_FREE, owner,
 			XFS_DATA_FORK, &bmap);
 }
+
+/* Compare rmap records.  Returns -1 if a < b, 1 if a > b, and 0 if equal. */
+int
+xfs_rmap_compare(
+	const struct xfs_rmap_irec	*a,
+	const struct xfs_rmap_irec	*b)
+{
+	__u64				oa;
+	__u64				ob;
+
+	oa = xfs_rmap_irec_offset_pack(a);
+	ob = xfs_rmap_irec_offset_pack(b);
+
+	if (a->rm_startblock < b->rm_startblock)
+		return -1;
+	else if (a->rm_startblock > b->rm_startblock)
+		return 1;
+	else if (a->rm_owner < b->rm_owner)
+		return -1;
+	else if (a->rm_owner > b->rm_owner)
+		return 1;
+	else if (oa < ob)
+		return -1;
+	else if (oa > ob)
+		return 1;
+	else
+		return 0;
+}
diff -urpN xfsprogs-4.9.0/libxfs/xfs_rmap.h xfsprogs-4.14.0/libxfs/xfs_rmap.h
--- xfsprogs-4.9.0/libxfs/xfs_rmap.h	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/libxfs/xfs_rmap.h	2017-11-20 01:14:14.000000000 +0100
@@ -162,6 +162,8 @@ typedef int (*xfs_rmap_query_range_fn)(
 int xfs_rmap_query_range(struct xfs_btree_cur *cur,
 		struct xfs_rmap_irec *low_rec, struct xfs_rmap_irec *high_rec,
 		xfs_rmap_query_range_fn fn, void *priv);
+int xfs_rmap_query_all(struct xfs_btree_cur *cur, xfs_rmap_query_range_fn fn,
+		void *priv);
 
 enum xfs_rmap_intent_type {
 	XFS_RMAP_MAP,
@@ -177,7 +179,7 @@ enum xfs_rmap_intent_type {
 struct xfs_rmap_intent {
 	struct list_head			ri_list;
 	enum xfs_rmap_intent_type		ri_type;
-	__uint64_t				ri_owner;
+	uint64_t				ri_owner;
 	int					ri_whichfork;
 	struct xfs_bmbt_irec			ri_bmap;
 };
@@ -194,15 +196,15 @@ int xfs_rmap_convert_extent(struct xfs_m
 		struct xfs_bmbt_irec *imap);
 int xfs_rmap_alloc_extent(struct xfs_mount *mp, struct xfs_defer_ops *dfops,
 		xfs_agnumber_t agno, xfs_agblock_t bno, xfs_extlen_t len,
-		__uint64_t owner);
+		uint64_t owner);
 int xfs_rmap_free_extent(struct xfs_mount *mp, struct xfs_defer_ops *dfops,
 		xfs_agnumber_t agno, xfs_agblock_t bno, xfs_extlen_t len,
-		__uint64_t owner);
+		uint64_t owner);
 
 void xfs_rmap_finish_one_cleanup(struct xfs_trans *tp,
 		struct xfs_btree_cur *rcur, int error);
 int xfs_rmap_finish_one(struct xfs_trans *tp, enum xfs_rmap_intent_type type,
-		__uint64_t owner, int whichfork, xfs_fileoff_t startoff,
+		uint64_t owner, int whichfork, xfs_fileoff_t startoff,
 		xfs_fsblock_t startblock, xfs_filblks_t blockcount,
 		xfs_exntst_t state, struct xfs_btree_cur **pcur);
 
@@ -212,5 +214,10 @@ int xfs_rmap_find_left_neighbor(struct x
 int xfs_rmap_lookup_le_range(struct xfs_btree_cur *cur, xfs_agblock_t bno,
 		uint64_t owner, uint64_t offset, unsigned int flags,
 		struct xfs_rmap_irec *irec, int	*stat);
+int xfs_rmap_compare(const struct xfs_rmap_irec *a,
+		const struct xfs_rmap_irec *b);
+union xfs_btree_rec;
+int xfs_rmap_btrec_to_irec(union xfs_btree_rec *rec,
+		struct xfs_rmap_irec *irec);
 
 #endif	/* __XFS_RMAP_H__ */
diff -urpN xfsprogs-4.9.0/libxfs/xfs_rmap_btree.c xfsprogs-4.14.0/libxfs/xfs_rmap_btree.c
--- xfsprogs-4.9.0/libxfs/xfs_rmap_btree.c	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/libxfs/xfs_rmap_btree.c	2017-11-20 01:14:14.000000000 +0100
@@ -197,7 +197,7 @@ xfs_rmapbt_init_high_key_from_rec(
 	union xfs_btree_key	*key,
 	union xfs_btree_rec	*rec)
 {
-	__uint64_t		off;
+	uint64_t		off;
 	int			adj;
 
 	adj = be32_to_cpu(rec->rmap.rm_blockcount) - 1;
@@ -239,7 +239,7 @@ xfs_rmapbt_init_ptr_from_cur(
 	ptr->s = agf->agf_roots[cur->bc_btnum];
 }
 
-STATIC __int64_t
+STATIC int64_t
 xfs_rmapbt_key_diff(
 	struct xfs_btree_cur	*cur,
 	union xfs_btree_key	*key)
@@ -247,9 +247,9 @@ xfs_rmapbt_key_diff(
 	struct xfs_rmap_irec	*rec = &cur->bc_rec.r;
 	struct xfs_rmap_key	*kp = &key->rmap;
 	__u64			x, y;
-	__int64_t		d;
+	int64_t			d;
 
-	d = (__int64_t)be32_to_cpu(kp->rm_startblock) - rec->rm_startblock;
+	d = (int64_t)be32_to_cpu(kp->rm_startblock) - rec->rm_startblock;
 	if (d)
 		return d;
 
@@ -269,7 +269,7 @@ xfs_rmapbt_key_diff(
 	return 0;
 }
 
-STATIC __int64_t
+STATIC int64_t
 xfs_rmapbt_diff_two_keys(
 	struct xfs_btree_cur	*cur,
 	union xfs_btree_key	*k1,
@@ -277,10 +277,10 @@ xfs_rmapbt_diff_two_keys(
 {
 	struct xfs_rmap_key	*kp1 = &k1->rmap;
 	struct xfs_rmap_key	*kp2 = &k2->rmap;
-	__int64_t		d;
+	int64_t			d;
 	__u64			x, y;
 
-	d = (__int64_t)be32_to_cpu(kp1->rm_startblock) -
+	d = (int64_t)be32_to_cpu(kp1->rm_startblock) -
 		       be32_to_cpu(kp2->rm_startblock);
 	if (d)
 		return d;
@@ -375,17 +375,16 @@ const struct xfs_buf_ops xfs_rmapbt_buf_
 	.verify_write		= xfs_rmapbt_write_verify,
 };
 
-#if defined(DEBUG) || defined(XFS_WARN)
 STATIC int
 xfs_rmapbt_keys_inorder(
 	struct xfs_btree_cur	*cur,
 	union xfs_btree_key	*k1,
 	union xfs_btree_key	*k2)
 {
-	__uint32_t		x;
-	__uint32_t		y;
-	__uint64_t		a;
-	__uint64_t		b;
+	uint32_t		x;
+	uint32_t		y;
+	uint64_t		a;
+	uint64_t		b;
 
 	x = be32_to_cpu(k1->rmap.rm_startblock);
 	y = be32_to_cpu(k2->rmap.rm_startblock);
@@ -412,10 +411,10 @@ xfs_rmapbt_recs_inorder(
 	union xfs_btree_rec	*r1,
 	union xfs_btree_rec	*r2)
 {
-	__uint32_t		x;
-	__uint32_t		y;
-	__uint64_t		a;
-	__uint64_t		b;
+	uint32_t		x;
+	uint32_t		y;
+	uint64_t		a;
+	uint64_t		b;
 
 	x = be32_to_cpu(r1->rmap.rm_startblock);
 	y = be32_to_cpu(r2->rmap.rm_startblock);
@@ -435,7 +434,6 @@ xfs_rmapbt_recs_inorder(
 		return 1;
 	return 0;
 }
-#endif	/* DEBUG */
 
 static const struct xfs_btree_ops xfs_rmapbt_ops = {
 	.rec_len		= sizeof(struct xfs_rmap_rec),
@@ -454,10 +452,8 @@ static const struct xfs_btree_ops xfs_rm
 	.key_diff		= xfs_rmapbt_key_diff,
 	.buf_ops		= &xfs_rmapbt_buf_ops,
 	.diff_two_keys		= xfs_rmapbt_diff_two_keys,
-#if defined(DEBUG) || defined(XFS_WARN)
 	.keys_inorder		= xfs_rmapbt_keys_inorder,
 	.recs_inorder		= xfs_rmapbt_recs_inorder,
-#endif
 };
 
 /*
@@ -482,6 +478,7 @@ xfs_rmapbt_init_cursor(
 	cur->bc_blocklog = mp->m_sb.sb_blocklog;
 	cur->bc_ops = &xfs_rmapbt_ops;
 	cur->bc_nlevels = be32_to_cpu(agf->agf_levels[XFS_BTNUM_RMAP]);
+	cur->bc_statoff = XFS_STATS_CALC_INDEX(xs_rmap_2);
 
 	cur->bc_private.a.agbp = agbp;
 	cur->bc_private.a.agno = agno;
@@ -547,13 +544,14 @@ xfs_rmapbt_calc_size(
  */
 xfs_extlen_t
 xfs_rmapbt_max_size(
-	struct xfs_mount	*mp)
+	struct xfs_mount	*mp,
+	xfs_agblock_t		agblocks)
 {
 	/* Bail out if we're uninitialized, which can happen in mkfs. */
 	if (mp->m_rmap_mxr[0] == 0)
 		return 0;
 
-	return xfs_rmapbt_calc_size(mp, mp->m_sb.sb_agblocks);
+	return xfs_rmapbt_calc_size(mp, agblocks);
 }
 
 /*
@@ -568,25 +566,24 @@ xfs_rmapbt_calc_reserves(
 {
 	struct xfs_buf		*agbp;
 	struct xfs_agf		*agf;
-	xfs_extlen_t		pool_len;
+	xfs_agblock_t		agblocks;
 	xfs_extlen_t		tree_len;
 	int			error;
 
 	if (!xfs_sb_version_hasrmapbt(&mp->m_sb))
 		return 0;
 
-	/* Reserve 1% of the AG or enough for 1 block per record. */
-	pool_len = max(mp->m_sb.sb_agblocks / 100, xfs_rmapbt_max_size(mp));
-	*ask += pool_len;
-
 	error = xfs_alloc_read_agf(mp, NULL, agno, 0, &agbp);
 	if (error)
 		return error;
 
 	agf = XFS_BUF_TO_AGF(agbp);
+	agblocks = be32_to_cpu(agf->agf_length);
 	tree_len = be32_to_cpu(agf->agf_rmap_blocks);
 	xfs_buf_relse(agbp);
 
+	/* Reserve 1% of the AG or enough for 1 block per record. */
+	*ask += max(agblocks / 100, xfs_rmapbt_max_size(mp, agblocks));
 	*used += tree_len;
 
 	return error;
diff -urpN xfsprogs-4.9.0/libxfs/xfs_rmap_btree.h xfsprogs-4.14.0/libxfs/xfs_rmap_btree.h
--- xfsprogs-4.9.0/libxfs/xfs_rmap_btree.h	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/libxfs/xfs_rmap_btree.h	2017-11-20 01:14:14.000000000 +0100
@@ -60,7 +60,8 @@ extern void xfs_rmapbt_compute_maxlevels
 
 extern xfs_extlen_t xfs_rmapbt_calc_size(struct xfs_mount *mp,
 		unsigned long long len);
-extern xfs_extlen_t xfs_rmapbt_max_size(struct xfs_mount *mp);
+extern xfs_extlen_t xfs_rmapbt_max_size(struct xfs_mount *mp,
+		xfs_agblock_t agblocks);
 
 extern int xfs_rmapbt_calc_reserves(struct xfs_mount *mp,
 		xfs_agnumber_t agno, xfs_extlen_t *ask, xfs_extlen_t *used);
diff -urpN xfsprogs-4.9.0/libxfs/xfs_rtbitmap.c xfsprogs-4.14.0/libxfs/xfs_rtbitmap.c
--- xfsprogs-4.9.0/libxfs/xfs_rtbitmap.c	2016-12-13 20:38:44.000000000 +0100
+++ xfsprogs-4.14.0/libxfs/xfs_rtbitmap.c	2017-11-27 17:57:52.000000000 +0100
@@ -65,7 +65,7 @@ const struct xfs_buf_ops xfs_rtbuf_ops =
  * Get a buffer for the bitmap or summary file block specified.
  * The buffer is returned read and locked.
  */
-static int
+int
 xfs_rtbuf_get(
 	xfs_mount_t	*mp,		/* file system mount structure */
 	xfs_trans_t	*tp,		/* transaction pointer */
@@ -1006,8 +1006,78 @@ xfs_rtfree_extent(
 	    mp->m_sb.sb_rextents) {
 		if (!(mp->m_rbmip->i_d.di_flags & XFS_DIFLAG_NEWRTBM))
 			mp->m_rbmip->i_d.di_flags |= XFS_DIFLAG_NEWRTBM;
-		*(__uint64_t *)&VFS_I(mp->m_rbmip)->i_atime = 0;
+		*(uint64_t *)&VFS_I(mp->m_rbmip)->i_atime = 0;
 		xfs_trans_log_inode(tp, mp->m_rbmip, XFS_ILOG_CORE);
 	}
 	return 0;
 }
+
+/* Find all the free records within a given range. */
+int
+xfs_rtalloc_query_range(
+	struct xfs_trans		*tp,
+	struct xfs_rtalloc_rec		*low_rec,
+	struct xfs_rtalloc_rec		*high_rec,
+	xfs_rtalloc_query_range_fn	fn,
+	void				*priv)
+{
+	struct xfs_rtalloc_rec		rec;
+	struct xfs_mount		*mp = tp->t_mountp;
+	xfs_rtblock_t			rtstart;
+	xfs_rtblock_t			rtend;
+	xfs_rtblock_t			rem;
+	int				is_free;
+	int				error = 0;
+
+	if (low_rec->ar_startblock > high_rec->ar_startblock)
+		return -EINVAL;
+	else if (low_rec->ar_startblock == high_rec->ar_startblock)
+		return 0;
+
+	/* Iterate the bitmap, looking for discrepancies. */
+	rtstart = low_rec->ar_startblock;
+	rem = high_rec->ar_startblock - rtstart;
+	while (rem) {
+		/* Is the first block free? */
+		error = xfs_rtcheck_range(mp, tp, rtstart, 1, 1, &rtend,
+				&is_free);
+		if (error)
+			break;
+
+		/* How long does the extent go for? */
+		error = xfs_rtfind_forw(mp, tp, rtstart,
+				high_rec->ar_startblock - 1, &rtend);
+		if (error)
+			break;
+
+		if (is_free) {
+			rec.ar_startblock = rtstart;
+			rec.ar_blockcount = rtend - rtstart + 1;
+
+			error = fn(tp, &rec, priv);
+			if (error)
+				break;
+		}
+
+		rem -= rtend - rtstart + 1;
+		rtstart = rtend + 1;
+	}
+
+	return error;
+}
+
+/* Find all the free records. */
+int
+xfs_rtalloc_query_all(
+	struct xfs_trans		*tp,
+	xfs_rtalloc_query_range_fn	fn,
+	void				*priv)
+{
+	struct xfs_rtalloc_rec		keys[2];
+
+	keys[0].ar_startblock = 0;
+	keys[1].ar_startblock = tp->t_mountp->m_sb.sb_rblocks;
+	keys[0].ar_blockcount = keys[1].ar_blockcount = 0;
+
+	return xfs_rtalloc_query_range(tp, &keys[0], &keys[1], fn, priv);
+}
diff -urpN xfsprogs-4.9.0/libxfs/xfs_sb.c xfsprogs-4.14.0/libxfs/xfs_sb.c
--- xfsprogs-4.9.0/libxfs/xfs_sb.c	2017-01-05 18:41:55.000000000 +0100
+++ xfsprogs-4.14.0/libxfs/xfs_sb.c	2017-11-20 01:14:14.000000000 +0100
@@ -239,7 +239,7 @@ xfs_mount_validate_sb(
 	    sbp->sb_blocklog < XFS_MIN_BLOCKSIZE_LOG			||
 	    sbp->sb_blocklog > XFS_MAX_BLOCKSIZE_LOG			||
 	    sbp->sb_blocksize != (1 << sbp->sb_blocklog)		||
-	    sbp->sb_dirblklog > XFS_MAX_BLOCKSIZE_LOG			||
+	    sbp->sb_dirblklog + sbp->sb_blocklog > XFS_MAX_BLOCKSIZE_LOG ||
 	    sbp->sb_inodesize < XFS_DINODE_MIN_SIZE			||
 	    sbp->sb_inodesize > XFS_DINODE_MAX_SIZE			||
 	    sbp->sb_inodelog < XFS_DINODE_MIN_LOG			||
@@ -259,6 +259,12 @@ xfs_mount_validate_sb(
 		return -EFSCORRUPTED;
 	}
 
+	if (xfs_sb_version_hascrc(&mp->m_sb) &&
+	    sbp->sb_blocksize < XFS_MIN_CRC_BLOCKSIZE) {
+		xfs_notice(mp, "v5 SB sanity check failed");
+		return -EFSCORRUPTED;
+	}
+
 	/*
 	 * Currently only very few inode sizes are supported.
 	 */
@@ -424,7 +430,7 @@ xfs_sb_quota_to_disk(
 	struct xfs_dsb	*to,
 	struct xfs_sb	*from)
 {
-	__uint16_t	qflags = from->sb_qflags;
+	uint16_t	qflags = from->sb_qflags;
 
 	to->sb_uquotino = cpu_to_be64(from->sb_uquotino);
 	if (xfs_sb_version_has_pquotino(from)) {
@@ -732,7 +738,7 @@ xfs_sb_mount_common(
 	mp->m_refc_mnr[1] = mp->m_refc_mxr[1] / 2;
 
 	mp->m_bsize = XFS_FSB_TO_BB(mp, 1);
-	mp->m_ialloc_inos = (int)MAX((__uint16_t)XFS_INODES_PER_CHUNK,
+	mp->m_ialloc_inos = (int)MAX((uint16_t)XFS_INODES_PER_CHUNK,
 					sbp->sb_inopblock);
 	mp->m_ialloc_blks = mp->m_ialloc_inos >> sbp->sb_inopblog;
 
diff -urpN xfsprogs-4.9.0/libxfs/xfs_symlink_remote.c xfsprogs-4.14.0/libxfs/xfs_symlink_remote.c
--- xfsprogs-4.9.0/libxfs/xfs_symlink_remote.c	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/libxfs/xfs_symlink_remote.c	2017-11-20 01:14:14.000000000 +0100
@@ -110,7 +110,7 @@ xfs_symlink_verify(
 	if (bp->b_bn != be64_to_cpu(dsl->sl_blkno))
 		return false;
 	if (be32_to_cpu(dsl->sl_offset) +
-				be32_to_cpu(dsl->sl_bytes) >= MAXPATHLEN)
+				be32_to_cpu(dsl->sl_bytes) >= XFS_SYMLINK_MAXLEN)
 		return false;
 	if (dsl->sl_owner == 0)
 		return false;
diff -urpN xfsprogs-4.9.0/libxfs/xfs_trans_resv.c xfsprogs-4.14.0/libxfs/xfs_trans_resv.c
--- xfsprogs-4.9.0/libxfs/xfs_trans_resv.c	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/libxfs/xfs_trans_resv.c	2017-11-20 01:14:14.000000000 +0100
@@ -476,14 +476,14 @@ xfs_calc_mkdir_reservation(
 /*
  * Making a new symplink is the same as creating a new file, but
  * with the added blocks for remote symlink data which can be up to 1kB in
- * length (MAXPATHLEN).
+ * length (XFS_SYMLINK_MAXLEN).
  */
 STATIC uint
 xfs_calc_symlink_reservation(
 	struct xfs_mount	*mp)
 {
 	return xfs_calc_create_reservation(mp) +
-	       xfs_calc_buf_res(1, MAXPATHLEN);
+	       xfs_calc_buf_res(1, XFS_SYMLINK_MAXLEN);
 }
 
 /*
diff -urpN xfsprogs-4.9.0/libxfs/xfs_trans_space.h xfsprogs-4.14.0/libxfs/xfs_trans_space.h
--- xfsprogs-4.9.0/libxfs/xfs_trans_space.h	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/libxfs/xfs_trans_space.h	2017-11-20 01:14:14.000000000 +0100
@@ -21,8 +21,20 @@
 /*
  * Components of space reservations.
  */
+
+/* Worst case number of rmaps that can be held in a block. */
 #define XFS_MAX_CONTIG_RMAPS_PER_BLOCK(mp)    \
 		(((mp)->m_rmap_mxr[0]) - ((mp)->m_rmap_mnr[0]))
+
+/* Adding one rmap could split every level up to the top of the tree. */
+#define XFS_RMAPADD_SPACE_RES(mp) ((mp)->m_rmap_maxlevels)
+
+/* Blocks we might need to add "b" rmaps to a tree. */
+#define XFS_NRMAPADD_SPACE_RES(mp, b)\
+	(((b + XFS_MAX_CONTIG_RMAPS_PER_BLOCK(mp) - 1) / \
+	  XFS_MAX_CONTIG_RMAPS_PER_BLOCK(mp)) * \
+	  XFS_RMAPADD_SPACE_RES(mp))
+
 #define XFS_MAX_CONTIG_EXTENTS_PER_BLOCK(mp)    \
 		(((mp)->m_alloc_mxr[0]) - ((mp)->m_alloc_mnr[0]))
 #define	XFS_EXTENTADD_SPACE_RES(mp,w)	(XFS_BM_MAXLEVELS(mp,w) - 1)
@@ -30,13 +42,12 @@
 	(((b + XFS_MAX_CONTIG_EXTENTS_PER_BLOCK(mp) - 1) / \
 	  XFS_MAX_CONTIG_EXTENTS_PER_BLOCK(mp)) * \
 	  XFS_EXTENTADD_SPACE_RES(mp,w))
+
+/* Blocks we might need to add "b" mappings & rmappings to a file. */
 #define XFS_SWAP_RMAP_SPACE_RES(mp,b,w)\
-	(((b + XFS_MAX_CONTIG_EXTENTS_PER_BLOCK(mp) - 1) / \
-	  XFS_MAX_CONTIG_EXTENTS_PER_BLOCK(mp)) * \
-	  XFS_EXTENTADD_SPACE_RES(mp,w) + \
-	 ((b + XFS_MAX_CONTIG_RMAPS_PER_BLOCK(mp) - 1) / \
-	  XFS_MAX_CONTIG_RMAPS_PER_BLOCK(mp)) * \
-	  (mp)->m_rmap_maxlevels)
+	(XFS_NEXTENTADD_SPACE_RES((mp), (b), (w)) + \
+	 XFS_NRMAPADD_SPACE_RES((mp), (b)))
+
 #define	XFS_DAENTER_1B(mp,w)	\
 	((w) == XFS_DATA_FORK ? (mp)->m_dir_geo->fsbcount : 1)
 #define	XFS_DAENTER_DBS(mp,w)	\
diff -urpN xfsprogs-4.9.0/libxfs/xfs_types.h xfsprogs-4.14.0/libxfs/xfs_types.h
--- xfsprogs-4.9.0/libxfs/xfs_types.h	2016-12-13 20:32:00.000000000 +0100
+++ xfsprogs-4.14.0/libxfs/xfs_types.h	2017-11-27 17:57:52.000000000 +0100
@@ -18,34 +18,34 @@
 #ifndef __XFS_TYPES_H__
 #define	__XFS_TYPES_H__
 
-typedef __uint32_t	prid_t;		/* project ID */
+typedef uint32_t	prid_t;		/* project ID */
 
-typedef __uint32_t	xfs_agblock_t;	/* blockno in alloc. group */
-typedef	__uint32_t	xfs_agino_t;	/* inode # within allocation grp */
-typedef	__uint32_t	xfs_extlen_t;	/* extent length in blocks */
-typedef	__uint32_t	xfs_agnumber_t;	/* allocation group number */
-typedef __int32_t	xfs_extnum_t;	/* # of extents in a file */
-typedef __int16_t	xfs_aextnum_t;	/* # extents in an attribute fork */
-typedef	__int64_t	xfs_fsize_t;	/* bytes in a file */
-typedef __uint64_t	xfs_ufsize_t;	/* unsigned bytes in a file */
-
-typedef	__int32_t	xfs_suminfo_t;	/* type of bitmap summary info */
-typedef	__int32_t	xfs_rtword_t;	/* word type for bitmap manipulations */
-
-typedef	__int64_t	xfs_lsn_t;	/* log sequence number */
-typedef	__int32_t	xfs_tid_t;	/* transaction identifier */
-
-typedef	__uint32_t	xfs_dablk_t;	/* dir/attr block number (in file) */
-typedef	__uint32_t	xfs_dahash_t;	/* dir/attr hash value */
-
-typedef	__uint64_t	xfs_fsblock_t;	/* blockno in filesystem (agno|agbno) */
-typedef __uint64_t	xfs_rfsblock_t;	/* blockno in filesystem (raw) */
-typedef __uint64_t	xfs_rtblock_t;	/* extent (block) in realtime area */
-typedef __uint64_t	xfs_fileoff_t;	/* block number in a file */
-typedef __uint64_t	xfs_filblks_t;	/* number of blocks in a file */
+typedef uint32_t	xfs_agblock_t;	/* blockno in alloc. group */
+typedef uint32_t	xfs_agino_t;	/* inode # within allocation grp */
+typedef uint32_t	xfs_extlen_t;	/* extent length in blocks */
+typedef uint32_t	xfs_agnumber_t;	/* allocation group number */
+typedef int32_t		xfs_extnum_t;	/* # of extents in a file */
+typedef int16_t		xfs_aextnum_t;	/* # extents in an attribute fork */
+typedef int64_t		xfs_fsize_t;	/* bytes in a file */
+typedef uint64_t	xfs_ufsize_t;	/* unsigned bytes in a file */
+
+typedef int32_t		xfs_suminfo_t;	/* type of bitmap summary info */
+typedef int32_t		xfs_rtword_t;	/* word type for bitmap manipulations */
+
+typedef int64_t		xfs_lsn_t;	/* log sequence number */
+typedef int32_t		xfs_tid_t;	/* transaction identifier */
+
+typedef uint32_t	xfs_dablk_t;	/* dir/attr block number (in file) */
+typedef uint32_t	xfs_dahash_t;	/* dir/attr hash value */
+
+typedef uint64_t	xfs_fsblock_t;	/* blockno in filesystem (agno|agbno) */
+typedef uint64_t	xfs_rfsblock_t;	/* blockno in filesystem (raw) */
+typedef uint64_t	xfs_rtblock_t;	/* extent (block) in realtime area */
+typedef uint64_t	xfs_fileoff_t;	/* block number in a file */
+typedef uint64_t	xfs_filblks_t;	/* number of blocks in a file */
 
-typedef	__int64_t	xfs_srtblock_t;	/* signed version of xfs_rtblock_t */
-typedef __int64_t	xfs_sfiloff_t;	/* signed block number in a file */
+typedef int64_t		xfs_srtblock_t;	/* signed version of xfs_rtblock_t */
+typedef int64_t		xfs_sfiloff_t;	/* signed block number in a file */
 
 /*
  * Null values for the types.
@@ -57,7 +57,6 @@ typedef __int64_t	xfs_sfiloff_t;	/* sign
 
 #define	NULLAGBLOCK	((xfs_agblock_t)-1)
 #define	NULLAGNUMBER	((xfs_agnumber_t)-1)
-#define	NULLEXTNUM	((xfs_extnum_t)-1)
 
 #define NULLCOMMITLSN	((xfs_lsn_t)-1)
 
@@ -126,7 +125,7 @@ struct xfs_name {
  * uid_t and gid_t are hard-coded to 32 bits in the inode.
  * Hence, an 'id' in a dquot is 32 bits..
  */
-typedef __uint32_t	xfs_dqid_t;
+typedef uint32_t	xfs_dqid_t;
 
 /*
  * Constants for bit manipulations.
diff -urpN xfsprogs-4.9.0/logprint/log_misc.c xfsprogs-4.14.0/logprint/log_misc.c
--- xfsprogs-4.9.0/logprint/log_misc.c	2016-12-21 06:36:07.000000000 +0100
+++ xfsprogs-4.14.0/logprint/log_misc.c	2017-11-27 17:57:55.000000000 +0100
@@ -166,12 +166,12 @@ xlog_print_trans_header(char **ptr, int
 {
     xfs_trans_header_t  *h;
     char		*cptr = *ptr;
-    __uint32_t          magic;
+    uint32_t          magic;
     char                *magic_c = (char *)&magic;
 
     *ptr += len;
 
-    magic=*(__uint32_t*)cptr; /* XXX be32_to_cpu soon */
+    magic = *(uint32_t *)cptr; /* XXX be32_to_cpu soon */
 
     if (len >= 4) {
 #if __BYTE_ORDER == __LITTLE_ENDIAN
@@ -201,7 +201,7 @@ xlog_print_trans_buffer(char **ptr, int
     int			 num, skip;
     int			 super_block = 0;
     int			 bucket, col, buckets;
-    __int64_t		 blkno;
+    int64_t			 blkno;
     xfs_buf_log_format_t lbuf;
     int			 size, blen, map_size, struct_size;
     __be64		 x, y;
@@ -510,20 +510,21 @@ xlog_print_dir2_sf(
 
 int
 xlog_print_trans_inode(
-	struct xlog	*log,
-	char		**ptr,
-	int		len,
-	int		*i,
-	int		num_ops,
-	int		continued)
+	struct xlog		*log,
+	char			**ptr,
+	int			len,
+	int			*i,
+	int			num_ops,
+	int			continued)
 {
-    struct xfs_log_dinode dino;
-    xlog_op_header_t	   *op_head;
-    xfs_inode_log_format_t dst_lbuf;
-    xfs_inode_log_format_64_t src_lbuf; /* buffer of biggest one */
-    xfs_inode_log_format_t *f;
-    int			   mode;
-    int			   size;
+    struct xfs_log_dinode	dino;
+    struct xlog_op_header	*op_head;
+    struct xfs_inode_log_format	dst_lbuf;
+    struct xfs_inode_log_format	src_lbuf;
+    struct xfs_inode_log_format *f;
+    int				mode;
+    int				size;
+    int				skip_count;
 
     /*
      * print inode type header region
@@ -531,15 +532,15 @@ xlog_print_trans_inode(
      * memmove to ensure 8-byte alignment for the long longs in
      * xfs_inode_log_format_t structure
      *
-     * len can be smaller than xfs_inode_log_format_32|64_t
+     * len can be smaller than xfs_inode_log_format_t
      * if format data is split over operations
      */
-    memmove(&src_lbuf, *ptr, MIN(sizeof(xfs_inode_log_format_64_t), len));
+    memmove(&src_lbuf, *ptr, MIN(sizeof(src_lbuf), len));
     (*i)++;					/* bump index */
     *ptr += len;
     if (!continued &&
-	(len == sizeof(xfs_inode_log_format_32_t) ||
-	 len == sizeof(xfs_inode_log_format_64_t))) {
+	(len == sizeof(struct xfs_inode_log_format_32) ||
+	 len == sizeof(struct xfs_inode_log_format))) {
 	f = xfs_inode_item_format_convert((char*)&src_lbuf, len, &dst_lbuf);
 	printf(_("INODE: "));
 	printf(_("#regs: %d   ino: 0x%llx  flags: 0x%x   dsize: %d\n"),
@@ -555,15 +556,17 @@ xlog_print_trans_inode(
 	return f->ilf_size;
     }
 
+    skip_count = f->ilf_size-1;
+
     if (*i >= num_ops)			/* end of LR */
-	    return f->ilf_size-1;
+	    return skip_count;
 
     /* core inode comes 2nd */
     op_head = (xlog_op_header_t *)*ptr;
     xlog_print_op_header(op_head, *i, ptr);
 
     if (op_head->oh_flags & XLOG_CONTINUE_TRANS)  {
-	return f->ilf_size-1;
+        return skip_count;
     }
 
     memmove(&dino, *ptr, sizeof(dino));
@@ -571,13 +574,7 @@ xlog_print_trans_inode(
     size = (int)dino.di_size;
     xlog_print_trans_inode_core(&dino);
     *ptr += xfs_log_dinode_size(dino.di_version);
-
-    if (*i == num_ops-1 && f->ilf_size == 3)  {
-	return 1;
-    }
-
-    /* does anything come next */
-    op_head = (xlog_op_header_t *)*ptr;
+    skip_count--;
 
     switch (f->ilf_fields & (XFS_ILOG_DEV | XFS_ILOG_UUID)) {
     case XFS_ILOG_DEV:
@@ -595,7 +592,12 @@ xlog_print_trans_inode(
     ASSERT(f->ilf_size <= 4);
     ASSERT((f->ilf_size == 3) || (f->ilf_fields & XFS_ILOG_AFORK));
 
+    /* does anything come next */
+    op_head = (xlog_op_header_t *)*ptr;
+
     if (f->ilf_fields & XFS_ILOG_DFORK) {
+	    if (*i == num_ops-1)
+	        return skip_count;
 	    (*i)++;
 	    xlog_print_op_header(op_head, *i, ptr);
 
@@ -618,11 +620,14 @@ xlog_print_trans_inode(
 
 	    *ptr += be32_to_cpu(op_head->oh_len);
 	    if (op_head->oh_flags & XLOG_CONTINUE_TRANS)
-		return 1;
+	        return skip_count;
 	    op_head = (xlog_op_header_t *)*ptr;
+	    skip_count--;
     }
 
     if (f->ilf_fields & XFS_ILOG_AFORK) {
+	    if (*i == num_ops-1)
+	        return skip_count;
 	    (*i)++;
 	    xlog_print_op_header(op_head, *i, ptr);
 
@@ -644,9 +649,12 @@ xlog_print_trans_inode(
 	    }
 	    *ptr += be32_to_cpu(op_head->oh_len);
 	    if (op_head->oh_flags & XLOG_CONTINUE_TRANS)
-		return 1;
+	        return skip_count;
+	    skip_count--;
     }
 
+    ASSERT(skip_count == 0);
+
     return 0;
 }	/* xlog_print_trans_inode */
 
@@ -1469,48 +1477,31 @@ end:
 }
 
 /*
- * if necessary, convert an xfs_inode_log_format struct from 32bit or 64 bit versions
- * (which can have different field alignments) to the native version
+ * if necessary, convert an xfs_inode_log_format struct from the old 32bit version
+ * (which can have different field alignments) to the native 64 bit version
  */
 xfs_inode_log_format_t *
 xfs_inode_item_format_convert(char *src_buf, uint len, xfs_inode_log_format_t *in_f)
 {
+	struct xfs_inode_log_format_32	*in_f32;
+
 	/* if we have native format then just return buf without copying data */
 	if (len == sizeof(xfs_inode_log_format_t)) {
 		return (xfs_inode_log_format_t *)src_buf;
 	}
 
-	if (len == sizeof(xfs_inode_log_format_32_t)) {
-		xfs_inode_log_format_32_t *in_f32;
+	in_f32 = (struct xfs_inode_log_format_32 *)src_buf;
+	in_f->ilf_type = in_f32->ilf_type;
+	in_f->ilf_size = in_f32->ilf_size;
+	in_f->ilf_fields = in_f32->ilf_fields;
+	in_f->ilf_asize = in_f32->ilf_asize;
+	in_f->ilf_dsize = in_f32->ilf_dsize;
+	in_f->ilf_ino = in_f32->ilf_ino;
+	/* copy biggest field of ilf_u */
+	memcpy(&in_f->ilf_u.ilfu_uuid, &in_f32->ilf_u.ilfu_uuid, sizeof(uuid_t));
+	in_f->ilf_blkno = in_f32->ilf_blkno;
+	in_f->ilf_len = in_f32->ilf_len;
+	in_f->ilf_boffset = in_f32->ilf_boffset;
 
-		in_f32 = (xfs_inode_log_format_32_t *)src_buf;
-		in_f->ilf_type = in_f32->ilf_type;
-		in_f->ilf_size = in_f32->ilf_size;
-		in_f->ilf_fields = in_f32->ilf_fields;
-		in_f->ilf_asize = in_f32->ilf_asize;
-		in_f->ilf_dsize = in_f32->ilf_dsize;
-		in_f->ilf_ino = in_f32->ilf_ino;
-		/* copy biggest */
-		memcpy(&in_f->ilf_u.ilfu_uuid, &in_f32->ilf_u.ilfu_uuid, sizeof(uuid_t));
-		in_f->ilf_blkno = in_f32->ilf_blkno;
-		in_f->ilf_len = in_f32->ilf_len;
-		in_f->ilf_boffset = in_f32->ilf_boffset;
-	} else {
-		xfs_inode_log_format_64_t *in_f64;
-
-		ASSERT(len == sizeof(xfs_inode_log_format_64_t));
-		in_f64 = (xfs_inode_log_format_64_t *)src_buf;
-		in_f->ilf_type = in_f64->ilf_type;
-		in_f->ilf_size = in_f64->ilf_size;
-		in_f->ilf_fields = in_f64->ilf_fields;
-		in_f->ilf_asize = in_f64->ilf_asize;
-		in_f->ilf_dsize = in_f64->ilf_dsize;
-		in_f->ilf_ino = in_f64->ilf_ino;
-		/* copy biggest */
-		memcpy(&in_f->ilf_u.ilfu_uuid, &in_f64->ilf_u.ilfu_uuid, sizeof(uuid_t));
-		in_f->ilf_blkno = in_f64->ilf_blkno;
-		in_f->ilf_len = in_f64->ilf_len;
-		in_f->ilf_boffset = in_f64->ilf_boffset;
-	}
 	return in_f;
 }
diff -urpN xfsprogs-4.9.0/logprint/log_print_all.c xfsprogs-4.14.0/logprint/log_print_all.c
--- xfsprogs-4.9.0/logprint/log_print_all.c	2017-01-05 18:41:55.000000000 +0100
+++ xfsprogs-4.14.0/logprint/log_print_all.c	2017-11-27 17:57:55.000000000 +0100
@@ -269,7 +269,7 @@ xlog_recover_print_inode_core(
 	       di->di_size, (unsigned long long)di->di_nblocks,
 	       di->di_extsize, di->di_nextents, (int)di->di_anextents);
 	printf(_("		forkoff:%d  dmevmask:0x%x  dmstate:%d  flags:0x%x  "
-	     "gen:%d\n"),
+	     "gen:%u\n"),
 	       (int)di->di_forkoff, di->di_dmevmask, (int)di->di_dmstate,
 	       (int)di->di_flags, di->di_gen);
 	if (di->di_version == 3) {
@@ -288,8 +288,8 @@ xlog_recover_print_inode(
 	int			hasdata;
 	int			hasattr;
 
-	ASSERT(item->ri_buf[0].i_len == sizeof(xfs_inode_log_format_32_t) ||
-	       item->ri_buf[0].i_len == sizeof(xfs_inode_log_format_64_t));
+	ASSERT(item->ri_buf[0].i_len == sizeof(struct xfs_inode_log_format_32) ||
+	       item->ri_buf[0].i_len == sizeof(struct xfs_inode_log_format));
 	f = xfs_inode_item_format_convert(item->ri_buf[0].i_addr, item->ri_buf[0].i_len, &f_buf);
 
 	printf(_("	INODE: #regs:%d   ino:0x%llx  flags:0x%x   dsize:%d\n"),
diff -urpN xfsprogs-4.9.0/ltmain.sh xfsprogs-4.14.0/ltmain.sh
--- xfsprogs-4.9.0/ltmain.sh	2017-01-05 23:33:45.000000000 +0100
+++ xfsprogs-4.14.0/ltmain.sh	2017-11-27 17:58:08.000000000 +0100
@@ -1,9 +1,9 @@
-# Generated from ltmain.m4sh.
 
-# ltmain.sh (GNU libtool) 2.2.6b
+# libtool (GNU libtool) 2.4.2
 # Written by Gordon Matzigkeit <gord@gnu.ai.mit.edu>, 1996
 
-# Copyright (C) 1996, 1997, 1998, 1999, 2000, 2001, 2003, 2004, 2005, 2006, 2007 2008 Free Software Foundation, Inc.
+# Copyright (C) 1996, 1997, 1998, 1999, 2000, 2001, 2003, 2004, 2005, 2006,
+# 2007, 2008, 2009, 2010, 2011 Free Software Foundation, Inc.
 # This is free software; see the source for copying conditions.  There is NO
 # warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
 
@@ -32,50 +32,57 @@
 #
 # Provide generalized library-building support services.
 #
-#     --config             show all configuration variables
-#     --debug              enable verbose shell tracing
-# -n, --dry-run            display commands without modifying any files
-#     --features           display basic configuration information and exit
-#     --mode=MODE          use operation mode MODE
-#     --preserve-dup-deps  don't remove duplicate dependency libraries
-#     --quiet, --silent    don't print informational messages
-#     --tag=TAG            use configuration variables from tag TAG
-# -v, --verbose            print informational messages (default)
-#     --version            print version information
-# -h, --help               print short or long help message
+#       --config             show all configuration variables
+#       --debug              enable verbose shell tracing
+#   -n, --dry-run            display commands without modifying any files
+#       --features           display basic configuration information and exit
+#       --mode=MODE          use operation mode MODE
+#       --preserve-dup-deps  don't remove duplicate dependency libraries
+#       --quiet, --silent    don't print informational messages
+#       --no-quiet, --no-silent
+#                            print informational messages (default)
+#       --no-warn            don't display warning messages
+#       --tag=TAG            use configuration variables from tag TAG
+#   -v, --verbose            print more informational messages than default
+#       --no-verbose         don't print the extra informational messages
+#       --version            print version information
+#   -h, --help, --help-all   print short, long, or detailed help message
 #
 # MODE must be one of the following:
 #
-#       clean              remove files from the build directory
-#       compile            compile a source file into a libtool object
-#       execute            automatically set library path, then run a program
-#       finish             complete the installation of libtool libraries
-#       install            install libraries or executables
-#       link               create a library or an executable
-#       uninstall          remove libraries from an installed directory
+#         clean              remove files from the build directory
+#         compile            compile a source file into a libtool object
+#         execute            automatically set library path, then run a program
+#         finish             complete the installation of libtool libraries
+#         install            install libraries or executables
+#         link               create a library or an executable
+#         uninstall          remove libraries from an installed directory
 #
-# MODE-ARGS vary depending on the MODE.
+# MODE-ARGS vary depending on the MODE.  When passed as first option,
+# `--mode=MODE' may be abbreviated as `MODE' or a unique abbreviation of that.
 # Try `$progname --help --mode=MODE' for a more detailed description of MODE.
 #
 # When reporting a bug, please describe a test case to reproduce it and
 # include the following information:
 #
-#       host-triplet:	$host
-#       shell:		$SHELL
-#       compiler:		$LTCC
-#       compiler flags:		$LTCFLAGS
-#       linker:		$LD (gnu? $with_gnu_ld)
-#       $progname:		(GNU libtool) 2.2.6b
-#       automake:		$automake_version
-#       autoconf:		$autoconf_version
+#         host-triplet:	$host
+#         shell:		$SHELL
+#         compiler:		$LTCC
+#         compiler flags:		$LTCFLAGS
+#         linker:		$LD (gnu? $with_gnu_ld)
+#         $progname:	(GNU libtool) 2.4.2
+#         automake:	$automake_version
+#         autoconf:	$autoconf_version
 #
 # Report bugs to <bug-libtool@gnu.org>.
+# GNU libtool home page: <http://www.gnu.org/software/libtool/>.
+# General help using GNU software: <http://www.gnu.org/gethelp/>.
 
-PROGRAM=ltmain.sh
+PROGRAM=libtool
 PACKAGE=libtool
-VERSION=2.2.6b
+VERSION=2.4.2
 TIMESTAMP=""
-package_revision=1.3017
+package_revision=1.3337
 
 # Be Bourne compatible
 if test -n "${ZSH_VERSION+set}" && (emulate sh) >/dev/null 2>&1; then
@@ -91,10 +98,15 @@ fi
 BIN_SH=xpg4; export BIN_SH # for Tru64
 DUALCASE=1; export DUALCASE # for MKS sh
 
+# A function that is used when there is no print builtin or printf.
+func_fallback_echo ()
+{
+  eval 'cat <<_LTECHO_EOF
+$1
+_LTECHO_EOF'
+}
+
 # NLS nuisances: We save the old values to restore during execute mode.
-# Only set LANG and LC_ALL to C if already set.
-# These must not be set unconditionally because not all systems understand
-# e.g. LANG=C (notably SCO).
 lt_user_locale=
 lt_safe_locale=
 for lt_var in LANG LANGUAGE LC_ALL LC_CTYPE LC_COLLATE LC_MESSAGES
@@ -107,24 +119,28 @@ do
 	  lt_safe_locale=\"$lt_var=C; \$lt_safe_locale\"
 	fi"
 done
+LC_ALL=C
+LANGUAGE=C
+export LANGUAGE LC_ALL
 
 $lt_unset CDPATH
 
 
+# Work around backward compatibility issue on IRIX 6.5. On IRIX 6.4+, sh
+# is ksh but when the shell is invoked as "sh" and the current value of
+# the _XPG environment variable is not equal to 1 (one), the special
+# positional parameter $0, within a function call, is the name of the
+# function.
+progpath="$0"
 
 
 
 : ${CP="cp -f"}
-: ${ECHO="echo"}
-: ${EGREP="/bin/grep -E"}
-: ${FGREP="/bin/grep -F"}
-: ${GREP="/bin/grep"}
-: ${LN_S="ln -s"}
+test "${ECHO+set}" = set || ECHO=${as_echo-'printf %s\n'}
 : ${MAKE="make"}
 : ${MKDIR="mkdir"}
 : ${MV="mv -f"}
 : ${RM="rm -f"}
-: ${SED="/bin/sed"}
 : ${SHELL="${CONFIG_SHELL-/bin/sh}"}
 : ${Xsed="$SED -e 1s/^X//"}
 
@@ -144,6 +160,27 @@ IFS=" 	$lt_nl"
 dirname="s,/[^/]*$,,"
 basename="s,^.*/,,"
 
+# func_dirname file append nondir_replacement
+# Compute the dirname of FILE.  If nonempty, add APPEND to the result,
+# otherwise set result to NONDIR_REPLACEMENT.
+func_dirname ()
+{
+    func_dirname_result=`$ECHO "${1}" | $SED "$dirname"`
+    if test "X$func_dirname_result" = "X${1}"; then
+      func_dirname_result="${3}"
+    else
+      func_dirname_result="$func_dirname_result${2}"
+    fi
+} # func_dirname may be replaced by extended shell implementation
+
+
+# func_basename file
+func_basename ()
+{
+    func_basename_result=`$ECHO "${1}" | $SED "$basename"`
+} # func_basename may be replaced by extended shell implementation
+
+
 # func_dirname_and_basename file append nondir_replacement
 # perform func_basename and func_dirname in a single function
 # call:
@@ -158,33 +195,183 @@ basename="s,^.*/,,"
 # those functions but instead duplicate the functionality here.
 func_dirname_and_basename ()
 {
-  # Extract subdirectory from the argument.
-  func_dirname_result=`$ECHO "X${1}" | $Xsed -e "$dirname"`
-  if test "X$func_dirname_result" = "X${1}"; then
-    func_dirname_result="${3}"
-  else
-    func_dirname_result="$func_dirname_result${2}"
-  fi
-  func_basename_result=`$ECHO "X${1}" | $Xsed -e "$basename"`
+    # Extract subdirectory from the argument.
+    func_dirname_result=`$ECHO "${1}" | $SED -e "$dirname"`
+    if test "X$func_dirname_result" = "X${1}"; then
+      func_dirname_result="${3}"
+    else
+      func_dirname_result="$func_dirname_result${2}"
+    fi
+    func_basename_result=`$ECHO "${1}" | $SED -e "$basename"`
+} # func_dirname_and_basename may be replaced by extended shell implementation
+
+
+# func_stripname prefix suffix name
+# strip PREFIX and SUFFIX off of NAME.
+# PREFIX and SUFFIX must not contain globbing or regex special
+# characters, hashes, percent signs, but SUFFIX may contain a leading
+# dot (in which case that matches only a dot).
+# func_strip_suffix prefix name
+func_stripname ()
+{
+    case ${2} in
+      .*) func_stripname_result=`$ECHO "${3}" | $SED "s%^${1}%%; s%\\\\${2}\$%%"`;;
+      *)  func_stripname_result=`$ECHO "${3}" | $SED "s%^${1}%%; s%${2}\$%%"`;;
+    esac
+} # func_stripname may be replaced by extended shell implementation
+
+
+# These SED scripts presuppose an absolute path with a trailing slash.
+pathcar='s,^/\([^/]*\).*$,\1,'
+pathcdr='s,^/[^/]*,,'
+removedotparts=':dotsl
+		s@/\./@/@g
+		t dotsl
+		s,/\.$,/,'
+collapseslashes='s@/\{1,\}@/@g'
+finalslash='s,/*$,/,'
+
+# func_normal_abspath PATH
+# Remove doubled-up and trailing slashes, "." path components,
+# and cancel out any ".." path components in PATH after making
+# it an absolute path.
+#             value returned in "$func_normal_abspath_result"
+func_normal_abspath ()
+{
+  # Start from root dir and reassemble the path.
+  func_normal_abspath_result=
+  func_normal_abspath_tpath=$1
+  func_normal_abspath_altnamespace=
+  case $func_normal_abspath_tpath in
+    "")
+      # Empty path, that just means $cwd.
+      func_stripname '' '/' "`pwd`"
+      func_normal_abspath_result=$func_stripname_result
+      return
+    ;;
+    # The next three entries are used to spot a run of precisely
+    # two leading slashes without using negated character classes;
+    # we take advantage of case's first-match behaviour.
+    ///*)
+      # Unusual form of absolute path, do nothing.
+    ;;
+    //*)
+      # Not necessarily an ordinary path; POSIX reserves leading '//'
+      # and for example Cygwin uses it to access remote file shares
+      # over CIFS/SMB, so we conserve a leading double slash if found.
+      func_normal_abspath_altnamespace=/
+    ;;
+    /*)
+      # Absolute path, do nothing.
+    ;;
+    *)
+      # Relative path, prepend $cwd.
+      func_normal_abspath_tpath=`pwd`/$func_normal_abspath_tpath
+    ;;
+  esac
+  # Cancel out all the simple stuff to save iterations.  We also want
+  # the path to end with a slash for ease of parsing, so make sure
+  # there is one (and only one) here.
+  func_normal_abspath_tpath=`$ECHO "$func_normal_abspath_tpath" | $SED \
+        -e "$removedotparts" -e "$collapseslashes" -e "$finalslash"`
+  while :; do
+    # Processed it all yet?
+    if test "$func_normal_abspath_tpath" = / ; then
+      # If we ascended to the root using ".." the result may be empty now.
+      if test -z "$func_normal_abspath_result" ; then
+        func_normal_abspath_result=/
+      fi
+      break
+    fi
+    func_normal_abspath_tcomponent=`$ECHO "$func_normal_abspath_tpath" | $SED \
+        -e "$pathcar"`
+    func_normal_abspath_tpath=`$ECHO "$func_normal_abspath_tpath" | $SED \
+        -e "$pathcdr"`
+    # Figure out what to do with it
+    case $func_normal_abspath_tcomponent in
+      "")
+        # Trailing empty path component, ignore it.
+      ;;
+      ..)
+        # Parent dir; strip last assembled component from result.
+        func_dirname "$func_normal_abspath_result"
+        func_normal_abspath_result=$func_dirname_result
+      ;;
+      *)
+        # Actual path component, append it.
+        func_normal_abspath_result=$func_normal_abspath_result/$func_normal_abspath_tcomponent
+      ;;
+    esac
+  done
+  # Restore leading double-slash if one was found on entry.
+  func_normal_abspath_result=$func_normal_abspath_altnamespace$func_normal_abspath_result
 }
 
-# Generated shell functions inserted here.
+# func_relative_path SRCDIR DSTDIR
+# generates a relative path from SRCDIR to DSTDIR, with a trailing
+# slash if non-empty, suitable for immediately appending a filename
+# without needing to append a separator.
+#             value returned in "$func_relative_path_result"
+func_relative_path ()
+{
+  func_relative_path_result=
+  func_normal_abspath "$1"
+  func_relative_path_tlibdir=$func_normal_abspath_result
+  func_normal_abspath "$2"
+  func_relative_path_tbindir=$func_normal_abspath_result
+
+  # Ascend the tree starting from libdir
+  while :; do
+    # check if we have found a prefix of bindir
+    case $func_relative_path_tbindir in
+      $func_relative_path_tlibdir)
+        # found an exact match
+        func_relative_path_tcancelled=
+        break
+        ;;
+      $func_relative_path_tlibdir*)
+        # found a matching prefix
+        func_stripname "$func_relative_path_tlibdir" '' "$func_relative_path_tbindir"
+        func_relative_path_tcancelled=$func_stripname_result
+        if test -z "$func_relative_path_result"; then
+          func_relative_path_result=.
+        fi
+        break
+        ;;
+      *)
+        func_dirname $func_relative_path_tlibdir
+        func_relative_path_tlibdir=${func_dirname_result}
+        if test "x$func_relative_path_tlibdir" = x ; then
+          # Have to descend all the way to the root!
+          func_relative_path_result=../$func_relative_path_result
+          func_relative_path_tcancelled=$func_relative_path_tbindir
+          break
+        fi
+        func_relative_path_result=../$func_relative_path_result
+        ;;
+    esac
+  done
 
-# Work around backward compatibility issue on IRIX 6.5. On IRIX 6.4+, sh
-# is ksh but when the shell is invoked as "sh" and the current value of
-# the _XPG environment variable is not equal to 1 (one), the special
-# positional parameter $0, within a function call, is the name of the
-# function.
-progpath="$0"
+  # Now calculate path; take care to avoid doubling-up slashes.
+  func_stripname '' '/' "$func_relative_path_result"
+  func_relative_path_result=$func_stripname_result
+  func_stripname '/' '/' "$func_relative_path_tcancelled"
+  if test "x$func_stripname_result" != x ; then
+    func_relative_path_result=${func_relative_path_result}/${func_stripname_result}
+  fi
+
+  # Normalisation. If bindir is libdir, return empty string,
+  # else relative path ending with a slash; either way, target
+  # file name can be directly appended.
+  if test ! -z "$func_relative_path_result"; then
+    func_stripname './' '' "$func_relative_path_result/"
+    func_relative_path_result=$func_stripname_result
+  fi
+}
 
 # The name of this program:
-# In the unlikely event $progname began with a '-', it would play havoc with
-# func_echo (imagine progname=-n), so we prepend ./ in that case:
 func_dirname_and_basename "$progpath"
 progname=$func_basename_result
-case $progname in
-  -*) progname=./$progname ;;
-esac
 
 # Make sure we have an absolute path for reexecution:
 case $progpath in
@@ -196,7 +383,7 @@ case $progpath in
      ;;
   *)
      save_IFS="$IFS"
-     IFS=:
+     IFS=${PATH_SEPARATOR-:}
      for progdir in $PATH; do
        IFS="$save_IFS"
        test -x "$progdir/$progname" && break
@@ -215,6 +402,15 @@ sed_quote_subst='s/\([`"$\\]\)/\\\1/g'
 # Same as above, but do not quote variable references.
 double_quote_subst='s/\(["`\\]\)/\\\1/g'
 
+# Sed substitution that turns a string into a regex matching for the
+# string literally.
+sed_make_literal_regex='s,[].[^$\\*\/],\\&,g'
+
+# Sed substitution that converts a w32 file name or path
+# which contains forward slashes, into one that contains
+# (escaped) backslashes.  A very naive implementation.
+lt_sed_naive_backslashify='s|\\\\*|\\|g;s|/|\\|g;s|\\|\\\\|g'
+
 # Re-`\' parameter expansions in output of double_quote_subst that were
 # `\'-ed in input to the same.  If an odd number of `\' preceded a '$'
 # in input to double_quote_subst, that '$' was protected from expansion.
@@ -243,7 +439,7 @@ opt_warning=:
 # name if it has been set yet.
 func_echo ()
 {
-    $ECHO "$progname${mode+: }$mode: $*"
+    $ECHO "$progname: ${opt_mode+$opt_mode: }$*"
 }
 
 # func_verbose arg...
@@ -258,18 +454,25 @@ func_verbose ()
     :
 }
 
+# func_echo_all arg...
+# Invoke $ECHO with all args, space-separated.
+func_echo_all ()
+{
+    $ECHO "$*"
+}
+
 # func_error arg...
 # Echo program name prefixed message to standard error.
 func_error ()
 {
-    $ECHO "$progname${mode+: }$mode: "${1+"$@"} 1>&2
+    $ECHO "$progname: ${opt_mode+$opt_mode: }"${1+"$@"} 1>&2
 }
 
 # func_warning arg...
 # Echo program name prefixed warning message to standard error.
 func_warning ()
 {
-    $opt_warning && $ECHO "$progname${mode+: }$mode: warning: "${1+"$@"} 1>&2
+    $opt_warning && $ECHO "$progname: ${opt_mode+$opt_mode: }warning: "${1+"$@"} 1>&2
 
     # bash bug again:
     :
@@ -326,9 +529,9 @@ func_mkdir_p ()
         case $my_directory_path in */*) ;; *) break ;; esac
 
         # ...otherwise throw away the child directory and loop
-        my_directory_path=`$ECHO "X$my_directory_path" | $Xsed -e "$dirname"`
+        my_directory_path=`$ECHO "$my_directory_path" | $SED -e "$dirname"`
       done
-      my_dir_list=`$ECHO "X$my_dir_list" | $Xsed -e 's,:*$,,'`
+      my_dir_list=`$ECHO "$my_dir_list" | $SED 's,:*$,,'`
 
       save_mkdir_p_IFS="$IFS"; IFS=':'
       for my_dir in $my_dir_list; do
@@ -378,7 +581,7 @@ func_mktempdir ()
         func_fatal_error "cannot create temporary directory \`$my_tmpdir'"
     fi
 
-    $ECHO "X$my_tmpdir" | $Xsed
+    $ECHO "$my_tmpdir"
 }
 
 
@@ -392,7 +595,7 @@ func_quote_for_eval ()
 {
     case $1 in
       *[\\\`\"\$]*)
-	func_quote_for_eval_unquoted_result=`$ECHO "X$1" | $Xsed -e "$sed_quote_subst"` ;;
+	func_quote_for_eval_unquoted_result=`$ECHO "$1" | $SED "$sed_quote_subst"` ;;
       *)
         func_quote_for_eval_unquoted_result="$1" ;;
     esac
@@ -419,7 +622,7 @@ func_quote_for_expand ()
 {
     case $1 in
       *[\\\`\"]*)
-	my_arg=`$ECHO "X$1" | $Xsed \
+	my_arg=`$ECHO "$1" | $SED \
 	    -e "$double_quote_subst" -e "$sed_double_backslash"` ;;
       *)
         my_arg="$1" ;;
@@ -488,15 +691,39 @@ func_show_eval_locale ()
     fi
 }
 
-
-
+# func_tr_sh
+# Turn $1 into a string suitable for a shell variable name.
+# Result is stored in $func_tr_sh_result.  All characters
+# not in the set a-zA-Z0-9_ are replaced with '_'. Further,
+# if $1 begins with a digit, a '_' is prepended as well.
+func_tr_sh ()
+{
+  case $1 in
+  [0-9]* | *[!a-zA-Z0-9_]*)
+    func_tr_sh_result=`$ECHO "$1" | $SED 's/^\([0-9]\)/_\1/; s/[^a-zA-Z0-9_]/_/g'`
+    ;;
+  * )
+    func_tr_sh_result=$1
+    ;;
+  esac
+}
 
 
 # func_version
 # Echo version message to standard output and exit.
 func_version ()
 {
-    $SED -n '/^# '$PROGRAM' (GNU /,/# warranty; / {
+    $opt_debug
+
+    $SED -n '/(C)/!b go
+	:more
+	/\./!{
+	  N
+	  s/\n# / /
+	  b more
+	}
+	:go
+	/^# '$PROGRAM' (GNU /,/# warranty; / {
         s/^# //
 	s/^# *$//
         s/\((C)\)[ 0-9,-]*\( [1-9][0-9]*\)/\1\2/
@@ -509,22 +736,28 @@ func_version ()
 # Echo short help message to standard output and exit.
 func_usage ()
 {
-    $SED -n '/^# Usage:/,/# -h/ {
+    $opt_debug
+
+    $SED -n '/^# Usage:/,/^#  *.*--help/ {
         s/^# //
 	s/^# *$//
 	s/\$progname/'$progname'/
 	p
     }' < "$progpath"
-    $ECHO
+    echo
     $ECHO "run \`$progname --help | more' for full usage"
     exit $?
 }
 
-# func_help
-# Echo long help message to standard output and exit.
+# func_help [NOEXIT]
+# Echo long help message to standard output and exit,
+# unless 'noexit' is passed as argument.
 func_help ()
 {
+    $opt_debug
+
     $SED -n '/^# Usage:/,/# Report bugs to/ {
+	:print
         s/^# //
 	s/^# *$//
 	s*\$progname*'$progname'*
@@ -534,11 +767,18 @@ func_help ()
 	s*\$LTCFLAGS*'"$LTCFLAGS"'*
 	s*\$LD*'"$LD"'*
 	s/\$with_gnu_ld/'"$with_gnu_ld"'/
-	s/\$automake_version/'"`(automake --version) 2>/dev/null |$SED 1q`"'/
-	s/\$autoconf_version/'"`(autoconf --version) 2>/dev/null |$SED 1q`"'/
+	s/\$automake_version/'"`(${AUTOMAKE-automake} --version) 2>/dev/null |$SED 1q`"'/
+	s/\$autoconf_version/'"`(${AUTOCONF-autoconf} --version) 2>/dev/null |$SED 1q`"'/
 	p
-     }' < "$progpath"
-    exit $?
+	d
+     }
+     /^# .* home page:/b print
+     /^# General help using/b print
+     ' < "$progpath"
+    ret=$?
+    if test -z "$1"; then
+      exit $ret
+    fi
 }
 
 # func_missing_arg argname
@@ -546,63 +786,106 @@ func_help ()
 # exit_cmd.
 func_missing_arg ()
 {
-    func_error "missing argument for $1"
+    $opt_debug
+
+    func_error "missing argument for $1."
     exit_cmd=exit
 }
 
-exit_cmd=:
 
+# func_split_short_opt shortopt
+# Set func_split_short_opt_name and func_split_short_opt_arg shell
+# variables after splitting SHORTOPT after the 2nd character.
+func_split_short_opt ()
+{
+    my_sed_short_opt='1s/^\(..\).*$/\1/;q'
+    my_sed_short_rest='1s/^..\(.*\)$/\1/;q'
+
+    func_split_short_opt_name=`$ECHO "$1" | $SED "$my_sed_short_opt"`
+    func_split_short_opt_arg=`$ECHO "$1" | $SED "$my_sed_short_rest"`
+} # func_split_short_opt may be replaced by extended shell implementation
+
+
+# func_split_long_opt longopt
+# Set func_split_long_opt_name and func_split_long_opt_arg shell
+# variables after splitting LONGOPT at the `=' sign.
+func_split_long_opt ()
+{
+    my_sed_long_opt='1s/^\(--[^=]*\)=.*/\1/;q'
+    my_sed_long_arg='1s/^--[^=]*=//'
+
+    func_split_long_opt_name=`$ECHO "$1" | $SED "$my_sed_long_opt"`
+    func_split_long_opt_arg=`$ECHO "$1" | $SED "$my_sed_long_arg"`
+} # func_split_long_opt may be replaced by extended shell implementation
 
+exit_cmd=:
 
 
 
-# Check that we have a working $ECHO.
-if test "X$1" = X--no-reexec; then
-  # Discard the --no-reexec flag, and continue.
-  shift
-elif test "X$1" = X--fallback-echo; then
-  # Avoid inline document here, it may be left over
-  :
-elif test "X`{ $ECHO '\t'; } 2>/dev/null`" = 'X\t'; then
-  # Yippee, $ECHO works!
-  :
-else
-  # Restart under the correct shell, and then maybe $ECHO will work.
-  exec $SHELL "$progpath" --no-reexec ${1+"$@"}
-fi
 
-if test "X$1" = X--fallback-echo; then
-  # used as fallback echo
-  shift
-  cat <<EOF
-$*
-EOF
-  exit $EXIT_SUCCESS
-fi
 
 magic="%%%MAGIC variable%%%"
 magic_exe="%%%MAGIC EXE variable%%%"
 
 # Global variables.
-# $mode is unset
 nonopt=
-execute_dlfiles=
 preserve_args=
 lo2o="s/\\.lo\$/.${objext}/"
 o2lo="s/\\.${objext}\$/.lo/"
 extracted_archives=
 extracted_serial=0
 
-opt_dry_run=false
-opt_duplicate_deps=false
-opt_silent=false
-opt_debug=:
-
 # If this variable is set in any of the actions, the command in it
 # will be execed at the end.  This prevents here-documents from being
 # left over by shells.
 exec_cmd=
 
+# func_append var value
+# Append VALUE to the end of shell variable VAR.
+func_append ()
+{
+    eval "${1}=\$${1}\${2}"
+} # func_append may be replaced by extended shell implementation
+
+# func_append_quoted var value
+# Quote VALUE and append to the end of shell variable VAR, separated
+# by a space.
+func_append_quoted ()
+{
+    func_quote_for_eval "${2}"
+    eval "${1}=\$${1}\\ \$func_quote_for_eval_result"
+} # func_append_quoted may be replaced by extended shell implementation
+
+
+# func_arith arithmetic-term...
+func_arith ()
+{
+    func_arith_result=`expr "${@}"`
+} # func_arith may be replaced by extended shell implementation
+
+
+# func_len string
+# STRING may not start with a hyphen.
+func_len ()
+{
+    func_len_result=`expr "${1}" : ".*" 2>/dev/null || echo $max_cmd_len`
+} # func_len may be replaced by extended shell implementation
+
+
+# func_lo2o object
+func_lo2o ()
+{
+    func_lo2o_result=`$ECHO "${1}" | $SED "$lo2o"`
+} # func_lo2o may be replaced by extended shell implementation
+
+
+# func_xform libobj-or-source
+func_xform ()
+{
+    func_xform_result=`$ECHO "${1}" | $SED 's/\.[^.]*$/.lo/'`
+} # func_xform may be replaced by extended shell implementation
+
+
 # func_fatal_configuration arg...
 # Echo program name prefixed message to standard error, followed by
 # a configuration failure hint, and exit.
@@ -636,16 +919,16 @@ func_config ()
 # Display the features supported by this script.
 func_features ()
 {
-    $ECHO "host: $host"
+    echo "host: $host"
     if test "$build_libtool_libs" = yes; then
-      $ECHO "enable shared libraries"
+      echo "enable shared libraries"
     else
-      $ECHO "disable shared libraries"
+      echo "disable shared libraries"
     fi
     if test "$build_old_libs" = yes; then
-      $ECHO "enable static libraries"
+      echo "enable static libraries"
     else
-      $ECHO "disable static libraries"
+      echo "disable static libraries"
     fi
 
     exit $?
@@ -692,117 +975,209 @@ func_enable_tag ()
   esac
 }
 
-# Parse options once, thoroughly.  This comes as soon as possible in
-# the script to make things like `libtool --version' happen quickly.
+# func_check_version_match
+# Ensure that we are using m4 macros, and libtool script from the same
+# release of libtool.
+func_check_version_match ()
 {
+  if test "$package_revision" != "$macro_revision"; then
+    if test "$VERSION" != "$macro_version"; then
+      if test -z "$macro_version"; then
+        cat >&2 <<_LT_EOF
+$progname: Version mismatch error.  This is $PACKAGE $VERSION, but the
+$progname: definition of this LT_INIT comes from an older release.
+$progname: You should recreate aclocal.m4 with macros from $PACKAGE $VERSION
+$progname: and run autoconf again.
+_LT_EOF
+      else
+        cat >&2 <<_LT_EOF
+$progname: Version mismatch error.  This is $PACKAGE $VERSION, but the
+$progname: definition of this LT_INIT comes from $PACKAGE $macro_version.
+$progname: You should recreate aclocal.m4 with macros from $PACKAGE $VERSION
+$progname: and run autoconf again.
+_LT_EOF
+      fi
+    else
+      cat >&2 <<_LT_EOF
+$progname: Version mismatch error.  This is $PACKAGE $VERSION, revision $package_revision,
+$progname: but the definition of this LT_INIT comes from revision $macro_revision.
+$progname: You should recreate aclocal.m4 with macros from revision $package_revision
+$progname: of $PACKAGE $VERSION and run autoconf again.
+_LT_EOF
+    fi
 
-  # Shorthand for --mode=foo, only valid as the first argument
-  case $1 in
-  clean|clea|cle|cl)
-    shift; set dummy --mode clean ${1+"$@"}; shift
-    ;;
-  compile|compil|compi|comp|com|co|c)
-    shift; set dummy --mode compile ${1+"$@"}; shift
-    ;;
-  execute|execut|execu|exec|exe|ex|e)
-    shift; set dummy --mode execute ${1+"$@"}; shift
-    ;;
-  finish|finis|fini|fin|fi|f)
-    shift; set dummy --mode finish ${1+"$@"}; shift
-    ;;
-  install|instal|insta|inst|ins|in|i)
-    shift; set dummy --mode install ${1+"$@"}; shift
-    ;;
-  link|lin|li|l)
-    shift; set dummy --mode link ${1+"$@"}; shift
-    ;;
-  uninstall|uninstal|uninsta|uninst|unins|unin|uni|un|u)
-    shift; set dummy --mode uninstall ${1+"$@"}; shift
-    ;;
-  esac
+    exit $EXIT_MISMATCH
+  fi
+}
+
+
+# Shorthand for --mode=foo, only valid as the first argument
+case $1 in
+clean|clea|cle|cl)
+  shift; set dummy --mode clean ${1+"$@"}; shift
+  ;;
+compile|compil|compi|comp|com|co|c)
+  shift; set dummy --mode compile ${1+"$@"}; shift
+  ;;
+execute|execut|execu|exec|exe|ex|e)
+  shift; set dummy --mode execute ${1+"$@"}; shift
+  ;;
+finish|finis|fini|fin|fi|f)
+  shift; set dummy --mode finish ${1+"$@"}; shift
+  ;;
+install|instal|insta|inst|ins|in|i)
+  shift; set dummy --mode install ${1+"$@"}; shift
+  ;;
+link|lin|li|l)
+  shift; set dummy --mode link ${1+"$@"}; shift
+  ;;
+uninstall|uninstal|uninsta|uninst|unins|unin|uni|un|u)
+  shift; set dummy --mode uninstall ${1+"$@"}; shift
+  ;;
+esac
 
-  # Parse non-mode specific arguments:
-  while test "$#" -gt 0; do
+
+
+# Option defaults:
+opt_debug=:
+opt_dry_run=false
+opt_config=false
+opt_preserve_dup_deps=false
+opt_features=false
+opt_finish=false
+opt_help=false
+opt_help_all=false
+opt_silent=:
+opt_warning=:
+opt_verbose=:
+opt_silent=false
+opt_verbose=false
+
+
+# Parse options once, thoroughly.  This comes as soon as possible in the
+# script to make things like `--version' happen as quickly as we can.
+{
+  # this just eases exit handling
+  while test $# -gt 0; do
     opt="$1"
     shift
-
     case $opt in
-      --config)		func_config					;;
-
-      --debug)		preserve_args="$preserve_args $opt"
+      --debug|-x)	opt_debug='set -x'
 			func_echo "enabling shell trace mode"
-			opt_debug='set -x'
 			$opt_debug
 			;;
-
-      -dlopen)		test "$#" -eq 0 && func_missing_arg "$opt" && break
-			execute_dlfiles="$execute_dlfiles $1"
-			shift
+      --dry-run|--dryrun|-n)
+			opt_dry_run=:
 			;;
-
-      --dry-run | -n)	opt_dry_run=:					;;
-      --features)       func_features					;;
-      --finish)		mode="finish"					;;
-
-      --mode)		test "$#" -eq 0 && func_missing_arg "$opt" && break
-			case $1 in
-			  # Valid mode arguments:
-			  clean)	;;
-			  compile)	;;
-			  execute)	;;
-			  finish)	;;
-			  install)	;;
-			  link)		;;
-			  relink)	;;
-			  uninstall)	;;
-
-			  # Catch anything else as an error
-			  *) func_error "invalid argument for $opt"
-			     exit_cmd=exit
-			     break
-			     ;;
-		        esac
-
-			mode="$1"
+      --config)
+			opt_config=:
+func_config
+			;;
+      --dlopen|-dlopen)
+			optarg="$1"
+			opt_dlopen="${opt_dlopen+$opt_dlopen
+}$optarg"
 			shift
 			;;
-
       --preserve-dup-deps)
-			opt_duplicate_deps=:				;;
-
-      --quiet|--silent)	preserve_args="$preserve_args $opt"
-			opt_silent=:
+			opt_preserve_dup_deps=:
 			;;
-
-      --verbose| -v)	preserve_args="$preserve_args $opt"
+      --features)
+			opt_features=:
+func_features
+			;;
+      --finish)
+			opt_finish=:
+set dummy --mode finish ${1+"$@"}; shift
+			;;
+      --help)
+			opt_help=:
+			;;
+      --help-all)
+			opt_help_all=:
+opt_help=': help-all'
+			;;
+      --mode)
+			test $# = 0 && func_missing_arg $opt && break
+			optarg="$1"
+			opt_mode="$optarg"
+case $optarg in
+  # Valid mode arguments:
+  clean|compile|execute|finish|install|link|relink|uninstall) ;;
+
+  # Catch anything else as an error
+  *) func_error "invalid argument for $opt"
+     exit_cmd=exit
+     break
+     ;;
+esac
+			shift
+			;;
+      --no-silent|--no-quiet)
 			opt_silent=false
+func_append preserve_args " $opt"
 			;;
-
-      --tag)		test "$#" -eq 0 && func_missing_arg "$opt" && break
-			preserve_args="$preserve_args $opt $1"
-			func_enable_tag "$1"	# tagname is set here
+      --no-warning|--no-warn)
+			opt_warning=false
+func_append preserve_args " $opt"
+			;;
+      --no-verbose)
+			opt_verbose=false
+func_append preserve_args " $opt"
+			;;
+      --silent|--quiet)
+			opt_silent=:
+func_append preserve_args " $opt"
+        opt_verbose=false
+			;;
+      --verbose|-v)
+			opt_verbose=:
+func_append preserve_args " $opt"
+opt_silent=false
+			;;
+      --tag)
+			test $# = 0 && func_missing_arg $opt && break
+			optarg="$1"
+			opt_tag="$optarg"
+func_append preserve_args " $opt $optarg"
+func_enable_tag "$optarg"
 			shift
 			;;
 
+      -\?|-h)		func_usage				;;
+      --help)		func_help				;;
+      --version)	func_version				;;
+
       # Separate optargs to long options:
-      -dlopen=*|--mode=*|--tag=*)
-			func_opt_split "$opt"
-			set dummy "$func_opt_split_opt" "$func_opt_split_arg" ${1+"$@"}
+      --*=*)
+			func_split_long_opt "$opt"
+			set dummy "$func_split_long_opt_name" "$func_split_long_opt_arg" ${1+"$@"}
 			shift
 			;;
 
-      -\?|-h)		func_usage					;;
-      --help)		opt_help=:					;;
-      --version)	func_version					;;
-
-      -*)		func_fatal_help "unrecognized option \`$opt'"	;;
-
-      *)		nonopt="$opt"
-			break
+      # Separate non-argument short options:
+      -\?*|-h*|-n*|-v*)
+			func_split_short_opt "$opt"
+			set dummy "$func_split_short_opt_name" "-$func_split_short_opt_arg" ${1+"$@"}
+			shift
 			;;
+
+      --)		break					;;
+      -*)		func_fatal_help "unrecognized option \`$opt'" ;;
+      *)		set dummy "$opt" ${1+"$@"};	shift; break  ;;
     esac
   done
 
+  # Validate options:
+
+  # save first non-option argument
+  if test "$#" -gt 0; then
+    nonopt="$opt"
+    shift
+  fi
+
+  # preserve --debug
+  test "$opt_debug" = : || func_append preserve_args " --debug"
 
   case $host in
     *cygwin* | *mingw* | *pw32* | *cegcc*)
@@ -810,82 +1185,44 @@ func_enable_tag ()
       opt_duplicate_compiler_generated_deps=:
       ;;
     *)
-      opt_duplicate_compiler_generated_deps=$opt_duplicate_deps
+      opt_duplicate_compiler_generated_deps=$opt_preserve_dup_deps
       ;;
   esac
 
-  # Having warned about all mis-specified options, bail out if
-  # anything was wrong.
-  $exit_cmd $EXIT_FAILURE
-}
+  $opt_help || {
+    # Sanity checks first:
+    func_check_version_match
 
-# func_check_version_match
-# Ensure that we are using m4 macros, and libtool script from the same
-# release of libtool.
-func_check_version_match ()
-{
-  if test "$package_revision" != "$macro_revision"; then
-    if test "$VERSION" != "$macro_version"; then
-      if test -z "$macro_version"; then
-        cat >&2 <<_LT_EOF
-$progname: Version mismatch error.  This is $PACKAGE $VERSION, but the
-$progname: definition of this LT_INIT comes from an older release.
-$progname: You should recreate aclocal.m4 with macros from $PACKAGE $VERSION
-$progname: and run autoconf again.
-_LT_EOF
-      else
-        cat >&2 <<_LT_EOF
-$progname: Version mismatch error.  This is $PACKAGE $VERSION, but the
-$progname: definition of this LT_INIT comes from $PACKAGE $macro_version.
-$progname: You should recreate aclocal.m4 with macros from $PACKAGE $VERSION
-$progname: and run autoconf again.
-_LT_EOF
-      fi
-    else
-      cat >&2 <<_LT_EOF
-$progname: Version mismatch error.  This is $PACKAGE $VERSION, revision $package_revision,
-$progname: but the definition of this LT_INIT comes from revision $macro_revision.
-$progname: You should recreate aclocal.m4 with macros from revision $package_revision
-$progname: of $PACKAGE $VERSION and run autoconf again.
-_LT_EOF
+    if test "$build_libtool_libs" != yes && test "$build_old_libs" != yes; then
+      func_fatal_configuration "not configured to build any kind of library"
     fi
 
-    exit $EXIT_MISMATCH
-  fi
-}
-
+    # Darwin sucks
+    eval std_shrext=\"$shrext_cmds\"
 
-## ----------- ##
-##    Main.    ##
-## ----------- ##
-
-$opt_help || {
-  # Sanity checks first:
-  func_check_version_match
-
-  if test "$build_libtool_libs" != yes && test "$build_old_libs" != yes; then
-    func_fatal_configuration "not configured to build any kind of library"
-  fi
+    # Only execute mode is allowed to have -dlopen flags.
+    if test -n "$opt_dlopen" && test "$opt_mode" != execute; then
+      func_error "unrecognized option \`-dlopen'"
+      $ECHO "$help" 1>&2
+      exit $EXIT_FAILURE
+    fi
 
-  test -z "$mode" && func_fatal_error "error: you must specify a MODE."
+    # Change the help message to a mode-specific one.
+    generic_help="$help"
+    help="Try \`$progname --help --mode=$opt_mode' for more information."
+  }
 
 
-  # Darwin sucks
-  eval std_shrext=\"$shrext_cmds\"
+  # Bail if the options were screwed
+  $exit_cmd $EXIT_FAILURE
+}
 
 
-  # Only execute mode is allowed to have -dlopen flags.
-  if test -n "$execute_dlfiles" && test "$mode" != execute; then
-    func_error "unrecognized option \`-dlopen'"
-    $ECHO "$help" 1>&2
-    exit $EXIT_FAILURE
-  fi
 
-  # Change the help message to a mode-specific one.
-  generic_help="$help"
-  help="Try \`$progname --help --mode=$mode' for more information."
-}
 
+## ----------- ##
+##    Main.    ##
+## ----------- ##
 
 # func_lalib_p file
 # True iff FILE is a libtool `.la' library or `.lo' object file.
@@ -950,12 +1287,9 @@ func_ltwrapper_executable_p ()
 # temporary ltwrapper_script.
 func_ltwrapper_scriptname ()
 {
-    func_ltwrapper_scriptname_result=""
-    if func_ltwrapper_executable_p "$1"; then
-	func_dirname_and_basename "$1" "" "."
-	func_stripname '' '.exe' "$func_basename_result"
-	func_ltwrapper_scriptname_result="$func_dirname_result/$objdir/${func_stripname_result}_ltshwrapper"
-    fi
+    func_dirname_and_basename "$1" "" "."
+    func_stripname '' '.exe' "$func_basename_result"
+    func_ltwrapper_scriptname_result="$func_dirname_result/$objdir/${func_stripname_result}_ltshwrapper"
 }
 
 # func_ltwrapper_p file
@@ -1001,6 +1335,37 @@ func_source ()
 }
 
 
+# func_resolve_sysroot PATH
+# Replace a leading = in PATH with a sysroot.  Store the result into
+# func_resolve_sysroot_result
+func_resolve_sysroot ()
+{
+  func_resolve_sysroot_result=$1
+  case $func_resolve_sysroot_result in
+  =*)
+    func_stripname '=' '' "$func_resolve_sysroot_result"
+    func_resolve_sysroot_result=$lt_sysroot$func_stripname_result
+    ;;
+  esac
+}
+
+# func_replace_sysroot PATH
+# If PATH begins with the sysroot, replace it with = and
+# store the result into func_replace_sysroot_result.
+func_replace_sysroot ()
+{
+  case "$lt_sysroot:$1" in
+  ?*:"$lt_sysroot"*)
+    func_stripname "$lt_sysroot" '' "$1"
+    func_replace_sysroot_result="=$func_stripname_result"
+    ;;
+  *)
+    # Including no sysroot.
+    func_replace_sysroot_result=$1
+    ;;
+  esac
+}
+
 # func_infer_tag arg
 # Infer tagged configuration to use if any are available and
 # if one wasn't chosen via the "--tag" command line option.
@@ -1013,13 +1378,15 @@ func_infer_tag ()
     if test -n "$available_tags" && test -z "$tagname"; then
       CC_quoted=
       for arg in $CC; do
-        func_quote_for_eval "$arg"
-	CC_quoted="$CC_quoted $func_quote_for_eval_result"
+	func_append_quoted CC_quoted "$arg"
       done
+      CC_expanded=`func_echo_all $CC`
+      CC_quoted_expanded=`func_echo_all $CC_quoted`
       case $@ in
       # Blanks in the command may have been stripped by the calling shell,
       # but not from the CC environment variable when configure was run.
-      " $CC "* | "$CC "* | " `$ECHO $CC` "* | "`$ECHO $CC` "* | " $CC_quoted"* | "$CC_quoted "* | " `$ECHO $CC_quoted` "* | "`$ECHO $CC_quoted` "*) ;;
+      " $CC "* | "$CC "* | " $CC_expanded "* | "$CC_expanded "* | \
+      " $CC_quoted"* | "$CC_quoted "* | " $CC_quoted_expanded "* | "$CC_quoted_expanded "*) ;;
       # Blanks at the start of $base_compile will cause this to fail
       # if we don't check for them as well.
       *)
@@ -1030,11 +1397,13 @@ func_infer_tag ()
 	    CC_quoted=
 	    for arg in $CC; do
 	      # Double-quote args containing other shell metacharacters.
-	      func_quote_for_eval "$arg"
-	      CC_quoted="$CC_quoted $func_quote_for_eval_result"
+	      func_append_quoted CC_quoted "$arg"
 	    done
+	    CC_expanded=`func_echo_all $CC`
+	    CC_quoted_expanded=`func_echo_all $CC_quoted`
 	    case "$@ " in
-	      " $CC "* | "$CC "* | " `$ECHO $CC` "* | "`$ECHO $CC` "* | " $CC_quoted"* | "$CC_quoted "* | " `$ECHO $CC_quoted` "* | "`$ECHO $CC_quoted` "*)
+	    " $CC "* | "$CC "* | " $CC_expanded "* | "$CC_expanded "* | \
+	    " $CC_quoted"* | "$CC_quoted "* | " $CC_quoted_expanded "* | "$CC_quoted_expanded "*)
 	      # The compiler in the base compile command matches
 	      # the one in the tagged configuration.
 	      # Assume this is the tagged configuration we want.
@@ -1097,6 +1466,486 @@ EOF
     }
 }
 
+
+##################################################
+# FILE NAME AND PATH CONVERSION HELPER FUNCTIONS #
+##################################################
+
+# func_convert_core_file_wine_to_w32 ARG
+# Helper function used by file name conversion functions when $build is *nix,
+# and $host is mingw, cygwin, or some other w32 environment. Relies on a
+# correctly configured wine environment available, with the winepath program
+# in $build's $PATH.
+#
+# ARG is the $build file name to be converted to w32 format.
+# Result is available in $func_convert_core_file_wine_to_w32_result, and will
+# be empty on error (or when ARG is empty)
+func_convert_core_file_wine_to_w32 ()
+{
+  $opt_debug
+  func_convert_core_file_wine_to_w32_result="$1"
+  if test -n "$1"; then
+    # Unfortunately, winepath does not exit with a non-zero error code, so we
+    # are forced to check the contents of stdout. On the other hand, if the
+    # command is not found, the shell will set an exit code of 127 and print
+    # *an error message* to stdout. So we must check for both error code of
+    # zero AND non-empty stdout, which explains the odd construction:
+    func_convert_core_file_wine_to_w32_tmp=`winepath -w "$1" 2>/dev/null`
+    if test "$?" -eq 0 && test -n "${func_convert_core_file_wine_to_w32_tmp}"; then
+      func_convert_core_file_wine_to_w32_result=`$ECHO "$func_convert_core_file_wine_to_w32_tmp" |
+        $SED -e "$lt_sed_naive_backslashify"`
+    else
+      func_convert_core_file_wine_to_w32_result=
+    fi
+  fi
+}
+# end: func_convert_core_file_wine_to_w32
+
+
+# func_convert_core_path_wine_to_w32 ARG
+# Helper function used by path conversion functions when $build is *nix, and
+# $host is mingw, cygwin, or some other w32 environment. Relies on a correctly
+# configured wine environment available, with the winepath program in $build's
+# $PATH. Assumes ARG has no leading or trailing path separator characters.
+#
+# ARG is path to be converted from $build format to win32.
+# Result is available in $func_convert_core_path_wine_to_w32_result.
+# Unconvertible file (directory) names in ARG are skipped; if no directory names
+# are convertible, then the result may be empty.
+func_convert_core_path_wine_to_w32 ()
+{
+  $opt_debug
+  # unfortunately, winepath doesn't convert paths, only file names
+  func_convert_core_path_wine_to_w32_result=""
+  if test -n "$1"; then
+    oldIFS=$IFS
+    IFS=:
+    for func_convert_core_path_wine_to_w32_f in $1; do
+      IFS=$oldIFS
+      func_convert_core_file_wine_to_w32 "$func_convert_core_path_wine_to_w32_f"
+      if test -n "$func_convert_core_file_wine_to_w32_result" ; then
+        if test -z "$func_convert_core_path_wine_to_w32_result"; then
+          func_convert_core_path_wine_to_w32_result="$func_convert_core_file_wine_to_w32_result"
+        else
+          func_append func_convert_core_path_wine_to_w32_result ";$func_convert_core_file_wine_to_w32_result"
+        fi
+      fi
+    done
+    IFS=$oldIFS
+  fi
+}
+# end: func_convert_core_path_wine_to_w32
+
+
+# func_cygpath ARGS...
+# Wrapper around calling the cygpath program via LT_CYGPATH. This is used when
+# when (1) $build is *nix and Cygwin is hosted via a wine environment; or (2)
+# $build is MSYS and $host is Cygwin, or (3) $build is Cygwin. In case (1) or
+# (2), returns the Cygwin file name or path in func_cygpath_result (input
+# file name or path is assumed to be in w32 format, as previously converted
+# from $build's *nix or MSYS format). In case (3), returns the w32 file name
+# or path in func_cygpath_result (input file name or path is assumed to be in
+# Cygwin format). Returns an empty string on error.
+#
+# ARGS are passed to cygpath, with the last one being the file name or path to
+# be converted.
+#
+# Specify the absolute *nix (or w32) name to cygpath in the LT_CYGPATH
+# environment variable; do not put it in $PATH.
+func_cygpath ()
+{
+  $opt_debug
+  if test -n "$LT_CYGPATH" && test -f "$LT_CYGPATH"; then
+    func_cygpath_result=`$LT_CYGPATH "$@" 2>/dev/null`
+    if test "$?" -ne 0; then
+      # on failure, ensure result is empty
+      func_cygpath_result=
+    fi
+  else
+    func_cygpath_result=
+    func_error "LT_CYGPATH is empty or specifies non-existent file: \`$LT_CYGPATH'"
+  fi
+}
+#end: func_cygpath
+
+
+# func_convert_core_msys_to_w32 ARG
+# Convert file name or path ARG from MSYS format to w32 format.  Return
+# result in func_convert_core_msys_to_w32_result.
+func_convert_core_msys_to_w32 ()
+{
+  $opt_debug
+  # awkward: cmd appends spaces to result
+  func_convert_core_msys_to_w32_result=`( cmd //c echo "$1" ) 2>/dev/null |
+    $SED -e 's/[ ]*$//' -e "$lt_sed_naive_backslashify"`
+}
+#end: func_convert_core_msys_to_w32
+
+
+# func_convert_file_check ARG1 ARG2
+# Verify that ARG1 (a file name in $build format) was converted to $host
+# format in ARG2. Otherwise, emit an error message, but continue (resetting
+# func_to_host_file_result to ARG1).
+func_convert_file_check ()
+{
+  $opt_debug
+  if test -z "$2" && test -n "$1" ; then
+    func_error "Could not determine host file name corresponding to"
+    func_error "  \`$1'"
+    func_error "Continuing, but uninstalled executables may not work."
+    # Fallback:
+    func_to_host_file_result="$1"
+  fi
+}
+# end func_convert_file_check
+
+
+# func_convert_path_check FROM_PATHSEP TO_PATHSEP FROM_PATH TO_PATH
+# Verify that FROM_PATH (a path in $build format) was converted to $host
+# format in TO_PATH. Otherwise, emit an error message, but continue, resetting
+# func_to_host_file_result to a simplistic fallback value (see below).
+func_convert_path_check ()
+{
+  $opt_debug
+  if test -z "$4" && test -n "$3"; then
+    func_error "Could not determine the host path corresponding to"
+    func_error "  \`$3'"
+    func_error "Continuing, but uninstalled executables may not work."
+    # Fallback.  This is a deliberately simplistic "conversion" and
+    # should not be "improved".  See libtool.info.
+    if test "x$1" != "x$2"; then
+      lt_replace_pathsep_chars="s|$1|$2|g"
+      func_to_host_path_result=`echo "$3" |
+        $SED -e "$lt_replace_pathsep_chars"`
+    else
+      func_to_host_path_result="$3"
+    fi
+  fi
+}
+# end func_convert_path_check
+
+
+# func_convert_path_front_back_pathsep FRONTPAT BACKPAT REPL ORIG
+# Modifies func_to_host_path_result by prepending REPL if ORIG matches FRONTPAT
+# and appending REPL if ORIG matches BACKPAT.
+func_convert_path_front_back_pathsep ()
+{
+  $opt_debug
+  case $4 in
+  $1 ) func_to_host_path_result="$3$func_to_host_path_result"
+    ;;
+  esac
+  case $4 in
+  $2 ) func_append func_to_host_path_result "$3"
+    ;;
+  esac
+}
+# end func_convert_path_front_back_pathsep
+
+
+##################################################
+# $build to $host FILE NAME CONVERSION FUNCTIONS #
+##################################################
+# invoked via `$to_host_file_cmd ARG'
+#
+# In each case, ARG is the path to be converted from $build to $host format.
+# Result will be available in $func_to_host_file_result.
+
+
+# func_to_host_file ARG
+# Converts the file name ARG from $build format to $host format. Return result
+# in func_to_host_file_result.
+func_to_host_file ()
+{
+  $opt_debug
+  $to_host_file_cmd "$1"
+}
+# end func_to_host_file
+
+
+# func_to_tool_file ARG LAZY
+# converts the file name ARG from $build format to toolchain format. Return
+# result in func_to_tool_file_result.  If the conversion in use is listed
+# in (the comma separated) LAZY, no conversion takes place.
+func_to_tool_file ()
+{
+  $opt_debug
+  case ,$2, in
+    *,"$to_tool_file_cmd",*)
+      func_to_tool_file_result=$1
+      ;;
+    *)
+      $to_tool_file_cmd "$1"
+      func_to_tool_file_result=$func_to_host_file_result
+      ;;
+  esac
+}
+# end func_to_tool_file
+
+
+# func_convert_file_noop ARG
+# Copy ARG to func_to_host_file_result.
+func_convert_file_noop ()
+{
+  func_to_host_file_result="$1"
+}
+# end func_convert_file_noop
+
+
+# func_convert_file_msys_to_w32 ARG
+# Convert file name ARG from (mingw) MSYS to (mingw) w32 format; automatic
+# conversion to w32 is not available inside the cwrapper.  Returns result in
+# func_to_host_file_result.
+func_convert_file_msys_to_w32 ()
+{
+  $opt_debug
+  func_to_host_file_result="$1"
+  if test -n "$1"; then
+    func_convert_core_msys_to_w32 "$1"
+    func_to_host_file_result="$func_convert_core_msys_to_w32_result"
+  fi
+  func_convert_file_check "$1" "$func_to_host_file_result"
+}
+# end func_convert_file_msys_to_w32
+
+
+# func_convert_file_cygwin_to_w32 ARG
+# Convert file name ARG from Cygwin to w32 format.  Returns result in
+# func_to_host_file_result.
+func_convert_file_cygwin_to_w32 ()
+{
+  $opt_debug
+  func_to_host_file_result="$1"
+  if test -n "$1"; then
+    # because $build is cygwin, we call "the" cygpath in $PATH; no need to use
+    # LT_CYGPATH in this case.
+    func_to_host_file_result=`cygpath -m "$1"`
+  fi
+  func_convert_file_check "$1" "$func_to_host_file_result"
+}
+# end func_convert_file_cygwin_to_w32
+
+
+# func_convert_file_nix_to_w32 ARG
+# Convert file name ARG from *nix to w32 format.  Requires a wine environment
+# and a working winepath. Returns result in func_to_host_file_result.
+func_convert_file_nix_to_w32 ()
+{
+  $opt_debug
+  func_to_host_file_result="$1"
+  if test -n "$1"; then
+    func_convert_core_file_wine_to_w32 "$1"
+    func_to_host_file_result="$func_convert_core_file_wine_to_w32_result"
+  fi
+  func_convert_file_check "$1" "$func_to_host_file_result"
+}
+# end func_convert_file_nix_to_w32
+
+
+# func_convert_file_msys_to_cygwin ARG
+# Convert file name ARG from MSYS to Cygwin format.  Requires LT_CYGPATH set.
+# Returns result in func_to_host_file_result.
+func_convert_file_msys_to_cygwin ()
+{
+  $opt_debug
+  func_to_host_file_result="$1"
+  if test -n "$1"; then
+    func_convert_core_msys_to_w32 "$1"
+    func_cygpath -u "$func_convert_core_msys_to_w32_result"
+    func_to_host_file_result="$func_cygpath_result"
+  fi
+  func_convert_file_check "$1" "$func_to_host_file_result"
+}
+# end func_convert_file_msys_to_cygwin
+
+
+# func_convert_file_nix_to_cygwin ARG
+# Convert file name ARG from *nix to Cygwin format.  Requires Cygwin installed
+# in a wine environment, working winepath, and LT_CYGPATH set.  Returns result
+# in func_to_host_file_result.
+func_convert_file_nix_to_cygwin ()
+{
+  $opt_debug
+  func_to_host_file_result="$1"
+  if test -n "$1"; then
+    # convert from *nix to w32, then use cygpath to convert from w32 to cygwin.
+    func_convert_core_file_wine_to_w32 "$1"
+    func_cygpath -u "$func_convert_core_file_wine_to_w32_result"
+    func_to_host_file_result="$func_cygpath_result"
+  fi
+  func_convert_file_check "$1" "$func_to_host_file_result"
+}
+# end func_convert_file_nix_to_cygwin
+
+
+#############################################
+# $build to $host PATH CONVERSION FUNCTIONS #
+#############################################
+# invoked via `$to_host_path_cmd ARG'
+#
+# In each case, ARG is the path to be converted from $build to $host format.
+# The result will be available in $func_to_host_path_result.
+#
+# Path separators are also converted from $build format to $host format.  If
+# ARG begins or ends with a path separator character, it is preserved (but
+# converted to $host format) on output.
+#
+# All path conversion functions are named using the following convention:
+#   file name conversion function    : func_convert_file_X_to_Y ()
+#   path conversion function         : func_convert_path_X_to_Y ()
+# where, for any given $build/$host combination the 'X_to_Y' value is the
+# same.  If conversion functions are added for new $build/$host combinations,
+# the two new functions must follow this pattern, or func_init_to_host_path_cmd
+# will break.
+
+
+# func_init_to_host_path_cmd
+# Ensures that function "pointer" variable $to_host_path_cmd is set to the
+# appropriate value, based on the value of $to_host_file_cmd.
+to_host_path_cmd=
+func_init_to_host_path_cmd ()
+{
+  $opt_debug
+  if test -z "$to_host_path_cmd"; then
+    func_stripname 'func_convert_file_' '' "$to_host_file_cmd"
+    to_host_path_cmd="func_convert_path_${func_stripname_result}"
+  fi
+}
+
+
+# func_to_host_path ARG
+# Converts the path ARG from $build format to $host format. Return result
+# in func_to_host_path_result.
+func_to_host_path ()
+{
+  $opt_debug
+  func_init_to_host_path_cmd
+  $to_host_path_cmd "$1"
+}
+# end func_to_host_path
+
+
+# func_convert_path_noop ARG
+# Copy ARG to func_to_host_path_result.
+func_convert_path_noop ()
+{
+  func_to_host_path_result="$1"
+}
+# end func_convert_path_noop
+
+
+# func_convert_path_msys_to_w32 ARG
+# Convert path ARG from (mingw) MSYS to (mingw) w32 format; automatic
+# conversion to w32 is not available inside the cwrapper.  Returns result in
+# func_to_host_path_result.
+func_convert_path_msys_to_w32 ()
+{
+  $opt_debug
+  func_to_host_path_result="$1"
+  if test -n "$1"; then
+    # Remove leading and trailing path separator characters from ARG.  MSYS
+    # behavior is inconsistent here; cygpath turns them into '.;' and ';.';
+    # and winepath ignores them completely.
+    func_stripname : : "$1"
+    func_to_host_path_tmp1=$func_stripname_result
+    func_convert_core_msys_to_w32 "$func_to_host_path_tmp1"
+    func_to_host_path_result="$func_convert_core_msys_to_w32_result"
+    func_convert_path_check : ";" \
+      "$func_to_host_path_tmp1" "$func_to_host_path_result"
+    func_convert_path_front_back_pathsep ":*" "*:" ";" "$1"
+  fi
+}
+# end func_convert_path_msys_to_w32
+
+
+# func_convert_path_cygwin_to_w32 ARG
+# Convert path ARG from Cygwin to w32 format.  Returns result in
+# func_to_host_file_result.
+func_convert_path_cygwin_to_w32 ()
+{
+  $opt_debug
+  func_to_host_path_result="$1"
+  if test -n "$1"; then
+    # See func_convert_path_msys_to_w32:
+    func_stripname : : "$1"
+    func_to_host_path_tmp1=$func_stripname_result
+    func_to_host_path_result=`cygpath -m -p "$func_to_host_path_tmp1"`
+    func_convert_path_check : ";" \
+      "$func_to_host_path_tmp1" "$func_to_host_path_result"
+    func_convert_path_front_back_pathsep ":*" "*:" ";" "$1"
+  fi
+}
+# end func_convert_path_cygwin_to_w32
+
+
+# func_convert_path_nix_to_w32 ARG
+# Convert path ARG from *nix to w32 format.  Requires a wine environment and
+# a working winepath.  Returns result in func_to_host_file_result.
+func_convert_path_nix_to_w32 ()
+{
+  $opt_debug
+  func_to_host_path_result="$1"
+  if test -n "$1"; then
+    # See func_convert_path_msys_to_w32:
+    func_stripname : : "$1"
+    func_to_host_path_tmp1=$func_stripname_result
+    func_convert_core_path_wine_to_w32 "$func_to_host_path_tmp1"
+    func_to_host_path_result="$func_convert_core_path_wine_to_w32_result"
+    func_convert_path_check : ";" \
+      "$func_to_host_path_tmp1" "$func_to_host_path_result"
+    func_convert_path_front_back_pathsep ":*" "*:" ";" "$1"
+  fi
+}
+# end func_convert_path_nix_to_w32
+
+
+# func_convert_path_msys_to_cygwin ARG
+# Convert path ARG from MSYS to Cygwin format.  Requires LT_CYGPATH set.
+# Returns result in func_to_host_file_result.
+func_convert_path_msys_to_cygwin ()
+{
+  $opt_debug
+  func_to_host_path_result="$1"
+  if test -n "$1"; then
+    # See func_convert_path_msys_to_w32:
+    func_stripname : : "$1"
+    func_to_host_path_tmp1=$func_stripname_result
+    func_convert_core_msys_to_w32 "$func_to_host_path_tmp1"
+    func_cygpath -u -p "$func_convert_core_msys_to_w32_result"
+    func_to_host_path_result="$func_cygpath_result"
+    func_convert_path_check : : \
+      "$func_to_host_path_tmp1" "$func_to_host_path_result"
+    func_convert_path_front_back_pathsep ":*" "*:" : "$1"
+  fi
+}
+# end func_convert_path_msys_to_cygwin
+
+
+# func_convert_path_nix_to_cygwin ARG
+# Convert path ARG from *nix to Cygwin format.  Requires Cygwin installed in a
+# a wine environment, working winepath, and LT_CYGPATH set.  Returns result in
+# func_to_host_file_result.
+func_convert_path_nix_to_cygwin ()
+{
+  $opt_debug
+  func_to_host_path_result="$1"
+  if test -n "$1"; then
+    # Remove leading and trailing path separator characters from
+    # ARG. msys behavior is inconsistent here, cygpath turns them
+    # into '.;' and ';.', and winepath ignores them completely.
+    func_stripname : : "$1"
+    func_to_host_path_tmp1=$func_stripname_result
+    func_convert_core_path_wine_to_w32 "$func_to_host_path_tmp1"
+    func_cygpath -u -p "$func_convert_core_path_wine_to_w32_result"
+    func_to_host_path_result="$func_cygpath_result"
+    func_convert_path_check : : \
+      "$func_to_host_path_tmp1" "$func_to_host_path_result"
+    func_convert_path_front_back_pathsep ":*" "*:" : "$1"
+  fi
+}
+# end func_convert_path_nix_to_cygwin
+
+
 # func_mode_compile arg...
 func_mode_compile ()
 {
@@ -1137,12 +1986,12 @@ func_mode_compile ()
 	  ;;
 
 	-pie | -fpie | -fPIE)
-          pie_flag="$pie_flag $arg"
+          func_append pie_flag " $arg"
 	  continue
 	  ;;
 
 	-shared | -static | -prefer-pic | -prefer-non-pic)
-	  later="$later $arg"
+	  func_append later " $arg"
 	  continue
 	  ;;
 
@@ -1163,15 +2012,14 @@ func_mode_compile ()
 	  save_ifs="$IFS"; IFS=','
 	  for arg in $args; do
 	    IFS="$save_ifs"
-	    func_quote_for_eval "$arg"
-	    lastarg="$lastarg $func_quote_for_eval_result"
+	    func_append_quoted lastarg "$arg"
 	  done
 	  IFS="$save_ifs"
 	  func_stripname ' ' '' "$lastarg"
 	  lastarg=$func_stripname_result
 
 	  # Add the arguments to base_compile.
-	  base_compile="$base_compile $lastarg"
+	  func_append base_compile " $lastarg"
 	  continue
 	  ;;
 
@@ -1187,8 +2035,7 @@ func_mode_compile ()
       esac    #  case $arg_mode
 
       # Aesthetically quote the previous argument.
-      func_quote_for_eval "$lastarg"
-      base_compile="$base_compile $func_quote_for_eval_result"
+      func_append_quoted base_compile "$lastarg"
     done # for arg
 
     case $arg_mode in
@@ -1213,7 +2060,7 @@ func_mode_compile ()
     *.[cCFSifmso] | \
     *.ada | *.adb | *.ads | *.asm | \
     *.c++ | *.cc | *.ii | *.class | *.cpp | *.cxx | \
-    *.[fF][09]? | *.for | *.java | *.obj | *.sx)
+    *.[fF][09]? | *.for | *.java | *.go | *.obj | *.sx | *.cu | *.cup)
       func_xform "$libobj"
       libobj=$func_xform_result
       ;;
@@ -1288,7 +2135,7 @@ func_mode_compile ()
     # Calculate the filename of the output object if compiler does
     # not support -o with -c
     if test "$compiler_c_o" = no; then
-      output_obj=`$ECHO "X$srcfile" | $Xsed -e 's%^.*/%%' -e 's%\.[^.]*$%%'`.${objext}
+      output_obj=`$ECHO "$srcfile" | $SED 's%^.*/%%; s%\.[^.]*$%%'`.${objext}
       lockfile="$output_obj.lock"
     else
       output_obj=
@@ -1319,17 +2166,16 @@ compiler."
 	$opt_dry_run || $RM $removelist
 	exit $EXIT_FAILURE
       fi
-      removelist="$removelist $output_obj"
+      func_append removelist " $output_obj"
       $ECHO "$srcfile" > "$lockfile"
     fi
 
     $opt_dry_run || $RM $removelist
-    removelist="$removelist $lockfile"
+    func_append removelist " $lockfile"
     trap '$opt_dry_run || $RM $removelist; exit $EXIT_FAILURE' 1 2 15
 
-    if test -n "$fix_srcfile_path"; then
-      eval srcfile=\"$fix_srcfile_path\"
-    fi
+    func_to_tool_file "$srcfile" func_convert_file_msys_to_w32
+    srcfile=$func_to_tool_file_result
     func_quote_for_eval "$srcfile"
     qsrcfile=$func_quote_for_eval_result
 
@@ -1349,7 +2195,7 @@ compiler."
 
       if test -z "$output_obj"; then
 	# Place PIC objects in $objdir
-	command="$command -o $lobj"
+	func_append command " -o $lobj"
       fi
 
       func_show_eval_locale "$command"	\
@@ -1396,11 +2242,11 @@ compiler."
 	command="$base_compile $qsrcfile $pic_flag"
       fi
       if test "$compiler_c_o" = yes; then
-	command="$command -o $obj"
+	func_append command " -o $obj"
       fi
 
       # Suppress compiler output if we already did a PIC compilation.
-      command="$command$suppress_output"
+      func_append command "$suppress_output"
       func_show_eval_locale "$command" \
         '$opt_dry_run || $RM $removelist; exit $EXIT_FAILURE'
 
@@ -1445,13 +2291,13 @@ compiler."
 }
 
 $opt_help || {
-test "$mode" = compile && func_mode_compile ${1+"$@"}
+  test "$opt_mode" = compile && func_mode_compile ${1+"$@"}
 }
 
 func_mode_help ()
 {
     # We need to display help for each of the modes.
-    case $mode in
+    case $opt_mode in
       "")
         # Generic help is extracted from the usage comments
         # at the start of this file.
@@ -1482,10 +2328,11 @@ This mode accepts the following addition
 
   -o OUTPUT-FILE    set the output file name to OUTPUT-FILE
   -no-suppress      do not suppress compiler output for multiple passes
-  -prefer-pic       try to building PIC objects only
-  -prefer-non-pic   try to building non-PIC objects only
+  -prefer-pic       try to build PIC objects only
+  -prefer-non-pic   try to build non-PIC objects only
   -shared           do not build a \`.o' file suitable for static linking
   -static           only build a \`.o' file suitable for static linking
+  -Wc,FLAG          pass FLAG directly to the compiler
 
 COMPILE-COMMAND is a command to be used in creating a \`standard' object file
 from the given SOURCEFILE.
@@ -1538,7 +2385,7 @@ either the \`install' or \`cp' program.
 
 The following components of INSTALL-COMMAND are treated specially:
 
-  -inst-prefix PREFIX-DIR  Use PREFIX-DIR as a staging area for installation
+  -inst-prefix-dir PREFIX-DIR  Use PREFIX-DIR as a staging area for installation
 
 The rest of the components are interpreted as arguments to that command (only
 BSD-compatible install options are recognized)."
@@ -1558,6 +2405,8 @@ The following components of LINK-COMMAND
 
   -all-static       do not do any dynamic linking at all
   -avoid-version    do not add a version suffix if possible
+  -bindir BINDIR    specify path to binaries directory (for systems where
+                    libraries must be found in the PATH setting at runtime)
   -dlopen FILE      \`-dlpreopen' FILE if it cannot be dlopened at runtime
   -dlpreopen FILE   link in FILE and add its symbols to lt_preloaded_symbols
   -export-dynamic   allow symbols from OUTPUT-FILE to be resolved with dlsym(3)
@@ -1586,6 +2435,11 @@ The following components of LINK-COMMAND
   -version-info CURRENT[:REVISION[:AGE]]
                     specify library version info [each variable defaults to 0]
   -weak LIBNAME     declare that the target provides the LIBNAME interface
+  -Wc,FLAG
+  -Xcompiler FLAG   pass linker-specific FLAG directly to the compiler
+  -Wl,FLAG
+  -Xlinker FLAG     pass linker-specific FLAG directly to the linker
+  -XCClinker FLAG   pass link-specific FLAG to the compiler driver (CC)
 
 All other options (arguments beginning with \`-') are ignored.
 
@@ -1619,18 +2473,44 @@ Otherwise, only FILE itself is deleted u
         ;;
 
       *)
-        func_fatal_help "invalid operation mode \`$mode'"
+        func_fatal_help "invalid operation mode \`$opt_mode'"
         ;;
     esac
 
-    $ECHO
+    echo
     $ECHO "Try \`$progname --help' for more information about other modes."
-
-    exit $?
 }
 
-  # Now that we've collected a possible --mode arg, show help if necessary
-  $opt_help && func_mode_help
+# Now that we've collected a possible --mode arg, show help if necessary
+if $opt_help; then
+  if test "$opt_help" = :; then
+    func_mode_help
+  else
+    {
+      func_help noexit
+      for opt_mode in compile link execute install finish uninstall clean; do
+	func_mode_help
+      done
+    } | sed -n '1p; 2,$s/^Usage:/  or: /p'
+    {
+      func_help noexit
+      for opt_mode in compile link execute install finish uninstall clean; do
+	echo
+	func_mode_help
+      done
+    } |
+    sed '1d
+      /^When reporting/,/^Report/{
+	H
+	d
+      }
+      $x
+      /information about other modes/d
+      /more detailed .*MODE/d
+      s/^Usage:.*--mode=\([^ ]*\) .*/Description of \1 mode:/'
+  fi
+  exit $?
+fi
 
 
 # func_mode_execute arg...
@@ -1643,13 +2523,16 @@ func_mode_execute ()
       func_fatal_help "you must specify a COMMAND"
 
     # Handle -dlopen flags immediately.
-    for file in $execute_dlfiles; do
+    for file in $opt_dlopen; do
       test -f "$file" \
 	|| func_fatal_help "\`$file' is not a file"
 
       dir=
       case $file in
       *.la)
+	func_resolve_sysroot "$file"
+	file=$func_resolve_sysroot_result
+
 	# Check to see that this really is a libtool archive.
 	func_lalib_unsafe_p "$file" \
 	  || func_fatal_help "\`$lib' is not a valid libtool archive"
@@ -1671,7 +2554,7 @@ func_mode_execute ()
 	dir="$func_dirname_result"
 
 	if test -f "$dir/$objdir/$dlname"; then
-	  dir="$dir/$objdir"
+	  func_append dir "/$objdir"
 	else
 	  if test ! -f "$dir/$dlname"; then
 	    func_fatal_error "cannot find \`$dlname' in \`$dir' or \`$dir/$objdir'"
@@ -1712,7 +2595,7 @@ func_mode_execute ()
     for file
     do
       case $file in
-      -*) ;;
+      -* | *.la | *.lo ) ;;
       *)
 	# Do a test to see if this is really a libtool program.
 	if func_ltwrapper_script_p "$file"; then
@@ -1728,8 +2611,7 @@ func_mode_execute ()
 	;;
       esac
       # Quote arguments (to preserve shell metacharacters).
-      func_quote_for_eval "$file"
-      args="$args $func_quote_for_eval_result"
+      func_append_quoted args "$file"
     done
 
     if test "X$opt_dry_run" = Xfalse; then
@@ -1754,29 +2636,66 @@ func_mode_execute ()
       # Display what would be done.
       if test -n "$shlibpath_var"; then
 	eval "\$ECHO \"\$shlibpath_var=\$$shlibpath_var\""
-	$ECHO "export $shlibpath_var"
+	echo "export $shlibpath_var"
       fi
       $ECHO "$cmd$args"
       exit $EXIT_SUCCESS
     fi
 }
 
-test "$mode" = execute && func_mode_execute ${1+"$@"}
+test "$opt_mode" = execute && func_mode_execute ${1+"$@"}
+
+
+# func_mode_finish arg...
+func_mode_finish ()
+{
+    $opt_debug
+    libs=
+    libdirs=
+    admincmds=
+
+    for opt in "$nonopt" ${1+"$@"}
+    do
+      if test -d "$opt"; then
+	func_append libdirs " $opt"
+
+      elif test -f "$opt"; then
+	if func_lalib_unsafe_p "$opt"; then
+	  func_append libs " $opt"
+	else
+	  func_warning "\`$opt' is not a valid libtool archive"
+	fi
+
+      else
+	func_fatal_error "invalid argument \`$opt'"
+      fi
+    done
 
+    if test -n "$libs"; then
+      if test -n "$lt_sysroot"; then
+        sysroot_regex=`$ECHO "$lt_sysroot" | $SED "$sed_make_literal_regex"`
+        sysroot_cmd="s/\([ ']\)$sysroot_regex/\1/g;"
+      else
+        sysroot_cmd=
+      fi
 
-# func_mode_finish arg...
-func_mode_finish ()
-{
-    $opt_debug
-    libdirs="$nonopt"
-    admincmds=
+      # Remove sysroot references
+      if $opt_dry_run; then
+        for lib in $libs; do
+          echo "removing references to $lt_sysroot and \`=' prefixes from $lib"
+        done
+      else
+        tmpdir=`func_mktempdir`
+        for lib in $libs; do
+	  sed -e "${sysroot_cmd} s/\([ ']-[LR]\)=/\1/g; s/\([ ']\)=/\1/g" $lib \
+	    > $tmpdir/tmp-la
+	  mv -f $tmpdir/tmp-la $lib
+	done
+        ${RM}r "$tmpdir"
+      fi
+    fi
 
     if test -n "$finish_cmds$finish_eval" && test -n "$libdirs"; then
-      for dir
-      do
-	libdirs="$libdirs $dir"
-      done
-
       for libdir in $libdirs; do
 	if test -n "$finish_cmds"; then
 	  # Do each command in the finish commands.
@@ -1786,7 +2705,7 @@ func_mode_finish ()
 	if test -n "$finish_eval"; then
 	  # Do the single finish_eval.
 	  eval cmds=\"$finish_eval\"
-	  $opt_dry_run || eval "$cmds" || admincmds="$admincmds
+	  $opt_dry_run || eval "$cmds" || func_append admincmds "
        $cmds"
 	fi
       done
@@ -1795,53 +2714,55 @@ func_mode_finish ()
     # Exit here if they wanted silent mode.
     $opt_silent && exit $EXIT_SUCCESS
 
-    $ECHO "X----------------------------------------------------------------------" | $Xsed
-    $ECHO "Libraries have been installed in:"
-    for libdir in $libdirs; do
-      $ECHO "   $libdir"
-    done
-    $ECHO
-    $ECHO "If you ever happen to want to link against installed libraries"
-    $ECHO "in a given directory, LIBDIR, you must either use libtool, and"
-    $ECHO "specify the full pathname of the library, or use the \`-LLIBDIR'"
-    $ECHO "flag during linking and do at least one of the following:"
-    if test -n "$shlibpath_var"; then
-      $ECHO "   - add LIBDIR to the \`$shlibpath_var' environment variable"
-      $ECHO "     during execution"
-    fi
-    if test -n "$runpath_var"; then
-      $ECHO "   - add LIBDIR to the \`$runpath_var' environment variable"
-      $ECHO "     during linking"
-    fi
-    if test -n "$hardcode_libdir_flag_spec"; then
-      libdir=LIBDIR
-      eval flag=\"$hardcode_libdir_flag_spec\"
+    if test -n "$finish_cmds$finish_eval" && test -n "$libdirs"; then
+      echo "----------------------------------------------------------------------"
+      echo "Libraries have been installed in:"
+      for libdir in $libdirs; do
+	$ECHO "   $libdir"
+      done
+      echo
+      echo "If you ever happen to want to link against installed libraries"
+      echo "in a given directory, LIBDIR, you must either use libtool, and"
+      echo "specify the full pathname of the library, or use the \`-LLIBDIR'"
+      echo "flag during linking and do at least one of the following:"
+      if test -n "$shlibpath_var"; then
+	echo "   - add LIBDIR to the \`$shlibpath_var' environment variable"
+	echo "     during execution"
+      fi
+      if test -n "$runpath_var"; then
+	echo "   - add LIBDIR to the \`$runpath_var' environment variable"
+	echo "     during linking"
+      fi
+      if test -n "$hardcode_libdir_flag_spec"; then
+	libdir=LIBDIR
+	eval flag=\"$hardcode_libdir_flag_spec\"
 
-      $ECHO "   - use the \`$flag' linker flag"
-    fi
-    if test -n "$admincmds"; then
-      $ECHO "   - have your system administrator run these commands:$admincmds"
-    fi
-    if test -f /etc/ld.so.conf; then
-      $ECHO "   - have your system administrator add LIBDIR to \`/etc/ld.so.conf'"
-    fi
-    $ECHO
+	$ECHO "   - use the \`$flag' linker flag"
+      fi
+      if test -n "$admincmds"; then
+	$ECHO "   - have your system administrator run these commands:$admincmds"
+      fi
+      if test -f /etc/ld.so.conf; then
+	echo "   - have your system administrator add LIBDIR to \`/etc/ld.so.conf'"
+      fi
+      echo
 
-    $ECHO "See any operating system documentation about shared libraries for"
-    case $host in
-      solaris2.[6789]|solaris2.1[0-9])
-        $ECHO "more information, such as the ld(1), crle(1) and ld.so(8) manual"
-	$ECHO "pages."
-	;;
-      *)
-        $ECHO "more information, such as the ld(1) and ld.so(8) manual pages."
-        ;;
-    esac
-    $ECHO "X----------------------------------------------------------------------" | $Xsed
+      echo "See any operating system documentation about shared libraries for"
+      case $host in
+	solaris2.[6789]|solaris2.1[0-9])
+	  echo "more information, such as the ld(1), crle(1) and ld.so(8) manual"
+	  echo "pages."
+	  ;;
+	*)
+	  echo "more information, such as the ld(1) and ld.so(8) manual pages."
+	  ;;
+      esac
+      echo "----------------------------------------------------------------------"
+    fi
     exit $EXIT_SUCCESS
 }
 
-test "$mode" = finish && func_mode_finish ${1+"$@"}
+test "$opt_mode" = finish && func_mode_finish ${1+"$@"}
 
 
 # func_mode_install arg...
@@ -1852,7 +2773,7 @@ func_mode_install ()
     # install_prog (especially on Windows NT).
     if test "$nonopt" = "$SHELL" || test "$nonopt" = /bin/sh ||
        # Allow the use of GNU shtool's install command.
-       $ECHO "X$nonopt" | $GREP shtool >/dev/null; then
+       case $nonopt in *shtool*) :;; *) false;; esac; then
       # Aesthetically quote it.
       func_quote_for_eval "$nonopt"
       install_prog="$func_quote_for_eval_result "
@@ -1866,7 +2787,12 @@ func_mode_install ()
     # The real first argument should be the name of the installation program.
     # Aesthetically quote it.
     func_quote_for_eval "$arg"
-    install_prog="$install_prog$func_quote_for_eval_result"
+    func_append install_prog "$func_quote_for_eval_result"
+    install_shared_prog=$install_prog
+    case " $install_prog " in
+      *[\\\ /]cp\ *) install_cp=: ;;
+      *) install_cp=false ;;
+    esac
 
     # We need to accept at least all the BSD install flags.
     dest=
@@ -1876,10 +2802,12 @@ func_mode_install ()
     install_type=
     isdir=no
     stripme=
+    no_mode=:
     for arg
     do
+      arg2=
       if test -n "$dest"; then
-	files="$files $dest"
+	func_append files " $dest"
 	dest=$arg
 	continue
       fi
@@ -1887,10 +2815,9 @@ func_mode_install ()
       case $arg in
       -d) isdir=yes ;;
       -f)
-	case " $install_prog " in
-	*[\\\ /]cp\ *) ;;
-	*) prev=$arg ;;
-	esac
+	if $install_cp; then :; else
+	  prev=$arg
+	fi
 	;;
       -g | -m | -o)
 	prev=$arg
@@ -1904,6 +2831,10 @@ func_mode_install ()
       *)
 	# If the previous option needed an argument, then skip it.
 	if test -n "$prev"; then
+	  if test "x$prev" = x-m && test -n "$install_override_mode"; then
+	    arg2=$install_override_mode
+	    no_mode=false
+	  fi
 	  prev=
 	else
 	  dest=$arg
@@ -1914,7 +2845,11 @@ func_mode_install ()
 
       # Aesthetically quote the argument.
       func_quote_for_eval "$arg"
-      install_prog="$install_prog $func_quote_for_eval_result"
+      func_append install_prog " $func_quote_for_eval_result"
+      if test -n "$arg2"; then
+	func_quote_for_eval "$arg2"
+      fi
+      func_append install_shared_prog " $func_quote_for_eval_result"
     done
 
     test -z "$install_prog" && \
@@ -1923,6 +2858,13 @@ func_mode_install ()
     test -n "$prev" && \
       func_fatal_help "the \`$prev' option requires an argument"
 
+    if test -n "$install_override_mode" && $no_mode; then
+      if $install_cp; then :; else
+	func_quote_for_eval "$install_override_mode"
+	func_append install_shared_prog " -m $func_quote_for_eval_result"
+      fi
+    fi
+
     if test -z "$files"; then
       if test -z "$dest"; then
 	func_fatal_help "no file or destination specified"
@@ -1977,10 +2919,13 @@ func_mode_install ()
       case $file in
       *.$libext)
 	# Do the static libraries later.
-	staticlibs="$staticlibs $file"
+	func_append staticlibs " $file"
 	;;
 
       *.la)
+	func_resolve_sysroot "$file"
+	file=$func_resolve_sysroot_result
+
 	# Check to see that this really is a libtool archive.
 	func_lalib_unsafe_p "$file" \
 	  || func_fatal_help "\`$file' is not a valid libtool archive"
@@ -1994,23 +2939,23 @@ func_mode_install ()
 	if test "X$destdir" = "X$libdir"; then
 	  case "$current_libdirs " in
 	  *" $libdir "*) ;;
-	  *) current_libdirs="$current_libdirs $libdir" ;;
+	  *) func_append current_libdirs " $libdir" ;;
 	  esac
 	else
 	  # Note the libdir as a future libdir.
 	  case "$future_libdirs " in
 	  *" $libdir "*) ;;
-	  *) future_libdirs="$future_libdirs $libdir" ;;
+	  *) func_append future_libdirs " $libdir" ;;
 	  esac
 	fi
 
 	func_dirname "$file" "/" ""
 	dir="$func_dirname_result"
-	dir="$dir$objdir"
+	func_append dir "$objdir"
 
 	if test -n "$relink_command"; then
 	  # Determine the prefix the user has applied to our future dir.
-	  inst_prefix_dir=`$ECHO "X$destdir" | $Xsed -e "s%$libdir\$%%"`
+	  inst_prefix_dir=`$ECHO "$destdir" | $SED -e "s%$libdir\$%%"`
 
 	  # Don't allow the user to place us outside of our expected
 	  # location b/c this prevents finding dependent libraries that
@@ -2023,9 +2968,9 @@ func_mode_install ()
 
 	  if test -n "$inst_prefix_dir"; then
 	    # Stick the inst_prefix_dir data into the link command.
-	    relink_command=`$ECHO "X$relink_command" | $Xsed -e "s%@inst_prefix_dir@%-inst-prefix-dir $inst_prefix_dir%"`
+	    relink_command=`$ECHO "$relink_command" | $SED "s%@inst_prefix_dir@%-inst-prefix-dir $inst_prefix_dir%"`
 	  else
-	    relink_command=`$ECHO "X$relink_command" | $Xsed -e "s%@inst_prefix_dir@%%"`
+	    relink_command=`$ECHO "$relink_command" | $SED "s%@inst_prefix_dir@%%"`
 	  fi
 
 	  func_warning "relinking \`$file'"
@@ -2043,7 +2988,7 @@ func_mode_install ()
 	  test -n "$relink_command" && srcname="$realname"T
 
 	  # Install the shared library and build the symlinks.
-	  func_show_eval "$install_prog $dir/$srcname $destdir/$realname" \
+	  func_show_eval "$install_shared_prog $dir/$srcname $destdir/$realname" \
 	      'exit $?'
 	  tstripme="$stripme"
 	  case $host_os in
@@ -2083,7 +3028,7 @@ func_mode_install ()
 	func_show_eval "$install_prog $instname $destdir/$name" 'exit $?'
 
 	# Maybe install the static library, too.
-	test -n "$old_library" && staticlibs="$staticlibs $dir/$old_library"
+	test -n "$old_library" && func_append staticlibs " $dir/$old_library"
 	;;
 
       *.lo)
@@ -2183,7 +3128,7 @@ func_mode_install ()
 	    if test -f "$lib"; then
 	      func_source "$lib"
 	    fi
-	    libfile="$libdir/"`$ECHO "X$lib" | $Xsed -e 's%^.*/%%g'` ### testsuite: skip nested quoting test
+	    libfile="$libdir/"`$ECHO "$lib" | $SED 's%^.*/%%g'` ### testsuite: skip nested quoting test
 	    if test -n "$libdir" && test ! -f "$libfile"; then
 	      func_warning "\`$lib' has not been installed in \`$libdir'"
 	      finalize=no
@@ -2202,7 +3147,7 @@ func_mode_install ()
 		file="$func_basename_result"
 	        outputname="$tmpdir/$file"
 	        # Replace the output file specification.
-	        relink_command=`$ECHO "X$relink_command" | $Xsed -e 's%@OUTPUT@%'"$outputname"'%g'`
+	        relink_command=`$ECHO "$relink_command" | $SED 's%@OUTPUT@%'"$outputname"'%g'`
 
 	        $opt_silent || {
 	          func_quote_for_expand "$relink_command"
@@ -2221,7 +3166,7 @@ func_mode_install ()
 	    }
 	  else
 	    # Install the binary that we compiled earlier.
-	    file=`$ECHO "X$file$stripped_ext" | $Xsed -e "s%\([^/]*\)$%$objdir/\1%"`
+	    file=`$ECHO "$file$stripped_ext" | $SED "s%\([^/]*\)$%$objdir/\1%"`
 	  fi
 	fi
 
@@ -2257,11 +3202,13 @@ func_mode_install ()
 
       # Set up the ranlib parameters.
       oldlib="$destdir/$name"
+      func_to_tool_file "$oldlib" func_convert_file_msys_to_w32
+      tool_oldlib=$func_to_tool_file_result
 
       func_show_eval "$install_prog \$file \$oldlib" 'exit $?'
 
       if test -n "$stripme" && test -n "$old_striplib"; then
-	func_show_eval "$old_striplib $oldlib" 'exit $?'
+	func_show_eval "$old_striplib $tool_oldlib" 'exit $?'
       fi
 
       # Do each command in the postinstall commands.
@@ -2280,7 +3227,7 @@ func_mode_install ()
     fi
 }
 
-test "$mode" = install && func_mode_install ${1+"$@"}
+test "$opt_mode" = install && func_mode_install ${1+"$@"}
 
 
 # func_generate_dlsyms outputname originator pic_p
@@ -2323,6 +3270,22 @@ func_generate_dlsyms ()
 extern \"C\" {
 #endif
 
+#if defined(__GNUC__) && (((__GNUC__ == 4) && (__GNUC_MINOR__ >= 4)) || (__GNUC__ > 4))
+#pragma GCC diagnostic ignored \"-Wstrict-prototypes\"
+#endif
+
+/* Keep this code in sync between libtool.m4, ltmain, lt_system.h, and tests.  */
+#if defined(_WIN32) || defined(__CYGWIN__) || defined(_WIN32_WCE)
+/* DATA imports from DLLs on WIN32 con't be const, because runtime
+   relocations are performed -- see ld's documentation on pseudo-relocs.  */
+# define LT_DLSYM_CONST
+#elif defined(__osf__)
+/* This system does not cope well with relocations in const data.  */
+# define LT_DLSYM_CONST
+#else
+# define LT_DLSYM_CONST const
+#endif
+
 /* External symbol declarations for the compiler. */\
 "
 
@@ -2332,10 +3295,11 @@ extern \"C\" {
 	  $opt_dry_run || echo ': @PROGRAM@ ' > "$nlist"
 
 	  # Add our own program objects to the symbol list.
-	  progfiles=`$ECHO "X$objs$old_deplibs" | $SP2NL | $Xsed -e "$lo2o" | $NL2SP`
+	  progfiles=`$ECHO "$objs$old_deplibs" | $SP2NL | $SED "$lo2o" | $NL2SP`
 	  for progfile in $progfiles; do
-	    func_verbose "extracting global C symbols from \`$progfile'"
-	    $opt_dry_run || eval "$NM $progfile | $global_symbol_pipe >> '$nlist'"
+	    func_to_tool_file "$progfile" func_convert_file_msys_to_w32
+	    func_verbose "extracting global C symbols from \`$func_to_tool_file_result'"
+	    $opt_dry_run || eval "$NM $func_to_tool_file_result | $global_symbol_pipe >> '$nlist'"
 	  done
 
 	  if test -n "$exclude_expsyms"; then
@@ -2371,7 +3335,7 @@ extern \"C\" {
 	      eval '$GREP -f "$output_objdir/$outputname.exp" < "$nlist" > "$nlist"T'
 	      eval '$MV "$nlist"T "$nlist"'
 	      case $host in
-	        *cygwin | *mingw* | *cegcc* )
+	        *cygwin* | *mingw* | *cegcc* )
 	          eval "echo EXPORTS "'> "$output_objdir/$outputname.def"'
 	          eval 'cat "$nlist" >> "$output_objdir/$outputname.def"'
 	          ;;
@@ -2384,10 +3348,52 @@ extern \"C\" {
 	  func_verbose "extracting global C symbols from \`$dlprefile'"
 	  func_basename "$dlprefile"
 	  name="$func_basename_result"
-	  $opt_dry_run || {
-	    eval '$ECHO ": $name " >> "$nlist"'
-	    eval "$NM $dlprefile 2>/dev/null | $global_symbol_pipe >> '$nlist'"
-	  }
+          case $host in
+	    *cygwin* | *mingw* | *cegcc* )
+	      # if an import library, we need to obtain dlname
+	      if func_win32_import_lib_p "$dlprefile"; then
+	        func_tr_sh "$dlprefile"
+	        eval "curr_lafile=\$libfile_$func_tr_sh_result"
+	        dlprefile_dlbasename=""
+	        if test -n "$curr_lafile" && func_lalib_p "$curr_lafile"; then
+	          # Use subshell, to avoid clobbering current variable values
+	          dlprefile_dlname=`source "$curr_lafile" && echo "$dlname"`
+	          if test -n "$dlprefile_dlname" ; then
+	            func_basename "$dlprefile_dlname"
+	            dlprefile_dlbasename="$func_basename_result"
+	          else
+	            # no lafile. user explicitly requested -dlpreopen <import library>.
+	            $sharedlib_from_linklib_cmd "$dlprefile"
+	            dlprefile_dlbasename=$sharedlib_from_linklib_result
+	          fi
+	        fi
+	        $opt_dry_run || {
+	          if test -n "$dlprefile_dlbasename" ; then
+	            eval '$ECHO ": $dlprefile_dlbasename" >> "$nlist"'
+	          else
+	            func_warning "Could not compute DLL name from $name"
+	            eval '$ECHO ": $name " >> "$nlist"'
+	          fi
+	          func_to_tool_file "$dlprefile" func_convert_file_msys_to_w32
+	          eval "$NM \"$func_to_tool_file_result\" 2>/dev/null | $global_symbol_pipe |
+	            $SED -e '/I __imp/d' -e 's/I __nm_/D /;s/_nm__//' >> '$nlist'"
+	        }
+	      else # not an import lib
+	        $opt_dry_run || {
+	          eval '$ECHO ": $name " >> "$nlist"'
+	          func_to_tool_file "$dlprefile" func_convert_file_msys_to_w32
+	          eval "$NM \"$func_to_tool_file_result\" 2>/dev/null | $global_symbol_pipe >> '$nlist'"
+	        }
+	      fi
+	    ;;
+	    *)
+	      $opt_dry_run || {
+	        eval '$ECHO ": $name " >> "$nlist"'
+	        func_to_tool_file "$dlprefile" func_convert_file_msys_to_w32
+	        eval "$NM \"$func_to_tool_file_result\" 2>/dev/null | $global_symbol_pipe >> '$nlist'"
+	      }
+	    ;;
+          esac
 	done
 
 	$opt_dry_run || {
@@ -2415,36 +3421,19 @@ extern \"C\" {
 	  if test -f "$nlist"S; then
 	    eval "$global_symbol_to_cdecl"' < "$nlist"S >> "$output_objdir/$my_dlsyms"'
 	  else
-	    $ECHO '/* NONE */' >> "$output_objdir/$my_dlsyms"
+	    echo '/* NONE */' >> "$output_objdir/$my_dlsyms"
 	  fi
 
-	  $ECHO >> "$output_objdir/$my_dlsyms" "\
+	  echo >> "$output_objdir/$my_dlsyms" "\
 
 /* The mapping between symbol names and symbols.  */
 typedef struct {
   const char *name;
   void *address;
 } lt_dlsymlist;
-"
-	  case $host in
-	  *cygwin* | *mingw* | *cegcc* )
-	    $ECHO >> "$output_objdir/$my_dlsyms" "\
-/* DATA imports from DLLs on WIN32 con't be const, because
-   runtime relocations are performed -- see ld's documentation
-   on pseudo-relocs.  */"
-	    lt_dlsym_const= ;;
-	  *osf5*)
-	    echo >> "$output_objdir/$my_dlsyms" "\
-/* This system does not cope well with relocations in const data */"
-	    lt_dlsym_const= ;;
-	  *)
-	    lt_dlsym_const=const ;;
-	  esac
-
-	  $ECHO >> "$output_objdir/$my_dlsyms" "\
-extern $lt_dlsym_const lt_dlsymlist
+extern LT_DLSYM_CONST lt_dlsymlist
 lt_${my_prefix}_LTX_preloaded_symbols[];
-$lt_dlsym_const lt_dlsymlist
+LT_DLSYM_CONST lt_dlsymlist
 lt_${my_prefix}_LTX_preloaded_symbols[] =
 {\
   { \"$my_originator\", (void *) 0 },"
@@ -2457,7 +3446,7 @@ lt_${my_prefix}_LTX_preloaded_symbols[]
 	    eval "$global_symbol_to_c_name_address_lib_prefix" < "$nlist" >> "$output_objdir/$my_dlsyms"
 	    ;;
 	  esac
-	  $ECHO >> "$output_objdir/$my_dlsyms" "\
+	  echo >> "$output_objdir/$my_dlsyms" "\
   {0, (void *) 0}
 };
 
@@ -2484,7 +3473,7 @@ static const void *lt_preloaded_setup()
 	  # linked before any other PIC object.  But we must not use
 	  # pic_flag when linking with -static.  The problem exists in
 	  # FreeBSD 2.2.6 and is fixed in FreeBSD 3.1.
-	  *-*-freebsd2*|*-*-freebsd3.0*|*-*-freebsdelf3.0*)
+	  *-*-freebsd2.*|*-*-freebsd3.0*|*-*-freebsdelf3.0*)
 	    pic_flag_for_symtable=" $pic_flag -DFREEBSD_WORKAROUND" ;;
 	  *-*-hpux*)
 	    pic_flag_for_symtable=" $pic_flag"  ;;
@@ -2500,7 +3489,7 @@ static const void *lt_preloaded_setup()
 	for arg in $LTCFLAGS; do
 	  case $arg in
 	  -pie | -fpie | -fPIE) ;;
-	  *) symtab_cflags="$symtab_cflags $arg" ;;
+	  *) func_append symtab_cflags " $arg" ;;
 	  esac
 	done
 
@@ -2515,16 +3504,16 @@ static const void *lt_preloaded_setup()
 	case $host in
 	*cygwin* | *mingw* | *cegcc* )
 	  if test -f "$output_objdir/$my_outputname.def"; then
-	    compile_command=`$ECHO "X$compile_command" | $Xsed -e "s%@SYMFILE@%$output_objdir/$my_outputname.def $symfileobj%"`
-	    finalize_command=`$ECHO "X$finalize_command" | $Xsed -e "s%@SYMFILE@%$output_objdir/$my_outputname.def $symfileobj%"`
+	    compile_command=`$ECHO "$compile_command" | $SED "s%@SYMFILE@%$output_objdir/$my_outputname.def $symfileobj%"`
+	    finalize_command=`$ECHO "$finalize_command" | $SED "s%@SYMFILE@%$output_objdir/$my_outputname.def $symfileobj%"`
 	  else
-	    compile_command=`$ECHO "X$compile_command" | $Xsed -e "s%@SYMFILE@%$symfileobj%"`
-	    finalize_command=`$ECHO "X$finalize_command" | $Xsed -e "s%@SYMFILE@%$symfileobj%"`
+	    compile_command=`$ECHO "$compile_command" | $SED "s%@SYMFILE@%$symfileobj%"`
+	    finalize_command=`$ECHO "$finalize_command" | $SED "s%@SYMFILE@%$symfileobj%"`
 	  fi
 	  ;;
 	*)
-	  compile_command=`$ECHO "X$compile_command" | $Xsed -e "s%@SYMFILE@%$symfileobj%"`
-	  finalize_command=`$ECHO "X$finalize_command" | $Xsed -e "s%@SYMFILE@%$symfileobj%"`
+	  compile_command=`$ECHO "$compile_command" | $SED "s%@SYMFILE@%$symfileobj%"`
+	  finalize_command=`$ECHO "$finalize_command" | $SED "s%@SYMFILE@%$symfileobj%"`
 	  ;;
 	esac
 	;;
@@ -2538,8 +3527,8 @@ static const void *lt_preloaded_setup()
       # really was required.
 
       # Nullify the symbol file.
-      compile_command=`$ECHO "X$compile_command" | $Xsed -e "s% @SYMFILE@%%"`
-      finalize_command=`$ECHO "X$finalize_command" | $Xsed -e "s% @SYMFILE@%%"`
+      compile_command=`$ECHO "$compile_command" | $SED "s% @SYMFILE@%%"`
+      finalize_command=`$ECHO "$finalize_command" | $SED "s% @SYMFILE@%%"`
     fi
 }
 
@@ -2549,6 +3538,7 @@ static const void *lt_preloaded_setup()
 # Need a lot of goo to handle *both* DLLs and import libs
 # Has to be a shell function in order to 'eat' the argument
 # that is supplied when $file_magic_command is called.
+# Despite the name, also deal with 64 bit binaries.
 func_win32_libid ()
 {
   $opt_debug
@@ -2559,9 +3549,11 @@ func_win32_libid ()
     win32_libid_type="x86 archive import"
     ;;
   *ar\ archive*) # could be an import, or static
+    # Keep the egrep pattern in sync with the one in _LT_CHECK_MAGIC_METHOD.
     if eval $OBJDUMP -f $1 | $SED -e '10q' 2>/dev/null |
-       $EGREP 'file format pe-i386(.*architecture: i386)?' >/dev/null ; then
-      win32_nmres=`eval $NM -f posix -A $1 |
+       $EGREP 'file format (pei*-i386(.*architecture: i386)?|pe-arm-wince|pe-x86-64)' >/dev/null; then
+      func_to_tool_file "$1" func_convert_file_msys_to_w32
+      win32_nmres=`eval $NM -f posix -A \"$func_to_tool_file_result\" |
 	$SED -n -e '
 	    1,100{
 		/ I /{
@@ -2590,6 +3582,131 @@ func_win32_libid ()
   $ECHO "$win32_libid_type"
 }
 
+# func_cygming_dll_for_implib ARG
+#
+# Platform-specific function to extract the
+# name of the DLL associated with the specified
+# import library ARG.
+# Invoked by eval'ing the libtool variable
+#    $sharedlib_from_linklib_cmd
+# Result is available in the variable
+#    $sharedlib_from_linklib_result
+func_cygming_dll_for_implib ()
+{
+  $opt_debug
+  sharedlib_from_linklib_result=`$DLLTOOL --identify-strict --identify "$1"`
+}
+
+# func_cygming_dll_for_implib_fallback_core SECTION_NAME LIBNAMEs
+#
+# The is the core of a fallback implementation of a
+# platform-specific function to extract the name of the
+# DLL associated with the specified import library LIBNAME.
+#
+# SECTION_NAME is either .idata$6 or .idata$7, depending
+# on the platform and compiler that created the implib.
+#
+# Echos the name of the DLL associated with the
+# specified import library.
+func_cygming_dll_for_implib_fallback_core ()
+{
+  $opt_debug
+  match_literal=`$ECHO "$1" | $SED "$sed_make_literal_regex"`
+  $OBJDUMP -s --section "$1" "$2" 2>/dev/null |
+    $SED '/^Contents of section '"$match_literal"':/{
+      # Place marker at beginning of archive member dllname section
+      s/.*/====MARK====/
+      p
+      d
+    }
+    # These lines can sometimes be longer than 43 characters, but
+    # are always uninteresting
+    /:[	 ]*file format pe[i]\{,1\}-/d
+    /^In archive [^:]*:/d
+    # Ensure marker is printed
+    /^====MARK====/p
+    # Remove all lines with less than 43 characters
+    /^.\{43\}/!d
+    # From remaining lines, remove first 43 characters
+    s/^.\{43\}//' |
+    $SED -n '
+      # Join marker and all lines until next marker into a single line
+      /^====MARK====/ b para
+      H
+      $ b para
+      b
+      :para
+      x
+      s/\n//g
+      # Remove the marker
+      s/^====MARK====//
+      # Remove trailing dots and whitespace
+      s/[\. \t]*$//
+      # Print
+      /./p' |
+    # we now have a list, one entry per line, of the stringified
+    # contents of the appropriate section of all members of the
+    # archive which possess that section. Heuristic: eliminate
+    # all those which have a first or second character that is
+    # a '.' (that is, objdump's representation of an unprintable
+    # character.) This should work for all archives with less than
+    # 0x302f exports -- but will fail for DLLs whose name actually
+    # begins with a literal '.' or a single character followed by
+    # a '.'.
+    #
+    # Of those that remain, print the first one.
+    $SED -e '/^\./d;/^.\./d;q'
+}
+
+# func_cygming_gnu_implib_p ARG
+# This predicate returns with zero status (TRUE) if
+# ARG is a GNU/binutils-style import library. Returns
+# with nonzero status (FALSE) otherwise.
+func_cygming_gnu_implib_p ()
+{
+  $opt_debug
+  func_to_tool_file "$1" func_convert_file_msys_to_w32
+  func_cygming_gnu_implib_tmp=`$NM "$func_to_tool_file_result" | eval "$global_symbol_pipe" | $EGREP ' (_head_[A-Za-z0-9_]+_[ad]l*|[A-Za-z0-9_]+_[ad]l*_iname)$'`
+  test -n "$func_cygming_gnu_implib_tmp"
+}
+
+# func_cygming_ms_implib_p ARG
+# This predicate returns with zero status (TRUE) if
+# ARG is an MS-style import library. Returns
+# with nonzero status (FALSE) otherwise.
+func_cygming_ms_implib_p ()
+{
+  $opt_debug
+  func_to_tool_file "$1" func_convert_file_msys_to_w32
+  func_cygming_ms_implib_tmp=`$NM "$func_to_tool_file_result" | eval "$global_symbol_pipe" | $GREP '_NULL_IMPORT_DESCRIPTOR'`
+  test -n "$func_cygming_ms_implib_tmp"
+}
+
+# func_cygming_dll_for_implib_fallback ARG
+# Platform-specific function to extract the
+# name of the DLL associated with the specified
+# import library ARG.
+#
+# This fallback implementation is for use when $DLLTOOL
+# does not support the --identify-strict option.
+# Invoked by eval'ing the libtool variable
+#    $sharedlib_from_linklib_cmd
+# Result is available in the variable
+#    $sharedlib_from_linklib_result
+func_cygming_dll_for_implib_fallback ()
+{
+  $opt_debug
+  if func_cygming_gnu_implib_p "$1" ; then
+    # binutils import library
+    sharedlib_from_linklib_result=`func_cygming_dll_for_implib_fallback_core '.idata$7' "$1"`
+  elif func_cygming_ms_implib_p "$1" ; then
+    # ms-generated import library
+    sharedlib_from_linklib_result=`func_cygming_dll_for_implib_fallback_core '.idata$6' "$1"`
+  else
+    # unknown
+    sharedlib_from_linklib_result=""
+  fi
+}
 
 
 # func_extract_an_archive dir oldlib
@@ -2598,7 +3715,18 @@ func_extract_an_archive ()
     $opt_debug
     f_ex_an_ar_dir="$1"; shift
     f_ex_an_ar_oldlib="$1"
-    func_show_eval "(cd \$f_ex_an_ar_dir && $AR x \"\$f_ex_an_ar_oldlib\")" 'exit $?'
+    if test "$lock_old_archive_extraction" = yes; then
+      lockfile=$f_ex_an_ar_oldlib.lock
+      until $opt_dry_run || ln "$progpath" "$lockfile" 2>/dev/null; do
+	func_echo "Waiting for $lockfile to be removed"
+	sleep 2
+      done
+    fi
+    func_show_eval "(cd \$f_ex_an_ar_dir && $AR x \"\$f_ex_an_ar_oldlib\")" \
+		   'stat=$?; rm -f "$lockfile"; exit $stat'
+    if test "$lock_old_archive_extraction" = yes; then
+      $opt_dry_run || rm -f "$lockfile"
+    fi
     if ($AR t "$f_ex_an_ar_oldlib" | sort | sort -uc >/dev/null 2>&1); then
      :
     else
@@ -2669,7 +3797,7 @@ func_extract_archives ()
 	    darwin_file=
 	    darwin_files=
 	    for darwin_file in $darwin_filelist; do
-	      darwin_files=`find unfat-$$ -name $darwin_file -print | $NL2SP`
+	      darwin_files=`find unfat-$$ -name $darwin_file -print | sort | $NL2SP`
 	      $LIPO -create -output "$darwin_file" $darwin_files
 	    done # $darwin_filelist
 	    $RM -rf unfat-$$
@@ -2684,25 +3812,30 @@ func_extract_archives ()
         func_extract_an_archive "$my_xdir" "$my_xabs"
 	;;
       esac
-      my_oldobjs="$my_oldobjs "`find $my_xdir -name \*.$objext -print -o -name \*.lo -print | $NL2SP`
+      my_oldobjs="$my_oldobjs "`find $my_xdir -name \*.$objext -print -o -name \*.lo -print | sort | $NL2SP`
     done
 
     func_extract_archives_result="$my_oldobjs"
 }
 
 
-
-# func_emit_wrapper_part1 [arg=no]
+# func_emit_wrapper [arg=no]
 #
-# Emit the first part of a libtool wrapper script on stdout.
-# For more information, see the description associated with
-# func_emit_wrapper(), below.
-func_emit_wrapper_part1 ()
-{
-	func_emit_wrapper_part1_arg1=no
-	if test -n "$1" ; then
-	  func_emit_wrapper_part1_arg1=$1
-	fi
+# Emit a libtool wrapper script on stdout.
+# Don't directly open a file because we may want to
+# incorporate the script contents within a cygwin/mingw
+# wrapper executable.  Must ONLY be called from within
+# func_mode_link because it depends on a number of variables
+# set therein.
+#
+# ARG is the value that the WRAPPER_SCRIPT_BELONGS_IN_OBJDIR
+# variable will take.  If 'yes', then the emitted script
+# will assume that the directory in which it is stored is
+# the $objdir directory.  This is a cygwin/mingw-specific
+# behavior.
+func_emit_wrapper ()
+{
+	func_emit_wrapper_arg1=${1-no}
 
 	$ECHO "\
 #! $SHELL
@@ -2718,7 +3851,6 @@ func_emit_wrapper_part1 ()
 
 # Sed substitution that helps us do robust quoting.  It backslashifies
 # metacharacters that are still active within double-quoted strings.
-Xsed='${SED} -e 1s/^X//'
 sed_quote_subst='$sed_quote_subst'
 
 # Be Bourne compatible
@@ -2749,31 +3881,135 @@ if test \"\$libtool_install_magic\" = \"
 else
   # When we are sourced in execute mode, \$file and \$ECHO are already set.
   if test \"\$libtool_execute_magic\" != \"$magic\"; then
-    ECHO=\"$qecho\"
-    file=\"\$0\"
-    # Make sure echo works.
-    if test \"X\$1\" = X--no-reexec; then
-      # Discard the --no-reexec flag, and continue.
-      shift
-    elif test \"X\`{ \$ECHO '\t'; } 2>/dev/null\`\" = 'X\t'; then
-      # Yippee, \$ECHO works!
-      :
-    else
-      # Restart under the correct shell, and then maybe \$ECHO will work.
-      exec $SHELL \"\$0\" --no-reexec \${1+\"\$@\"}
-    fi
-  fi\
+    file=\"\$0\""
+
+    qECHO=`$ECHO "$ECHO" | $SED "$sed_quote_subst"`
+    $ECHO "\
+
+# A function that is used when there is no print builtin or printf.
+func_fallback_echo ()
+{
+  eval 'cat <<_LTECHO_EOF
+\$1
+_LTECHO_EOF'
+}
+    ECHO=\"$qECHO\"
+  fi
+
+# Very basic option parsing. These options are (a) specific to
+# the libtool wrapper, (b) are identical between the wrapper
+# /script/ and the wrapper /executable/ which is used only on
+# windows platforms, and (c) all begin with the string "--lt-"
+# (application programs are unlikely to have options which match
+# this pattern).
+#
+# There are only two supported options: --lt-debug and
+# --lt-dump-script. There is, deliberately, no --lt-help.
+#
+# The first argument to this parsing function should be the
+# script's $0 value, followed by "$@".
+lt_option_debug=
+func_parse_lt_options ()
+{
+  lt_script_arg0=\$0
+  shift
+  for lt_opt
+  do
+    case \"\$lt_opt\" in
+    --lt-debug) lt_option_debug=1 ;;
+    --lt-dump-script)
+        lt_dump_D=\`\$ECHO \"X\$lt_script_arg0\" | $SED -e 's/^X//' -e 's%/[^/]*$%%'\`
+        test \"X\$lt_dump_D\" = \"X\$lt_script_arg0\" && lt_dump_D=.
+        lt_dump_F=\`\$ECHO \"X\$lt_script_arg0\" | $SED -e 's/^X//' -e 's%^.*/%%'\`
+        cat \"\$lt_dump_D/\$lt_dump_F\"
+        exit 0
+      ;;
+    --lt-*)
+        \$ECHO \"Unrecognized --lt- option: '\$lt_opt'\" 1>&2
+        exit 1
+      ;;
+    esac
+  done
+
+  # Print the debug banner immediately:
+  if test -n \"\$lt_option_debug\"; then
+    echo \"${outputname}:${output}:\${LINENO}: libtool wrapper (GNU $PACKAGE$TIMESTAMP) $VERSION\" 1>&2
+  fi
+}
+
+# Used when --lt-debug. Prints its arguments to stdout
+# (redirection is the responsibility of the caller)
+func_lt_dump_args ()
+{
+  lt_dump_args_N=1;
+  for lt_arg
+  do
+    \$ECHO \"${outputname}:${output}:\${LINENO}: newargv[\$lt_dump_args_N]: \$lt_arg\"
+    lt_dump_args_N=\`expr \$lt_dump_args_N + 1\`
+  done
+}
+
+# Core function for launching the target application
+func_exec_program_core ()
+{
 "
-	$ECHO "\
+  case $host in
+  # Backslashes separate directories on plain windows
+  *-*-mingw | *-*-os2* | *-cegcc*)
+    $ECHO "\
+      if test -n \"\$lt_option_debug\"; then
+        \$ECHO \"${outputname}:${output}:\${LINENO}: newargv[0]: \$progdir\\\\\$program\" 1>&2
+        func_lt_dump_args \${1+\"\$@\"} 1>&2
+      fi
+      exec \"\$progdir\\\\\$program\" \${1+\"\$@\"}
+"
+    ;;
+
+  *)
+    $ECHO "\
+      if test -n \"\$lt_option_debug\"; then
+        \$ECHO \"${outputname}:${output}:\${LINENO}: newargv[0]: \$progdir/\$program\" 1>&2
+        func_lt_dump_args \${1+\"\$@\"} 1>&2
+      fi
+      exec \"\$progdir/\$program\" \${1+\"\$@\"}
+"
+    ;;
+  esac
+  $ECHO "\
+      \$ECHO \"\$0: cannot exec \$program \$*\" 1>&2
+      exit 1
+}
+
+# A function to encapsulate launching the target application
+# Strips options in the --lt-* namespace from \$@ and
+# launches target application with the remaining arguments.
+func_exec_program ()
+{
+  case \" \$* \" in
+  *\\ --lt-*)
+    for lt_wr_arg
+    do
+      case \$lt_wr_arg in
+      --lt-*) ;;
+      *) set x \"\$@\" \"\$lt_wr_arg\"; shift;;
+      esac
+      shift
+    done ;;
+  esac
+  func_exec_program_core \${1+\"\$@\"}
+}
+
+  # Parse options
+  func_parse_lt_options \"\$0\" \${1+\"\$@\"}
 
   # Find the directory that this script lives in.
-  thisdir=\`\$ECHO \"X\$file\" | \$Xsed -e 's%/[^/]*$%%'\`
+  thisdir=\`\$ECHO \"\$file\" | $SED 's%/[^/]*$%%'\`
   test \"x\$thisdir\" = \"x\$file\" && thisdir=.
 
   # Follow symbolic links until we get to the real thisdir.
-  file=\`ls -ld \"\$file\" | ${SED} -n 's/.*-> //p'\`
+  file=\`ls -ld \"\$file\" | $SED -n 's/.*-> //p'\`
   while test -n \"\$file\"; do
-    destdir=\`\$ECHO \"X\$file\" | \$Xsed -e 's%/[^/]*\$%%'\`
+    destdir=\`\$ECHO \"\$file\" | $SED 's%/[^/]*\$%%'\`
 
     # If there was a directory component, then change thisdir.
     if test \"x\$destdir\" != \"x\$file\"; then
@@ -2783,30 +4019,13 @@ else
       esac
     fi
 
-    file=\`\$ECHO \"X\$file\" | \$Xsed -e 's%^.*/%%'\`
-    file=\`ls -ld \"\$thisdir/\$file\" | ${SED} -n 's/.*-> //p'\`
+    file=\`\$ECHO \"\$file\" | $SED 's%^.*/%%'\`
+    file=\`ls -ld \"\$thisdir/\$file\" | $SED -n 's/.*-> //p'\`
   done
-"
-}
-# end: func_emit_wrapper_part1
-
-# func_emit_wrapper_part2 [arg=no]
-#
-# Emit the second part of a libtool wrapper script on stdout.
-# For more information, see the description associated with
-# func_emit_wrapper(), below.
-func_emit_wrapper_part2 ()
-{
-	func_emit_wrapper_part2_arg1=no
-	if test -n "$1" ; then
-	  func_emit_wrapper_part2_arg1=$1
-	fi
-
-	$ECHO "\
 
   # Usually 'no', except on cygwin/mingw when embedded into
   # the cwrapper.
-  WRAPPER_SCRIPT_BELONGS_IN_OBJDIR=$func_emit_wrapper_part2_arg1
+  WRAPPER_SCRIPT_BELONGS_IN_OBJDIR=$func_emit_wrapper_arg1
   if test \"\$WRAPPER_SCRIPT_BELONGS_IN_OBJDIR\" = \"yes\"; then
     # special case for '.'
     if test \"\$thisdir\" = \".\"; then
@@ -2814,7 +4033,7 @@ func_emit_wrapper_part2 ()
     fi
     # remove .libs from thisdir
     case \"\$thisdir\" in
-    *[\\\\/]$objdir ) thisdir=\`\$ECHO \"X\$thisdir\" | \$Xsed -e 's%[\\\\/][^\\\\/]*$%%'\` ;;
+    *[\\\\/]$objdir ) thisdir=\`\$ECHO \"\$thisdir\" | $SED 's%[\\\\/][^\\\\/]*$%%'\` ;;
     $objdir )   thisdir=. ;;
     esac
   fi
@@ -2869,6 +4088,18 @@ func_emit_wrapper_part2 ()
 
   if test -f \"\$progdir/\$program\"; then"
 
+	# fixup the dll searchpath if we need to.
+	#
+	# Fix the DLL searchpath if we need to.  Do this before prepending
+	# to shlibpath, because on Windows, both are PATH and uninstalled
+	# libraries must come first.
+	if test -n "$dllsearchpath"; then
+	  $ECHO "\
+    # Add the dll search path components to the executable PATH
+    PATH=$dllsearchpath:\$PATH
+"
+	fi
+
 	# Export our shlibpath_var if we have one.
 	if test "$shlibpath_overrides_runpath" = yes && test -n "$shlibpath_var" && test -n "$temp_rpath"; then
 	  $ECHO "\
@@ -2877,253 +4108,28 @@ func_emit_wrapper_part2 ()
 
     # Some systems cannot cope with colon-terminated $shlibpath_var
     # The second colon is a workaround for a bug in BeOS R4 sed
-    $shlibpath_var=\`\$ECHO \"X\$$shlibpath_var\" | \$Xsed -e 's/::*\$//'\`
+    $shlibpath_var=\`\$ECHO \"\$$shlibpath_var\" | $SED 's/::*\$//'\`
 
     export $shlibpath_var
 "
 	fi
 
-	# fixup the dll searchpath if we need to.
-	if test -n "$dllsearchpath"; then
-	  $ECHO "\
-    # Add the dll search path components to the executable PATH
-    PATH=$dllsearchpath:\$PATH
-"
-	fi
-
 	$ECHO "\
     if test \"\$libtool_execute_magic\" != \"$magic\"; then
       # Run the actual program with our arguments.
-"
-	case $host in
-	# Backslashes separate directories on plain windows
-	*-*-mingw | *-*-os2* | *-cegcc*)
-	  $ECHO "\
-      exec \"\$progdir\\\\\$program\" \${1+\"\$@\"}
-"
-	  ;;
-
-	*)
-	  $ECHO "\
-      exec \"\$progdir/\$program\" \${1+\"\$@\"}
-"
-	  ;;
-	esac
-	$ECHO "\
-      \$ECHO \"\$0: cannot exec \$program \$*\" 1>&2
-      exit 1
+      func_exec_program \${1+\"\$@\"}
     fi
   else
     # The program doesn't exist.
     \$ECHO \"\$0: error: \\\`\$progdir/\$program' does not exist\" 1>&2
     \$ECHO \"This script is just a wrapper for \$program.\" 1>&2
-    $ECHO \"See the $PACKAGE documentation for more information.\" 1>&2
+    \$ECHO \"See the $PACKAGE documentation for more information.\" 1>&2
     exit 1
   fi
 fi\
 "
 }
-# end: func_emit_wrapper_part2
-
-
-# func_emit_wrapper [arg=no]
-#
-# Emit a libtool wrapper script on stdout.
-# Don't directly open a file because we may want to
-# incorporate the script contents within a cygwin/mingw
-# wrapper executable.  Must ONLY be called from within
-# func_mode_link because it depends on a number of variables
-# set therein.
-#
-# ARG is the value that the WRAPPER_SCRIPT_BELONGS_IN_OBJDIR
-# variable will take.  If 'yes', then the emitted script
-# will assume that the directory in which it is stored is
-# the $objdir directory.  This is a cygwin/mingw-specific
-# behavior.
-func_emit_wrapper ()
-{
-	func_emit_wrapper_arg1=no
-	if test -n "$1" ; then
-	  func_emit_wrapper_arg1=$1
-	fi
-
-	# split this up so that func_emit_cwrapperexe_src
-	# can call each part independently.
-	func_emit_wrapper_part1 "${func_emit_wrapper_arg1}"
-	func_emit_wrapper_part2 "${func_emit_wrapper_arg1}"
-}
-
-
-# func_to_host_path arg
-#
-# Convert paths to host format when used with build tools.
-# Intended for use with "native" mingw (where libtool itself
-# is running under the msys shell), or in the following cross-
-# build environments:
-#    $build          $host
-#    mingw (msys)    mingw  [e.g. native]
-#    cygwin          mingw
-#    *nix + wine     mingw
-# where wine is equipped with the `winepath' executable.
-# In the native mingw case, the (msys) shell automatically
-# converts paths for any non-msys applications it launches,
-# but that facility isn't available from inside the cwrapper.
-# Similar accommodations are necessary for $host mingw and
-# $build cygwin.  Calling this function does no harm for other
-# $host/$build combinations not listed above.
-#
-# ARG is the path (on $build) that should be converted to
-# the proper representation for $host. The result is stored
-# in $func_to_host_path_result.
-func_to_host_path ()
-{
-  func_to_host_path_result="$1"
-  if test -n "$1" ; then
-    case $host in
-      *mingw* )
-        lt_sed_naive_backslashify='s|\\\\*|\\|g;s|/|\\|g;s|\\|\\\\|g'
-        case $build in
-          *mingw* ) # actually, msys
-            # awkward: cmd appends spaces to result
-            lt_sed_strip_trailing_spaces="s/[ ]*\$//"
-            func_to_host_path_tmp1=`( cmd //c echo "$1" |\
-              $SED -e "$lt_sed_strip_trailing_spaces" ) 2>/dev/null || echo ""`
-            func_to_host_path_result=`echo "$func_to_host_path_tmp1" |\
-              $SED -e "$lt_sed_naive_backslashify"`
-            ;;
-          *cygwin* )
-            func_to_host_path_tmp1=`cygpath -w "$1"`
-            func_to_host_path_result=`echo "$func_to_host_path_tmp1" |\
-              $SED -e "$lt_sed_naive_backslashify"`
-            ;;
-          * )
-            # Unfortunately, winepath does not exit with a non-zero
-            # error code, so we are forced to check the contents of
-            # stdout. On the other hand, if the command is not
-            # found, the shell will set an exit code of 127 and print
-            # *an error message* to stdout. So we must check for both
-            # error code of zero AND non-empty stdout, which explains
-            # the odd construction:
-            func_to_host_path_tmp1=`winepath -w "$1" 2>/dev/null`
-            if test "$?" -eq 0 && test -n "${func_to_host_path_tmp1}"; then
-              func_to_host_path_result=`echo "$func_to_host_path_tmp1" |\
-                $SED -e "$lt_sed_naive_backslashify"`
-            else
-              # Allow warning below.
-              func_to_host_path_result=""
-            fi
-            ;;
-        esac
-        if test -z "$func_to_host_path_result" ; then
-          func_error "Could not determine host path corresponding to"
-          func_error "  '$1'"
-          func_error "Continuing, but uninstalled executables may not work."
-          # Fallback:
-          func_to_host_path_result="$1"
-        fi
-        ;;
-    esac
-  fi
-}
-# end: func_to_host_path
-
-# func_to_host_pathlist arg
-#
-# Convert pathlists to host format when used with build tools.
-# See func_to_host_path(), above. This function supports the
-# following $build/$host combinations (but does no harm for
-# combinations not listed here):
-#    $build          $host
-#    mingw (msys)    mingw  [e.g. native]
-#    cygwin          mingw
-#    *nix + wine     mingw
-#
-# Path separators are also converted from $build format to
-# $host format. If ARG begins or ends with a path separator
-# character, it is preserved (but converted to $host format)
-# on output.
-#
-# ARG is a pathlist (on $build) that should be converted to
-# the proper representation on $host. The result is stored
-# in $func_to_host_pathlist_result.
-func_to_host_pathlist ()
-{
-  func_to_host_pathlist_result="$1"
-  if test -n "$1" ; then
-    case $host in
-      *mingw* )
-        lt_sed_naive_backslashify='s|\\\\*|\\|g;s|/|\\|g;s|\\|\\\\|g'
-        # Remove leading and trailing path separator characters from
-        # ARG. msys behavior is inconsistent here, cygpath turns them
-        # into '.;' and ';.', and winepath ignores them completely.
-        func_to_host_pathlist_tmp2="$1"
-        # Once set for this call, this variable should not be
-        # reassigned. It is used in tha fallback case.
-        func_to_host_pathlist_tmp1=`echo "$func_to_host_pathlist_tmp2" |\
-          $SED -e 's|^:*||' -e 's|:*$||'`
-        case $build in
-          *mingw* ) # Actually, msys.
-            # Awkward: cmd appends spaces to result.
-            lt_sed_strip_trailing_spaces="s/[ ]*\$//"
-            func_to_host_pathlist_tmp2=`( cmd //c echo "$func_to_host_pathlist_tmp1" |\
-              $SED -e "$lt_sed_strip_trailing_spaces" ) 2>/dev/null || echo ""`
-            func_to_host_pathlist_result=`echo "$func_to_host_pathlist_tmp2" |\
-              $SED -e "$lt_sed_naive_backslashify"`
-            ;;
-          *cygwin* )
-            func_to_host_pathlist_tmp2=`cygpath -w -p "$func_to_host_pathlist_tmp1"`
-            func_to_host_pathlist_result=`echo "$func_to_host_pathlist_tmp2" |\
-              $SED -e "$lt_sed_naive_backslashify"`
-            ;;
-          * )
-            # unfortunately, winepath doesn't convert pathlists
-            func_to_host_pathlist_result=""
-            func_to_host_pathlist_oldIFS=$IFS
-            IFS=:
-            for func_to_host_pathlist_f in $func_to_host_pathlist_tmp1 ; do
-              IFS=$func_to_host_pathlist_oldIFS
-              if test -n "$func_to_host_pathlist_f" ; then
-                func_to_host_path "$func_to_host_pathlist_f"
-                if test -n "$func_to_host_path_result" ; then
-                  if test -z "$func_to_host_pathlist_result" ; then
-                    func_to_host_pathlist_result="$func_to_host_path_result"
-                  else
-                    func_to_host_pathlist_result="$func_to_host_pathlist_result;$func_to_host_path_result"
-                  fi
-                fi
-              fi
-              IFS=:
-            done
-            IFS=$func_to_host_pathlist_oldIFS
-            ;;
-        esac
-        if test -z "$func_to_host_pathlist_result" ; then
-          func_error "Could not determine the host path(s) corresponding to"
-          func_error "  '$1'"
-          func_error "Continuing, but uninstalled executables may not work."
-          # Fallback. This may break if $1 contains DOS-style drive
-          # specifications. The fix is not to complicate the expression
-          # below, but for the user to provide a working wine installation
-          # with winepath so that path translation in the cross-to-mingw
-          # case works properly.
-          lt_replace_pathsep_nix_to_dos="s|:|;|g"
-          func_to_host_pathlist_result=`echo "$func_to_host_pathlist_tmp1" |\
-            $SED -e "$lt_replace_pathsep_nix_to_dos"`
-        fi
-        # Now, add the leading and trailing path separators back
-        case "$1" in
-          :* ) func_to_host_pathlist_result=";$func_to_host_pathlist_result"
-            ;;
-        esac
-        case "$1" in
-          *: ) func_to_host_pathlist_result="$func_to_host_pathlist_result;"
-            ;;
-        esac
-        ;;
-    esac
-  fi
-}
-# end: func_to_host_pathlist
+
 
 # func_emit_cwrapperexe_src
 # emit the source code for a wrapper executable on stdout
@@ -3141,31 +4147,23 @@ func_emit_cwrapperexe_src ()
 
    This wrapper executable should never be moved out of the build directory.
    If it is, it will not operate correctly.
-
-   Currently, it simply execs the wrapper *script* "$SHELL $output",
-   but could eventually absorb all of the scripts functionality and
-   exec $objdir/$outputname directly.
 */
 EOF
 	    cat <<"EOF"
+#ifdef _MSC_VER
+# define _CRT_SECURE_NO_DEPRECATE 1
+#endif
 #include <stdio.h>
 #include <stdlib.h>
 #ifdef _MSC_VER
 # include <direct.h>
 # include <process.h>
 # include <io.h>
-# define setmode _setmode
 #else
 # include <unistd.h>
 # include <stdint.h>
 # ifdef __CYGWIN__
 #  include <io.h>
-#  define HAVE_SETENV
-#  ifdef __STRICT_ANSI__
-char *realpath (const char *, char *);
-int putenv (char *);
-int setenv (const char *, const char *, int);
-#  endif
 # endif
 #endif
 #include <malloc.h>
@@ -3177,6 +4175,44 @@ int setenv (const char *, const char *,
 #include <fcntl.h>
 #include <sys/stat.h>
 
+/* declarations of non-ANSI functions */
+#if defined(__MINGW32__)
+# ifdef __STRICT_ANSI__
+int _putenv (const char *);
+# endif
+#elif defined(__CYGWIN__)
+# ifdef __STRICT_ANSI__
+char *realpath (const char *, char *);
+int putenv (char *);
+int setenv (const char *, const char *, int);
+# endif
+/* #elif defined (other platforms) ... */
+#endif
+
+/* portability defines, excluding path handling macros */
+#if defined(_MSC_VER)
+# define setmode _setmode
+# define stat    _stat
+# define chmod   _chmod
+# define getcwd  _getcwd
+# define putenv  _putenv
+# define S_IXUSR _S_IEXEC
+# ifndef _INTPTR_T_DEFINED
+#  define _INTPTR_T_DEFINED
+#  define intptr_t int
+# endif
+#elif defined(__MINGW32__)
+# define setmode _setmode
+# define stat    _stat
+# define chmod   _chmod
+# define getcwd  _getcwd
+# define putenv  _putenv
+#elif defined(__CYGWIN__)
+# define HAVE_SETENV
+# define FOPEN_WB "wb"
+/* #elif defined (other platforms) ... */
+#endif
+
 #if defined(PATH_MAX)
 # define LT_PATHMAX PATH_MAX
 #elif defined(MAXPATHLEN)
@@ -3192,14 +4228,7 @@ int setenv (const char *, const char *,
 # define S_IXGRP 0
 #endif
 
-#ifdef _MSC_VER
-# define S_IXUSR _S_IEXEC
-# define stat _stat
-# ifndef _INTPTR_T_DEFINED
-#  define intptr_t int
-# endif
-#endif
-
+/* path handling portability macros */
 #ifndef DIR_SEPARATOR
 # define DIR_SEPARATOR '/'
 # define PATH_SEPARATOR ':'
@@ -3230,10 +4259,6 @@ int setenv (const char *, const char *,
 # define IS_PATH_SEPARATOR(ch) ((ch) == PATH_SEPARATOR_2)
 #endif /* PATH_SEPARATOR_2 */
 
-#ifdef __CYGWIN__
-# define FOPEN_WB "wb"
-#endif
-
 #ifndef FOPEN_WB
 # define FOPEN_WB "w"
 #endif
@@ -3246,22 +4271,13 @@ int setenv (const char *, const char *,
   if (stale) { free ((void *) stale); stale = 0; } \
 } while (0)
 
-#undef LTWRAPPER_DEBUGPRINTF
-#if defined DEBUGWRAPPER
-# define LTWRAPPER_DEBUGPRINTF(args) ltwrapper_debugprintf args
-static void
-ltwrapper_debugprintf (const char *fmt, ...)
-{
-    va_list args;
-    va_start (args, fmt);
-    (void) vfprintf (stderr, fmt, args);
-    va_end (args);
-}
+#if defined(LT_DEBUGWRAPPER)
+static int lt_debug = 1;
 #else
-# define LTWRAPPER_DEBUGPRINTF(args)
+static int lt_debug = 0;
 #endif
 
-const char *program_name = NULL;
+const char *program_name = "libtool-wrapper"; /* in case xstrdup fails */
 
 void *xmalloc (size_t num);
 char *xstrdup (const char *string);
@@ -3271,41 +4287,27 @@ char *chase_symlinks (const char *pathsp
 int make_executable (const char *path);
 int check_executable (const char *path);
 char *strendzap (char *str, const char *pat);
-void lt_fatal (const char *message, ...);
+void lt_debugprintf (const char *file, int line, const char *fmt, ...);
+void lt_fatal (const char *file, int line, const char *message, ...);
+static const char *nonnull (const char *s);
+static const char *nonempty (const char *s);
 void lt_setenv (const char *name, const char *value);
 char *lt_extend_str (const char *orig_value, const char *add, int to_end);
-void lt_opt_process_env_set (const char *arg);
-void lt_opt_process_env_prepend (const char *arg);
-void lt_opt_process_env_append (const char *arg);
-int lt_split_name_value (const char *arg, char** name, char** value);
 void lt_update_exe_path (const char *name, const char *value);
 void lt_update_lib_path (const char *name, const char *value);
-
-static const char *script_text_part1 =
-EOF
-
-	    func_emit_wrapper_part1 yes |
-	        $SED -e 's/\([\\"]\)/\\\1/g' \
-	             -e 's/^/  "/' -e 's/$/\\n"/'
-	    echo ";"
-	    cat <<EOF
-
-static const char *script_text_part2 =
+char **prepare_spawn (char **argv);
+void lt_dump_script (FILE *f);
 EOF
-	    func_emit_wrapper_part2 yes |
-	        $SED -e 's/\([\\"]\)/\\\1/g' \
-	             -e 's/^/  "/' -e 's/$/\\n"/'
-	    echo ";"
 
 	    cat <<EOF
-const char * MAGIC_EXE = "$magic_exe";
+volatile const char * MAGIC_EXE = "$magic_exe";
 const char * LIB_PATH_VARNAME = "$shlibpath_var";
 EOF
 
 	    if test "$shlibpath_overrides_runpath" = yes && test -n "$shlibpath_var" && test -n "$temp_rpath"; then
-              func_to_host_pathlist "$temp_rpath"
+              func_to_host_path "$temp_rpath"
 	      cat <<EOF
-const char * LIB_PATH_VALUE   = "$func_to_host_pathlist_result";
+const char * LIB_PATH_VALUE   = "$func_to_host_path_result";
 EOF
 	    else
 	      cat <<"EOF"
@@ -3314,10 +4316,10 @@ EOF
 	    fi
 
 	    if test -n "$dllsearchpath"; then
-              func_to_host_pathlist "$dllsearchpath:"
+              func_to_host_path "$dllsearchpath:"
 	      cat <<EOF
 const char * EXE_PATH_VARNAME = "PATH";
-const char * EXE_PATH_VALUE   = "$func_to_host_pathlist_result";
+const char * EXE_PATH_VALUE   = "$func_to_host_path_result";
 EOF
 	    else
 	      cat <<"EOF"
@@ -3340,24 +4342,10 @@ EOF
 	    cat <<"EOF"
 
 #define LTWRAPPER_OPTION_PREFIX         "--lt-"
-#define LTWRAPPER_OPTION_PREFIX_LENGTH  5
 
-static const size_t opt_prefix_len         = LTWRAPPER_OPTION_PREFIX_LENGTH;
 static const char *ltwrapper_option_prefix = LTWRAPPER_OPTION_PREFIX;
-
 static const char *dumpscript_opt       = LTWRAPPER_OPTION_PREFIX "dump-script";
-
-static const size_t env_set_opt_len     = LTWRAPPER_OPTION_PREFIX_LENGTH + 7;
-static const char *env_set_opt          = LTWRAPPER_OPTION_PREFIX "env-set";
-  /* argument is putenv-style "foo=bar", value of foo is set to bar */
-
-static const size_t env_prepend_opt_len = LTWRAPPER_OPTION_PREFIX_LENGTH + 11;
-static const char *env_prepend_opt      = LTWRAPPER_OPTION_PREFIX "env-prepend";
-  /* argument is putenv-style "foo=bar", new value of foo is bar${foo} */
-
-static const size_t env_append_opt_len  = LTWRAPPER_OPTION_PREFIX_LENGTH + 10;
-static const char *env_append_opt       = LTWRAPPER_OPTION_PREFIX "env-append";
-  /* argument is putenv-style "foo=bar", new value of foo is ${foo}bar */
+static const char *debug_opt            = LTWRAPPER_OPTION_PREFIX "debug";
 
 int
 main (int argc, char *argv[])
@@ -3374,10 +4362,13 @@ main (int argc, char *argv[])
   int i;
 
   program_name = (char *) xstrdup (base_name (argv[0]));
-  LTWRAPPER_DEBUGPRINTF (("(main) argv[0]      : %s\n", argv[0]));
-  LTWRAPPER_DEBUGPRINTF (("(main) program_name : %s\n", program_name));
+  newargz = XMALLOC (char *, argc + 1);
 
-  /* very simple arg parsing; don't want to rely on getopt */
+  /* very simple arg parsing; don't want to rely on getopt
+   * also, copy all non cwrapper options to newargz, except
+   * argz[0], which is handled differently
+   */
+  newargc=0;
   for (i = 1; i < argc; i++)
     {
       if (strcmp (argv[i], dumpscript_opt) == 0)
@@ -3391,25 +4382,57 @@ EOF
 	      esac
 
 	    cat <<"EOF"
-	  printf ("%s", script_text_part1);
-	  printf ("%s", script_text_part2);
+	  lt_dump_script (stdout);
 	  return 0;
 	}
+      if (strcmp (argv[i], debug_opt) == 0)
+	{
+          lt_debug = 1;
+          continue;
+	}
+      if (strcmp (argv[i], ltwrapper_option_prefix) == 0)
+        {
+          /* however, if there is an option in the LTWRAPPER_OPTION_PREFIX
+             namespace, but it is not one of the ones we know about and
+             have already dealt with, above (inluding dump-script), then
+             report an error. Otherwise, targets might begin to believe
+             they are allowed to use options in the LTWRAPPER_OPTION_PREFIX
+             namespace. The first time any user complains about this, we'll
+             need to make LTWRAPPER_OPTION_PREFIX a configure-time option
+             or a configure.ac-settable value.
+           */
+          lt_fatal (__FILE__, __LINE__,
+		    "unrecognized %s option: '%s'",
+                    ltwrapper_option_prefix, argv[i]);
+        }
+      /* otherwise ... */
+      newargz[++newargc] = xstrdup (argv[i]);
     }
+  newargz[++newargc] = NULL;
+
+EOF
+	    cat <<EOF
+  /* The GNU banner must be the first non-error debug message */
+  lt_debugprintf (__FILE__, __LINE__, "libtool wrapper (GNU $PACKAGE$TIMESTAMP) $VERSION\n");
+EOF
+	    cat <<"EOF"
+  lt_debugprintf (__FILE__, __LINE__, "(main) argv[0]: %s\n", argv[0]);
+  lt_debugprintf (__FILE__, __LINE__, "(main) program_name: %s\n", program_name);
 
-  newargz = XMALLOC (char *, argc + 1);
   tmp_pathspec = find_executable (argv[0]);
   if (tmp_pathspec == NULL)
-    lt_fatal ("Couldn't find %s", argv[0]);
-  LTWRAPPER_DEBUGPRINTF (("(main) found exe (before symlink chase) at : %s\n",
-			  tmp_pathspec));
+    lt_fatal (__FILE__, __LINE__, "couldn't find %s", argv[0]);
+  lt_debugprintf (__FILE__, __LINE__,
+                  "(main) found exe (before symlink chase) at: %s\n",
+		  tmp_pathspec);
 
   actual_cwrapper_path = chase_symlinks (tmp_pathspec);
-  LTWRAPPER_DEBUGPRINTF (("(main) found exe (after symlink chase) at : %s\n",
-			  actual_cwrapper_path));
+  lt_debugprintf (__FILE__, __LINE__,
+                  "(main) found exe (after symlink chase) at: %s\n",
+		  actual_cwrapper_path);
   XFREE (tmp_pathspec);
 
-  actual_cwrapper_name = xstrdup( base_name (actual_cwrapper_path));
+  actual_cwrapper_name = xstrdup (base_name (actual_cwrapper_path));
   strendzap (actual_cwrapper_path, actual_cwrapper_name);
 
   /* wrapper name transforms */
@@ -3427,8 +4450,9 @@ EOF
   target_name = tmp_pathspec;
   tmp_pathspec = 0;
 
-  LTWRAPPER_DEBUGPRINTF (("(main) libtool target name: %s\n",
-			  target_name));
+  lt_debugprintf (__FILE__, __LINE__,
+		  "(main) libtool target name: %s\n",
+		  target_name);
 EOF
 
 	    cat <<EOF
@@ -3478,80 +4502,19 @@ EOF
 
   lt_setenv ("BIN_SH", "xpg4"); /* for Tru64 */
   lt_setenv ("DUALCASE", "1");  /* for MSK sh */
-  lt_update_lib_path (LIB_PATH_VARNAME, LIB_PATH_VALUE);
+  /* Update the DLL searchpath.  EXE_PATH_VALUE ($dllsearchpath) must
+     be prepended before (that is, appear after) LIB_PATH_VALUE ($temp_rpath)
+     because on Windows, both *_VARNAMEs are PATH but uninstalled
+     libraries must come first. */
   lt_update_exe_path (EXE_PATH_VARNAME, EXE_PATH_VALUE);
+  lt_update_lib_path (LIB_PATH_VARNAME, LIB_PATH_VALUE);
 
-  newargc=0;
-  for (i = 1; i < argc; i++)
-    {
-      if (strncmp (argv[i], env_set_opt, env_set_opt_len) == 0)
-        {
-          if (argv[i][env_set_opt_len] == '=')
-            {
-              const char *p = argv[i] + env_set_opt_len + 1;
-              lt_opt_process_env_set (p);
-            }
-          else if (argv[i][env_set_opt_len] == '\0' && i + 1 < argc)
-            {
-              lt_opt_process_env_set (argv[++i]); /* don't copy */
-            }
-          else
-            lt_fatal ("%s missing required argument", env_set_opt);
-          continue;
-        }
-      if (strncmp (argv[i], env_prepend_opt, env_prepend_opt_len) == 0)
-        {
-          if (argv[i][env_prepend_opt_len] == '=')
-            {
-              const char *p = argv[i] + env_prepend_opt_len + 1;
-              lt_opt_process_env_prepend (p);
-            }
-          else if (argv[i][env_prepend_opt_len] == '\0' && i + 1 < argc)
-            {
-              lt_opt_process_env_prepend (argv[++i]); /* don't copy */
-            }
-          else
-            lt_fatal ("%s missing required argument", env_prepend_opt);
-          continue;
-        }
-      if (strncmp (argv[i], env_append_opt, env_append_opt_len) == 0)
-        {
-          if (argv[i][env_append_opt_len] == '=')
-            {
-              const char *p = argv[i] + env_append_opt_len + 1;
-              lt_opt_process_env_append (p);
-            }
-          else if (argv[i][env_append_opt_len] == '\0' && i + 1 < argc)
-            {
-              lt_opt_process_env_append (argv[++i]); /* don't copy */
-            }
-          else
-            lt_fatal ("%s missing required argument", env_append_opt);
-          continue;
-        }
-      if (strncmp (argv[i], ltwrapper_option_prefix, opt_prefix_len) == 0)
-        {
-          /* however, if there is an option in the LTWRAPPER_OPTION_PREFIX
-             namespace, but it is not one of the ones we know about and
-             have already dealt with, above (inluding dump-script), then
-             report an error. Otherwise, targets might begin to believe
-             they are allowed to use options in the LTWRAPPER_OPTION_PREFIX
-             namespace. The first time any user complains about this, we'll
-             need to make LTWRAPPER_OPTION_PREFIX a configure-time option
-             or a configure.ac-settable value.
-           */
-          lt_fatal ("Unrecognized option in %s namespace: '%s'",
-                    ltwrapper_option_prefix, argv[i]);
-        }
-      /* otherwise ... */
-      newargz[++newargc] = xstrdup (argv[i]);
-    }
-  newargz[++newargc] = NULL;
-
-  LTWRAPPER_DEBUGPRINTF     (("(main) lt_argv_zero : %s\n", (lt_argv_zero ? lt_argv_zero : "<NULL>")));
+  lt_debugprintf (__FILE__, __LINE__, "(main) lt_argv_zero: %s\n",
+		  nonnull (lt_argv_zero));
   for (i = 0; i < newargc; i++)
     {
-      LTWRAPPER_DEBUGPRINTF (("(main) newargz[%d]   : %s\n", i, (newargz[i] ? newargz[i] : "<NULL>")));
+      lt_debugprintf (__FILE__, __LINE__, "(main) newargz[%d]: %s\n",
+		      i, nonnull (newargz[i]));
     }
 
 EOF
@@ -3560,11 +4523,14 @@ EOF
 	      mingw*)
 		cat <<"EOF"
   /* execv doesn't actually work on mingw as expected on unix */
+  newargz = prepare_spawn (newargz);
   rval = _spawnv (_P_WAIT, lt_argv_zero, (const char * const *) newargz);
   if (rval == -1)
     {
       /* failed to start process */
-      LTWRAPPER_DEBUGPRINTF (("(main) failed to launch target \"%s\": errno = %d\n", lt_argv_zero, errno));
+      lt_debugprintf (__FILE__, __LINE__,
+		      "(main) failed to launch target \"%s\": %s\n",
+		      lt_argv_zero, nonnull (strerror (errno)));
       return 127;
     }
   return rval;
@@ -3586,7 +4552,7 @@ xmalloc (size_t num)
 {
   void *p = (void *) malloc (num);
   if (!p)
-    lt_fatal ("Memory exhausted");
+    lt_fatal (__FILE__, __LINE__, "memory exhausted");
 
   return p;
 }
@@ -3620,8 +4586,8 @@ check_executable (const char *path)
 {
   struct stat st;
 
-  LTWRAPPER_DEBUGPRINTF (("(check_executable)  : %s\n",
-			  path ? (*path ? path : "EMPTY!") : "NULL!"));
+  lt_debugprintf (__FILE__, __LINE__, "(check_executable): %s\n",
+                  nonempty (path));
   if ((!path) || (!*path))
     return 0;
 
@@ -3638,8 +4604,8 @@ make_executable (const char *path)
   int rval = 0;
   struct stat st;
 
-  LTWRAPPER_DEBUGPRINTF (("(make_executable)   : %s\n",
-			  path ? (*path ? path : "EMPTY!") : "NULL!"));
+  lt_debugprintf (__FILE__, __LINE__, "(make_executable): %s\n",
+                  nonempty (path));
   if ((!path) || (!*path))
     return 0;
 
@@ -3665,8 +4631,8 @@ find_executable (const char *wrapper)
   int tmp_len;
   char *concat_name;
 
-  LTWRAPPER_DEBUGPRINTF (("(find_executable)   : %s\n",
-			  wrapper ? (*wrapper ? wrapper : "EMPTY!") : "NULL!"));
+  lt_debugprintf (__FILE__, __LINE__, "(find_executable): %s\n",
+                  nonempty (wrapper));
 
   if ((wrapper == NULL) || (*wrapper == '\0'))
     return NULL;
@@ -3719,7 +4685,8 @@ find_executable (const char *wrapper)
 		{
 		  /* empty path: current directory */
 		  if (getcwd (tmp, LT_PATHMAX) == NULL)
-		    lt_fatal ("getcwd failed");
+		    lt_fatal (__FILE__, __LINE__, "getcwd failed: %s",
+                              nonnull (strerror (errno)));
 		  tmp_len = strlen (tmp);
 		  concat_name =
 		    XMALLOC (char, tmp_len + 1 + strlen (wrapper) + 1);
@@ -3744,7 +4711,8 @@ find_executable (const char *wrapper)
     }
   /* Relative path | not found in path: prepend cwd */
   if (getcwd (tmp, LT_PATHMAX) == NULL)
-    lt_fatal ("getcwd failed");
+    lt_fatal (__FILE__, __LINE__, "getcwd failed: %s",
+              nonnull (strerror (errno)));
   tmp_len = strlen (tmp);
   concat_name = XMALLOC (char, tmp_len + 1 + strlen (wrapper) + 1);
   memcpy (concat_name, tmp, tmp_len);
@@ -3770,8 +4738,9 @@ chase_symlinks (const char *pathspec)
   int has_symlinks = 0;
   while (strlen (tmp_pathspec) && !has_symlinks)
     {
-      LTWRAPPER_DEBUGPRINTF (("checking path component for symlinks: %s\n",
-			      tmp_pathspec));
+      lt_debugprintf (__FILE__, __LINE__,
+		      "checking path component for symlinks: %s\n",
+		      tmp_pathspec);
       if (lstat (tmp_pathspec, &s) == 0)
 	{
 	  if (S_ISLNK (s.st_mode) != 0)
@@ -3793,8 +4762,9 @@ chase_symlinks (const char *pathspec)
 	}
       else
 	{
-	  char *errstr = strerror (errno);
-	  lt_fatal ("Error accessing file %s (%s)", tmp_pathspec, errstr);
+	  lt_fatal (__FILE__, __LINE__,
+		    "error accessing file \"%s\": %s",
+		    tmp_pathspec, nonnull (strerror (errno)));
 	}
     }
   XFREE (tmp_pathspec);
@@ -3807,7 +4777,8 @@ chase_symlinks (const char *pathspec)
   tmp_pathspec = realpath (pathspec, buf);
   if (tmp_pathspec == 0)
     {
-      lt_fatal ("Could not follow symlinks for %s", pathspec);
+      lt_fatal (__FILE__, __LINE__,
+		"could not follow symlinks for %s", pathspec);
     }
   return xstrdup (tmp_pathspec);
 #endif
@@ -3833,11 +4804,25 @@ strendzap (char *str, const char *pat)
   return str;
 }
 
+void
+lt_debugprintf (const char *file, int line, const char *fmt, ...)
+{
+  va_list args;
+  if (lt_debug)
+    {
+      (void) fprintf (stderr, "%s:%s:%d: ", program_name, file, line);
+      va_start (args, fmt);
+      (void) vfprintf (stderr, fmt, args);
+      va_end (args);
+    }
+}
+
 static void
-lt_error_core (int exit_status, const char *mode,
+lt_error_core (int exit_status, const char *file,
+	       int line, const char *mode,
 	       const char *message, va_list ap)
 {
-  fprintf (stderr, "%s: %s: ", program_name, mode);
+  fprintf (stderr, "%s:%s:%d: %s: ", program_name, file, line, mode);
   vfprintf (stderr, message, ap);
   fprintf (stderr, ".\n");
 
@@ -3846,20 +4831,32 @@ lt_error_core (int exit_status, const ch
 }
 
 void
-lt_fatal (const char *message, ...)
+lt_fatal (const char *file, int line, const char *message, ...)
 {
   va_list ap;
   va_start (ap, message);
-  lt_error_core (EXIT_FAILURE, "FATAL", message, ap);
+  lt_error_core (EXIT_FAILURE, file, line, "FATAL", message, ap);
   va_end (ap);
 }
 
+static const char *
+nonnull (const char *s)
+{
+  return s ? s : "(null)";
+}
+
+static const char *
+nonempty (const char *s)
+{
+  return (s && !*s) ? "(empty)" : nonnull (s);
+}
+
 void
 lt_setenv (const char *name, const char *value)
 {
-  LTWRAPPER_DEBUGPRINTF (("(lt_setenv) setting '%s' to '%s'\n",
-                          (name ? name : "<NULL>"),
-                          (value ? value : "<NULL>")));
+  lt_debugprintf (__FILE__, __LINE__,
+		  "(lt_setenv) setting '%s' to '%s'\n",
+                  nonnull (name), nonnull (value));
   {
 #ifdef HAVE_SETENV
     /* always make a copy, for consistency with !HAVE_SETENV */
@@ -3904,95 +4901,12 @@ lt_extend_str (const char *orig_value, c
   return new_value;
 }
 
-int
-lt_split_name_value (const char *arg, char** name, char** value)
-{
-  const char *p;
-  int len;
-  if (!arg || !*arg)
-    return 1;
-
-  p = strchr (arg, (int)'=');
-
-  if (!p)
-    return 1;
-
-  *value = xstrdup (++p);
-
-  len = strlen (arg) - strlen (*value);
-  *name = XMALLOC (char, len);
-  strncpy (*name, arg, len-1);
-  (*name)[len - 1] = '\0';
-
-  return 0;
-}
-
-void
-lt_opt_process_env_set (const char *arg)
-{
-  char *name = NULL;
-  char *value = NULL;
-
-  if (lt_split_name_value (arg, &name, &value) != 0)
-    {
-      XFREE (name);
-      XFREE (value);
-      lt_fatal ("bad argument for %s: '%s'", env_set_opt, arg);
-    }
-
-  lt_setenv (name, value);
-  XFREE (name);
-  XFREE (value);
-}
-
-void
-lt_opt_process_env_prepend (const char *arg)
-{
-  char *name = NULL;
-  char *value = NULL;
-  char *new_value = NULL;
-
-  if (lt_split_name_value (arg, &name, &value) != 0)
-    {
-      XFREE (name);
-      XFREE (value);
-      lt_fatal ("bad argument for %s: '%s'", env_prepend_opt, arg);
-    }
-
-  new_value = lt_extend_str (getenv (name), value, 0);
-  lt_setenv (name, new_value);
-  XFREE (new_value);
-  XFREE (name);
-  XFREE (value);
-}
-
-void
-lt_opt_process_env_append (const char *arg)
-{
-  char *name = NULL;
-  char *value = NULL;
-  char *new_value = NULL;
-
-  if (lt_split_name_value (arg, &name, &value) != 0)
-    {
-      XFREE (name);
-      XFREE (value);
-      lt_fatal ("bad argument for %s: '%s'", env_append_opt, arg);
-    }
-
-  new_value = lt_extend_str (getenv (name), value, 1);
-  lt_setenv (name, new_value);
-  XFREE (new_value);
-  XFREE (name);
-  XFREE (value);
-}
-
 void
 lt_update_exe_path (const char *name, const char *value)
 {
-  LTWRAPPER_DEBUGPRINTF (("(lt_update_exe_path) modifying '%s' by prepending '%s'\n",
-                          (name ? name : "<NULL>"),
-                          (value ? value : "<NULL>")));
+  lt_debugprintf (__FILE__, __LINE__,
+		  "(lt_update_exe_path) modifying '%s' by prepending '%s'\n",
+                  nonnull (name), nonnull (value));
 
   if (name && *name && value && *value)
     {
@@ -4011,9 +4925,9 @@ lt_update_exe_path (const char *name, co
 void
 lt_update_lib_path (const char *name, const char *value)
 {
-  LTWRAPPER_DEBUGPRINTF (("(lt_update_lib_path) modifying '%s' by prepending '%s'\n",
-                          (name ? name : "<NULL>"),
-                          (value ? value : "<NULL>")));
+  lt_debugprintf (__FILE__, __LINE__,
+		  "(lt_update_lib_path) modifying '%s' by prepending '%s'\n",
+                  nonnull (name), nonnull (value));
 
   if (name && *name && value && *value)
     {
@@ -4023,11 +4937,158 @@ lt_update_lib_path (const char *name, co
     }
 }
 
+EOF
+	    case $host_os in
+	      mingw*)
+		cat <<"EOF"
+
+/* Prepares an argument vector before calling spawn().
+   Note that spawn() does not by itself call the command interpreter
+     (getenv ("COMSPEC") != NULL ? getenv ("COMSPEC") :
+      ({ OSVERSIONINFO v; v.dwOSVersionInfoSize = sizeof(OSVERSIONINFO);
+         GetVersionEx(&v);
+         v.dwPlatformId == VER_PLATFORM_WIN32_NT;
+      }) ? "cmd.exe" : "command.com").
+   Instead it simply concatenates the arguments, separated by ' ', and calls
+   CreateProcess().  We must quote the arguments since Win32 CreateProcess()
+   interprets characters like ' ', '\t', '\\', '"' (but not '<' and '>') in a
+   special way:
+   - Space and tab are interpreted as delimiters. They are not treated as
+     delimiters if they are surrounded by double quotes: "...".
+   - Unescaped double quotes are removed from the input. Their only effect is
+     that within double quotes, space and tab are treated like normal
+     characters.
+   - Backslashes not followed by double quotes are not special.
+   - But 2*n+1 backslashes followed by a double quote become
+     n backslashes followed by a double quote (n >= 0):
+       \" -> "
+       \\\" -> \"
+       \\\\\" -> \\"
+ */
+#define SHELL_SPECIAL_CHARS "\"\\ \001\002\003\004\005\006\007\010\011\012\013\014\015\016\017\020\021\022\023\024\025\026\027\030\031\032\033\034\035\036\037"
+#define SHELL_SPACE_CHARS " \001\002\003\004\005\006\007\010\011\012\013\014\015\016\017\020\021\022\023\024\025\026\027\030\031\032\033\034\035\036\037"
+char **
+prepare_spawn (char **argv)
+{
+  size_t argc;
+  char **new_argv;
+  size_t i;
+
+  /* Count number of arguments.  */
+  for (argc = 0; argv[argc] != NULL; argc++)
+    ;
+
+  /* Allocate new argument vector.  */
+  new_argv = XMALLOC (char *, argc + 1);
+
+  /* Put quoted arguments into the new argument vector.  */
+  for (i = 0; i < argc; i++)
+    {
+      const char *string = argv[i];
+
+      if (string[0] == '\0')
+	new_argv[i] = xstrdup ("\"\"");
+      else if (strpbrk (string, SHELL_SPECIAL_CHARS) != NULL)
+	{
+	  int quote_around = (strpbrk (string, SHELL_SPACE_CHARS) != NULL);
+	  size_t length;
+	  unsigned int backslashes;
+	  const char *s;
+	  char *quoted_string;
+	  char *p;
+
+	  length = 0;
+	  backslashes = 0;
+	  if (quote_around)
+	    length++;
+	  for (s = string; *s != '\0'; s++)
+	    {
+	      char c = *s;
+	      if (c == '"')
+		length += backslashes + 1;
+	      length++;
+	      if (c == '\\')
+		backslashes++;
+	      else
+		backslashes = 0;
+	    }
+	  if (quote_around)
+	    length += backslashes + 1;
+
+	  quoted_string = XMALLOC (char, length + 1);
+
+	  p = quoted_string;
+	  backslashes = 0;
+	  if (quote_around)
+	    *p++ = '"';
+	  for (s = string; *s != '\0'; s++)
+	    {
+	      char c = *s;
+	      if (c == '"')
+		{
+		  unsigned int j;
+		  for (j = backslashes + 1; j > 0; j--)
+		    *p++ = '\\';
+		}
+	      *p++ = c;
+	      if (c == '\\')
+		backslashes++;
+	      else
+		backslashes = 0;
+	    }
+	  if (quote_around)
+	    {
+	      unsigned int j;
+	      for (j = backslashes; j > 0; j--)
+		*p++ = '\\';
+	      *p++ = '"';
+	    }
+	  *p = '\0';
+
+	  new_argv[i] = quoted_string;
+	}
+      else
+	new_argv[i] = (char *) string;
+    }
+  new_argv[argc] = NULL;
+
+  return new_argv;
+}
+EOF
+		;;
+	    esac
 
+            cat <<"EOF"
+void lt_dump_script (FILE* f)
+{
+EOF
+	    func_emit_wrapper yes |
+	      $SED -n -e '
+s/^\(.\{79\}\)\(..*\)/\1\
+\2/
+h
+s/\([\\"]\)/\\\1/g
+s/$/\\n/
+s/\([^\n]*\).*/  fputs ("\1", f);/p
+g
+D'
+            cat <<"EOF"
+}
 EOF
 }
 # end: func_emit_cwrapperexe_src
 
+# func_win32_import_lib_p ARG
+# True if ARG is an import lib, as indicated by $file_magic_cmd
+func_win32_import_lib_p ()
+{
+    $opt_debug
+    case `eval $file_magic_cmd \"\$1\" 2>/dev/null | $SED -e 10q` in
+    *import*) : ;;
+    *) false ;;
+    esac
+}
+
 # func_mode_link arg...
 func_mode_link ()
 {
@@ -4072,6 +5133,7 @@ func_mode_link ()
     new_inherited_linker_flags=
 
     avoid_version=no
+    bindir=
     dlfiles=
     dlprefiles=
     dlself=no
@@ -4164,6 +5226,11 @@ func_mode_link ()
 	esac
 
 	case $prev in
+	bindir)
+	  bindir="$arg"
+	  prev=
+	  continue
+	  ;;
 	dlfiles|dlprefiles)
 	  if test "$preload" = no; then
 	    # Add the symbol object into the linking commands.
@@ -4195,9 +5262,9 @@ func_mode_link ()
 	    ;;
 	  *)
 	    if test "$prev" = dlfiles; then
-	      dlfiles="$dlfiles $arg"
+	      func_append dlfiles " $arg"
 	    else
-	      dlprefiles="$dlprefiles $arg"
+	      func_append dlprefiles " $arg"
 	    fi
 	    prev=
 	    continue
@@ -4221,7 +5288,7 @@ func_mode_link ()
 	    *-*-darwin*)
 	      case "$deplibs " in
 		*" $qarg.ltframework "*) ;;
-		*) deplibs="$deplibs $qarg.ltframework" # this is fixed later
+		*) func_append deplibs " $qarg.ltframework" # this is fixed later
 		   ;;
 	      esac
 	      ;;
@@ -4240,7 +5307,7 @@ func_mode_link ()
 	    moreargs=
 	    for fil in `cat "$save_arg"`
 	    do
-#	      moreargs="$moreargs $fil"
+#	      func_append moreargs " $fil"
 	      arg=$fil
 	      # A libtool-controlled object.
 
@@ -4269,7 +5336,7 @@ func_mode_link ()
 
 		  if test "$prev" = dlfiles; then
 		    if test "$build_libtool_libs" = yes && test "$dlopen_support" = yes; then
-		      dlfiles="$dlfiles $pic_object"
+		      func_append dlfiles " $pic_object"
 		      prev=
 		      continue
 		    else
@@ -4281,7 +5348,7 @@ func_mode_link ()
 		  # CHECK ME:  I think I busted this.  -Ossama
 		  if test "$prev" = dlprefiles; then
 		    # Preload the old-style object.
-		    dlprefiles="$dlprefiles $pic_object"
+		    func_append dlprefiles " $pic_object"
 		    prev=
 		  fi
 
@@ -4351,12 +5418,12 @@ func_mode_link ()
 	  if test "$prev" = rpath; then
 	    case "$rpath " in
 	    *" $arg "*) ;;
-	    *) rpath="$rpath $arg" ;;
+	    *) func_append rpath " $arg" ;;
 	    esac
 	  else
 	    case "$xrpath " in
 	    *" $arg "*) ;;
-	    *) xrpath="$xrpath $arg" ;;
+	    *) func_append xrpath " $arg" ;;
 	    esac
 	  fi
 	  prev=
@@ -4368,28 +5435,28 @@ func_mode_link ()
 	  continue
 	  ;;
 	weak)
-	  weak_libs="$weak_libs $arg"
+	  func_append weak_libs " $arg"
 	  prev=
 	  continue
 	  ;;
 	xcclinker)
-	  linker_flags="$linker_flags $qarg"
-	  compiler_flags="$compiler_flags $qarg"
+	  func_append linker_flags " $qarg"
+	  func_append compiler_flags " $qarg"
 	  prev=
 	  func_append compile_command " $qarg"
 	  func_append finalize_command " $qarg"
 	  continue
 	  ;;
 	xcompiler)
-	  compiler_flags="$compiler_flags $qarg"
+	  func_append compiler_flags " $qarg"
 	  prev=
 	  func_append compile_command " $qarg"
 	  func_append finalize_command " $qarg"
 	  continue
 	  ;;
 	xlinker)
-	  linker_flags="$linker_flags $qarg"
-	  compiler_flags="$compiler_flags $wl$qarg"
+	  func_append linker_flags " $qarg"
+	  func_append compiler_flags " $wl$qarg"
 	  prev=
 	  func_append compile_command " $wl$qarg"
 	  func_append finalize_command " $wl$qarg"
@@ -4425,6 +5492,11 @@ func_mode_link ()
 	continue
 	;;
 
+      -bindir)
+	prev=bindir
+	continue
+	;;
+
       -dlopen)
 	prev=dlfiles
 	continue
@@ -4475,15 +5547,16 @@ func_mode_link ()
 	;;
 
       -L*)
-	func_stripname '-L' '' "$arg"
-	dir=$func_stripname_result
-	if test -z "$dir"; then
+	func_stripname "-L" '' "$arg"
+	if test -z "$func_stripname_result"; then
 	  if test "$#" -gt 0; then
 	    func_fatal_error "require no space between \`-L' and \`$1'"
 	  else
 	    func_fatal_error "need path for \`-L' option"
 	  fi
 	fi
+	func_resolve_sysroot "$func_stripname_result"
+	dir=$func_resolve_sysroot_result
 	# We need an absolute path.
 	case $dir in
 	[\\/]* | [A-Za-z]:[\\/]*) ;;
@@ -4495,24 +5568,30 @@ func_mode_link ()
 	  ;;
 	esac
 	case "$deplibs " in
-	*" -L$dir "*) ;;
+	*" -L$dir "* | *" $arg "*)
+	  # Will only happen for absolute or sysroot arguments
+	  ;;
 	*)
-	  deplibs="$deplibs -L$dir"
-	  lib_search_path="$lib_search_path $dir"
+	  # Preserve sysroot, but never include relative directories
+	  case $dir in
+	    [\\/]* | [A-Za-z]:[\\/]* | =*) func_append deplibs " $arg" ;;
+	    *) func_append deplibs " -L$dir" ;;
+	  esac
+	  func_append lib_search_path " $dir"
 	  ;;
 	esac
 	case $host in
 	*-*-cygwin* | *-*-mingw* | *-*-pw32* | *-*-os2* | *-cegcc*)
-	  testbindir=`$ECHO "X$dir" | $Xsed -e 's*/lib$*/bin*'`
+	  testbindir=`$ECHO "$dir" | $SED 's*/lib$*/bin*'`
 	  case :$dllsearchpath: in
 	  *":$dir:"*) ;;
 	  ::) dllsearchpath=$dir;;
-	  *) dllsearchpath="$dllsearchpath:$dir";;
+	  *) func_append dllsearchpath ":$dir";;
 	  esac
 	  case :$dllsearchpath: in
 	  *":$testbindir:"*) ;;
 	  ::) dllsearchpath=$testbindir;;
-	  *) dllsearchpath="$dllsearchpath:$testbindir";;
+	  *) func_append dllsearchpath ":$testbindir";;
 	  esac
 	  ;;
 	esac
@@ -4522,7 +5601,7 @@ func_mode_link ()
       -l*)
 	if test "X$arg" = "X-lc" || test "X$arg" = "X-lm"; then
 	  case $host in
-	  *-*-cygwin* | *-*-mingw* | *-*-pw32* | *-*-beos* | *-cegcc*)
+	  *-*-cygwin* | *-*-mingw* | *-*-pw32* | *-*-beos* | *-cegcc* | *-*-haiku*)
 	    # These systems don't actually have a C or math library (as such)
 	    continue
 	    ;;
@@ -4536,7 +5615,7 @@ func_mode_link ()
 	    ;;
 	  *-*-rhapsody* | *-*-darwin1.[012])
 	    # Rhapsody C and math libraries are in the System framework
-	    deplibs="$deplibs System.ltframework"
+	    func_append deplibs " System.ltframework"
 	    continue
 	    ;;
 	  *-*-sco3.2v5* | *-*-sco5v6*)
@@ -4556,7 +5635,7 @@ func_mode_link ()
 	   ;;
 	 esac
 	fi
-	deplibs="$deplibs $arg"
+	func_append deplibs " $arg"
 	continue
 	;;
 
@@ -4568,21 +5647,22 @@ func_mode_link ()
       # Tru64 UNIX uses -model [arg] to determine the layout of C++
       # classes, name mangling, and exception handling.
       # Darwin uses the -arch flag to determine output architecture.
-      -model|-arch|-isysroot)
-	compiler_flags="$compiler_flags $arg"
+      -model|-arch|-isysroot|--sysroot)
+	func_append compiler_flags " $arg"
 	func_append compile_command " $arg"
 	func_append finalize_command " $arg"
 	prev=xcompiler
 	continue
 	;;
 
-      -mt|-mthreads|-kthread|-Kthread|-pthread|-pthreads|--thread-safe|-threads)
-	compiler_flags="$compiler_flags $arg"
+      -mt|-mthreads|-kthread|-Kthread|-pthread|-pthreads|--thread-safe \
+      |-threads|-fopenmp|-openmp|-mp|-xopenmp|-omp|-qsmp=*)
+	func_append compiler_flags " $arg"
 	func_append compile_command " $arg"
 	func_append finalize_command " $arg"
 	case "$new_inherited_linker_flags " in
 	    *" $arg "*) ;;
-	    * ) new_inherited_linker_flags="$new_inherited_linker_flags $arg" ;;
+	    * ) func_append new_inherited_linker_flags " $arg" ;;
 	esac
 	continue
 	;;
@@ -4649,13 +5729,17 @@ func_mode_link ()
 	# We need an absolute path.
 	case $dir in
 	[\\/]* | [A-Za-z]:[\\/]*) ;;
+	=*)
+	  func_stripname '=' '' "$dir"
+	  dir=$lt_sysroot$func_stripname_result
+	  ;;
 	*)
 	  func_fatal_error "only absolute run-paths are allowed"
 	  ;;
 	esac
 	case "$xrpath " in
 	*" $dir "*) ;;
-	*) xrpath="$xrpath $dir" ;;
+	*) func_append xrpath " $dir" ;;
 	esac
 	continue
 	;;
@@ -4708,8 +5792,8 @@ func_mode_link ()
 	for flag in $args; do
 	  IFS="$save_ifs"
           func_quote_for_eval "$flag"
-	  arg="$arg $wl$func_quote_for_eval_result"
-	  compiler_flags="$compiler_flags $func_quote_for_eval_result"
+	  func_append arg " $func_quote_for_eval_result"
+	  func_append compiler_flags " $func_quote_for_eval_result"
 	done
 	IFS="$save_ifs"
 	func_stripname ' ' '' "$arg"
@@ -4724,9 +5808,9 @@ func_mode_link ()
 	for flag in $args; do
 	  IFS="$save_ifs"
           func_quote_for_eval "$flag"
-	  arg="$arg $wl$func_quote_for_eval_result"
-	  compiler_flags="$compiler_flags $wl$func_quote_for_eval_result"
-	  linker_flags="$linker_flags $func_quote_for_eval_result"
+	  func_append arg " $wl$func_quote_for_eval_result"
+	  func_append compiler_flags " $wl$func_quote_for_eval_result"
+	  func_append linker_flags " $func_quote_for_eval_result"
 	done
 	IFS="$save_ifs"
 	func_stripname ' ' '' "$arg"
@@ -4754,23 +5838,27 @@ func_mode_link ()
 	arg="$func_quote_for_eval_result"
 	;;
 
-      # -64, -mips[0-9] enable 64-bit mode on the SGI compiler
-      # -r[0-9][0-9]* specifies the processor on the SGI compiler
-      # -xarch=*, -xtarget=* enable 64-bit mode on the Sun compiler
-      # +DA*, +DD* enable 64-bit mode on the HP compiler
-      # -q* pass through compiler args for the IBM compiler
-      # -m*, -t[45]*, -txscale* pass through architecture-specific
-      # compiler args for GCC
-      # -F/path gives path to uninstalled frameworks, gcc on darwin
-      # -p, -pg, --coverage, -fprofile-* pass through profiling flag for GCC
-      # @file GCC response files
+      # Flags to be passed through unchanged, with rationale:
+      # -64, -mips[0-9]      enable 64-bit mode for the SGI compiler
+      # -r[0-9][0-9]*        specify processor for the SGI compiler
+      # -xarch=*, -xtarget=* enable 64-bit mode for the Sun compiler
+      # +DA*, +DD*           enable 64-bit mode for the HP compiler
+      # -q*                  compiler args for the IBM compiler
+      # -m*, -t[45]*, -txscale* architecture-specific flags for GCC
+      # -F/path              path to uninstalled frameworks, gcc on darwin
+      # -p, -pg, --coverage, -fprofile-*  profiling flags for GCC
+      # @file                GCC response files
+      # -tp=*                Portland pgcc target processor selection
+      # --sysroot=*          for sysroot support
+      # -O*, -flto*, -fwhopr*, -fuse-linker-plugin GCC link-time optimization
       -64|-mips[0-9]|-r[0-9][0-9]*|-xarch=*|-xtarget=*|+DA*|+DD*|-q*|-m*| \
-      -t[45]*|-txscale*|-p|-pg|--coverage|-fprofile-*|-F*|@*)
+      -t[45]*|-txscale*|-p|-pg|--coverage|-fprofile-*|-F*|@*|-tp=*|--sysroot=*| \
+      -O*|-flto*|-fwhopr*|-fuse-linker-plugin)
         func_quote_for_eval "$arg"
 	arg="$func_quote_for_eval_result"
         func_append compile_command " $arg"
         func_append finalize_command " $arg"
-        compiler_flags="$compiler_flags $arg"
+        func_append compiler_flags " $arg"
         continue
         ;;
 
@@ -4782,7 +5870,7 @@ func_mode_link ()
 
       *.$objext)
 	# A standard object.
-	objs="$objs $arg"
+	func_append objs " $arg"
 	;;
 
       *.lo)
@@ -4813,7 +5901,7 @@ func_mode_link ()
 
 	    if test "$prev" = dlfiles; then
 	      if test "$build_libtool_libs" = yes && test "$dlopen_support" = yes; then
-		dlfiles="$dlfiles $pic_object"
+		func_append dlfiles " $pic_object"
 		prev=
 		continue
 	      else
@@ -4825,7 +5913,7 @@ func_mode_link ()
 	    # CHECK ME:  I think I busted this.  -Ossama
 	    if test "$prev" = dlprefiles; then
 	      # Preload the old-style object.
-	      dlprefiles="$dlprefiles $pic_object"
+	      func_append dlprefiles " $pic_object"
 	      prev=
 	    fi
 
@@ -4870,24 +5958,25 @@ func_mode_link ()
 
       *.$libext)
 	# An archive.
-	deplibs="$deplibs $arg"
-	old_deplibs="$old_deplibs $arg"
+	func_append deplibs " $arg"
+	func_append old_deplibs " $arg"
 	continue
 	;;
 
       *.la)
 	# A libtool-controlled library.
 
+	func_resolve_sysroot "$arg"
 	if test "$prev" = dlfiles; then
 	  # This library was specified with -dlopen.
-	  dlfiles="$dlfiles $arg"
+	  func_append dlfiles " $func_resolve_sysroot_result"
 	  prev=
 	elif test "$prev" = dlprefiles; then
 	  # The library was specified with -dlpreopen.
-	  dlprefiles="$dlprefiles $arg"
+	  func_append dlprefiles " $func_resolve_sysroot_result"
 	  prev=
 	else
-	  deplibs="$deplibs $arg"
+	  func_append deplibs " $func_resolve_sysroot_result"
 	fi
 	continue
 	;;
@@ -4925,7 +6014,7 @@ func_mode_link ()
 
     if test -n "$shlibpath_var"; then
       # get the directories listed in $shlibpath_var
-      eval shlib_search_path=\`\$ECHO \"X\${$shlibpath_var}\" \| \$Xsed -e \'s/:/ /g\'\`
+      eval shlib_search_path=\`\$ECHO \"\${$shlibpath_var}\" \| \$SED \'s/:/ /g\'\`
     else
       shlib_search_path=
     fi
@@ -4934,6 +6023,8 @@ func_mode_link ()
 
     func_dirname "$output" "/" ""
     output_objdir="$func_dirname_result$objdir"
+    func_to_tool_file "$output_objdir/"
+    tool_output_objdir=$func_to_tool_file_result
     # Create the object directory.
     func_mkdir_p "$output_objdir"
 
@@ -4954,12 +6045,12 @@ func_mode_link ()
     # Find all interdependent deplibs by searching for libraries
     # that are linked more than once (e.g. -la -lb -la)
     for deplib in $deplibs; do
-      if $opt_duplicate_deps ; then
+      if $opt_preserve_dup_deps ; then
 	case "$libs " in
-	*" $deplib "*) specialdeplibs="$specialdeplibs $deplib" ;;
+	*" $deplib "*) func_append specialdeplibs " $deplib" ;;
 	esac
       fi
-      libs="$libs $deplib"
+      func_append libs " $deplib"
     done
 
     if test "$linkmode" = lib; then
@@ -4972,9 +6063,9 @@ func_mode_link ()
       if $opt_duplicate_compiler_generated_deps; then
 	for pre_post_dep in $predeps $postdeps; do
 	  case "$pre_post_deps " in
-	  *" $pre_post_dep "*) specialdeplibs="$specialdeplibs $pre_post_deps" ;;
+	  *" $pre_post_dep "*) func_append specialdeplibs " $pre_post_deps" ;;
 	  esac
-	  pre_post_deps="$pre_post_deps $pre_post_dep"
+	  func_append pre_post_deps " $pre_post_dep"
 	done
       fi
       pre_post_deps=
@@ -5041,17 +6132,19 @@ func_mode_link ()
 	for lib in $dlprefiles; do
 	  # Ignore non-libtool-libs
 	  dependency_libs=
+	  func_resolve_sysroot "$lib"
 	  case $lib in
-	  *.la)	func_source "$lib" ;;
+	  *.la)	func_source "$func_resolve_sysroot_result" ;;
 	  esac
 
 	  # Collect preopened libtool deplibs, except any this library
 	  # has declared as weak libs
 	  for deplib in $dependency_libs; do
-            deplib_base=`$ECHO "X$deplib" | $Xsed -e "$basename"`
+	    func_basename "$deplib"
+            deplib_base=$func_basename_result
 	    case " $weak_libs " in
 	    *" $deplib_base "*) ;;
-	    *) deplibs="$deplibs $deplib" ;;
+	    *) func_append deplibs " $deplib" ;;
 	    esac
 	  done
 	done
@@ -5067,16 +6160,17 @@ func_mode_link ()
 	lib=
 	found=no
 	case $deplib in
-	-mt|-mthreads|-kthread|-Kthread|-pthread|-pthreads|--thread-safe|-threads)
+	-mt|-mthreads|-kthread|-Kthread|-pthread|-pthreads|--thread-safe \
+        |-threads|-fopenmp|-openmp|-mp|-xopenmp|-omp|-qsmp=*)
 	  if test "$linkmode,$pass" = "prog,link"; then
 	    compile_deplibs="$deplib $compile_deplibs"
 	    finalize_deplibs="$deplib $finalize_deplibs"
 	  else
-	    compiler_flags="$compiler_flags $deplib"
+	    func_append compiler_flags " $deplib"
 	    if test "$linkmode" = lib ; then
 		case "$new_inherited_linker_flags " in
 		    *" $deplib "*) ;;
-		    * ) new_inherited_linker_flags="$new_inherited_linker_flags $deplib" ;;
+		    * ) func_append new_inherited_linker_flags " $deplib" ;;
 		esac
 	    fi
 	  fi
@@ -5161,7 +6255,7 @@ func_mode_link ()
 	    if test "$linkmode" = lib ; then
 		case "$new_inherited_linker_flags " in
 		    *" $deplib "*) ;;
-		    * ) new_inherited_linker_flags="$new_inherited_linker_flags $deplib" ;;
+		    * ) func_append new_inherited_linker_flags " $deplib" ;;
 		esac
 	    fi
 	  fi
@@ -5174,7 +6268,8 @@ func_mode_link ()
 	    test "$pass" = conv && continue
 	    newdependency_libs="$deplib $newdependency_libs"
 	    func_stripname '-L' '' "$deplib"
-	    newlib_search_path="$newlib_search_path $func_stripname_result"
+	    func_resolve_sysroot "$func_stripname_result"
+	    func_append newlib_search_path " $func_resolve_sysroot_result"
 	    ;;
 	  prog)
 	    if test "$pass" = conv; then
@@ -5188,7 +6283,8 @@ func_mode_link ()
 	      finalize_deplibs="$deplib $finalize_deplibs"
 	    fi
 	    func_stripname '-L' '' "$deplib"
-	    newlib_search_path="$newlib_search_path $func_stripname_result"
+	    func_resolve_sysroot "$func_stripname_result"
+	    func_append newlib_search_path " $func_resolve_sysroot_result"
 	    ;;
 	  *)
 	    func_warning "\`-L' is ignored for archives/objects"
@@ -5199,17 +6295,21 @@ func_mode_link ()
 	-R*)
 	  if test "$pass" = link; then
 	    func_stripname '-R' '' "$deplib"
-	    dir=$func_stripname_result
+	    func_resolve_sysroot "$func_stripname_result"
+	    dir=$func_resolve_sysroot_result
 	    # Make sure the xrpath contains only unique directories.
 	    case "$xrpath " in
 	    *" $dir "*) ;;
-	    *) xrpath="$xrpath $dir" ;;
+	    *) func_append xrpath " $dir" ;;
 	    esac
 	  fi
 	  deplibs="$deplib $deplibs"
 	  continue
 	  ;;
-	*.la) lib="$deplib" ;;
+	*.la)
+	  func_resolve_sysroot "$deplib"
+	  lib=$func_resolve_sysroot_result
+	  ;;
 	*.$libext)
 	  if test "$pass" = conv; then
 	    deplibs="$deplib $deplibs"
@@ -5227,7 +6327,7 @@ func_mode_link ()
 		match_pattern*)
 		  set dummy $deplibs_check_method; shift
 		  match_pattern_regex=`expr "$deplibs_check_method" : "$1 \(.*\)"`
-		  if eval "\$ECHO \"X$deplib\"" 2>/dev/null | $Xsed -e 10q \
+		  if eval "\$ECHO \"$deplib\"" 2>/dev/null | $SED 10q \
 		    | $EGREP "$match_pattern_regex" > /dev/null; then
 		    valid_a_lib=yes
 		  fi
@@ -5237,15 +6337,15 @@ func_mode_link ()
 		;;
 	      esac
 	      if test "$valid_a_lib" != yes; then
-		$ECHO
+		echo
 		$ECHO "*** Warning: Trying to link with static lib archive $deplib."
-		$ECHO "*** I have the capability to make that library automatically link in when"
-		$ECHO "*** you link to this library.  But I can only do this if you have a"
-		$ECHO "*** shared version of the library, which you do not appear to have"
-		$ECHO "*** because the file extensions .$libext of this argument makes me believe"
-		$ECHO "*** that it is just a static archive that I should not use here."
+		echo "*** I have the capability to make that library automatically link in when"
+		echo "*** you link to this library.  But I can only do this if you have a"
+		echo "*** shared version of the library, which you do not appear to have"
+		echo "*** because the file extensions .$libext of this argument makes me believe"
+		echo "*** that it is just a static archive that I should not use here."
 	      else
-		$ECHO
+		echo
 		$ECHO "*** Warning: Linking the shared library $output against the"
 		$ECHO "*** static library $deplib is not portable!"
 		deplibs="$deplib $deplibs"
@@ -5272,11 +6372,11 @@ func_mode_link ()
 	    if test "$pass" = dlpreopen || test "$dlopen_support" != yes || test "$build_libtool_libs" = no; then
 	      # If there is no dlopen support or we're linking statically,
 	      # we need to preload.
-	      newdlprefiles="$newdlprefiles $deplib"
+	      func_append newdlprefiles " $deplib"
 	      compile_deplibs="$deplib $compile_deplibs"
 	      finalize_deplibs="$deplib $finalize_deplibs"
 	    else
-	      newdlfiles="$newdlfiles $deplib"
+	      func_append newdlfiles " $deplib"
 	    fi
 	  fi
 	  continue
@@ -5318,20 +6418,20 @@ func_mode_link ()
 
 	# Convert "-framework foo" to "foo.ltframework"
 	if test -n "$inherited_linker_flags"; then
-	  tmp_inherited_linker_flags=`$ECHO "X$inherited_linker_flags" | $Xsed -e 's/-framework \([^ $]*\)/\1.ltframework/g'`
+	  tmp_inherited_linker_flags=`$ECHO "$inherited_linker_flags" | $SED 's/-framework \([^ $]*\)/\1.ltframework/g'`
 	  for tmp_inherited_linker_flag in $tmp_inherited_linker_flags; do
 	    case " $new_inherited_linker_flags " in
 	      *" $tmp_inherited_linker_flag "*) ;;
-	      *) new_inherited_linker_flags="$new_inherited_linker_flags $tmp_inherited_linker_flag";;
+	      *) func_append new_inherited_linker_flags " $tmp_inherited_linker_flag";;
 	    esac
 	  done
 	fi
-	dependency_libs=`$ECHO "X $dependency_libs" | $Xsed -e 's% \([^ $]*\).ltframework% -framework \1%g'`
+	dependency_libs=`$ECHO " $dependency_libs" | $SED 's% \([^ $]*\).ltframework% -framework \1%g'`
 	if test "$linkmode,$pass" = "lib,link" ||
 	   test "$linkmode,$pass" = "prog,scan" ||
 	   { test "$linkmode" != prog && test "$linkmode" != lib; }; then
-	  test -n "$dlopen" && dlfiles="$dlfiles $dlopen"
-	  test -n "$dlpreopen" && dlprefiles="$dlprefiles $dlpreopen"
+	  test -n "$dlopen" && func_append dlfiles " $dlopen"
+	  test -n "$dlpreopen" && func_append dlprefiles " $dlpreopen"
 	fi
 
 	if test "$pass" = conv; then
@@ -5342,20 +6442,20 @@ func_mode_link ()
 	      func_fatal_error "cannot find name of link library for \`$lib'"
 	    fi
 	    # It is a libtool convenience library, so add in its objects.
-	    convenience="$convenience $ladir/$objdir/$old_library"
-	    old_convenience="$old_convenience $ladir/$objdir/$old_library"
+	    func_append convenience " $ladir/$objdir/$old_library"
+	    func_append old_convenience " $ladir/$objdir/$old_library"
 	  elif test "$linkmode" != prog && test "$linkmode" != lib; then
 	    func_fatal_error "\`$lib' is not a convenience library"
 	  fi
 	  tmp_libs=
 	  for deplib in $dependency_libs; do
 	    deplibs="$deplib $deplibs"
-	    if $opt_duplicate_deps ; then
+	    if $opt_preserve_dup_deps ; then
 	      case "$tmp_libs " in
-	      *" $deplib "*) specialdeplibs="$specialdeplibs $deplib" ;;
+	      *" $deplib "*) func_append specialdeplibs " $deplib" ;;
 	      esac
 	    fi
-	    tmp_libs="$tmp_libs $deplib"
+	    func_append tmp_libs " $deplib"
 	  done
 	  continue
 	fi # $pass = conv
@@ -5363,9 +6463,15 @@ func_mode_link ()
 
 	# Get the name of the library we link against.
 	linklib=
-	for l in $old_library $library_names; do
-	  linklib="$l"
-	done
+	if test -n "$old_library" &&
+	   { test "$prefer_static_libs" = yes ||
+	     test "$prefer_static_libs,$installed" = "built,no"; }; then
+	  linklib=$old_library
+	else
+	  for l in $old_library $library_names; do
+	    linklib="$l"
+	  done
+	fi
 	if test -z "$linklib"; then
 	  func_fatal_error "cannot find name of link library for \`$lib'"
 	fi
@@ -5382,9 +6488,9 @@ func_mode_link ()
 	    # statically, we need to preload.  We also need to preload any
 	    # dependent libraries so libltdl's deplib preloader doesn't
 	    # bomb out in the load deplibs phase.
-	    dlprefiles="$dlprefiles $lib $dependency_libs"
+	    func_append dlprefiles " $lib $dependency_libs"
 	  else
-	    newdlfiles="$newdlfiles $lib"
+	    func_append newdlfiles " $lib"
 	  fi
 	  continue
 	fi # $pass = dlopen
@@ -5406,14 +6512,14 @@ func_mode_link ()
 
 	# Find the relevant object directory and library name.
 	if test "X$installed" = Xyes; then
-	  if test ! -f "$libdir/$linklib" && test -f "$abs_ladir/$linklib"; then
+	  if test ! -f "$lt_sysroot$libdir/$linklib" && test -f "$abs_ladir/$linklib"; then
 	    func_warning "library \`$lib' was moved."
 	    dir="$ladir"
 	    absdir="$abs_ladir"
 	    libdir="$abs_ladir"
 	  else
-	    dir="$libdir"
-	    absdir="$libdir"
+	    dir="$lt_sysroot$libdir"
+	    absdir="$lt_sysroot$libdir"
 	  fi
 	  test "X$hardcode_automatic" = Xyes && avoidtemprpath=yes
 	else
@@ -5421,12 +6527,12 @@ func_mode_link ()
 	    dir="$ladir"
 	    absdir="$abs_ladir"
 	    # Remove this search path later
-	    notinst_path="$notinst_path $abs_ladir"
+	    func_append notinst_path " $abs_ladir"
 	  else
 	    dir="$ladir/$objdir"
 	    absdir="$abs_ladir/$objdir"
 	    # Remove this search path later
-	    notinst_path="$notinst_path $abs_ladir"
+	    func_append notinst_path " $abs_ladir"
 	  fi
 	fi # $installed = yes
 	func_stripname 'lib' '.la' "$laname"
@@ -5437,20 +6543,46 @@ func_mode_link ()
 	  if test -z "$libdir" && test "$linkmode" = prog; then
 	    func_fatal_error "only libraries may -dlpreopen a convenience library: \`$lib'"
 	  fi
-	  # Prefer using a static library (so that no silly _DYNAMIC symbols
-	  # are required to link).
-	  if test -n "$old_library"; then
-	    newdlprefiles="$newdlprefiles $dir/$old_library"
-	    # Keep a list of preopened convenience libraries to check
-	    # that they are being used correctly in the link pass.
-	    test -z "$libdir" && \
-		dlpreconveniencelibs="$dlpreconveniencelibs $dir/$old_library"
-	  # Otherwise, use the dlname, so that lt_dlopen finds it.
-	  elif test -n "$dlname"; then
-	    newdlprefiles="$newdlprefiles $dir/$dlname"
-	  else
-	    newdlprefiles="$newdlprefiles $dir/$linklib"
-	  fi
+	  case "$host" in
+	    # special handling for platforms with PE-DLLs.
+	    *cygwin* | *mingw* | *cegcc* )
+	      # Linker will automatically link against shared library if both
+	      # static and shared are present.  Therefore, ensure we extract
+	      # symbols from the import library if a shared library is present
+	      # (otherwise, the dlopen module name will be incorrect).  We do
+	      # this by putting the import library name into $newdlprefiles.
+	      # We recover the dlopen module name by 'saving' the la file
+	      # name in a special purpose variable, and (later) extracting the
+	      # dlname from the la file.
+	      if test -n "$dlname"; then
+	        func_tr_sh "$dir/$linklib"
+	        eval "libfile_$func_tr_sh_result=\$abs_ladir/\$laname"
+	        func_append newdlprefiles " $dir/$linklib"
+	      else
+	        func_append newdlprefiles " $dir/$old_library"
+	        # Keep a list of preopened convenience libraries to check
+	        # that they are being used correctly in the link pass.
+	        test -z "$libdir" && \
+	          func_append dlpreconveniencelibs " $dir/$old_library"
+	      fi
+	    ;;
+	    * )
+	      # Prefer using a static library (so that no silly _DYNAMIC symbols
+	      # are required to link).
+	      if test -n "$old_library"; then
+	        func_append newdlprefiles " $dir/$old_library"
+	        # Keep a list of preopened convenience libraries to check
+	        # that they are being used correctly in the link pass.
+	        test -z "$libdir" && \
+	          func_append dlpreconveniencelibs " $dir/$old_library"
+	      # Otherwise, use the dlname, so that lt_dlopen finds it.
+	      elif test -n "$dlname"; then
+	        func_append newdlprefiles " $dir/$dlname"
+	      else
+	        func_append newdlprefiles " $dir/$linklib"
+	      fi
+	    ;;
+	  esac
 	fi # $pass = dlpreopen
 
 	if test -z "$libdir"; then
@@ -5468,7 +6600,7 @@ func_mode_link ()
 
 
 	if test "$linkmode" = prog && test "$pass" != link; then
-	  newlib_search_path="$newlib_search_path $ladir"
+	  func_append newlib_search_path " $ladir"
 	  deplibs="$lib $deplibs"
 
 	  linkalldeplibs=no
@@ -5481,7 +6613,8 @@ func_mode_link ()
 	  for deplib in $dependency_libs; do
 	    case $deplib in
 	    -L*) func_stripname '-L' '' "$deplib"
-	         newlib_search_path="$newlib_search_path $func_stripname_result"
+	         func_resolve_sysroot "$func_stripname_result"
+	         func_append newlib_search_path " $func_resolve_sysroot_result"
 		 ;;
 	    esac
 	    # Need to link against all dependency_libs?
@@ -5492,12 +6625,12 @@ func_mode_link ()
 	      # or/and link against static libraries
 	      newdependency_libs="$deplib $newdependency_libs"
 	    fi
-	    if $opt_duplicate_deps ; then
+	    if $opt_preserve_dup_deps ; then
 	      case "$tmp_libs " in
-	      *" $deplib "*) specialdeplibs="$specialdeplibs $deplib" ;;
+	      *" $deplib "*) func_append specialdeplibs " $deplib" ;;
 	      esac
 	    fi
-	    tmp_libs="$tmp_libs $deplib"
+	    func_append tmp_libs " $deplib"
 	  done # for deplib
 	  continue
 	fi # $linkmode = prog...
@@ -5512,7 +6645,7 @@ func_mode_link ()
 	      # Make sure the rpath contains only unique directories.
 	      case "$temp_rpath:" in
 	      *"$absdir:"*) ;;
-	      *) temp_rpath="$temp_rpath$absdir:" ;;
+	      *) func_append temp_rpath "$absdir:" ;;
 	      esac
 	    fi
 
@@ -5524,7 +6657,7 @@ func_mode_link ()
 	    *)
 	      case "$compile_rpath " in
 	      *" $absdir "*) ;;
-	      *) compile_rpath="$compile_rpath $absdir"
+	      *) func_append compile_rpath " $absdir" ;;
 	      esac
 	      ;;
 	    esac
@@ -5533,7 +6666,7 @@ func_mode_link ()
 	    *)
 	      case "$finalize_rpath " in
 	      *" $libdir "*) ;;
-	      *) finalize_rpath="$finalize_rpath $libdir"
+	      *) func_append finalize_rpath " $libdir" ;;
 	      esac
 	      ;;
 	    esac
@@ -5558,12 +6691,12 @@ func_mode_link ()
 	  case $host in
 	  *cygwin* | *mingw* | *cegcc*)
 	      # No point in relinking DLLs because paths are not encoded
-	      notinst_deplibs="$notinst_deplibs $lib"
+	      func_append notinst_deplibs " $lib"
 	      need_relink=no
 	    ;;
 	  *)
 	    if test "$installed" = no; then
-	      notinst_deplibs="$notinst_deplibs $lib"
+	      func_append notinst_deplibs " $lib"
 	      need_relink=yes
 	    fi
 	    ;;
@@ -5580,7 +6713,7 @@ func_mode_link ()
 	    fi
 	  done
 	  if test -z "$dlopenmodule" && test "$shouldnotlink" = yes && test "$pass" = link; then
-	    $ECHO
+	    echo
 	    if test "$linkmode" = prog; then
 	      $ECHO "*** Warning: Linking the executable $output against the loadable module"
 	    else
@@ -5598,7 +6731,7 @@ func_mode_link ()
 	    *)
 	      case "$compile_rpath " in
 	      *" $absdir "*) ;;
-	      *) compile_rpath="$compile_rpath $absdir"
+	      *) func_append compile_rpath " $absdir" ;;
 	      esac
 	      ;;
 	    esac
@@ -5607,7 +6740,7 @@ func_mode_link ()
 	    *)
 	      case "$finalize_rpath " in
 	      *" $libdir "*) ;;
-	      *) finalize_rpath="$finalize_rpath $libdir"
+	      *) func_append finalize_rpath " $libdir" ;;
 	      esac
 	      ;;
 	    esac
@@ -5661,7 +6794,7 @@ func_mode_link ()
 	    linklib=$newlib
 	  fi # test -n "$old_archive_from_expsyms_cmds"
 
-	  if test "$linkmode" = prog || test "$mode" != relink; then
+	  if test "$linkmode" = prog || test "$opt_mode" != relink; then
 	    add_shlibpath=
 	    add_dir=
 	    add=
@@ -5683,9 +6816,9 @@ func_mode_link ()
 		      if test "X$dlopenmodule" != "X$lib"; then
 			$ECHO "*** Warning: lib $linklib is a module, not a shared library"
 			if test -z "$old_library" ; then
-			  $ECHO
-			  $ECHO "*** And there doesn't seem to be a static archive available"
-			  $ECHO "*** The link will probably fail, sorry"
+			  echo
+			  echo "*** And there doesn't seem to be a static archive available"
+			  echo "*** The link will probably fail, sorry"
 			else
 			  add="$dir/$old_library"
 			fi
@@ -5712,12 +6845,12 @@ func_mode_link ()
 	         test "$hardcode_direct_absolute" = no; then
 		add="$dir/$linklib"
 	      elif test "$hardcode_minus_L" = yes; then
-		add_dir="-L$dir"
+		add_dir="-L$absdir"
 		# Try looking first in the location we're being installed to.
 		if test -n "$inst_prefix_dir"; then
 		  case $libdir in
 		    [\\/]*)
-		      add_dir="$add_dir -L$inst_prefix_dir$libdir"
+		      func_append add_dir " -L$inst_prefix_dir$libdir"
 		      ;;
 		  esac
 		fi
@@ -5739,7 +6872,7 @@ func_mode_link ()
 	    if test -n "$add_shlibpath"; then
 	      case :$compile_shlibpath: in
 	      *":$add_shlibpath:"*) ;;
-	      *) compile_shlibpath="$compile_shlibpath$add_shlibpath:" ;;
+	      *) func_append compile_shlibpath "$add_shlibpath:" ;;
 	      esac
 	    fi
 	    if test "$linkmode" = prog; then
@@ -5753,13 +6886,13 @@ func_mode_link ()
 		 test "$hardcode_shlibpath_var" = yes; then
 		case :$finalize_shlibpath: in
 		*":$libdir:"*) ;;
-		*) finalize_shlibpath="$finalize_shlibpath$libdir:" ;;
+		*) func_append finalize_shlibpath "$libdir:" ;;
 		esac
 	      fi
 	    fi
 	  fi
 
-	  if test "$linkmode" = prog || test "$mode" = relink; then
+	  if test "$linkmode" = prog || test "$opt_mode" = relink; then
 	    add_shlibpath=
 	    add_dir=
 	    add=
@@ -5773,7 +6906,7 @@ func_mode_link ()
 	    elif test "$hardcode_shlibpath_var" = yes; then
 	      case :$finalize_shlibpath: in
 	      *":$libdir:"*) ;;
-	      *) finalize_shlibpath="$finalize_shlibpath$libdir:" ;;
+	      *) func_append finalize_shlibpath "$libdir:" ;;
 	      esac
 	      add="-l$name"
 	    elif test "$hardcode_automatic" = yes; then
@@ -5790,7 +6923,7 @@ func_mode_link ()
 	      if test -n "$inst_prefix_dir"; then
 		case $libdir in
 		  [\\/]*)
-		    add_dir="$add_dir -L$inst_prefix_dir$libdir"
+		    func_append add_dir " -L$inst_prefix_dir$libdir"
 		    ;;
 		esac
 	      fi
@@ -5825,21 +6958,21 @@ func_mode_link ()
 
 	    # Just print a warning and add the library to dependency_libs so
 	    # that the program can be linked against the static library.
-	    $ECHO
+	    echo
 	    $ECHO "*** Warning: This system can not link to static lib archive $lib."
-	    $ECHO "*** I have the capability to make that library automatically link in when"
-	    $ECHO "*** you link to this library.  But I can only do this if you have a"
-	    $ECHO "*** shared version of the library, which you do not appear to have."
+	    echo "*** I have the capability to make that library automatically link in when"
+	    echo "*** you link to this library.  But I can only do this if you have a"
+	    echo "*** shared version of the library, which you do not appear to have."
 	    if test "$module" = yes; then
-	      $ECHO "*** But as you try to build a module library, libtool will still create "
-	      $ECHO "*** a static module, that should work as long as the dlopening application"
-	      $ECHO "*** is linked with the -dlopen flag to resolve symbols at runtime."
+	      echo "*** But as you try to build a module library, libtool will still create "
+	      echo "*** a static module, that should work as long as the dlopening application"
+	      echo "*** is linked with the -dlopen flag to resolve symbols at runtime."
 	      if test -z "$global_symbol_pipe"; then
-		$ECHO
-		$ECHO "*** However, this would only work if libtool was able to extract symbol"
-		$ECHO "*** lists from a program, using \`nm' or equivalent, but libtool could"
-		$ECHO "*** not find such a program.  So, this module is probably useless."
-		$ECHO "*** \`nm' from GNU binutils and a full rebuild may help."
+		echo
+		echo "*** However, this would only work if libtool was able to extract symbol"
+		echo "*** lists from a program, using \`nm' or equivalent, but libtool could"
+		echo "*** not find such a program.  So, this module is probably useless."
+		echo "*** \`nm' from GNU binutils and a full rebuild may help."
 	      fi
 	      if test "$build_old_libs" = no; then
 		build_libtool_libs=module
@@ -5867,37 +7000,46 @@ func_mode_link ()
 	           temp_xrpath=$func_stripname_result
 		   case " $xrpath " in
 		   *" $temp_xrpath "*) ;;
-		   *) xrpath="$xrpath $temp_xrpath";;
+		   *) func_append xrpath " $temp_xrpath";;
 		   esac;;
-	      *) temp_deplibs="$temp_deplibs $libdir";;
+	      *) func_append temp_deplibs " $libdir";;
 	      esac
 	    done
 	    dependency_libs="$temp_deplibs"
 	  fi
 
-	  newlib_search_path="$newlib_search_path $absdir"
+	  func_append newlib_search_path " $absdir"
 	  # Link against this library
 	  test "$link_static" = no && newdependency_libs="$abs_ladir/$laname $newdependency_libs"
 	  # ... and its dependency_libs
 	  tmp_libs=
 	  for deplib in $dependency_libs; do
 	    newdependency_libs="$deplib $newdependency_libs"
-	    if $opt_duplicate_deps ; then
+	    case $deplib in
+              -L*) func_stripname '-L' '' "$deplib"
+                   func_resolve_sysroot "$func_stripname_result";;
+              *) func_resolve_sysroot "$deplib" ;;
+            esac
+	    if $opt_preserve_dup_deps ; then
 	      case "$tmp_libs " in
-	      *" $deplib "*) specialdeplibs="$specialdeplibs $deplib" ;;
+	      *" $func_resolve_sysroot_result "*)
+                func_append specialdeplibs " $func_resolve_sysroot_result" ;;
 	      esac
 	    fi
-	    tmp_libs="$tmp_libs $deplib"
+	    func_append tmp_libs " $func_resolve_sysroot_result"
 	  done
 
 	  if test "$link_all_deplibs" != no; then
 	    # Add the search paths of all dependency libraries
 	    for deplib in $dependency_libs; do
+	      path=
 	      case $deplib in
 	      -L*) path="$deplib" ;;
 	      *.la)
+	        func_resolve_sysroot "$deplib"
+	        deplib=$func_resolve_sysroot_result
 	        func_dirname "$deplib" "" "."
-		dir="$func_dirname_result"
+		dir=$func_dirname_result
 		# We need an absolute path.
 		case $dir in
 		[\\/]* | [A-Za-z]:[\\/]*) absdir="$dir" ;;
@@ -5924,8 +7066,8 @@ func_mode_link ()
                       if test -z "$darwin_install_name"; then
                           darwin_install_name=`${OTOOL64} -L $depdepl  | awk '{if (NR == 2) {print $1;exit}}'`
                       fi
-		      compiler_flags="$compiler_flags ${wl}-dylib_file ${wl}${darwin_install_name}:${depdepl}"
-		      linker_flags="$linker_flags -dylib_file ${darwin_install_name}:${depdepl}"
+		      func_append compiler_flags " ${wl}-dylib_file ${wl}${darwin_install_name}:${depdepl}"
+		      func_append linker_flags " -dylib_file ${darwin_install_name}:${depdepl}"
 		      path=
 		    fi
 		  fi
@@ -5958,7 +7100,7 @@ func_mode_link ()
 	  compile_deplibs="$new_inherited_linker_flags $compile_deplibs"
 	  finalize_deplibs="$new_inherited_linker_flags $finalize_deplibs"
 	else
-	  compiler_flags="$compiler_flags "`$ECHO "X $new_inherited_linker_flags" | $Xsed -e 's% \([^ $]*\).ltframework% -framework \1%g'`
+	  compiler_flags="$compiler_flags "`$ECHO " $new_inherited_linker_flags" | $SED 's% \([^ $]*\).ltframework% -framework \1%g'`
 	fi
       fi
       dependency_libs="$newdependency_libs"
@@ -5975,7 +7117,7 @@ func_mode_link ()
 	  for dir in $newlib_search_path; do
 	    case "$lib_search_path " in
 	    *" $dir "*) ;;
-	    *) lib_search_path="$lib_search_path $dir" ;;
+	    *) func_append lib_search_path " $dir" ;;
 	    esac
 	  done
 	  newlib_search_path=
@@ -6033,10 +7175,10 @@ func_mode_link ()
 	    -L*)
 	      case " $tmp_libs " in
 	      *" $deplib "*) ;;
-	      *) tmp_libs="$tmp_libs $deplib" ;;
+	      *) func_append tmp_libs " $deplib" ;;
 	      esac
 	      ;;
-	    *) tmp_libs="$tmp_libs $deplib" ;;
+	    *) func_append tmp_libs " $deplib" ;;
 	    esac
 	  done
 	  eval $var=\"$tmp_libs\"
@@ -6052,7 +7194,7 @@ func_mode_link ()
 	  ;;
 	esac
 	if test -n "$i" ; then
-	  tmp_libs="$tmp_libs $i"
+	  func_append tmp_libs " $i"
 	fi
       done
       dependency_libs=$tmp_libs
@@ -6093,7 +7235,7 @@ func_mode_link ()
       # Now set the variables for building old libraries.
       build_libtool_libs=no
       oldlibs="$output"
-      objs="$objs$old_deplibs"
+      func_append objs "$old_deplibs"
       ;;
 
     lib)
@@ -6126,10 +7268,10 @@ func_mode_link ()
 	if test "$deplibs_check_method" != pass_all; then
 	  func_fatal_error "cannot build libtool library \`$output' from non-libtool objects on this host:$objs"
 	else
-	  $ECHO
+	  echo
 	  $ECHO "*** Warning: Linking the shared library $output against the non-libtool"
 	  $ECHO "*** objects $objs is not portable!"
-	  libobjs="$libobjs $objs"
+	  func_append libobjs " $objs"
 	fi
       fi
 
@@ -6188,13 +7330,14 @@ func_mode_link ()
 	  # which has an extra 1 added just for fun
 	  #
 	  case $version_type in
+	  # correct linux to gnu/linux during the next big refactor
 	  darwin|linux|osf|windows|none)
 	    func_arith $number_major + $number_minor
 	    current=$func_arith_result
 	    age="$number_minor"
 	    revision="$number_revision"
 	    ;;
-	  freebsd-aout|freebsd-elf|sunos)
+	  freebsd-aout|freebsd-elf|qnx|sunos)
 	    current="$number_major"
 	    revision="$number_minor"
 	    age="0"
@@ -6304,7 +7447,7 @@ func_mode_link ()
 	  versuffix="$major.$revision"
 	  ;;
 
-	linux)
+	linux) # correct to gnu/linux during the next big refactor
 	  func_arith $current - $age
 	  major=.$func_arith_result
 	  versuffix="$major.$age.$revision"
@@ -6327,7 +7470,7 @@ func_mode_link ()
 	  done
 
 	  # Make executables depend on our current version.
-	  verstring="$verstring:${current}.0"
+	  func_append verstring ":${current}.0"
 	  ;;
 
 	qnx)
@@ -6395,10 +7538,10 @@ func_mode_link ()
       fi
 
       func_generate_dlsyms "$libname" "$libname" "yes"
-      libobjs="$libobjs $symfileobj"
+      func_append libobjs " $symfileobj"
       test "X$libobjs" = "X " && libobjs=
 
-      if test "$mode" != relink; then
+      if test "$opt_mode" != relink; then
 	# Remove our outputs, but don't remove object files since they
 	# may have been created when compiling PIC objects.
 	removelist=
@@ -6414,7 +7557,7 @@ func_mode_link ()
 		   continue
 		 fi
 	       fi
-	       removelist="$removelist $p"
+	       func_append removelist " $p"
 	       ;;
 	    *) ;;
 	  esac
@@ -6425,27 +7568,28 @@ func_mode_link ()
 
       # Now set the variables for building old libraries.
       if test "$build_old_libs" = yes && test "$build_libtool_libs" != convenience ; then
-	oldlibs="$oldlibs $output_objdir/$libname.$libext"
+	func_append oldlibs " $output_objdir/$libname.$libext"
 
 	# Transform .lo files to .o files.
-	oldobjs="$objs "`$ECHO "X$libobjs" | $SP2NL | $Xsed -e '/\.'${libext}'$/d' -e "$lo2o" | $NL2SP`
+	oldobjs="$objs "`$ECHO "$libobjs" | $SP2NL | $SED "/\.${libext}$/d; $lo2o" | $NL2SP`
       fi
 
       # Eliminate all temporary directories.
       #for path in $notinst_path; do
-      #	lib_search_path=`$ECHO "X$lib_search_path " | $Xsed -e "s% $path % %g"`
-      #	deplibs=`$ECHO "X$deplibs " | $Xsed -e "s% -L$path % %g"`
-      #	dependency_libs=`$ECHO "X$dependency_libs " | $Xsed -e "s% -L$path % %g"`
+      #	lib_search_path=`$ECHO "$lib_search_path " | $SED "s% $path % %g"`
+      #	deplibs=`$ECHO "$deplibs " | $SED "s% -L$path % %g"`
+      #	dependency_libs=`$ECHO "$dependency_libs " | $SED "s% -L$path % %g"`
       #done
 
       if test -n "$xrpath"; then
 	# If the user specified any rpath flags, then add them.
 	temp_xrpath=
 	for libdir in $xrpath; do
-	  temp_xrpath="$temp_xrpath -R$libdir"
+	  func_replace_sysroot "$libdir"
+	  func_append temp_xrpath " -R$func_replace_sysroot_result"
 	  case "$finalize_rpath " in
 	  *" $libdir "*) ;;
-	  *) finalize_rpath="$finalize_rpath $libdir" ;;
+	  *) func_append finalize_rpath " $libdir" ;;
 	  esac
 	done
 	if test "$hardcode_into_libs" != yes || test "$build_old_libs" = yes; then
@@ -6459,7 +7603,7 @@ func_mode_link ()
       for lib in $old_dlfiles; do
 	case " $dlprefiles $dlfiles " in
 	*" $lib "*) ;;
-	*) dlfiles="$dlfiles $lib" ;;
+	*) func_append dlfiles " $lib" ;;
 	esac
       done
 
@@ -6469,19 +7613,19 @@ func_mode_link ()
       for lib in $old_dlprefiles; do
 	case "$dlprefiles " in
 	*" $lib "*) ;;
-	*) dlprefiles="$dlprefiles $lib" ;;
+	*) func_append dlprefiles " $lib" ;;
 	esac
       done
 
       if test "$build_libtool_libs" = yes; then
 	if test -n "$rpath"; then
 	  case $host in
-	  *-*-cygwin* | *-*-mingw* | *-*-pw32* | *-*-os2* | *-*-beos* | *-cegcc*)
+	  *-*-cygwin* | *-*-mingw* | *-*-pw32* | *-*-os2* | *-*-beos* | *-cegcc* | *-*-haiku*)
 	    # these systems don't actually have a c library (as such)!
 	    ;;
 	  *-*-rhapsody* | *-*-darwin1.[012])
 	    # Rhapsody C library is in the System framework
-	    deplibs="$deplibs System.ltframework"
+	    func_append deplibs " System.ltframework"
 	    ;;
 	  *-*-netbsd*)
 	    # Don't link with libc until the a.out ld.so is fixed.
@@ -6498,7 +7642,7 @@ func_mode_link ()
 	  *)
 	    # Add libc to deplibs on all other systems if necessary.
 	    if test "$build_libtool_need_lc" = "yes"; then
-	      deplibs="$deplibs -lc"
+	      func_append deplibs " -lc"
 	    fi
 	    ;;
 	  esac
@@ -6547,7 +7691,7 @@ EOF
 		if test "X$allow_libtool_libs_with_static_runtimes" = "Xyes" ; then
 		  case " $predeps $postdeps " in
 		  *" $i "*)
-		    newdeplibs="$newdeplibs $i"
+		    func_append newdeplibs " $i"
 		    i=""
 		    ;;
 		  esac
@@ -6558,21 +7702,21 @@ EOF
 		  set dummy $deplib_matches; shift
 		  deplib_match=$1
 		  if test `expr "$ldd_output" : ".*$deplib_match"` -ne 0 ; then
-		    newdeplibs="$newdeplibs $i"
+		    func_append newdeplibs " $i"
 		  else
 		    droppeddeps=yes
-		    $ECHO
+		    echo
 		    $ECHO "*** Warning: dynamic linker does not accept needed library $i."
-		    $ECHO "*** I have the capability to make that library automatically link in when"
-		    $ECHO "*** you link to this library.  But I can only do this if you have a"
-		    $ECHO "*** shared version of the library, which I believe you do not have"
-		    $ECHO "*** because a test_compile did reveal that the linker did not use it for"
-		    $ECHO "*** its dynamic dependency list that programs get resolved with at runtime."
+		    echo "*** I have the capability to make that library automatically link in when"
+		    echo "*** you link to this library.  But I can only do this if you have a"
+		    echo "*** shared version of the library, which I believe you do not have"
+		    echo "*** because a test_compile did reveal that the linker did not use it for"
+		    echo "*** its dynamic dependency list that programs get resolved with at runtime."
 		  fi
 		fi
 		;;
 	      *)
-		newdeplibs="$newdeplibs $i"
+		func_append newdeplibs " $i"
 		;;
 	      esac
 	    done
@@ -6590,7 +7734,7 @@ EOF
 		  if test "X$allow_libtool_libs_with_static_runtimes" = "Xyes" ; then
 		    case " $predeps $postdeps " in
 		    *" $i "*)
-		      newdeplibs="$newdeplibs $i"
+		      func_append newdeplibs " $i"
 		      i=""
 		      ;;
 		    esac
@@ -6601,29 +7745,29 @@ EOF
 		    set dummy $deplib_matches; shift
 		    deplib_match=$1
 		    if test `expr "$ldd_output" : ".*$deplib_match"` -ne 0 ; then
-		      newdeplibs="$newdeplibs $i"
+		      func_append newdeplibs " $i"
 		    else
 		      droppeddeps=yes
-		      $ECHO
+		      echo
 		      $ECHO "*** Warning: dynamic linker does not accept needed library $i."
-		      $ECHO "*** I have the capability to make that library automatically link in when"
-		      $ECHO "*** you link to this library.  But I can only do this if you have a"
-		      $ECHO "*** shared version of the library, which you do not appear to have"
-		      $ECHO "*** because a test_compile did reveal that the linker did not use this one"
-		      $ECHO "*** as a dynamic dependency that programs can get resolved with at runtime."
+		      echo "*** I have the capability to make that library automatically link in when"
+		      echo "*** you link to this library.  But I can only do this if you have a"
+		      echo "*** shared version of the library, which you do not appear to have"
+		      echo "*** because a test_compile did reveal that the linker did not use this one"
+		      echo "*** as a dynamic dependency that programs can get resolved with at runtime."
 		    fi
 		  fi
 		else
 		  droppeddeps=yes
-		  $ECHO
+		  echo
 		  $ECHO "*** Warning!  Library $i is needed by this library but I was not able to"
-		  $ECHO "*** make it link in!  You will probably need to install it or some"
-		  $ECHO "*** library that it depends on before this library will be fully"
-		  $ECHO "*** functional.  Installing it before continuing would be even better."
+		  echo "*** make it link in!  You will probably need to install it or some"
+		  echo "*** library that it depends on before this library will be fully"
+		  echo "*** functional.  Installing it before continuing would be even better."
 		fi
 		;;
 	      *)
-		newdeplibs="$newdeplibs $i"
+		func_append newdeplibs " $i"
 		;;
 	      esac
 	    done
@@ -6640,15 +7784,27 @@ EOF
 	      if test "X$allow_libtool_libs_with_static_runtimes" = "Xyes" ; then
 		case " $predeps $postdeps " in
 		*" $a_deplib "*)
-		  newdeplibs="$newdeplibs $a_deplib"
+		  func_append newdeplibs " $a_deplib"
 		  a_deplib=""
 		  ;;
 		esac
 	      fi
 	      if test -n "$a_deplib" ; then
 		libname=`eval "\\$ECHO \"$libname_spec\""`
+		if test -n "$file_magic_glob"; then
+		  libnameglob=`func_echo_all "$libname" | $SED -e $file_magic_glob`
+		else
+		  libnameglob=$libname
+		fi
+		test "$want_nocaseglob" = yes && nocaseglob=`shopt -p nocaseglob`
 		for i in $lib_search_path $sys_lib_search_path $shlib_search_path; do
-		  potential_libs=`ls $i/$libname[.-]* 2>/dev/null`
+		  if test "$want_nocaseglob" = yes; then
+		    shopt -s nocaseglob
+		    potential_libs=`ls $i/$libnameglob[.-]* 2>/dev/null`
+		    $nocaseglob
+		  else
+		    potential_libs=`ls $i/$libnameglob[.-]* 2>/dev/null`
+		  fi
 		  for potent_lib in $potential_libs; do
 		      # Follow soft links.
 		      if ls -lLd "$potent_lib" 2>/dev/null |
@@ -6665,13 +7821,13 @@ EOF
 			potliblink=`ls -ld $potlib | ${SED} 's/.* -> //'`
 			case $potliblink in
 			[\\/]* | [A-Za-z]:[\\/]*) potlib="$potliblink";;
-			*) potlib=`$ECHO "X$potlib" | $Xsed -e 's,[^/]*$,,'`"$potliblink";;
+			*) potlib=`$ECHO "$potlib" | $SED 's,[^/]*$,,'`"$potliblink";;
 			esac
 		      done
 		      if eval $file_magic_cmd \"\$potlib\" 2>/dev/null |
 			 $SED -e 10q |
 			 $EGREP "$file_magic_regex" > /dev/null; then
-			newdeplibs="$newdeplibs $a_deplib"
+			func_append newdeplibs " $a_deplib"
 			a_deplib=""
 			break 2
 		      fi
@@ -6680,12 +7836,12 @@ EOF
 	      fi
 	      if test -n "$a_deplib" ; then
 		droppeddeps=yes
-		$ECHO
+		echo
 		$ECHO "*** Warning: linker path does not have real file for library $a_deplib."
-		$ECHO "*** I have the capability to make that library automatically link in when"
-		$ECHO "*** you link to this library.  But I can only do this if you have a"
-		$ECHO "*** shared version of the library, which you do not appear to have"
-		$ECHO "*** because I did check the linker path looking for a file starting"
+		echo "*** I have the capability to make that library automatically link in when"
+		echo "*** you link to this library.  But I can only do this if you have a"
+		echo "*** shared version of the library, which you do not appear to have"
+		echo "*** because I did check the linker path looking for a file starting"
 		if test -z "$potlib" ; then
 		  $ECHO "*** with $libname but no candidates were found. (...for file magic test)"
 		else
@@ -6696,7 +7852,7 @@ EOF
 	      ;;
 	    *)
 	      # Add a -L argument.
-	      newdeplibs="$newdeplibs $a_deplib"
+	      func_append newdeplibs " $a_deplib"
 	      ;;
 	    esac
 	  done # Gone through all deplibs.
@@ -6712,7 +7868,7 @@ EOF
 	      if test "X$allow_libtool_libs_with_static_runtimes" = "Xyes" ; then
 		case " $predeps $postdeps " in
 		*" $a_deplib "*)
-		  newdeplibs="$newdeplibs $a_deplib"
+		  func_append newdeplibs " $a_deplib"
 		  a_deplib=""
 		  ;;
 		esac
@@ -6723,9 +7879,9 @@ EOF
 		  potential_libs=`ls $i/$libname[.-]* 2>/dev/null`
 		  for potent_lib in $potential_libs; do
 		    potlib="$potent_lib" # see symlink-check above in file_magic test
-		    if eval "\$ECHO \"X$potent_lib\"" 2>/dev/null | $Xsed -e 10q | \
+		    if eval "\$ECHO \"$potent_lib\"" 2>/dev/null | $SED 10q | \
 		       $EGREP "$match_pattern_regex" > /dev/null; then
-		      newdeplibs="$newdeplibs $a_deplib"
+		      func_append newdeplibs " $a_deplib"
 		      a_deplib=""
 		      break 2
 		    fi
@@ -6734,12 +7890,12 @@ EOF
 	      fi
 	      if test -n "$a_deplib" ; then
 		droppeddeps=yes
-		$ECHO
+		echo
 		$ECHO "*** Warning: linker path does not have real file for library $a_deplib."
-		$ECHO "*** I have the capability to make that library automatically link in when"
-		$ECHO "*** you link to this library.  But I can only do this if you have a"
-		$ECHO "*** shared version of the library, which you do not appear to have"
-		$ECHO "*** because I did check the linker path looking for a file starting"
+		echo "*** I have the capability to make that library automatically link in when"
+		echo "*** you link to this library.  But I can only do this if you have a"
+		echo "*** shared version of the library, which you do not appear to have"
+		echo "*** because I did check the linker path looking for a file starting"
 		if test -z "$potlib" ; then
 		  $ECHO "*** with $libname but no candidates were found. (...for regex pattern test)"
 		else
@@ -6750,32 +7906,32 @@ EOF
 	      ;;
 	    *)
 	      # Add a -L argument.
-	      newdeplibs="$newdeplibs $a_deplib"
+	      func_append newdeplibs " $a_deplib"
 	      ;;
 	    esac
 	  done # Gone through all deplibs.
 	  ;;
 	none | unknown | *)
 	  newdeplibs=""
-	  tmp_deplibs=`$ECHO "X $deplibs" | $Xsed \
-	      -e 's/ -lc$//' -e 's/ -[LR][^ ]*//g'`
+	  tmp_deplibs=`$ECHO " $deplibs" | $SED 's/ -lc$//; s/ -[LR][^ ]*//g'`
 	  if test "X$allow_libtool_libs_with_static_runtimes" = "Xyes" ; then
 	    for i in $predeps $postdeps ; do
 	      # can't use Xsed below, because $i might contain '/'
-	      tmp_deplibs=`$ECHO "X $tmp_deplibs" | $Xsed -e "s,$i,,"`
+	      tmp_deplibs=`$ECHO " $tmp_deplibs" | $SED "s,$i,,"`
 	    done
 	  fi
-	  if $ECHO "X $tmp_deplibs" | $Xsed -e 's/[	 ]//g' |
-	     $GREP . >/dev/null; then
-	    $ECHO
+	  case $tmp_deplibs in
+	  *[!\	\ ]*)
+	    echo
 	    if test "X$deplibs_check_method" = "Xnone"; then
-	      $ECHO "*** Warning: inter-library dependencies are not supported in this platform."
+	      echo "*** Warning: inter-library dependencies are not supported in this platform."
 	    else
-	      $ECHO "*** Warning: inter-library dependencies are not known to be supported."
+	      echo "*** Warning: inter-library dependencies are not known to be supported."
 	    fi
-	    $ECHO "*** All declared inter-library dependencies are being dropped."
+	    echo "*** All declared inter-library dependencies are being dropped."
 	    droppeddeps=yes
-	  fi
+	    ;;
+	  esac
 	  ;;
 	esac
 	versuffix=$versuffix_save
@@ -6787,23 +7943,23 @@ EOF
 	case $host in
 	*-*-rhapsody* | *-*-darwin1.[012])
 	  # On Rhapsody replace the C library with the System framework
-	  newdeplibs=`$ECHO "X $newdeplibs" | $Xsed -e 's/ -lc / System.ltframework /'`
+	  newdeplibs=`$ECHO " $newdeplibs" | $SED 's/ -lc / System.ltframework /'`
 	  ;;
 	esac
 
 	if test "$droppeddeps" = yes; then
 	  if test "$module" = yes; then
-	    $ECHO
-	    $ECHO "*** Warning: libtool could not satisfy all declared inter-library"
+	    echo
+	    echo "*** Warning: libtool could not satisfy all declared inter-library"
 	    $ECHO "*** dependencies of module $libname.  Therefore, libtool will create"
-	    $ECHO "*** a static module, that should work as long as the dlopening"
-	    $ECHO "*** application is linked with the -dlopen flag."
+	    echo "*** a static module, that should work as long as the dlopening"
+	    echo "*** application is linked with the -dlopen flag."
 	    if test -z "$global_symbol_pipe"; then
-	      $ECHO
-	      $ECHO "*** However, this would only work if libtool was able to extract symbol"
-	      $ECHO "*** lists from a program, using \`nm' or equivalent, but libtool could"
-	      $ECHO "*** not find such a program.  So, this module is probably useless."
-	      $ECHO "*** \`nm' from GNU binutils and a full rebuild may help."
+	      echo
+	      echo "*** However, this would only work if libtool was able to extract symbol"
+	      echo "*** lists from a program, using \`nm' or equivalent, but libtool could"
+	      echo "*** not find such a program.  So, this module is probably useless."
+	      echo "*** \`nm' from GNU binutils and a full rebuild may help."
 	    fi
 	    if test "$build_old_libs" = no; then
 	      oldlibs="$output_objdir/$libname.$libext"
@@ -6813,16 +7969,16 @@ EOF
 	      build_libtool_libs=no
 	    fi
 	  else
-	    $ECHO "*** The inter-library dependencies that have been dropped here will be"
-	    $ECHO "*** automatically added whenever a program is linked with this library"
-	    $ECHO "*** or is declared to -dlopen it."
+	    echo "*** The inter-library dependencies that have been dropped here will be"
+	    echo "*** automatically added whenever a program is linked with this library"
+	    echo "*** or is declared to -dlopen it."
 
 	    if test "$allow_undefined" = no; then
-	      $ECHO
-	      $ECHO "*** Since this library must not contain undefined symbols,"
-	      $ECHO "*** because either the platform does not support them or"
-	      $ECHO "*** it was explicitly requested with -no-undefined,"
-	      $ECHO "*** libtool will only create a static version of it."
+	      echo
+	      echo "*** Since this library must not contain undefined symbols,"
+	      echo "*** because either the platform does not support them or"
+	      echo "*** it was explicitly requested with -no-undefined,"
+	      echo "*** libtool will only create a static version of it."
 	      if test "$build_old_libs" = no; then
 		oldlibs="$output_objdir/$libname.$libext"
 		build_libtool_libs=module
@@ -6839,9 +7995,9 @@ EOF
       # Time to change all our "foo.ltframework" stuff back to "-framework foo"
       case $host in
 	*-*-darwin*)
-	  newdeplibs=`$ECHO "X $newdeplibs" | $Xsed -e 's% \([^ $]*\).ltframework% -framework \1%g'`
-	  new_inherited_linker_flags=`$ECHO "X $new_inherited_linker_flags" | $Xsed -e 's% \([^ $]*\).ltframework% -framework \1%g'`
-	  deplibs=`$ECHO "X $deplibs" | $Xsed -e 's% \([^ $]*\).ltframework% -framework \1%g'`
+	  newdeplibs=`$ECHO " $newdeplibs" | $SED 's% \([^ $]*\).ltframework% -framework \1%g'`
+	  new_inherited_linker_flags=`$ECHO " $new_inherited_linker_flags" | $SED 's% \([^ $]*\).ltframework% -framework \1%g'`
+	  deplibs=`$ECHO " $deplibs" | $SED 's% \([^ $]*\).ltframework% -framework \1%g'`
 	  ;;
       esac
 
@@ -6854,7 +8010,7 @@ EOF
 	*)
 	  case " $deplibs " in
 	  *" -L$path/$objdir "*)
-	    new_libs="$new_libs -L$path/$objdir" ;;
+	    func_append new_libs " -L$path/$objdir" ;;
 	  esac
 	  ;;
 	esac
@@ -6864,10 +8020,10 @@ EOF
 	-L*)
 	  case " $new_libs " in
 	  *" $deplib "*) ;;
-	  *) new_libs="$new_libs $deplib" ;;
+	  *) func_append new_libs " $deplib" ;;
 	  esac
 	  ;;
-	*) new_libs="$new_libs $deplib" ;;
+	*) func_append new_libs " $deplib" ;;
 	esac
       done
       deplibs="$new_libs"
@@ -6879,15 +8035,22 @@ EOF
 
       # Test again, we may have decided not to build it any more
       if test "$build_libtool_libs" = yes; then
+	# Remove ${wl} instances when linking with ld.
+	# FIXME: should test the right _cmds variable.
+	case $archive_cmds in
+	  *\$LD\ *) wl= ;;
+        esac
 	if test "$hardcode_into_libs" = yes; then
 	  # Hardcode the library paths
 	  hardcode_libdirs=
 	  dep_rpath=
 	  rpath="$finalize_rpath"
-	  test "$mode" != relink && rpath="$compile_rpath$rpath"
+	  test "$opt_mode" != relink && rpath="$compile_rpath$rpath"
 	  for libdir in $rpath; do
 	    if test -n "$hardcode_libdir_flag_spec"; then
 	      if test -n "$hardcode_libdir_separator"; then
+		func_replace_sysroot "$libdir"
+		libdir=$func_replace_sysroot_result
 		if test -z "$hardcode_libdirs"; then
 		  hardcode_libdirs="$libdir"
 		else
@@ -6896,18 +8059,18 @@ EOF
 		  *"$hardcode_libdir_separator$libdir$hardcode_libdir_separator"*)
 		    ;;
 		  *)
-		    hardcode_libdirs="$hardcode_libdirs$hardcode_libdir_separator$libdir"
+		    func_append hardcode_libdirs "$hardcode_libdir_separator$libdir"
 		    ;;
 		  esac
 		fi
 	      else
 		eval flag=\"$hardcode_libdir_flag_spec\"
-		dep_rpath="$dep_rpath $flag"
+		func_append dep_rpath " $flag"
 	      fi
 	    elif test -n "$runpath_var"; then
 	      case "$perm_rpath " in
 	      *" $libdir "*) ;;
-	      *) perm_rpath="$perm_rpath $libdir" ;;
+	      *) func_append perm_rpath " $libdir" ;;
 	      esac
 	    fi
 	  done
@@ -6915,17 +8078,13 @@ EOF
 	  if test -n "$hardcode_libdir_separator" &&
 	     test -n "$hardcode_libdirs"; then
 	    libdir="$hardcode_libdirs"
-	    if test -n "$hardcode_libdir_flag_spec_ld"; then
-	      eval dep_rpath=\"$hardcode_libdir_flag_spec_ld\"
-	    else
-	      eval dep_rpath=\"$hardcode_libdir_flag_spec\"
-	    fi
+	    eval "dep_rpath=\"$hardcode_libdir_flag_spec\""
 	  fi
 	  if test -n "$runpath_var" && test -n "$perm_rpath"; then
 	    # We should set the runpath_var.
 	    rpath=
 	    for dir in $perm_rpath; do
-	      rpath="$rpath$dir:"
+	      func_append rpath "$dir:"
 	    done
 	    eval "$runpath_var='$rpath\$$runpath_var'; export $runpath_var"
 	  fi
@@ -6933,7 +8092,7 @@ EOF
 	fi
 
 	shlibpath="$finalize_shlibpath"
-	test "$mode" != relink && shlibpath="$compile_shlibpath$shlibpath"
+	test "$opt_mode" != relink && shlibpath="$compile_shlibpath$shlibpath"
 	if test -n "$shlibpath"; then
 	  eval "$shlibpath_var='$shlibpath\$$shlibpath_var'; export $shlibpath_var"
 	fi
@@ -6959,18 +8118,18 @@ EOF
 	linknames=
 	for link
 	do
-	  linknames="$linknames $link"
+	  func_append linknames " $link"
 	done
 
 	# Use standard objects if they are pic
-	test -z "$pic_flag" && libobjs=`$ECHO "X$libobjs" | $SP2NL | $Xsed -e "$lo2o" | $NL2SP`
+	test -z "$pic_flag" && libobjs=`$ECHO "$libobjs" | $SP2NL | $SED "$lo2o" | $NL2SP`
 	test "X$libobjs" = "X " && libobjs=
 
 	delfiles=
 	if test -n "$export_symbols" && test -n "$include_expsyms"; then
 	  $opt_dry_run || cp "$export_symbols" "$output_objdir/$libname.uexp"
 	  export_symbols="$output_objdir/$libname.uexp"
-	  delfiles="$delfiles $export_symbols"
+	  func_append delfiles " $export_symbols"
 	fi
 
 	orig_export_symbols=
@@ -7001,13 +8160,45 @@ EOF
 	    $opt_dry_run || $RM $export_symbols
 	    cmds=$export_symbols_cmds
 	    save_ifs="$IFS"; IFS='~'
-	    for cmd in $cmds; do
+	    for cmd1 in $cmds; do
 	      IFS="$save_ifs"
-	      eval cmd=\"$cmd\"
-	      func_len " $cmd"
-	      len=$func_len_result
-	      if test "$len" -lt "$max_cmd_len" || test "$max_cmd_len" -le -1; then
+	      # Take the normal branch if the nm_file_list_spec branch
+	      # doesn't work or if tool conversion is not needed.
+	      case $nm_file_list_spec~$to_tool_file_cmd in
+		*~func_convert_file_noop | *~func_convert_file_msys_to_w32 | ~*)
+		  try_normal_branch=yes
+		  eval cmd=\"$cmd1\"
+		  func_len " $cmd"
+		  len=$func_len_result
+		  ;;
+		*)
+		  try_normal_branch=no
+		  ;;
+	      esac
+	      if test "$try_normal_branch" = yes \
+		 && { test "$len" -lt "$max_cmd_len" \
+		      || test "$max_cmd_len" -le -1; }
+	      then
+		func_show_eval "$cmd" 'exit $?'
+		skipped_export=false
+	      elif test -n "$nm_file_list_spec"; then
+		func_basename "$output"
+		output_la=$func_basename_result
+		save_libobjs=$libobjs
+		save_output=$output
+		output=${output_objdir}/${output_la}.nm
+		func_to_tool_file "$output"
+		libobjs=$nm_file_list_spec$func_to_tool_file_result
+		func_append delfiles " $output"
+		func_verbose "creating $NM input file list: $output"
+		for obj in $save_libobjs; do
+		  func_to_tool_file "$obj"
+		  $ECHO "$func_to_tool_file_result"
+		done > "$output"
+		eval cmd=\"$cmd1\"
 		func_show_eval "$cmd" 'exit $?'
+		output=$save_output
+		libobjs=$save_libobjs
 		skipped_export=false
 	      else
 		# The command line is too long to execute in one step.
@@ -7029,7 +8220,7 @@ EOF
 	if test -n "$export_symbols" && test -n "$include_expsyms"; then
 	  tmp_export_symbols="$export_symbols"
 	  test -n "$orig_export_symbols" && tmp_export_symbols="$orig_export_symbols"
-	  $opt_dry_run || eval '$ECHO "X$include_expsyms" | $Xsed | $SP2NL >> "$tmp_export_symbols"'
+	  $opt_dry_run || eval '$ECHO "$include_expsyms" | $SP2NL >> "$tmp_export_symbols"'
 	fi
 
 	if test "X$skipped_export" != "X:" && test -n "$orig_export_symbols"; then
@@ -7041,7 +8232,7 @@ EOF
 	  # global variables. join(1) would be nice here, but unfortunately
 	  # isn't a blessed tool.
 	  $opt_dry_run || $SED -e '/[ ,]DATA/!d;s,\(.*\)\([ \,].*\),s|^\1$|\1\2|,' < $export_symbols > $output_objdir/$libname.filter
-	  delfiles="$delfiles $export_symbols $output_objdir/$libname.filter"
+	  func_append delfiles " $export_symbols $output_objdir/$libname.filter"
 	  export_symbols=$output_objdir/$libname.def
 	  $opt_dry_run || $SED -f $output_objdir/$libname.filter < $orig_export_symbols > $export_symbols
 	fi
@@ -7051,7 +8242,7 @@ EOF
 	  case " $convenience " in
 	  *" $test_deplib "*) ;;
 	  *)
-	    tmp_deplibs="$tmp_deplibs $test_deplib"
+	    func_append tmp_deplibs " $test_deplib"
 	    ;;
 	  esac
 	done
@@ -7071,21 +8262,21 @@ EOF
 	    test "X$libobjs" = "X " && libobjs=
 	  else
 	    gentop="$output_objdir/${outputname}x"
-	    generated="$generated $gentop"
+	    func_append generated " $gentop"
 
 	    func_extract_archives $gentop $convenience
-	    libobjs="$libobjs $func_extract_archives_result"
+	    func_append libobjs " $func_extract_archives_result"
 	    test "X$libobjs" = "X " && libobjs=
 	  fi
 	fi
 
 	if test "$thread_safe" = yes && test -n "$thread_safe_flag_spec"; then
 	  eval flag=\"$thread_safe_flag_spec\"
-	  linker_flags="$linker_flags $flag"
+	  func_append linker_flags " $flag"
 	fi
 
 	# Make a backup of the uninstalled library when relinking
-	if test "$mode" = relink; then
+	if test "$opt_mode" = relink; then
 	  $opt_dry_run || eval '(cd $output_objdir && $RM ${realname}U && $MV $realname ${realname}U)' || exit $?
 	fi
 
@@ -7130,7 +8321,8 @@ EOF
 	    save_libobjs=$libobjs
 	  fi
 	  save_output=$output
-	  output_la=`$ECHO "X$output" | $Xsed -e "$basename"`
+	  func_basename "$output"
+	  output_la=$func_basename_result
 
 	  # Clear the reloadable object creation command queue and
 	  # initialize k to one.
@@ -7143,13 +8335,16 @@ EOF
 	  if test -n "$save_libobjs" && test "X$skipped_export" != "X:" && test "$with_gnu_ld" = yes; then
 	    output=${output_objdir}/${output_la}.lnkscript
 	    func_verbose "creating GNU ld script: $output"
-	    $ECHO 'INPUT (' > $output
+	    echo 'INPUT (' > $output
 	    for obj in $save_libobjs
 	    do
-	      $ECHO "$obj" >> $output
+	      func_to_tool_file "$obj"
+	      $ECHO "$func_to_tool_file_result" >> $output
 	    done
-	    $ECHO ')' >> $output
-	    delfiles="$delfiles $output"
+	    echo ')' >> $output
+	    func_append delfiles " $output"
+	    func_to_tool_file "$output"
+	    output=$func_to_tool_file_result
 	  elif test -n "$save_libobjs" && test "X$skipped_export" != "X:" && test "X$file_list_spec" != X; then
 	    output=${output_objdir}/${output_la}.lnk
 	    func_verbose "creating linker input file list: $output"
@@ -7163,10 +8358,12 @@ EOF
 	    fi
 	    for obj
 	    do
-	      $ECHO "$obj" >> $output
+	      func_to_tool_file "$obj"
+	      $ECHO "$func_to_tool_file_result" >> $output
 	    done
-	    delfiles="$delfiles $output"
-	    output=$firstobj\"$file_list_spec$output\"
+	    func_append delfiles " $output"
+	    func_to_tool_file "$output"
+	    output=$firstobj\"$file_list_spec$func_to_tool_file_result\"
 	  else
 	    if test -n "$save_libobjs"; then
 	      func_verbose "creating reloadable object files..."
@@ -7190,17 +8387,19 @@ EOF
 		  # command to the queue.
 		  if test "$k" -eq 1 ; then
 		    # The first file doesn't have a previous command to add.
-		    eval concat_cmds=\"$reload_cmds $objlist $last_robj\"
+		    reload_objs=$objlist
+		    eval concat_cmds=\"$reload_cmds\"
 		  else
 		    # All subsequent reloadable object files will link in
 		    # the last one created.
-		    eval concat_cmds=\"\$concat_cmds~$reload_cmds $objlist $last_robj~\$RM $last_robj\"
+		    reload_objs="$objlist $last_robj"
+		    eval concat_cmds=\"\$concat_cmds~$reload_cmds~\$RM $last_robj\"
 		  fi
 		  last_robj=$output_objdir/$output_la-${k}.$objext
 		  func_arith $k + 1
 		  k=$func_arith_result
 		  output=$output_objdir/$output_la-${k}.$objext
-		  objlist=$obj
+		  objlist=" $obj"
 		  func_len " $last_robj"
 		  func_arith $len0 + $func_len_result
 		  len=$func_arith_result
@@ -7210,11 +8409,12 @@ EOF
 	      # reloadable object file.  All subsequent reloadable object
 	      # files will link in the last one created.
 	      test -z "$concat_cmds" || concat_cmds=$concat_cmds~
-	      eval concat_cmds=\"\${concat_cmds}$reload_cmds $objlist $last_robj\"
+	      reload_objs="$objlist $last_robj"
+	      eval concat_cmds=\"\${concat_cmds}$reload_cmds\"
 	      if test -n "$last_robj"; then
 	        eval concat_cmds=\"\${concat_cmds}~\$RM $last_robj\"
 	      fi
-	      delfiles="$delfiles $output"
+	      func_append delfiles " $output"
 
 	    else
 	      output=
@@ -7248,7 +8448,7 @@ EOF
 		lt_exit=$?
 
 		# Restore the uninstalled library and exit
-		if test "$mode" = relink; then
+		if test "$opt_mode" = relink; then
 		  ( cd "$output_objdir" && \
 		    $RM "${realname}T" && \
 		    $MV "${realname}U" "$realname" )
@@ -7269,7 +8469,7 @@ EOF
 	    if test -n "$export_symbols" && test -n "$include_expsyms"; then
 	      tmp_export_symbols="$export_symbols"
 	      test -n "$orig_export_symbols" && tmp_export_symbols="$orig_export_symbols"
-	      $opt_dry_run || eval '$ECHO "X$include_expsyms" | $Xsed | $SP2NL >> "$tmp_export_symbols"'
+	      $opt_dry_run || eval '$ECHO "$include_expsyms" | $SP2NL >> "$tmp_export_symbols"'
 	    fi
 
 	    if test -n "$orig_export_symbols"; then
@@ -7281,7 +8481,7 @@ EOF
 	      # global variables. join(1) would be nice here, but unfortunately
 	      # isn't a blessed tool.
 	      $opt_dry_run || $SED -e '/[ ,]DATA/!d;s,\(.*\)\([ \,].*\),s|^\1$|\1\2|,' < $export_symbols > $output_objdir/$libname.filter
-	      delfiles="$delfiles $export_symbols $output_objdir/$libname.filter"
+	      func_append delfiles " $export_symbols $output_objdir/$libname.filter"
 	      export_symbols=$output_objdir/$libname.def
 	      $opt_dry_run || $SED -f $output_objdir/$libname.filter < $orig_export_symbols > $export_symbols
 	    fi
@@ -7322,10 +8522,10 @@ EOF
 	# Add any objects from preloaded convenience libraries
 	if test -n "$dlprefiles"; then
 	  gentop="$output_objdir/${outputname}x"
-	  generated="$generated $gentop"
+	  func_append generated " $gentop"
 
 	  func_extract_archives $gentop $dlprefiles
-	  libobjs="$libobjs $func_extract_archives_result"
+	  func_append libobjs " $func_extract_archives_result"
 	  test "X$libobjs" = "X " && libobjs=
 	fi
 
@@ -7341,7 +8541,7 @@ EOF
 	    lt_exit=$?
 
 	    # Restore the uninstalled library and exit
-	    if test "$mode" = relink; then
+	    if test "$opt_mode" = relink; then
 	      ( cd "$output_objdir" && \
 	        $RM "${realname}T" && \
 		$MV "${realname}U" "$realname" )
@@ -7353,7 +8553,7 @@ EOF
 	IFS="$save_ifs"
 
 	# Restore the uninstalled library and exit
-	if test "$mode" = relink; then
+	if test "$opt_mode" = relink; then
 	  $opt_dry_run || eval '(cd $output_objdir && $RM ${realname}T && $MV $realname ${realname}T && $MV ${realname}U $realname)' || exit $?
 
 	  if test -n "$convenience"; then
@@ -7434,18 +8634,21 @@ EOF
       if test -n "$convenience"; then
 	if test -n "$whole_archive_flag_spec"; then
 	  eval tmp_whole_archive_flags=\"$whole_archive_flag_spec\"
-	  reload_conv_objs=$reload_objs\ `$ECHO "X$tmp_whole_archive_flags" | $Xsed -e 's|,| |g'`
+	  reload_conv_objs=$reload_objs\ `$ECHO "$tmp_whole_archive_flags" | $SED 's|,| |g'`
 	else
 	  gentop="$output_objdir/${obj}x"
-	  generated="$generated $gentop"
+	  func_append generated " $gentop"
 
 	  func_extract_archives $gentop $convenience
 	  reload_conv_objs="$reload_objs $func_extract_archives_result"
 	fi
       fi
 
+      # If we're not building shared, we need to use non_pic_objs
+      test "$build_libtool_libs" != yes && libobjs="$non_pic_objects"
+
       # Create the old-style object.
-      reload_objs="$objs$old_deplibs "`$ECHO "X$libobjs" | $SP2NL | $Xsed -e '/\.'${libext}$'/d' -e '/\.lib$/d' -e "$lo2o" | $NL2SP`" $reload_conv_objs" ### testsuite: skip nested quoting test
+      reload_objs="$objs$old_deplibs "`$ECHO "$libobjs" | $SP2NL | $SED "/\.${libext}$/d; /\.lib$/d; $lo2o" | $NL2SP`" $reload_conv_objs" ### testsuite: skip nested quoting test
 
       output="$obj"
       func_execute_cmds "$reload_cmds" 'exit $?'
@@ -7505,8 +8708,8 @@ EOF
       case $host in
       *-*-rhapsody* | *-*-darwin1.[012])
 	# On Rhapsody replace the C library is the System framework
-	compile_deplibs=`$ECHO "X $compile_deplibs" | $Xsed -e 's/ -lc / System.ltframework /'`
-	finalize_deplibs=`$ECHO "X $finalize_deplibs" | $Xsed -e 's/ -lc / System.ltframework /'`
+	compile_deplibs=`$ECHO " $compile_deplibs" | $SED 's/ -lc / System.ltframework /'`
+	finalize_deplibs=`$ECHO " $finalize_deplibs" | $SED 's/ -lc / System.ltframework /'`
 	;;
       esac
 
@@ -7517,14 +8720,14 @@ EOF
 	if test "$tagname" = CXX ; then
 	  case ${MACOSX_DEPLOYMENT_TARGET-10.0} in
 	    10.[0123])
-	      compile_command="$compile_command ${wl}-bind_at_load"
-	      finalize_command="$finalize_command ${wl}-bind_at_load"
+	      func_append compile_command " ${wl}-bind_at_load"
+	      func_append finalize_command " ${wl}-bind_at_load"
 	    ;;
 	  esac
 	fi
 	# Time to change all our "foo.ltframework" stuff back to "-framework foo"
-	compile_deplibs=`$ECHO "X $compile_deplibs" | $Xsed -e 's% \([^ $]*\).ltframework% -framework \1%g'`
-	finalize_deplibs=`$ECHO "X $finalize_deplibs" | $Xsed -e 's% \([^ $]*\).ltframework% -framework \1%g'`
+	compile_deplibs=`$ECHO " $compile_deplibs" | $SED 's% \([^ $]*\).ltframework% -framework \1%g'`
+	finalize_deplibs=`$ECHO " $finalize_deplibs" | $SED 's% \([^ $]*\).ltframework% -framework \1%g'`
 	;;
       esac
 
@@ -7538,7 +8741,7 @@ EOF
 	*)
 	  case " $compile_deplibs " in
 	  *" -L$path/$objdir "*)
-	    new_libs="$new_libs -L$path/$objdir" ;;
+	    func_append new_libs " -L$path/$objdir" ;;
 	  esac
 	  ;;
 	esac
@@ -7548,17 +8751,17 @@ EOF
 	-L*)
 	  case " $new_libs " in
 	  *" $deplib "*) ;;
-	  *) new_libs="$new_libs $deplib" ;;
+	  *) func_append new_libs " $deplib" ;;
 	  esac
 	  ;;
-	*) new_libs="$new_libs $deplib" ;;
+	*) func_append new_libs " $deplib" ;;
 	esac
       done
       compile_deplibs="$new_libs"
 
 
-      compile_command="$compile_command $compile_deplibs"
-      finalize_command="$finalize_command $finalize_deplibs"
+      func_append compile_command " $compile_deplibs"
+      func_append finalize_command " $finalize_deplibs"
 
       if test -n "$rpath$xrpath"; then
 	# If the user specified any rpath flags, then add them.
@@ -7566,7 +8769,7 @@ EOF
 	  # This is the magic to use -rpath.
 	  case "$finalize_rpath " in
 	  *" $libdir "*) ;;
-	  *) finalize_rpath="$finalize_rpath $libdir" ;;
+	  *) func_append finalize_rpath " $libdir" ;;
 	  esac
 	done
       fi
@@ -7585,18 +8788,18 @@ EOF
 	      *"$hardcode_libdir_separator$libdir$hardcode_libdir_separator"*)
 		;;
 	      *)
-		hardcode_libdirs="$hardcode_libdirs$hardcode_libdir_separator$libdir"
+		func_append hardcode_libdirs "$hardcode_libdir_separator$libdir"
 		;;
 	      esac
 	    fi
 	  else
 	    eval flag=\"$hardcode_libdir_flag_spec\"
-	    rpath="$rpath $flag"
+	    func_append rpath " $flag"
 	  fi
 	elif test -n "$runpath_var"; then
 	  case "$perm_rpath " in
 	  *" $libdir "*) ;;
-	  *) perm_rpath="$perm_rpath $libdir" ;;
+	  *) func_append perm_rpath " $libdir" ;;
 	  esac
 	fi
 	case $host in
@@ -7605,12 +8808,12 @@ EOF
 	  case :$dllsearchpath: in
 	  *":$libdir:"*) ;;
 	  ::) dllsearchpath=$libdir;;
-	  *) dllsearchpath="$dllsearchpath:$libdir";;
+	  *) func_append dllsearchpath ":$libdir";;
 	  esac
 	  case :$dllsearchpath: in
 	  *":$testbindir:"*) ;;
 	  ::) dllsearchpath=$testbindir;;
-	  *) dllsearchpath="$dllsearchpath:$testbindir";;
+	  *) func_append dllsearchpath ":$testbindir";;
 	  esac
 	  ;;
 	esac
@@ -7636,18 +8839,18 @@ EOF
 	      *"$hardcode_libdir_separator$libdir$hardcode_libdir_separator"*)
 		;;
 	      *)
-		hardcode_libdirs="$hardcode_libdirs$hardcode_libdir_separator$libdir"
+		func_append hardcode_libdirs "$hardcode_libdir_separator$libdir"
 		;;
 	      esac
 	    fi
 	  else
 	    eval flag=\"$hardcode_libdir_flag_spec\"
-	    rpath="$rpath $flag"
+	    func_append rpath " $flag"
 	  fi
 	elif test -n "$runpath_var"; then
 	  case "$finalize_perm_rpath " in
 	  *" $libdir "*) ;;
-	  *) finalize_perm_rpath="$finalize_perm_rpath $libdir" ;;
+	  *) func_append finalize_perm_rpath " $libdir" ;;
 	  esac
 	fi
       done
@@ -7661,8 +8864,8 @@ EOF
 
       if test -n "$libobjs" && test "$build_old_libs" = yes; then
 	# Transform all the library objects into standard objects.
-	compile_command=`$ECHO "X$compile_command" | $SP2NL | $Xsed -e "$lo2o" | $NL2SP`
-	finalize_command=`$ECHO "X$finalize_command" | $SP2NL | $Xsed -e "$lo2o" | $NL2SP`
+	compile_command=`$ECHO "$compile_command" | $SP2NL | $SED "$lo2o" | $NL2SP`
+	finalize_command=`$ECHO "$finalize_command" | $SP2NL | $SED "$lo2o" | $NL2SP`
       fi
 
       func_generate_dlsyms "$outputname" "@PROGRAM@" "no"
@@ -7674,15 +8877,15 @@ EOF
 
       wrappers_required=yes
       case $host in
+      *cegcc* | *mingw32ce*)
+        # Disable wrappers for cegcc and mingw32ce hosts, we are cross compiling anyway.
+        wrappers_required=no
+        ;;
       *cygwin* | *mingw* )
         if test "$build_libtool_libs" != yes; then
           wrappers_required=no
         fi
         ;;
-      *cegcc)
-        # Disable wrappers for cegcc, we are cross compiling anyway.
-        wrappers_required=no
-        ;;
       *)
         if test "$need_relink" = no || test "$build_libtool_libs" != yes; then
           wrappers_required=no
@@ -7691,13 +8894,19 @@ EOF
       esac
       if test "$wrappers_required" = no; then
 	# Replace the output file specification.
-	compile_command=`$ECHO "X$compile_command" | $Xsed -e 's%@OUTPUT@%'"$output"'%g'`
+	compile_command=`$ECHO "$compile_command" | $SED 's%@OUTPUT@%'"$output"'%g'`
 	link_command="$compile_command$compile_rpath"
 
 	# We have no uninstalled library dependencies, so finalize right now.
 	exit_status=0
 	func_show_eval "$link_command" 'exit_status=$?'
 
+	if test -n "$postlink_cmds"; then
+	  func_to_tool_file "$output"
+	  postlink_cmds=`func_echo_all "$postlink_cmds" | $SED -e 's%@OUTPUT@%'"$output"'%g' -e 's%@TOOL_OUTPUT@%'"$func_to_tool_file_result"'%g'`
+	  func_execute_cmds "$postlink_cmds" 'exit $?'
+	fi
+
 	# Delete the generated files.
 	if test -f "$output_objdir/${outputname}S.${objext}"; then
 	  func_show_eval '$RM "$output_objdir/${outputname}S.${objext}"'
@@ -7720,7 +8929,7 @@ EOF
 	  # We should set the runpath_var.
 	  rpath=
 	  for dir in $perm_rpath; do
-	    rpath="$rpath$dir:"
+	    func_append rpath "$dir:"
 	  done
 	  compile_var="$runpath_var=\"$rpath\$$runpath_var\" "
 	fi
@@ -7728,7 +8937,7 @@ EOF
 	  # We should set the runpath_var.
 	  rpath=
 	  for dir in $finalize_perm_rpath; do
-	    rpath="$rpath$dir:"
+	    func_append rpath "$dir:"
 	  done
 	  finalize_var="$runpath_var=\"$rpath\$$runpath_var\" "
 	fi
@@ -7738,11 +8947,18 @@ EOF
 	# We don't need to create a wrapper script.
 	link_command="$compile_var$compile_command$compile_rpath"
 	# Replace the output file specification.
-	link_command=`$ECHO "X$link_command" | $Xsed -e 's%@OUTPUT@%'"$output"'%g'`
+	link_command=`$ECHO "$link_command" | $SED 's%@OUTPUT@%'"$output"'%g'`
 	# Delete the old output file.
 	$opt_dry_run || $RM $output
 	# Link the executable and exit
 	func_show_eval "$link_command" 'exit $?'
+
+	if test -n "$postlink_cmds"; then
+	  func_to_tool_file "$output"
+	  postlink_cmds=`func_echo_all "$postlink_cmds" | $SED -e 's%@OUTPUT@%'"$output"'%g' -e 's%@TOOL_OUTPUT@%'"$func_to_tool_file_result"'%g'`
+	  func_execute_cmds "$postlink_cmds" 'exit $?'
+	fi
+
 	exit $EXIT_SUCCESS
       fi
 
@@ -7757,7 +8973,7 @@ EOF
 	if test "$fast_install" != no; then
 	  link_command="$finalize_var$compile_command$finalize_rpath"
 	  if test "$fast_install" = yes; then
-	    relink_command=`$ECHO "X$compile_var$compile_command$compile_rpath" | $Xsed -e 's%@OUTPUT@%\$progdir/\$file%g'`
+	    relink_command=`$ECHO "$compile_var$compile_command$compile_rpath" | $SED 's%@OUTPUT@%\$progdir/\$file%g'`
 	  else
 	    # fast_install is set to needless
 	    relink_command=
@@ -7769,13 +8985,19 @@ EOF
       fi
 
       # Replace the output file specification.
-      link_command=`$ECHO "X$link_command" | $Xsed -e 's%@OUTPUT@%'"$output_objdir/$outputname"'%g'`
+      link_command=`$ECHO "$link_command" | $SED 's%@OUTPUT@%'"$output_objdir/$outputname"'%g'`
 
       # Delete the old output files.
       $opt_dry_run || $RM $output $output_objdir/$outputname $output_objdir/lt-$outputname
 
       func_show_eval "$link_command" 'exit $?'
 
+      if test -n "$postlink_cmds"; then
+	func_to_tool_file "$output_objdir/$outputname"
+	postlink_cmds=`func_echo_all "$postlink_cmds" | $SED -e 's%@OUTPUT@%'"$output_objdir/$outputname"'%g' -e 's%@TOOL_OUTPUT@%'"$func_to_tool_file_result"'%g'`
+	func_execute_cmds "$postlink_cmds" 'exit $?'
+      fi
+
       # Now create the wrapper script.
       func_verbose "creating $output"
 
@@ -7793,18 +9015,7 @@ EOF
 	  fi
 	done
 	relink_command="(cd `pwd`; $relink_command)"
-	relink_command=`$ECHO "X$relink_command" | $Xsed -e "$sed_quote_subst"`
-      fi
-
-      # Quote $ECHO for shipping.
-      if test "X$ECHO" = "X$SHELL $progpath --fallback-echo"; then
-	case $progpath in
-	[\\/]* | [A-Za-z]:[\\/]*) qecho="$SHELL $progpath --fallback-echo";;
-	*) qecho="$SHELL `pwd`/$progpath --fallback-echo";;
-	esac
-	qecho=`$ECHO "X$qecho" | $Xsed -e "$sed_quote_subst"`
-      else
-	qecho=`$ECHO "X$ECHO" | $Xsed -e "$sed_quote_subst"`
+	relink_command=`$ECHO "$relink_command" | $SED "$sed_quote_subst"`
       fi
 
       # Only actually do things if not in dry run mode.
@@ -7884,7 +9095,7 @@ EOF
 	else
 	  oldobjs="$old_deplibs $non_pic_objects"
 	  if test "$preload" = yes && test -f "$symfileobj"; then
-	    oldobjs="$oldobjs $symfileobj"
+	    func_append oldobjs " $symfileobj"
 	  fi
 	fi
 	addlibs="$old_convenience"
@@ -7892,10 +9103,10 @@ EOF
 
       if test -n "$addlibs"; then
 	gentop="$output_objdir/${outputname}x"
-	generated="$generated $gentop"
+	func_append generated " $gentop"
 
 	func_extract_archives $gentop $addlibs
-	oldobjs="$oldobjs $func_extract_archives_result"
+	func_append oldobjs " $func_extract_archives_result"
       fi
 
       # Do each command in the archive commands.
@@ -7906,10 +9117,10 @@ EOF
 	# Add any objects from preloaded convenience libraries
 	if test -n "$dlprefiles"; then
 	  gentop="$output_objdir/${outputname}x"
-	  generated="$generated $gentop"
+	  func_append generated " $gentop"
 
 	  func_extract_archives $gentop $dlprefiles
-	  oldobjs="$oldobjs $func_extract_archives_result"
+	  func_append oldobjs " $func_extract_archives_result"
 	fi
 
 	# POSIX demands no paths to be encoded in archives.  We have
@@ -7925,9 +9136,9 @@ EOF
 	    done | sort | sort -uc >/dev/null 2>&1); then
 	  :
 	else
-	  $ECHO "copying selected object files to avoid basename conflicts..."
+	  echo "copying selected object files to avoid basename conflicts..."
 	  gentop="$output_objdir/${outputname}x"
-	  generated="$generated $gentop"
+	  func_append generated " $gentop"
 	  func_mkdir_p "$gentop"
 	  save_oldobjs=$oldobjs
 	  oldobjs=
@@ -7951,18 +9162,30 @@ EOF
 		esac
 	      done
 	      func_show_eval "ln $obj $gentop/$newobj || cp $obj $gentop/$newobj"
-	      oldobjs="$oldobjs $gentop/$newobj"
+	      func_append oldobjs " $gentop/$newobj"
 	      ;;
-	    *) oldobjs="$oldobjs $obj" ;;
+	    *) func_append oldobjs " $obj" ;;
 	    esac
 	  done
 	fi
+	func_to_tool_file "$oldlib" func_convert_file_msys_to_w32
+	tool_oldlib=$func_to_tool_file_result
 	eval cmds=\"$old_archive_cmds\"
 
 	func_len " $cmds"
 	len=$func_len_result
 	if test "$len" -lt "$max_cmd_len" || test "$max_cmd_len" -le -1; then
 	  cmds=$old_archive_cmds
+	elif test -n "$archiver_list_spec"; then
+	  func_verbose "using command file archive linking..."
+	  for obj in $oldobjs
+	  do
+	    func_to_tool_file "$obj"
+	    $ECHO "$func_to_tool_file_result"
+	  done > $output_objdir/$libname.libcmd
+	  func_to_tool_file "$output_objdir/$libname.libcmd"
+	  oldobjs=" $archiver_list_spec$func_to_tool_file_result"
+	  cmds=$old_archive_cmds
 	else
 	  # the command line is too long to link in one step, link in parts
 	  func_verbose "using piecewise archive linking..."
@@ -8036,7 +9259,7 @@ EOF
       done
       # Quote the link command for shipping.
       relink_command="(cd `pwd`; $SHELL $progpath $preserve_args --mode=relink $libtool_args @inst_prefix_dir@)"
-      relink_command=`$ECHO "X$relink_command" | $Xsed -e "$sed_quote_subst"`
+      relink_command=`$ECHO "$relink_command" | $SED "$sed_quote_subst"`
       if test "$hardcode_automatic" = yes ; then
 	relink_command=
       fi
@@ -8056,12 +9279,23 @@ EOF
 	      *.la)
 		func_basename "$deplib"
 		name="$func_basename_result"
-		eval libdir=`${SED} -n -e 's/^libdir=\(.*\)$/\1/p' $deplib`
+		func_resolve_sysroot "$deplib"
+		eval libdir=`${SED} -n -e 's/^libdir=\(.*\)$/\1/p' $func_resolve_sysroot_result`
 		test -z "$libdir" && \
 		  func_fatal_error "\`$deplib' is not a valid libtool archive"
-		newdependency_libs="$newdependency_libs $libdir/$name"
+		func_append newdependency_libs " ${lt_sysroot:+=}$libdir/$name"
+		;;
+	      -L*)
+		func_stripname -L '' "$deplib"
+		func_replace_sysroot "$func_stripname_result"
+		func_append newdependency_libs " -L$func_replace_sysroot_result"
 		;;
-	      *) newdependency_libs="$newdependency_libs $deplib" ;;
+	      -R*)
+		func_stripname -R '' "$deplib"
+		func_replace_sysroot "$func_stripname_result"
+		func_append newdependency_libs " -R$func_replace_sysroot_result"
+		;;
+	      *) func_append newdependency_libs " $deplib" ;;
 	      esac
 	    done
 	    dependency_libs="$newdependency_libs"
@@ -8075,9 +9309,9 @@ EOF
 		eval libdir=`${SED} -n -e 's/^libdir=\(.*\)$/\1/p' $lib`
 		test -z "$libdir" && \
 		  func_fatal_error "\`$lib' is not a valid libtool archive"
-		newdlfiles="$newdlfiles $libdir/$name"
+		func_append newdlfiles " ${lt_sysroot:+=}$libdir/$name"
 		;;
-	      *) newdlfiles="$newdlfiles $lib" ;;
+	      *) func_append newdlfiles " $lib" ;;
 	      esac
 	    done
 	    dlfiles="$newdlfiles"
@@ -8094,7 +9328,7 @@ EOF
 		eval libdir=`${SED} -n -e 's/^libdir=\(.*\)$/\1/p' $lib`
 		test -z "$libdir" && \
 		  func_fatal_error "\`$lib' is not a valid libtool archive"
-		newdlprefiles="$newdlprefiles $libdir/$name"
+		func_append newdlprefiles " ${lt_sysroot:+=}$libdir/$name"
 		;;
 	      esac
 	    done
@@ -8106,7 +9340,7 @@ EOF
 		[\\/]* | [A-Za-z]:[\\/]*) abs="$lib" ;;
 		*) abs=`pwd`"/$lib" ;;
 	      esac
-	      newdlfiles="$newdlfiles $abs"
+	      func_append newdlfiles " $abs"
 	    done
 	    dlfiles="$newdlfiles"
 	    newdlprefiles=
@@ -8115,15 +9349,33 @@ EOF
 		[\\/]* | [A-Za-z]:[\\/]*) abs="$lib" ;;
 		*) abs=`pwd`"/$lib" ;;
 	      esac
-	      newdlprefiles="$newdlprefiles $abs"
+	      func_append newdlprefiles " $abs"
 	    done
 	    dlprefiles="$newdlprefiles"
 	  fi
 	  $RM $output
 	  # place dlname in correct position for cygwin
+	  # In fact, it would be nice if we could use this code for all target
+	  # systems that can't hard-code library paths into their executables
+	  # and that have no shared library path variable independent of PATH,
+	  # but it turns out we can't easily determine that from inspecting
+	  # libtool variables, so we have to hard-code the OSs to which it
+	  # applies here; at the moment, that means platforms that use the PE
+	  # object format with DLL files.  See the long comment at the top of
+	  # tests/bindir.at for full details.
 	  tdlname=$dlname
 	  case $host,$output,$installed,$module,$dlname in
-	    *cygwin*,*lai,yes,no,*.dll | *mingw*,*lai,yes,no,*.dll | *cegcc*,*lai,yes,no,*.dll) tdlname=../bin/$dlname ;;
+	    *cygwin*,*lai,yes,no,*.dll | *mingw*,*lai,yes,no,*.dll | *cegcc*,*lai,yes,no,*.dll)
+	      # If a -bindir argument was supplied, place the dll there.
+	      if test "x$bindir" != x ;
+	      then
+		func_relative_path "$install_libdir" "$bindir"
+		tdlname=$func_relative_path_result$dlname
+	      else
+		# Otherwise fall back on heuristic.
+		tdlname=../bin/$dlname
+	      fi
+	      ;;
 	  esac
 	  $ECHO > $output "\
 # $outputname - a libtool library file
@@ -8182,7 +9434,7 @@ relink_command=\"$relink_command\""
     exit $EXIT_SUCCESS
 }
 
-{ test "$mode" = link || test "$mode" = relink; } &&
+{ test "$opt_mode" = link || test "$opt_mode" = relink; } &&
     func_mode_link ${1+"$@"}
 
 
@@ -8202,9 +9454,9 @@ func_mode_uninstall ()
     for arg
     do
       case $arg in
-      -f) RM="$RM $arg"; rmforce=yes ;;
-      -*) RM="$RM $arg" ;;
-      *) files="$files $arg" ;;
+      -f) func_append RM " $arg"; rmforce=yes ;;
+      -*) func_append RM " $arg" ;;
+      *) func_append files " $arg" ;;
       esac
     done
 
@@ -8213,24 +9465,23 @@ func_mode_uninstall ()
 
     rmdirs=
 
-    origobjdir="$objdir"
     for file in $files; do
       func_dirname "$file" "" "."
       dir="$func_dirname_result"
       if test "X$dir" = X.; then
-	objdir="$origobjdir"
+	odir="$objdir"
       else
-	objdir="$dir/$origobjdir"
+	odir="$dir/$objdir"
       fi
       func_basename "$file"
       name="$func_basename_result"
-      test "$mode" = uninstall && objdir="$dir"
+      test "$opt_mode" = uninstall && odir="$dir"
 
-      # Remember objdir for removal later, being careful to avoid duplicates
-      if test "$mode" = clean; then
+      # Remember odir for removal later, being careful to avoid duplicates
+      if test "$opt_mode" = clean; then
 	case " $rmdirs " in
-	  *" $objdir "*) ;;
-	  *) rmdirs="$rmdirs $objdir" ;;
+	  *" $odir "*) ;;
+	  *) func_append rmdirs " $odir" ;;
 	esac
       fi
 
@@ -8256,18 +9507,17 @@ func_mode_uninstall ()
 
 	  # Delete the libtool libraries and symlinks.
 	  for n in $library_names; do
-	    rmfiles="$rmfiles $objdir/$n"
+	    func_append rmfiles " $odir/$n"
 	  done
-	  test -n "$old_library" && rmfiles="$rmfiles $objdir/$old_library"
+	  test -n "$old_library" && func_append rmfiles " $odir/$old_library"
 
-	  case "$mode" in
+	  case "$opt_mode" in
 	  clean)
-	    case "  $library_names " in
-	    # "  " in the beginning catches empty $dlname
+	    case " $library_names " in
 	    *" $dlname "*) ;;
-	    *) rmfiles="$rmfiles $objdir/$dlname" ;;
+	    *) test -n "$dlname" && func_append rmfiles " $odir/$dlname" ;;
 	    esac
-	    test -n "$libdir" && rmfiles="$rmfiles $objdir/$name $objdir/${name}i"
+	    test -n "$libdir" && func_append rmfiles " $odir/$name $odir/${name}i"
 	    ;;
 	  uninstall)
 	    if test -n "$library_names"; then
@@ -8295,19 +9545,19 @@ func_mode_uninstall ()
 	  # Add PIC object to the list of files to remove.
 	  if test -n "$pic_object" &&
 	     test "$pic_object" != none; then
-	    rmfiles="$rmfiles $dir/$pic_object"
+	    func_append rmfiles " $dir/$pic_object"
 	  fi
 
 	  # Add non-PIC object to the list of files to remove.
 	  if test -n "$non_pic_object" &&
 	     test "$non_pic_object" != none; then
-	    rmfiles="$rmfiles $dir/$non_pic_object"
+	    func_append rmfiles " $dir/$non_pic_object"
 	  fi
 	fi
 	;;
 
       *)
-	if test "$mode" = clean ; then
+	if test "$opt_mode" = clean ; then
 	  noexename=$name
 	  case $file in
 	  *.exe)
@@ -8317,7 +9567,7 @@ func_mode_uninstall ()
 	    noexename=$func_stripname_result
 	    # $file with .exe has already been added to rmfiles,
 	    # add $file without .exe
-	    rmfiles="$rmfiles $file"
+	    func_append rmfiles " $file"
 	    ;;
 	  esac
 	  # Do a test to see if this is a libtool program.
@@ -8326,7 +9576,7 @@ func_mode_uninstall ()
 	      func_ltwrapper_scriptname "$file"
 	      relink_command=
 	      func_source $func_ltwrapper_scriptname_result
-	      rmfiles="$rmfiles $func_ltwrapper_scriptname_result"
+	      func_append rmfiles " $func_ltwrapper_scriptname_result"
 	    else
 	      relink_command=
 	      func_source $dir/$noexename
@@ -8334,12 +9584,12 @@ func_mode_uninstall ()
 
 	    # note $name still contains .exe if it was in $file originally
 	    # as does the version of $file that was added into $rmfiles
-	    rmfiles="$rmfiles $objdir/$name $objdir/${name}S.${objext}"
+	    func_append rmfiles " $odir/$name $odir/${name}S.${objext}"
 	    if test "$fast_install" = yes && test -n "$relink_command"; then
-	      rmfiles="$rmfiles $objdir/lt-$name"
+	      func_append rmfiles " $odir/lt-$name"
 	    fi
 	    if test "X$noexename" != "X$name" ; then
-	      rmfiles="$rmfiles $objdir/lt-${noexename}.c"
+	      func_append rmfiles " $odir/lt-${noexename}.c"
 	    fi
 	  fi
 	fi
@@ -8347,7 +9597,6 @@ func_mode_uninstall ()
       esac
       func_show_eval "$RM $rmfiles" 'exit_status=1'
     done
-    objdir="$origobjdir"
 
     # Try to remove the ${objdir}s in the directories where we deleted files
     for dir in $rmdirs; do
@@ -8359,16 +9608,16 @@ func_mode_uninstall ()
     exit $exit_status
 }
 
-{ test "$mode" = uninstall || test "$mode" = clean; } &&
+{ test "$opt_mode" = uninstall || test "$opt_mode" = clean; } &&
     func_mode_uninstall ${1+"$@"}
 
-test -z "$mode" && {
+test -z "$opt_mode" && {
   help="$generic_help"
   func_fatal_help "you must specify a MODE"
 }
 
 test -z "$exec_cmd" && \
-  func_fatal_help "invalid operation mode \`$mode'"
+  func_fatal_help "invalid operation mode \`$opt_mode'"
 
 if test -n "$exec_cmd"; then
   eval exec "$exec_cmd"
diff -urpN xfsprogs-4.9.0/m4/Makefile xfsprogs-4.14.0/m4/Makefile
--- xfsprogs-4.9.0/m4/Makefile	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/m4/Makefile	2017-11-27 17:57:55.000000000 +0100
@@ -18,6 +18,7 @@ LSRCFILES = \
 	package_globals.m4 \
 	package_libcdev.m4 \
 	package_pthread.m4 \
+	package_sanitizer.m4 \
 	package_types.m4 \
 	package_utilies.m4 \
 	package_uuiddev.m4 \
diff -urpN xfsprogs-4.9.0/m4/libtool.m4 xfsprogs-4.14.0/m4/libtool.m4
--- xfsprogs-4.9.0/m4/libtool.m4	2017-01-05 23:33:45.000000000 +0100
+++ xfsprogs-4.14.0/m4/libtool.m4	2017-11-27 17:58:09.000000000 +0100
@@ -1,7 +1,8 @@
 # libtool.m4 - Configure libtool for the host system. -*-Autoconf-*-
 #
 #   Copyright (C) 1996, 1997, 1998, 1999, 2000, 2001, 2003, 2004, 2005,
-#                 2006, 2007, 2008 Free Software Foundation, Inc.
+#                 2006, 2007, 2008, 2009, 2010, 2011 Free Software
+#                 Foundation, Inc.
 #   Written by Gordon Matzigkeit, 1996
 #
 # This file is free software; the Free Software Foundation gives
@@ -10,7 +11,8 @@
 
 m4_define([_LT_COPYING], [dnl
 #   Copyright (C) 1996, 1997, 1998, 1999, 2000, 2001, 2003, 2004, 2005,
-#                 2006, 2007, 2008 Free Software Foundation, Inc.
+#                 2006, 2007, 2008, 2009, 2010, 2011 Free Software
+#                 Foundation, Inc.
 #   Written by Gordon Matzigkeit, 1996
 #
 #   This file is part of GNU Libtool.
@@ -37,7 +39,7 @@ m4_define([_LT_COPYING], [dnl
 # 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
 ])
 
-# serial 56 LT_INIT
+# serial 57 LT_INIT
 
 
 # LT_PREREQ(VERSION)
@@ -66,6 +68,7 @@ esac
 # ------------------
 AC_DEFUN([LT_INIT],
 [AC_PREREQ([2.58])dnl We use AC_INCLUDES_DEFAULT
+AC_REQUIRE([AC_CONFIG_AUX_DIR_DEFAULT])dnl
 AC_BEFORE([$0], [LT_LANG])dnl
 AC_BEFORE([$0], [LT_OUTPUT])dnl
 AC_BEFORE([$0], [LTDL_INIT])dnl
@@ -82,6 +85,8 @@ AC_REQUIRE([LTVERSION_VERSION])dnl
 AC_REQUIRE([LTOBSOLETE_VERSION])dnl
 m4_require([_LT_PROG_LTMAIN])dnl
 
+_LT_SHELL_INIT([SHELL=${CONFIG_SHELL-/bin/sh}])
+
 dnl Parse OPTIONS
 _LT_SET_OPTIONS([$0], [$1])
 
@@ -118,7 +123,7 @@ m4_defun([_LT_CC_BASENAME],
     *) break;;
   esac
 done
-cc_basename=`$ECHO "X$cc_temp" | $Xsed -e 's%.*/%%' -e "s%^$host_alias-%%"`
+cc_basename=`$ECHO "$cc_temp" | $SED "s%.*/%%; s%^$host_alias-%%"`
 ])
 
 
@@ -138,6 +143,11 @@ m4_defun([_LT_FILEUTILS_DEFAULTS],
 m4_defun([_LT_SETUP],
 [AC_REQUIRE([AC_CANONICAL_HOST])dnl
 AC_REQUIRE([AC_CANONICAL_BUILD])dnl
+AC_REQUIRE([_LT_PREPARE_SED_QUOTE_VARS])dnl
+AC_REQUIRE([_LT_PROG_ECHO_BACKSLASH])dnl
+
+_LT_DECL([], [PATH_SEPARATOR], [1], [The PATH separator for the build system])dnl
+dnl
 _LT_DECL([], [host_alias], [0], [The host system])dnl
 _LT_DECL([], [host], [0])dnl
 _LT_DECL([], [host_os], [0])dnl
@@ -160,10 +170,13 @@ _LT_DECL([], [exeext], [0], [Executable
 dnl
 m4_require([_LT_FILEUTILS_DEFAULTS])dnl
 m4_require([_LT_CHECK_SHELL_FEATURES])dnl
+m4_require([_LT_PATH_CONVERSION_FUNCTIONS])dnl
 m4_require([_LT_CMD_RELOAD])dnl
 m4_require([_LT_CHECK_MAGIC_METHOD])dnl
+m4_require([_LT_CHECK_SHAREDLIB_FROM_LINKLIB])dnl
 m4_require([_LT_CMD_OLD_ARCHIVE])dnl
 m4_require([_LT_CMD_GLOBAL_SYMBOLS])dnl
+m4_require([_LT_WITH_SYSROOT])dnl
 
 _LT_CONFIG_LIBTOOL_INIT([
 # See if we are running on zsh, and set the options which allow our
@@ -179,7 +192,6 @@ fi
 _LT_CHECK_OBJDIR
 
 m4_require([_LT_TAG_COMPILER])dnl
-_LT_PROG_ECHO_BACKSLASH
 
 case $host_os in
 aix3*)
@@ -193,23 +205,6 @@ aix3*)
   ;;
 esac
 
-# Sed substitution that helps us do robust quoting.  It backslashifies
-# metacharacters that are still active within double-quoted strings.
-sed_quote_subst='s/\([["`$\\]]\)/\\\1/g'
-
-# Same as above, but do not quote variable references.
-double_quote_subst='s/\([["`\\]]\)/\\\1/g'
-
-# Sed substitution to delay expansion of an escaped shell variable in a
-# double_quote_subst'ed string.
-delay_variable_subst='s/\\\\\\\\\\\$/\\\\\\$/g'
-
-# Sed substitution to delay expansion of an escaped single quote.
-delay_single_quote_subst='s/'\''/'\'\\\\\\\'\''/g'
-
-# Sed substitution to avoid accidental globbing in evaled expressions
-no_glob_subst='s/\*/\\\*/g'
-
 # Global variables:
 ofile=libtool
 can_build_shared=yes
@@ -250,6 +245,28 @@ _LT_CONFIG_COMMANDS
 ])# _LT_SETUP
 
 
+# _LT_PREPARE_SED_QUOTE_VARS
+# --------------------------
+# Define a few sed substitution that help us do robust quoting.
+m4_defun([_LT_PREPARE_SED_QUOTE_VARS],
+[# Backslashify metacharacters that are still active within
+# double-quoted strings.
+sed_quote_subst='s/\([["`$\\]]\)/\\\1/g'
+
+# Same as above, but do not quote variable references.
+double_quote_subst='s/\([["`\\]]\)/\\\1/g'
+
+# Sed substitution to delay expansion of an escaped shell variable in a
+# double_quote_subst'ed string.
+delay_variable_subst='s/\\\\\\\\\\\$/\\\\\\$/g'
+
+# Sed substitution to delay expansion of an escaped single quote.
+delay_single_quote_subst='s/'\''/'\'\\\\\\\'\''/g'
+
+# Sed substitution to avoid accidental globbing in evaled expressions
+no_glob_subst='s/\*/\\\*/g'
+])
+
 # _LT_PROG_LTMAIN
 # ---------------
 # Note that this code is called both from `configure', and `config.status'
@@ -408,7 +425,7 @@ m4_define([_lt_decl_all_varnames],
 # declaration there will have the same value as in `configure'.  VARNAME
 # must have a single quote delimited value for this to work.
 m4_define([_LT_CONFIG_STATUS_DECLARE],
-[$1='`$ECHO "X$][$1" | $Xsed -e "$delay_single_quote_subst"`'])
+[$1='`$ECHO "$][$1" | $SED "$delay_single_quote_subst"`'])
 
 
 # _LT_CONFIG_STATUS_DECLARATIONS
@@ -418,7 +435,7 @@ m4_define([_LT_CONFIG_STATUS_DECLARE],
 # embedded single quotes properly.  In configure, this macro expands
 # each variable declared with _LT_DECL (and _LT_TAGDECL) into:
 #
-#    <var>='`$ECHO "X$<var>" | $Xsed -e "$delay_single_quote_subst"`'
+#    <var>='`$ECHO "$<var>" | $SED "$delay_single_quote_subst"`'
 m4_defun([_LT_CONFIG_STATUS_DECLARATIONS],
 [m4_foreach([_lt_var], m4_quote(lt_decl_all_varnames),
     [m4_n([_LT_CONFIG_STATUS_DECLARE(_lt_var)])])])
@@ -517,12 +534,20 @@ LTCC='$LTCC'
 LTCFLAGS='$LTCFLAGS'
 compiler='$compiler_DEFAULT'
 
+# A function that is used when there is no print builtin or printf.
+func_fallback_echo ()
+{
+  eval 'cat <<_LTECHO_EOF
+\$[]1
+_LTECHO_EOF'
+}
+
 # Quote evaled strings.
 for var in lt_decl_all_varnames([[ \
 ]], lt_decl_quote_varnames); do
-    case \`eval \\\\\$ECHO "X\\\\\$\$var"\` in
+    case \`eval \\\\\$ECHO \\\\""\\\\\$\$var"\\\\"\` in
     *[[\\\\\\\`\\"\\\$]]*)
-      eval "lt_\$var=\\\\\\"\\\`\\\$ECHO \\"X\\\$\$var\\" | \\\$Xsed -e \\"\\\$sed_quote_subst\\"\\\`\\\\\\""
+      eval "lt_\$var=\\\\\\"\\\`\\\$ECHO \\"\\\$\$var\\" | \\\$SED \\"\\\$sed_quote_subst\\"\\\`\\\\\\""
       ;;
     *)
       eval "lt_\$var=\\\\\\"\\\$\$var\\\\\\""
@@ -533,9 +558,9 @@ done
 # Double-quote double-evaled strings.
 for var in lt_decl_all_varnames([[ \
 ]], lt_decl_dquote_varnames); do
-    case \`eval \\\\\$ECHO "X\\\\\$\$var"\` in
+    case \`eval \\\\\$ECHO \\\\""\\\\\$\$var"\\\\"\` in
     *[[\\\\\\\`\\"\\\$]]*)
-      eval "lt_\$var=\\\\\\"\\\`\\\$ECHO \\"X\\\$\$var\\" | \\\$Xsed -e \\"\\\$double_quote_subst\\" -e \\"\\\$sed_quote_subst\\" -e \\"\\\$delay_variable_subst\\"\\\`\\\\\\""
+      eval "lt_\$var=\\\\\\"\\\`\\\$ECHO \\"\\\$\$var\\" | \\\$SED -e \\"\\\$double_quote_subst\\" -e \\"\\\$sed_quote_subst\\" -e \\"\\\$delay_variable_subst\\"\\\`\\\\\\""
       ;;
     *)
       eval "lt_\$var=\\\\\\"\\\$\$var\\\\\\""
@@ -543,16 +568,38 @@ for var in lt_decl_all_varnames([[ \
     esac
 done
 
-# Fix-up fallback echo if it was mangled by the above quoting rules.
-case \$lt_ECHO in
-*'\\\[$]0 --fallback-echo"')dnl "
-  lt_ECHO=\`\$ECHO "X\$lt_ECHO" | \$Xsed -e 's/\\\\\\\\\\\\\\\[$]0 --fallback-echo"\[$]/\[$]0 --fallback-echo"/'\`
-  ;;
-esac
-
 _LT_OUTPUT_LIBTOOL_INIT
 ])
 
+# _LT_GENERATED_FILE_INIT(FILE, [COMMENT])
+# ------------------------------------
+# Generate a child script FILE with all initialization necessary to
+# reuse the environment learned by the parent script, and make the
+# file executable.  If COMMENT is supplied, it is inserted after the
+# `#!' sequence but before initialization text begins.  After this
+# macro, additional text can be appended to FILE to form the body of
+# the child script.  The macro ends with non-zero status if the
+# file could not be fully written (such as if the disk is full).
+m4_ifdef([AS_INIT_GENERATED],
+[m4_defun([_LT_GENERATED_FILE_INIT],[AS_INIT_GENERATED($@)])],
+[m4_defun([_LT_GENERATED_FILE_INIT],
+[m4_require([AS_PREPARE])]dnl
+[m4_pushdef([AS_MESSAGE_LOG_FD])]dnl
+[lt_write_fail=0
+cat >$1 <<_ASEOF || lt_write_fail=1
+#! $SHELL
+# Generated by $as_me.
+$2
+SHELL=\${CONFIG_SHELL-$SHELL}
+export SHELL
+_ASEOF
+cat >>$1 <<\_ASEOF || lt_write_fail=1
+AS_SHELL_SANITIZE
+_AS_PREPARE
+exec AS_MESSAGE_FD>&1
+_ASEOF
+test $lt_write_fail = 0 && chmod +x $1[]dnl
+m4_popdef([AS_MESSAGE_LOG_FD])])])# _LT_GENERATED_FILE_INIT
 
 # LT_OUTPUT
 # ---------
@@ -562,20 +609,11 @@ _LT_OUTPUT_LIBTOOL_INIT
 AC_DEFUN([LT_OUTPUT],
 [: ${CONFIG_LT=./config.lt}
 AC_MSG_NOTICE([creating $CONFIG_LT])
-cat >"$CONFIG_LT" <<_LTEOF
-#! $SHELL
-# Generated by $as_me.
-# Run this file to recreate a libtool stub with the current configuration.
-
-lt_cl_silent=false
-SHELL=\${CONFIG_SHELL-$SHELL}
-_LTEOF
+_LT_GENERATED_FILE_INIT(["$CONFIG_LT"],
+[# Run this file to recreate a libtool stub with the current configuration.])
 
 cat >>"$CONFIG_LT" <<\_LTEOF
-AS_SHELL_SANITIZE
-_AS_PREPARE
-
-exec AS_MESSAGE_FD>&1
+lt_cl_silent=false
 exec AS_MESSAGE_LOG_FD>>config.log
 {
   echo
@@ -601,7 +639,7 @@ m4_ifset([AC_PACKAGE_NAME], [AC_PACKAGE_
 m4_ifset([AC_PACKAGE_VERSION], [ AC_PACKAGE_VERSION])
 configured by $[0], generated by m4_PACKAGE_STRING.
 
-Copyright (C) 2008 Free Software Foundation, Inc.
+Copyright (C) 2011 Free Software Foundation, Inc.
 This config.lt script is free software; the Free Software Foundation
 gives unlimited permision to copy, distribute and modify it."
 
@@ -646,15 +684,13 @@ chmod +x "$CONFIG_LT"
 # appending to config.log, which fails on DOS, as config.log is still kept
 # open by configure.  Here we exec the FD to /dev/null, effectively closing
 # config.log, so it can be properly (re)opened and appended to by config.lt.
-if test "$no_create" != yes; then
-  lt_cl_success=:
-  test "$silent" = yes &&
-    lt_config_lt_args="$lt_config_lt_args --quiet"
-  exec AS_MESSAGE_LOG_FD>/dev/null
-  $SHELL "$CONFIG_LT" $lt_config_lt_args || lt_cl_success=false
-  exec AS_MESSAGE_LOG_FD>>config.log
-  $lt_cl_success || AS_EXIT(1)
-fi
+lt_cl_success=:
+test "$silent" = yes &&
+  lt_config_lt_args="$lt_config_lt_args --quiet"
+exec AS_MESSAGE_LOG_FD>/dev/null
+$SHELL "$CONFIG_LT" $lt_config_lt_args || lt_cl_success=false
+exec AS_MESSAGE_LOG_FD>>config.log
+$lt_cl_success || AS_EXIT(1)
 ])# LT_OUTPUT
 
 
@@ -717,15 +753,12 @@ _LT_EOF
   # if finds mixed CR/LF and LF-only lines.  Since sed operates in
   # text mode, it properly converts lines to CR/LF.  This bash problem
   # is reportedly fixed, but why not run on old versions too?
-  sed '/^# Generated shell functions inserted here/q' "$ltmain" >> "$cfgfile" \
-    || (rm -f "$cfgfile"; exit 1)
-
-  _LT_PROG_XSI_SHELLFNS
+  sed '$q' "$ltmain" >> "$cfgfile" \
+     || (rm -f "$cfgfile"; exit 1)
 
-  sed -n '/^# Generated shell functions inserted here/,$p' "$ltmain" >> "$cfgfile" \
-    || (rm -f "$cfgfile"; exit 1)
+  _LT_PROG_REPLACE_SHELLFNS
 
-  mv -f "$cfgfile" "$ofile" ||
+   mv -f "$cfgfile" "$ofile" ||
     (rm -f "$ofile" && cp "$cfgfile" "$ofile" && rm -f "$cfgfile")
   chmod +x "$ofile"
 ],
@@ -770,6 +803,7 @@ AC_DEFUN([LT_LANG],
 m4_case([$1],
   [C],			[_LT_LANG(C)],
   [C++],		[_LT_LANG(CXX)],
+  [Go],			[_LT_LANG(GO)],
   [Java],		[_LT_LANG(GCJ)],
   [Fortran 77],		[_LT_LANG(F77)],
   [Fortran],		[_LT_LANG(FC)],
@@ -791,6 +825,31 @@ m4_defun([_LT_LANG],
 ])# _LT_LANG
 
 
+m4_ifndef([AC_PROG_GO], [
+############################################################
+# NOTE: This macro has been submitted for inclusion into   #
+#  GNU Autoconf as AC_PROG_GO.  When it is available in    #
+#  a released version of Autoconf we should remove this    #
+#  macro and use it instead.                               #
+############################################################
+m4_defun([AC_PROG_GO],
+[AC_LANG_PUSH(Go)dnl
+AC_ARG_VAR([GOC],     [Go compiler command])dnl
+AC_ARG_VAR([GOFLAGS], [Go compiler flags])dnl
+_AC_ARG_VAR_LDFLAGS()dnl
+AC_CHECK_TOOL(GOC, gccgo)
+if test -z "$GOC"; then
+  if test -n "$ac_tool_prefix"; then
+    AC_CHECK_PROG(GOC, [${ac_tool_prefix}gccgo], [${ac_tool_prefix}gccgo])
+  fi
+fi
+if test -z "$GOC"; then
+  AC_CHECK_PROG(GOC, gccgo, gccgo, false)
+fi
+])#m4_defun
+])#m4_ifndef
+
+
 # _LT_LANG_DEFAULT_CONFIG
 # -----------------------
 m4_defun([_LT_LANG_DEFAULT_CONFIG],
@@ -821,6 +880,10 @@ AC_PROVIDE_IFELSE([AC_PROG_GCJ],
        m4_ifdef([LT_PROG_GCJ],
 	[m4_define([LT_PROG_GCJ], defn([LT_PROG_GCJ])[LT_LANG(GCJ)])])])])])
 
+AC_PROVIDE_IFELSE([AC_PROG_GO],
+  [LT_LANG(GO)],
+  [m4_define([AC_PROG_GO], defn([AC_PROG_GO])[LT_LANG(GO)])])
+
 AC_PROVIDE_IFELSE([LT_PROG_RC],
   [LT_LANG(RC)],
   [m4_define([LT_PROG_RC], defn([LT_PROG_RC])[LT_LANG(RC)])])
@@ -831,11 +894,13 @@ AU_DEFUN([AC_LIBTOOL_CXX], [LT_LANG(C++)
 AU_DEFUN([AC_LIBTOOL_F77], [LT_LANG(Fortran 77)])
 AU_DEFUN([AC_LIBTOOL_FC], [LT_LANG(Fortran)])
 AU_DEFUN([AC_LIBTOOL_GCJ], [LT_LANG(Java)])
+AU_DEFUN([AC_LIBTOOL_RC], [LT_LANG(Windows Resource)])
 dnl aclocal-1.4 backwards compatibility:
 dnl AC_DEFUN([AC_LIBTOOL_CXX], [])
 dnl AC_DEFUN([AC_LIBTOOL_F77], [])
 dnl AC_DEFUN([AC_LIBTOOL_FC], [])
 dnl AC_DEFUN([AC_LIBTOOL_GCJ], [])
+dnl AC_DEFUN([AC_LIBTOOL_RC], [])
 
 
 # _LT_TAG_COMPILER
@@ -921,7 +986,13 @@ m4_defun_once([_LT_REQUIRED_DARWIN_CHECK
 	$LTCC $LTCFLAGS $LDFLAGS -o libconftest.dylib \
 	  -dynamiclib -Wl,-single_module conftest.c 2>conftest.err
         _lt_result=$?
-	if test -f libconftest.dylib && test ! -s conftest.err && test $_lt_result = 0; then
+	# If there is a non-empty error log, and "single_module"
+	# appears in it, assume the flag caused a linker warning
+        if test -s conftest.err && $GREP single_module conftest.err; then
+	  cat conftest.err >&AS_MESSAGE_LOG_FD
+	# Otherwise, if the output was created with a 0 exit code from
+	# the compiler, it worked.
+	elif test -f libconftest.dylib && test $_lt_result -eq 0; then
 	  lt_cv_apple_cc_single_mod=yes
 	else
 	  cat conftest.err >&AS_MESSAGE_LOG_FD
@@ -929,6 +1000,7 @@ m4_defun_once([_LT_REQUIRED_DARWIN_CHECK
 	rm -rf libconftest.dylib*
 	rm -f conftest.*
       fi])
+
     AC_CACHE_CHECK([for -exported_symbols_list linker flag],
       [lt_cv_ld_exported_symbols_list],
       [lt_cv_ld_exported_symbols_list=no
@@ -940,6 +1012,34 @@ m4_defun_once([_LT_REQUIRED_DARWIN_CHECK
 	[lt_cv_ld_exported_symbols_list=no])
 	LDFLAGS="$save_LDFLAGS"
     ])
+
+    AC_CACHE_CHECK([for -force_load linker flag],[lt_cv_ld_force_load],
+      [lt_cv_ld_force_load=no
+      cat > conftest.c << _LT_EOF
+int forced_loaded() { return 2;}
+_LT_EOF
+      echo "$LTCC $LTCFLAGS -c -o conftest.o conftest.c" >&AS_MESSAGE_LOG_FD
+      $LTCC $LTCFLAGS -c -o conftest.o conftest.c 2>&AS_MESSAGE_LOG_FD
+      echo "$AR cru libconftest.a conftest.o" >&AS_MESSAGE_LOG_FD
+      $AR cru libconftest.a conftest.o 2>&AS_MESSAGE_LOG_FD
+      echo "$RANLIB libconftest.a" >&AS_MESSAGE_LOG_FD
+      $RANLIB libconftest.a 2>&AS_MESSAGE_LOG_FD
+      cat > conftest.c << _LT_EOF
+int main() { return 0;}
+_LT_EOF
+      echo "$LTCC $LTCFLAGS $LDFLAGS -o conftest conftest.c -Wl,-force_load,./libconftest.a" >&AS_MESSAGE_LOG_FD
+      $LTCC $LTCFLAGS $LDFLAGS -o conftest conftest.c -Wl,-force_load,./libconftest.a 2>conftest.err
+      _lt_result=$?
+      if test -s conftest.err && $GREP force_load conftest.err; then
+	cat conftest.err >&AS_MESSAGE_LOG_FD
+      elif test -f conftest && test $_lt_result -eq 0 && $GREP forced_load conftest >/dev/null 2>&1 ; then
+	lt_cv_ld_force_load=yes
+      else
+	cat conftest.err >&AS_MESSAGE_LOG_FD
+      fi
+        rm -f conftest.err libconftest.a conftest conftest.c
+        rm -rf conftest.dSYM
+    ])
     case $host_os in
     rhapsody* | darwin1.[[012]])
       _lt_dar_allow_undefined='${wl}-undefined ${wl}suppress' ;;
@@ -967,7 +1067,7 @@ m4_defun_once([_LT_REQUIRED_DARWIN_CHECK
     else
       _lt_dar_export_syms='~$NMEDIT -s $output_objdir/${libname}-symbols.expsym ${lib}'
     fi
-    if test "$DSYMUTIL" != ":"; then
+    if test "$DSYMUTIL" != ":" && test "$lt_cv_ld_force_load" = "no"; then
       _lt_dsymutil='~$DSYMUTIL $lib || :'
     else
       _lt_dsymutil=
@@ -977,8 +1077,8 @@ m4_defun_once([_LT_REQUIRED_DARWIN_CHECK
 ])
 
 
-# _LT_DARWIN_LINKER_FEATURES
-# --------------------------
+# _LT_DARWIN_LINKER_FEATURES([TAG])
+# ---------------------------------
 # Checks for linker and compiler features on darwin
 m4_defun([_LT_DARWIN_LINKER_FEATURES],
 [
@@ -987,7 +1087,13 @@ m4_defun([_LT_DARWIN_LINKER_FEATURES],
   _LT_TAGVAR(hardcode_direct, $1)=no
   _LT_TAGVAR(hardcode_automatic, $1)=yes
   _LT_TAGVAR(hardcode_shlibpath_var, $1)=unsupported
-  _LT_TAGVAR(whole_archive_flag_spec, $1)=''
+  if test "$lt_cv_ld_force_load" = "yes"; then
+    _LT_TAGVAR(whole_archive_flag_spec, $1)='`for conv in $convenience\"\"; do test  -n \"$conv\" && new_convenience=\"$new_convenience ${wl}-force_load,$conv\"; done; func_echo_all \"$new_convenience\"`'
+    m4_case([$1], [F77], [_LT_TAGVAR(compiler_needs_object, $1)=yes],
+                  [FC],  [_LT_TAGVAR(compiler_needs_object, $1)=yes])
+  else
+    _LT_TAGVAR(whole_archive_flag_spec, $1)=''
+  fi
   _LT_TAGVAR(link_all_deplibs, $1)=yes
   _LT_TAGVAR(allow_undefined_flag, $1)="$_lt_dar_allow_undefined"
   case $cc_basename in
@@ -995,7 +1101,7 @@ m4_defun([_LT_DARWIN_LINKER_FEATURES],
      *) _lt_dar_can_shared=$GCC ;;
   esac
   if test "$_lt_dar_can_shared" = "yes"; then
-    output_verbose_link_cmd=echo
+    output_verbose_link_cmd=func_echo_all
     _LT_TAGVAR(archive_cmds, $1)="\$CC -dynamiclib \$allow_undefined_flag -o \$lib \$libobjs \$deplibs \$compiler_flags -install_name \$rpath/\$soname \$verstring $_lt_dar_single_mod${_lt_dsymutil}"
     _LT_TAGVAR(module_cmds, $1)="\$CC \$allow_undefined_flag -o \$lib -bundle \$libobjs \$deplibs \$compiler_flags${_lt_dsymutil}"
     _LT_TAGVAR(archive_expsym_cmds, $1)="sed 's,^,_,' < \$export_symbols > \$output_objdir/\${libname}-symbols.expsym~\$CC -dynamiclib \$allow_undefined_flag -o \$lib \$libobjs \$deplibs \$compiler_flags -install_name \$rpath/\$soname \$verstring ${_lt_dar_single_mod}${_lt_dar_export_syms}${_lt_dsymutil}"
@@ -1011,203 +1117,142 @@ m4_defun([_LT_DARWIN_LINKER_FEATURES],
   fi
 ])
 
-# _LT_SYS_MODULE_PATH_AIX
-# -----------------------
+# _LT_SYS_MODULE_PATH_AIX([TAGNAME])
+# ----------------------------------
 # Links a minimal program and checks the executable
 # for the system default hardcoded library path. In most cases,
 # this is /usr/lib:/lib, but when the MPI compilers are used
 # the location of the communication and MPI libs are included too.
 # If we don't find anything, use the default library path according
 # to the aix ld manual.
+# Store the results from the different compilers for each TAGNAME.
+# Allow to override them for all tags through lt_cv_aix_libpath.
 m4_defun([_LT_SYS_MODULE_PATH_AIX],
 [m4_require([_LT_DECL_SED])dnl
-AC_LINK_IFELSE(AC_LANG_PROGRAM,[
-lt_aix_libpath_sed='
-    /Import File Strings/,/^$/ {
-	/^0/ {
-	    s/^0  *\(.*\)$/\1/
-	    p
-	}
-    }'
-aix_libpath=`dump -H conftest$ac_exeext 2>/dev/null | $SED -n -e "$lt_aix_libpath_sed"`
-# Check for a 64-bit object if we didn't find anything.
-if test -z "$aix_libpath"; then
-  aix_libpath=`dump -HX64 conftest$ac_exeext 2>/dev/null | $SED -n -e "$lt_aix_libpath_sed"`
-fi],[])
-if test -z "$aix_libpath"; then aix_libpath="/usr/lib:/lib"; fi
+if test "${lt_cv_aix_libpath+set}" = set; then
+  aix_libpath=$lt_cv_aix_libpath
+else
+  AC_CACHE_VAL([_LT_TAGVAR([lt_cv_aix_libpath_], [$1])],
+  [AC_LINK_IFELSE([AC_LANG_PROGRAM],[
+  lt_aix_libpath_sed='[
+      /Import File Strings/,/^$/ {
+	  /^0/ {
+	      s/^0  *\([^ ]*\) *$/\1/
+	      p
+	  }
+      }]'
+  _LT_TAGVAR([lt_cv_aix_libpath_], [$1])=`dump -H conftest$ac_exeext 2>/dev/null | $SED -n -e "$lt_aix_libpath_sed"`
+  # Check for a 64-bit object if we didn't find anything.
+  if test -z "$_LT_TAGVAR([lt_cv_aix_libpath_], [$1])"; then
+    _LT_TAGVAR([lt_cv_aix_libpath_], [$1])=`dump -HX64 conftest$ac_exeext 2>/dev/null | $SED -n -e "$lt_aix_libpath_sed"`
+  fi],[])
+  if test -z "$_LT_TAGVAR([lt_cv_aix_libpath_], [$1])"; then
+    _LT_TAGVAR([lt_cv_aix_libpath_], [$1])="/usr/lib:/lib"
+  fi
+  ])
+  aix_libpath=$_LT_TAGVAR([lt_cv_aix_libpath_], [$1])
+fi
 ])# _LT_SYS_MODULE_PATH_AIX
 
 
 # _LT_SHELL_INIT(ARG)
 # -------------------
 m4_define([_LT_SHELL_INIT],
-[ifdef([AC_DIVERSION_NOTICE],
-	     [AC_DIVERT_PUSH(AC_DIVERSION_NOTICE)],
-	 [AC_DIVERT_PUSH(NOTICE)])
-$1
-AC_DIVERT_POP
-])# _LT_SHELL_INIT
+[m4_divert_text([M4SH-INIT], [$1
+])])# _LT_SHELL_INIT
+
 
 
 # _LT_PROG_ECHO_BACKSLASH
 # -----------------------
-# Add some code to the start of the generated configure script which
-# will find an echo command which doesn't interpret backslashes.
+# Find how we can fake an echo command that does not interpret backslash.
+# In particular, with Autoconf 2.60 or later we add some code to the start
+# of the generated configure script which will find a shell with a builtin
+# printf (which we can use as an echo command).
 m4_defun([_LT_PROG_ECHO_BACKSLASH],
-[_LT_SHELL_INIT([
-# Check that we are running under the correct shell.
-SHELL=${CONFIG_SHELL-/bin/sh}
-
-case X$lt_ECHO in
-X*--fallback-echo)
-  # Remove one level of quotation (which was required for Make).
-  ECHO=`echo "$lt_ECHO" | sed 's,\\\\\[$]\\[$]0,'[$]0','`
-  ;;
-esac
-
-ECHO=${lt_ECHO-echo}
-if test "X[$]1" = X--no-reexec; then
-  # Discard the --no-reexec flag, and continue.
-  shift
-elif test "X[$]1" = X--fallback-echo; then
-  # Avoid inline document here, it may be left over
-  :
-elif test "X`{ $ECHO '\t'; } 2>/dev/null`" = 'X\t' ; then
-  # Yippee, $ECHO works!
-  :
+[ECHO='\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\'
+ECHO=$ECHO$ECHO$ECHO$ECHO$ECHO
+ECHO=$ECHO$ECHO$ECHO$ECHO$ECHO$ECHO
+
+AC_MSG_CHECKING([how to print strings])
+# Test print first, because it will be a builtin if present.
+if test "X`( print -r -- -n ) 2>/dev/null`" = X-n && \
+   test "X`print -r -- $ECHO 2>/dev/null`" = "X$ECHO"; then
+  ECHO='print -r --'
+elif test "X`printf %s $ECHO 2>/dev/null`" = "X$ECHO"; then
+  ECHO='printf %s\n'
 else
-  # Restart under the correct shell.
-  exec $SHELL "[$]0" --no-reexec ${1+"[$]@"}
-fi
-
-if test "X[$]1" = X--fallback-echo; then
-  # used as fallback echo
-  shift
-  cat <<_LT_EOF
-[$]*
-_LT_EOF
-  exit 0
+  # Use this function as a fallback that always works.
+  func_fallback_echo ()
+  {
+    eval 'cat <<_LTECHO_EOF
+$[]1
+_LTECHO_EOF'
+  }
+  ECHO='func_fallback_echo'
 fi
 
-# The HP-UX ksh and POSIX shell print the target directory to stdout
-# if CDPATH is set.
-(unset CDPATH) >/dev/null 2>&1 && unset CDPATH
-
-if test -z "$lt_ECHO"; then
-  if test "X${echo_test_string+set}" != Xset; then
-    # find a string as large as possible, as long as the shell can cope with it
-    for cmd in 'sed 50q "[$]0"' 'sed 20q "[$]0"' 'sed 10q "[$]0"' 'sed 2q "[$]0"' 'echo test'; do
-      # expected sizes: less than 2Kb, 1Kb, 512 bytes, 16 bytes, ...
-      if { echo_test_string=`eval $cmd`; } 2>/dev/null &&
-	 { test "X$echo_test_string" = "X$echo_test_string"; } 2>/dev/null
-      then
-        break
-      fi
-    done
-  fi
-
-  if test "X`{ $ECHO '\t'; } 2>/dev/null`" = 'X\t' &&
-     echo_testing_string=`{ $ECHO "$echo_test_string"; } 2>/dev/null` &&
-     test "X$echo_testing_string" = "X$echo_test_string"; then
-    :
-  else
-    # The Solaris, AIX, and Digital Unix default echo programs unquote
-    # backslashes.  This makes it impossible to quote backslashes using
-    #   echo "$something" | sed 's/\\/\\\\/g'
-    #
-    # So, first we look for a working echo in the user's PATH.
-
-    lt_save_ifs="$IFS"; IFS=$PATH_SEPARATOR
-    for dir in $PATH /usr/ucb; do
-      IFS="$lt_save_ifs"
-      if (test -f $dir/echo || test -f $dir/echo$ac_exeext) &&
-         test "X`($dir/echo '\t') 2>/dev/null`" = 'X\t' &&
-         echo_testing_string=`($dir/echo "$echo_test_string") 2>/dev/null` &&
-         test "X$echo_testing_string" = "X$echo_test_string"; then
-        ECHO="$dir/echo"
-        break
-      fi
-    done
-    IFS="$lt_save_ifs"
-
-    if test "X$ECHO" = Xecho; then
-      # We didn't find a better echo, so look for alternatives.
-      if test "X`{ print -r '\t'; } 2>/dev/null`" = 'X\t' &&
-         echo_testing_string=`{ print -r "$echo_test_string"; } 2>/dev/null` &&
-         test "X$echo_testing_string" = "X$echo_test_string"; then
-        # This shell has a builtin print -r that does the trick.
-        ECHO='print -r'
-      elif { test -f /bin/ksh || test -f /bin/ksh$ac_exeext; } &&
-	   test "X$CONFIG_SHELL" != X/bin/ksh; then
-        # If we have ksh, try running configure again with it.
-        ORIGINAL_CONFIG_SHELL=${CONFIG_SHELL-/bin/sh}
-        export ORIGINAL_CONFIG_SHELL
-        CONFIG_SHELL=/bin/ksh
-        export CONFIG_SHELL
-        exec $CONFIG_SHELL "[$]0" --no-reexec ${1+"[$]@"}
-      else
-        # Try using printf.
-        ECHO='printf %s\n'
-        if test "X`{ $ECHO '\t'; } 2>/dev/null`" = 'X\t' &&
-	   echo_testing_string=`{ $ECHO "$echo_test_string"; } 2>/dev/null` &&
-	   test "X$echo_testing_string" = "X$echo_test_string"; then
-	  # Cool, printf works
-	  :
-        elif echo_testing_string=`($ORIGINAL_CONFIG_SHELL "[$]0" --fallback-echo '\t') 2>/dev/null` &&
-	     test "X$echo_testing_string" = 'X\t' &&
-	     echo_testing_string=`($ORIGINAL_CONFIG_SHELL "[$]0" --fallback-echo "$echo_test_string") 2>/dev/null` &&
-	     test "X$echo_testing_string" = "X$echo_test_string"; then
-	  CONFIG_SHELL=$ORIGINAL_CONFIG_SHELL
-	  export CONFIG_SHELL
-	  SHELL="$CONFIG_SHELL"
-	  export SHELL
-	  ECHO="$CONFIG_SHELL [$]0 --fallback-echo"
-        elif echo_testing_string=`($CONFIG_SHELL "[$]0" --fallback-echo '\t') 2>/dev/null` &&
-	     test "X$echo_testing_string" = 'X\t' &&
-	     echo_testing_string=`($CONFIG_SHELL "[$]0" --fallback-echo "$echo_test_string") 2>/dev/null` &&
-	     test "X$echo_testing_string" = "X$echo_test_string"; then
-	  ECHO="$CONFIG_SHELL [$]0 --fallback-echo"
-        else
-	  # maybe with a smaller string...
-	  prev=:
-
-	  for cmd in 'echo test' 'sed 2q "[$]0"' 'sed 10q "[$]0"' 'sed 20q "[$]0"' 'sed 50q "[$]0"'; do
-	    if { test "X$echo_test_string" = "X`eval $cmd`"; } 2>/dev/null
-	    then
-	      break
-	    fi
-	    prev="$cmd"
-	  done
+# func_echo_all arg...
+# Invoke $ECHO with all args, space-separated.
+func_echo_all ()
+{
+    $ECHO "$*" 
+}
 
-	  if test "$prev" != 'sed 50q "[$]0"'; then
-	    echo_test_string=`eval $prev`
-	    export echo_test_string
-	    exec ${ORIGINAL_CONFIG_SHELL-${CONFIG_SHELL-/bin/sh}} "[$]0" ${1+"[$]@"}
-	  else
-	    # Oops.  We lost completely, so just stick with echo.
-	    ECHO=echo
-	  fi
-        fi
-      fi
-    fi
-  fi
-fi
+case "$ECHO" in
+  printf*) AC_MSG_RESULT([printf]) ;;
+  print*) AC_MSG_RESULT([print -r]) ;;
+  *) AC_MSG_RESULT([cat]) ;;
+esac
 
-# Copy echo and quote the copy suitably for passing to libtool from
-# the Makefile, instead of quoting the original, which is used later.
-lt_ECHO=$ECHO
-if test "X$lt_ECHO" = "X$CONFIG_SHELL [$]0 --fallback-echo"; then
-   lt_ECHO="$CONFIG_SHELL \\\$\[$]0 --fallback-echo"
-fi
+m4_ifdef([_AS_DETECT_SUGGESTED],
+[_AS_DETECT_SUGGESTED([
+  test -n "${ZSH_VERSION+set}${BASH_VERSION+set}" || (
+    ECHO='\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\'
+    ECHO=$ECHO$ECHO$ECHO$ECHO$ECHO
+    ECHO=$ECHO$ECHO$ECHO$ECHO$ECHO$ECHO
+    PATH=/empty FPATH=/empty; export PATH FPATH
+    test "X`printf %s $ECHO`" = "X$ECHO" \
+      || test "X`print -r -- $ECHO`" = "X$ECHO" )])])
 
-AC_SUBST(lt_ECHO)
-])
 _LT_DECL([], [SHELL], [1], [Shell to use when invoking shell scripts])
-_LT_DECL([], [ECHO], [1],
-    [An echo program that does not interpret backslashes])
+_LT_DECL([], [ECHO], [1], [An echo program that protects backslashes])
 ])# _LT_PROG_ECHO_BACKSLASH
 
 
+# _LT_WITH_SYSROOT
+# ----------------
+AC_DEFUN([_LT_WITH_SYSROOT],
+[AC_MSG_CHECKING([for sysroot])
+AC_ARG_WITH([sysroot],
+[  --with-sysroot[=DIR] Search for dependent libraries within DIR
+                        (or the compiler's sysroot if not specified).],
+[], [with_sysroot=no])
+
+dnl lt_sysroot will always be passed unquoted.  We quote it here
+dnl in case the user passed a directory name.
+lt_sysroot=
+case ${with_sysroot} in #(
+ yes)
+   if test "$GCC" = yes; then
+     lt_sysroot=`$CC --print-sysroot 2>/dev/null`
+   fi
+   ;; #(
+ /*)
+   lt_sysroot=`echo "$with_sysroot" | sed -e "$sed_quote_subst"`
+   ;; #(
+ no|'')
+   ;; #(
+ *)
+   AC_MSG_RESULT([${with_sysroot}])
+   AC_MSG_ERROR([The sysroot must be an absolute path.])
+   ;;
+esac
+
+ AC_MSG_RESULT([${lt_sysroot:-no}])
+_LT_DECL([], [lt_sysroot], [0], [The root where to search for ]dnl
+[dependent libraries, and in which our libraries should be installed.])])
+
 # _LT_ENABLE_LOCK
 # ---------------
 m4_defun([_LT_ENABLE_LOCK],
@@ -1236,7 +1281,7 @@ ia64-*-hpux*)
   ;;
 *-*-irix6*)
   # Find out which ABI we are using.
-  echo '[#]line __oline__ "configure"' > conftest.$ac_ext
+  echo '[#]line '$LINENO' "configure"' > conftest.$ac_ext
   if AC_TRY_EVAL(ac_compile); then
     if test "$lt_cv_prog_gnu_ld" = yes; then
       case `/usr/bin/file conftest.$ac_objext` in
@@ -1329,14 +1374,27 @@ s390*-*linux*|s390*-*tpf*|sparc*-*linux*
     CFLAGS="$SAVE_CFLAGS"
   fi
   ;;
-sparc*-*solaris*)
+*-*solaris*)
   # Find out which ABI we are using.
   echo 'int i;' > conftest.$ac_ext
   if AC_TRY_EVAL(ac_compile); then
     case `/usr/bin/file conftest.o` in
     *64-bit*)
       case $lt_cv_prog_gnu_ld in
-      yes*) LD="${LD-ld} -m elf64_sparc" ;;
+      yes*)
+        case $host in
+        i?86-*-solaris*)
+          LD="${LD-ld} -m elf_x86_64"
+          ;;
+        sparc*-*-solaris*)
+          LD="${LD-ld} -m elf64_sparc"
+          ;;
+        esac
+        # GNU ld 2.21 introduced _sol2 emulations.  Use them if available.
+        if ${LD-ld} -V | grep _sol2 >/dev/null 2>&1; then
+          LD="${LD-ld}_sol2"
+        fi
+        ;;
       *)
 	if ${LD-ld} -64 -r -o conftest2.o conftest.o >/dev/null 2>&1; then
 	  LD="${LD-ld} -64"
@@ -1354,14 +1412,47 @@ need_locks="$enable_libtool_lock"
 ])# _LT_ENABLE_LOCK
 
 
+# _LT_PROG_AR
+# -----------
+m4_defun([_LT_PROG_AR],
+[AC_CHECK_TOOLS(AR, [ar], false)
+: ${AR=ar}
+: ${AR_FLAGS=cru}
+_LT_DECL([], [AR], [1], [The archiver])
+_LT_DECL([], [AR_FLAGS], [1], [Flags to create an archive])
+
+AC_CACHE_CHECK([for archiver @FILE support], [lt_cv_ar_at_file],
+  [lt_cv_ar_at_file=no
+   AC_COMPILE_IFELSE([AC_LANG_PROGRAM],
+     [echo conftest.$ac_objext > conftest.lst
+      lt_ar_try='$AR $AR_FLAGS libconftest.a @conftest.lst >&AS_MESSAGE_LOG_FD'
+      AC_TRY_EVAL([lt_ar_try])
+      if test "$ac_status" -eq 0; then
+	# Ensure the archiver fails upon bogus file names.
+	rm -f conftest.$ac_objext libconftest.a
+	AC_TRY_EVAL([lt_ar_try])
+	if test "$ac_status" -ne 0; then
+          lt_cv_ar_at_file=@
+        fi
+      fi
+      rm -f conftest.* libconftest.a
+     ])
+  ])
+
+if test "x$lt_cv_ar_at_file" = xno; then
+  archiver_list_spec=
+else
+  archiver_list_spec=$lt_cv_ar_at_file
+fi
+_LT_DECL([], [archiver_list_spec], [1],
+  [How to feed a file listing to the archiver])
+])# _LT_PROG_AR
+
+
 # _LT_CMD_OLD_ARCHIVE
 # -------------------
 m4_defun([_LT_CMD_OLD_ARCHIVE],
-[AC_CHECK_TOOL(AR, ar, false)
-test -z "$AR" && AR=ar
-test -z "$AR_FLAGS" && AR_FLAGS=cru
-_LT_DECL([], [AR], [1], [The archiver])
-_LT_DECL([], [AR_FLAGS], [1])
+[_LT_PROG_AR
 
 AC_CHECK_TOOL(STRIP, strip, :)
 test -z "$STRIP" && STRIP=:
@@ -1380,18 +1471,27 @@ old_postuninstall_cmds=
 if test -n "$RANLIB"; then
   case $host_os in
   openbsd*)
-    old_postinstall_cmds="$old_postinstall_cmds~\$RANLIB -t \$oldlib"
+    old_postinstall_cmds="$old_postinstall_cmds~\$RANLIB -t \$tool_oldlib"
     ;;
   *)
-    old_postinstall_cmds="$old_postinstall_cmds~\$RANLIB \$oldlib"
+    old_postinstall_cmds="$old_postinstall_cmds~\$RANLIB \$tool_oldlib"
     ;;
   esac
-  old_archive_cmds="$old_archive_cmds~\$RANLIB \$oldlib"
+  old_archive_cmds="$old_archive_cmds~\$RANLIB \$tool_oldlib"
 fi
+
+case $host_os in
+  darwin*)
+    lock_old_archive_extraction=yes ;;
+  *)
+    lock_old_archive_extraction=no ;;
+esac
 _LT_DECL([], [old_postinstall_cmds], [2])
 _LT_DECL([], [old_postuninstall_cmds], [2])
 _LT_TAGDECL([], [old_archive_cmds], [2],
     [Commands used to build an old-style archive])
+_LT_DECL([], [lock_old_archive_extraction], [0],
+    [Whether to use a lock for old archive extraction])
 ])# _LT_CMD_OLD_ARCHIVE
 
 
@@ -1416,15 +1516,15 @@ AC_CACHE_CHECK([$1], [$2],
    -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
    -e 's: [[^ ]]*conftest\.: $lt_compiler_flag&:; t' \
    -e 's:$: $lt_compiler_flag:'`
-   (eval echo "\"\$as_me:__oline__: $lt_compile\"" >&AS_MESSAGE_LOG_FD)
+   (eval echo "\"\$as_me:$LINENO: $lt_compile\"" >&AS_MESSAGE_LOG_FD)
    (eval "$lt_compile" 2>conftest.err)
    ac_status=$?
    cat conftest.err >&AS_MESSAGE_LOG_FD
-   echo "$as_me:__oline__: \$? = $ac_status" >&AS_MESSAGE_LOG_FD
+   echo "$as_me:$LINENO: \$? = $ac_status" >&AS_MESSAGE_LOG_FD
    if (exit $ac_status) && test -s "$ac_outfile"; then
      # The compiler can only warn and ignore the option if not recognized
      # So say no if there are warnings other than the usual output.
-     $ECHO "X$_lt_compiler_boilerplate" | $Xsed -e '/^$/d' >conftest.exp
+     $ECHO "$_lt_compiler_boilerplate" | $SED '/^$/d' >conftest.exp
      $SED '/^$/d; /^ *+/d' conftest.err >conftest.er2
      if test ! -s conftest.er2 || diff conftest.exp conftest.er2 >/dev/null; then
        $2=yes
@@ -1464,7 +1564,7 @@ AC_CACHE_CHECK([$1], [$2],
      if test -s conftest.err; then
        # Append any errors to the config.log.
        cat conftest.err 1>&AS_MESSAGE_LOG_FD
-       $ECHO "X$_lt_linker_boilerplate" | $Xsed -e '/^$/d' > conftest.exp
+       $ECHO "$_lt_linker_boilerplate" | $SED '/^$/d' > conftest.exp
        $SED '/^$/d; /^ *+/d' conftest.err >conftest.er2
        if diff conftest.exp conftest.er2 >/dev/null; then
          $2=yes
@@ -1527,6 +1627,11 @@ AC_CACHE_VAL([lt_cv_sys_max_cmd_len], [d
     lt_cv_sys_max_cmd_len=8192;
     ;;
 
+  mint*)
+    # On MiNT this can take a long time and run out of memory.
+    lt_cv_sys_max_cmd_len=8192;
+    ;;
+
   amigaos*)
     # On AmigaOS with pdksh, this test takes hours, literally.
     # So we just punt and use a minimum line length of 8192.
@@ -1552,6 +1657,11 @@ AC_CACHE_VAL([lt_cv_sys_max_cmd_len], [d
     lt_cv_sys_max_cmd_len=196608
     ;;
 
+  os2*)
+    # The test takes a long time on OS/2.
+    lt_cv_sys_max_cmd_len=8192
+    ;;
+
   osf*)
     # Dr. Hans Ekkehard Plesser reports seeing a kernel panic running configure
     # due to this test when exec_disable_arg_limit is 1 on Tru64. It is not
@@ -1591,8 +1701,8 @@ AC_CACHE_VAL([lt_cv_sys_max_cmd_len], [d
       # If test is not a shell built-in, we'll probably end up computing a
       # maximum length that is only half of the actual maximum length, but
       # we can't tell.
-      while { test "X"`$SHELL [$]0 --fallback-echo "X$teststring$teststring" 2>/dev/null` \
-	         = "XX$teststring$teststring"; } >/dev/null 2>&1 &&
+      while { test "X"`env echo "$teststring$teststring" 2>/dev/null` \
+	         = "X$teststring$teststring"; } >/dev/null 2>&1 &&
 	      test $i != 17 # 1/2 MB should be enough
       do
         i=`expr $i + 1`
@@ -1643,7 +1753,7 @@ else
   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2
   lt_status=$lt_dlunknown
   cat > conftest.$ac_ext <<_LT_EOF
-[#line __oline__ "configure"
+[#line $LINENO "configure"
 #include "confdefs.h"
 
 #if HAVE_DLFCN_H
@@ -1684,7 +1794,13 @@ else
 #  endif
 #endif
 
-void fnord() { int i=42;}
+/* When -fvisbility=hidden is used, assume the code has been annotated
+   correspondingly for the symbols needed.  */
+#if defined(__GNUC__) && (((__GNUC__ == 3) && (__GNUC_MINOR__ >= 3)) || (__GNUC__ > 3))
+int fnord () __attribute__((visibility("default")));
+#endif
+
+int fnord () { return 42; }
 int main ()
 {
   void *self = dlopen (0, LT_DLGLOBAL|LT_DLLAZY_OR_NOW);
@@ -1693,7 +1809,11 @@ int main ()
   if (self)
     {
       if (dlsym (self,"fnord"))       status = $lt_dlno_uscore;
-      else if (dlsym( self,"_fnord")) status = $lt_dlneed_uscore;
+      else
+        {
+	  if (dlsym( self,"_fnord"))  status = $lt_dlneed_uscore;
+          else puts (dlerror ());
+	}
       /* dlclose (self); */
     }
   else
@@ -1869,16 +1989,16 @@ AC_CACHE_CHECK([if $compiler supports -c
    -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
    -e 's: [[^ ]]*conftest\.: $lt_compiler_flag&:; t' \
    -e 's:$: $lt_compiler_flag:'`
-   (eval echo "\"\$as_me:__oline__: $lt_compile\"" >&AS_MESSAGE_LOG_FD)
+   (eval echo "\"\$as_me:$LINENO: $lt_compile\"" >&AS_MESSAGE_LOG_FD)
    (eval "$lt_compile" 2>out/conftest.err)
    ac_status=$?
    cat out/conftest.err >&AS_MESSAGE_LOG_FD
-   echo "$as_me:__oline__: \$? = $ac_status" >&AS_MESSAGE_LOG_FD
+   echo "$as_me:$LINENO: \$? = $ac_status" >&AS_MESSAGE_LOG_FD
    if (exit $ac_status) && test -s out/conftest2.$ac_objext
    then
      # The compiler can only warn and ignore the option if not recognized
      # So say no if there are warnings
-     $ECHO "X$_lt_compiler_boilerplate" | $Xsed -e '/^$/d' > out/conftest.exp
+     $ECHO "$_lt_compiler_boilerplate" | $SED '/^$/d' > out/conftest.exp
      $SED '/^$/d; /^ *+/d' out/conftest.err >out/conftest.er2
      if test ! -s out/conftest.er2 || diff out/conftest.exp out/conftest.er2 >/dev/null; then
        _LT_TAGVAR(lt_cv_prog_compiler_c_o, $1)=yes
@@ -2037,6 +2157,7 @@ m4_require([_LT_DECL_EGREP])dnl
 m4_require([_LT_FILEUTILS_DEFAULTS])dnl
 m4_require([_LT_DECL_OBJDUMP])dnl
 m4_require([_LT_DECL_SED])dnl
+m4_require([_LT_CHECK_SHELL_FEATURES])dnl
 AC_MSG_CHECKING([dynamic linker characteristics])
 m4_if([$1],
 	[], [
@@ -2045,16 +2166,23 @@ if test "$GCC" = yes; then
     darwin*) lt_awk_arg="/^libraries:/,/LR/" ;;
     *) lt_awk_arg="/^libraries:/" ;;
   esac
-  lt_search_path_spec=`$CC -print-search-dirs | awk $lt_awk_arg | $SED -e "s/^libraries://" -e "s,=/,/,g"`
-  if $ECHO "$lt_search_path_spec" | $GREP ';' >/dev/null ; then
+  case $host_os in
+    mingw* | cegcc*) lt_sed_strip_eq="s,=\([[A-Za-z]]:\),\1,g" ;;
+    *) lt_sed_strip_eq="s,=/,/,g" ;;
+  esac
+  lt_search_path_spec=`$CC -print-search-dirs | awk $lt_awk_arg | $SED -e "s/^libraries://" -e $lt_sed_strip_eq`
+  case $lt_search_path_spec in
+  *\;*)
     # if the path contains ";" then we assume it to be the separator
     # otherwise default to the standard path separator (i.e. ":") - it is
     # assumed that no part of a normal pathname contains ";" but that should
     # okay in the real world where ";" in dirpaths is itself problematic.
-    lt_search_path_spec=`$ECHO "$lt_search_path_spec" | $SED -e 's/;/ /g'`
-  else
-    lt_search_path_spec=`$ECHO "$lt_search_path_spec" | $SED  -e "s/$PATH_SEPARATOR/ /g"`
-  fi
+    lt_search_path_spec=`$ECHO "$lt_search_path_spec" | $SED 's/;/ /g'`
+    ;;
+  *)
+    lt_search_path_spec=`$ECHO "$lt_search_path_spec" | $SED "s/$PATH_SEPARATOR/ /g"`
+    ;;
+  esac
   # Ok, now we have the path, separated by spaces, we can step through it
   # and add multilib dir if necessary.
   lt_tmp_lt_search_path_spec=
@@ -2067,7 +2195,7 @@ if test "$GCC" = yes; then
 	lt_tmp_lt_search_path_spec="$lt_tmp_lt_search_path_spec $lt_sys_path"
     fi
   done
-  lt_search_path_spec=`$ECHO $lt_tmp_lt_search_path_spec | awk '
+  lt_search_path_spec=`$ECHO "$lt_tmp_lt_search_path_spec" | awk '
 BEGIN {RS=" "; FS="/|\n";} {
   lt_foo="";
   lt_count=0;
@@ -2087,7 +2215,13 @@ BEGIN {RS=" "; FS="/|\n";} {
   if (lt_foo != "") { lt_freq[[lt_foo]]++; }
   if (lt_freq[[lt_foo]] == 1) { print lt_foo; }
 }'`
-  sys_lib_search_path_spec=`$ECHO $lt_search_path_spec`
+  # AWK program above erroneously prepends '/' to C:/dos/paths
+  # for these hosts.
+  case $host_os in
+    mingw* | cegcc*) lt_search_path_spec=`$ECHO "$lt_search_path_spec" |\
+      $SED 's,/\([[A-Za-z]]:\),\1,g'` ;;
+  esac
+  sys_lib_search_path_spec=`$ECHO "$lt_search_path_spec" | $lt_NL2SP`
 else
   sys_lib_search_path_spec="/lib /usr/lib /usr/local/lib"
 fi])
@@ -2113,7 +2247,7 @@ need_version=unknown
 
 case $host_os in
 aix3*)
-  version_type=linux
+  version_type=linux # correct to gnu/linux during the next big refactor
   library_names_spec='${libname}${release}${shared_ext}$versuffix $libname.a'
   shlibpath_var=LIBPATH
 
@@ -2122,7 +2256,7 @@ aix3*)
   ;;
 
 aix[[4-9]]*)
-  version_type=linux
+  version_type=linux # correct to gnu/linux during the next big refactor
   need_lib_prefix=no
   need_version=no
   hardcode_into_libs=yes
@@ -2175,7 +2309,7 @@ amigaos*)
   m68k)
     library_names_spec='$libname.ixlibrary $libname.a'
     # Create ${libname}_ixlibrary.a entries in /sys/libs.
-    finish_eval='for lib in `ls $libdir/*.ixlibrary 2>/dev/null`; do libname=`$ECHO "X$lib" | $Xsed -e '\''s%^.*/\([[^/]]*\)\.ixlibrary$%\1%'\''`; test $RM /sys/libs/${libname}_ixlibrary.a; $show "cd /sys/libs && $LN_S $lib ${libname}_ixlibrary.a"; cd /sys/libs && $LN_S $lib ${libname}_ixlibrary.a || exit 1; done'
+    finish_eval='for lib in `ls $libdir/*.ixlibrary 2>/dev/null`; do libname=`func_echo_all "$lib" | $SED '\''s%^.*/\([[^/]]*\)\.ixlibrary$%\1%'\''`; test $RM /sys/libs/${libname}_ixlibrary.a; $show "cd /sys/libs && $LN_S $lib ${libname}_ixlibrary.a"; cd /sys/libs && $LN_S $lib ${libname}_ixlibrary.a || exit 1; done'
     ;;
   esac
   ;;
@@ -2187,7 +2321,7 @@ beos*)
   ;;
 
 bsdi[[45]]*)
-  version_type=linux
+  version_type=linux # correct to gnu/linux during the next big refactor
   need_version=no
   library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
   soname_spec='${libname}${release}${shared_ext}$major'
@@ -2206,8 +2340,9 @@ cygwin* | mingw* | pw32* | cegcc*)
   need_version=no
   need_lib_prefix=no
 
-  case $GCC,$host_os in
-  yes,cygwin* | yes,mingw* | yes,pw32* | yes,cegcc*)
+  case $GCC,$cc_basename in
+  yes,*)
+    # gcc
     library_names_spec='$libname.dll.a'
     # DLL is installed to $(libdir)/../bin by postinstall_cmds
     postinstall_cmds='base_file=`basename \${file}`~
@@ -2228,36 +2363,83 @@ cygwin* | mingw* | pw32* | cegcc*)
     cygwin*)
       # Cygwin DLLs use 'cyg' prefix rather than 'lib'
       soname_spec='`echo ${libname} | sed -e 's/^lib/cyg/'``echo ${release} | $SED -e 's/[[.]]/-/g'`${versuffix}${shared_ext}'
-      sys_lib_search_path_spec="/usr/lib /lib/w32api /lib /usr/local/lib"
+m4_if([$1], [],[
+      sys_lib_search_path_spec="$sys_lib_search_path_spec /usr/lib/w32api"])
       ;;
     mingw* | cegcc*)
       # MinGW DLLs use traditional 'lib' prefix
       soname_spec='${libname}`echo ${release} | $SED -e 's/[[.]]/-/g'`${versuffix}${shared_ext}'
-      sys_lib_search_path_spec=`$CC -print-search-dirs | $GREP "^libraries:" | $SED -e "s/^libraries://" -e "s,=/,/,g"`
-      if $ECHO "$sys_lib_search_path_spec" | [$GREP ';[c-zC-Z]:/' >/dev/null]; then
-        # It is most probably a Windows format PATH printed by
-        # mingw gcc, but we are running on Cygwin. Gcc prints its search
-        # path with ; separators, and with drive letters. We can handle the
-        # drive letters (cygwin fileutils understands them), so leave them,
-        # especially as we might pass files found there to a mingw objdump,
-        # which wouldn't understand a cygwinified path. Ahh.
-        sys_lib_search_path_spec=`$ECHO "$sys_lib_search_path_spec" | $SED -e 's/;/ /g'`
-      else
-        sys_lib_search_path_spec=`$ECHO "$sys_lib_search_path_spec" | $SED  -e "s/$PATH_SEPARATOR/ /g"`
-      fi
       ;;
     pw32*)
       # pw32 DLLs use 'pw' prefix rather than 'lib'
       library_names_spec='`echo ${libname} | sed -e 's/^lib/pw/'``echo ${release} | $SED -e 's/[[.]]/-/g'`${versuffix}${shared_ext}'
       ;;
     esac
+    dynamic_linker='Win32 ld.exe'
+    ;;
+
+  *,cl*)
+    # Native MSVC
+    libname_spec='$name'
+    soname_spec='${libname}`echo ${release} | $SED -e 's/[[.]]/-/g'`${versuffix}${shared_ext}'
+    library_names_spec='${libname}.dll.lib'
+
+    case $build_os in
+    mingw*)
+      sys_lib_search_path_spec=
+      lt_save_ifs=$IFS
+      IFS=';'
+      for lt_path in $LIB
+      do
+        IFS=$lt_save_ifs
+        # Let DOS variable expansion print the short 8.3 style file name.
+        lt_path=`cd "$lt_path" 2>/dev/null && cmd //C "for %i in (".") do @echo %~si"`
+        sys_lib_search_path_spec="$sys_lib_search_path_spec $lt_path"
+      done
+      IFS=$lt_save_ifs
+      # Convert to MSYS style.
+      sys_lib_search_path_spec=`$ECHO "$sys_lib_search_path_spec" | sed -e 's|\\\\|/|g' -e 's| \\([[a-zA-Z]]\\):| /\\1|g' -e 's|^ ||'`
+      ;;
+    cygwin*)
+      # Convert to unix form, then to dos form, then back to unix form
+      # but this time dos style (no spaces!) so that the unix form looks
+      # like /cygdrive/c/PROGRA~1:/cygdr...
+      sys_lib_search_path_spec=`cygpath --path --unix "$LIB"`
+      sys_lib_search_path_spec=`cygpath --path --dos "$sys_lib_search_path_spec" 2>/dev/null`
+      sys_lib_search_path_spec=`cygpath --path --unix "$sys_lib_search_path_spec" | $SED -e "s/$PATH_SEPARATOR/ /g"`
+      ;;
+    *)
+      sys_lib_search_path_spec="$LIB"
+      if $ECHO "$sys_lib_search_path_spec" | [$GREP ';[c-zC-Z]:/' >/dev/null]; then
+        # It is most probably a Windows format PATH.
+        sys_lib_search_path_spec=`$ECHO "$sys_lib_search_path_spec" | $SED -e 's/;/ /g'`
+      else
+        sys_lib_search_path_spec=`$ECHO "$sys_lib_search_path_spec" | $SED -e "s/$PATH_SEPARATOR/ /g"`
+      fi
+      # FIXME: find the short name or the path components, as spaces are
+      # common. (e.g. "Program Files" -> "PROGRA~1")
+      ;;
+    esac
+
+    # DLL is installed to $(libdir)/../bin by postinstall_cmds
+    postinstall_cmds='base_file=`basename \${file}`~
+      dlpath=`$SHELL 2>&1 -c '\''. $dir/'\''\${base_file}'\''i; echo \$dlname'\''`~
+      dldir=$destdir/`dirname \$dlpath`~
+      test -d \$dldir || mkdir -p \$dldir~
+      $install_prog $dir/$dlname \$dldir/$dlname'
+    postuninstall_cmds='dldll=`$SHELL 2>&1 -c '\''. $file; echo \$dlname'\''`~
+      dlpath=$dir/\$dldll~
+       $RM \$dlpath'
+    shlibpath_overrides_runpath=yes
+    dynamic_linker='Win32 link.exe'
     ;;
 
   *)
+    # Assume MSVC wrapper
     library_names_spec='${libname}`echo ${release} | $SED -e 's/[[.]]/-/g'`${versuffix}${shared_ext} $libname.lib'
+    dynamic_linker='Win32 ld.exe'
     ;;
   esac
-  dynamic_linker='Win32 ld.exe'
   # FIXME: first we should search . and the directory the executable is in
   shlibpath_var=PATH
   ;;
@@ -2278,7 +2460,7 @@ m4_if([$1], [],[
   ;;
 
 dgux*)
-  version_type=linux
+  version_type=linux # correct to gnu/linux during the next big refactor
   need_lib_prefix=no
   need_version=no
   library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname$shared_ext'
@@ -2286,10 +2468,6 @@ dgux*)
   shlibpath_var=LD_LIBRARY_PATH
   ;;
 
-freebsd1*)
-  dynamic_linker=no
-  ;;
-
 freebsd* | dragonfly*)
   # DragonFly does not have aout.  When/if they implement a new
   # versioning mechanism, adjust this.
@@ -2297,7 +2475,7 @@ freebsd* | dragonfly*)
     objformat=`/usr/bin/objformat`
   else
     case $host_os in
-    freebsd[[123]]*) objformat=aout ;;
+    freebsd[[23]].*) objformat=aout ;;
     *) objformat=elf ;;
     esac
   fi
@@ -2315,7 +2493,7 @@ freebsd* | dragonfly*)
   esac
   shlibpath_var=LD_LIBRARY_PATH
   case $host_os in
-  freebsd2*)
+  freebsd2.*)
     shlibpath_overrides_runpath=yes
     ;;
   freebsd3.[[01]]* | freebsdelf3.[[01]]*)
@@ -2335,12 +2513,26 @@ freebsd* | dragonfly*)
   ;;
 
 gnu*)
-  version_type=linux
+  version_type=linux # correct to gnu/linux during the next big refactor
   need_lib_prefix=no
   need_version=no
   library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}${major} ${libname}${shared_ext}'
   soname_spec='${libname}${release}${shared_ext}$major'
   shlibpath_var=LD_LIBRARY_PATH
+  shlibpath_overrides_runpath=no
+  hardcode_into_libs=yes
+  ;;
+
+haiku*)
+  version_type=linux # correct to gnu/linux during the next big refactor
+  need_lib_prefix=no
+  need_version=no
+  dynamic_linker="$host_os runtime_loader"
+  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}${major} ${libname}${shared_ext}'
+  soname_spec='${libname}${release}${shared_ext}$major'
+  shlibpath_var=LIBRARY_PATH
+  shlibpath_overrides_runpath=yes
+  sys_lib_dlsearch_path_spec='/boot/home/config/lib /boot/common/lib /boot/system/lib'
   hardcode_into_libs=yes
   ;;
 
@@ -2386,12 +2578,14 @@ hpux9* | hpux10* | hpux11*)
     soname_spec='${libname}${release}${shared_ext}$major'
     ;;
   esac
-  # HP-UX runs *really* slowly unless shared libraries are mode 555.
+  # HP-UX runs *really* slowly unless shared libraries are mode 555, ...
   postinstall_cmds='chmod 555 $lib'
+  # or fails outright, so override atomically:
+  install_override_mode=555
   ;;
 
 interix[[3-9]]*)
-  version_type=linux
+  version_type=linux # correct to gnu/linux during the next big refactor
   need_lib_prefix=no
   need_version=no
   library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major ${libname}${shared_ext}'
@@ -2407,7 +2601,7 @@ irix5* | irix6* | nonstopux*)
     nonstopux*) version_type=nonstopux ;;
     *)
 	if test "$lt_cv_prog_gnu_ld" = yes; then
-		version_type=linux
+		version_type=linux # correct to gnu/linux during the next big refactor
 	else
 		version_type=irix
 	fi ;;
@@ -2444,9 +2638,9 @@ linux*oldld* | linux*aout* | linux*coff*
   dynamic_linker=no
   ;;
 
-# This must be Linux ELF.
-linux* | k*bsd*-gnu)
-  version_type=linux
+# This must be glibc/ELF.
+linux* | k*bsd*-gnu | kopensolaris*-gnu)
+  version_type=linux # correct to gnu/linux during the next big refactor
   need_lib_prefix=no
   need_version=no
   library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
@@ -2454,16 +2648,21 @@ linux* | k*bsd*-gnu)
   finish_cmds='PATH="\$PATH:/sbin" ldconfig -n $libdir'
   shlibpath_var=LD_LIBRARY_PATH
   shlibpath_overrides_runpath=no
+
   # Some binutils ld are patched to set DT_RUNPATH
-  save_LDFLAGS=$LDFLAGS
-  save_libdir=$libdir
-  eval "libdir=/foo; wl=\"$_LT_TAGVAR(lt_prog_compiler_wl, $1)\"; \
-       LDFLAGS=\"\$LDFLAGS $_LT_TAGVAR(hardcode_libdir_flag_spec, $1)\""
-  AC_LINK_IFELSE([AC_LANG_PROGRAM([],[])],
-    [AS_IF([ ($OBJDUMP -p conftest$ac_exeext) 2>/dev/null | grep "RUNPATH.*$libdir" >/dev/null],
-       [shlibpath_overrides_runpath=yes])])
-  LDFLAGS=$save_LDFLAGS
-  libdir=$save_libdir
+  AC_CACHE_VAL([lt_cv_shlibpath_overrides_runpath],
+    [lt_cv_shlibpath_overrides_runpath=no
+    save_LDFLAGS=$LDFLAGS
+    save_libdir=$libdir
+    eval "libdir=/foo; wl=\"$_LT_TAGVAR(lt_prog_compiler_wl, $1)\"; \
+	 LDFLAGS=\"\$LDFLAGS $_LT_TAGVAR(hardcode_libdir_flag_spec, $1)\""
+    AC_LINK_IFELSE([AC_LANG_PROGRAM([],[])],
+      [AS_IF([ ($OBJDUMP -p conftest$ac_exeext) 2>/dev/null | grep "RUNPATH.*$libdir" >/dev/null],
+	 [lt_cv_shlibpath_overrides_runpath=yes])])
+    LDFLAGS=$save_LDFLAGS
+    libdir=$save_libdir
+    ])
+  shlibpath_overrides_runpath=$lt_cv_shlibpath_overrides_runpath
 
   # This implies no fast_install, which is unacceptable.
   # Some rework will be needed to allow for fast_install
@@ -2475,8 +2674,9 @@ linux* | k*bsd*-gnu)
 
   # Append ld.so.conf contents to the search path
   if test -f /etc/ld.so.conf; then
-    lt_ld_extra=`awk '/^include / { system(sprintf("cd /etc; cat %s 2>/dev/null", \[$]2)); skip = 1; } { if (!skip) print \[$]0; skip = 0; }' < /etc/ld.so.conf | $SED -e 's/#.*//;/^[	 ]*hwcap[	 ]/d;s/[:,	]/ /g;s/=[^=]*$//;s/=[^= ]* / /g;/^$/d' | tr '\n' ' '`
+    lt_ld_extra=`awk '/^include / { system(sprintf("cd /etc; cat %s 2>/dev/null", \[$]2)); skip = 1; } { if (!skip) print \[$]0; skip = 0; }' < /etc/ld.so.conf | $SED -e 's/#.*//;/^[	 ]*hwcap[	 ]/d;s/[:,	]/ /g;s/=[^=]*$//;s/=[^= ]* / /g;s/"//g;/^$/d' | tr '\n' ' '`
     sys_lib_dlsearch_path_spec="$sys_lib_dlsearch_path_spec $lt_ld_extra"
+
   fi
 
   # We used to test for /lib/ld.so.1 and disable shared libraries on
@@ -2507,7 +2707,7 @@ netbsd*)
   ;;
 
 newsos6)
-  version_type=linux
+  version_type=linux # correct to gnu/linux during the next big refactor
   library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
   shlibpath_var=LD_LIBRARY_PATH
   shlibpath_overrides_runpath=yes
@@ -2576,7 +2776,7 @@ rdos*)
   ;;
 
 solaris*)
-  version_type=linux
+  version_type=linux # correct to gnu/linux during the next big refactor
   need_lib_prefix=no
   need_version=no
   library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
@@ -2601,7 +2801,7 @@ sunos4*)
   ;;
 
 sysv4 | sysv4.3*)
-  version_type=linux
+  version_type=linux # correct to gnu/linux during the next big refactor
   library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
   soname_spec='${libname}${release}${shared_ext}$major'
   shlibpath_var=LD_LIBRARY_PATH
@@ -2625,7 +2825,7 @@ sysv4 | sysv4.3*)
 
 sysv4*MP*)
   if test -d /usr/nec ;then
-    version_type=linux
+    version_type=linux # correct to gnu/linux during the next big refactor
     library_names_spec='$libname${shared_ext}.$versuffix $libname${shared_ext}.$major $libname${shared_ext}'
     soname_spec='$libname${shared_ext}.$major'
     shlibpath_var=LD_LIBRARY_PATH
@@ -2656,7 +2856,7 @@ sysv5* | sco3.2v5* | sco5v6* | unixware*
 
 tpf*)
   # TPF is a cross-target only.  Preferred cross-host = GNU/Linux.
-  version_type=linux
+  version_type=linux # correct to gnu/linux during the next big refactor
   need_lib_prefix=no
   need_version=no
   library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
@@ -2666,7 +2866,7 @@ tpf*)
   ;;
 
 uts4*)
-  version_type=linux
+  version_type=linux # correct to gnu/linux during the next big refactor
   library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
   soname_spec='${libname}${release}${shared_ext}$major'
   shlibpath_var=LD_LIBRARY_PATH
@@ -2708,6 +2908,8 @@ _LT_DECL([], [library_names_spec], [1],
     The last name is the one that the linker finds with -lNAME]])
 _LT_DECL([], [soname_spec], [1],
     [[The coded name of the library, if different from the real name]])
+_LT_DECL([], [install_override_mode], [1],
+    [Permission mode override for installation of shared libraries])
 _LT_DECL([], [postinstall_cmds], [2],
     [Command to use after installation of a shared archive])
 _LT_DECL([], [postuninstall_cmds], [2],
@@ -2820,6 +3022,7 @@ AC_REQUIRE([AC_CANONICAL_HOST])dnl
 AC_REQUIRE([AC_CANONICAL_BUILD])dnl
 m4_require([_LT_DECL_SED])dnl
 m4_require([_LT_DECL_EGREP])dnl
+m4_require([_LT_PROG_ECHO_BACKSLASH])dnl
 
 AC_ARG_WITH([gnu-ld],
     [AS_HELP_STRING([--with-gnu-ld],
@@ -2941,6 +3144,11 @@ case $reload_flag in
 esac
 reload_cmds='$LD$reload_flag -o $output$reload_objs'
 case $host_os in
+  cygwin* | mingw* | pw32* | cegcc*)
+    if test "$GCC" != yes; then
+      reload_cmds=false
+    fi
+    ;;
   darwin*)
     if test "$GCC" = yes; then
       reload_cmds='$LTCC $LTCFLAGS -nostdlib ${wl}-r -o $output$reload_objs'
@@ -2949,8 +3157,8 @@ case $host_os in
     fi
     ;;
 esac
-_LT_DECL([], [reload_flag], [1], [How to create reloadable object files])dnl
-_LT_DECL([], [reload_cmds], [2])dnl
+_LT_TAGDECL([], [reload_flag], [1], [How to create reloadable object files])dnl
+_LT_TAGDECL([], [reload_cmds], [2])dnl
 ])# _LT_CMD_RELOAD
 
 
@@ -3002,16 +3210,18 @@ mingw* | pw32*)
   # Base MSYS/MinGW do not provide the 'file' command needed by
   # func_win32_libid shell function, so use a weaker test based on 'objdump',
   # unless we find 'file', for example because we are cross-compiling.
-  if ( file / ) >/dev/null 2>&1; then
+  # func_win32_libid assumes BSD nm, so disallow it if using MS dumpbin.
+  if ( test "$lt_cv_nm_interface" = "BSD nm" && file / ) >/dev/null 2>&1; then
     lt_cv_deplibs_check_method='file_magic ^x86 archive import|^x86 DLL'
     lt_cv_file_magic_cmd='func_win32_libid'
   else
-    lt_cv_deplibs_check_method='file_magic file format pei*-i386(.*architecture: i386)?'
+    # Keep this pattern in sync with the one in func_win32_libid.
+    lt_cv_deplibs_check_method='file_magic file format (pei*-i386(.*architecture: i386)?|pe-arm-wince|pe-x86-64)'
     lt_cv_file_magic_cmd='$OBJDUMP -f'
   fi
   ;;
 
-cegcc)
+cegcc*)
   # use the weaker test based on 'objdump'. See mingw*.
   lt_cv_deplibs_check_method='file_magic file format pe-arm-.*little(.*architecture: arm)?'
   lt_cv_file_magic_cmd='$OBJDUMP -f'
@@ -3041,6 +3251,10 @@ gnu*)
   lt_cv_deplibs_check_method=pass_all
   ;;
 
+haiku*)
+  lt_cv_deplibs_check_method=pass_all
+  ;;
+
 hpux10.20* | hpux11*)
   lt_cv_file_magic_cmd=/usr/bin/file
   case $host_cpu in
@@ -3049,11 +3263,11 @@ hpux10.20* | hpux11*)
     lt_cv_file_magic_test_file=/usr/lib/hpux32/libc.so
     ;;
   hppa*64*)
-    [lt_cv_deplibs_check_method='file_magic (s[0-9][0-9][0-9]|ELF-[0-9][0-9]) shared object file - PA-RISC [0-9].[0-9]']
+    [lt_cv_deplibs_check_method='file_magic (s[0-9][0-9][0-9]|ELF[ -][0-9][0-9])(-bit)?( [LM]SB)? shared object( file)?[, -]* PA-RISC [0-9]\.[0-9]']
     lt_cv_file_magic_test_file=/usr/lib/pa20_64/libc.sl
     ;;
   *)
-    lt_cv_deplibs_check_method='file_magic (s[[0-9]][[0-9]][[0-9]]|PA-RISC[[0-9]].[[0-9]]) shared library'
+    lt_cv_deplibs_check_method='file_magic (s[[0-9]][[0-9]][[0-9]]|PA-RISC[[0-9]]\.[[0-9]]) shared library'
     lt_cv_file_magic_test_file=/usr/lib/libc.sl
     ;;
   esac
@@ -3074,8 +3288,8 @@ irix5* | irix6* | nonstopux*)
   lt_cv_deplibs_check_method=pass_all
   ;;
 
-# This must be Linux ELF.
-linux* | k*bsd*-gnu)
+# This must be glibc/ELF.
+linux* | k*bsd*-gnu | kopensolaris*-gnu)
   lt_cv_deplibs_check_method=pass_all
   ;;
 
@@ -3153,6 +3367,21 @@ tpf*)
   ;;
 esac
 ])
+
+file_magic_glob=
+want_nocaseglob=no
+if test "$build" = "$host"; then
+  case $host_os in
+  mingw* | pw32*)
+    if ( shopt | grep nocaseglob ) >/dev/null 2>&1; then
+      want_nocaseglob=yes
+    else
+      file_magic_glob=`echo aAbBcCdDeEfFgGhHiIjJkKlLmMnNoOpPqQrRsStTuUvVwWxXyYzZ | $SED -e "s/\(..\)/s\/[[\1]]\/[[\1]]\/g;/g"`
+    fi
+    ;;
+  esac
+fi
+
 file_magic_cmd=$lt_cv_file_magic_cmd
 deplibs_check_method=$lt_cv_deplibs_check_method
 test -z "$deplibs_check_method" && deplibs_check_method=unknown
@@ -3160,7 +3389,11 @@ test -z "$deplibs_check_method" && depli
 _LT_DECL([], [deplibs_check_method], [1],
     [Method to check whether dependent libraries are shared objects])
 _LT_DECL([], [file_magic_cmd], [1],
-    [Command to use when deplibs_check_method == "file_magic"])
+    [Command to use when deplibs_check_method = "file_magic"])
+_LT_DECL([], [file_magic_glob], [1],
+    [How to find potential files when deplibs_check_method = "file_magic"])
+_LT_DECL([], [want_nocaseglob], [1],
+    [Find potential files using nocaseglob when deplibs_check_method = "file_magic"])
 ])# _LT_CHECK_MAGIC_METHOD
 
 
@@ -3217,7 +3450,19 @@ if test "$lt_cv_path_NM" != "no"; then
   NM="$lt_cv_path_NM"
 else
   # Didn't find any BSD compatible name lister, look for dumpbin.
-  AC_CHECK_TOOLS(DUMPBIN, ["dumpbin -symbols" "link -dump -symbols"], :)
+  if test -n "$DUMPBIN"; then :
+    # Let the user override the test.
+  else
+    AC_CHECK_TOOLS(DUMPBIN, [dumpbin "link -dump"], :)
+    case `$DUMPBIN -symbols /dev/null 2>&1 | sed '1q'` in
+    *COFF*)
+      DUMPBIN="$DUMPBIN -symbols"
+      ;;
+    *)
+      DUMPBIN=:
+      ;;
+    esac
+  fi
   AC_SUBST([DUMPBIN])
   if test "$DUMPBIN" != ":"; then
     NM="$DUMPBIN"
@@ -3230,13 +3475,13 @@ _LT_DECL([], [NM], [1], [A BSD- or MS-co
 AC_CACHE_CHECK([the name lister ($NM) interface], [lt_cv_nm_interface],
   [lt_cv_nm_interface="BSD nm"
   echo "int some_variable = 0;" > conftest.$ac_ext
-  (eval echo "\"\$as_me:__oline__: $ac_compile\"" >&AS_MESSAGE_LOG_FD)
+  (eval echo "\"\$as_me:$LINENO: $ac_compile\"" >&AS_MESSAGE_LOG_FD)
   (eval "$ac_compile" 2>conftest.err)
   cat conftest.err >&AS_MESSAGE_LOG_FD
-  (eval echo "\"\$as_me:__oline__: $NM \\\"conftest.$ac_objext\\\"\"" >&AS_MESSAGE_LOG_FD)
+  (eval echo "\"\$as_me:$LINENO: $NM \\\"conftest.$ac_objext\\\"\"" >&AS_MESSAGE_LOG_FD)
   (eval "$NM \"conftest.$ac_objext\"" 2>conftest.err > conftest.out)
   cat conftest.err >&AS_MESSAGE_LOG_FD
-  (eval echo "\"\$as_me:__oline__: output\"" >&AS_MESSAGE_LOG_FD)
+  (eval echo "\"\$as_me:$LINENO: output\"" >&AS_MESSAGE_LOG_FD)
   cat conftest.out >&AS_MESSAGE_LOG_FD
   if $GREP 'External.*some_variable' conftest.out > /dev/null; then
     lt_cv_nm_interface="MS dumpbin"
@@ -3251,15 +3496,76 @@ dnl aclocal-1.4 backwards compatibility:
 dnl AC_DEFUN([AM_PROG_NM], [])
 dnl AC_DEFUN([AC_PROG_NM], [])
 
+# _LT_CHECK_SHAREDLIB_FROM_LINKLIB
+# --------------------------------
+# how to determine the name of the shared library
+# associated with a specific link library.
+#  -- PORTME fill in with the dynamic library characteristics
+m4_defun([_LT_CHECK_SHAREDLIB_FROM_LINKLIB],
+[m4_require([_LT_DECL_EGREP])
+m4_require([_LT_DECL_OBJDUMP])
+m4_require([_LT_DECL_DLLTOOL])
+AC_CACHE_CHECK([how to associate runtime and link libraries],
+lt_cv_sharedlib_from_linklib_cmd,
+[lt_cv_sharedlib_from_linklib_cmd='unknown'
 
-# LT_LIB_M
-# --------
+case $host_os in
+cygwin* | mingw* | pw32* | cegcc*)
+  # two different shell functions defined in ltmain.sh
+  # decide which to use based on capabilities of $DLLTOOL
+  case `$DLLTOOL --help 2>&1` in
+  *--identify-strict*)
+    lt_cv_sharedlib_from_linklib_cmd=func_cygming_dll_for_implib
+    ;;
+  *)
+    lt_cv_sharedlib_from_linklib_cmd=func_cygming_dll_for_implib_fallback
+    ;;
+  esac
+  ;;
+*)
+  # fallback: assume linklib IS sharedlib
+  lt_cv_sharedlib_from_linklib_cmd="$ECHO"
+  ;;
+esac
+])
+sharedlib_from_linklib_cmd=$lt_cv_sharedlib_from_linklib_cmd
+test -z "$sharedlib_from_linklib_cmd" && sharedlib_from_linklib_cmd=$ECHO
+
+_LT_DECL([], [sharedlib_from_linklib_cmd], [1],
+    [Command to associate shared and link libraries])
+])# _LT_CHECK_SHAREDLIB_FROM_LINKLIB
+
+
+# _LT_PATH_MANIFEST_TOOL
+# ----------------------
+# locate the manifest tool
+m4_defun([_LT_PATH_MANIFEST_TOOL],
+[AC_CHECK_TOOL(MANIFEST_TOOL, mt, :)
+test -z "$MANIFEST_TOOL" && MANIFEST_TOOL=mt
+AC_CACHE_CHECK([if $MANIFEST_TOOL is a manifest tool], [lt_cv_path_mainfest_tool],
+  [lt_cv_path_mainfest_tool=no
+  echo "$as_me:$LINENO: $MANIFEST_TOOL '-?'" >&AS_MESSAGE_LOG_FD
+  $MANIFEST_TOOL '-?' 2>conftest.err > conftest.out
+  cat conftest.err >&AS_MESSAGE_LOG_FD
+  if $GREP 'Manifest Tool' conftest.out > /dev/null; then
+    lt_cv_path_mainfest_tool=yes
+  fi
+  rm -f conftest*])
+if test "x$lt_cv_path_mainfest_tool" != xyes; then
+  MANIFEST_TOOL=:
+fi
+_LT_DECL([], [MANIFEST_TOOL], [1], [Manifest tool])dnl
+])# _LT_PATH_MANIFEST_TOOL
+
+
+# LT_LIB_M
+# --------
 # check for math library
 AC_DEFUN([LT_LIB_M],
 [AC_REQUIRE([AC_CANONICAL_HOST])dnl
 LIBM=
 case $host in
-*-*-beos* | *-*-cygwin* | *-*-pw32* | *-*-darwin*)
+*-*-beos* | *-*-cegcc* | *-*-cygwin* | *-*-haiku* | *-*-pw32* | *-*-darwin*)
   # These system don't have libm, or don't need it
   ;;
 *-ncr-sysv4.3*)
@@ -3287,7 +3593,12 @@ m4_defun([_LT_COMPILER_NO_RTTI],
 _LT_TAGVAR(lt_prog_compiler_no_builtin_flag, $1)=
 
 if test "$GCC" = yes; then
-  _LT_TAGVAR(lt_prog_compiler_no_builtin_flag, $1)=' -fno-builtin'
+  case $cc_basename in
+  nvcc*)
+    _LT_TAGVAR(lt_prog_compiler_no_builtin_flag, $1)=' -Xcompiler -fno-builtin' ;;
+  *)
+    _LT_TAGVAR(lt_prog_compiler_no_builtin_flag, $1)=' -fno-builtin' ;;
+  esac
 
   _LT_COMPILER_OPTION([if $compiler supports -fno-rtti -fno-exceptions],
     lt_cv_prog_compiler_rtti_exceptions,
@@ -3304,6 +3615,7 @@ _LT_TAGDECL([no_builtin_flag], [lt_prog_
 m4_defun([_LT_CMD_GLOBAL_SYMBOLS],
 [AC_REQUIRE([AC_CANONICAL_HOST])dnl
 AC_REQUIRE([AC_PROG_CC])dnl
+AC_REQUIRE([AC_PROG_AWK])dnl
 AC_REQUIRE([LT_PATH_NM])dnl
 AC_REQUIRE([LT_PATH_LD])dnl
 m4_require([_LT_DECL_SED])dnl
@@ -3371,8 +3683,8 @@ esac
 lt_cv_sys_global_symbol_to_cdecl="sed -n -e 's/^T .* \(.*\)$/extern int \1();/p' -e 's/^$symcode* .* \(.*\)$/extern char \1;/p'"
 
 # Transform an extracted symbol line into symbol name and symbol address
-lt_cv_sys_global_symbol_to_c_name_address="sed -n -e 's/^: \([[^ ]]*\) $/  {\\\"\1\\\", (void *) 0},/p' -e 's/^$symcode* \([[^ ]]*\) \([[^ ]]*\)$/  {\"\2\", (void *) \&\2},/p'"
-lt_cv_sys_global_symbol_to_c_name_address_lib_prefix="sed -n -e 's/^: \([[^ ]]*\) $/  {\\\"\1\\\", (void *) 0},/p' -e 's/^$symcode* \([[^ ]]*\) \(lib[[^ ]]*\)$/  {\"\2\", (void *) \&\2},/p' -e 's/^$symcode* \([[^ ]]*\) \([[^ ]]*\)$/  {\"lib\2\", (void *) \&\2},/p'"
+lt_cv_sys_global_symbol_to_c_name_address="sed -n -e 's/^: \([[^ ]]*\)[[ ]]*$/  {\\\"\1\\\", (void *) 0},/p' -e 's/^$symcode* \([[^ ]]*\) \([[^ ]]*\)$/  {\"\2\", (void *) \&\2},/p'"
+lt_cv_sys_global_symbol_to_c_name_address_lib_prefix="sed -n -e 's/^: \([[^ ]]*\)[[ ]]*$/  {\\\"\1\\\", (void *) 0},/p' -e 's/^$symcode* \([[^ ]]*\) \(lib[[^ ]]*\)$/  {\"\2\", (void *) \&\2},/p' -e 's/^$symcode* \([[^ ]]*\) \([[^ ]]*\)$/  {\"lib\2\", (void *) \&\2},/p'"
 
 # Handle CRLF in mingw tool chain
 opt_cr=
@@ -3396,6 +3708,7 @@ for ac_symprfx in "" "_"; do
     # which start with @ or ?.
     lt_cv_sys_global_symbol_pipe="$AWK ['"\
 "     {last_section=section; section=\$ 3};"\
+"     /^COFF SYMBOL TABLE/{for(i in hide) delete hide[i]};"\
 "     /Section length .*#relocs.*(pick any)/{hide[last_section]=1};"\
 "     \$ 0!~/External *\|/{next};"\
 "     / 0+ UNDEF /{next}; / UNDEF \([^|]\)*()/{next};"\
@@ -3408,6 +3721,7 @@ for ac_symprfx in "" "_"; do
   else
     lt_cv_sys_global_symbol_pipe="sed -n -e 's/^.*[[	 ]]\($symcode$symcode*\)[[	 ]][[	 ]]*$ac_symprfx$sympat$opt_cr$/$symxfrm/p'"
   fi
+  lt_cv_sys_global_symbol_pipe="$lt_cv_sys_global_symbol_pipe | sed '/ __gnu_lto/d'"
 
   # Check to see that the pipe works correctly.
   pipe_works=no
@@ -3429,7 +3743,7 @@ _LT_EOF
   if AC_TRY_EVAL(ac_compile); then
     # Now try to grab the symbols.
     nlist=conftest.nm
-    if AC_TRY_EVAL(NM conftest.$ac_objext \| $lt_cv_sys_global_symbol_pipe \> $nlist) && test -s "$nlist"; then
+    if AC_TRY_EVAL(NM conftest.$ac_objext \| "$lt_cv_sys_global_symbol_pipe" \> $nlist) && test -s "$nlist"; then
       # Try sorting and uniquifying the output.
       if sort "$nlist" | uniq > "$nlist"T; then
 	mv -f "$nlist"T "$nlist"
@@ -3441,6 +3755,18 @@ _LT_EOF
       if $GREP ' nm_test_var$' "$nlist" >/dev/null; then
 	if $GREP ' nm_test_func$' "$nlist" >/dev/null; then
 	  cat <<_LT_EOF > conftest.$ac_ext
+/* Keep this code in sync between libtool.m4, ltmain, lt_system.h, and tests.  */
+#if defined(_WIN32) || defined(__CYGWIN__) || defined(_WIN32_WCE)
+/* DATA imports from DLLs on WIN32 con't be const, because runtime
+   relocations are performed -- see ld's documentation on pseudo-relocs.  */
+# define LT@&t@_DLSYM_CONST
+#elif defined(__osf__)
+/* This system does not cope well with relocations in const data.  */
+# define LT@&t@_DLSYM_CONST
+#else
+# define LT@&t@_DLSYM_CONST const
+#endif
+
 #ifdef __cplusplus
 extern "C" {
 #endif
@@ -3452,7 +3778,7 @@ _LT_EOF
 	  cat <<_LT_EOF >> conftest.$ac_ext
 
 /* The mapping between symbol names and symbols.  */
-const struct {
+LT@&t@_DLSYM_CONST struct {
   const char *name;
   void       *address;
 }
@@ -3478,15 +3804,15 @@ static const void *lt_preloaded_setup()
 _LT_EOF
 	  # Now try linking the two files.
 	  mv conftest.$ac_objext conftstm.$ac_objext
-	  lt_save_LIBS="$LIBS"
-	  lt_save_CFLAGS="$CFLAGS"
+	  lt_globsym_save_LIBS=$LIBS
+	  lt_globsym_save_CFLAGS=$CFLAGS
 	  LIBS="conftstm.$ac_objext"
 	  CFLAGS="$CFLAGS$_LT_TAGVAR(lt_prog_compiler_no_builtin_flag, $1)"
 	  if AC_TRY_EVAL(ac_link) && test -s conftest${ac_exeext}; then
 	    pipe_works=yes
 	  fi
-	  LIBS="$lt_save_LIBS"
-	  CFLAGS="$lt_save_CFLAGS"
+	  LIBS=$lt_globsym_save_LIBS
+	  CFLAGS=$lt_globsym_save_CFLAGS
 	else
 	  echo "cannot find nm_test_func in $nlist" >&AS_MESSAGE_LOG_FD
 	fi
@@ -3519,6 +3845,13 @@ else
   AC_MSG_RESULT(ok)
 fi
 
+# Response file support.
+if test "$lt_cv_nm_interface" = "MS dumpbin"; then
+  nm_file_list_spec='@'
+elif $NM --help 2>/dev/null | grep '[[@]]FILE' >/dev/null; then
+  nm_file_list_spec='@'
+fi
+
 _LT_DECL([global_symbol_pipe], [lt_cv_sys_global_symbol_pipe], [1],
     [Take the output of nm and produce a listing of raw symbols and C names])
 _LT_DECL([global_symbol_to_cdecl], [lt_cv_sys_global_symbol_to_cdecl], [1],
@@ -3529,6 +3862,8 @@ _LT_DECL([global_symbol_to_c_name_addres
 _LT_DECL([global_symbol_to_c_name_address_lib_prefix],
     [lt_cv_sys_global_symbol_to_c_name_address_lib_prefix], [1],
     [Transform the output of nm in a C name address pair when lib prefix is needed])
+_LT_DECL([], [nm_file_list_spec], [1],
+    [Specify filename containing input files for $NM])
 ]) # _LT_CMD_GLOBAL_SYMBOLS
 
 
@@ -3540,7 +3875,6 @@ _LT_TAGVAR(lt_prog_compiler_wl, $1)=
 _LT_TAGVAR(lt_prog_compiler_pic, $1)=
 _LT_TAGVAR(lt_prog_compiler_static, $1)=
 
-AC_MSG_CHECKING([for $compiler option to produce PIC])
 m4_if([$1], [CXX], [
   # C++ specific cases for pic, static, wl, etc.
   if test "$GXX" = yes; then
@@ -3591,6 +3925,11 @@ m4_if([$1], [CXX], [
       # DJGPP does not support shared libraries at all
       _LT_TAGVAR(lt_prog_compiler_pic, $1)=
       ;;
+    haiku*)
+      # PIC is the default for Haiku.
+      # The "-static" flag exists, but is broken.
+      _LT_TAGVAR(lt_prog_compiler_static, $1)=
+      ;;
     interix[[3-9]]*)
       # Interix 3.x gcc -fpic/-fPIC options generate broken code.
       # Instead, we relocate shared libraries at runtime.
@@ -3640,6 +3979,12 @@ m4_if([$1], [CXX], [
 	  ;;
 	esac
 	;;
+      mingw* | cygwin* | os2* | pw32* | cegcc*)
+	# This hack is so that the source file can tell whether it is being
+	# built for inclusion in a dll (and should export symbols for example).
+	m4_if([$1], [GCJ], [],
+	  [_LT_TAGVAR(lt_prog_compiler_pic, $1)='-DDLL_EXPORT'])
+	;;
       dgux*)
 	case $cc_basename in
 	  ec++*)
@@ -3696,7 +4041,7 @@ m4_if([$1], [CXX], [
 	    ;;
 	esac
 	;;
-      linux* | k*bsd*-gnu)
+      linux* | k*bsd*-gnu | kopensolaris*-gnu)
 	case $cc_basename in
 	  KCC*)
 	    # KAI C++ Compiler
@@ -3729,8 +4074,8 @@ m4_if([$1], [CXX], [
 	    _LT_TAGVAR(lt_prog_compiler_pic, $1)=
 	    _LT_TAGVAR(lt_prog_compiler_static, $1)='-non_shared'
 	    ;;
-	  xlc* | xlC*)
-	    # IBM XL 8.0 on PPC
+	  xlc* | xlC* | bgxl[[cC]]* | mpixl[[cC]]*)
+	    # IBM XL 8.0, 9.0 on PPC and BlueGene
 	    _LT_TAGVAR(lt_prog_compiler_wl, $1)='-Wl,'
 	    _LT_TAGVAR(lt_prog_compiler_pic, $1)='-qpic'
 	    _LT_TAGVAR(lt_prog_compiler_static, $1)='-qstaticlink'
@@ -3792,7 +4137,7 @@ m4_if([$1], [CXX], [
 	;;
       solaris*)
 	case $cc_basename in
-	  CC*)
+	  CC* | sunCC*)
 	    # Sun C++ 4.2, 5.x and Centerline C++
 	    _LT_TAGVAR(lt_prog_compiler_pic, $1)='-KPIC'
 	    _LT_TAGVAR(lt_prog_compiler_static, $1)='-Bstatic'
@@ -3896,6 +4241,12 @@ m4_if([$1], [CXX], [
       _LT_TAGVAR(lt_prog_compiler_pic, $1)='-fno-common'
       ;;
 
+    haiku*)
+      # PIC is the default for Haiku.
+      # The "-static" flag exists, but is broken.
+      _LT_TAGVAR(lt_prog_compiler_static, $1)=
+      ;;
+
     hpux*)
       # PIC is the default for 64-bit PA HP-UX, but not for 32-bit
       # PA HP-UX.  On IA64 HP-UX, PIC is the default but the pic flag
@@ -3938,6 +4289,15 @@ m4_if([$1], [CXX], [
       _LT_TAGVAR(lt_prog_compiler_pic, $1)='-fPIC'
       ;;
     esac
+
+    case $cc_basename in
+    nvcc*) # Cuda Compiler Driver 2.2
+      _LT_TAGVAR(lt_prog_compiler_wl, $1)='-Xlinker '
+      if test -n "$_LT_TAGVAR(lt_prog_compiler_pic, $1)"; then
+        _LT_TAGVAR(lt_prog_compiler_pic, $1)="-Xcompiler $_LT_TAGVAR(lt_prog_compiler_pic, $1)"
+      fi
+      ;;
+    esac
   else
     # PORTME Check for flag to pass linker flags through the system compiler.
     case $host_os in
@@ -3980,7 +4340,7 @@ m4_if([$1], [CXX], [
       _LT_TAGVAR(lt_prog_compiler_static, $1)='-non_shared'
       ;;
 
-    linux* | k*bsd*-gnu)
+    linux* | k*bsd*-gnu | kopensolaris*-gnu)
       case $cc_basename in
       # old Intel for x86_64 which still supported -KPIC.
       ecc*)
@@ -4001,7 +4361,13 @@ m4_if([$1], [CXX], [
 	_LT_TAGVAR(lt_prog_compiler_pic, $1)='--shared'
 	_LT_TAGVAR(lt_prog_compiler_static, $1)='--static'
 	;;
-      pgcc* | pgf77* | pgf90* | pgf95*)
+      nagfor*)
+	# NAG Fortran compiler
+	_LT_TAGVAR(lt_prog_compiler_wl, $1)='-Wl,-Wl,,'
+	_LT_TAGVAR(lt_prog_compiler_pic, $1)='-PIC'
+	_LT_TAGVAR(lt_prog_compiler_static, $1)='-Bstatic'
+	;;
+      pgcc* | pgf77* | pgf90* | pgf95* | pgfortran*)
         # Portland Group compilers (*not* the Pentium gcc compiler,
 	# which looks to be a dead project)
 	_LT_TAGVAR(lt_prog_compiler_wl, $1)='-Wl,'
@@ -4013,25 +4379,40 @@ m4_if([$1], [CXX], [
         # All Alpha code is PIC.
         _LT_TAGVAR(lt_prog_compiler_static, $1)='-non_shared'
         ;;
-      xl*)
-	# IBM XL C 8.0/Fortran 10.1 on PPC
+      xl* | bgxl* | bgf* | mpixl*)
+	# IBM XL C 8.0/Fortran 10.1, 11.1 on PPC and BlueGene
 	_LT_TAGVAR(lt_prog_compiler_wl, $1)='-Wl,'
 	_LT_TAGVAR(lt_prog_compiler_pic, $1)='-qpic'
 	_LT_TAGVAR(lt_prog_compiler_static, $1)='-qstaticlink'
 	;;
       *)
 	case `$CC -V 2>&1 | sed 5q` in
+	*Sun\ Ceres\ Fortran* | *Sun*Fortran*\ [[1-7]].* | *Sun*Fortran*\ 8.[[0-3]]*)
+	  # Sun Fortran 8.3 passes all unrecognized flags to the linker
+	  _LT_TAGVAR(lt_prog_compiler_pic, $1)='-KPIC'
+	  _LT_TAGVAR(lt_prog_compiler_static, $1)='-Bstatic'
+	  _LT_TAGVAR(lt_prog_compiler_wl, $1)=''
+	  ;;
+	*Sun\ F* | *Sun*Fortran*)
+	  _LT_TAGVAR(lt_prog_compiler_pic, $1)='-KPIC'
+	  _LT_TAGVAR(lt_prog_compiler_static, $1)='-Bstatic'
+	  _LT_TAGVAR(lt_prog_compiler_wl, $1)='-Qoption ld '
+	  ;;
 	*Sun\ C*)
 	  # Sun C 5.9
 	  _LT_TAGVAR(lt_prog_compiler_pic, $1)='-KPIC'
 	  _LT_TAGVAR(lt_prog_compiler_static, $1)='-Bstatic'
 	  _LT_TAGVAR(lt_prog_compiler_wl, $1)='-Wl,'
 	  ;;
-	*Sun\ F*)
-	  # Sun Fortran 8.3 passes all unrecognized flags to the linker
-	  _LT_TAGVAR(lt_prog_compiler_pic, $1)='-KPIC'
+        *Intel*\ [[CF]]*Compiler*)
+	  _LT_TAGVAR(lt_prog_compiler_wl, $1)='-Wl,'
+	  _LT_TAGVAR(lt_prog_compiler_pic, $1)='-fPIC'
+	  _LT_TAGVAR(lt_prog_compiler_static, $1)='-static'
+	  ;;
+	*Portland\ Group*)
+	  _LT_TAGVAR(lt_prog_compiler_wl, $1)='-Wl,'
+	  _LT_TAGVAR(lt_prog_compiler_pic, $1)='-fpic'
 	  _LT_TAGVAR(lt_prog_compiler_static, $1)='-Bstatic'
-	  _LT_TAGVAR(lt_prog_compiler_wl, $1)=''
 	  ;;
 	esac
 	;;
@@ -4063,7 +4444,7 @@ m4_if([$1], [CXX], [
       _LT_TAGVAR(lt_prog_compiler_pic, $1)='-KPIC'
       _LT_TAGVAR(lt_prog_compiler_static, $1)='-Bstatic'
       case $cc_basename in
-      f77* | f90* | f95*)
+      f77* | f90* | f95* | sunf77* | sunf90* | sunf95*)
 	_LT_TAGVAR(lt_prog_compiler_wl, $1)='-Qoption ld ';;
       *)
 	_LT_TAGVAR(lt_prog_compiler_wl, $1)='-Wl,';;
@@ -4120,9 +4501,11 @@ case $host_os in
     _LT_TAGVAR(lt_prog_compiler_pic, $1)="$_LT_TAGVAR(lt_prog_compiler_pic, $1)@&t@m4_if([$1],[],[ -DPIC],[m4_if([$1],[CXX],[ -DPIC],[])])"
     ;;
 esac
-AC_MSG_RESULT([$_LT_TAGVAR(lt_prog_compiler_pic, $1)])
-_LT_TAGDECL([wl], [lt_prog_compiler_wl], [1],
-	[How to pass a linker flag through the compiler])
+
+AC_CACHE_CHECK([for $compiler option to produce PIC],
+  [_LT_TAGVAR(lt_cv_prog_compiler_pic, $1)],
+  [_LT_TAGVAR(lt_cv_prog_compiler_pic, $1)=$_LT_TAGVAR(lt_prog_compiler_pic, $1)])
+_LT_TAGVAR(lt_prog_compiler_pic, $1)=$_LT_TAGVAR(lt_cv_prog_compiler_pic, $1)
 
 #
 # Check to make sure the PIC flag actually works.
@@ -4141,6 +4524,8 @@ fi
 _LT_TAGDECL([pic_flag], [lt_prog_compiler_pic], [1],
 	[Additional compiler flags for building library objects])
 
+_LT_TAGDECL([wl], [lt_prog_compiler_wl], [1],
+	[How to pass a linker flag through the compiler])
 #
 # Check to make sure the static flag actually works.
 #
@@ -4161,6 +4546,7 @@ _LT_TAGDECL([link_static_flag], [lt_prog
 m4_defun([_LT_LINKER_SHLIBS],
 [AC_REQUIRE([LT_PATH_LD])dnl
 AC_REQUIRE([LT_PATH_NM])dnl
+m4_require([_LT_PATH_MANIFEST_TOOL])dnl
 m4_require([_LT_FILEUTILS_DEFAULTS])dnl
 m4_require([_LT_DECL_EGREP])dnl
 m4_require([_LT_DECL_SED])dnl
@@ -4169,27 +4555,37 @@ m4_require([_LT_TAG_COMPILER])dnl
 AC_MSG_CHECKING([whether the $compiler linker ($LD) supports shared libraries])
 m4_if([$1], [CXX], [
   _LT_TAGVAR(export_symbols_cmds, $1)='$NM $libobjs $convenience | $global_symbol_pipe | $SED '\''s/.* //'\'' | sort | uniq > $export_symbols'
+  _LT_TAGVAR(exclude_expsyms, $1)=['_GLOBAL_OFFSET_TABLE_|_GLOBAL__F[ID]_.*']
   case $host_os in
   aix[[4-9]]*)
     # If we're using GNU nm, then we don't want the "-C" option.
     # -C means demangle to AIX nm, but means don't demangle with GNU nm
+    # Also, AIX nm treats weak defined symbols like other global defined
+    # symbols, whereas GNU nm marks them as "W".
     if $NM -V 2>&1 | $GREP 'GNU' > /dev/null; then
-      _LT_TAGVAR(export_symbols_cmds, $1)='$NM -Bpg $libobjs $convenience | awk '\''{ if (((\$ 2 == "T") || (\$ 2 == "D") || (\$ 2 == "B")) && ([substr](\$ 3,1,1) != ".")) { print \$ 3 } }'\'' | sort -u > $export_symbols'
+      _LT_TAGVAR(export_symbols_cmds, $1)='$NM -Bpg $libobjs $convenience | awk '\''{ if (((\$ 2 == "T") || (\$ 2 == "D") || (\$ 2 == "B") || (\$ 2 == "W")) && ([substr](\$ 3,1,1) != ".")) { print \$ 3 } }'\'' | sort -u > $export_symbols'
     else
       _LT_TAGVAR(export_symbols_cmds, $1)='$NM -BCpg $libobjs $convenience | awk '\''{ if (((\$ 2 == "T") || (\$ 2 == "D") || (\$ 2 == "B")) && ([substr](\$ 3,1,1) != ".")) { print \$ 3 } }'\'' | sort -u > $export_symbols'
     fi
     ;;
   pw32*)
     _LT_TAGVAR(export_symbols_cmds, $1)="$ltdll_cmds"
-  ;;
+    ;;
   cygwin* | mingw* | cegcc*)
-    _LT_TAGVAR(export_symbols_cmds, $1)='$NM $libobjs $convenience | $global_symbol_pipe | $SED -e '\''/^[[BCDGRS]][[ ]]/s/.*[[ ]]\([[^ ]]*\)/\1 DATA/;/^.*[[ ]]__nm__/s/^.*[[ ]]__nm__\([[^ ]]*\)[[ ]][[^ ]]*/\1 DATA/;/^I[[ ]]/d;/^[[AITW]][[ ]]/s/.* //'\'' | sort | uniq > $export_symbols'
-  ;;
+    case $cc_basename in
+    cl*)
+      _LT_TAGVAR(exclude_expsyms, $1)='_NULL_IMPORT_DESCRIPTOR|_IMPORT_DESCRIPTOR_.*'
+      ;;
+    *)
+      _LT_TAGVAR(export_symbols_cmds, $1)='$NM $libobjs $convenience | $global_symbol_pipe | $SED -e '\''/^[[BCDGRS]][[ ]]/s/.*[[ ]]\([[^ ]]*\)/\1 DATA/;s/^.*[[ ]]__nm__\([[^ ]]*\)[[ ]][[^ ]]*/\1 DATA/;/^I[[ ]]/d;/^[[AITW]][[ ]]/s/.* //'\'' | sort | uniq > $export_symbols'
+      _LT_TAGVAR(exclude_expsyms, $1)=['[_]+GLOBAL_OFFSET_TABLE_|[_]+GLOBAL__[FID]_.*|[_]+head_[A-Za-z0-9_]+_dll|[A-Za-z0-9_]+_dll_iname']
+      ;;
+    esac
+    ;;
   *)
     _LT_TAGVAR(export_symbols_cmds, $1)='$NM $libobjs $convenience | $global_symbol_pipe | $SED '\''s/.* //'\'' | sort | uniq > $export_symbols'
-  ;;
+    ;;
   esac
-  _LT_TAGVAR(exclude_expsyms, $1)=['_GLOBAL_OFFSET_TABLE_|_GLOBAL__F[ID]_.*']
 ], [
   runpath_var=
   _LT_TAGVAR(allow_undefined_flag, $1)=
@@ -4204,7 +4600,6 @@ m4_if([$1], [CXX], [
   _LT_TAGVAR(hardcode_direct, $1)=no
   _LT_TAGVAR(hardcode_direct_absolute, $1)=no
   _LT_TAGVAR(hardcode_libdir_flag_spec, $1)=
-  _LT_TAGVAR(hardcode_libdir_flag_spec_ld, $1)=
   _LT_TAGVAR(hardcode_libdir_separator, $1)=
   _LT_TAGVAR(hardcode_minus_L, $1)=no
   _LT_TAGVAR(hardcode_shlibpath_var, $1)=unsupported
@@ -4252,7 +4647,33 @@ dnl Note also adjust exclude_expsyms for
   esac
 
   _LT_TAGVAR(ld_shlibs, $1)=yes
+
+  # On some targets, GNU ld is compatible enough with the native linker
+  # that we're better off using the native interface for both.
+  lt_use_gnu_ld_interface=no
   if test "$with_gnu_ld" = yes; then
+    case $host_os in
+      aix*)
+	# The AIX port of GNU ld has always aspired to compatibility
+	# with the native linker.  However, as the warning in the GNU ld
+	# block says, versions before 2.19.5* couldn't really create working
+	# shared libraries, regardless of the interface used.
+	case `$LD -v 2>&1` in
+	  *\ \(GNU\ Binutils\)\ 2.19.5*) ;;
+	  *\ \(GNU\ Binutils\)\ 2.[[2-9]]*) ;;
+	  *\ \(GNU\ Binutils\)\ [[3-9]]*) ;;
+	  *)
+	    lt_use_gnu_ld_interface=yes
+	    ;;
+	esac
+	;;
+      *)
+	lt_use_gnu_ld_interface=yes
+	;;
+    esac
+  fi
+
+  if test "$lt_use_gnu_ld_interface" = yes; then
     # If archive_cmds runs LD, not CC, wlarc should be empty
     wlarc='${wl}'
 
@@ -4270,6 +4691,7 @@ dnl Note also adjust exclude_expsyms for
     fi
     supports_anon_versioning=no
     case `$LD -v 2>&1` in
+      *GNU\ gold*) supports_anon_versioning=yes ;;
       *\ [[01]].* | *\ 2.[[0-9]].* | *\ 2.10.*) ;; # catch versions < 2.11
       *\ 2.11.93.0.2\ *) supports_anon_versioning=yes ;; # RH7.3 ...
       *\ 2.11.92.0.12\ *) supports_anon_versioning=yes ;; # Mandrake 8.2 ...
@@ -4285,11 +4707,12 @@ dnl Note also adjust exclude_expsyms for
 	_LT_TAGVAR(ld_shlibs, $1)=no
 	cat <<_LT_EOF 1>&2
 
-*** Warning: the GNU linker, at least up to release 2.9.1, is reported
+*** Warning: the GNU linker, at least up to release 2.19, is reported
 *** to be unable to reliably create shared libraries on AIX.
 *** Therefore, libtool is disabling shared libraries support.  If you
-*** really care for shared libraries, you may want to modify your PATH
-*** so that a non-GNU linker is found, and then restart.
+*** really care for shared libraries, you may want to install binutils
+*** 2.20 or above, or modify your PATH so that a non-GNU linker is found.
+*** You will then need to restart the configuration process.
 
 _LT_EOF
       fi
@@ -4325,10 +4748,12 @@ _LT_EOF
       # _LT_TAGVAR(hardcode_libdir_flag_spec, $1) is actually meaningless,
       # as there is no search path for DLLs.
       _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='-L$libdir'
+      _LT_TAGVAR(export_dynamic_flag_spec, $1)='${wl}--export-all-symbols'
       _LT_TAGVAR(allow_undefined_flag, $1)=unsupported
       _LT_TAGVAR(always_export_symbols, $1)=no
       _LT_TAGVAR(enable_shared_with_static_runtimes, $1)=yes
-      _LT_TAGVAR(export_symbols_cmds, $1)='$NM $libobjs $convenience | $global_symbol_pipe | $SED -e '\''/^[[BCDGRS]][[ ]]/s/.*[[ ]]\([[^ ]]*\)/\1 DATA/'\'' | $SED -e '\''/^[[AITW]][[ ]]/s/.*[[ ]]//'\'' | sort | uniq > $export_symbols'
+      _LT_TAGVAR(export_symbols_cmds, $1)='$NM $libobjs $convenience | $global_symbol_pipe | $SED -e '\''/^[[BCDGRS]][[ ]]/s/.*[[ ]]\([[^ ]]*\)/\1 DATA/;s/^.*[[ ]]__nm__\([[^ ]]*\)[[ ]][[^ ]]*/\1 DATA/;/^I[[ ]]/d;/^[[AITW]][[ ]]/s/.* //'\'' | sort | uniq > $export_symbols'
+      _LT_TAGVAR(exclude_expsyms, $1)=['[_]+GLOBAL_OFFSET_TABLE_|[_]+GLOBAL__[FID]_.*|[_]+head_[A-Za-z0-9_]+_dll|[A-Za-z0-9_]+_dll_iname']
 
       if $LD --help 2>&1 | $GREP 'auto-import' > /dev/null; then
         _LT_TAGVAR(archive_cmds, $1)='$CC -shared $libobjs $deplibs $compiler_flags -o $output_objdir/$soname ${wl}--enable-auto-image-base -Xlinker --out-implib -Xlinker $lib'
@@ -4346,6 +4771,11 @@ _LT_EOF
       fi
       ;;
 
+    haiku*)
+      _LT_TAGVAR(archive_cmds, $1)='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
+      _LT_TAGVAR(link_all_deplibs, $1)=yes
+      ;;
+
     interix[[3-9]]*)
       _LT_TAGVAR(hardcode_direct, $1)=no
       _LT_TAGVAR(hardcode_shlibpath_var, $1)=no
@@ -4361,7 +4791,7 @@ _LT_EOF
       _LT_TAGVAR(archive_expsym_cmds, $1)='sed "s,^,_," $export_symbols >$output_objdir/$soname.expsym~$CC -shared $pic_flag $libobjs $deplibs $compiler_flags ${wl}-h,$soname ${wl}--retain-symbols-file,$output_objdir/$soname.expsym ${wl}--image-base,`expr ${RANDOM-$$} % 4096 / 2 \* 262144 + 1342177280` -o $lib'
       ;;
 
-    gnu* | linux* | tpf* | k*bsd*-gnu)
+    gnu* | linux* | tpf* | k*bsd*-gnu | kopensolaris*-gnu)
       tmp_diet=no
       if test "$host_os" = linux-dietlibc; then
 	case $cc_basename in
@@ -4371,15 +4801,16 @@ _LT_EOF
       if $LD --help 2>&1 | $EGREP ': supported targets:.* elf' > /dev/null \
 	 && test "$tmp_diet" = no
       then
-	tmp_addflag=
+	tmp_addflag=' $pic_flag'
 	tmp_sharedflag='-shared'
 	case $cc_basename,$host_cpu in
         pgcc*)				# Portland Group C compiler
-	  _LT_TAGVAR(whole_archive_flag_spec, $1)='${wl}--whole-archive`for conv in $convenience\"\"; do test  -n \"$conv\" && new_convenience=\"$new_convenience,$conv\"; done; $ECHO \"$new_convenience\"` ${wl}--no-whole-archive'
+	  _LT_TAGVAR(whole_archive_flag_spec, $1)='${wl}--whole-archive`for conv in $convenience\"\"; do test  -n \"$conv\" && new_convenience=\"$new_convenience,$conv\"; done; func_echo_all \"$new_convenience\"` ${wl}--no-whole-archive'
 	  tmp_addflag=' $pic_flag'
 	  ;;
-	pgf77* | pgf90* | pgf95*)	# Portland Group f77 and f90 compilers
-	  _LT_TAGVAR(whole_archive_flag_spec, $1)='${wl}--whole-archive`for conv in $convenience\"\"; do test  -n \"$conv\" && new_convenience=\"$new_convenience,$conv\"; done; $ECHO \"$new_convenience\"` ${wl}--no-whole-archive'
+	pgf77* | pgf90* | pgf95* | pgfortran*)
+					# Portland Group f77 and f90 compilers
+	  _LT_TAGVAR(whole_archive_flag_spec, $1)='${wl}--whole-archive`for conv in $convenience\"\"; do test  -n \"$conv\" && new_convenience=\"$new_convenience,$conv\"; done; func_echo_all \"$new_convenience\"` ${wl}--no-whole-archive'
 	  tmp_addflag=' $pic_flag -Mnomain' ;;
 	ecc*,ia64* | icc*,ia64*)	# Intel C compiler on ia64
 	  tmp_addflag=' -i_dynamic' ;;
@@ -4390,13 +4821,17 @@ _LT_EOF
 	lf95*)				# Lahey Fortran 8.1
 	  _LT_TAGVAR(whole_archive_flag_spec, $1)=
 	  tmp_sharedflag='--shared' ;;
-	xl[[cC]]*)			# IBM XL C 8.0 on PPC (deal with xlf below)
+	xl[[cC]]* | bgxl[[cC]]* | mpixl[[cC]]*) # IBM XL C 8.0 on PPC (deal with xlf below)
 	  tmp_sharedflag='-qmkshrobj'
 	  tmp_addflag= ;;
+	nvcc*)	# Cuda Compiler Driver 2.2
+	  _LT_TAGVAR(whole_archive_flag_spec, $1)='${wl}--whole-archive`for conv in $convenience\"\"; do test  -n \"$conv\" && new_convenience=\"$new_convenience,$conv\"; done; func_echo_all \"$new_convenience\"` ${wl}--no-whole-archive'
+	  _LT_TAGVAR(compiler_needs_object, $1)=yes
+	  ;;
 	esac
 	case `$CC -V 2>&1 | sed 5q` in
 	*Sun\ C*)			# Sun C 5.9
-	  _LT_TAGVAR(whole_archive_flag_spec, $1)='${wl}--whole-archive`new_convenience=; for conv in $convenience\"\"; do test -z \"$conv\" || new_convenience=\"$new_convenience,$conv\"; done; $ECHO \"$new_convenience\"` ${wl}--no-whole-archive'
+	  _LT_TAGVAR(whole_archive_flag_spec, $1)='${wl}--whole-archive`new_convenience=; for conv in $convenience\"\"; do test -z \"$conv\" || new_convenience=\"$new_convenience,$conv\"; done; func_echo_all \"$new_convenience\"` ${wl}--no-whole-archive'
 	  _LT_TAGVAR(compiler_needs_object, $1)=yes
 	  tmp_sharedflag='-G' ;;
 	*Sun\ F*)			# Sun Fortran 8.3
@@ -4412,17 +4847,16 @@ _LT_EOF
         fi
 
 	case $cc_basename in
-	xlf*)
+	xlf* | bgf* | bgxlf* | mpixlf*)
 	  # IBM XL Fortran 10.1 on PPC cannot create shared libs itself
 	  _LT_TAGVAR(whole_archive_flag_spec, $1)='--whole-archive$convenience --no-whole-archive'
-	  _LT_TAGVAR(hardcode_libdir_flag_spec, $1)=
-	  _LT_TAGVAR(hardcode_libdir_flag_spec_ld, $1)='-rpath $libdir'
-	  _LT_TAGVAR(archive_cmds, $1)='$LD -shared $libobjs $deplibs $compiler_flags -soname $soname -o $lib'
+	  _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}-rpath ${wl}$libdir'
+	  _LT_TAGVAR(archive_cmds, $1)='$LD -shared $libobjs $deplibs $linker_flags -soname $soname -o $lib'
 	  if test "x$supports_anon_versioning" = xyes; then
 	    _LT_TAGVAR(archive_expsym_cmds, $1)='echo "{ global:" > $output_objdir/$libname.ver~
 	      cat $export_symbols | sed -e "s/\(.*\)/\1;/" >> $output_objdir/$libname.ver~
 	      echo "local: *; };" >> $output_objdir/$libname.ver~
-	      $LD -shared $libobjs $deplibs $compiler_flags -soname $soname -version-script $output_objdir/$libname.ver -o $lib'
+	      $LD -shared $libobjs $deplibs $linker_flags -soname $soname -version-script $output_objdir/$libname.ver -o $lib'
 	  fi
 	  ;;
 	esac
@@ -4436,8 +4870,8 @@ _LT_EOF
 	_LT_TAGVAR(archive_cmds, $1)='$LD -Bshareable $libobjs $deplibs $linker_flags -o $lib'
 	wlarc=
       else
-	_LT_TAGVAR(archive_cmds, $1)='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
-	_LT_TAGVAR(archive_expsym_cmds, $1)='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
+	_LT_TAGVAR(archive_cmds, $1)='$CC -shared $pic_flag $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
+	_LT_TAGVAR(archive_expsym_cmds, $1)='$CC -shared $pic_flag $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
       fi
       ;;
 
@@ -4455,8 +4889,8 @@ _LT_EOF
 
 _LT_EOF
       elif $LD --help 2>&1 | $GREP ': supported targets:.* elf' > /dev/null; then
-	_LT_TAGVAR(archive_cmds, $1)='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
-	_LT_TAGVAR(archive_expsym_cmds, $1)='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
+	_LT_TAGVAR(archive_cmds, $1)='$CC -shared $pic_flag $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
+	_LT_TAGVAR(archive_expsym_cmds, $1)='$CC -shared $pic_flag $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
       else
 	_LT_TAGVAR(ld_shlibs, $1)=no
       fi
@@ -4502,8 +4936,8 @@ _LT_EOF
 
     *)
       if $LD --help 2>&1 | $GREP ': supported targets:.* elf' > /dev/null; then
-	_LT_TAGVAR(archive_cmds, $1)='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
-	_LT_TAGVAR(archive_expsym_cmds, $1)='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
+	_LT_TAGVAR(archive_cmds, $1)='$CC -shared $pic_flag $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
+	_LT_TAGVAR(archive_expsym_cmds, $1)='$CC -shared $pic_flag $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
       else
 	_LT_TAGVAR(ld_shlibs, $1)=no
       fi
@@ -4543,8 +4977,10 @@ _LT_EOF
       else
 	# If we're using GNU nm, then we don't want the "-C" option.
 	# -C means demangle to AIX nm, but means don't demangle with GNU nm
+	# Also, AIX nm treats weak defined symbols like other global
+	# defined symbols, whereas GNU nm marks them as "W".
 	if $NM -V 2>&1 | $GREP 'GNU' > /dev/null; then
-	  _LT_TAGVAR(export_symbols_cmds, $1)='$NM -Bpg $libobjs $convenience | awk '\''{ if (((\$ 2 == "T") || (\$ 2 == "D") || (\$ 2 == "B")) && ([substr](\$ 3,1,1) != ".")) { print \$ 3 } }'\'' | sort -u > $export_symbols'
+	  _LT_TAGVAR(export_symbols_cmds, $1)='$NM -Bpg $libobjs $convenience | awk '\''{ if (((\$ 2 == "T") || (\$ 2 == "D") || (\$ 2 == "B") || (\$ 2 == "W")) && ([substr](\$ 3,1,1) != ".")) { print \$ 3 } }'\'' | sort -u > $export_symbols'
 	else
 	  _LT_TAGVAR(export_symbols_cmds, $1)='$NM -BCpg $libobjs $convenience | awk '\''{ if (((\$ 2 == "T") || (\$ 2 == "D") || (\$ 2 == "B")) && ([substr](\$ 3,1,1) != ".")) { print \$ 3 } }'\'' | sort -u > $export_symbols'
 	fi
@@ -4631,9 +5067,9 @@ _LT_EOF
 	_LT_TAGVAR(allow_undefined_flag, $1)='-berok'
         # Determine the default libpath from the value encoded in an
         # empty executable.
-        _LT_SYS_MODULE_PATH_AIX
+        _LT_SYS_MODULE_PATH_AIX([$1])
         _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}-blibpath:$libdir:'"$aix_libpath"
-        _LT_TAGVAR(archive_expsym_cmds, $1)='$CC -o $output_objdir/$soname $libobjs $deplibs '"\${wl}$no_entry_flag"' $compiler_flags `if test "x${allow_undefined_flag}" != "x"; then $ECHO "X${wl}${allow_undefined_flag}" | $Xsed; else :; fi` '"\${wl}$exp_sym_flag:\$export_symbols $shared_flag"
+        _LT_TAGVAR(archive_expsym_cmds, $1)='$CC -o $output_objdir/$soname $libobjs $deplibs '"\${wl}$no_entry_flag"' $compiler_flags `if test "x${allow_undefined_flag}" != "x"; then func_echo_all "${wl}${allow_undefined_flag}"; else :; fi` '"\${wl}$exp_sym_flag:\$export_symbols $shared_flag"
       else
 	if test "$host_cpu" = ia64; then
 	  _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}-R $libdir:/usr/lib:/lib'
@@ -4642,14 +5078,19 @@ _LT_EOF
 	else
 	 # Determine the default libpath from the value encoded in an
 	 # empty executable.
-	 _LT_SYS_MODULE_PATH_AIX
+	 _LT_SYS_MODULE_PATH_AIX([$1])
 	 _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}-blibpath:$libdir:'"$aix_libpath"
 	  # Warning - without using the other run time loading flags,
 	  # -berok will link without error, but may produce a broken library.
 	  _LT_TAGVAR(no_undefined_flag, $1)=' ${wl}-bernotok'
 	  _LT_TAGVAR(allow_undefined_flag, $1)=' ${wl}-berok'
-	  # Exported symbols can be pulled into shared objects from archives
-	  _LT_TAGVAR(whole_archive_flag_spec, $1)='$convenience'
+	  if test "$with_gnu_ld" = yes; then
+	    # We only use this code for GNU lds that support --whole-archive.
+	    _LT_TAGVAR(whole_archive_flag_spec, $1)='${wl}--whole-archive$convenience ${wl}--no-whole-archive'
+	  else
+	    # Exported symbols can be pulled into shared objects from archives
+	    _LT_TAGVAR(whole_archive_flag_spec, $1)='$convenience'
+	  fi
 	  _LT_TAGVAR(archive_cmds_need_lc, $1)=yes
 	  # This is similar to how AIX traditionally builds its shared libraries.
 	  _LT_TAGVAR(archive_expsym_cmds, $1)="\$CC $shared_flag"' -o $output_objdir/$soname $libobjs $deplibs ${wl}-bnoentry $compiler_flags ${wl}-bE:$export_symbols${allow_undefined_flag}~$AR $AR_FLAGS $output_objdir/$libname$release.a $output_objdir/$soname'
@@ -4681,20 +5122,64 @@ _LT_EOF
       # Microsoft Visual C++.
       # hardcode_libdir_flag_spec is actually meaningless, as there is
       # no search path for DLLs.
-      _LT_TAGVAR(hardcode_libdir_flag_spec, $1)=' '
-      _LT_TAGVAR(allow_undefined_flag, $1)=unsupported
-      # Tell ltmain to make .lib files, not .a files.
-      libext=lib
-      # Tell ltmain to make .dll files, not .so files.
-      shrext_cmds=".dll"
-      # FIXME: Setting linknames here is a bad hack.
-      _LT_TAGVAR(archive_cmds, $1)='$CC -o $lib $libobjs $compiler_flags `$ECHO "X$deplibs" | $Xsed -e '\''s/ -lc$//'\''` -link -dll~linknames='
-      # The linker will automatically build a .lib file if we build a DLL.
-      _LT_TAGVAR(old_archive_from_new_cmds, $1)='true'
-      # FIXME: Should let the user specify the lib program.
-      _LT_TAGVAR(old_archive_cmds, $1)='lib -OUT:$oldlib$oldobjs$old_deplibs'
-      _LT_TAGVAR(fix_srcfile_path, $1)='`cygpath -w "$srcfile"`'
-      _LT_TAGVAR(enable_shared_with_static_runtimes, $1)=yes
+      case $cc_basename in
+      cl*)
+	# Native MSVC
+	_LT_TAGVAR(hardcode_libdir_flag_spec, $1)=' '
+	_LT_TAGVAR(allow_undefined_flag, $1)=unsupported
+	_LT_TAGVAR(always_export_symbols, $1)=yes
+	_LT_TAGVAR(file_list_spec, $1)='@'
+	# Tell ltmain to make .lib files, not .a files.
+	libext=lib
+	# Tell ltmain to make .dll files, not .so files.
+	shrext_cmds=".dll"
+	# FIXME: Setting linknames here is a bad hack.
+	_LT_TAGVAR(archive_cmds, $1)='$CC -o $output_objdir/$soname $libobjs $compiler_flags $deplibs -Wl,-dll~linknames='
+	_LT_TAGVAR(archive_expsym_cmds, $1)='if test "x`$SED 1q $export_symbols`" = xEXPORTS; then
+	    sed -n -e 's/\\\\\\\(.*\\\\\\\)/-link\\\ -EXPORT:\\\\\\\1/' -e '1\\\!p' < $export_symbols > $output_objdir/$soname.exp;
+	  else
+	    sed -e 's/\\\\\\\(.*\\\\\\\)/-link\\\ -EXPORT:\\\\\\\1/' < $export_symbols > $output_objdir/$soname.exp;
+	  fi~
+	  $CC -o $tool_output_objdir$soname $libobjs $compiler_flags $deplibs "@$tool_output_objdir$soname.exp" -Wl,-DLL,-IMPLIB:"$tool_output_objdir$libname.dll.lib"~
+	  linknames='
+	# The linker will not automatically build a static lib if we build a DLL.
+	# _LT_TAGVAR(old_archive_from_new_cmds, $1)='true'
+	_LT_TAGVAR(enable_shared_with_static_runtimes, $1)=yes
+	_LT_TAGVAR(exclude_expsyms, $1)='_NULL_IMPORT_DESCRIPTOR|_IMPORT_DESCRIPTOR_.*'
+	_LT_TAGVAR(export_symbols_cmds, $1)='$NM $libobjs $convenience | $global_symbol_pipe | $SED -e '\''/^[[BCDGRS]][[ ]]/s/.*[[ ]]\([[^ ]]*\)/\1,DATA/'\'' | $SED -e '\''/^[[AITW]][[ ]]/s/.*[[ ]]//'\'' | sort | uniq > $export_symbols'
+	# Don't use ranlib
+	_LT_TAGVAR(old_postinstall_cmds, $1)='chmod 644 $oldlib'
+	_LT_TAGVAR(postlink_cmds, $1)='lt_outputfile="@OUTPUT@"~
+	  lt_tool_outputfile="@TOOL_OUTPUT@"~
+	  case $lt_outputfile in
+	    *.exe|*.EXE) ;;
+	    *)
+	      lt_outputfile="$lt_outputfile.exe"
+	      lt_tool_outputfile="$lt_tool_outputfile.exe"
+	      ;;
+	  esac~
+	  if test "$MANIFEST_TOOL" != ":" && test -f "$lt_outputfile.manifest"; then
+	    $MANIFEST_TOOL -manifest "$lt_tool_outputfile.manifest" -outputresource:"$lt_tool_outputfile" || exit 1;
+	    $RM "$lt_outputfile.manifest";
+	  fi'
+	;;
+      *)
+	# Assume MSVC wrapper
+	_LT_TAGVAR(hardcode_libdir_flag_spec, $1)=' '
+	_LT_TAGVAR(allow_undefined_flag, $1)=unsupported
+	# Tell ltmain to make .lib files, not .a files.
+	libext=lib
+	# Tell ltmain to make .dll files, not .so files.
+	shrext_cmds=".dll"
+	# FIXME: Setting linknames here is a bad hack.
+	_LT_TAGVAR(archive_cmds, $1)='$CC -o $lib $libobjs $compiler_flags `func_echo_all "$deplibs" | $SED '\''s/ -lc$//'\''` -link -dll~linknames='
+	# The linker will automatically build a .lib file if we build a DLL.
+	_LT_TAGVAR(old_archive_from_new_cmds, $1)='true'
+	# FIXME: Should let the user specify the lib program.
+	_LT_TAGVAR(old_archive_cmds, $1)='lib -OUT:$oldlib$oldobjs$old_deplibs'
+	_LT_TAGVAR(enable_shared_with_static_runtimes, $1)=yes
+	;;
+      esac
       ;;
 
     darwin* | rhapsody*)
@@ -4707,10 +5192,6 @@ _LT_EOF
       _LT_TAGVAR(hardcode_shlibpath_var, $1)=no
       ;;
 
-    freebsd1*)
-      _LT_TAGVAR(ld_shlibs, $1)=no
-      ;;
-
     # FreeBSD 2.2.[012] allows us to include c++rt0.o to get C++ constructor
     # support.  Future versions do this automatically, but an explicit c++rt0.o
     # does not break anything, and helps significantly (at the cost of a little
@@ -4723,7 +5204,7 @@ _LT_EOF
       ;;
 
     # Unfortunately, older versions of FreeBSD 2 do not have this feature.
-    freebsd2*)
+    freebsd2.*)
       _LT_TAGVAR(archive_cmds, $1)='$LD -Bshareable -o $lib $libobjs $deplibs $linker_flags'
       _LT_TAGVAR(hardcode_direct, $1)=yes
       _LT_TAGVAR(hardcode_minus_L, $1)=yes
@@ -4732,7 +5213,7 @@ _LT_EOF
 
     # FreeBSD 3 and greater uses gcc -shared to do shared libraries.
     freebsd* | dragonfly*)
-      _LT_TAGVAR(archive_cmds, $1)='$CC -shared -o $lib $libobjs $deplibs $compiler_flags'
+      _LT_TAGVAR(archive_cmds, $1)='$CC -shared $pic_flag -o $lib $libobjs $deplibs $compiler_flags'
       _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='-R$libdir'
       _LT_TAGVAR(hardcode_direct, $1)=yes
       _LT_TAGVAR(hardcode_shlibpath_var, $1)=no
@@ -4740,7 +5221,7 @@ _LT_EOF
 
     hpux9*)
       if test "$GCC" = yes; then
-	_LT_TAGVAR(archive_cmds, $1)='$RM $output_objdir/$soname~$CC -shared -fPIC ${wl}+b ${wl}$install_libdir -o $output_objdir/$soname $libobjs $deplibs $compiler_flags~test $output_objdir/$soname = $lib || mv $output_objdir/$soname $lib'
+	_LT_TAGVAR(archive_cmds, $1)='$RM $output_objdir/$soname~$CC -shared $pic_flag ${wl}+b ${wl}$install_libdir -o $output_objdir/$soname $libobjs $deplibs $compiler_flags~test $output_objdir/$soname = $lib || mv $output_objdir/$soname $lib'
       else
 	_LT_TAGVAR(archive_cmds, $1)='$RM $output_objdir/$soname~$LD -b +b $install_libdir -o $output_objdir/$soname $libobjs $deplibs $linker_flags~test $output_objdir/$soname = $lib || mv $output_objdir/$soname $lib'
       fi
@@ -4755,14 +5236,13 @@ _LT_EOF
       ;;
 
     hpux10*)
-      if test "$GCC" = yes -a "$with_gnu_ld" = no; then
-	_LT_TAGVAR(archive_cmds, $1)='$CC -shared -fPIC ${wl}+h ${wl}$soname ${wl}+b ${wl}$install_libdir -o $lib $libobjs $deplibs $compiler_flags'
+      if test "$GCC" = yes && test "$with_gnu_ld" = no; then
+	_LT_TAGVAR(archive_cmds, $1)='$CC -shared $pic_flag ${wl}+h ${wl}$soname ${wl}+b ${wl}$install_libdir -o $lib $libobjs $deplibs $compiler_flags'
       else
 	_LT_TAGVAR(archive_cmds, $1)='$LD -b +h $soname +b $install_libdir -o $lib $libobjs $deplibs $linker_flags'
       fi
       if test "$with_gnu_ld" = no; then
 	_LT_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}+b ${wl}$libdir'
-	_LT_TAGVAR(hardcode_libdir_flag_spec_ld, $1)='+b $libdir'
 	_LT_TAGVAR(hardcode_libdir_separator, $1)=:
 	_LT_TAGVAR(hardcode_direct, $1)=yes
 	_LT_TAGVAR(hardcode_direct_absolute, $1)=yes
@@ -4774,16 +5254,16 @@ _LT_EOF
       ;;
 
     hpux11*)
-      if test "$GCC" = yes -a "$with_gnu_ld" = no; then
+      if test "$GCC" = yes && test "$with_gnu_ld" = no; then
 	case $host_cpu in
 	hppa*64*)
 	  _LT_TAGVAR(archive_cmds, $1)='$CC -shared ${wl}+h ${wl}$soname -o $lib $libobjs $deplibs $compiler_flags'
 	  ;;
 	ia64*)
-	  _LT_TAGVAR(archive_cmds, $1)='$CC -shared -fPIC ${wl}+h ${wl}$soname ${wl}+nodefaultrpath -o $lib $libobjs $deplibs $compiler_flags'
+	  _LT_TAGVAR(archive_cmds, $1)='$CC -shared $pic_flag ${wl}+h ${wl}$soname ${wl}+nodefaultrpath -o $lib $libobjs $deplibs $compiler_flags'
 	  ;;
 	*)
-	  _LT_TAGVAR(archive_cmds, $1)='$CC -shared -fPIC ${wl}+h ${wl}$soname ${wl}+b ${wl}$install_libdir -o $lib $libobjs $deplibs $compiler_flags'
+	  _LT_TAGVAR(archive_cmds, $1)='$CC -shared $pic_flag ${wl}+h ${wl}$soname ${wl}+b ${wl}$install_libdir -o $lib $libobjs $deplibs $compiler_flags'
 	  ;;
 	esac
       else
@@ -4795,7 +5275,14 @@ _LT_EOF
 	  _LT_TAGVAR(archive_cmds, $1)='$CC -b ${wl}+h ${wl}$soname ${wl}+nodefaultrpath -o $lib $libobjs $deplibs $compiler_flags'
 	  ;;
 	*)
-	  _LT_TAGVAR(archive_cmds, $1)='$CC -b ${wl}+h ${wl}$soname ${wl}+b ${wl}$install_libdir -o $lib $libobjs $deplibs $compiler_flags'
+	m4_if($1, [], [
+	  # Older versions of the 11.00 compiler do not understand -b yet
+	  # (HP92453-01 A.11.01.20 doesn't, HP92453-01 B.11.X.35175-35176.GP does)
+	  _LT_LINKER_OPTION([if $CC understands -b],
+	    _LT_TAGVAR(lt_cv_prog_compiler__b, $1), [-b],
+	    [_LT_TAGVAR(archive_cmds, $1)='$CC -b ${wl}+h ${wl}$soname ${wl}+b ${wl}$install_libdir -o $lib $libobjs $deplibs $compiler_flags'],
+	    [_LT_TAGVAR(archive_cmds, $1)='$LD -b +h $soname +b $install_libdir -o $lib $libobjs $deplibs $linker_flags'])],
+	  [_LT_TAGVAR(archive_cmds, $1)='$CC -b ${wl}+h ${wl}$soname ${wl}+b ${wl}$install_libdir -o $lib $libobjs $deplibs $compiler_flags'])
 	  ;;
 	esac
       fi
@@ -4823,19 +5310,34 @@ _LT_EOF
 
     irix5* | irix6* | nonstopux*)
       if test "$GCC" = yes; then
-	_LT_TAGVAR(archive_cmds, $1)='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname ${wl}$soname `test -n "$verstring" && $ECHO "X${wl}-set_version ${wl}$verstring" | $Xsed` ${wl}-update_registry ${wl}${output_objdir}/so_locations -o $lib'
+	_LT_TAGVAR(archive_cmds, $1)='$CC -shared $pic_flag $libobjs $deplibs $compiler_flags ${wl}-soname ${wl}$soname `test -n "$verstring" && func_echo_all "${wl}-set_version ${wl}$verstring"` ${wl}-update_registry ${wl}${output_objdir}/so_locations -o $lib'
 	# Try to use the -exported_symbol ld option, if it does not
 	# work, assume that -exports_file does not work either and
 	# implicitly export all symbols.
-        save_LDFLAGS="$LDFLAGS"
-        LDFLAGS="$LDFLAGS -shared ${wl}-exported_symbol ${wl}foo ${wl}-update_registry ${wl}/dev/null"
-        AC_LINK_IFELSE(int foo(void) {},
-          _LT_TAGVAR(archive_expsym_cmds, $1)='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname ${wl}$soname `test -n "$verstring" && $ECHO "X${wl}-set_version ${wl}$verstring" | $Xsed` ${wl}-update_registry ${wl}${output_objdir}/so_locations ${wl}-exports_file ${wl}$export_symbols -o $lib'
-        )
-        LDFLAGS="$save_LDFLAGS"
+	# This should be the same for all languages, so no per-tag cache variable.
+	AC_CACHE_CHECK([whether the $host_os linker accepts -exported_symbol],
+	  [lt_cv_irix_exported_symbol],
+	  [save_LDFLAGS="$LDFLAGS"
+	   LDFLAGS="$LDFLAGS -shared ${wl}-exported_symbol ${wl}foo ${wl}-update_registry ${wl}/dev/null"
+	   AC_LINK_IFELSE(
+	     [AC_LANG_SOURCE(
+	        [AC_LANG_CASE([C], [[int foo (void) { return 0; }]],
+			      [C++], [[int foo (void) { return 0; }]],
+			      [Fortran 77], [[
+      subroutine foo
+      end]],
+			      [Fortran], [[
+      subroutine foo
+      end]])])],
+	      [lt_cv_irix_exported_symbol=yes],
+	      [lt_cv_irix_exported_symbol=no])
+           LDFLAGS="$save_LDFLAGS"])
+	if test "$lt_cv_irix_exported_symbol" = yes; then
+          _LT_TAGVAR(archive_expsym_cmds, $1)='$CC -shared $pic_flag $libobjs $deplibs $compiler_flags ${wl}-soname ${wl}$soname `test -n "$verstring" && func_echo_all "${wl}-set_version ${wl}$verstring"` ${wl}-update_registry ${wl}${output_objdir}/so_locations ${wl}-exports_file ${wl}$export_symbols -o $lib'
+	fi
       else
-	_LT_TAGVAR(archive_cmds, $1)='$CC -shared $libobjs $deplibs $compiler_flags -soname $soname `test -n "$verstring" && $ECHO "X-set_version $verstring" | $Xsed` -update_registry ${output_objdir}/so_locations -o $lib'
-	_LT_TAGVAR(archive_expsym_cmds, $1)='$CC -shared $libobjs $deplibs $compiler_flags -soname $soname `test -n "$verstring" && $ECHO "X-set_version $verstring" | $Xsed` -update_registry ${output_objdir}/so_locations -exports_file $export_symbols -o $lib'
+	_LT_TAGVAR(archive_cmds, $1)='$CC -shared $libobjs $deplibs $compiler_flags -soname $soname `test -n "$verstring" && func_echo_all "-set_version $verstring"` -update_registry ${output_objdir}/so_locations -o $lib'
+	_LT_TAGVAR(archive_expsym_cmds, $1)='$CC -shared $libobjs $deplibs $compiler_flags -soname $soname `test -n "$verstring" && func_echo_all "-set_version $verstring"` -update_registry ${output_objdir}/so_locations -exports_file $export_symbols -o $lib'
       fi
       _LT_TAGVAR(archive_cmds_need_lc, $1)='no'
       _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}-rpath ${wl}$libdir'
@@ -4897,17 +5399,17 @@ _LT_EOF
       _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='-L$libdir'
       _LT_TAGVAR(hardcode_minus_L, $1)=yes
       _LT_TAGVAR(allow_undefined_flag, $1)=unsupported
-      _LT_TAGVAR(archive_cmds, $1)='$ECHO "LIBRARY $libname INITINSTANCE" > $output_objdir/$libname.def~$ECHO "DESCRIPTION \"$libname\"" >> $output_objdir/$libname.def~$ECHO DATA >> $output_objdir/$libname.def~$ECHO " SINGLE NONSHARED" >> $output_objdir/$libname.def~$ECHO EXPORTS >> $output_objdir/$libname.def~emxexp $libobjs >> $output_objdir/$libname.def~$CC -Zdll -Zcrtdll -o $lib $libobjs $deplibs $compiler_flags $output_objdir/$libname.def'
+      _LT_TAGVAR(archive_cmds, $1)='$ECHO "LIBRARY $libname INITINSTANCE" > $output_objdir/$libname.def~$ECHO "DESCRIPTION \"$libname\"" >> $output_objdir/$libname.def~echo DATA >> $output_objdir/$libname.def~echo " SINGLE NONSHARED" >> $output_objdir/$libname.def~echo EXPORTS >> $output_objdir/$libname.def~emxexp $libobjs >> $output_objdir/$libname.def~$CC -Zdll -Zcrtdll -o $lib $libobjs $deplibs $compiler_flags $output_objdir/$libname.def'
       _LT_TAGVAR(old_archive_from_new_cmds, $1)='emximp -o $output_objdir/$libname.a $output_objdir/$libname.def'
       ;;
 
     osf3*)
       if test "$GCC" = yes; then
 	_LT_TAGVAR(allow_undefined_flag, $1)=' ${wl}-expect_unresolved ${wl}\*'
-	_LT_TAGVAR(archive_cmds, $1)='$CC -shared${allow_undefined_flag} $libobjs $deplibs $compiler_flags ${wl}-soname ${wl}$soname `test -n "$verstring" && $ECHO "X${wl}-set_version ${wl}$verstring" | $Xsed` ${wl}-update_registry ${wl}${output_objdir}/so_locations -o $lib'
+	_LT_TAGVAR(archive_cmds, $1)='$CC -shared${allow_undefined_flag} $libobjs $deplibs $compiler_flags ${wl}-soname ${wl}$soname `test -n "$verstring" && func_echo_all "${wl}-set_version ${wl}$verstring"` ${wl}-update_registry ${wl}${output_objdir}/so_locations -o $lib'
       else
 	_LT_TAGVAR(allow_undefined_flag, $1)=' -expect_unresolved \*'
-	_LT_TAGVAR(archive_cmds, $1)='$CC -shared${allow_undefined_flag} $libobjs $deplibs $compiler_flags -soname $soname `test -n "$verstring" && $ECHO "X-set_version $verstring" | $Xsed` -update_registry ${output_objdir}/so_locations -o $lib'
+	_LT_TAGVAR(archive_cmds, $1)='$CC -shared${allow_undefined_flag} $libobjs $deplibs $compiler_flags -soname $soname `test -n "$verstring" && func_echo_all "-set_version $verstring"` -update_registry ${output_objdir}/so_locations -o $lib'
       fi
       _LT_TAGVAR(archive_cmds_need_lc, $1)='no'
       _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}-rpath ${wl}$libdir'
@@ -4917,13 +5419,13 @@ _LT_EOF
     osf4* | osf5*)	# as osf3* with the addition of -msym flag
       if test "$GCC" = yes; then
 	_LT_TAGVAR(allow_undefined_flag, $1)=' ${wl}-expect_unresolved ${wl}\*'
-	_LT_TAGVAR(archive_cmds, $1)='$CC -shared${allow_undefined_flag} $libobjs $deplibs $compiler_flags ${wl}-msym ${wl}-soname ${wl}$soname `test -n "$verstring" && $ECHO "X${wl}-set_version ${wl}$verstring" | $Xsed` ${wl}-update_registry ${wl}${output_objdir}/so_locations -o $lib'
+	_LT_TAGVAR(archive_cmds, $1)='$CC -shared${allow_undefined_flag} $pic_flag $libobjs $deplibs $compiler_flags ${wl}-msym ${wl}-soname ${wl}$soname `test -n "$verstring" && func_echo_all "${wl}-set_version ${wl}$verstring"` ${wl}-update_registry ${wl}${output_objdir}/so_locations -o $lib'
 	_LT_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}-rpath ${wl}$libdir'
       else
 	_LT_TAGVAR(allow_undefined_flag, $1)=' -expect_unresolved \*'
-	_LT_TAGVAR(archive_cmds, $1)='$CC -shared${allow_undefined_flag} $libobjs $deplibs $compiler_flags -msym -soname $soname `test -n "$verstring" && $ECHO "X-set_version $verstring" | $Xsed` -update_registry ${output_objdir}/so_locations -o $lib'
+	_LT_TAGVAR(archive_cmds, $1)='$CC -shared${allow_undefined_flag} $libobjs $deplibs $compiler_flags -msym -soname $soname `test -n "$verstring" && func_echo_all "-set_version $verstring"` -update_registry ${output_objdir}/so_locations -o $lib'
 	_LT_TAGVAR(archive_expsym_cmds, $1)='for i in `cat $export_symbols`; do printf "%s %s\\n" -exported_symbol "\$i" >> $lib.exp; done; printf "%s\\n" "-hidden">> $lib.exp~
-	$CC -shared${allow_undefined_flag} ${wl}-input ${wl}$lib.exp $compiler_flags $libobjs $deplibs -soname $soname `test -n "$verstring" && $ECHO "X-set_version $verstring" | $Xsed` -update_registry ${output_objdir}/so_locations -o $lib~$RM $lib.exp'
+	$CC -shared${allow_undefined_flag} ${wl}-input ${wl}$lib.exp $compiler_flags $libobjs $deplibs -soname $soname `test -n "$verstring" && $ECHO "-set_version $verstring"` -update_registry ${output_objdir}/so_locations -o $lib~$RM $lib.exp'
 
 	# Both c and cxx compiler support -rpath directly
 	_LT_TAGVAR(hardcode_libdir_flag_spec, $1)='-rpath $libdir'
@@ -4936,9 +5438,9 @@ _LT_EOF
       _LT_TAGVAR(no_undefined_flag, $1)=' -z defs'
       if test "$GCC" = yes; then
 	wlarc='${wl}'
-	_LT_TAGVAR(archive_cmds, $1)='$CC -shared ${wl}-z ${wl}text ${wl}-h ${wl}$soname -o $lib $libobjs $deplibs $compiler_flags'
+	_LT_TAGVAR(archive_cmds, $1)='$CC -shared $pic_flag ${wl}-z ${wl}text ${wl}-h ${wl}$soname -o $lib $libobjs $deplibs $compiler_flags'
 	_LT_TAGVAR(archive_expsym_cmds, $1)='echo "{ global:" > $lib.exp~cat $export_symbols | $SED -e "s/\(.*\)/\1;/" >> $lib.exp~echo "local: *; };" >> $lib.exp~
-	  $CC -shared ${wl}-z ${wl}text ${wl}-M ${wl}$lib.exp ${wl}-h ${wl}$soname -o $lib $libobjs $deplibs $compiler_flags~$RM $lib.exp'
+	  $CC -shared $pic_flag ${wl}-z ${wl}text ${wl}-M ${wl}$lib.exp ${wl}-h ${wl}$soname -o $lib $libobjs $deplibs $compiler_flags~$RM $lib.exp'
       else
 	case `$CC -V 2>&1` in
 	*"Compilers 5.0"*)
@@ -5114,36 +5616,38 @@ x|xyes)
       # Test whether the compiler implicitly links with -lc since on some
       # systems, -lgcc has to come before -lc. If gcc already passes -lc
       # to ld, don't add -lc before -lgcc.
-      AC_MSG_CHECKING([whether -lc should be explicitly linked in])
-      $RM conftest*
-      echo "$lt_simple_compile_test_code" > conftest.$ac_ext
-
-      if AC_TRY_EVAL(ac_compile) 2>conftest.err; then
-        soname=conftest
-        lib=conftest
-        libobjs=conftest.$ac_objext
-        deplibs=
-        wl=$_LT_TAGVAR(lt_prog_compiler_wl, $1)
-	pic_flag=$_LT_TAGVAR(lt_prog_compiler_pic, $1)
-        compiler_flags=-v
-        linker_flags=-v
-        verstring=
-        output_objdir=.
-        libname=conftest
-        lt_save_allow_undefined_flag=$_LT_TAGVAR(allow_undefined_flag, $1)
-        _LT_TAGVAR(allow_undefined_flag, $1)=
-        if AC_TRY_EVAL(_LT_TAGVAR(archive_cmds, $1) 2\>\&1 \| $GREP \" -lc \" \>/dev/null 2\>\&1)
-        then
-	  _LT_TAGVAR(archive_cmds_need_lc, $1)=no
-        else
-	  _LT_TAGVAR(archive_cmds_need_lc, $1)=yes
-        fi
-        _LT_TAGVAR(allow_undefined_flag, $1)=$lt_save_allow_undefined_flag
-      else
-        cat conftest.err 1>&5
-      fi
-      $RM conftest*
-      AC_MSG_RESULT([$_LT_TAGVAR(archive_cmds_need_lc, $1)])
+      AC_CACHE_CHECK([whether -lc should be explicitly linked in],
+	[lt_cv_]_LT_TAGVAR(archive_cmds_need_lc, $1),
+	[$RM conftest*
+	echo "$lt_simple_compile_test_code" > conftest.$ac_ext
+
+	if AC_TRY_EVAL(ac_compile) 2>conftest.err; then
+	  soname=conftest
+	  lib=conftest
+	  libobjs=conftest.$ac_objext
+	  deplibs=
+	  wl=$_LT_TAGVAR(lt_prog_compiler_wl, $1)
+	  pic_flag=$_LT_TAGVAR(lt_prog_compiler_pic, $1)
+	  compiler_flags=-v
+	  linker_flags=-v
+	  verstring=
+	  output_objdir=.
+	  libname=conftest
+	  lt_save_allow_undefined_flag=$_LT_TAGVAR(allow_undefined_flag, $1)
+	  _LT_TAGVAR(allow_undefined_flag, $1)=
+	  if AC_TRY_EVAL(_LT_TAGVAR(archive_cmds, $1) 2\>\&1 \| $GREP \" -lc \" \>/dev/null 2\>\&1)
+	  then
+	    lt_cv_[]_LT_TAGVAR(archive_cmds_need_lc, $1)=no
+	  else
+	    lt_cv_[]_LT_TAGVAR(archive_cmds_need_lc, $1)=yes
+	  fi
+	  _LT_TAGVAR(allow_undefined_flag, $1)=$lt_save_allow_undefined_flag
+	else
+	  cat conftest.err 1>&5
+	fi
+	$RM conftest*
+	])
+      _LT_TAGVAR(archive_cmds_need_lc, $1)=$lt_cv_[]_LT_TAGVAR(archive_cmds_need_lc, $1)
       ;;
     esac
   fi
@@ -5180,9 +5684,6 @@ _LT_TAGDECL([], [no_undefined_flag], [1]
 _LT_TAGDECL([], [hardcode_libdir_flag_spec], [1],
     [Flag to hardcode $libdir into a binary during linking.
     This must work even if $libdir does not exist])
-_LT_TAGDECL([], [hardcode_libdir_flag_spec_ld], [1],
-    [[If ld is used when linking, flag to hardcode $libdir into a binary
-    during linking.  This must work even if $libdir does not exist]])
 _LT_TAGDECL([], [hardcode_libdir_separator], [1],
     [Whether we need a single "-rpath" flag with a separated argument])
 _LT_TAGDECL([], [hardcode_direct], [0],
@@ -5208,8 +5709,6 @@ _LT_TAGDECL([], [inherit_rpath], [0],
     to runtime path list])
 _LT_TAGDECL([], [link_all_deplibs], [0],
     [Whether libtool must link a program against all its dependency libraries])
-_LT_TAGDECL([], [fix_srcfile_path], [1],
-    [Fix the shell variable $srcfile for the compiler])
 _LT_TAGDECL([], [always_export_symbols], [0],
     [Set to "yes" if exported symbols are required])
 _LT_TAGDECL([], [export_symbols_cmds], [2],
@@ -5220,6 +5719,8 @@ _LT_TAGDECL([], [include_expsyms], [1],
     [Symbols that must always be exported])
 _LT_TAGDECL([], [prelink_cmds], [2],
     [Commands necessary for linking programs (against libraries) with templates])
+_LT_TAGDECL([], [postlink_cmds], [2],
+    [Commands necessary for finishing linking programs])
 _LT_TAGDECL([], [file_list_spec], [1],
     [Specify filename containing input files])
 dnl FIXME: Not yet implemented
@@ -5313,37 +5814,22 @@ CC="$lt_save_CC"
 ])# _LT_LANG_C_CONFIG
 
 
-# _LT_PROG_CXX
-# ------------
-# Since AC_PROG_CXX is broken, in that it returns g++ if there is no c++
-# compiler, we have our own version here.
-m4_defun([_LT_PROG_CXX],
-[
-pushdef([AC_MSG_ERROR], [_lt_caught_CXX_error=yes])
-AC_PROG_CXX
-if test -n "$CXX" && ( test "X$CXX" != "Xno" &&
-    ( (test "X$CXX" = "Xg++" && `g++ -v >/dev/null 2>&1` ) ||
-    (test "X$CXX" != "Xg++"))) ; then
-  AC_PROG_CXXCPP
-else
-  _lt_caught_CXX_error=yes
-fi
-popdef([AC_MSG_ERROR])
-])# _LT_PROG_CXX
-
-dnl aclocal-1.4 backwards compatibility:
-dnl AC_DEFUN([_LT_PROG_CXX], [])
-
-
 # _LT_LANG_CXX_CONFIG([TAG])
 # --------------------------
 # Ensure that the configuration variables for a C++ compiler are suitably
 # defined.  These variables are subsequently used by _LT_CONFIG to write
 # the compiler configuration to `libtool'.
 m4_defun([_LT_LANG_CXX_CONFIG],
-[AC_REQUIRE([_LT_PROG_CXX])dnl
-m4_require([_LT_FILEUTILS_DEFAULTS])dnl
+[m4_require([_LT_FILEUTILS_DEFAULTS])dnl
 m4_require([_LT_DECL_EGREP])dnl
+m4_require([_LT_PATH_MANIFEST_TOOL])dnl
+if test -n "$CXX" && ( test "X$CXX" != "Xno" &&
+    ( (test "X$CXX" = "Xg++" && `g++ -v >/dev/null 2>&1` ) ||
+    (test "X$CXX" != "Xg++"))) ; then
+  AC_PROG_CXXCPP
+else
+  _lt_caught_CXX_error=yes
+fi
 
 AC_LANG_PUSH(C++)
 _LT_TAGVAR(archive_cmds_need_lc, $1)=no
@@ -5355,7 +5841,6 @@ _LT_TAGVAR(export_dynamic_flag_spec, $1)
 _LT_TAGVAR(hardcode_direct, $1)=no
 _LT_TAGVAR(hardcode_direct_absolute, $1)=no
 _LT_TAGVAR(hardcode_libdir_flag_spec, $1)=
-_LT_TAGVAR(hardcode_libdir_flag_spec_ld, $1)=
 _LT_TAGVAR(hardcode_libdir_separator, $1)=
 _LT_TAGVAR(hardcode_minus_L, $1)=no
 _LT_TAGVAR(hardcode_shlibpath_var, $1)=unsupported
@@ -5365,6 +5850,8 @@ _LT_TAGVAR(module_cmds, $1)=
 _LT_TAGVAR(module_expsym_cmds, $1)=
 _LT_TAGVAR(link_all_deplibs, $1)=unknown
 _LT_TAGVAR(old_archive_cmds, $1)=$old_archive_cmds
+_LT_TAGVAR(reload_flag, $1)=$reload_flag
+_LT_TAGVAR(reload_cmds, $1)=$reload_cmds
 _LT_TAGVAR(no_undefined_flag, $1)=
 _LT_TAGVAR(whole_archive_flag_spec, $1)=
 _LT_TAGVAR(enable_shared_with_static_runtimes, $1)=no
@@ -5396,6 +5883,7 @@ if test "$_lt_caught_CXX_error" != yes;
 
   # Allow CC to be a program name with arguments.
   lt_save_CC=$CC
+  lt_save_CFLAGS=$CFLAGS
   lt_save_LD=$LD
   lt_save_GCC=$GCC
   GCC=$GXX
@@ -5413,6 +5901,7 @@ if test "$_lt_caught_CXX_error" != yes;
   fi
   test -z "${LDCXX+set}" || LD=$LDCXX
   CC=${CXX-"c++"}
+  CFLAGS=$CXXFLAGS
   compiler=$CC
   _LT_TAGVAR(compiler, $1)=$CC
   _LT_CC_BASENAME([$compiler])
@@ -5434,8 +5923,8 @@ if test "$_lt_caught_CXX_error" != yes;
       # Check if GNU C++ uses GNU ld as the underlying linker, since the
       # archiving commands below assume that GNU ld is being used.
       if test "$with_gnu_ld" = yes; then
-        _LT_TAGVAR(archive_cmds, $1)='$CC -shared -nostdlib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname $wl$soname -o $lib'
-        _LT_TAGVAR(archive_expsym_cmds, $1)='$CC -shared -nostdlib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
+        _LT_TAGVAR(archive_cmds, $1)='$CC $pic_flag -shared -nostdlib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname $wl$soname -o $lib'
+        _LT_TAGVAR(archive_expsym_cmds, $1)='$CC $pic_flag -shared -nostdlib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
 
         _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}-rpath ${wl}$libdir'
         _LT_TAGVAR(export_dynamic_flag_spec, $1)='${wl}--export-dynamic'
@@ -5467,7 +5956,7 @@ if test "$_lt_caught_CXX_error" != yes;
       # Commands to make compiler produce verbose output that lists
       # what "hidden" libraries, object files and flags are used when
       # linking a shared library.
-      output_verbose_link_cmd='$CC -shared $CFLAGS -v conftest.$objext 2>&1 | $GREP "\-L"'
+      output_verbose_link_cmd='$CC -shared $CFLAGS -v conftest.$objext 2>&1 | $GREP -v "^Configured with:" | $GREP "\-L"'
 
     else
       GXX=no
@@ -5576,10 +6065,10 @@ if test "$_lt_caught_CXX_error" != yes;
           _LT_TAGVAR(allow_undefined_flag, $1)='-berok'
           # Determine the default libpath from the value encoded in an empty
           # executable.
-          _LT_SYS_MODULE_PATH_AIX
+          _LT_SYS_MODULE_PATH_AIX([$1])
           _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}-blibpath:$libdir:'"$aix_libpath"
 
-          _LT_TAGVAR(archive_expsym_cmds, $1)='$CC -o $output_objdir/$soname $libobjs $deplibs '"\${wl}$no_entry_flag"' $compiler_flags `if test "x${allow_undefined_flag}" != "x"; then $ECHO "X${wl}${allow_undefined_flag}" | $Xsed; else :; fi` '"\${wl}$exp_sym_flag:\$export_symbols $shared_flag"
+          _LT_TAGVAR(archive_expsym_cmds, $1)='$CC -o $output_objdir/$soname $libobjs $deplibs '"\${wl}$no_entry_flag"' $compiler_flags `if test "x${allow_undefined_flag}" != "x"; then func_echo_all "${wl}${allow_undefined_flag}"; else :; fi` '"\${wl}$exp_sym_flag:\$export_symbols $shared_flag"
         else
           if test "$host_cpu" = ia64; then
 	    _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}-R $libdir:/usr/lib:/lib'
@@ -5588,14 +6077,19 @@ if test "$_lt_caught_CXX_error" != yes;
           else
 	    # Determine the default libpath from the value encoded in an
 	    # empty executable.
-	    _LT_SYS_MODULE_PATH_AIX
+	    _LT_SYS_MODULE_PATH_AIX([$1])
 	    _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}-blibpath:$libdir:'"$aix_libpath"
 	    # Warning - without using the other run time loading flags,
 	    # -berok will link without error, but may produce a broken library.
 	    _LT_TAGVAR(no_undefined_flag, $1)=' ${wl}-bernotok'
 	    _LT_TAGVAR(allow_undefined_flag, $1)=' ${wl}-berok'
-	    # Exported symbols can be pulled into shared objects from archives
-	    _LT_TAGVAR(whole_archive_flag_spec, $1)='$convenience'
+	    if test "$with_gnu_ld" = yes; then
+	      # We only use this code for GNU lds that support --whole-archive.
+	      _LT_TAGVAR(whole_archive_flag_spec, $1)='${wl}--whole-archive$convenience ${wl}--no-whole-archive'
+	    else
+	      # Exported symbols can be pulled into shared objects from archives
+	      _LT_TAGVAR(whole_archive_flag_spec, $1)='$convenience'
+	    fi
 	    _LT_TAGVAR(archive_cmds_need_lc, $1)=yes
 	    # This is similar to how AIX traditionally builds its shared
 	    # libraries.
@@ -5625,28 +6119,75 @@ if test "$_lt_caught_CXX_error" != yes;
         ;;
 
       cygwin* | mingw* | pw32* | cegcc*)
-        # _LT_TAGVAR(hardcode_libdir_flag_spec, $1) is actually meaningless,
-        # as there is no search path for DLLs.
-        _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='-L$libdir'
-        _LT_TAGVAR(allow_undefined_flag, $1)=unsupported
-        _LT_TAGVAR(always_export_symbols, $1)=no
-        _LT_TAGVAR(enable_shared_with_static_runtimes, $1)=yes
-
-        if $LD --help 2>&1 | $GREP 'auto-import' > /dev/null; then
-          _LT_TAGVAR(archive_cmds, $1)='$CC -shared -nostdlib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags -o $output_objdir/$soname ${wl}--enable-auto-image-base -Xlinker --out-implib -Xlinker $lib'
-          # If the export-symbols file already is a .def file (1st line
-          # is EXPORTS), use it as is; otherwise, prepend...
-          _LT_TAGVAR(archive_expsym_cmds, $1)='if test "x`$SED 1q $export_symbols`" = xEXPORTS; then
-	    cp $export_symbols $output_objdir/$soname.def;
-          else
-	    echo EXPORTS > $output_objdir/$soname.def;
-	    cat $export_symbols >> $output_objdir/$soname.def;
-          fi~
-          $CC -shared -nostdlib $output_objdir/$soname.def $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags -o $output_objdir/$soname ${wl}--enable-auto-image-base -Xlinker --out-implib -Xlinker $lib'
-        else
-          _LT_TAGVAR(ld_shlibs, $1)=no
-        fi
-        ;;
+	case $GXX,$cc_basename in
+	,cl* | no,cl*)
+	  # Native MSVC
+	  # hardcode_libdir_flag_spec is actually meaningless, as there is
+	  # no search path for DLLs.
+	  _LT_TAGVAR(hardcode_libdir_flag_spec, $1)=' '
+	  _LT_TAGVAR(allow_undefined_flag, $1)=unsupported
+	  _LT_TAGVAR(always_export_symbols, $1)=yes
+	  _LT_TAGVAR(file_list_spec, $1)='@'
+	  # Tell ltmain to make .lib files, not .a files.
+	  libext=lib
+	  # Tell ltmain to make .dll files, not .so files.
+	  shrext_cmds=".dll"
+	  # FIXME: Setting linknames here is a bad hack.
+	  _LT_TAGVAR(archive_cmds, $1)='$CC -o $output_objdir/$soname $libobjs $compiler_flags $deplibs -Wl,-dll~linknames='
+	  _LT_TAGVAR(archive_expsym_cmds, $1)='if test "x`$SED 1q $export_symbols`" = xEXPORTS; then
+	      $SED -n -e 's/\\\\\\\(.*\\\\\\\)/-link\\\ -EXPORT:\\\\\\\1/' -e '1\\\!p' < $export_symbols > $output_objdir/$soname.exp;
+	    else
+	      $SED -e 's/\\\\\\\(.*\\\\\\\)/-link\\\ -EXPORT:\\\\\\\1/' < $export_symbols > $output_objdir/$soname.exp;
+	    fi~
+	    $CC -o $tool_output_objdir$soname $libobjs $compiler_flags $deplibs "@$tool_output_objdir$soname.exp" -Wl,-DLL,-IMPLIB:"$tool_output_objdir$libname.dll.lib"~
+	    linknames='
+	  # The linker will not automatically build a static lib if we build a DLL.
+	  # _LT_TAGVAR(old_archive_from_new_cmds, $1)='true'
+	  _LT_TAGVAR(enable_shared_with_static_runtimes, $1)=yes
+	  # Don't use ranlib
+	  _LT_TAGVAR(old_postinstall_cmds, $1)='chmod 644 $oldlib'
+	  _LT_TAGVAR(postlink_cmds, $1)='lt_outputfile="@OUTPUT@"~
+	    lt_tool_outputfile="@TOOL_OUTPUT@"~
+	    case $lt_outputfile in
+	      *.exe|*.EXE) ;;
+	      *)
+		lt_outputfile="$lt_outputfile.exe"
+		lt_tool_outputfile="$lt_tool_outputfile.exe"
+		;;
+	    esac~
+	    func_to_tool_file "$lt_outputfile"~
+	    if test "$MANIFEST_TOOL" != ":" && test -f "$lt_outputfile.manifest"; then
+	      $MANIFEST_TOOL -manifest "$lt_tool_outputfile.manifest" -outputresource:"$lt_tool_outputfile" || exit 1;
+	      $RM "$lt_outputfile.manifest";
+	    fi'
+	  ;;
+	*)
+	  # g++
+	  # _LT_TAGVAR(hardcode_libdir_flag_spec, $1) is actually meaningless,
+	  # as there is no search path for DLLs.
+	  _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='-L$libdir'
+	  _LT_TAGVAR(export_dynamic_flag_spec, $1)='${wl}--export-all-symbols'
+	  _LT_TAGVAR(allow_undefined_flag, $1)=unsupported
+	  _LT_TAGVAR(always_export_symbols, $1)=no
+	  _LT_TAGVAR(enable_shared_with_static_runtimes, $1)=yes
+
+	  if $LD --help 2>&1 | $GREP 'auto-import' > /dev/null; then
+	    _LT_TAGVAR(archive_cmds, $1)='$CC -shared -nostdlib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags -o $output_objdir/$soname ${wl}--enable-auto-image-base -Xlinker --out-implib -Xlinker $lib'
+	    # If the export-symbols file already is a .def file (1st line
+	    # is EXPORTS), use it as is; otherwise, prepend...
+	    _LT_TAGVAR(archive_expsym_cmds, $1)='if test "x`$SED 1q $export_symbols`" = xEXPORTS; then
+	      cp $export_symbols $output_objdir/$soname.def;
+	    else
+	      echo EXPORTS > $output_objdir/$soname.def;
+	      cat $export_symbols >> $output_objdir/$soname.def;
+	    fi~
+	    $CC -shared -nostdlib $output_objdir/$soname.def $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags -o $output_objdir/$soname ${wl}--enable-auto-image-base -Xlinker --out-implib -Xlinker $lib'
+	  else
+	    _LT_TAGVAR(ld_shlibs, $1)=no
+	  fi
+	  ;;
+	esac
+	;;
       darwin* | rhapsody*)
         _LT_DARWIN_LINKER_FEATURES($1)
 	;;
@@ -5669,7 +6210,7 @@ if test "$_lt_caught_CXX_error" != yes;
         esac
         ;;
 
-      freebsd[[12]]*)
+      freebsd2.*)
         # C++ shared libraries reported to be fairly broken before
 	# switch to ELF
         _LT_TAGVAR(ld_shlibs, $1)=no
@@ -5688,6 +6229,11 @@ if test "$_lt_caught_CXX_error" != yes;
       gnu*)
         ;;
 
+      haiku*)
+        _LT_TAGVAR(archive_cmds, $1)='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
+        _LT_TAGVAR(link_all_deplibs, $1)=yes
+        ;;
+
       hpux9*)
         _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}+b ${wl}$libdir'
         _LT_TAGVAR(hardcode_libdir_separator, $1)=:
@@ -5712,11 +6258,11 @@ if test "$_lt_caught_CXX_error" != yes;
             # explicitly linking system object files so we need to strip them
             # from the output so that they don't get included in the library
             # dependencies.
-            output_verbose_link_cmd='templist=`($CC -b $CFLAGS -v conftest.$objext 2>&1) | $EGREP "\-L"`; list=""; for z in $templist; do case $z in conftest.$objext) list="$list $z";; *.$objext);; *) list="$list $z";;esac; done; $ECHO "X$list" | $Xsed'
+            output_verbose_link_cmd='templist=`($CC -b $CFLAGS -v conftest.$objext 2>&1) | $EGREP "\-L"`; list=""; for z in $templist; do case $z in conftest.$objext) list="$list $z";; *.$objext);; *) list="$list $z";;esac; done; func_echo_all "$list"'
             ;;
           *)
             if test "$GXX" = yes; then
-              _LT_TAGVAR(archive_cmds, $1)='$RM $output_objdir/$soname~$CC -shared -nostdlib -fPIC ${wl}+b ${wl}$install_libdir -o $output_objdir/$soname $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags~test $output_objdir/$soname = $lib || mv $output_objdir/$soname $lib'
+              _LT_TAGVAR(archive_cmds, $1)='$RM $output_objdir/$soname~$CC -shared -nostdlib $pic_flag ${wl}+b ${wl}$install_libdir -o $output_objdir/$soname $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags~test $output_objdir/$soname = $lib || mv $output_objdir/$soname $lib'
             else
               # FIXME: insert proper C++ library support
               _LT_TAGVAR(ld_shlibs, $1)=no
@@ -5777,7 +6323,7 @@ if test "$_lt_caught_CXX_error" != yes;
 	    # explicitly linking system object files so we need to strip them
 	    # from the output so that they don't get included in the library
 	    # dependencies.
-	    output_verbose_link_cmd='templist=`($CC -b $CFLAGS -v conftest.$objext 2>&1) | $GREP "\-L"`; list=""; for z in $templist; do case $z in conftest.$objext) list="$list $z";; *.$objext);; *) list="$list $z";;esac; done; $ECHO "X$list" | $Xsed'
+	    output_verbose_link_cmd='templist=`($CC -b $CFLAGS -v conftest.$objext 2>&1) | $GREP "\-L"`; list=""; for z in $templist; do case $z in conftest.$objext) list="$list $z";; *.$objext);; *) list="$list $z";;esac; done; func_echo_all "$list"'
 	    ;;
           *)
 	    if test "$GXX" = yes; then
@@ -5787,10 +6333,10 @@ if test "$_lt_caught_CXX_error" != yes;
 	            _LT_TAGVAR(archive_cmds, $1)='$CC -shared -nostdlib -fPIC ${wl}+h ${wl}$soname -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags'
 	            ;;
 	          ia64*)
-	            _LT_TAGVAR(archive_cmds, $1)='$CC -shared -nostdlib -fPIC ${wl}+h ${wl}$soname ${wl}+nodefaultrpath -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags'
+	            _LT_TAGVAR(archive_cmds, $1)='$CC -shared -nostdlib $pic_flag ${wl}+h ${wl}$soname ${wl}+nodefaultrpath -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags'
 	            ;;
 	          *)
-	            _LT_TAGVAR(archive_cmds, $1)='$CC -shared -nostdlib -fPIC ${wl}+h ${wl}$soname ${wl}+b ${wl}$install_libdir -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags'
+	            _LT_TAGVAR(archive_cmds, $1)='$CC -shared -nostdlib $pic_flag ${wl}+h ${wl}$soname ${wl}+b ${wl}$install_libdir -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags'
 	            ;;
 	        esac
 	      fi
@@ -5820,7 +6366,7 @@ if test "$_lt_caught_CXX_error" != yes;
         case $cc_basename in
           CC*)
 	    # SGI C++
-	    _LT_TAGVAR(archive_cmds, $1)='$CC -shared -all -multigot $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags -soname $soname `test -n "$verstring" && $ECHO "X-set_version $verstring" | $Xsed` -update_registry ${output_objdir}/so_locations -o $lib'
+	    _LT_TAGVAR(archive_cmds, $1)='$CC -shared -all -multigot $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags -soname $soname `test -n "$verstring" && func_echo_all "-set_version $verstring"` -update_registry ${output_objdir}/so_locations -o $lib'
 
 	    # Archives containing C++ object files must be created using
 	    # "CC -ar", where "CC" is the IRIX C++ compiler.  This is
@@ -5831,9 +6377,9 @@ if test "$_lt_caught_CXX_error" != yes;
           *)
 	    if test "$GXX" = yes; then
 	      if test "$with_gnu_ld" = no; then
-	        _LT_TAGVAR(archive_cmds, $1)='$CC -shared -nostdlib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname ${wl}$soname `test -n "$verstring" && $ECHO "X${wl}-set_version ${wl}$verstring" | $Xsed` ${wl}-update_registry ${wl}${output_objdir}/so_locations -o $lib'
+	        _LT_TAGVAR(archive_cmds, $1)='$CC -shared $pic_flag -nostdlib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname ${wl}$soname `test -n "$verstring" && func_echo_all "${wl}-set_version ${wl}$verstring"` ${wl}-update_registry ${wl}${output_objdir}/so_locations -o $lib'
 	      else
-	        _LT_TAGVAR(archive_cmds, $1)='$CC -shared -nostdlib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname ${wl}$soname `test -n "$verstring" && $ECHO "X${wl}-set_version ${wl}$verstring" | $Xsed` -o $lib'
+	        _LT_TAGVAR(archive_cmds, $1)='$CC -shared $pic_flag -nostdlib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname ${wl}$soname `test -n "$verstring" && func_echo_all "${wl}-set_version ${wl}$verstring"` -o $lib'
 	      fi
 	    fi
 	    _LT_TAGVAR(link_all_deplibs, $1)=yes
@@ -5844,7 +6390,7 @@ if test "$_lt_caught_CXX_error" != yes;
         _LT_TAGVAR(inherit_rpath, $1)=yes
         ;;
 
-      linux* | k*bsd*-gnu)
+      linux* | k*bsd*-gnu | kopensolaris*-gnu)
         case $cc_basename in
           KCC*)
 	    # Kuck and Associates, Inc. (KAI) C++ Compiler
@@ -5862,7 +6408,7 @@ if test "$_lt_caught_CXX_error" != yes;
 	    # explicitly linking system object files so we need to strip them
 	    # from the output so that they don't get included in the library
 	    # dependencies.
-	    output_verbose_link_cmd='templist=`$CC $CFLAGS -v conftest.$objext -o libconftest$shared_ext 2>&1 | $GREP "ld"`; rm -f libconftest$shared_ext; list=""; for z in $templist; do case $z in conftest.$objext) list="$list $z";; *.$objext);; *) list="$list $z";;esac; done; $ECHO "X$list" | $Xsed'
+	    output_verbose_link_cmd='templist=`$CC $CFLAGS -v conftest.$objext -o libconftest$shared_ext 2>&1 | $GREP "ld"`; rm -f libconftest$shared_ext; list=""; for z in $templist; do case $z in conftest.$objext) list="$list $z";; *.$objext);; *) list="$list $z";;esac; done; func_echo_all "$list"'
 
 	    _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}-rpath,$libdir'
 	    _LT_TAGVAR(export_dynamic_flag_spec, $1)='${wl}--export-dynamic'
@@ -5899,26 +6445,26 @@ if test "$_lt_caught_CXX_error" != yes;
           pgCC* | pgcpp*)
             # Portland Group C++ compiler
 	    case `$CC -V` in
-	    *pgCC\ [[1-5]]* | *pgcpp\ [[1-5]]*)
+	    *pgCC\ [[1-5]].* | *pgcpp\ [[1-5]].*)
 	      _LT_TAGVAR(prelink_cmds, $1)='tpldir=Template.dir~
 		rm -rf $tpldir~
 		$CC --prelink_objects --instantiation_dir $tpldir $objs $libobjs $compile_deplibs~
-		compile_command="$compile_command `find $tpldir -name \*.o | $NL2SP`"'
+		compile_command="$compile_command `find $tpldir -name \*.o | sort | $NL2SP`"'
 	      _LT_TAGVAR(old_archive_cmds, $1)='tpldir=Template.dir~
 		rm -rf $tpldir~
 		$CC --prelink_objects --instantiation_dir $tpldir $oldobjs$old_deplibs~
-		$AR $AR_FLAGS $oldlib$oldobjs$old_deplibs `find $tpldir -name \*.o | $NL2SP`~
+		$AR $AR_FLAGS $oldlib$oldobjs$old_deplibs `find $tpldir -name \*.o | sort | $NL2SP`~
 		$RANLIB $oldlib'
 	      _LT_TAGVAR(archive_cmds, $1)='tpldir=Template.dir~
 		rm -rf $tpldir~
 		$CC --prelink_objects --instantiation_dir $tpldir $predep_objects $libobjs $deplibs $convenience $postdep_objects~
-		$CC -shared $pic_flag $predep_objects $libobjs $deplibs `find $tpldir -name \*.o | $NL2SP` $postdep_objects $compiler_flags ${wl}-soname ${wl}$soname -o $lib'
+		$CC -shared $pic_flag $predep_objects $libobjs $deplibs `find $tpldir -name \*.o | sort | $NL2SP` $postdep_objects $compiler_flags ${wl}-soname ${wl}$soname -o $lib'
 	      _LT_TAGVAR(archive_expsym_cmds, $1)='tpldir=Template.dir~
 		rm -rf $tpldir~
 		$CC --prelink_objects --instantiation_dir $tpldir $predep_objects $libobjs $deplibs $convenience $postdep_objects~
-		$CC -shared $pic_flag $predep_objects $libobjs $deplibs `find $tpldir -name \*.o | $NL2SP` $postdep_objects $compiler_flags ${wl}-soname ${wl}$soname ${wl}-retain-symbols-file ${wl}$export_symbols -o $lib'
+		$CC -shared $pic_flag $predep_objects $libobjs $deplibs `find $tpldir -name \*.o | sort | $NL2SP` $postdep_objects $compiler_flags ${wl}-soname ${wl}$soname ${wl}-retain-symbols-file ${wl}$export_symbols -o $lib'
 	      ;;
-	    *) # Version 6 will use weak symbols
+	    *) # Version 6 and above use weak symbols
 	      _LT_TAGVAR(archive_cmds, $1)='$CC -shared $pic_flag $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname ${wl}$soname -o $lib'
 	      _LT_TAGVAR(archive_expsym_cmds, $1)='$CC -shared $pic_flag $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname ${wl}$soname ${wl}-retain-symbols-file ${wl}$export_symbols -o $lib'
 	      ;;
@@ -5926,7 +6472,7 @@ if test "$_lt_caught_CXX_error" != yes;
 
 	    _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}--rpath ${wl}$libdir'
 	    _LT_TAGVAR(export_dynamic_flag_spec, $1)='${wl}--export-dynamic'
-	    _LT_TAGVAR(whole_archive_flag_spec, $1)='${wl}--whole-archive`for conv in $convenience\"\"; do test  -n \"$conv\" && new_convenience=\"$new_convenience,$conv\"; done; $ECHO \"$new_convenience\"` ${wl}--no-whole-archive'
+	    _LT_TAGVAR(whole_archive_flag_spec, $1)='${wl}--whole-archive`for conv in $convenience\"\"; do test  -n \"$conv\" && new_convenience=\"$new_convenience,$conv\"; done; func_echo_all \"$new_convenience\"` ${wl}--no-whole-archive'
             ;;
 	  cxx*)
 	    # Compaq C++
@@ -5945,9 +6491,9 @@ if test "$_lt_caught_CXX_error" != yes;
 	    # explicitly linking system object files so we need to strip them
 	    # from the output so that they don't get included in the library
 	    # dependencies.
-	    output_verbose_link_cmd='templist=`$CC -shared $CFLAGS -v conftest.$objext 2>&1 | $GREP "ld"`; templist=`$ECHO "X$templist" | $Xsed -e "s/\(^.*ld.*\)\( .*ld .*$\)/\1/"`; list=""; for z in $templist; do case $z in conftest.$objext) list="$list $z";; *.$objext);; *) list="$list $z";;esac; done; $ECHO "X$list" | $Xsed'
+	    output_verbose_link_cmd='templist=`$CC -shared $CFLAGS -v conftest.$objext 2>&1 | $GREP "ld"`; templist=`func_echo_all "$templist" | $SED "s/\(^.*ld.*\)\( .*ld .*$\)/\1/"`; list=""; for z in $templist; do case $z in conftest.$objext) list="$list $z";; *.$objext);; *) list="$list $z";;esac; done; func_echo_all "X$list" | $Xsed'
 	    ;;
-	  xl*)
+	  xl* | mpixl* | bgxl*)
 	    # IBM XL 8.0 on PPC, with GNU ld
 	    _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}-rpath ${wl}$libdir'
 	    _LT_TAGVAR(export_dynamic_flag_spec, $1)='${wl}--export-dynamic'
@@ -5967,13 +6513,13 @@ if test "$_lt_caught_CXX_error" != yes;
 	      _LT_TAGVAR(archive_cmds, $1)='$CC -G${allow_undefined_flag} -h$soname -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags'
 	      _LT_TAGVAR(archive_expsym_cmds, $1)='$CC -G${allow_undefined_flag} -h$soname -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-retain-symbols-file ${wl}$export_symbols'
 	      _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='-R$libdir'
-	      _LT_TAGVAR(whole_archive_flag_spec, $1)='${wl}--whole-archive`new_convenience=; for conv in $convenience\"\"; do test -z \"$conv\" || new_convenience=\"$new_convenience,$conv\"; done; $ECHO \"$new_convenience\"` ${wl}--no-whole-archive'
+	      _LT_TAGVAR(whole_archive_flag_spec, $1)='${wl}--whole-archive`new_convenience=; for conv in $convenience\"\"; do test -z \"$conv\" || new_convenience=\"$new_convenience,$conv\"; done; func_echo_all \"$new_convenience\"` ${wl}--no-whole-archive'
 	      _LT_TAGVAR(compiler_needs_object, $1)=yes
 
 	      # Not sure whether something based on
 	      # $CC $CFLAGS -v conftest.$objext -o libconftest$shared_ext 2>&1
 	      # would be better.
-	      output_verbose_link_cmd='echo'
+	      output_verbose_link_cmd='func_echo_all'
 
 	      # Archives containing C++ object files must be created using
 	      # "CC -xar", where "CC" is the Sun C++ compiler.  This is
@@ -6042,7 +6588,7 @@ if test "$_lt_caught_CXX_error" != yes;
 	    _LT_TAGVAR(export_dynamic_flag_spec, $1)='${wl}-E'
 	    _LT_TAGVAR(whole_archive_flag_spec, $1)="$wlarc"'--whole-archive$convenience '"$wlarc"'--no-whole-archive'
 	  fi
-	  output_verbose_link_cmd=echo
+	  output_verbose_link_cmd=func_echo_all
 	else
 	  _LT_TAGVAR(ld_shlibs, $1)=no
 	fi
@@ -6077,15 +6623,15 @@ if test "$_lt_caught_CXX_error" != yes;
 	    case $host in
 	      osf3*)
 	        _LT_TAGVAR(allow_undefined_flag, $1)=' ${wl}-expect_unresolved ${wl}\*'
-	        _LT_TAGVAR(archive_cmds, $1)='$CC -shared${allow_undefined_flag} $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname $soname `test -n "$verstring" && $ECHO "X${wl}-set_version $verstring" | $Xsed` -update_registry ${output_objdir}/so_locations -o $lib'
+	        _LT_TAGVAR(archive_cmds, $1)='$CC -shared${allow_undefined_flag} $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname $soname `test -n "$verstring" && func_echo_all "${wl}-set_version $verstring"` -update_registry ${output_objdir}/so_locations -o $lib'
 	        _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}-rpath ${wl}$libdir'
 		;;
 	      *)
 	        _LT_TAGVAR(allow_undefined_flag, $1)=' -expect_unresolved \*'
-	        _LT_TAGVAR(archive_cmds, $1)='$CC -shared${allow_undefined_flag} $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags -msym -soname $soname `test -n "$verstring" && $ECHO "X-set_version $verstring" | $Xsed` -update_registry ${output_objdir}/so_locations -o $lib'
+	        _LT_TAGVAR(archive_cmds, $1)='$CC -shared${allow_undefined_flag} $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags -msym -soname $soname `test -n "$verstring" && func_echo_all "-set_version $verstring"` -update_registry ${output_objdir}/so_locations -o $lib'
 	        _LT_TAGVAR(archive_expsym_cmds, $1)='for i in `cat $export_symbols`; do printf "%s %s\\n" -exported_symbol "\$i" >> $lib.exp; done~
 	          echo "-hidden">> $lib.exp~
-	          $CC -shared$allow_undefined_flag $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags -msym -soname $soname ${wl}-input ${wl}$lib.exp  `test -n "$verstring" && $ECHO "X-set_version $verstring" | $Xsed` -update_registry ${output_objdir}/so_locations -o $lib~
+	          $CC -shared$allow_undefined_flag $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags -msym -soname $soname ${wl}-input ${wl}$lib.exp  `test -n "$verstring" && $ECHO "-set_version $verstring"` -update_registry ${output_objdir}/so_locations -o $lib~
 	          $RM $lib.exp'
 	        _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='-rpath $libdir'
 		;;
@@ -6101,17 +6647,17 @@ if test "$_lt_caught_CXX_error" != yes;
 	    # explicitly linking system object files so we need to strip them
 	    # from the output so that they don't get included in the library
 	    # dependencies.
-	    output_verbose_link_cmd='templist=`$CC -shared $CFLAGS -v conftest.$objext 2>&1 | $GREP "ld" | $GREP -v "ld:"`; templist=`$ECHO "X$templist" | $Xsed -e "s/\(^.*ld.*\)\( .*ld.*$\)/\1/"`; list=""; for z in $templist; do case $z in conftest.$objext) list="$list $z";; *.$objext);; *) list="$list $z";;esac; done; $ECHO "X$list" | $Xsed'
+	    output_verbose_link_cmd='templist=`$CC -shared $CFLAGS -v conftest.$objext 2>&1 | $GREP "ld" | $GREP -v "ld:"`; templist=`func_echo_all "$templist" | $SED "s/\(^.*ld.*\)\( .*ld.*$\)/\1/"`; list=""; for z in $templist; do case $z in conftest.$objext) list="$list $z";; *.$objext);; *) list="$list $z";;esac; done; func_echo_all "$list"'
 	    ;;
 	  *)
 	    if test "$GXX" = yes && test "$with_gnu_ld" = no; then
 	      _LT_TAGVAR(allow_undefined_flag, $1)=' ${wl}-expect_unresolved ${wl}\*'
 	      case $host in
 	        osf3*)
-	          _LT_TAGVAR(archive_cmds, $1)='$CC -shared -nostdlib ${allow_undefined_flag} $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname ${wl}$soname `test -n "$verstring" && $ECHO "X${wl}-set_version ${wl}$verstring" | $Xsed` ${wl}-update_registry ${wl}${output_objdir}/so_locations -o $lib'
+	          _LT_TAGVAR(archive_cmds, $1)='$CC -shared -nostdlib ${allow_undefined_flag} $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname ${wl}$soname `test -n "$verstring" && func_echo_all "${wl}-set_version ${wl}$verstring"` ${wl}-update_registry ${wl}${output_objdir}/so_locations -o $lib'
 		  ;;
 	        *)
-	          _LT_TAGVAR(archive_cmds, $1)='$CC -shared -nostdlib ${allow_undefined_flag} $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-msym ${wl}-soname ${wl}$soname `test -n "$verstring" && $ECHO "${wl}-set_version ${wl}$verstring" | $Xsed` ${wl}-update_registry ${wl}${output_objdir}/so_locations -o $lib'
+	          _LT_TAGVAR(archive_cmds, $1)='$CC -shared $pic_flag -nostdlib ${allow_undefined_flag} $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-msym ${wl}-soname ${wl}$soname `test -n "$verstring" && func_echo_all "${wl}-set_version ${wl}$verstring"` ${wl}-update_registry ${wl}${output_objdir}/so_locations -o $lib'
 		  ;;
 	      esac
 
@@ -6121,7 +6667,7 @@ if test "$_lt_caught_CXX_error" != yes;
 	      # Commands to make compiler produce verbose output that lists
 	      # what "hidden" libraries, object files and flags are used when
 	      # linking a shared library.
-	      output_verbose_link_cmd='$CC -shared $CFLAGS -v conftest.$objext 2>&1 | $GREP "\-L"'
+	      output_verbose_link_cmd='$CC -shared $CFLAGS -v conftest.$objext 2>&1 | $GREP -v "^Configured with:" | $GREP "\-L"'
 
 	    else
 	      # FIXME: insert proper C++ library support
@@ -6157,7 +6703,7 @@ if test "$_lt_caught_CXX_error" != yes;
 
       solaris*)
         case $cc_basename in
-          CC*)
+          CC* | sunCC*)
 	    # Sun C++ 4.2, 5.x and Centerline C++
             _LT_TAGVAR(archive_cmds_need_lc,$1)=yes
 	    _LT_TAGVAR(no_undefined_flag, $1)=' -zdefs'
@@ -6178,7 +6724,7 @@ if test "$_lt_caught_CXX_error" != yes;
 	    esac
 	    _LT_TAGVAR(link_all_deplibs, $1)=yes
 
-	    output_verbose_link_cmd='echo'
+	    output_verbose_link_cmd='func_echo_all'
 
 	    # Archives containing C++ object files must be created using
 	    # "CC -xar", where "CC" is the Sun C++ compiler.  This is
@@ -6198,14 +6744,14 @@ if test "$_lt_caught_CXX_error" != yes;
 	    if test "$GXX" = yes && test "$with_gnu_ld" = no; then
 	      _LT_TAGVAR(no_undefined_flag, $1)=' ${wl}-z ${wl}defs'
 	      if $CC --version | $GREP -v '^2\.7' > /dev/null; then
-	        _LT_TAGVAR(archive_cmds, $1)='$CC -shared -nostdlib $LDFLAGS $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-h $wl$soname -o $lib'
+	        _LT_TAGVAR(archive_cmds, $1)='$CC -shared $pic_flag -nostdlib $LDFLAGS $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-h $wl$soname -o $lib'
 	        _LT_TAGVAR(archive_expsym_cmds, $1)='echo "{ global:" > $lib.exp~cat $export_symbols | $SED -e "s/\(.*\)/\1;/" >> $lib.exp~echo "local: *; };" >> $lib.exp~
-		  $CC -shared -nostdlib ${wl}-M $wl$lib.exp -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags~$RM $lib.exp'
+		  $CC -shared $pic_flag -nostdlib ${wl}-M $wl$lib.exp -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags~$RM $lib.exp'
 
 	        # Commands to make compiler produce verbose output that lists
 	        # what "hidden" libraries, object files and flags are used when
 	        # linking a shared library.
-	        output_verbose_link_cmd='$CC -shared $CFLAGS -v conftest.$objext 2>&1 | $GREP "\-L"'
+	        output_verbose_link_cmd='$CC -shared $CFLAGS -v conftest.$objext 2>&1 | $GREP -v "^Configured with:" | $GREP "\-L"'
 	      else
 	        # g++ 2.7 appears to require `-G' NOT `-shared' on this
 	        # platform.
@@ -6216,7 +6762,7 @@ if test "$_lt_caught_CXX_error" != yes;
 	        # Commands to make compiler produce verbose output that lists
 	        # what "hidden" libraries, object files and flags are used when
 	        # linking a shared library.
-	        output_verbose_link_cmd='$CC -G $CFLAGS -v conftest.$objext 2>&1 | $GREP "\-L"'
+	        output_verbose_link_cmd='$CC -G $CFLAGS -v conftest.$objext 2>&1 | $GREP -v "^Configured with:" | $GREP "\-L"'
 	      fi
 
 	      _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}-R $wl$libdir'
@@ -6270,6 +6816,10 @@ if test "$_lt_caught_CXX_error" != yes;
           CC*)
 	    _LT_TAGVAR(archive_cmds, $1)='$CC -G ${wl}-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
 	    _LT_TAGVAR(archive_expsym_cmds, $1)='$CC -G ${wl}-Bexport:$export_symbols ${wl}-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
+	    _LT_TAGVAR(old_archive_cmds, $1)='$CC -Tprelink_objects $oldobjs~
+	      '"$_LT_TAGVAR(old_archive_cmds, $1)"
+	    _LT_TAGVAR(reload_cmds, $1)='$CC -Tprelink_objects $reload_objs~
+	      '"$_LT_TAGVAR(reload_cmds, $1)"
 	    ;;
 	  *)
 	    _LT_TAGVAR(archive_cmds, $1)='$CC -shared ${wl}-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
@@ -6325,6 +6875,7 @@ if test "$_lt_caught_CXX_error" != yes;
   fi # test -n "$compiler"
 
   CC=$lt_save_CC
+  CFLAGS=$lt_save_CFLAGS
   LDCXX=$LD
   LD=$lt_save_LD
   GCC=$lt_save_GCC
@@ -6339,6 +6890,29 @@ AC_LANG_POP
 ])# _LT_LANG_CXX_CONFIG
 
 
+# _LT_FUNC_STRIPNAME_CNF
+# ----------------------
+# func_stripname_cnf prefix suffix name
+# strip PREFIX and SUFFIX off of NAME.
+# PREFIX and SUFFIX must not contain globbing or regex special
+# characters, hashes, percent signs, but SUFFIX may contain a leading
+# dot (in which case that matches only a dot).
+#
+# This function is identical to the (non-XSI) version of func_stripname,
+# except this one can be used by m4 code that may be executed by configure,
+# rather than the libtool script.
+m4_defun([_LT_FUNC_STRIPNAME_CNF],[dnl
+AC_REQUIRE([_LT_DECL_SED])
+AC_REQUIRE([_LT_PROG_ECHO_BACKSLASH])
+func_stripname_cnf ()
+{
+  case ${2} in
+  .*) func_stripname_result=`$ECHO "${3}" | $SED "s%^${1}%%; s%\\\\${2}\$%%"`;;
+  *)  func_stripname_result=`$ECHO "${3}" | $SED "s%^${1}%%; s%${2}\$%%"`;;
+  esac
+} # func_stripname_cnf
+])# _LT_FUNC_STRIPNAME_CNF
+
 # _LT_SYS_HIDDEN_LIBDEPS([TAGNAME])
 # ---------------------------------
 # Figure out "hidden" library dependencies from verbose
@@ -6347,6 +6921,7 @@ AC_LANG_POP
 # objects, libraries and library flags.
 m4_defun([_LT_SYS_HIDDEN_LIBDEPS],
 [m4_require([_LT_FILEUTILS_DEFAULTS])dnl
+AC_REQUIRE([_LT_FUNC_STRIPNAME_CNF])dnl
 # Dependencies to place before and after the object being linked:
 _LT_TAGVAR(predep_objects, $1)=
 _LT_TAGVAR(postdep_objects, $1)=
@@ -6396,7 +6971,20 @@ public class foo {
   }
 };
 _LT_EOF
+], [$1], [GO], [cat > conftest.$ac_ext <<_LT_EOF
+package foo
+func foo() {
+}
+_LT_EOF
 ])
+
+_lt_libdeps_save_CFLAGS=$CFLAGS
+case "$CC $CFLAGS " in #(
+*\ -flto*\ *) CFLAGS="$CFLAGS -fno-lto" ;;
+*\ -fwhopr*\ *) CFLAGS="$CFLAGS -fno-whopr" ;;
+*\ -fuse-linker-plugin*\ *) CFLAGS="$CFLAGS -fno-use-linker-plugin" ;;
+esac
+
 dnl Parse the compiler output and extract the necessary
 dnl objects, libraries and library flags.
 if AC_TRY_EVAL(ac_compile); then
@@ -6408,7 +6996,7 @@ if AC_TRY_EVAL(ac_compile); then
   pre_test_object_deps_done=no
 
   for p in `eval "$output_verbose_link_cmd"`; do
-    case $p in
+    case ${prev}${p} in
 
     -L* | -R* | -l*)
        # Some compilers place space between "-{L,R}" and the path.
@@ -6417,13 +7005,22 @@ if AC_TRY_EVAL(ac_compile); then
           test $p = "-R"; then
 	 prev=$p
 	 continue
-       else
-	 prev=
        fi
 
+       # Expand the sysroot to ease extracting the directories later.
+       if test -z "$prev"; then
+         case $p in
+         -L*) func_stripname_cnf '-L' '' "$p"; prev=-L; p=$func_stripname_result ;;
+         -R*) func_stripname_cnf '-R' '' "$p"; prev=-R; p=$func_stripname_result ;;
+         -l*) func_stripname_cnf '-l' '' "$p"; prev=-l; p=$func_stripname_result ;;
+         esac
+       fi
+       case $p in
+       =*) func_stripname_cnf '=' '' "$p"; p=$lt_sysroot$func_stripname_result ;;
+       esac
        if test "$pre_test_object_deps_done" = no; then
-	 case $p in
-	 -L* | -R*)
+	 case ${prev} in
+	 -L | -R)
 	   # Internal compiler library paths should come after those
 	   # provided the user.  The postdeps already come after the
 	   # user supplied libs so there is no need to process them.
@@ -6443,8 +7040,10 @@ if AC_TRY_EVAL(ac_compile); then
 	   _LT_TAGVAR(postdeps, $1)="${_LT_TAGVAR(postdeps, $1)} ${prev}${p}"
 	 fi
        fi
+       prev=
        ;;
 
+    *.lto.$objext) ;; # Ignore GCC LTO objects
     *.$objext)
        # This assumes that the test object file only shows up
        # once in the compiler output.
@@ -6480,6 +7079,7 @@ else
 fi
 
 $RM -f confest.$objext
+CFLAGS=$_lt_libdeps_save_CFLAGS
 
 # PORTME: override above test on systems where it is broken
 m4_if([$1], [CXX],
@@ -6516,7 +7116,7 @@ linux*)
 
 solaris*)
   case $cc_basename in
-  CC*)
+  CC* | sunCC*)
     # The more standards-conforming stlport4 library is
     # incompatible with the Cstd library. Avoid specifying
     # it if it's in CXXFLAGS. Ignore libCrun as
@@ -6560,32 +7160,16 @@ _LT_TAGDECL([], [compiler_lib_search_pat
 ])# _LT_SYS_HIDDEN_LIBDEPS
 
 
-# _LT_PROG_F77
-# ------------
-# Since AC_PROG_F77 is broken, in that it returns the empty string
-# if there is no fortran compiler, we have our own version here.
-m4_defun([_LT_PROG_F77],
-[
-pushdef([AC_MSG_ERROR], [_lt_disable_F77=yes])
-AC_PROG_F77
-if test -z "$F77" || test "X$F77" = "Xno"; then
-  _lt_disable_F77=yes
-fi
-popdef([AC_MSG_ERROR])
-])# _LT_PROG_F77
-
-dnl aclocal-1.4 backwards compatibility:
-dnl AC_DEFUN([_LT_PROG_F77], [])
-
-
 # _LT_LANG_F77_CONFIG([TAG])
 # --------------------------
 # Ensure that the configuration variables for a Fortran 77 compiler are
 # suitably defined.  These variables are subsequently used by _LT_CONFIG
 # to write the compiler configuration to `libtool'.
 m4_defun([_LT_LANG_F77_CONFIG],
-[AC_REQUIRE([_LT_PROG_F77])dnl
-AC_LANG_PUSH(Fortran 77)
+[AC_LANG_PUSH(Fortran 77)
+if test -z "$F77" || test "X$F77" = "Xno"; then
+  _lt_disable_F77=yes
+fi
 
 _LT_TAGVAR(archive_cmds_need_lc, $1)=no
 _LT_TAGVAR(allow_undefined_flag, $1)=
@@ -6595,7 +7179,6 @@ _LT_TAGVAR(export_dynamic_flag_spec, $1)
 _LT_TAGVAR(hardcode_direct, $1)=no
 _LT_TAGVAR(hardcode_direct_absolute, $1)=no
 _LT_TAGVAR(hardcode_libdir_flag_spec, $1)=
-_LT_TAGVAR(hardcode_libdir_flag_spec_ld, $1)=
 _LT_TAGVAR(hardcode_libdir_separator, $1)=
 _LT_TAGVAR(hardcode_minus_L, $1)=no
 _LT_TAGVAR(hardcode_automatic, $1)=no
@@ -6604,6 +7187,8 @@ _LT_TAGVAR(module_cmds, $1)=
 _LT_TAGVAR(module_expsym_cmds, $1)=
 _LT_TAGVAR(link_all_deplibs, $1)=unknown
 _LT_TAGVAR(old_archive_cmds, $1)=$old_archive_cmds
+_LT_TAGVAR(reload_flag, $1)=$reload_flag
+_LT_TAGVAR(reload_cmds, $1)=$reload_cmds
 _LT_TAGVAR(no_undefined_flag, $1)=
 _LT_TAGVAR(whole_archive_flag_spec, $1)=
 _LT_TAGVAR(enable_shared_with_static_runtimes, $1)=no
@@ -6643,7 +7228,9 @@ if test "$_lt_disable_F77" != yes; then
   # Allow CC to be a program name with arguments.
   lt_save_CC="$CC"
   lt_save_GCC=$GCC
+  lt_save_CFLAGS=$CFLAGS
   CC=${F77-"f77"}
+  CFLAGS=$FFLAGS
   compiler=$CC
   _LT_TAGVAR(compiler, $1)=$CC
   _LT_CC_BASENAME([$compiler])
@@ -6697,38 +7284,24 @@ if test "$_lt_disable_F77" != yes; then
 
   GCC=$lt_save_GCC
   CC="$lt_save_CC"
+  CFLAGS="$lt_save_CFLAGS"
 fi # test "$_lt_disable_F77" != yes
 
 AC_LANG_POP
 ])# _LT_LANG_F77_CONFIG
 
 
-# _LT_PROG_FC
-# -----------
-# Since AC_PROG_FC is broken, in that it returns the empty string
-# if there is no fortran compiler, we have our own version here.
-m4_defun([_LT_PROG_FC],
-[
-pushdef([AC_MSG_ERROR], [_lt_disable_FC=yes])
-AC_PROG_FC
-if test -z "$FC" || test "X$FC" = "Xno"; then
-  _lt_disable_FC=yes
-fi
-popdef([AC_MSG_ERROR])
-])# _LT_PROG_FC
-
-dnl aclocal-1.4 backwards compatibility:
-dnl AC_DEFUN([_LT_PROG_FC], [])
-
-
 # _LT_LANG_FC_CONFIG([TAG])
 # -------------------------
 # Ensure that the configuration variables for a Fortran compiler are
 # suitably defined.  These variables are subsequently used by _LT_CONFIG
 # to write the compiler configuration to `libtool'.
 m4_defun([_LT_LANG_FC_CONFIG],
-[AC_REQUIRE([_LT_PROG_FC])dnl
-AC_LANG_PUSH(Fortran)
+[AC_LANG_PUSH(Fortran)
+
+if test -z "$FC" || test "X$FC" = "Xno"; then
+  _lt_disable_FC=yes
+fi
 
 _LT_TAGVAR(archive_cmds_need_lc, $1)=no
 _LT_TAGVAR(allow_undefined_flag, $1)=
@@ -6738,7 +7311,6 @@ _LT_TAGVAR(export_dynamic_flag_spec, $1)
 _LT_TAGVAR(hardcode_direct, $1)=no
 _LT_TAGVAR(hardcode_direct_absolute, $1)=no
 _LT_TAGVAR(hardcode_libdir_flag_spec, $1)=
-_LT_TAGVAR(hardcode_libdir_flag_spec_ld, $1)=
 _LT_TAGVAR(hardcode_libdir_separator, $1)=
 _LT_TAGVAR(hardcode_minus_L, $1)=no
 _LT_TAGVAR(hardcode_automatic, $1)=no
@@ -6747,6 +7319,8 @@ _LT_TAGVAR(module_cmds, $1)=
 _LT_TAGVAR(module_expsym_cmds, $1)=
 _LT_TAGVAR(link_all_deplibs, $1)=unknown
 _LT_TAGVAR(old_archive_cmds, $1)=$old_archive_cmds
+_LT_TAGVAR(reload_flag, $1)=$reload_flag
+_LT_TAGVAR(reload_cmds, $1)=$reload_cmds
 _LT_TAGVAR(no_undefined_flag, $1)=
 _LT_TAGVAR(whole_archive_flag_spec, $1)=
 _LT_TAGVAR(enable_shared_with_static_runtimes, $1)=no
@@ -6786,7 +7360,9 @@ if test "$_lt_disable_FC" != yes; then
   # Allow CC to be a program name with arguments.
   lt_save_CC="$CC"
   lt_save_GCC=$GCC
+  lt_save_CFLAGS=$CFLAGS
   CC=${FC-"f95"}
+  CFLAGS=$FCFLAGS
   compiler=$CC
   GCC=$ac_cv_fc_compiler_gnu
 
@@ -6842,7 +7418,8 @@ if test "$_lt_disable_FC" != yes; then
   fi # test -n "$compiler"
 
   GCC=$lt_save_GCC
-  CC="$lt_save_CC"
+  CC=$lt_save_CC
+  CFLAGS=$lt_save_CFLAGS
 fi # test "$_lt_disable_FC" != yes
 
 AC_LANG_POP
@@ -6879,10 +7456,12 @@ _LT_COMPILER_BOILERPLATE
 _LT_LINKER_BOILERPLATE
 
 # Allow CC to be a program name with arguments.
-lt_save_CC="$CC"
+lt_save_CC=$CC
+lt_save_CFLAGS=$CFLAGS
 lt_save_GCC=$GCC
 GCC=yes
 CC=${GCJ-"gcj"}
+CFLAGS=$GCJFLAGS
 compiler=$CC
 _LT_TAGVAR(compiler, $1)=$CC
 _LT_TAGVAR(LD, $1)="$LD"
@@ -6892,6 +7471,8 @@ _LT_CC_BASENAME([$compiler])
 _LT_TAGVAR(archive_cmds_need_lc, $1)=no
 
 _LT_TAGVAR(old_archive_cmds, $1)=$old_archive_cmds
+_LT_TAGVAR(reload_flag, $1)=$reload_flag
+_LT_TAGVAR(reload_cmds, $1)=$reload_cmds
 
 ## CAVEAT EMPTOR:
 ## There is no encapsulation within the following macros, do not change
@@ -6911,10 +7492,82 @@ fi
 AC_LANG_RESTORE
 
 GCC=$lt_save_GCC
-CC="$lt_save_CC"
+CC=$lt_save_CC
+CFLAGS=$lt_save_CFLAGS
 ])# _LT_LANG_GCJ_CONFIG
 
 
+# _LT_LANG_GO_CONFIG([TAG])
+# --------------------------
+# Ensure that the configuration variables for the GNU Go compiler
+# are suitably defined.  These variables are subsequently used by _LT_CONFIG
+# to write the compiler configuration to `libtool'.
+m4_defun([_LT_LANG_GO_CONFIG],
+[AC_REQUIRE([LT_PROG_GO])dnl
+AC_LANG_SAVE
+
+# Source file extension for Go test sources.
+ac_ext=go
+
+# Object file extension for compiled Go test sources.
+objext=o
+_LT_TAGVAR(objext, $1)=$objext
+
+# Code to be used in simple compile tests
+lt_simple_compile_test_code="package main; func main() { }"
+
+# Code to be used in simple link tests
+lt_simple_link_test_code='package main; func main() { }'
+
+# ltmain only uses $CC for tagged configurations so make sure $CC is set.
+_LT_TAG_COMPILER
+
+# save warnings/boilerplate of simple test code
+_LT_COMPILER_BOILERPLATE
+_LT_LINKER_BOILERPLATE
+
+# Allow CC to be a program name with arguments.
+lt_save_CC=$CC
+lt_save_CFLAGS=$CFLAGS
+lt_save_GCC=$GCC
+GCC=yes
+CC=${GOC-"gccgo"}
+CFLAGS=$GOFLAGS
+compiler=$CC
+_LT_TAGVAR(compiler, $1)=$CC
+_LT_TAGVAR(LD, $1)="$LD"
+_LT_CC_BASENAME([$compiler])
+
+# Go did not exist at the time GCC didn't implicitly link libc in.
+_LT_TAGVAR(archive_cmds_need_lc, $1)=no
+
+_LT_TAGVAR(old_archive_cmds, $1)=$old_archive_cmds
+_LT_TAGVAR(reload_flag, $1)=$reload_flag
+_LT_TAGVAR(reload_cmds, $1)=$reload_cmds
+
+## CAVEAT EMPTOR:
+## There is no encapsulation within the following macros, do not change
+## the running order or otherwise move them around unless you know exactly
+## what you are doing...
+if test -n "$compiler"; then
+  _LT_COMPILER_NO_RTTI($1)
+  _LT_COMPILER_PIC($1)
+  _LT_COMPILER_C_O($1)
+  _LT_COMPILER_FILE_LOCKS($1)
+  _LT_LINKER_SHLIBS($1)
+  _LT_LINKER_HARDCODE_LIBPATH($1)
+
+  _LT_CONFIG($1)
+fi
+
+AC_LANG_RESTORE
+
+GCC=$lt_save_GCC
+CC=$lt_save_CC
+CFLAGS=$lt_save_CFLAGS
+])# _LT_LANG_GO_CONFIG
+
+
 # _LT_LANG_RC_CONFIG([TAG])
 # -------------------------
 # Ensure that the configuration variables for the Windows resource compiler
@@ -6946,9 +7599,11 @@ _LT_LINKER_BOILERPLATE
 
 # Allow CC to be a program name with arguments.
 lt_save_CC="$CC"
+lt_save_CFLAGS=$CFLAGS
 lt_save_GCC=$GCC
 GCC=
 CC=${RC-"windres"}
+CFLAGS=
 compiler=$CC
 _LT_TAGVAR(compiler, $1)=$CC
 _LT_CC_BASENAME([$compiler])
@@ -6961,7 +7616,8 @@ fi
 
 GCC=$lt_save_GCC
 AC_LANG_RESTORE
-CC="$lt_save_CC"
+CC=$lt_save_CC
+CFLAGS=$lt_save_CFLAGS
 ])# _LT_LANG_RC_CONFIG
 
 
@@ -6981,6 +7637,13 @@ dnl aclocal-1.4 backwards compatibility:
 dnl AC_DEFUN([LT_AC_PROG_GCJ], [])
 
 
+# LT_PROG_GO
+# ----------
+AC_DEFUN([LT_PROG_GO],
+[AC_CHECK_TOOL(GOC, gccgo,)
+])
+
+
 # LT_PROG_RC
 # ----------
 AC_DEFUN([LT_PROG_RC],
@@ -7020,6 +7683,15 @@ _LT_DECL([], [OBJDUMP], [1], [An object
 AC_SUBST([OBJDUMP])
 ])
 
+# _LT_DECL_DLLTOOL
+# ----------------
+# Ensure DLLTOOL variable is set.
+m4_defun([_LT_DECL_DLLTOOL],
+[AC_CHECK_TOOL(DLLTOOL, dlltool, false)
+test -z "$DLLTOOL" && DLLTOOL=dlltool
+_LT_DECL([], [DLLTOOL], [1], [DLL creation program])
+AC_SUBST([DLLTOOL])
+])
 
 # _LT_DECL_SED
 # ------------
@@ -7113,8 +7785,8 @@ m4_defun([_LT_CHECK_SHELL_FEATURES],
 # Try some XSI features
 xsi_shell=no
 ( _lt_dummy="a/b/c"
-  test "${_lt_dummy##*/},${_lt_dummy%/*},"${_lt_dummy%"$_lt_dummy"}, \
-      = c,a/b,, \
+  test "${_lt_dummy##*/},${_lt_dummy%/*},${_lt_dummy#??}"${_lt_dummy%"$_lt_dummy"}, \
+      = c,a/b,b/c, \
     && eval 'test $(( 1 + 1 )) -eq 2 \
     && test "${#_lt_dummy}" -eq 5' ) >/dev/null 2>&1 \
   && xsi_shell=yes
@@ -7153,208 +7825,162 @@ _LT_DECL([NL2SP], [lt_NL2SP], [1], [turn
 ])# _LT_CHECK_SHELL_FEATURES
 
 
-# _LT_PROG_XSI_SHELLFNS
-# ---------------------
-# Bourne and XSI compatible variants of some useful shell functions.
-m4_defun([_LT_PROG_XSI_SHELLFNS],
-[case $xsi_shell in
-  yes)
-    cat << \_LT_EOF >> "$cfgfile"
-
-# func_dirname file append nondir_replacement
-# Compute the dirname of FILE.  If nonempty, add APPEND to the result,
-# otherwise set result to NONDIR_REPLACEMENT.
-func_dirname ()
-{
-  case ${1} in
-    */*) func_dirname_result="${1%/*}${2}" ;;
-    *  ) func_dirname_result="${3}" ;;
-  esac
-}
-
-# func_basename file
-func_basename ()
-{
-  func_basename_result="${1##*/}"
-}
-
-# func_dirname_and_basename file append nondir_replacement
-# perform func_basename and func_dirname in a single function
-# call:
-#   dirname:  Compute the dirname of FILE.  If nonempty,
-#             add APPEND to the result, otherwise set result
-#             to NONDIR_REPLACEMENT.
-#             value returned in "$func_dirname_result"
-#   basename: Compute filename of FILE.
-#             value retuned in "$func_basename_result"
-# Implementation must be kept synchronized with func_dirname
-# and func_basename. For efficiency, we do not delegate to
-# those functions but instead duplicate the functionality here.
-func_dirname_and_basename ()
-{
-  case ${1} in
-    */*) func_dirname_result="${1%/*}${2}" ;;
-    *  ) func_dirname_result="${3}" ;;
-  esac
-  func_basename_result="${1##*/}"
-}
-
-# func_stripname prefix suffix name
-# strip PREFIX and SUFFIX off of NAME.
-# PREFIX and SUFFIX must not contain globbing or regex special
-# characters, hashes, percent signs, but SUFFIX may contain a leading
-# dot (in which case that matches only a dot).
-func_stripname ()
-{
-  # pdksh 5.2.14 does not do ${X%$Y} correctly if both X and Y are
-  # positional parameters, so assign one to ordinary parameter first.
-  func_stripname_result=${3}
-  func_stripname_result=${func_stripname_result#"${1}"}
-  func_stripname_result=${func_stripname_result%"${2}"}
-}
-
-# func_opt_split
-func_opt_split ()
-{
-  func_opt_split_opt=${1%%=*}
-  func_opt_split_arg=${1#*=}
-}
-
-# func_lo2o object
-func_lo2o ()
-{
-  case ${1} in
-    *.lo) func_lo2o_result=${1%.lo}.${objext} ;;
-    *)    func_lo2o_result=${1} ;;
-  esac
-}
-
-# func_xform libobj-or-source
-func_xform ()
-{
-  func_xform_result=${1%.*}.lo
-}
+# _LT_PROG_FUNCTION_REPLACE (FUNCNAME, REPLACEMENT-BODY)
+# ------------------------------------------------------
+# In `$cfgfile', look for function FUNCNAME delimited by `^FUNCNAME ()$' and
+# '^} FUNCNAME ', and replace its body with REPLACEMENT-BODY.
+m4_defun([_LT_PROG_FUNCTION_REPLACE],
+[dnl {
+sed -e '/^$1 ()$/,/^} # $1 /c\
+$1 ()\
+{\
+m4_bpatsubsts([$2], [$], [\\], [^\([	 ]\)], [\\\1])
+} # Extended-shell $1 implementation' "$cfgfile" > $cfgfile.tmp \
+  && mv -f "$cfgfile.tmp" "$cfgfile" \
+    || (rm -f "$cfgfile" && cp "$cfgfile.tmp" "$cfgfile" && rm -f "$cfgfile.tmp")
+test 0 -eq $? || _lt_function_replace_fail=:
+])
 
-# func_arith arithmetic-term...
-func_arith ()
-{
-  func_arith_result=$(( $[*] ))
-}
 
-# func_len string
-# STRING may not start with a hyphen.
-func_len ()
-{
-  func_len_result=${#1}
-}
+# _LT_PROG_REPLACE_SHELLFNS
+# -------------------------
+# Replace existing portable implementations of several shell functions with
+# equivalent extended shell implementations where those features are available..
+m4_defun([_LT_PROG_REPLACE_SHELLFNS],
+[if test x"$xsi_shell" = xyes; then
+  _LT_PROG_FUNCTION_REPLACE([func_dirname], [dnl
+    case ${1} in
+      */*) func_dirname_result="${1%/*}${2}" ;;
+      *  ) func_dirname_result="${3}" ;;
+    esac])
+
+  _LT_PROG_FUNCTION_REPLACE([func_basename], [dnl
+    func_basename_result="${1##*/}"])
+
+  _LT_PROG_FUNCTION_REPLACE([func_dirname_and_basename], [dnl
+    case ${1} in
+      */*) func_dirname_result="${1%/*}${2}" ;;
+      *  ) func_dirname_result="${3}" ;;
+    esac
+    func_basename_result="${1##*/}"])
 
-_LT_EOF
-    ;;
-  *) # Bourne compatible functions.
-    cat << \_LT_EOF >> "$cfgfile"
+  _LT_PROG_FUNCTION_REPLACE([func_stripname], [dnl
+    # pdksh 5.2.14 does not do ${X%$Y} correctly if both X and Y are
+    # positional parameters, so assign one to ordinary parameter first.
+    func_stripname_result=${3}
+    func_stripname_result=${func_stripname_result#"${1}"}
+    func_stripname_result=${func_stripname_result%"${2}"}])
 
-# func_dirname file append nondir_replacement
-# Compute the dirname of FILE.  If nonempty, add APPEND to the result,
-# otherwise set result to NONDIR_REPLACEMENT.
-func_dirname ()
-{
-  # Extract subdirectory from the argument.
-  func_dirname_result=`$ECHO "X${1}" | $Xsed -e "$dirname"`
-  if test "X$func_dirname_result" = "X${1}"; then
-    func_dirname_result="${3}"
-  else
-    func_dirname_result="$func_dirname_result${2}"
-  fi
-}
-
-# func_basename file
-func_basename ()
-{
-  func_basename_result=`$ECHO "X${1}" | $Xsed -e "$basename"`
-}
+  _LT_PROG_FUNCTION_REPLACE([func_split_long_opt], [dnl
+    func_split_long_opt_name=${1%%=*}
+    func_split_long_opt_arg=${1#*=}])
 
-dnl func_dirname_and_basename
-dnl A portable version of this function is already defined in general.m4sh
-dnl so there is no need for it here.
+  _LT_PROG_FUNCTION_REPLACE([func_split_short_opt], [dnl
+    func_split_short_opt_arg=${1#??}
+    func_split_short_opt_name=${1%"$func_split_short_opt_arg"}])
 
-# func_stripname prefix suffix name
-# strip PREFIX and SUFFIX off of NAME.
-# PREFIX and SUFFIX must not contain globbing or regex special
-# characters, hashes, percent signs, but SUFFIX may contain a leading
-# dot (in which case that matches only a dot).
-# func_strip_suffix prefix name
-func_stripname ()
-{
-  case ${2} in
-    .*) func_stripname_result=`$ECHO "X${3}" \
-           | $Xsed -e "s%^${1}%%" -e "s%\\\\${2}\$%%"`;;
-    *)  func_stripname_result=`$ECHO "X${3}" \
-           | $Xsed -e "s%^${1}%%" -e "s%${2}\$%%"`;;
-  esac
-}
+  _LT_PROG_FUNCTION_REPLACE([func_lo2o], [dnl
+    case ${1} in
+      *.lo) func_lo2o_result=${1%.lo}.${objext} ;;
+      *)    func_lo2o_result=${1} ;;
+    esac])
 
-# sed scripts:
-my_sed_long_opt='1s/^\(-[[^=]]*\)=.*/\1/;q'
-my_sed_long_arg='1s/^-[[^=]]*=//'
+  _LT_PROG_FUNCTION_REPLACE([func_xform], [    func_xform_result=${1%.*}.lo])
 
-# func_opt_split
-func_opt_split ()
-{
-  func_opt_split_opt=`$ECHO "X${1}" | $Xsed -e "$my_sed_long_opt"`
-  func_opt_split_arg=`$ECHO "X${1}" | $Xsed -e "$my_sed_long_arg"`
-}
+  _LT_PROG_FUNCTION_REPLACE([func_arith], [    func_arith_result=$(( $[*] ))])
 
-# func_lo2o object
-func_lo2o ()
-{
-  func_lo2o_result=`$ECHO "X${1}" | $Xsed -e "$lo2o"`
-}
+  _LT_PROG_FUNCTION_REPLACE([func_len], [    func_len_result=${#1}])
+fi
 
-# func_xform libobj-or-source
-func_xform ()
-{
-  func_xform_result=`$ECHO "X${1}" | $Xsed -e 's/\.[[^.]]*$/.lo/'`
-}
+if test x"$lt_shell_append" = xyes; then
+  _LT_PROG_FUNCTION_REPLACE([func_append], [    eval "${1}+=\\${2}"])
 
-# func_arith arithmetic-term...
-func_arith ()
-{
-  func_arith_result=`expr "$[@]"`
-}
+  _LT_PROG_FUNCTION_REPLACE([func_append_quoted], [dnl
+    func_quote_for_eval "${2}"
+dnl m4 expansion turns \\\\ into \\, and then the shell eval turns that into \
+    eval "${1}+=\\\\ \\$func_quote_for_eval_result"])
 
-# func_len string
-# STRING may not start with a hyphen.
-func_len ()
-{
-  func_len_result=`expr "$[1]" : ".*" 2>/dev/null || echo $max_cmd_len`
-}
+  # Save a `func_append' function call where possible by direct use of '+='
+  sed -e 's%func_append \([[a-zA-Z_]]\{1,\}\) "%\1+="%g' $cfgfile > $cfgfile.tmp \
+    && mv -f "$cfgfile.tmp" "$cfgfile" \
+      || (rm -f "$cfgfile" && cp "$cfgfile.tmp" "$cfgfile" && rm -f "$cfgfile.tmp")
+  test 0 -eq $? || _lt_function_replace_fail=:
+else
+  # Save a `func_append' function call even when '+=' is not available
+  sed -e 's%func_append \([[a-zA-Z_]]\{1,\}\) "%\1="$\1%g' $cfgfile > $cfgfile.tmp \
+    && mv -f "$cfgfile.tmp" "$cfgfile" \
+      || (rm -f "$cfgfile" && cp "$cfgfile.tmp" "$cfgfile" && rm -f "$cfgfile.tmp")
+  test 0 -eq $? || _lt_function_replace_fail=:
+fi
 
-_LT_EOF
-esac
+if test x"$_lt_function_replace_fail" = x":"; then
+  AC_MSG_WARN([Unable to substitute extended shell functions in $ofile])
+fi
+])
 
-case $lt_shell_append in
-  yes)
-    cat << \_LT_EOF >> "$cfgfile"
-
-# func_append var value
-# Append VALUE to the end of shell variable VAR.
-func_append ()
-{
-  eval "$[1]+=\$[2]"
-}
-_LT_EOF
+# _LT_PATH_CONVERSION_FUNCTIONS
+# -----------------------------
+# Determine which file name conversion functions should be used by
+# func_to_host_file (and, implicitly, by func_to_host_path).  These are needed
+# for certain cross-compile configurations and native mingw.
+m4_defun([_LT_PATH_CONVERSION_FUNCTIONS],
+[AC_REQUIRE([AC_CANONICAL_HOST])dnl
+AC_REQUIRE([AC_CANONICAL_BUILD])dnl
+AC_MSG_CHECKING([how to convert $build file names to $host format])
+AC_CACHE_VAL(lt_cv_to_host_file_cmd,
+[case $host in
+  *-*-mingw* )
+    case $build in
+      *-*-mingw* ) # actually msys
+        lt_cv_to_host_file_cmd=func_convert_file_msys_to_w32
+        ;;
+      *-*-cygwin* )
+        lt_cv_to_host_file_cmd=func_convert_file_cygwin_to_w32
+        ;;
+      * ) # otherwise, assume *nix
+        lt_cv_to_host_file_cmd=func_convert_file_nix_to_w32
+        ;;
+    esac
     ;;
-  *)
-    cat << \_LT_EOF >> "$cfgfile"
-
-# func_append var value
-# Append VALUE to the end of shell variable VAR.
-func_append ()
-{
-  eval "$[1]=\$$[1]\$[2]"
-}
-
-_LT_EOF
+  *-*-cygwin* )
+    case $build in
+      *-*-mingw* ) # actually msys
+        lt_cv_to_host_file_cmd=func_convert_file_msys_to_cygwin
+        ;;
+      *-*-cygwin* )
+        lt_cv_to_host_file_cmd=func_convert_file_noop
+        ;;
+      * ) # otherwise, assume *nix
+        lt_cv_to_host_file_cmd=func_convert_file_nix_to_cygwin
+        ;;
+    esac
     ;;
-  esac
+  * ) # unhandled hosts (and "normal" native builds)
+    lt_cv_to_host_file_cmd=func_convert_file_noop
+    ;;
+esac
+])
+to_host_file_cmd=$lt_cv_to_host_file_cmd
+AC_MSG_RESULT([$lt_cv_to_host_file_cmd])
+_LT_DECL([to_host_file_cmd], [lt_cv_to_host_file_cmd],
+         [0], [convert $build file names to $host format])dnl
+
+AC_MSG_CHECKING([how to convert $build file names to toolchain format])
+AC_CACHE_VAL(lt_cv_to_tool_file_cmd,
+[#assume ordinary cross tools, or native build.
+lt_cv_to_tool_file_cmd=func_convert_file_noop
+case $host in
+  *-*-mingw* )
+    case $build in
+      *-*-mingw* ) # actually msys
+        lt_cv_to_tool_file_cmd=func_convert_file_msys_to_w32
+        ;;
+    esac
+    ;;
+esac
 ])
+to_tool_file_cmd=$lt_cv_to_tool_file_cmd
+AC_MSG_RESULT([$lt_cv_to_tool_file_cmd])
+_LT_DECL([to_tool_file_cmd], [lt_cv_to_tool_file_cmd],
+         [0], [convert $build files to toolchain format])dnl
+])# _LT_PATH_CONVERSION_FUNCTIONS
diff -urpN xfsprogs-4.9.0/m4/ltoptions.m4 xfsprogs-4.14.0/m4/ltoptions.m4
--- xfsprogs-4.9.0/m4/ltoptions.m4	2017-01-05 23:33:45.000000000 +0100
+++ xfsprogs-4.14.0/m4/ltoptions.m4	2017-11-27 17:58:09.000000000 +0100
@@ -1,13 +1,14 @@
 # Helper functions for option handling.                    -*- Autoconf -*-
 #
-#   Copyright (C) 2004, 2005, 2007, 2008 Free Software Foundation, Inc.
+#   Copyright (C) 2004, 2005, 2007, 2008, 2009 Free Software Foundation,
+#   Inc.
 #   Written by Gary V. Vaughan, 2004
 #
 # This file is free software; the Free Software Foundation gives
 # unlimited permission to copy and/or distribute it, with or without
 # modifications, as long as this notice is preserved.
 
-# serial 6 ltoptions.m4
+# serial 7 ltoptions.m4
 
 # This is to help aclocal find these macros, as it can't see m4_define.
 AC_DEFUN([LTOPTIONS_VERSION], [m4_if([1])])
@@ -125,7 +126,7 @@ LT_OPTION_DEFINE([LT_INIT], [win32-dll],
 [enable_win32_dll=yes
 
 case $host in
-*-*-cygwin* | *-*-mingw* | *-*-pw32* | *-cegcc*)
+*-*-cygwin* | *-*-mingw* | *-*-pw32* | *-*-cegcc*)
   AC_CHECK_TOOL(AS, as, false)
   AC_CHECK_TOOL(DLLTOOL, dlltool, false)
   AC_CHECK_TOOL(OBJDUMP, objdump, false)
@@ -133,13 +134,13 @@ case $host in
 esac
 
 test -z "$AS" && AS=as
-_LT_DECL([], [AS],      [0], [Assembler program])dnl
+_LT_DECL([], [AS],      [1], [Assembler program])dnl
 
 test -z "$DLLTOOL" && DLLTOOL=dlltool
-_LT_DECL([], [DLLTOOL], [0], [DLL creation program])dnl
+_LT_DECL([], [DLLTOOL], [1], [DLL creation program])dnl
 
 test -z "$OBJDUMP" && OBJDUMP=objdump
-_LT_DECL([], [OBJDUMP], [0], [Object dumper program])dnl
+_LT_DECL([], [OBJDUMP], [1], [Object dumper program])dnl
 ])# win32-dll
 
 AU_DEFUN([AC_LIBTOOL_WIN32_DLL],
@@ -325,9 +326,24 @@ dnl AC_DEFUN([AM_DISABLE_FAST_INSTALL],
 # MODE is either `yes' or `no'.  If omitted, it defaults to `both'.
 m4_define([_LT_WITH_PIC],
 [AC_ARG_WITH([pic],
-    [AS_HELP_STRING([--with-pic],
+    [AS_HELP_STRING([--with-pic@<:@=PKGS@:>@],
 	[try to use only PIC/non-PIC objects @<:@default=use both@:>@])],
-    [pic_mode="$withval"],
+    [lt_p=${PACKAGE-default}
+    case $withval in
+    yes|no) pic_mode=$withval ;;
+    *)
+      pic_mode=default
+      # Look at the argument we got.  We use all the common list separators.
+      lt_save_ifs="$IFS"; IFS="${IFS}$PATH_SEPARATOR,"
+      for lt_pkg in $withval; do
+	IFS="$lt_save_ifs"
+	if test "X$lt_pkg" = "X$lt_p"; then
+	  pic_mode=yes
+	fi
+      done
+      IFS="$lt_save_ifs"
+      ;;
+    esac],
     [pic_mode=default])
 
 test -z "$pic_mode" && pic_mode=m4_default([$1], [default])
diff -urpN xfsprogs-4.9.0/m4/ltversion.m4 xfsprogs-4.14.0/m4/ltversion.m4
--- xfsprogs-4.9.0/m4/ltversion.m4	2017-01-05 23:33:45.000000000 +0100
+++ xfsprogs-4.14.0/m4/ltversion.m4	2017-11-27 17:58:09.000000000 +0100
@@ -7,17 +7,17 @@
 # unlimited permission to copy and/or distribute it, with or without
 # modifications, as long as this notice is preserved.
 
-# Generated from ltversion.in.
+# @configure_input@
 
-# serial 3017 ltversion.m4
+# serial 3337 ltversion.m4
 # This file is part of GNU Libtool
 
-m4_define([LT_PACKAGE_VERSION], [2.2.6b])
-m4_define([LT_PACKAGE_REVISION], [1.3017])
+m4_define([LT_PACKAGE_VERSION], [2.4.2])
+m4_define([LT_PACKAGE_REVISION], [1.3337])
 
 AC_DEFUN([LTVERSION_VERSION],
-[macro_version='2.2.6b'
-macro_revision='1.3017'
+[macro_version='2.4.2'
+macro_revision='1.3337'
 _LT_DECL(, macro_version, 0, [Which release of libtool.m4 was used?])
 _LT_DECL(, macro_revision, 0)
 ])
diff -urpN xfsprogs-4.9.0/m4/lt~obsolete.m4 xfsprogs-4.14.0/m4/lt~obsolete.m4
--- xfsprogs-4.9.0/m4/lt~obsolete.m4	2017-01-05 23:33:45.000000000 +0100
+++ xfsprogs-4.14.0/m4/lt~obsolete.m4	2017-11-27 17:58:10.000000000 +0100
@@ -1,13 +1,13 @@
 # lt~obsolete.m4 -- aclocal satisfying obsolete definitions.    -*-Autoconf-*-
 #
-#   Copyright (C) 2004, 2005, 2007 Free Software Foundation, Inc.
+#   Copyright (C) 2004, 2005, 2007, 2009 Free Software Foundation, Inc.
 #   Written by Scott James Remnant, 2004.
 #
 # This file is free software; the Free Software Foundation gives
 # unlimited permission to copy and/or distribute it, with or without
 # modifications, as long as this notice is preserved.
 
-# serial 4 lt~obsolete.m4
+# serial 5 lt~obsolete.m4
 
 # These exist entirely to fool aclocal when bootstrapping libtool.
 #
@@ -77,7 +77,6 @@ m4_ifndef([AC_DISABLE_FAST_INSTALL],	[AC
 m4_ifndef([_LT_AC_LANG_CXX],		[AC_DEFUN([_LT_AC_LANG_CXX])])
 m4_ifndef([_LT_AC_LANG_F77],		[AC_DEFUN([_LT_AC_LANG_F77])])
 m4_ifndef([_LT_AC_LANG_GCJ],		[AC_DEFUN([_LT_AC_LANG_GCJ])])
-m4_ifndef([AC_LIBTOOL_RC],		[AC_DEFUN([AC_LIBTOOL_RC])])
 m4_ifndef([AC_LIBTOOL_LANG_C_CONFIG],	[AC_DEFUN([AC_LIBTOOL_LANG_C_CONFIG])])
 m4_ifndef([_LT_AC_LANG_C_CONFIG],	[AC_DEFUN([_LT_AC_LANG_C_CONFIG])])
 m4_ifndef([AC_LIBTOOL_LANG_CXX_CONFIG],	[AC_DEFUN([AC_LIBTOOL_LANG_CXX_CONFIG])])
@@ -90,3 +89,10 @@ m4_ifndef([AC_LIBTOOL_LANG_RC_CONFIG],	[
 m4_ifndef([_LT_AC_LANG_RC_CONFIG],	[AC_DEFUN([_LT_AC_LANG_RC_CONFIG])])
 m4_ifndef([AC_LIBTOOL_CONFIG],		[AC_DEFUN([AC_LIBTOOL_CONFIG])])
 m4_ifndef([_LT_AC_FILE_LTDLL_C],	[AC_DEFUN([_LT_AC_FILE_LTDLL_C])])
+m4_ifndef([_LT_REQUIRED_DARWIN_CHECKS],	[AC_DEFUN([_LT_REQUIRED_DARWIN_CHECKS])])
+m4_ifndef([_LT_AC_PROG_CXXCPP],		[AC_DEFUN([_LT_AC_PROG_CXXCPP])])
+m4_ifndef([_LT_PREPARE_SED_QUOTE_VARS],	[AC_DEFUN([_LT_PREPARE_SED_QUOTE_VARS])])
+m4_ifndef([_LT_PROG_ECHO_BACKSLASH],	[AC_DEFUN([_LT_PROG_ECHO_BACKSLASH])])
+m4_ifndef([_LT_PROG_F77],		[AC_DEFUN([_LT_PROG_F77])])
+m4_ifndef([_LT_PROG_FC],		[AC_DEFUN([_LT_PROG_FC])])
+m4_ifndef([_LT_PROG_CXX],		[AC_DEFUN([_LT_PROG_CXX])])
diff -urpN xfsprogs-4.9.0/m4/package_libcdev.m4 xfsprogs-4.14.0/m4/package_libcdev.m4
--- xfsprogs-4.9.0/m4/package_libcdev.m4	2017-01-05 18:42:06.000000000 +0100
+++ xfsprogs-4.14.0/m4/package_libcdev.m4	2017-11-27 17:57:55.000000000 +0100
@@ -137,6 +137,7 @@ AC_DEFUN([AC_HAVE_PREADV],
   [ AC_MSG_CHECKING([for preadv])
     AC_TRY_LINK([
 #define _BSD_SOURCE
+#define _DEFAULT_SOURCE
 #include <sys/uio.h>
     ], [
          preadv(0, 0, 0, 0);
@@ -147,6 +148,22 @@ AC_DEFUN([AC_HAVE_PREADV],
   ])
 
 #
+# Check if we have a pwritev2 libc call (Linux)
+#
+AC_DEFUN([AC_HAVE_PWRITEV2],
+  [ AC_MSG_CHECKING([for pwritev2])
+    AC_TRY_LINK([
+#define _BSD_SOURCE
+#include <sys/uio.h>
+    ], [
+         pwritev2(0, 0, 0, 0, 0);
+    ], have_pwritev2=yes
+       AC_MSG_RESULT(yes),
+       AC_MSG_RESULT(no))
+    AC_SUBST(have_pwritev2)
+  ])
+
+#
 # Check if we have a copy_file_range system call (Linux)
 #
 AC_DEFUN([AC_HAVE_COPY_FILE_RANGE],
@@ -189,7 +206,7 @@ AC_DEFUN([AC_HAVE_SYNCFS],
 #include <unistd.h>
     ], [
          syncfs(0);
-    ], have_sync_fs=yes
+    ], have_syncfs=yes
        AC_MSG_RESULT(yes),
        AC_MSG_RESULT(no))
     AC_SUBST(have_syncfs)
@@ -277,3 +294,37 @@ AC_DEFUN([AC_NEED_INTERNAL_FSXATTR],
     )
     AC_SUBST(need_internal_fsxattr)
   ])
+
+#
+# Check if we have a FS_IOC_GETFSMAP ioctl (Linux)
+#
+AC_DEFUN([AC_HAVE_GETFSMAP],
+  [ AC_MSG_CHECKING([for GETFSMAP])
+    AC_TRY_LINK([
+#define _GNU_SOURCE
+#include <sys/syscall.h>
+#include <unistd.h>
+#include <linux/fs.h>
+#include <linux/fsmap.h>
+    ], [
+         unsigned long x = FS_IOC_GETFSMAP;
+         struct fsmap_head fh;
+    ], have_getfsmap=yes
+       AC_MSG_RESULT(yes),
+       AC_MSG_RESULT(no))
+    AC_SUBST(have_getfsmap)
+  ])
+
+AC_DEFUN([AC_HAVE_STATFS_FLAGS],
+  [
+    AC_CHECK_TYPE(struct statfs,
+      [
+        AC_CHECK_MEMBER(struct statfs.f_flags,
+          have_statfs_flags=yes,,
+          [#include <sys/vfs.h>]
+        )
+      ],,
+      [#include <sys/vfs.h>]
+    )
+    AC_SUBST(have_statfs_flags)
+  ])
diff -urpN xfsprogs-4.9.0/m4/package_sanitizer.m4 xfsprogs-4.14.0/m4/package_sanitizer.m4
--- xfsprogs-4.9.0/m4/package_sanitizer.m4	1970-01-01 01:00:00.000000000 +0100
+++ xfsprogs-4.14.0/m4/package_sanitizer.m4	2017-11-27 17:57:55.000000000 +0100
@@ -0,0 +1,59 @@
+AC_DEFUN([AC_PACKAGE_CHECK_UBSAN],
+  [ AC_MSG_CHECKING([if C compiler supports UBSAN])
+    OLD_CFLAGS="$CFLAGS"
+    OLD_LDFLAGS="$LDFLAGS"
+    UBSAN_FLAGS="-fsanitize=undefined"
+    CFLAGS="$CFLAGS $UBSAN_FLAGS"
+    LDFLAGS="$LDFLAGS $UBSAN_FLAGS"
+    AC_LINK_IFELSE([AC_LANG_PROGRAM([])],
+        [AC_MSG_RESULT([yes])]
+        [ubsan_cflags=$UBSAN_FLAGS]
+        [ubsan_ldflags=$UBSAN_FLAGS]
+        [have_ubsan=yes],
+        [AC_MSG_RESULT([no])])
+    CFLAGS="${OLD_CFLAGS}"
+    LDFLAGS="${OLD_LDFLAGS}"
+    AC_SUBST(have_ubsan)
+    AC_SUBST(ubsan_cflags)
+    AC_SUBST(ubsan_ldflags)
+  ])
+
+AC_DEFUN([AC_PACKAGE_CHECK_ADDRSAN],
+  [ AC_MSG_CHECKING([if C compiler supports ADDRSAN])
+    OLD_CFLAGS="$CFLAGS"
+    OLD_LDFLAGS="$LDFLAGS"
+    ADDRSAN_FLAGS="-fsanitize=address"
+    CFLAGS="$CFLAGS $ADDRSAN_FLAGS"
+    LDFLAGS="$LDFLAGS $ADDRSAN_FLAGS"
+    AC_LINK_IFELSE([AC_LANG_PROGRAM([])],
+        [AC_MSG_RESULT([yes])]
+        [addrsan_cflags=$ADDRSAN_FLAGS]
+        [addrsan_ldflags=$ADDRSAN_FLAGS]
+        [have_addrsan=yes],
+        [AC_MSG_RESULT([no])])
+    CFLAGS="${OLD_CFLAGS}"
+    LDFLAGS="${OLD_LDFLAGS}"
+    AC_SUBST(have_addrsan)
+    AC_SUBST(addrsan_cflags)
+    AC_SUBST(addrsan_ldflags)
+  ])
+
+AC_DEFUN([AC_PACKAGE_CHECK_THREADSAN],
+  [ AC_MSG_CHECKING([if C compiler supports THREADSAN])
+    OLD_CFLAGS="$CFLAGS"
+    OLD_LDFLAGS="$LDFLAGS"
+    THREADSAN_FLAGS="-fsanitize=thread"
+    CFLAGS="$CFLAGS $THREADSAN_FLAGS"
+    LDFLAGS="$LDFLAGS $ADRSAN_FLAGS"
+    AC_LINK_IFELSE([AC_LANG_PROGRAM([])],
+        [AC_MSG_RESULT([yes])]
+        [threadsan_cflags=$THREADSAN_FLAGS]
+        [threadsan_ldflags=$THREADSAN_FLAGS]
+        [have_threadsan=yes],
+        [AC_MSG_RESULT([no])])
+    CFLAGS="${OLD_CFLAGS}"
+    LDFLAGS="${OLD_LDFLAGS}"
+    AC_SUBST(have_threadsan)
+    AC_SUBST(threadsan_cflags)
+    AC_SUBST(threadsan_ldflags)
+  ])
diff -urpN xfsprogs-4.9.0/m4/package_types.m4 xfsprogs-4.14.0/m4/package_types.m4
--- xfsprogs-4.9.0/m4/package_types.m4	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/m4/package_types.m4	2017-11-20 01:14:14.000000000 +0100
@@ -1,6 +1,7 @@
 #
 # Check if we have umode_t
 #
+AH_TEMPLATE([HAVE_UMODE_T], [Whether you have umode_t])
 AC_DEFUN([AC_TYPE_UMODE_T],
   [ AC_MSG_CHECKING([for umode_t])
     AC_TRY_COMPILE([
diff -urpN xfsprogs-4.9.0/man/man5/xfs.5 xfsprogs-4.14.0/man/man5/xfs.5
--- xfsprogs-4.9.0/man/man5/xfs.5	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/man/man5/xfs.5	2017-11-20 01:14:14.000000000 +0100
@@ -133,6 +133,12 @@ CRC enabled filesystems always use the a
 will reject the noattr2 mount option if it is set.
 .TP
 .BR barrier | nobarrier
+Note: This option has been
+.B deprecated
+as of kernel v4.10; in that version, integrity operations are
+always performed and the mount option is ignored.  These mount
+options will be removed no earlier than kernel v4.15.
+.sp
 Enables/disables the use of block layer write barriers for
 writes into the journal and for data integrity operations.
 This allows for drive level write caching to be enabled, for
diff -urpN xfsprogs-4.9.0/man/man8/mkfs.xfs.8 xfsprogs-4.14.0/man/man8/mkfs.xfs.8
--- xfsprogs-4.9.0/man/man8/mkfs.xfs.8	2016-12-13 21:07:08.000000000 +0100
+++ xfsprogs-4.14.0/man/man8/mkfs.xfs.8	2017-11-20 01:14:14.000000000 +0100
@@ -279,6 +279,13 @@ and
 .B agsize
 suboptions are mutually exclusive.
 .TP
+.BI cowextsize= value
+Set the copy-on-write extent size hint on all inodes created by
+.BR mkfs.xfs "."
+The value must be provided in units of filesystem blocks.
+If the value is zero, the default value (currently 32 blocks) will be used.
+Directories will pass on this hint to newly created children.
+.TP
 .BI name= value
 This can be used to specify the name of the special file containing
 the filesystem. In this case, the log section must be specified as
@@ -367,6 +374,25 @@ values.
 This option disables automatic geometry detection and creates the filesystem
 without stripe geometry alignment even if the underlying storage device provides
 this information.
+.TP
+.BI rtinherit= value
+If set, all inodes created by
+.B mkfs.xfs
+will be created with the realtime flag set.
+Directories will pass on this flag to newly created children.
+.TP
+.BI projinherit= value
+All inodes created by
+.B mkfs.xfs
+will be assigned this project quota id.
+Directories will pass on the project id to newly created children.
+.TP
+.BI extszinherit= value
+All inodes created by
+.B mkfs.xfs
+will have this extent size hint applied.
+The value must be provided in units of filesystem blocks.
+Directories will pass on this hint to newly created children.
 .RE
 .TP
 .B \-f
@@ -508,6 +534,9 @@ log section of the filesystem. The valid
 are:
 .RS 1.2i
 .TP
+.BI agnum= value
+If the log is internal, allocate it in this AG.
+.TP
 .BI internal[= value ]
 This is used to specify that the log section is a piece of the data
 section instead of being another device or logical volume. The
diff -urpN xfsprogs-4.9.0/man/man8/xfs_bmap.8 xfsprogs-4.14.0/man/man8/xfs_bmap.8
--- xfsprogs-4.9.0/man/man8/xfs_bmap.8	2016-12-13 21:07:08.000000000 +0100
+++ xfsprogs-4.14.0/man/man8/xfs_bmap.8	2017-11-20 01:14:14.000000000 +0100
@@ -77,12 +77,11 @@ option is used.
 .BI \-n " num_extents"
 If this option is given,
 .B xfs_bmap
-obtains the extent list of the file in groups of
+will display at most
 .I num_extents
 extents. In the absence of
 .BR \-n ", " xfs_bmap
-queries the system for the number of extents in the file and uses that
-value to compute the group size.
+will display all extents in the file.
 .TP
 .B \-p
 If this option is used,
diff -urpN xfsprogs-4.9.0/man/man8/xfs_db.8 xfsprogs-4.14.0/man/man8/xfs_db.8
--- xfsprogs-4.9.0/man/man8/xfs_db.8	2016-12-13 21:07:08.000000000 +0100
+++ xfsprogs-4.14.0/man/man8/xfs_db.8	2017-11-20 01:14:14.000000000 +0100
@@ -332,6 +332,20 @@ and
 options are used to select the attribute or data
 area of the inode, if neither option is given then both areas are shown.
 .TP
+.B btdump [-a] [-i]
+If the cursor points to a btree node, dump the btree from that block downward.
+If instead the cursor points to an inode, dump the data fork block mapping btree if there is one.
+If the cursor points to a directory or extended attribute btree node, dump that.
+By default, only records stored in the btree are dumped.
+.RS 1.0i
+.TP 0.4i
+.B \-a
+If the cursor points at an inode, dump the extended attribute block mapping btree, if present.
+.TP
+.B \-i
+Dump all keys and pointers in intermediate btree nodes, and all records in leaf btree nodes.
+.RE
+.TP
 .B check
 See the
 .B blockget
@@ -512,12 +526,17 @@ enables processing of realtime control f
 enables processing of realtime file data.
 .RE
 .TP
-.BI "freesp [\-bcds] [\-a " ag "] ... [\-e " i "] [\-h " h1 "] ... [\-m " m ]
+.BI "freesp [\-bcds] [\-A " alignment "] [\-a " ag "] ... [\-e " i "] [\-h " h1 "] ... [\-m " m ]
 Summarize free space for the filesystem. The free blocks are examined
 and totalled, and displayed in the form of a histogram, with a count
 of extents in each range of free extent sizes.
 .RS 1.0i
 .TP 0.4i
+.B \-A
+reports only free extents with starting blocks aligned to
+.I alignment
+blocks.
+.TP
 .B \-a
 adds
 .I ag
@@ -594,6 +613,55 @@ in units of 512-byte blocks, no matter w
 .BI "The optional " start " and " end " arguments can be used to constrain
 the output to a particular range of disk blocks.
 .TP
+.BI "fuzz [\-c] [\-d] " "field action"
+Write garbage into a specific structure field on disk.
+Expert mode must be enabled to use this command.
+The operation happens immediately; there is no buffering.
+.IP
+The fuzz command can take the following
+.IR action "s"
+against a field:
+.RS 1.0i
+.TP 0.4i
+.B zeroes
+Clears all bits in the field.
+.TP 0.4i
+.B ones
+Sets all bits in the field.
+.TP 0.4i
+.B firstbit
+Flips the first bit in the field.
+For a scalar value, this is the highest bit.
+.TP 0.4i
+.B middlebit
+Flips the middle bit in the field.
+.TP 0.4i
+.B lastbit
+Flips the last bit in the field.
+For a scalar value, this is the lowest bit.
+.TP 0.4i
+.B add
+Adds a small value to a scalar field.
+.TP 0.4i
+.B sub
+Subtracts a small value from a scalar field.
+.TP 0.4i
+.B random
+Randomizes the contents of the field.
+.RE
+.IP
+The following switches affect the write behavior:
+.RS 1.0i
+.TP 0.4i
+.B \-c
+Skip write verifiers and CRC recalculation; allows invalid data to be written
+to disk.
+.TP 0.4i
+.B \-d
+Skip write verifiers but perform CRC recalculation; allows invalid data to be
+written to disk to test detection of invalid data.
+.RE
+.TP
 .BI hash " string
 Prints the hash value of
 .I string
@@ -755,7 +823,7 @@ and
 bits respectively, and their string equivalent reported
 (but no modifications are made).
 .TP
-.BI "write [\-c] [" "field value" "] ..."
+.BI "write [\-c] [\-d] [" "field value" "] ..."
 Write a value to disk.
 Specific fields can be set in structures (struct mode),
 or a block can be set to data values (data mode),
@@ -778,6 +846,11 @@ with no arguments gives more information
 .B \-c
 Skip write verifiers and CRC recalculation; allows invalid data to be written
 to disk.
+.TP 0.4i
+.B \-d
+Skip write verifiers but perform CRC recalculation.
+This allows invalid data to be written to disk to
+test detection of invalid data.  (This is not possible for some types.)
 .RE
 .SH TYPES
 This section gives the fields in each structure type and their meanings.
@@ -916,8 +989,7 @@ version 1 and version 2 directories, see
 .B dir
 for a description. Leaf blocks can refer to "local" or "remote" attribute
 values. Local values are stored directly in the leaf block.
-Remote values are stored in an independent block in the attribute fork
-(with no structure). Leaf blocks contain the following fields:
+Leaf blocks contain the following fields:
 .RS 1.4i
 .PD 0
 .TP 1.2i
@@ -965,6 +1037,41 @@ Fields present for local values:
 (fork block number of containing the value).
 .PD
 .RE
+.IP
+Remote values are stored in an independent block in the attribute fork.
+Prior to v5, value blocks had no structure, but in v5 they acquired a header
+structure with the following fields:
+.RS 1.4i
+.PD 0
+.TP 1.2i
+.B magic
+attr3 remote block magic number, 0x5841524d ('XARM').
+.TP
+.B offset
+Byte offset of this data block within the overall attribute value.
+.TP
+.B bytes
+Number of bytes stored in this block.
+.TP
+.B crc
+Checksum of the attribute block contents.
+.TP
+.B uuid
+Filesystem UUID.
+.TP
+.B owner
+Inode that owns this attribute value.
+.TP
+.B bno
+Block offset of this block within the inode's attribute fork.
+.TP
+.B lsn
+Log serial number of the last time this block was logged.
+.TP
+.B data
+The attribute value data.
+.PD
+.RE
 .TP
 .B bmapbt
 Files with many extents in their data or attribute fork will have the
diff -urpN xfsprogs-4.9.0/man/man8/xfs_io.8 xfsprogs-4.14.0/man/man8/xfs_io.8
--- xfsprogs-4.9.0/man/man8/xfs_io.8	2017-01-05 18:41:55.000000000 +0100
+++ xfsprogs-4.14.0/man/man8/xfs_io.8	2017-11-27 17:57:55.000000000 +0100
@@ -9,10 +9,13 @@ xfs_io \- debug the I/O path of an XFS f
 .B \-c
 .I cmd
 ] ... [
+.B \-C
+.I cmd
+] ... [
 .B \-p
 .I prog
 ]
-.I file
+.I [ file ]
 .br
 .B xfs_io \-V
 .SH DESCRIPTION
@@ -25,14 +28,39 @@ These code paths include not only the ob
 for manipulating files, but also cover all of the XFS extensions (such
 as space preallocation, additional inode flags, etc).
 .SH OPTIONS
+.B xfs_io
+commands may be run interactively (the default) or as arguments on the
+command line.
+Interactive mode always runs commands on the current open file, whilst commands
+run from the command line may be repeated on all open files rather than just the current
+open file.
+In general, open file iteration will occur for commands that operate on file
+content or state. In contrast, commands that operate on filesystem or
+system-wide state will only be run on the current file regardless of how many
+files are currently open.
+Multiple arguments may be given on the command line and they are run in the
+sequence given. The program exits one all commands have
+been run.
 .TP 1.0i
 .BI \-c " cmd"
-.B xfs_io
-commands may be run interactively (the default) or as arguments on
-the command line. Multiple
+Run the specified command on all currently open files.
+To maintain compatibility with historical usage, commands that can not be run on
+all open files will still be run but only execute once on the current open file.
+Multiple
 .B \-c
-arguments may be given. The commands are run in the sequence given,
-then the program exits.
+arguments may be given and may be interleaved on the command line in any order
+with
+.B \-C
+commands.
+.TP
+.BI \-C " cmd"
+Run the specified command only on the current open file. 
+Multiple
+.B \-C
+arguments may be given and may be interleaved on the command line in any order
+with
+.B \-c
+commands.
 .TP
 .BI \-p " prog"
 Set the program name for prompts and some error messages,
@@ -194,7 +222,7 @@ See the
 .B pread
 command.
 .TP
-.BI "pwrite [ \-i " file " ] [ \-d ] [ \-s " skip " ] [ \-b " size " ] [ \-S " seed " ] [ \-FBR [ \-Z " zeed " ] ] [ \-wW ] [ \-V " vectors " ] " "offset length"
+.BI "pwrite [ \-i " file " ] [ \-dwNOW ] [ \-s " skip " ] [ \-b " size " ] [ \-S " seed " ] [ \-FBR [ \-Z " zeed " ] ] [ \-V " vectors " ] " "offset length"
 Writes a range of bytes in a specified blocksize from the given
 .IR offset .
 The bytes written can be either a set pattern or read in from another
@@ -211,6 +239,25 @@ to be specified as the source of the dat
 causes direct I/O, rather than the usual buffered
 I/O, to be used when reading the input file.
 .TP
+.B \-w
+call
+.BR fdatasync (2)
+once all writes are complete (included in timing results)
+.TP
+.B \-N
+Perform the
+.BR pwritev2 (2)
+call with
+.I RWF_NOWAIT.
+.TP
+.B \-O
+perform pwrite once and return the (maybe partial) bytes written.
+.TP
+.B \-W
+call
+.BR fsync (2)
+once all writes are complete (included in timing results)
+.TP
 .B \-s
 specifies the number of bytes to
 .I skip
@@ -238,16 +285,6 @@ write the buffers in the give range in a
 .B \-Z seed
 specify the random number seed used for random write
 .TP
-.B \-w
-call
-.BR fdatasync (2)
-once all writes are complete (included in timing results)
-.TP
-.B \-W
-call
-.BR fsync (2)
-once all writes are complete (included in timing results)
-.TP
 .B \-V vectors
 Use the vectored IO write syscall
 .BR pwritev (2)
@@ -273,6 +310,108 @@ ioctl.  Options behave as described in t
 .BR xfs_bmap (8)
 manual page.
 .TP
+.BI "fsmap [ \-d | \-l | \-r ] [ \-m | \-v ] [ \-n " nx " ] [ " start " ] [ " end " ]
+Prints the mapping of disk blocks used by the filesystem hosting the current
+file.  The map lists each extent used by files, allocation group metadata,
+journalling logs, and static filesystem metadata, as well as any
+regions that are unused.
+Each line of the listings takes the following form:
+.PP
+.RS
+.IR extent ": " major ":" minor " [" startblock .. endblock "]: " owner " " startoffset .. endoffset " " length
+.PP
+Static filesystem metadata, allocation group metadata, btrees,
+journalling logs, and free space are marked by replacing the
+.IR startoffset .. endoffset
+with the appropriate marker.
+All blocks, offsets, and lengths are specified in units of 512-byte
+blocks, no matter what the filesystem's block size is.
+The optional
+.I start
+and
+.I end
+arguments can be used to constrain the output to a particular range of
+disk blocks.
+If these two options are specified, exactly one of
+.BR "-d" ", " "-l" ", or " "-r"
+must also be set.
+.RE
+.RS 1.0i
+.PD 0
+.TP
+.BI \-d
+Display only extents from the data device.
+This option only applies for XFS filesystems.
+.TP
+.BI \-l
+Display only extents from the external log device.
+This option only applies to XFS filesystems.
+.TP
+.BI \-r
+Display only extents from the realtime device.
+This option only applies to XFS filesystems.
+.TP
+.BI \-m
+Display results in a machine readable format (CSV).
+This option is not compatible with the
+.B \-v
+flag.
+The columns of the output are: extent number, device major, device minor,
+physical start, physical end, owner, offset start, offset end, length.
+The start, end, and length numbers are provided in units of 512b.
+The owner field is a special string that takes the form:
+
+.RS 1.0i
+.PD 0
+.TP 0.4i
+.I inode_%lld_data
+for inode data.
+.TP
+.I inode_%lld_data_bmbt
+for inode data extent maps.
+.TP
+.I inode_%lld_attr
+for inode extended attribute data.
+.TP
+.I inode_%lld_attr_bmbt
+for inode extended attribute extent maps.
+.TP
+.I special_%u:%u
+for other filesystem metadata.
+.PD
+.RE
+
+.TP
+.BI \-n " num_extents"
+If this option is given,
+.B fsmap
+obtains the extent list of the file in groups of
+.I num_extents
+extents.
+In the absence of
+.BR "-n" ", " "fsmap"
+queries the system for extents in groups of 131,072 records.
+.TP
+.B \-v
+Shows verbose information.
+When this flag is specified, additional AG specific information is
+appended to each line in the following form:
+.IP
+.RS 1.2i
+.IR agno " (" startagblock .. endagblock ") " nblocks " " flags
+.RE
+.IP
+A second
+.B \-v
+option will print out the
+.I flags
+legend.
+This option is not compatible with the
+.B \-m
+flag.
+.RE
+.PD
+.TP
 .BI "extsize [ \-R | \-D ] [ " value " ]"
 Display and/or modify the preferred extent size used when allocating
 space for the currently open file. If the
@@ -486,7 +625,6 @@ to read (in bytes)
 .RE
 .PD
 .TP
-.TP
 .BI "seek  \-a | \-d | \-h [ \-r ] [ \-s ] offset"
 On platforms that support the
 .BR lseek (2)
@@ -527,10 +665,9 @@ both data and holes are displayed togeth
 .RE
 .PD
 .TP
-.TP
 .BI "reflink  [ \-C ] [ \-q ] src_file [src_offset dst_offset length]"
 On filesystems that support the
-.B XFS_IOC_CLONE_RANGE
+.B FICLONERANGE
 or
 .B BTRFS_IOC_CLONE_RANGE
 ioctls, map
@@ -557,10 +694,9 @@ Do not print timing statistics at all.
 .RE
 .PD
 .TP
-.TP
 .BI "dedupe  [ \-C ] [ \-q ] src_file src_offset dst_offset length"
 On filesystems that support the
-.B XFS_IOC_FILE_EXTENT_SAME
+.B FIDEDUPERANGE
 or
 .B BTRFS_IOC_FILE_EXTENT_SAME
 ioctls, map
@@ -586,7 +722,6 @@ Do not print timing statistics at all.
 .RE
 .PD
 .TP
-.TP
 .BI "copy_range [ -s " src_offset " ] [ -d " dst_offset " ] [ -l " length " ] src_file"
 On filesystems that support the
 .BR copy_file_range (2)
@@ -616,6 +751,16 @@ Copy data into the open file beginning a
 Copy up to
 .I length
 bytes of data.
+.RE
+.PD
+.TP
+.BI utimes " atime_sec atime_nsec mtime_sec mtime_nsec"
+The utimes command changes the atime and mtime of the current file.
+sec uses UNIX timestamp notation and is the seconds elapsed since
+1970-01-01 00:00:00 UTC.
+nsec is the nanoseconds since the sec. This value needs to be in
+the range 0-999999999 with UTIME_NOW and UTIME_OMIT being exceptions.
+Each (sec, nsec) pair constitutes a single timestamp value.
 
 .SH MEMORY MAPPED I/O COMMANDS
 .TP
@@ -798,7 +943,7 @@ can be used to restrict the output to di
 This is a depth first descent, it does not follow symlinks and
 it also does not cross mount points.
 .TP
-.BR chattr " [ " \-R " | " \-D " ] [ " + / \-riasAdtPneEfS " ]"
+.BR chattr " [ " \-R " | " \-D " ] [ " + / \-riasAdtPneEfSxC " ]"
 Change extended inode flags on the currently open file. The
 .B \-R
 and
@@ -838,13 +983,45 @@ Only available in expert mode and requir
 Force the filesystem to shutdown (with or without flushing the log).
 Only available in expert mode and requires privileges.
 .TP
-.BR stat " [ " \-v " ]"
+.BR stat " [ " \-v "|" \-r " ]"
 Selected statistics from
 .BR stat (2)
 and the XFS_IOC_GETXATTR system call on the current file. If the
 .B \-v
 option is specified, the atime (last access), mtime
-(last modify), and ctime (last change) timestamps are also displayed.
+(last modify), and ctime (last change) timestamps are also displayed.  The
+.B \-r
+option dumps raw fields from the stat structure.
+.TP
+.BI "statx [ \-v|\-r ][ \-m " basic " | \-m " all " | -m " <mask> " ][ \-FD ]"
+Selected statistics from
+.BR stat (2)
+and the XFS_IOC_GETXATTR system call on the current file.
+.RS 1.0i
+.PD 0
+.TP 0.4i
+.B \-v
+Show timestamps.
+.TP
+.B \-r
+Dump raw statx structure values.
+.TP
+.B \-m basic
+Set the field mask for the statx call to STATX_BASIC_STATS.
+.TP
+.B \-m all
+Set the the field mask for the statx call to STATX_ALL (default).
+.TP
+.B \-m <mask>
+Specify a numeric field mask for the statx call.
+.TP
+.B \-F
+Force the attributes to be synced with the server.
+.TP
+.B \-D
+Don't sync attributes with the server.
+.PD
+.RE
 .TP
 .B statfs
 Selected statistics from
@@ -889,7 +1066,59 @@ verbose output will be printed.
 .RE
 .IP
 .B [NOTE: Not currently operational on Linux.]
+.RE
 .PD
+.TP
+.BI "inode  [ [ -n ] " number " ] [ -v ]"
+The inode command queries physical information about an inode. With
+no arguments, it will return 1 or 0, indicating whether or not any
+inode numbers greater than 32 bits are currently in use in the filesystem.
+If given an inode
+.I number
+as an argument, the command will return the same inode
+.I number
+if it is in use, or 0 if not. With
+.BI \-n " number"
+, the next used inode number after this
+.I number
+will be returned, or zero if the supplied inode number is the highest one
+in use. With
+.B \-v
+the command will also report the number of bits (32 or 64) used by the
+inode
+.I number
+printed in the result; if no inode
+.I number
+was specified on the command line, the maximum possible inode number in
+the system will be printed along with its size.
+.PD
+.TP
+.BI "set_encpolicy [ \-c " mode " ] [ \-n " mode " ] [ \-f " flags " ] [ \-v " version " ] [ " keydesc " ]"
+On filesystems that support encryption, assign an encryption policy to the
+current file.
+.I keydesc
+is a 16-byte hex string which identifies the encryption key to use.
+If not specified, a "default" key descriptor of all 0's will be used.
+.RS 1.0i
+.PD 0
+.TP 0.4i
+.BI \-c " mode"
+contents encryption mode (e.g. AES-256-XTS)
+.TP
+.BI \-n " mode"
+filenames encryption mode (e.g. AES-256-CTS)
+.TP
+.BI \-f " flags"
+policy flags (numeric)
+.TP
+.BI \-v " version"
+version of policy structure (numeric)
+.RE
+.PD
+.TP
+.BR get_encpolicy
+On filesystems that support encryption, display the encryption policy of the
+current file.
 
 .SH SEE ALSO
 .BR mkfs.xfs (8),
@@ -902,6 +1131,7 @@ verbose output will be printed.
 .BR fstatfs (2),
 .BR fsync (2),
 .BR ftruncate (2),
+.BR futimens (3),
 .BR mmap (2),
 .BR msync (2),
 .BR open (2),
diff -urpN xfsprogs-4.9.0/man/man8/xfs_mdrestore.8 xfsprogs-4.14.0/man/man8/xfs_mdrestore.8
--- xfsprogs-4.9.0/man/man8/xfs_mdrestore.8	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/man/man8/xfs_mdrestore.8	2017-11-20 01:14:14.000000000 +0100
@@ -4,11 +4,15 @@ xfs_mdrestore \- restores an XFS metadum
 .SH SYNOPSIS
 .B xfs_mdrestore
 [
-.B \-g
+.B \-gi
 ]
 .I source
 .I target
 .br
+.B xfs_mdrestore
+.B \-i
+.I source
+.br
 .B xfs_mdrestore \-V
 .SH DESCRIPTION
 .B xfs_mdrestore
@@ -39,6 +43,12 @@ can be destroyed.
 .B \-g
 Shows restore progress on stdout.
 .TP
+.B \-i
+Shows metadump information on stdout.  If no
+.I target
+is specified, exits after displaying information.  Older metadumps man not
+include any descriptive information.
+.TP
 .B \-V
 Prints the version number and exits.
 .SH DIAGNOSTICS
diff -urpN xfsprogs-4.9.0/man/man8/xfs_metadump.8 xfsprogs-4.14.0/man/man8/xfs_metadump.8
--- xfsprogs-4.9.0/man/man8/xfs_metadump.8	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/man/man8/xfs_metadump.8	2017-11-27 17:57:55.000000000 +0100
@@ -60,6 +60,22 @@ are not obfuscated. Names between 5 and
 are partially obfuscated.
 .PP
 .B xfs_metadump
+cannot obfuscate metadata in the filesystem log.  Log
+recovery of an obfuscated metadump image may expose clear-text
+metadata and/or cause filesystem corruption in the restored image.
+It is recommended that the source filesystem first be mounted and
+unmounted, if possible, to ensure that the log is clean.
+A subsequent invocation of
+.B xfs_metadump
+will capture a clean log and obfuscate all metadata correctly.
+.PP
+If a metadump must be produced from a filesystem with a dirty log,
+it is recommended that obfuscation be turned off with -o option, if
+metadata such as filenames is not considered sensitive.  If obfuscation
+is required on a metadump with a dirty log, please inform the recipient
+of the metadump image about this situation.
+.PP
+.B xfs_metadump
 should not be used for any purposes other than for debugging and reporting
 filesystem problems. The most common usage scenario for this tool is when
 .BR xfs_repair (8)
@@ -114,7 +130,7 @@ copied.
 .B \-m
 Set the maximum size of an allowed metadata extent.  Extremely large metadata
 extents are likely to be corrupt, and will be skipped if they exceed
-this value.  The default size is 1000 blocks.
+this value.  The default size is 2097151 blocks.
 .TP
 .B \-o
 Disables obfuscation of file names and extended attributes.
diff -urpN xfsprogs-4.9.0/man/man8/xfs_repair.8 xfsprogs-4.14.0/man/man8/xfs_repair.8
--- xfsprogs-4.9.0/man/man8/xfs_repair.8	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/man/man8/xfs_repair.8	2017-11-20 01:14:14.000000000 +0100
@@ -65,7 +65,9 @@ Forces
 .B xfs_repair
 to zero the log even if it is dirty (contains metadata changes).
 When using this option the filesystem will likely appear to be corrupt,
-and can cause the loss of user files and/or data.
+and can cause the loss of user files and/or data.  See the
+.B "DIRTY LOGS"
+section for more information.
 .TP
 .BI \-l " logdev"
 Specifies the device special file where the filesystem's external
@@ -505,11 +507,38 @@ This message refers to a large directory
 If the directory were small, the message would read "junking entry ...".
 .SH EXIT STATUS
 .B xfs_repair \-n
-(no modify node)
+(no modify mode)
 will return a status of 1 if filesystem corruption was detected and
 0 if no filesystem corruption was detected.
 .B xfs_repair
-run without the \-n option will always return a status code of 0.
+run without the \-n option will always return a status code of 0 if
+it completes without problems.  If a runtime error is encountered
+during operation, it will return a status of 1.  In this case,
+.B xfs_repair
+should be restarted.  If
+.B xfs_repair is unable
+to proceed due to a dirty log, it will return a status of 2.  See below.
+.SH DIRTY LOGS
+Due to the design of the XFS log, a dirty log can only be replayed 
+by the kernel, on a machine having the same CPU architecture as the
+machine which was writing to the log.
+.B xfs_repair
+cannot replay a dirty log and will exit with a status code of 2
+when it detects a dirty log.
+.PP
+In this situation, the log can be replayed by mounting and immediately
+unmounting the filesystem on the same class of machine that crashed.
+Please make sure that the machine's hardware is reliable before
+replaying to avoid compounding the problems.
+.PP
+If mounting fails, the log can be erased by running
+.B xfs_repair
+with the -L option.
+All metadata updates in progress at the time of the crash will be lost,
+which may cause significant filesystem damage.
+This should
+.B only
+be used as a last resort.
 .SH BUGS
 The filesystem to be checked and repaired must have been
 unmounted cleanly using normal system administration procedures
diff -urpN xfsprogs-4.9.0/man/man8/xfs_spaceman.8 xfsprogs-4.14.0/man/man8/xfs_spaceman.8
--- xfsprogs-4.9.0/man/man8/xfs_spaceman.8	1970-01-01 01:00:00.000000000 +0100
+++ xfsprogs-4.14.0/man/man8/xfs_spaceman.8	2017-11-20 01:14:14.000000000 +0100
@@ -0,0 +1,179 @@
+.TH xfs_spaceman 8
+.SH NAME
+xfs_spaceman \- show free space information about an XFS filesystem
+.SH SYNOPSIS
+.B xfs_spaceman
+[
+.B \-c
+.I cmd
+]
+.I file
+.br
+.B xfs_spaceman \-V
+.SH DESCRIPTION
+.B xfs_spaceman
+reports and controls free space usage in an XFS filesystem.
+.SH OPTIONS
+.TP 1.0i
+.BI \-c " cmd"
+.B xfs_spaceman
+commands may be run interactively (the default) or as arguments on
+the command line. Multiple
+.B \-c
+arguments may be given. The commands are run in the sequence given,
+then the program exits.
+
+.SH COMMANDS
+.TP
+.BI "freesp [ \-dgrs ] [-a agno]... [ \-b | \-e bsize | \-h bsize | \-m factor ]"
+With no arguments,
+.B freesp
+shows a histogram of all free space extents in the filesystem.
+The command takes the following options:
+
+.RS 1.0i
+.PD 0
+.TP 0.4i
+.B \-a agno
+Collect free space information from this allocation group.
+This option can be specified multiple times to collect from multiple groups.
+
+.TP
+.B \-b
+This argument establishes that the histogram bin sizes are successive powers of two.
+This is the default, and is mutually exclusive with the
+.BR "-e" ", " "-h" ", and " "-m" " options."
+
+.TP
+.B \-d
+Print debugging information such as the raw free space extent information.
+
+.TP
+.B \-g
+Print the free space block and extent counts for each AG.
+
+.TP
+.B \-e bsize
+Set all histogram bin sizes to a specific value.
+This option is mutually exclusive with the
+.BR "-b" ", " "-h" ", and " "-m" " options."
+
+.TP
+.B \-h bsize
+Create a histogram bin with a lower bound of this value.
+The upper bound of this bin will be one less than the lower bound of the
+next highest histogram bin.
+This option can be given multiple times to control the exact bin sizes.
+This option is mutually exclusive with the
+.BR "-b" ", " "-e" ", and " "-m" " options."
+
+.TP
+.B \-m factor
+Create each histogram bin with a size that is this many times the size
+of the prvious bin created.
+This option is mutually exclusive with the
+.BR "-b" ", " "-e" ", and " "-h" " options."
+
+.TP
+.B \-r
+Query the realtime device for free space information.
+
+.TP
+.B \-s
+Display a summary of the free space information found.
+.PD
+.RE
+.TP
+.BR "help [ " command " ]"
+Display a brief description of one or all commands.
+.TP
+.BI "prealloc [ \-u id ] [ \-g id ] [ -p id ] [ \-m minlen ] [ \-s ]"
+Removes speculative preallocation.
+If no
+.BR "-u" ", " "-g" ", or " "-p"
+options are given, this command acts on all files.
+The command takes the following options:
+
+.RS 1.0i
+.PD 0
+.TP 0.4i
+.B \-u uid
+Clear all speculative preallocations for files with this user id.
+This option can be given in combination with the
+.B "-g" " and " "-p"
+options.
+
+.TP
+.B \-g gid
+Clear all speculative preallocations for files with this group id.
+This option can be given in combination with the
+.B "-u" " and " "-p"
+options.
+
+.TP
+.B \-p pid
+Clear all speculative preallocations for files with this project id.
+This option can be given in combination with the
+.B "-u" " and " "-g"
+options.
+
+.TP
+.B \-m minlen
+Ignore all files smaller than this size.
+Units can be supplied for this argument.
+
+.TP
+.B \-s
+Wait for removal to complete.
+.PD
+.RE
+.TP
+.B print
+Display a list of all open files.
+.TP
+.B quit
+Exit
+.BR xfs_spaceman .
+.TP
+.BI "trim ( \-a agno | \-f | " "offset" " " "length" " ) [ -m minlen ]"
+Instructs the underlying storage device to release all storage that may
+be backing free space in the filesystem.
+The command takes the following options:
+(One of
+.BR -a ", " -f ", or the "
+.IR offset / length
+pair are required.)
+
+.RS 1.0i
+.PD 0
+.TP 0.4i
+.B \-a agno
+Trim free space extents in the given allocation group.
+This option is mutually exclusive with the
+.BR "-f" " option and the "
+.IR "offset" "/" "length" " options."
+
+.TP
+.B \-f
+Trim all free space in the filesystem.
+This option is mutually exclusive with the
+.BR "-a" " option and the "
+.IR "offset" "/" "length" " options."
+
+.TP
+.IR "option" ", " "length"
+Trim all free space within the physical range defined by the
+.I offset
+and
+.I length
+from this filesystem.
+Units can be appended to these arguments.
+This option is mutually exclusive with the
+.BR "-a" " and " "-f" " options."
+
+.TP
+.B \-m minlen
+Do not trim free space extents shorter than this length.
+Units can be appended to this argument.
+.PD
+.RE
diff -urpN xfsprogs-4.9.0/mdrestore/xfs_mdrestore.c xfsprogs-4.14.0/mdrestore/xfs_mdrestore.c
--- xfsprogs-4.9.0/mdrestore/xfs_mdrestore.c	2016-12-21 06:36:07.000000000 +0100
+++ xfsprogs-4.14.0/mdrestore/xfs_mdrestore.c	2017-11-20 01:14:14.000000000 +0100
@@ -21,6 +21,7 @@
 
 char 		*progname;
 int		show_progress = 0;
+int		show_info = 0;
 int		progress_since_warning = 0;
 
 static void
@@ -65,7 +66,7 @@ perform_restore(
 	int			mb_count;
 	xfs_metablock_t		tmb;
 	xfs_sb_t		sb;
-	__int64_t		bytes_read;
+	int64_t			bytes_read;
 
 	/*
 	 * read in first blocks (superblock 0), set "inprogress" flag for it,
@@ -213,11 +214,14 @@ main(
 
 	progname = basename(argv[0]);
 
-	while ((c = getopt(argc, argv, "gV")) != EOF) {
+	while ((c = getopt(argc, argv, "giV")) != EOF) {
 		switch (c) {
 			case 'g':
 				show_progress = 1;
 				break;
+			case 'i':
+				show_info = 1;
+				break;
 			case 'V':
 				printf("%s version %s\n", progname, VERSION);
 				exit(0);
@@ -226,7 +230,11 @@ main(
 		}
 	}
 
-	if (argc - optind != 2)
+	if (argc - optind < 1 || argc - optind > 2)
+		usage();
+
+	/* show_info without a target is ok */
+	if (!show_info && argc - optind != 2)
 		usage();
 
 	/* open source */
@@ -239,6 +247,34 @@ main(
 		if (src_f == NULL)
 			fatal("cannot open source dump file\n");
 	}
+
+	if (show_info) {
+		xfs_metablock_t		mb;
+
+		if (fread(&mb, sizeof(mb), 1, src_f) != 1)
+			fatal("error reading from file: %s\n", strerror(errno));
+
+		if (be32_to_cpu(mb.mb_magic) != XFS_MD_MAGIC)
+			fatal("specified file is not a metadata dump\n");
+
+		if (mb.mb_info & XFS_METADUMP_INFO_FLAGS) {
+			printf("%s: %sobfuscated, %s log, %s metadata blocks\n",
+			argv[optind],
+			mb.mb_info & XFS_METADUMP_OBFUSCATED ? "":"not ",
+			mb.mb_info & XFS_METADUMP_DIRTYLOG ? "dirty":"clean",
+			mb.mb_info & XFS_METADUMP_FULLBLOCKS ? "full":"zeroed");
+		} else {
+			printf("%s: no informational flags present\n",
+				argv[optind]);
+		}
+
+		if (argc - optind == 1)
+			exit(0);
+
+		/* Go back to the beginning for the restore function */
+		fseek(src_f, 0L, SEEK_SET);
+	}
+
 	optind++;
 
 	/* check and open target */
diff -urpN xfsprogs-4.9.0/mkfs/maxtrres.c xfsprogs-4.14.0/mkfs/maxtrres.c
--- xfsprogs-4.9.0/mkfs/maxtrres.c	2016-12-13 21:07:08.000000000 +0100
+++ xfsprogs-4.14.0/mkfs/maxtrres.c	2017-11-20 01:14:14.000000000 +0100
@@ -40,7 +40,8 @@ max_trans_res(
 	int		log_sunit,
 	int		finobt,
 	int		rmapbt,
-	int		reflink)
+	int		reflink,
+	int		inode_align)
 {
 	xfs_sb_t	*sbp;
 	xfs_mount_t	mount;
@@ -54,12 +55,20 @@ max_trans_res(
 	sbp->sb_blocklog = blocklog;
 	sbp->sb_blocksize = 1 << blocklog;
 	sbp->sb_agblocks = agsize;
+	sbp->sb_agblklog = (uint8_t)libxfs_log2_roundup((unsigned int)agsize);
 	sbp->sb_inodelog = inodelog;
 	sbp->sb_inopblog = blocklog - inodelog;
 	sbp->sb_inodesize = 1 << inodelog;
 	sbp->sb_inopblock = 1 << (blocklog - inodelog);
 	sbp->sb_dirblklog = dirblocklog - blocklog;
 
+	if (inode_align) {
+		int	cluster_size = XFS_INODE_BIG_CLUSTER_SIZE;
+		if (crcs_enabled)
+			cluster_size *= sbp->sb_inodesize / XFS_DINODE_MIN_SIZE;
+		sbp->sb_inoalignmt = cluster_size >> blocklog;
+	}
+
 	if (log_sunit > 0) {
 		log_sunit <<= blocklog;
 		logversion = 2;
diff -urpN xfsprogs-4.9.0/mkfs/proto.c xfsprogs-4.14.0/mkfs/proto.c
--- xfsprogs-4.9.0/mkfs/proto.c	2016-12-21 06:36:07.000000000 +0100
+++ xfsprogs-4.14.0/mkfs/proto.c	2017-11-27 17:57:55.000000000 +0100
@@ -495,7 +495,8 @@ parseproto(
 		newdirent(mp, tp, pip, &xname, ip->i_ino, &first, &dfops);
 		libxfs_trans_log_inode(tp, ip, flags);
 
-		error = -libxfs_defer_finish(&tp, &dfops, ip);
+		libxfs_defer_ijoin(&dfops, ip);
+		error = -libxfs_defer_finish(&tp, &dfops);
 		if (error)
 			fail(_("Pre-allocated file creation failed"), error);
 		libxfs_trans_commit(tp);
@@ -577,7 +578,8 @@ parseproto(
 		}
 		newdirectory(mp, tp, ip, pip);
 		libxfs_trans_log_inode(tp, ip, flags);
-		error = -libxfs_defer_finish(&tp, &dfops, ip);
+		libxfs_defer_ijoin(&dfops, ip);
+		error = -libxfs_defer_finish(&tp, &dfops);
 		if (error)
 			fail(_("Directory creation failed"), error);
 		libxfs_trans_commit(tp);
@@ -603,7 +605,8 @@ parseproto(
 		fail(_("Unknown format"), EINVAL);
 	}
 	libxfs_trans_log_inode(tp, ip, flags);
-	error = -libxfs_defer_finish(&tp, &dfops, ip);
+	libxfs_defer_ijoin(&dfops, ip);
+	error = -libxfs_defer_finish(&tp, &dfops);
 	if (error) {
 		fail(_("Error encountered creating file from prototype file"),
 			error);
@@ -667,7 +670,7 @@ rtinit(
 	mp->m_sb.sb_rbmino = rbmip->i_ino;
 	rbmip->i_d.di_size = mp->m_sb.sb_rbmblocks * mp->m_sb.sb_blocksize;
 	rbmip->i_d.di_flags = XFS_DIFLAG_NEWRTBM;
-	*(__uint64_t *)&VFS_I(rbmip)->i_atime = 0;
+	*(uint64_t *)&VFS_I(rbmip)->i_atime = 0;
 	libxfs_trans_log_inode(tp, rbmip, XFS_ILOG_CORE);
 	libxfs_log_sb(tp);
 	mp->m_rbmip = rbmip;
@@ -712,7 +715,8 @@ rtinit(
 		}
 	}
 
-	error = -libxfs_defer_finish(&tp, &dfops, rbmip);
+	libxfs_defer_ijoin(&dfops, rbmip);
+	error = -libxfs_defer_finish(&tp, &dfops);
 	if (error) {
 		fail(_("Completion of the realtime bitmap failed"), error);
 	}
@@ -747,7 +751,8 @@ rtinit(
 			bno += ep->br_blockcount;
 		}
 	}
-	error = -libxfs_defer_finish(&tp, &dfops, rsumip);
+	libxfs_defer_ijoin(&dfops, rsumip);
+	error = -libxfs_defer_finish(&tp, &dfops);
 	if (error) {
 		fail(_("Completion of the realtime summary failed"), error);
 	}
@@ -770,7 +775,8 @@ rtinit(
 			fail(_("Error initializing the realtime space"),
 				error);
 		}
-		error = -libxfs_defer_finish(&tp, &dfops, rbmip);
+		libxfs_defer_ijoin(&dfops, rbmip);
+		error = -libxfs_defer_finish(&tp, &dfops);
 		if (error) {
 			fail(_("Error completing the realtime space"), error);
 		}
diff -urpN xfsprogs-4.9.0/mkfs/xfs_mkfs.c xfsprogs-4.14.0/mkfs/xfs_mkfs.c
--- xfsprogs-4.9.0/mkfs/xfs_mkfs.c	2016-12-21 06:36:07.000000000 +0100
+++ xfsprogs-4.14.0/mkfs/xfs_mkfs.c	2017-11-20 01:14:14.000000000 +0100
@@ -18,9 +18,6 @@
 
 #include "libxfs.h"
 #include <ctype.h>
-#ifdef ENABLE_BLKID
-#  include <blkid/blkid.h>
-#endif /* ENABLE_BLKID */
 #include "xfs_multidisk.h"
 #include "libxcmd.h"
 
@@ -42,7 +39,7 @@ static int  ispow2(unsigned int i);
 unsigned int		blocksize;
 unsigned int		sectorsize;
 
-#define MAX_SUBOPTS	16
+#define MAX_SUBOPTS	17
 #define SUBOPT_NEEDS_VAL	(-1LL)
 #define MAX_CONFLICTS	8
 #define LAST_CONFLICT	(-1)
@@ -190,6 +187,8 @@ struct opt_params dopts = {
 		"projinherit",
 #define D_EXTSZINHERIT	14
 		"extszinherit",
+#define D_COWEXTSIZE	15
+		"cowextsize",
 		NULL
 	},
 	.subopt_params = {
@@ -306,6 +305,12 @@ struct opt_params dopts = {
 		  .maxval = UINT_MAX,
 		  .defaultval = SUBOPT_NEEDS_VAL,
 		},
+		{ .index = D_COWEXTSIZE,
+		  .conflicts = { LAST_CONFLICT },
+		  .minval = 0,
+		  .maxval = UINT_MAX,
+		  .defaultval = SUBOPT_NEEDS_VAL,
+		},
 	},
 };
 
@@ -697,20 +702,20 @@ struct opt_params mopts = {
 		  .conflicts = { LAST_CONFLICT },
 		  .minval = 0,
 		  .maxval = 1,
-		  .defaultval = 0,
+		  .defaultval = 1,
 		},
 		{ .index = M_REFLINK,
 		  .conflicts = { LAST_CONFLICT },
 		  .minval = 0,
 		  .maxval = 1,
-		  .defaultval = 0,
+		  .defaultval = 1,
 		},
 	},
 };
 
-#define TERABYTES(count, blog)	((__uint64_t)(count) << (40 - (blog)))
-#define GIGABYTES(count, blog)	((__uint64_t)(count) << (30 - (blog)))
-#define MEGABYTES(count, blog)	((__uint64_t)(count) << (20 - (blog)))
+#define TERABYTES(count, blog)	((uint64_t)(count) << (40 - (blog)))
+#define GIGABYTES(count, blog)	((uint64_t)(count) << (30 - (blog)))
+#define MEGABYTES(count, blog)	((uint64_t)(count) << (20 - (blog)))
 
 /*
  * Use this macro before we have superblock and mount structure
@@ -881,7 +886,7 @@ fixup_log_stripe_unit(
 	xfs_rfsblock_t	*logblocks,
 	int		blocklog)
 {
-	__uint64_t	tmp_logblocks;
+	uint64_t	tmp_logblocks;
 
 	/*
 	 * Make sure that the log size is a multiple of the stripe unit
@@ -913,7 +918,7 @@ fixup_internal_log_stripe(
 	xfs_mount_t	*mp,
 	int		lsflag,
 	xfs_fsblock_t	logstart,
-	__uint64_t	agsize,
+	uint64_t	agsize,
 	int		sunit,
 	xfs_rfsblock_t	*logblocks,
 	int		blocklog,
@@ -937,7 +942,7 @@ fixup_internal_log_stripe(
 }
 
 void
-validate_log_size(__uint64_t logblocks, int blocklog, int min_logblocks)
+validate_log_size(uint64_t logblocks, int blocklog, int min_logblocks)
 {
 	if (logblocks < min_logblocks) {
 		fprintf(stderr,
@@ -962,7 +967,7 @@ validate_log_size(__uint64_t logblocks,
 static int
 calc_default_imaxpct(
 	int		blocklog,
-	__uint64_t	dblocks)
+	uint64_t	dblocks)
 {
 	/*
 	 * This returns the % of the disk space that is used for
@@ -984,9 +989,9 @@ calc_default_imaxpct(
 static void
 validate_ag_geometry(
 	int		blocklog,
-	__uint64_t	dblocks,
-	__uint64_t	agsize,
-	__uint64_t	agcount)
+	uint64_t	dblocks,
+	uint64_t	agsize,
+	uint64_t	agcount)
 {
 	if (agsize < XFS_AG_MIN_BLOCKS(blocklog)) {
 		fprintf(stderr,
@@ -1062,7 +1067,7 @@ zero_old_xfs_structures(
 {
 	void 			*buf;
 	xfs_sb_t 		sb;
-	__uint32_t		bsize;
+	uint32_t		bsize;
 	int			i;
 	xfs_off_t		off;
 
@@ -1115,8 +1120,8 @@ zero_old_xfs_structures(
 			i != sb.sb_blocklog)
 		goto done;
 
-	if (sb.sb_dblocks > ((__uint64_t)sb.sb_agcount * sb.sb_agblocks) ||
-			sb.sb_dblocks < ((__uint64_t)(sb.sb_agcount - 1) *
+	if (sb.sb_dblocks > ((uint64_t)sb.sb_agcount * sb.sb_agblocks) ||
+			sb.sb_dblocks < ((uint64_t)(sb.sb_agcount - 1) *
 					 sb.sb_agblocks + XFS_MIN_AG_BLOCKS))
 		goto done;
 
@@ -1136,7 +1141,7 @@ done:
 }
 
 static void
-discard_blocks(dev_t dev, __uint64_t nsectors)
+discard_blocks(dev_t dev, uint64_t nsectors)
 {
 	int fd;
 
@@ -1284,7 +1289,7 @@ check_opt(
 
 	if (sp->index != index) {
 		fprintf(stderr,
-	("Developer screwed up option parsing (%d/%d)! Please report!\n"),
+	_("Developer screwed up option parsing (%d/%d)! Please report!\n"),
 			sp->index, index);
 		reqval(opts->name, (char **)opts->subopts, index);
 	}
@@ -1398,11 +1403,11 @@ main(
 	int			argc,
 	char			**argv)
 {
-	__uint64_t		agcount;
+	uint64_t		agcount;
 	xfs_agf_t		*agf;
 	xfs_agi_t		*agi;
 	xfs_agnumber_t		agno;
-	__uint64_t		agsize;
+	uint64_t		agsize;
 	xfs_alloc_rec_t		*arec;
 	struct xfs_btree_block	*block;
 	int			blflag;
@@ -1422,6 +1427,7 @@ main(
 	int			dsw;
 	int			dsunit;
 	int			dswidth;
+	int			dsflag;
 	int			force_overwrite;
 	struct fsxattr		fsx;
 	int			ilflag;
@@ -1477,10 +1483,10 @@ main(
 	char			*rtsize;
 	xfs_sb_t		*sbp;
 	int			sectorlog;
-	__uint64_t		sector_mask;
+	uint64_t		sector_mask;
 	int			slflag;
 	int			ssflag;
-	__uint64_t		tmp_agsize;
+	uint64_t		tmp_agsize;
 	uuid_t			uuid;
 	int			worst_freelist;
 	libxfs_init_t		xi;
@@ -1524,7 +1530,7 @@ main(
 	dfile = logfile = rtfile = NULL;
 	dsize = logsize = rtsize = rtextsize = protofile = NULL;
 	dsu = dsw = dsunit = dswidth = lalign = lsu = lsunit = 0;
-	nodsflag = norsflag = 0;
+	dsflag = nodsflag = norsflag = 0;
 	force_overwrite = 0;
 	worst_freelist = 0;
 	memset(&fsx, 0, sizeof(fsx));
@@ -1590,16 +1596,20 @@ main(
 					break;
 				case D_SUNIT:
 					dsunit = getnum(value, &dopts, D_SUNIT);
+					dsflag = 1;
 					break;
 				case D_SWIDTH:
 					dswidth = getnum(value, &dopts,
 							 D_SWIDTH);
+					dsflag = 1;
 					break;
 				case D_SU:
 					dsu = getnum(value, &dopts, D_SU);
+					dsflag = 1;
 					break;
 				case D_SW:
 					dsw = getnum(value, &dopts, D_SW);
+					dsflag = 1;
 					break;
 				case D_NOALIGN:
 					nodsflag = getnum(value, &dopts,
@@ -1636,6 +1646,13 @@ main(
 					fsx.fsx_xflags |=
 						XFS_DIFLAG_EXTSZINHERIT;
 					break;
+				case D_COWEXTSIZE:
+					fsx.fsx_cowextsize = getnum(value,
+							&dopts,
+							D_COWEXTSIZE);
+					fsx.fsx_xflags |=
+						FS_XFLAG_COWEXTSIZE;
+					break;
 				default:
 					unknown('d', value);
 				}
@@ -2140,6 +2157,11 @@ _("reflink not supported without CRC sup
 		sb_feat.reflink = false;
 	}
 
+	if ((fsx.fsx_xflags & FS_XFLAG_COWEXTSIZE) && !sb_feat.reflink) {
+		fprintf(stderr,
+_("cowextsize not supported without reflink support\n"));
+		usage();
+	}
 
 	if (sb_feat.rmapbt && xi.rtname) {
 		fprintf(stderr,
@@ -2165,7 +2187,7 @@ _("rmapbt not supported with realtime de
 
 
 	if (dsize) {
-		__uint64_t dbytes;
+		uint64_t dbytes;
 
 		dbytes = getnum(dsize, &dopts, D_SIZE);
 		if (dbytes % XFS_MIN_BLOCKSIZE) {
@@ -2197,7 +2219,7 @@ _("rmapbt not supported with realtime de
 	}
 
 	if (logsize) {
-		__uint64_t logbytes;
+		uint64_t logbytes;
 
 		logbytes = getnum(logsize, &lopts, L_SIZE);
 		if (logbytes % XFS_MIN_BLOCKSIZE) {
@@ -2214,7 +2236,7 @@ _("rmapbt not supported with realtime de
 				(long long)(logblocks << blocklog));
 	}
 	if (rtsize) {
-		__uint64_t rtbytes;
+		uint64_t rtbytes;
 
 		rtbytes = getnum(rtsize, &ropts, R_SIZE);
 		if (rtbytes % XFS_MIN_BLOCKSIZE) {
@@ -2234,7 +2256,7 @@ _("rmapbt not supported with realtime de
 	 * If specified, check rt extent size against its constraints.
 	 */
 	if (rtextsize) {
-		__uint64_t rtextbytes;
+		uint64_t rtextbytes;
 
 		rtextbytes = getnum(rtextsize, &ropts, R_EXTSIZE);
 		if (rtextbytes % blocksize) {
@@ -2250,8 +2272,8 @@ _("rmapbt not supported with realtime de
 		 * and the underlying volume is striped, then set rtextblocks
 		 * to the stripe width.
 		 */
-		__uint64_t	rswidth;
-		__uint64_t	rtextbytes;
+		uint64_t	rswidth;
+		uint64_t	rtextbytes;
 
 		if (!norsflag && !xi.risfile && !(!rtsize && xi.disfile))
 			rswidth = ft.rtswidth;
@@ -2306,6 +2328,10 @@ _("rmapbt not supported with realtime de
 	calc_stripe_factors(dsu, dsw, sectorsize, lsu, lsectorsize,
 				&dsunit, &dswidth, &lsunit);
 
+	/* If sunit & swidth were manually specified as 0, same as noalign */
+	if (dsflag && !dsunit && !dswidth)
+		nodsflag = 1;
+
 	xi.setblksize = sectorsize;
 
 	/*
@@ -2329,10 +2355,10 @@ _("rmapbt not supported with realtime de
 	 * multiple of the sector size, or 1024, whichever is larger.
 	 */
 
-	sector_mask = (__uint64_t)-1 << (MAX(sectorlog, 10) - BBSHIFT);
+	sector_mask = (uint64_t)-1 << (MAX(sectorlog, 10) - BBSHIFT);
 	xi.dsize &= sector_mask;
 	xi.rtsize &= sector_mask;
-	xi.logBBsize &= (__uint64_t)-1 << (MAX(lsectorlog, 10) - BBSHIFT);
+	xi.logBBsize &= (uint64_t)-1 << (MAX(lsectorlog, 10) - BBSHIFT);
 
 
 	/* don't do discards on print-only runs or on files */
@@ -2528,7 +2554,9 @@ reported by the device (%u).\n"),
 				}
 			}
 		}
-		if (dswidth && ((agsize % dswidth) == 0) && (agcount > 1)) {
+		if (dswidth && ((agsize % dswidth) == 0)
+			    && (dswidth != dsunit)
+			    && (agcount > 1)) {
 			/* This is a non-optimal configuration because all AGs
 			 * start on the same disk in the stripe.  Changing
 			 * the AG size by one sunit will guarantee that this
@@ -2622,7 +2650,8 @@ an AG size that is one stripe unit small
 				   sb_feat.crcs_enabled, sb_feat.dir_version,
 				   sectorlog, blocklog, inodelog, dirblocklog,
 				   sb_feat.log_version, lsunit, sb_feat.finobt,
-				   sb_feat.rmapbt, sb_feat.reflink);
+				   sb_feat.rmapbt, sb_feat.reflink,
+				   sb_feat.inode_align);
 	ASSERT(min_logblocks);
 	min_logblocks = MAX(XFS_MIN_LOG_BLOCKS, min_logblocks);
 	if (!logsize && dblocks >= (1024*1024*1024) >> blocklog)
@@ -2689,9 +2718,9 @@ _("size %s specified for log subvolume i
 	mp = &mbuf;
 	sbp = &mp->m_sb;
 	memset(mp, 0, sizeof(xfs_mount_t));
-	sbp->sb_blocklog = (__uint8_t)blocklog;
-	sbp->sb_sectlog = (__uint8_t)sectorlog;
-	sbp->sb_agblklog = (__uint8_t)libxfs_log2_roundup((unsigned int)agsize);
+	sbp->sb_blocklog = (uint8_t)blocklog;
+	sbp->sb_sectlog = (uint8_t)sectorlog;
+	sbp->sb_agblklog = (uint8_t)libxfs_log2_roundup((unsigned int)agsize);
 	sbp->sb_agblocks = (xfs_agblock_t)agsize;
 	mp->m_blkbb_log = sbp->sb_blocklog - BBSHIFT;
 	mp->m_sectbb_log = sbp->sb_sectlog - BBSHIFT;
@@ -2798,14 +2827,14 @@ _("size %s specified for log subvolume i
 	sbp->sb_agcount = (xfs_agnumber_t)agcount;
 	sbp->sb_rbmblocks = nbmblocks;
 	sbp->sb_logblocks = (xfs_extlen_t)logblocks;
-	sbp->sb_sectsize = (__uint16_t)sectorsize;
-	sbp->sb_inodesize = (__uint16_t)isize;
-	sbp->sb_inopblock = (__uint16_t)(blocksize / isize);
-	sbp->sb_sectlog = (__uint8_t)sectorlog;
-	sbp->sb_inodelog = (__uint8_t)inodelog;
-	sbp->sb_inopblog = (__uint8_t)(blocklog - inodelog);
+	sbp->sb_sectsize = (uint16_t)sectorsize;
+	sbp->sb_inodesize = (uint16_t)isize;
+	sbp->sb_inopblock = (uint16_t)(blocksize / isize);
+	sbp->sb_sectlog = (uint8_t)sectorlog;
+	sbp->sb_inodelog = (uint8_t)inodelog;
+	sbp->sb_inopblog = (uint8_t)(blocklog - inodelog);
 	sbp->sb_rextslog =
-		(__uint8_t)(rtextents ?
+		(uint8_t)(rtextents ?
 			libxfs_highbit32((unsigned int)rtextents) : 0);
 	sbp->sb_inprogress = 1;	/* mkfs is in progress */
 	sbp->sb_imax_pct = imaxpct;
@@ -2833,8 +2862,8 @@ _("size %s specified for log subvolume i
 	} else
 		sbp->sb_inoalignmt = 0;
 	if (lsectorsize != BBSIZE || sectorsize != BBSIZE) {
-		sbp->sb_logsectlog = (__uint8_t)lsectorlog;
-		sbp->sb_logsectsize = (__uint16_t)lsectorsize;
+		sbp->sb_logsectlog = (uint8_t)lsectorlog;
+		sbp->sb_logsectsize = (uint16_t)lsectorsize;
 	} else {
 		sbp->sb_logsectlog = 0;
 		sbp->sb_logsectsize = 0;
@@ -3038,12 +3067,7 @@ _("size %s specified for log subvolume i
 		buf->b_ops = &xfs_allocbt_buf_ops;
 		block = XFS_BUF_TO_BLOCK(buf);
 		memset(block, 0, blocksize);
-		if (xfs_sb_version_hascrc(&mp->m_sb))
-			libxfs_btree_init_block(mp, buf, XFS_ABTB_CRC_MAGIC, 0, 1,
-						agno, XFS_BTREE_CRC_BLOCKS);
-		else
-			libxfs_btree_init_block(mp, buf, XFS_ABTB_MAGIC, 0, 1,
-						agno, 0);
+		libxfs_btree_init_block(mp, buf, XFS_BTNUM_BNO, 0, 1, agno, 0);
 
 		arec = XFS_ALLOC_REC_ADDR(mp, block, 1);
 		arec->ar_startblock = cpu_to_be32(libxfs_prealloc_blocks(mp));
@@ -3093,12 +3117,7 @@ _("size %s specified for log subvolume i
 		buf->b_ops = &xfs_allocbt_buf_ops;
 		block = XFS_BUF_TO_BLOCK(buf);
 		memset(block, 0, blocksize);
-		if (xfs_sb_version_hascrc(&mp->m_sb))
-			libxfs_btree_init_block(mp, buf, XFS_ABTC_CRC_MAGIC, 0, 1,
-						agno, XFS_BTREE_CRC_BLOCKS);
-		else
-			libxfs_btree_init_block(mp, buf, XFS_ABTC_MAGIC, 0, 1,
-						agno, 0);
+		libxfs_btree_init_block(mp, buf, XFS_BTNUM_CNT, 0, 1, agno, 0);
 
 		arec = XFS_ALLOC_REC_ADDR(mp, block, 1);
 		arec->ar_startblock = cpu_to_be32(libxfs_prealloc_blocks(mp));
@@ -3141,8 +3160,8 @@ _("size %s specified for log subvolume i
 
 			block = XFS_BUF_TO_BLOCK(buf);
 			memset(block, 0, blocksize);
-			libxfs_btree_init_block(mp, buf, XFS_REFC_CRC_MAGIC, 0,
-						0, agno, XFS_BTREE_CRC_BLOCKS);
+			libxfs_btree_init_block(mp, buf, XFS_BTNUM_REFC, 0,
+						0, agno, 0);
 
 			libxfs_writebuf(buf, LIBXFS_EXIT_ON_FAILURE);
 		}
@@ -3156,12 +3175,7 @@ _("size %s specified for log subvolume i
 		buf->b_ops = &xfs_inobt_buf_ops;
 		block = XFS_BUF_TO_BLOCK(buf);
 		memset(block, 0, blocksize);
-		if (xfs_sb_version_hascrc(&mp->m_sb))
-			libxfs_btree_init_block(mp, buf, XFS_IBT_CRC_MAGIC, 0, 0,
-						agno, XFS_BTREE_CRC_BLOCKS);
-		else
-			libxfs_btree_init_block(mp, buf, XFS_IBT_MAGIC, 0, 0,
-						agno, 0);
+		libxfs_btree_init_block(mp, buf, XFS_BTNUM_INO, 0, 0, agno, 0);
 		libxfs_writebuf(buf, LIBXFS_EXIT_ON_FAILURE);
 
 		/*
@@ -3174,12 +3188,7 @@ _("size %s specified for log subvolume i
 			buf->b_ops = &xfs_inobt_buf_ops;
 			block = XFS_BUF_TO_BLOCK(buf);
 			memset(block, 0, blocksize);
-			if (xfs_sb_version_hascrc(&mp->m_sb))
-				libxfs_btree_init_block(mp, buf, XFS_FIBT_CRC_MAGIC, 0, 0,
-							agno, XFS_BTREE_CRC_BLOCKS);
-			else
-				libxfs_btree_init_block(mp, buf, XFS_FIBT_MAGIC, 0, 0,
-							agno, 0);
+			libxfs_btree_init_block(mp, buf, XFS_BTNUM_FINO, 0, 0, agno, 0);
 			libxfs_writebuf(buf, LIBXFS_EXIT_ON_FAILURE);
 		}
 
@@ -3194,8 +3203,7 @@ _("size %s specified for log subvolume i
 			block = XFS_BUF_TO_BLOCK(buf);
 			memset(block, 0, blocksize);
 
-			libxfs_btree_init_block(mp, buf, XFS_RMAP_CRC_MAGIC, 0, 0,
-						agno, XFS_BTREE_CRC_BLOCKS);
+			libxfs_btree_init_block(mp, buf, XFS_BTNUM_RMAP, 0, 0, agno, 0);
 
 			/*
 			 * mark the AG header regions as static metadata
diff -urpN xfsprogs-4.9.0/po/pl.po xfsprogs-4.14.0/po/pl.po
--- xfsprogs-4.9.0/po/pl.po	2016-12-21 06:36:07.000000000 +0100
+++ xfsprogs-4.14.0/po/pl.po	2017-11-20 01:14:14.000000000 +0100
@@ -1,13 +1,13 @@
 # Polish translation for xfsprogs.
 # This file is distributed under the same license as the xfsprogs package.
-# Jakub Bogusz <qboosh@pld-linux.org>, 2006-2014.
+# Jakub Bogusz <qboosh@pld-linux.org>, 2006-2017.
 #
 msgid ""
 msgstr ""
-"Project-Id-Version: xfsprogs 3.2.0+git20140709\n"
+"Project-Id-Version: xfsprogs 4.11.0\n"
 "Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2014-07-09 19:08+0200\n"
-"PO-Revision-Date: 2014-07-09 20:45+0200\n"
+"POT-Creation-Date: 2017-05-05 13:48-0500\n"
+"PO-Revision-Date: 2017-05-12 22:30+0200\n"
 "Last-Translator: Jakub Bogusz <qboosh@pld-linux.org>\n"
 "Language-Team: Polish <translation-team-pl@lists.sourceforge.net>\n"
 "Language: pl\n"
@@ -15,167 +15,168 @@ msgstr ""
 "Content-Type: text/plain; charset=UTF-8\n"
 "Content-Transfer-Encoding: 8bit\n"
 
-#: .././copy/xfs_copy.c:102
+#: .././copy/xfs_copy.c:115
 #, c-format
 msgid "Check logfile \"%s\" for more details\n"
 msgstr "Więcej szczegółów w pliku logu \"%s\"\n"
 
-#: .././copy/xfs_copy.c:108
+#: .././copy/xfs_copy.c:121
 #, c-format
 msgid "%s:  could not write to logfile \"%s\".\n"
 msgstr "%s: nie udało się zapisać pliku logu \"%s\".\n"
 
-#: .././copy/xfs_copy.c:111
+#: .././copy/xfs_copy.c:124
 #, c-format
 msgid "Aborting XFS copy -- logfile error -- reason: %s\n"
 msgstr "Przerwano XFS copy - błąd pliku logu - przyczyna: %s\n"
 
-#: .././copy/xfs_copy.c:126 .././copy/xfs_copy.c:267 .././copy/xfs_copy.c:546
-#: .././copy/xfs_copy.c:553
+#: .././copy/xfs_copy.c:139 .././copy/xfs_copy.c:292 .././copy/xfs_copy.c:605
+#: .././copy/xfs_copy.c:612
 msgid "Aborting XFS copy - reason"
 msgstr "Przerwano XFS copy - przyczyna"
 
-#: .././copy/xfs_copy.c:140
+#: .././copy/xfs_copy.c:159
 msgid "THE FOLLOWING COPIES FAILED TO COMPLETE\n"
 msgstr "NASTĘPUJĄCYCH KOPII NIE UDAŁO SIĘ UKOŃCZYĆ\n"
 
-#: .././copy/xfs_copy.c:144
+#: .././copy/xfs_copy.c:163
 msgid "write error"
 msgstr "błąd zapisu"
 
-#: .././copy/xfs_copy.c:146
+#: .././copy/xfs_copy.c:165
 msgid "lseek error"
 msgstr "błąd lseek"
 
-#: .././copy/xfs_copy.c:147
+#: .././copy/xfs_copy.c:166
 #, c-format
 msgid " at offset %lld\n"
 msgstr " pod offsetem %lld\n"
 
-#: .././copy/xfs_copy.c:151
+#: .././copy/xfs_copy.c:170
 #, c-format
 msgid "All copies completed.\n"
 msgstr "Wszystkie kopie ukończone.\n"
 
-#: .././copy/xfs_copy.c:154
+#: .././copy/xfs_copy.c:173
 #, c-format
 msgid "See \"%s\" for more details.\n"
 msgstr "Więcej szczegółów w \"%s\".\n"
 
-#: .././copy/xfs_copy.c:236
+#: .././copy/xfs_copy.c:261
 #, c-format
 msgid "%s:  write error on target %d \"%s\" at offset %lld\n"
 msgstr "%s: błąd zapisu przy celu %d \"%s\" pod offsetem %lld\n"
 
-#: .././copy/xfs_copy.c:241
+#: .././copy/xfs_copy.c:266
 #, c-format
 msgid "%s:  lseek error on target %d \"%s\" at offset %lld\n"
 msgstr "%s: błąd lseek przy celu %d \"%s\" pod offsetem %lld\n"
 
-#: .././copy/xfs_copy.c:247
+#: .././copy/xfs_copy.c:272
 #, c-format
 msgid "Aborting target %d - reason"
 msgstr "Przerywano zapis celu %d - przyczyna"
 
-#: .././copy/xfs_copy.c:251
+#: .././copy/xfs_copy.c:276
 msgid "Aborting XFS copy - no more targets.\n"
 msgstr "Przerwano XFS copy - nie ma więcej celów.\n"
 
-#: .././copy/xfs_copy.c:262
+#: .././copy/xfs_copy.c:287
 #, c-format
 msgid "%s:  thread %d died unexpectedly, target \"%s\" incomplete\n"
 msgstr "%s: wątek %d zmarł nieoczekiwanie, cel \"%s\" niekompletny\n"
 
-#: .././copy/xfs_copy.c:264
+#: .././copy/xfs_copy.c:289
 #, c-format
 msgid "%s:  offset was probably %lld\n"
 msgstr "%s: offset prawdopodobnie %lld\n"
 
-#: .././copy/xfs_copy.c:275
+#: .././copy/xfs_copy.c:300
 #, c-format
 msgid "%s: Unknown child died (should never happen!)\n"
 msgstr "%s: Nieznany potomek zmarł (nie powinno się zdarzyć!)\n"
 
-#: .././copy/xfs_copy.c:285
+#: .././copy/xfs_copy.c:310
 #, c-format
 msgid "Usage: %s [-bdV] [-L logfile] source target [target ...]\n"
 msgstr "Składnia: %s [-bdV] [-L plik_logu] źródło cel [cel ...]\n"
 
-#: .././copy/xfs_copy.c:367
+#: .././copy/xfs_copy.c:393
 #, c-format
 msgid "%s:  lseek failure at offset %lld\n"
 msgstr "%s: niepowodzenie lseek pod offsetem %lld\n"
 
-#: .././copy/xfs_copy.c:382
+#: .././copy/xfs_copy.c:408
 #, c-format
 msgid "assert error:  buf->length = %d, buf->size = %d\n"
 msgstr "błąd zapewnienia: buf->length = %d, buf->size = %d\n"
 
-#: .././copy/xfs_copy.c:388
+#: .././copy/xfs_copy.c:414
 #, c-format
 msgid "%s:  read failure at offset %lld\n"
 msgstr "%s: błąd odczytu pod offsetem %lld\n"
 
-#: .././copy/xfs_copy.c:418
+#: .././copy/xfs_copy.c:444
 msgid "ag header buffer invalid!\n"
 msgstr "błędny bufor nagłówka ag!\n"
 
-#: .././copy/xfs_copy.c:526 .././db/init.c:94 .././estimate/xfs_estimate.c:144
-#: .././fsr/xfs_fsr.c:300 .././growfs/xfs_growfs.c:182 .././io/init.c:190
-#: .././logprint/logprint.c:203 .././mkfs/xfs_mkfs.c:1703
-#: .././quota/init.c:131 .././repair/xfs_repair.c:319 .././rtcp/xfs_rtcp.c:55
+#: .././copy/xfs_copy.c:585 .././db/init.c:97 .././estimate/xfs_estimate.c:144
+#: .././fsr/xfs_fsr.c:295 .././growfs/xfs_growfs.c:190 .././io/init.c:207
+#: .././logprint/logprint.c:206 .././mkfs/xfs_mkfs.c:1925 .././quota/init.c:182
+#: .././repair/xfs_repair.c:324 .././rtcp/xfs_rtcp.c:55
 #, c-format
 msgid "%s version %s\n"
 msgstr "%s wersja %s\n"
 
-#: .././copy/xfs_copy.c:544
+#: .././copy/xfs_copy.c:603
 #, c-format
 msgid "%s: couldn't open log file \"%s\"\n"
 msgstr "%s: nie udało się otworzyć pliku logu \"%s\"\n"
 
-#: .././copy/xfs_copy.c:551
+#: .././copy/xfs_copy.c:610
 #, c-format
 msgid "%s: couldn't set up logfile stream\n"
 msgstr "%s: nie udało się ustanowić strumienia pliku logu\n"
 
-#: .././copy/xfs_copy.c:563
+#: .././copy/xfs_copy.c:622
 msgid "Couldn't allocate target array\n"
 msgstr "Nie udało się przydzielić tablicy celów\n"
 
-#: .././copy/xfs_copy.c:582
+#: .././copy/xfs_copy.c:641
 #, c-format
 msgid "%s:  couldn't open source \"%s\"\n"
 msgstr "%s: nie udało się otworzyć źródła \"%s\"\n"
 
-#: .././copy/xfs_copy.c:588
+#: .././copy/xfs_copy.c:647
 #, c-format
 msgid "%s:  couldn't stat source \"%s\"\n"
 msgstr "%s: nie udało się wykonać stat na źródle \"%s\"\n"
 
-#: .././copy/xfs_copy.c:598
+#: .././copy/xfs_copy.c:657
 #, c-format
 msgid "%s: Cannot set direct I/O flag on \"%s\".\n"
 msgstr "%s: Nie można ustawić flagi bezpośredniego we/wy na \"%s\".\n"
 
-#: .././copy/xfs_copy.c:603
+#: .././copy/xfs_copy.c:662
 #, c-format
 msgid "%s: xfsctl on file \"%s\" failed.\n"
 msgstr "%s: xfsctl na pliku \"%s\" nie powiodło się.\n"
 
-#: .././copy/xfs_copy.c:626
+#: .././copy/xfs_copy.c:685
 #, c-format
 msgid "%s:  Warning -- a filesystem is mounted on the source device.\n"
-msgstr "%s: Uwaga - system plików jest podmontowany na urządzeniu źródłowym.\n"
+msgstr "%s: Uwaga - system plików jest zamontowany na urządzeniu źródłowym.\n"
 
-#: .././copy/xfs_copy.c:629
+#: .././copy/xfs_copy.c:688
 msgid "\t\tGenerated copies may be corrupt unless the source is\n"
 msgstr "\t\tWygenerowane kopie mogą być uszkodzone o ile źródło nie jest\n"
 
-#: .././copy/xfs_copy.c:631
+#: .././copy/xfs_copy.c:690
 msgid "\t\tunmounted or mounted read-only.  Copy proceeding...\n"
-msgstr "\t\todmontowane lub podmontowane tylko do odczytu. Kopiowanie w trakcie...\n"
+msgstr ""
+"\t\todmontowane lub zamontowane tylko do odczytu. Kopiowanie w trakcie...\n"
 
-#: .././copy/xfs_copy.c:648
+#: .././copy/xfs_copy.c:707
 #, c-format
 msgid ""
 "%s: couldn't initialize XFS library\n"
@@ -184,12 +185,7 @@ msgstr ""
 "%s: nie udało się zainicjować biblioteki XFS\n"
 "%s: Przerwano.\n"
 
-#: .././copy/xfs_copy.c:668
-#, c-format
-msgid "%s: Cannot yet copy V5 fs without '-d'\n"
-msgstr "%s: Nie można jeszcze kopiować systemu plików V5 bez '-d'\n"
-
-#: .././copy/xfs_copy.c:674
+#: .././copy/xfs_copy.c:731
 #, c-format
 msgid ""
 "%s: %s filesystem failed to initialize\n"
@@ -198,7 +194,7 @@ msgstr ""
 "%s: Nie powiodła się inicjalizacja systemu plików %s\n"
 "%s: Przerwano.\n"
 
-#: .././copy/xfs_copy.c:678
+#: .././copy/xfs_copy.c:735
 #, c-format
 msgid ""
 "%s %s filesystem failed to initialize\n"
@@ -207,7 +203,7 @@ msgstr ""
 "%s: Nie powiodła się inicjalizacja systemu plików %s\n"
 "%s: Przerwano.\n"
 
-#: .././copy/xfs_copy.c:682
+#: .././copy/xfs_copy.c:739
 #, c-format
 msgid ""
 "%s: %s has an external log.\n"
@@ -216,7 +212,7 @@ msgstr ""
 "%s: %s ma zewnętrzny log.\n"
 "%s: Przerwano.\n"
 
-#: .././copy/xfs_copy.c:686
+#: .././copy/xfs_copy.c:743
 #, c-format
 msgid ""
 "%s: %s has a real-time section.\n"
@@ -225,7 +221,25 @@ msgstr ""
 "%s: %s ma sekcję real-time.\n"
 "%s: Przerwano.\n"
 
-#: .././copy/xfs_copy.c:711
+#: .././copy/xfs_copy.c:762
+msgid ""
+"Error: source filesystem log is dirty. Mount the filesystem to replay the\n"
+"log, unmount and retry xfs_copy.\n"
+msgstr ""
+"Błąd: log źródłowego systemu plików jest brudny. Należy zamontować system\n"
+"plików, aby odtworzyć log, odmontować i ponownie spróbować xfs_copy.\n"
+
+#: .././copy/xfs_copy.c:767
+msgid ""
+"Error: could not determine the log head or tail of the source filesystem.\n"
+"Mount the filesystem to replay the log or run xfs_repair.\n"
+msgstr ""
+"Błąd: nie udało się określić początku lub końca logu źródłowego systemu "
+"plików.\n"
+"Należy zamontować system plików, aby odtworzyć log, albo uruchomić "
+"xfs_repair.\n"
+
+#: .././copy/xfs_copy.c:783
 msgid ""
 "Error:  filesystem block size is smaller than the disk sectorsize.\n"
 "Aborting XFS copy now.\n"
@@ -233,90 +247,90 @@ msgstr ""
 "Błąd: rozmiar bloku systemu plików jest mniejszy niż rozmiar sektora dysku.\n"
 "Przerwano XFS copy.\n"
 
-#: .././copy/xfs_copy.c:732
+#: .././copy/xfs_copy.c:800
 #, c-format
 msgid "Creating file %s\n"
 msgstr "Tworzenie pliku %s\n"
 
-#: .././copy/xfs_copy.c:750
+#: .././copy/xfs_copy.c:818
 #, c-format
 msgid ""
 "%s:  a filesystem is mounted on target device \"%s\".\n"
 "%s cannot copy to mounted filesystems.  Aborting\n"
 msgstr ""
-"%s: na urządzeniu docelowym \"%s\" jest podmontowany system plików.\n"
-"%s nie może kopiować na podmontowane systemy plików. Przerwano.\n"
+"%s: na urządzeniu docelowym \"%s\" jest zamontowany system plików.\n"
+"%s nie może kopiować na zamontowane systemy plików. Przerwano.\n"
 
-#: .././copy/xfs_copy.c:761
+#: .././copy/xfs_copy.c:829
 #, c-format
 msgid "%s:  couldn't open target \"%s\"\n"
 msgstr "%s: nie udało się otworzyć celu \"%s\"\n"
 
-#: .././copy/xfs_copy.c:771
+#: .././copy/xfs_copy.c:839
 #, c-format
 msgid "%s:  cannot grow data section.\n"
 msgstr "%s: nie można powiększyć sekcji danych.\n"
 
-#: .././copy/xfs_copy.c:779
+#: .././copy/xfs_copy.c:847
 #, c-format
 msgid "%s:  xfsctl on \"%s\" failed.\n"
 msgstr "%s: xfsctl na \"%s\" nie powiodło się.\n"
 
-#: .././copy/xfs_copy.c:798
+#: .././copy/xfs_copy.c:866
 #, c-format
 msgid "%s:  failed to write last block\n"
 msgstr "%s: nie udało się zapisać ostatniego bloku\n"
 
-#: .././copy/xfs_copy.c:800
+#: .././copy/xfs_copy.c:868
 #, c-format
 msgid "\tIs target \"%s\" too small?\n"
 msgstr "\tCzy cel \"%s\" jest zbyt mały?\n"
 
-#: .././copy/xfs_copy.c:810
+#: .././copy/xfs_copy.c:878
 msgid "Couldn't initialize global thread mask\n"
 msgstr "Nie udało się zainicjować globalnej maski wątków\n"
 
-#: .././copy/xfs_copy.c:817
+#: .././copy/xfs_copy.c:885
 msgid "Error initializing wbuf 0\n"
 msgstr "Błąd inicjalizacji wbuf 0\n"
 
-#: .././copy/xfs_copy.c:825
+#: .././copy/xfs_copy.c:893
 msgid "Error initializing btree buf 1\n"
 msgstr "Błąd inicjalizacji btree buf 1\n"
 
-#: .././copy/xfs_copy.c:830
+#: .././copy/xfs_copy.c:898
 msgid "Error creating first semaphore.\n"
 msgstr "Błąd tworzenia pierwszego semafora.\n"
 
-#: .././copy/xfs_copy.c:845
+#: .././copy/xfs_copy.c:913
 msgid "Couldn't malloc space for thread args\n"
 msgstr "Nie udało się przydzielić miejsca na argumenty wątku\n"
 
-#: .././copy/xfs_copy.c:857
+#: .././copy/xfs_copy.c:925
 #, c-format
 msgid "Error creating thread mutex %d\n"
 msgstr "Błąd podczas tworzenia sekcji krytycznej %d wątku\n"
 
-#: .././copy/xfs_copy.c:874
+#: .././copy/xfs_copy.c:942
 #, c-format
 msgid "Error creating thread for target %d\n"
 msgstr "Błąd podczas tworzenia wątku dla celu %d\n"
 
-#: .././copy/xfs_copy.c:928
+#: .././copy/xfs_copy.c:996
 #, c-format
 msgid "Error: current level %d >= btree levels %d\n"
 msgstr "Błąd: bieżący poziom %d >= poziomów b-drzewa %d\n"
 
-#: .././copy/xfs_copy.c:947
+#: .././copy/xfs_copy.c:1015
 #, c-format
 msgid "Bad btree magic 0x%x\n"
 msgstr "Niewłaściwa liczba magiczna b-drzewa 0x%x\n"
 
-#: .././copy/xfs_copy.c:974
+#: .././copy/xfs_copy.c:1042
 msgid "WARNING:  source filesystem inconsistent.\n"
 msgstr "UWAGA: źródłowy system plików niespójny.\n"
 
-#: .././copy/xfs_copy.c:976
+#: .././copy/xfs_copy.c:1044
 msgid "  A leaf btree rec isn't a leaf.  Aborting now.\n"
 msgstr " Liść rekordu b-drzewa nie jest liściem. Przerwano.\n"
 
@@ -341,7 +355,8 @@ msgid ""
 "\n"
 msgstr ""
 "\n"
-" 'addr' wykorzystuje podane pole do ustawienia adresu w systemie plików i typu\n"
+" 'addr' wykorzystuje podane pole do ustawienia adresu w systemie plików i "
+"typu\n"
 "\n"
 " Przykłady:\n"
 "\n"
@@ -351,7 +366,8 @@ msgstr ""
 "\n"
 
 #: .././db/addr.c:72 .././db/attrset.c:86 .././db/attrset.c:189
-#: .././db/print.c:74 .././db/type.c:142 .././db/write.c:101
+#: .././db/btdump.c:240 .././db/crc.c:76 .././db/print.c:74 .././db/type.c:208
+#: .././db/write.c:110
 msgid "no current type\n"
 msgstr "brak bieżącego typu\n"
 
@@ -374,7 +390,7 @@ msgstr "brak następnego typu dla pola %
 msgid "no addr function for field %s (type %s)\n"
 msgstr "brak funkcji addr dla pola %s (typu %s)\n"
 
-#: .././db/agf.c:35 .././db/agfl.c:36 .././db/agi.c:35 .././db/sb.c:42
+#: .././db/agf.c:35 .././db/agfl.c:36 .././db/agi.c:35 .././db/sb.c:44
 msgid "[agno]"
 msgstr "[agno]"
 
@@ -382,7 +398,7 @@ msgstr "[agno]"
 msgid "set address to agf header"
 msgstr "ustawienie adresu na nagłówek agf"
 
-#: .././db/agf.c:82
+#: .././db/agf.c:100
 msgid ""
 "\n"
 " set allocation group free block list\n"
@@ -408,7 +424,7 @@ msgstr ""
 " b-drzewo 'cnt' śledzi wolne miejsce indeksowane rozmiarem sekcji\n"
 " b-drzewo 'bno' śledzi sekcje wolnego miejsca indeksowane numerem bloku.\n"
 
-#: .././db/agf.c:107 .././db/agfl.c:106 .././db/agi.c:94 .././db/sb.c:163
+#: .././db/agf.c:125 .././db/agfl.c:106 .././db/agi.c:94 .././db/sb.c:167
 #, c-format
 msgid "bad allocation group number %s\n"
 msgstr "błędny numer grupy alokacji %s\n"
@@ -439,7 +455,8 @@ msgstr ""
 " agfl 5\n"
 " Położona w 4. sektorze każdej grupy alokacji lista wolnego miejsca agfl\n"
 " służąca do wewnętrznego przydzielania miejsca dla b-drzew jest utrzymywana\n"
-" dla każdej grupy alokacji. Działa jako zarezerwowana pula miejsca oddzielona\n"
+" dla każdej grupy alokacji. Działa jako zarezerwowana pula miejsca "
+"oddzielona\n"
 " od ogólnego wolnego miejsca w systemie plików (nie używana dla danych\n"
 " użytkownika).\n"
 "\n"
@@ -467,9 +484,11 @@ msgstr ""
 "\n"
 " Przykład:\n"
 "\n"
-" agi 3 (ustawienie położenia na b-drzewo i-węzła 3. grupy alokacji i typu na 'agi')\n"
+" agi 3 (ustawienie położenia na b-drzewo i-węzła 3. grupy alokacji i typu na "
+"'agi')\n"
 "\n"
-" Położone w 3. 512-bajtowym bloku każdej grupy alokacji, b-drzewo i-węzła agi\n"
+" Położone w 3. 512-bajtowym bloku każdej grupy alokacji, b-drzewo i-węzła "
+"agi\n"
 " śledzi wszystkie używane i wolne i-węzły w grupie alokacji.\n"
 " I-węzły są przydzielane w 16k porcjach (chunk), każdy wpis b-drzewa śledzi\n"
 " jedną.\n"
@@ -518,7 +537,8 @@ msgid ""
 "\n"
 msgstr ""
 "\n"
-" Polecenia 'attr_set' i 'attr_remove' udostępniają interfejsy do diagnostyki\n"
+" Polecenia 'attr_set' i 'attr_remove' udostępniają interfejsy do "
+"diagnostyki\n"
 " kodu przydzielania i usuwania rozszerzonych atrybutów.\n"
 " Oba polecenia wymagają podania nazwy atrybutu, a polecenie attr_set\n"
 " pozwala dodatkowo podać opcjonalną długość wartości (-v).\n"
@@ -528,9 +548,12 @@ msgstr ""
 "  -s - 'secure'\n"
 "\n"
 " Dla attr_set poniższe opcje określają rodzaj operacji ustawiania:\n"
-"  -C - 'create'  - utworzenie atrybutu; nie powiedzie się, jeśli już istnieje\n"
-"  -R - 'replace' - zastąpienie atrybutu; nie powiedzie się, jeśli nie istnieje\n"
-" Możliwa jest także emulacja trybu kompatybilności wstecznej 'noattr2' (-n).\n"
+"  -C - 'create'  - utworzenie atrybutu; nie powiedzie się, jeśli już "
+"istnieje\n"
+"  -R - 'replace' - zastąpienie atrybutu; nie powiedzie się, jeśli nie "
+"istnieje\n"
+" Możliwa jest także emulacja trybu kompatybilności wstecznej 'noattr2' (-"
+"n).\n"
 "\n"
 
 #: .././db/attrset.c:90 .././db/attrset.c:193
@@ -620,7 +643,8 @@ msgstr ""
 " Przykład:\n"
 "\n"
 " 'ablock 23' ustawia pozycję w pliku na 23. blok systemu plików w gałęzi\n"
-" atrybutów i-węzła. Rozmiar bloku systemu plików jest określony w superbloku.\n"
+" atrybutów i-węzła. Rozmiar bloku systemu plików jest określony w "
+"superbloku.\n"
 "\n"
 
 #: .././db/block.c:82 .././db/block.c:177
@@ -721,7 +745,7 @@ msgstr "[-ad] [blok [długość]]"
 msgid "show block map for current file"
 msgstr "pokazanie mapy bloków dla bieżącego pliku"
 
-#: .././db/bmap.c:152 .././db/inode.c:417
+#: .././db/bmap.c:152 .././db/inode.c:424
 msgid "no current inode\n"
 msgstr "brak bieżącego i-węzła\n"
 
@@ -744,987 +768,1158 @@ msgstr "błędna długość dla bmap %s\
 msgid "%s offset %lld startblock %llu (%u/%u) count %llu flag %u\n"
 msgstr "%s oofset %lld blok-pocz %llu (%u/%u) liczba %llu flaga %u\n"
 
-#: .././db/bmap.c:215 .././db/check.c:2136 .././db/check.c:2148
-#: .././db/check.c:2175 .././repair/dinode.c:50
+#: .././db/bmap.c:215 .././db/check.c:2224 .././db/check.c:2236
+#: .././db/check.c:2263 .././repair/dinode.c:52
 msgid "data"
 msgstr "danych"
 
-#: .././db/bmap.c:215 .././db/check.c:2136 .././db/check.c:2148
-#: .././db/check.c:2175 .././repair/dinode.c:51
+#: .././db/bmap.c:215 .././db/check.c:2224 .././db/check.c:2236
+#: .././db/check.c:2263 .././repair/dinode.c:53
 msgid "attr"
 msgstr "atrybutów"
 
-#: .././db/check.c:362
+#: .././db/btblock.c:164
+#, c-format
+msgid "Bad btree magic 0x%x; coercing to %s.\n"
+msgstr "Niewłaściwa liczba magiczna b-drzewa 0x%x; wymuszenie na %s.\n"
+
+#: .././db/btdump.c:32
+msgid ""
+"\n"
+" If the cursor points to a btree block, 'btdump' dumps the btree\n"
+" downward from that block.  If the cursor points to an inode,\n"
+" the data fork btree root is selected by default.\n"
+"\n"
+" Options:\n"
+"   -a -- Display an inode's extended attribute fork btree.\n"
+"   -i -- Print internal btree nodes.\n"
+"\n"
+msgstr ""
+"\n"
+" Jeśli kursor wskazuje na blok b-drzewa, 'btdump' zrzuca b-drzewo\n"
+" poniżej tego bloku. Jeśli kursor wskazuje na i-węzeł, domyślnie\n"
+" wybierany jest korzeń b-drzewa gałęzi danych.\n"
+"\n"
+" Opcje:\n"
+"   -a - wypisanie b-drzewa gałęzi rozszerzonych atrybutów i-węzła.\n"
+"   -i - wypisanie węzłów wewnętrznych b-drzewa.\n"
+"\n"
+
+#: .././db/btdump.c:92
+#, c-format
+msgid "%s level %u block %u daddr %llu\n"
+msgstr "%s poziom %u blok %u daddr %llu\n"
+
+#: .././db/btdump.c:191
+msgid "attr fork not in btree format\n"
+msgstr "gałąź atrybutów nie jest w formacie b-drzewa\n"
+
+#: .././db/btdump.c:197
+msgid "data fork not in btree format\n"
+msgstr "gałąź danych nie jest w formacie b-drzewa\n"
+
+#: .././db/btdump.c:252
+msgid "bad option for btdump command\n"
+msgstr "błędna opcja dla polecenia btdump\n"
+
+#: .././db/btdump.c:258
+msgid "bad options for btdump command\n"
+msgstr "błędne opcje dla polecenia btdump\n"
+
+#: .././db/btdump.c:262
+msgid "attrfork flag doesn't apply here\n"
+msgstr "flaga attrfork nie ma tu zastosowania\n"
+
+#: .././db/btdump.c:280
+#, c-format
+msgid "type \"%s\" is not a btree type or inode\n"
+msgstr "typ \"%s\" nie jest typem b-drzewa ani i-węzłem\n"
+
+#: .././db/btdump.c:288
+msgid "dump btree"
+msgstr "zrzut b-drzewa"
+
+#: .././db/check.c:378
 msgid "free block usage information"
 msgstr "informacje o wykorzystaniu wolnych bloków"
 
-#: .././db/check.c:365
+#: .././db/check.c:381
 msgid "[-s|-v] [-n] [-t] [-b bno]... [-i ino] ..."
 msgstr "[-s|-v] [-n] [-t] [-b bno]... [-i ino] ..."
 
-#: .././db/check.c:366
+#: .././db/check.c:382
 msgid "get block usage and check consistency"
 msgstr "uzyskanie informacji o wykorzystaniu bloków i sprawdzenie spójności"
 
-#: .././db/check.c:369
+#: .././db/check.c:385
 msgid "[-n count] [-x minlen] [-y maxlen] [-s seed] [-0123] [-t type] ..."
 msgstr "[-n liczba] [-x minlen] [-y maxlen] [-s seed] [-0123] [-t typ] ..."
 
-#: .././db/check.c:370
+#: .././db/check.c:386
 msgid "trash randomly selected block(s)"
 msgstr "zaśmiecenie losowo wybranych bloków"
 
-#: .././db/check.c:373
+#: .././db/check.c:389
 msgid "[-n] [-c blockcount]"
 msgstr "[-n] [-c liczba-bloków]"
 
-#: .././db/check.c:374
+#: .././db/check.c:390
 msgid "print usage for current block(s)"
 msgstr "wypisanie wykorzystania bieżących bloków"
 
-#: .././db/check.c:377
+#: .././db/check.c:393
 msgid "[-s] [-i ino] ..."
 msgstr "[-s] [-i ino] ..."
 
-#: .././db/check.c:378
+#: .././db/check.c:394
 msgid "print inode-name pairs"
 msgstr "wypisanie par i-węzeł - nazwa"
 
-#: .././db/check.c:398
+#: .././db/check.c:414
 #, c-format
 msgid "-i %lld bad inode number\n"
 msgstr "-i %lld - błędny numer i-węzła\n"
 
-#: .././db/check.c:410
+#: .././db/check.c:426
 #, c-format
 msgid "inode %lld add link, now %u\n"
 msgstr "i-węzeł %lld - dodano dowiązanie, teraz %u\n"
 
-#: .././db/check.c:437
+#: .././db/check.c:453
 #, c-format
 msgid "inode %lld parent %lld\n"
 msgstr "i-węzeł %lld - rodzic %lld\n"
 
-#: .././db/check.c:750
+#: .././db/check.c:766
 msgid "block usage information not allocated\n"
 msgstr "informacja o wykorzystaniu bloków nie przydzielona\n"
 
-#: .././db/check.c:788
+#: .././db/check.c:804
 msgid "already have block usage information\n"
 msgstr "już istnieje informacja o wykorzystaniu bloków\n"
 
-#: .././db/check.c:818 .././db/check.c:926
+#: .././db/check.c:821 .././db/check.c:922
 msgid "WARNING: this may be a newer XFS filesystem.\n"
 msgstr "UWAGA: to może być nowszy system plików XFS.\n"
 
-#: .././db/check.c:854
+#: .././db/check.c:857
 #, c-format
 msgid "sb_icount %lld, counted %lld\n"
 msgstr "sb_icount %lld, naliczono %lld\n"
 
-#: .././db/check.c:860
+#: .././db/check.c:863
 #, c-format
 msgid "sb_ifree %lld, counted %lld\n"
 msgstr "sb_ifree %lld, naliczono %lld\n"
 
-#: .././db/check.c:866
+#: .././db/check.c:869
 #, c-format
 msgid "sb_fdblocks %lld, counted %lld\n"
 msgstr "sb_fdblocks %lld, naliczono %lld\n"
 
-#: .././db/check.c:872
+#: .././db/check.c:875
 #, c-format
 msgid "sb_fdblocks %lld, aggregate AGF count %lld\n"
 msgstr "sb_fdblocks %lld, łączny licznik AGF %lld\n"
 
-#: .././db/check.c:878
+#: .././db/check.c:881
 #, c-format
 msgid "sb_frextents %lld, counted %lld\n"
 msgstr "sb_frextents %lld, naliczono %lld\n"
 
-#: .././db/check.c:885
+#: .././db/check.c:888
 #, c-format
 msgid "sb_features2 (0x%x) not same as sb_bad_features2 (0x%x)\n"
 msgstr "sb_features2 (0x%x) różni się od sb_bad_features2 (0x%x)\n"
 
-#: .././db/check.c:894
+#: .././db/check.c:897
 #, c-format
 msgid "sb versionnum missing attr bit %x\n"
 msgstr "sb versionnum - brak bitu atrybutu %x\n"
 
-#: .././db/check.c:901
-#, c-format
-msgid "sb versionnum missing nlink bit %x\n"
-msgstr "sb versionnum - brak bitu nlink %x\n"
-
-#: .././db/check.c:908
+#: .././db/check.c:904
 #, c-format
 msgid "sb versionnum missing quota bit %x\n"
 msgstr "sb versionnum - brak bitu quota %x\n"
 
-#: .././db/check.c:915
+#: .././db/check.c:911
 #, c-format
 msgid "sb versionnum extra align bit %x\n"
 msgstr "sb versionnum - nadmiarowy bit align %x\n"
 
-#: .././db/check.c:955
+#: .././db/check.c:950
 msgid "zeroed"
 msgstr "wyzerowano"
 
-#: .././db/check.c:955
+#: .././db/check.c:950
 msgid "set"
 msgstr "ustawiono"
 
-#: .././db/check.c:955
+#: .././db/check.c:950
 msgid "flipped"
 msgstr "przełączono"
 
-#: .././db/check.c:955
+#: .././db/check.c:950
 msgid "randomized"
 msgstr "ulosowiono"
 
-#: .././db/check.c:965
+#: .././db/check.c:958
+#, c-format
+msgid "zero-length block %u/%u buffer to trash??\n"
+msgstr "blok zerowej długości %u/%u bufor do zaśmiecenia???\n"
+
+#: .././db/check.c:977
 #, c-format
 msgid "can't read block %u/%u for trashing\n"
 msgstr "nie można odczytać bloku %u/%u w celu zaśmiecenia\n"
 
-#: .././db/check.c:995
+#: .././db/check.c:1006
 #, c-format
 msgid "blocktrash: %u/%u %s block %d bit%s starting %d:%d %s\n"
 msgstr "blocktrash: %u/%u %s blok %d bit%s początek %d:%d %s\n"
 
-#: .././db/check.c:1027 .././db/check.c:1185
-msgid "must run blockget first\n"
-msgstr "najpierw trzeba wykonać blockget\n"
-
-#: .././db/check.c:1071
+#: .././db/check.c:1085
 #, c-format
 msgid "bad blocktrash count %s\n"
 msgstr "błędna liczba bloków do zaśmiecenia %s\n"
 
-#: .././db/check.c:1085
+#: .././db/check.c:1097
+#, c-format
+msgid "bad blocktrash offset %s\n"
+msgstr "błędny offset bloków do zaśmiecenia %s\n"
+
+#: .././db/check.c:1114
 #, c-format
 msgid "bad blocktrash type %s\n"
 msgstr "błędny typ zaśmiecania %s\n"
 
-#: .././db/check.c:1094
+#: .././db/check.c:1123
 #, c-format
 msgid "bad blocktrash min %s\n"
 msgstr "błędny początek zaśmiecania %s\n"
 
-#: .././db/check.c:1102
+#: .././db/check.c:1131
 #, c-format
 msgid "bad blocktrash max %s\n"
 msgstr "błędny koniec zaśmiecania %s\n"
 
-#: .././db/check.c:1107
+#: .././db/check.c:1139
 msgid "bad option for blocktrash command\n"
 msgstr "błędna opcja polecenia blocktrash\n"
 
-#: .././db/check.c:1112
+#: .././db/check.c:1144 .././db/check.c:1235
+msgid "must run blockget first\n"
+msgstr "najpierw trzeba wykonać blockget\n"
+
+#: .././db/check.c:1148
+msgid "nothing on stack\n"
+msgstr "nie ma nic na stosie\n"
+
+#: .././db/check.c:1152
 msgid "bad min/max for blocktrash command\n"
 msgstr "błędny początek/koniec polecenia blocktrash\n"
 
-#: .././db/check.c:1138
-msgid "blocktrash: no matching blocks\n"
-msgstr "blocktrash: brak pasujących bloków\n"
-
-#: .././db/check.c:1142
+#: .././db/check.c:1170
 #, c-format
 msgid "blocktrash: seed %u\n"
 msgstr "blocktash: zarodek %u\n"
 
-#: .././db/check.c:1200
+#: .././db/check.c:1186
+msgid "blocktrash: no matching blocks\n"
+msgstr "blocktrash: brak pasujących bloków\n"
+
+#: .././db/check.c:1250
 #, c-format
 msgid "bad blockuse count %s\n"
 msgstr "błędna liczba bloków dla blockuse: %s\n"
 
-#: .././db/check.c:1206 .././db/check.c:1892
+#: .././db/check.c:1256 .././db/check.c:1980
 msgid "must run blockget -n first\n"
 msgstr "najpierw trzeba wykonać blockget -n\n"
 
-#: .././db/check.c:1212
+#: .././db/check.c:1262
 msgid "bad option for blockuse command\n"
 msgstr "błędna opcja dla polecenia blockuse\n"
 
-#: .././db/check.c:1219
+#: .././db/check.c:1269
 #, c-format
 msgid "block %llu (%u/%u) type %s"
 msgstr "blok %llu (%u/%u) typu %s"
 
-#: .././db/check.c:1223
+#: .././db/check.c:1273
 #, c-format
 msgid " inode %lld"
 msgstr " i-węzeł %lld"
 
-#: .././db/check.c:1261
+#: .././db/check.c:1317
 #, c-format
 msgid "block %u/%u expected type %s got %s\n"
 msgstr "blok %u/%u: oczekiwano typu %s, otrzymano %s\n"
 
-#: .././db/check.c:1293
+#: .././db/check.c:1350
 #, c-format
 msgid "blocks %u/%u..%u claimed by inode %lld\n"
 msgstr "blok %u/%u..%u przypisany do i-węzła %lld\n"
 
-#: .././db/check.c:1301
+#: .././db/check.c:1358
 #, c-format
 msgid "block %u/%u claimed by inode %lld, previous inum %lld\n"
 msgstr "blok %u/%u przypisany do i-węzła %lld, poprzedni inum %lld\n"
 
-#: .././db/check.c:1330
+#: .././db/check.c:1387
 #, c-format
 msgid "link count mismatch for inode %lld (name %s), nlink %d, counted %d\n"
-msgstr "niezgodność liczby dowiązań dla i-węzła %lld (nazwa %s), nlink %d, naliczono %d\n"
+msgstr ""
+"niezgodność liczby dowiązań dla i-węzła %lld (nazwa %s), nlink %d, naliczono "
+"%d\n"
 
-#: .././db/check.c:1338
+#: .././db/check.c:1395
 #, c-format
 msgid "disconnected inode %lld, nlink %d\n"
 msgstr "odłączony i-węzeł %lld, nlink %d\n"
 
-#: .././db/check.c:1342
+#: .././db/check.c:1399
 #, c-format
 msgid "allocated inode %lld has 0 link count\n"
 msgstr "przydzielony i-węzeł %lld ma zerową liczbę dowiązań\n"
 
-#: .././db/check.c:1352
+#: .././db/check.c:1409
 #, c-format
 msgid "inode %lld name %s\n"
 msgstr "i-węzeł %lld o nazwie %s\n"
 
-#: .././db/check.c:1386 .././db/check.c:1401
+#: .././db/check.c:1443 .././db/check.c:1458
 #, c-format
 msgid "block %u/%u out of range\n"
 msgstr "blok %u/%u poza zakresem\n"
 
-#: .././db/check.c:1389 .././db/check.c:1404
+#: .././db/check.c:1446 .././db/check.c:1461
 #, c-format
 msgid "blocks %u/%u..%u out of range\n"
 msgstr "bloki %u/%u..%u poza zakresem\n"
 
-#: .././db/check.c:1427
+#: .././db/check.c:1484
 #, c-format
 msgid "rtblock %llu expected type %s got %s\n"
 msgstr "rtblok %llu - oczekiwano typu %s, otrzymano %s\n"
 
-#: .././db/check.c:1447
+#: .././db/check.c:1504
 #, c-format
 msgid "rtblocks %llu..%llu claimed by inode %lld\n"
 msgstr "rtbloki %llu..%llu przypisane do i-węzła %lld\n"
 
-#: .././db/check.c:1456
+#: .././db/check.c:1513
 #, c-format
 msgid "rtblock %llu claimed by inode %lld, previous inum %lld\n"
-msgstr "rtblok %llu przypisany do i-węzłą %lld, poprzedni inum %lld\n"
+msgstr "rtblok %llu przypisany do i-węzła %lld, poprzedni inum %lld\n"
 
-#: .././db/check.c:1474
+#: .././db/check.c:1531
 #, c-format
 msgid "root inode %lld is missing\n"
 msgstr "brak głównego i-węzła %lld\n"
 
-#: .././db/check.c:1479
+#: .././db/check.c:1536
 #, c-format
 msgid "root inode %lld is not a directory\n"
 msgstr "główny i-węzeł %lld nie jest katalogiem\n"
 
-#: .././db/check.c:1495
+#: .././db/check.c:1552
 #, c-format
 msgid "rtblock %llu out of range\n"
 msgstr "rtblok %llu poza zakresem\n"
 
-#: .././db/check.c:1519
+#: .././db/check.c:1596
 #, c-format
 msgid "blocks %u/%u..%u claimed by block %u/%u\n"
 msgstr "bloki %u/%u..%u przypisane do bloku %u/%u\n"
 
-#: .././db/check.c:1528
+#: .././db/check.c:1610
 #, c-format
 msgid "setting block %u/%u to %s\n"
 msgstr "ustawianie bloku %u/%u na %s\n"
 
-#: .././db/check.c:1551
+#: .././db/check.c:1633
 #, c-format
 msgid "setting rtblock %llu to %s\n"
 msgstr "ustawianie rtbloku %llu na %s\n"
 
-#: .././db/check.c:1572 .././repair/rt.c:151
+#: .././db/check.c:1654 .././repair/rt.c:151
 #, c-format
 msgid "rt summary mismatch, size %d block %llu, file: %d, computed: %d\n"
-msgstr "opis rt nie zgadza się, rozmiar %d bloku %llu, plik: %d, obliczono: %d\n"
+msgstr ""
+"opis rt nie zgadza się, rozmiar %d bloku %llu, plik: %d, obliczono: %d\n"
 
-#: .././db/check.c:1597
+#: .././db/check.c:1679
 #, c-format
 msgid "block %u/%u type %s not expected\n"
 msgstr "blok %u/%u typu %s nie oczekiwany\n"
 
-#: .././db/check.c:1618
+#: .././db/check.c:1700
 #, c-format
 msgid "rtblock %llu type %s not expected\n"
 msgstr "rtblok %llu typu %s nie oczekiwany\n"
 
-#: .././db/check.c:1655
+#: .././db/check.c:1737
 #, c-format
 msgid "dir ino %lld missing leaf entry for %x/%x\n"
 msgstr "i-węzeł katalogu %lld - brak wpisu liścia dla %x/%x\n"
 
-#: .././db/check.c:1774
+#: .././db/check.c:1856
 #, c-format
 msgid "bad superblock magic number %x, giving up\n"
 msgstr "błędna liczba magiczna superbloku %x, poddaję się\n"
 
-#: .././db/check.c:1828
+#: .././db/check.c:1910
 msgid "bad option for blockget command\n"
 msgstr "błędna opcja dla polecenia blockget\n"
 
-#: .././db/check.c:1909
+#: .././db/check.c:1997
 #, c-format
 msgid "bad option -%c for ncheck command\n"
 msgstr "błędna opcja -%c dla polecenia ncheck\n"
 
-#: .././db/check.c:1983
+#: .././db/check.c:2071
 #, c-format
 msgid "block 0 for directory inode %lld is missing\n"
 msgstr "brak bloku 0 dla i-węzła katalogu %lld\n"
 
-#: .././db/check.c:2003
+#: .././db/check.c:2091
 #, c-format
 msgid "can't read block 0 for directory inode %lld\n"
 msgstr "nie można odczytać bloku 0 dla i-węzła katalogu %lld\n"
 
-#: .././db/check.c:2049
+#: .././db/check.c:2137
 #, c-format
 msgid "inode %lld extent [%lld,%lld,%lld,%d]\n"
 msgstr "ekstent i-węzła %lld [%lld,%lld,%lld,%d]\n"
 
-#: .././db/check.c:2052
+#: .././db/check.c:2140
 #, c-format
 msgid "bmap rec out of order, inode %lld entry %d\n"
 msgstr "błędna kolejność bmap rec - i-węzeł %lld, wpis %d\n"
 
-#: .././db/check.c:2058
+#: .././db/check.c:2146
 #, c-format
 msgid "inode %lld bad rt block number %lld, offset %lld\n"
 msgstr "i-węzeł %lld - błędny numer bloku rt %lld, offset %lld\n"
 
-#: .././db/check.c:2068 .././db/check.c:2074
+#: .././db/check.c:2156 .././db/check.c:2162
 #, c-format
 msgid "inode %lld bad block number %lld [%d,%d], offset %lld\n"
 msgstr "i-węzeł %lld - błędny numer bloku %lld [%d,%d], offset %lld\n"
 
-#: .././db/check.c:2092 .././db/check.c:2106
+#: .././db/check.c:2180 .././db/check.c:2194
 #, c-format
 msgid "inode %lld block %lld at offset %lld\n"
 msgstr "i-węzeł %lld: blok %lld pod offsetem %lld\n"
 
-#: .././db/check.c:2133
+#: .././db/check.c:2221
 #, c-format
 msgid "level for ino %lld %s fork bmap root too large (%u)\n"
-msgstr "i-węzeł %lld: poziom bmap root odgałęzienia %s zbyt duży (%u)\n"
+msgstr "i-węzeł %lld: poziom bmap root gałęzi %s zbyt duży (%u)\n"
 
-#: .././db/check.c:2145
+#: .././db/check.c:2233
 #, c-format
 msgid "numrecs for ino %lld %s fork bmap root too large (%u)\n"
-msgstr "i-węzeł %lld: liczba rekordów bmap root odgałęzienia %s zbyt duża (%u)\n"
+msgstr ""
+"i-węzeł %lld: liczba rekordów bmap root gałęzi %s zbyt duża (%u)\n"
 
-#: .././db/check.c:2172
+#: .././db/check.c:2260
 #, c-format
 msgid "extent count for ino %lld %s fork too low (%d) for file format\n"
-msgstr "i-węzeł %lld: liczba ekstentów dla odgałęzienia %s zbyt mała (%d) dla formatu pliku\n"
+msgstr ""
+"i-węzeł %lld: liczba ekstentów dla gałęzi %s zbyt mała (%d) dla "
+"formatu pliku\n"
 
-#: .././db/check.c:2222 .././db/check.c:3153
+#: .././db/check.c:2312 .././db/check.c:3338
 #, c-format
 msgid "bad directory data magic # %#x for dir ino %lld block %d\n"
-msgstr "błędna liczba magiczna danych katalogu %#x dla i-węzła katalogu %lld, blok %d\n"
+msgstr ""
+"błędna liczba magiczna danych katalogu %#x dla i-węzła katalogu %lld, blok "
+"%d\n"
 
-#: .././db/check.c:2239
+#: .././db/check.c:2330
 #, c-format
 msgid "bad block directory tail for dir ino %lld\n"
 msgstr "błędny koniec katalogu bloku dla i-węzła katalogu %lld\n"
 
-#: .././db/check.c:2284
+#: .././db/check.c:2375
 #, c-format
 msgid "dir %lld block %d bad free entry at %d\n"
 msgstr "katalog %lld, blok %d: błędny wolny wpis pod %d\n"
 
-#: .././db/check.c:2308
+#: .././db/check.c:2399
 #, c-format
 msgid "dir %lld block %d zero length entry at %d\n"
 msgstr "katalog %lld, blok %d: wpis zerowej długości pod %d\n"
 
-#: .././db/check.c:2317
+#: .././db/check.c:2408
 #, c-format
 msgid "dir %lld block %d bad entry at %d\n"
 msgstr "katalog %lld, blok %d: błędny wpis pod %d\n"
 
-#: .././db/check.c:2335
+#: .././db/check.c:2426
 #, c-format
 msgid "dir %lld block %d entry %*.*s %lld\n"
 msgstr "katalog %lld, blok %d, wpis %*.*s %lld\n"
 
-#: .././db/check.c:2342
+#: .././db/check.c:2433
 #, c-format
 msgid "dir %lld block %d entry %*.*s bad inode number %lld\n"
 msgstr "katalog %lld, blokd %d, epis %*.*s: błędny number i-węzła %lld\n"
 
-#: .././db/check.c:2352
+#: .././db/check.c:2443
 #, c-format
 msgid "multiple .. entries in dir %lld (%lld, %lld)\n"
 msgstr "wiele wpisów .. w katalogu %lld (%lld, %lld)\n"
 
-#: .././db/check.c:2369
+#: .././db/check.c:2460
 #, c-format
 msgid "dir %lld entry . inode number mismatch (%lld)\n"
 msgstr "katalog %lld, wpis .: niezgodność numeru i-węzła (%lld)\n"
 
-#: .././db/check.c:2382
+#: .././db/check.c:2474
 #, c-format
 msgid "dir %lld block %d bad count %u\n"
 msgstr "katalog %lld, blok %d: błędny licznik %u\n"
 
-#: .././db/check.c:2393 .././db/check.c:3167
+#: .././db/check.c:2485 .././db/check.c:3352
 #, c-format
 msgid "dir %lld block %d extra leaf entry %x %x\n"
 msgstr "katalog %lld, blok %d: nadmiarowy wpis liścia %x %x\n"
 
-#: .././db/check.c:2405
+#: .././db/check.c:2497
 #, c-format
 msgid "dir %lld block %d bad bestfree data\n"
 msgstr "katalog %lld, blok %d: błędne dane bestfree\n"
 
-#: .././db/check.c:2412
+#: .././db/check.c:2505
 #, c-format
 msgid "dir %lld block %d bad block tail count %d (stale %d)\n"
 msgstr "katalog %lld, blok %d: błędny licznik końca bloku %d (stale %d)\n"
 
-#: .././db/check.c:2421
+#: .././db/check.c:2515
 #, c-format
 msgid "dir %lld block %d bad stale tail count %d\n"
 msgstr "katalog %lld, blok %d: błędny licznik końca stale %d\n"
 
-#: .././db/check.c:2427
+#: .././db/check.c:2521
 #, c-format
 msgid "dir %lld block %d consecutive free entries\n"
 msgstr "katalog %lld, blok %d: kolejne wolne wpisy\n"
 
-#: .././db/check.c:2433
+#: .././db/check.c:2527
 #, c-format
 msgid "dir %lld block %d entry/unused tag mismatch\n"
 msgstr "katalog %lld, blok %d: niezgodność znacznika wpis/nieużywany\n"
 
-#: .././db/check.c:2482
+#: .././db/check.c:2576
 #, c-format
 msgid "no . entry for directory %lld\n"
 msgstr "brak wpisu . dla katalogu %lld\n"
 
-#: .././db/check.c:2487
+#: .././db/check.c:2581
 #, c-format
 msgid "no .. entry for directory %lld\n"
 msgstr "brak wpisu .. dla katalogu %lld\n"
 
-#: .././db/check.c:2491
+#: .././db/check.c:2585
 #, c-format
 msgid ". and .. same for non-root directory %lld\n"
 msgstr ". i .. są takie same dla katalogu %lld (nie będącego głównym)\n"
 
-#: .././db/check.c:2496
+#: .././db/check.c:2590
 #, c-format
 msgid "root directory %lld has .. %lld\n"
 msgstr "główny katalog %lld ma .. %lld\n"
 
-#: .././db/check.c:2529
+#: .././db/check.c:2623
 #, c-format
 msgid "bad size (%lld) or format (%d) for directory inode %lld\n"
 msgstr "błędny rozmiar (%lld) lub format (%d) dla i-węzła katalogu %lld\n"
 
-#: .././db/check.c:2557
+#: .././db/check.c:2651
 #, c-format
 msgid "bad number of extents %d for inode %lld\n"
 msgstr "błędna liczba ekstentów %d dla i-węzła %lld\n"
 
-#: .././db/check.c:2629
+#: .././db/check.c:2723
 #, c-format
 msgid "bad magic number %#x for inode %lld\n"
 msgstr "błędna liczba magiczna %#x dla i-węzła %lld\n"
 
-#: .././db/check.c:2636
+#: .././db/check.c:2730
 #, c-format
 msgid "bad version number %#x for inode %lld\n"
 msgstr "błędny numer wersji %#x dla i-węzła %lld\n"
 
-#: .././db/check.c:2644
+#: .././db/check.c:2738
 #, c-format
 msgid "bad nblocks %lld for free inode %lld\n"
 msgstr "błędna liczba bloków %lld dla wolnego i-węzła %lld\n"
 
-#: .././db/check.c:2655
+#: .././db/check.c:2745
 #, c-format
 msgid "bad nlink %d for free inode %lld\n"
 msgstr "błądna liczba dowiązań %d dla wolnego i-węzła %lld\n"
 
-#: .././db/check.c:2661
+#: .././db/check.c:2751
 #, c-format
 msgid "bad mode %#o for free inode %lld\n"
 msgstr "błędne uprawnienia %#o dla wolnego i-węzła %lld\n"
 
-#: .././db/check.c:2670
+#: .././db/check.c:2760
 #, c-format
 msgid "bad next unlinked %#x for inode %lld\n"
 msgstr "błędny następny niedowiązany %#x dla i-węzła %lld\n"
 
-#: .././db/check.c:2680
+#: .././db/check.c:2771
 #, c-format
 msgid "bad format %d for inode %lld type %#o\n"
 msgstr "błędny format %d dla i-węzła %lld typu %#o\n"
 
-#: .././db/check.c:2688
+#: .././db/check.c:2779
 #, c-format
 msgid "bad fork offset %d for inode %lld\n"
-msgstr "błędny offset odgałęzienia %d dla i-węzła %lld\n"
+msgstr "błędny offset gałęzi %d dla i-węzła %lld\n"
 
-#: .././db/check.c:2695
+#: .././db/check.c:2786
 #, c-format
 msgid "bad attribute format %d for inode %lld\n"
 msgstr "błędny format atrybutu %d dla i-węzła %lld\n"
 
-#: .././db/check.c:2701
+#: .././db/check.c:2792
 #, c-format
-msgid "inode %lld mode %#o fmt %s afmt %s nex %d anex %d nblk %lld sz %lld%s%s%s%s%s%s%s\n"
-msgstr "i-węzeł %lld mode %#o fmt %s afmt %s nex %d anex %d nblk %lld sz %lld%s%s%s%s%s%s%s\n"
+msgid ""
+"inode %lld mode %#o fmt %s afmt %s nex %d anex %d nblk %lld sz %lld%s%s%s%s%s"
+"%s%s\n"
+msgstr ""
+"i-węzeł %lld mode %#o fmt %s afmt %s nex %d anex %d nblk %lld sz %lld%s%s%s%s"
+"%s%s%s\n"
 
-#: .././db/check.c:2822
+#: .././db/check.c:2911
 #, c-format
 msgid "bad nblocks %lld for inode %lld, counted %lld\n"
 msgstr "błędna liczba bloków %lld dla i-węzła %lld, naliczono %lld\n"
 
-#: .././db/check.c:2829
+#: .././db/check.c:2918
 #, c-format
 msgid "bad nextents %d for inode %lld, counted %d\n"
 msgstr "błędna liczba ekstentów %d dla i-węzła %lld, naliczono %d\n"
 
-#: .././db/check.c:2835
+#: .././db/check.c:2924
 #, c-format
 msgid "bad anextents %d for inode %lld, counted %d\n"
 msgstr "błędne anextents %d dla i-węzła %lld, naliczono %d\n"
 
-#: .././db/check.c:2887
+#: .././db/check.c:2976
 #, c-format
 msgid "local inode %lld data is too large (size %lld)\n"
 msgstr "dane lokalnego i-węzła %lld zbyt duże (rozmiar %lld)\n"
 
-#: .././db/check.c:2896
+#: .././db/check.c:2985
 #, c-format
 msgid "local inode %lld attr is too large (size %d)\n"
 msgstr "atrybuty lokalnego i-węzła %lld zbyt duże (rozmiar %d)\n"
 
-#: .././db/check.c:2945
+#: .././db/check.c:3034
 #, c-format
 msgid "dir inode %lld block %u=%llu\n"
 msgstr "i-węzeł katalogu %lld, blok %u=%llu\n"
 
-#: .././db/check.c:2957
+#: .././db/check.c:3046
 #, c-format
 msgid "can't read block %u for directory inode %lld\n"
 msgstr "nie można odczytać bloku %u dla i-węzła katalogu %lld\n"
 
-#: .././db/check.c:2971
+#: .././db/check.c:3060
 #, c-format
 msgid "multiple .. entries in dir %lld\n"
 msgstr "wiele wpisów .. w katalogu %lld\n"
 
-#: .././db/check.c:2993
+#: .././db/check.c:3082
 #, c-format
 msgid "missing free index for data block %d in dir ino %lld\n"
-msgstr "brak indeksu wolnego miejsca dla bloku danych %d w i-węźle katalogu %lld\n"
-
-#: .././db/check.c:3019
-#, c-format
-msgid "bad free block magic # %#x for dir ino %lld block %d\n"
-msgstr "błędna liczba magiczna wolnego bloku %#x dla i-węzła katalogu %lld, blok %d\n"
+msgstr ""
+"brak indeksu wolnego miejsca dla bloku danych %d w i-węźle katalogu %lld\n"
 
-#: .././db/check.c:3029
+#: .././db/check.c:3110 .././db/check.c:3188
 #, c-format
 msgid "bad free block firstdb %d for dir ino %lld block %d\n"
 msgstr "błędne firstdb wolnego bloku %d dla i-węzła katalogu %lld, blok %d\n"
 
-#: .././db/check.c:3042
+#: .././db/check.c:3121 .././db/check.c:3201
 #, c-format
 msgid "bad free block nvalid/nused %d/%d for dir ino %lld block %d\n"
-msgstr "błędne liczby nvalid/nused (%d/%d) wolnych bloków w i-węźle katalogu %lld, blok %d\n"
+msgstr ""
+"błędne liczby nvalid/nused (%d/%d) wolnych bloków w i-węźle katalogu %lld, "
+"blok %d\n"
 
-#: .././db/check.c:3056
+#: .././db/check.c:3135 .././db/check.c:3215
 #, c-format
 msgid "bad free block ent %d is %d should be %d for dir ino %lld block %d\n"
-msgstr "błędna liczba ent %d (równa %d, powinna być %d) wolnego bloku w i-węźle katalogu %lld, blok %d\n"
+msgstr ""
+"błędna liczba ent %d (równa %d, powinna być %d) wolnego bloku w i-węźle "
+"katalogu %lld, blok %d\n"
 
-#: .././db/check.c:3070
+#: .././db/check.c:3149 .././db/check.c:3229
 #, c-format
 msgid "bad free block nused %d should be %d for dir ino %lld block %d\n"
-msgstr "błędna liczba nused (%d, powinna być %d) wolnego bloku w i-węźle katalogu %lld, blok %d\n"
+msgstr ""
+"błędna liczba nused (%d, powinna być %d) wolnego bloku w i-węźle katalogu "
+"%lld, blok %d\n"
+
+#: .././db/check.c:3174
+#, c-format
+msgid "bad free block magic # %#x for dir ino %lld block %d\n"
+msgstr ""
+"błędna liczba magiczna wolnego bloku %#x dla i-węzła katalogu %lld, blok %d\n"
 
-#: .././db/check.c:3100
+#: .././db/check.c:3283
 #, c-format
 msgid "bad leaf block forw/back pointers %d/%d for dir ino %lld block %d\n"
-msgstr "błędne wskaźniki przód/tył (%d/%d) bloku liścia w i-węźle katalogu %lld, blok %d\n"
+msgstr ""
+"błędne wskaźniki przód/tył (%d/%d) bloku liścia w i-węźle katalogu %lld, "
+"blok %d\n"
 
-#: .././db/check.c:3109
+#: .././db/check.c:3292
 #, c-format
 msgid "single leaf block for dir ino %lld block %d should be at block %d\n"
-msgstr "blok pojedynczego liścia dla i-węzłu katalogu %lld, blok %d powinien być w bloku %d\n"
+msgstr ""
+"blok pojedynczego liścia dla i-węzłu katalogu %lld, blok %d powinien być w "
+"bloku %d\n"
 
-#: .././db/check.c:3121
+#: .././db/check.c:3304
 #, c-format
 msgid "bestfree %d for dir ino %lld block %d doesn't match table value %d\n"
-msgstr "bestfree %d dla i-węzła katalogu %lld, blok %d nie zgadza się z wartością w tablicy %d\n"
+msgstr ""
+"bestfree %d dla i-węzła katalogu %lld, blok %d nie zgadza się z wartością w "
+"tablicy %d\n"
 
-#: .././db/check.c:3144
+#: .././db/check.c:3329
 #, c-format
 msgid "bad node block level %d for dir ino %lld block %d\n"
 msgstr "błędny poziom bloku węzła %d dla i-węzła katalogu %lld, blok %d\n"
 
-#: .././db/check.c:3176
+#: .././db/check.c:3361
+#, c-format
+msgid "dir3 %lld block %d stale mismatch %d/%d\n"
+msgstr "katalog dir3 %lld, blok %d: niezgodność liczby stale %d/%d\n"
+
+#: .././db/check.c:3368
 #, c-format
 msgid "dir %lld block %d stale mismatch %d/%d\n"
 msgstr "katalog %lld, blok %d: niezgodność liczby stale %d/%d\n"
 
-#: .././db/check.c:3232
+#: .././db/check.c:3424
 #, c-format
 msgid "can't read block %lld for %s quota inode (fsblock %lld)\n"
 msgstr "nie można odczytać bloku %lld i-węzła limitów %s (blok fs %lld)\n"
 
-#: .././db/check.c:3242
+#: .././db/check.c:3434
 #, c-format
 msgid "%s dqblk %lld entry %d id %u bc %lld ic %lld rc %lld\n"
 msgstr "%s dqblk %lld wpis %d id %u bc %lld ic %lld rc %lld\n"
 
-#: .././db/check.c:3250
+#: .././db/check.c:3442
 #, c-format
 msgid "bad magic number %#x for %s dqblk %lld entry %d id %u\n"
 msgstr "błędna liczba magiczna %#x dla dqblk %s %lld, wpis %d, id %u\n"
 
-#: .././db/check.c:3259
+#: .././db/check.c:3451
 #, c-format
 msgid "bad version number %#x for %s dqblk %lld entry %d id %u\n"
 msgstr "błędny numer wersji %#x dla dqblk %s %lld, wpis %d, id %u\n"
 
-#: .././db/check.c:3269
+#: .././db/check.c:3461
 #, c-format
 msgid "bad flags %#x for %s dqblk %lld entry %d id %u\n"
 msgstr "błędne flagi %#x dla dqblk %s %lld, wpis %d, id %u\n"
 
-#: .././db/check.c:3278
+#: .././db/check.c:3470
 #, c-format
 msgid "bad id %u for %s dqblk %lld entry %d id %u\n"
 msgstr "błędne id %u dla dqblk %s %lld, wpis %d, id %u\n"
 
-#: .././db/check.c:3324
+#: .././db/check.c:3516
 #, c-format
 msgid "block %lld for rtbitmap inode is missing\n"
 msgstr "brak bloku %lld dla i-węzła rtbitmapy\n"
 
-#: .././db/check.c:3335
+#: .././db/check.c:3527
 #, c-format
 msgid "can't read block %lld for rtbitmap inode\n"
 msgstr "nie można odczytać bloku %lld dla i-węzła rtbitmapy\n"
 
-#: .././db/check.c:3391
+#: .././db/check.c:3583
 #, c-format
 msgid "block %lld for rtsummary inode is missing\n"
 msgstr "brak bloku %lld dla i-węzła rtsummary\n"
 
-#: .././db/check.c:3402
+#: .././db/check.c:3594
 #, c-format
 msgid "can't read block %lld for rtsummary inode\n"
 msgstr "nie można odczytać bloku %lld dla i-węzła rtsummary\n"
 
-#: .././db/check.c:3435
+#: .././db/check.c:3627
 #, c-format
 msgid "dir %lld entry . %lld\n"
 msgstr "katalog %lld, wpis . %lld\n"
 
-#: .././db/check.c:3443
+#: .././db/check.c:3635
 #, c-format
 msgid "dir %llu bad size in entry at %d\n"
 msgstr "katalog %llu: błędny rozmiar we wpisie przy %d\n"
 
-#: .././db/check.c:3455
+#: .././db/check.c:3647
 #, c-format
 msgid "dir %lld entry %*.*s bad inode number %lld\n"
 msgstr "katalog %lld wpis %*.*s: błędny numer i-węzła %lld\n"
 
-#: .././db/check.c:3467
+#: .././db/check.c:3659
 #, c-format
 msgid "dir %lld entry %*.*s offset %d %lld\n"
 msgstr "katalog %lld wpis %*.*s offset %d %lld\n"
 
-#: .././db/check.c:3472
+#: .././db/check.c:3664
 #, c-format
 msgid "dir %lld entry %*.*s bad offset %d\n"
 msgstr "katalog %lld wpis %*.*s błędny offset %d\n"
 
-#: .././db/check.c:3485
+#: .././db/check.c:3677
 #, c-format
 msgid "dir %llu size is %lld, should be %u\n"
 msgstr "katalog %llu: rozmiar %lld, powinien być %u\n"
 
-#: .././db/check.c:3493
+#: .././db/check.c:3685
 #, c-format
 msgid "dir %llu offsets too high\n"
 msgstr "katalog %llu: offsety zbyt duże\n"
 
-#: .././db/check.c:3504
+#: .././db/check.c:3696
 #, c-format
 msgid "dir %lld entry .. bad inode number %lld\n"
 msgstr "katalog %lld wpis .. - błędny numer i-węzła %lld\n"
 
-#: .././db/check.c:3509
+#: .././db/check.c:3701
 #, c-format
 msgid "dir %lld entry .. %lld\n"
 msgstr "katalog %lld wpis .. %lld\n"
 
-#: .././db/check.c:3512
+#: .././db/check.c:3704
 #, c-format
 msgid "dir %lld i8count mismatch is %d should be %d\n"
 msgstr "katalog %lld: niezgodność i8count: jest %d, powinno być %d\n"
 
-#: .././db/check.c:3594
+#: .././db/check.c:3786
 #, c-format
 msgid "%s quota id %u, have/exp"
 msgstr "limit %s id %u: jest/exp"
 
-#: .././db/check.c:3597
+#: .././db/check.c:3789
 #, c-format
 msgid " bc %lld/%lld"
 msgstr " bc %lld/%lld"
 
-#: .././db/check.c:3601
+#: .././db/check.c:3793
 #, c-format
 msgid " ic %lld/%lld"
 msgstr " ic %lld/%lld"
 
-#: .././db/check.c:3605
+#: .././db/check.c:3797
 #, c-format
 msgid " rc %lld/%lld"
 msgstr " rc %lld/%lld"
 
-#: .././db/check.c:3661
+#: .././db/check.c:3853
 #, c-format
 msgid "can't read superblock for ag %u\n"
 msgstr "nie można odczytać superbloku dla ag %u\n"
 
-#: .././db/check.c:3670
+#: .././db/check.c:3862
 #, c-format
 msgid "bad sb magic # %#x in ag %u\n"
 msgstr "błędna liczba magiczna %#x superbloku w ag %u\n"
 
-#: .././db/check.c:3676
+#: .././db/check.c:3868
 #, c-format
 msgid "bad sb version # %#x in ag %u\n"
 msgstr "błędny numer wersji %#x superbloku w ag %u\n"
 
-#: .././db/check.c:3686 .././db/sb.c:213
+#: .././db/check.c:3878 .././db/sb.c:217
 msgid "mkfs not completed successfully\n"
 msgstr "mkfs nie zakończony pomyślnie\n"
 
-#: .././db/check.c:3698 .././db/frag.c:366
+#: .././db/check.c:3890 .././db/frag.c:370
 #, c-format
 msgid "can't read agf block for ag %u\n"
 msgstr "nie można odczytać bloku agf dla ag %u\n"
 
-#: .././db/check.c:3704
+#: .././db/check.c:3896
 #, c-format
 msgid "bad agf magic # %#x in ag %u\n"
 msgstr "błędna liczba magiczna agf %#x w ag %u\n"
 
-#: .././db/check.c:3710
+#: .././db/check.c:3902
 #, c-format
 msgid "bad agf version # %#x in ag %u\n"
 msgstr "błędny numer wersji agf %#x w ag %u\n"
 
-#: .././db/check.c:3726 .././db/frag.c:375
+#: .././db/check.c:3918 .././db/frag.c:379
 #, c-format
 msgid "can't read agi block for ag %u\n"
 msgstr "nie można odczytać bloku agi w ag %u\n"
 
-#: .././db/check.c:3732
+#: .././db/check.c:3924
 #, c-format
 msgid "bad agi magic # %#x in ag %u\n"
 msgstr "błędna liczba magiczna agi %#x w ag %u\n"
 
-#: .././db/check.c:3738
+#: .././db/check.c:3930
 #, c-format
 msgid "bad agi version # %#x in ag %u\n"
 msgstr "błędny numer wersji agi # %#x w ag %u\n"
 
-#: .././db/check.c:3763 .././repair/scan.c:1383
+#: .././db/check.c:3973 .././repair/scan.c:2252
 #, c-format
 msgid "agf_freeblks %u, counted %u in ag %u\n"
 msgstr "agf_freeblks %u, naliczono %u w ag %u\n"
 
-#: .././db/check.c:3770 .././repair/scan.c:1388
+#: .././db/check.c:3980 .././repair/scan.c:2257
 #, c-format
 msgid "agf_longest %u, counted %u in ag %u\n"
 msgstr "agf_longest %u, naliczono %u w ag %u\n"
 
-#: .././db/check.c:3778
+#: .././db/check.c:3988
 #, c-format
 msgid "agf_btreeblks %u, counted %u in ag %u\n"
 msgstr "agf_btreeblks %u, naliczono %u w ag %u\n"
 
-#: .././db/check.c:3786 .././repair/scan.c:1436
+#: .././db/check.c:3996 .././repair/scan.c:2306
 #, c-format
 msgid "agi_count %u, counted %u in ag %u\n"
 msgstr "agi_count %u, naliczono %u w ag %u\n"
 
-#: .././db/check.c:3793 .././repair/scan.c:1441
+#: .././db/check.c:4003 .././repair/scan.c:2311
 #, c-format
 msgid "agi_freecount %u, counted %u in ag %u\n"
 msgstr "agi_freecount %u, naliczono %u w ag %u\n"
 
-#: .././db/check.c:3802
+#: .././db/check.c:4012
 #, c-format
 msgid "agi unlinked bucket %d is %u in ag %u (inode=%lld)\n"
 msgstr "agi unlinked bucket %d is %u in ag %u (inode=%lld)\n"
 
-#: .././db/check.c:3840
+#: .././db/check.c:4050
 #, c-format
 msgid "can't read agfl block for ag %u\n"
 msgstr "nie można odczytać bloku agfl dla ag %u\n"
 
-#: .././db/check.c:3850 .././db/freesp.c:255 .././repair/scan.c:1319
+#: .././db/check.c:4060 .././db/freesp.c:255 .././repair/scan.c:2142
 #, c-format
 msgid "agf %d freelist blocks bad, skipping freelist scan\n"
-msgstr "błędne bloki listy wolnych agf %d, pominięto przeszukanie listy wolnych\n"
+msgstr ""
+"błędne bloki listy wolnych agf %d, pominięto przeszukanie listy wolnych\n"
 
-#: .././db/check.c:3872
+#: .././db/check.c:4082
 #, c-format
 msgid "freeblk count %u != flcount %u in ag %u\n"
 msgstr "liczba freeblk %u != flcount %u w ag %u\n"
 
-#: .././db/check.c:3901 .././db/check.c:3929 .././db/frag.c:398
-#: .././db/frag.c:421 .././db/freesp.c:289
+#: .././db/check.c:4111 .././db/check.c:4139 .././db/frag.c:402
+#: .././db/frag.c:425 .././db/freesp.c:289
 #, c-format
 msgid "can't read btree block %u/%u\n"
 msgstr "nie można odczytać bloku b-drzewa %u/%u\n"
 
-#: .././db/check.c:3962
+#: .././db/check.c:4173
 #, c-format
 msgid "bad magic # %#x in inode %lld bmbt block %u/%u\n"
 msgstr "błędna liczba magiczna %#x w i-węźle %lld, blok bmbt %u/%u\n"
 
-#: .././db/check.c:3969
+#: .././db/check.c:4180
 #, c-format
 msgid "expected level %d got %d in inode %lld bmbt block %u/%u\n"
 msgstr "oczekiwano poziomu %d, a uzyskano %d w i-węźle %lld, blok bmbt %u/%u\n"
 
-#: .././db/check.c:3981 .././db/check.c:3998
+#: .././db/check.c:4192 .././db/check.c:4209
 #, c-format
 msgid "bad btree nrecs (%u, min=%u, max=%u) in inode %lld bmap block %lld\n"
-msgstr "błędna liczba rekordów b-drzewa (%u, min=%u, max=%u) w i-węźle %lld, blok bitmapy %lld\n"
+msgstr ""
+"błędna liczba rekordów b-drzewa (%u, min=%u, max=%u) w i-węźle %lld, blok "
+"bitmapy %lld\n"
 
-#: .././db/check.c:4026
+#: .././db/check.c:4238
 #, c-format
 msgid "bad magic # %#x in btbno block %u/%u\n"
 msgstr "błędna liczba magiczna %#x w bloku btbno %u/%u\n"
 
-#: .././db/check.c:4035
+#: .././db/check.c:4247
 #, c-format
 msgid "expected level %d got %d in btbno block %u/%u\n"
 msgstr "oczekiwano poziomu %d, a uzyskano %d w bloku btbno %u/%u\n"
 
-#: .././db/check.c:4044 .././db/check.c:4072 .././db/check.c:4117
-#: .././db/check.c:4148
+#: .././db/check.c:4256 .././db/check.c:4284 .././db/check.c:4330
+#: .././db/check.c:4361
 #, c-format
 msgid "bad btree nrecs (%u, min=%u, max=%u) in btbno block %u/%u\n"
-msgstr "błędna liczba rekordów b-drzewa (%u, min=%u, max=%u) w bloku btbno %u/%u\n"
+msgstr ""
+"błędna liczba rekordów b-drzewa (%u, min=%u, max=%u) w bloku btbno %u/%u\n"
 
-#: .././db/check.c:4059 .././repair/scan.c:630
+#: .././db/check.c:4271 .././repair/scan.c:666
 #, c-format
 msgid "out-of-order bno btree record %d (%u %u) block %u/%u\n"
 msgstr "rekord b-drzewa bno poza kolejnością: %d (%u %u), blok %u/%u\n"
 
-#: .././db/check.c:4099
+#: .././db/check.c:4312
 #, c-format
 msgid "bad magic # %#x in btcnt block %u/%u\n"
 msgstr "błędna liczba magiczna %#x w bloku btcbt %u/%u\n"
 
-#: .././db/check.c:4108
+#: .././db/check.c:4321
 #, c-format
 msgid "expected level %d got %d in btcnt block %u/%u\n"
 msgstr "oczekiwano poziomu %d, a uzyskano %d w bloku btcnt %u/%u\n"
 
-#: .././db/check.c:4136 .././repair/scan.c:642
+#: .././db/check.c:4349 .././repair/scan.c:678
 #, c-format
 msgid "out-of-order cnt btree record %d (%u %u) block %u/%u\n"
 msgstr "rekord b-drzewa cnt poza kolejnością: %d (%u %u), blok %u/%u\n"
 
-#: .././db/check.c:4179
+#: .././db/check.c:4407
 #, c-format
 msgid "bad magic # %#x in inobt block %u/%u\n"
 msgstr "błędna liczba magiczna %#x w bloku inobt %u/%u\n"
 
-#: .././db/check.c:4186
+#: .././db/check.c:4414
 #, c-format
 msgid "expected level %d got %d in inobt block %u/%u\n"
 msgstr "oczekiwano poziomu %d, a uzyskano %d w bloku inobt %u/%u\n"
 
-#: .././db/check.c:4195 .././db/check.c:4261
+#: .././db/check.c:4423 .././db/check.c:4509
 #, c-format
 msgid "bad btree nrecs (%u, min=%u, max=%u) in inobt block %u/%u\n"
-msgstr "błędna liczba rekordów b-drzewa (%u, min=%u, max=%u) w bloku inobt %u/%u\n"
+msgstr ""
+"błędna liczba rekordów b-drzewa (%u, min=%u, max=%u) w bloku inobt %u/%u\n"
 
-#: .././db/check.c:4230 .././db/frag.c:490
+#: .././db/check.c:4466 .././db/frag.c:494
 #, c-format
 msgid "can't read inode block %u/%u\n"
 msgstr "nie można odczytać bloku i-węzła %u/%u\n"
 
-#: .././db/check.c:4248
+#: .././db/check.c:4497
 #, c-format
 msgid "ir_freecount/free mismatch, inode chunk %u/%u, freecount %d nfree %d\n"
-msgstr "niezgodność ir_freecount/free, porcja i-węzłów %u/%u, freecount %d nfree %d\n"
+msgstr ""
+"niezgodność ir_freecount/free, porcja i-węzłów %u/%u, freecount %d nfree %d\n"
+
+#: .././db/check.c:4550
+#, c-format
+msgid "bad magic # %#x in finobt block %u/%u\n"
+msgstr "błędna liczba magiczna %#x w bloku finobt %u/%u\n"
+
+#: .././db/check.c:4557
+#, c-format
+msgid "expected level %d got %d in finobt block %u/%u\n"
+msgstr "oczekiwano poziomu %d, a uzyskano %d w bloku finobt %u/%u\n"
+
+#: .././db/check.c:4566 .././db/check.c:4609
+#, c-format
+msgid "bad btree nrecs (%u, min=%u, max=%u) in finobt block %u/%u\n"
+msgstr ""
+"błędna liczba rekordów b-drzewa (%u, min=%u, max=%u) w bloku finobt %u/%u\n"
+
+#: .././db/check.c:4636
+#, c-format
+msgid "bad magic # %#x in rmapbt block %u/%u\n"
+msgstr "błędna liczba magiczna %#x w bloku rmapbt %u/%u\n"
+
+#: .././db/check.c:4643
+#, c-format
+msgid "expected level %d got %d in rmapbt block %u/%u\n"
+msgstr "oczekiwano poziomu %d, a uzyskano %d w bloku rmapbt %u/%u\n"
+
+#: .././db/check.c:4656 .././db/check.c:4680
+#, c-format
+msgid "bad btree nrecs (%u, min=%u, max=%u) in rmapbt block %u/%u\n"
+msgstr ""
+"błędna liczba rekordów b-drzewa (%u, min=%u, max=%u) w bloku rmapbt %u/%u\n"
+
+#: .././db/check.c:4668
+#, c-format
+msgid "out-of-order rmap btree record %d (%u %u) block %u/%u\n"
+msgstr "rekord b-drzewa rmap poza kolejnością: %d (%u %u), blok %u/%u\n"
+
+#: .././db/check.c:4708
+#, c-format
+msgid "bad magic # %#x in refcntbt block %u/%u\n"
+msgstr "błędna liczba magiczna %#x w bloku refcntbt %u/%u\n"
+
+#: .././db/check.c:4715
+#, c-format
+msgid "expected level %d got %d in refcntbt block %u/%u\n"
+msgstr "oczekiwano poziomu %d, a uzyskano %d w bloku refcntbt %u/%u\n"
+
+#: .././db/check.c:4724 .././db/check.c:4765
+#, c-format
+msgid "bad btree nrecs (%u, min=%u, max=%u) in refcntbt block %u/%u\n"
+msgstr ""
+"błędna liczba rekordów b-drzewa (%u, min=%u, max=%u) w bloku refcntbt %u/%u\n"
+
+#: .././db/check.c:4736 .././repair/scan.c:1350
+#, c-format
+msgid "leftover CoW extent (%u/%u) len %u\n"
+msgstr "pozostałość ekstentu CoW (%u/%u) długość %u\n"
+
+#: .././db/check.c:4752
+#, c-format
+msgid "out-of-order refcnt btree record %d (%u %u) block %u/%u\n"
+msgstr "rekord b-drzewa refcnt poza kolejnością: %d (%u %u), blok %u/%u\n"
 
-#: .././db/check.c:4303
+#: .././db/check.c:4808
 #, c-format
 msgid "setting inode to %lld for block %u/%u\n"
 msgstr "ustawianie i-węzła na %lld dla bloku %u/%u\n"
 
-#: .././db/check.c:4335
+#: .././db/check.c:4840
 #, c-format
 msgid "setting inode to %lld for rtblock %llu\n"
 msgstr "ustawianie i-węzła na %lld dla rtbloku %llu\n"
 
-#: .././db/check.c:4351
+#: .././db/check.c:4856
 #, c-format
 msgid "inode %lld nlink %u %s dir\n"
 msgstr "i-węzeł %lld nlink %u katalog %s\n"
 
-#: .././db/command.c:82 .././db/help.c:56 .././libxcmd/help.c:49
+#: .././db/command.c:85 .././db/help.c:56 .././libxcmd/help.c:50
 #, c-format
 msgid "command %s not found\n"
 msgstr "nie znaleziono polecenia %s\n"
 
-#: .././db/command.c:86
+#: .././db/command.c:89
 #, c-format
 msgid "bad argument count %d to %s, expected "
 msgstr "błędny argument liczby %d dla %s, oczekiwano "
 
-#: .././db/command.c:88
+#: .././db/command.c:91
 #, c-format
 msgid "at least %d"
 msgstr "przynajmniej %d"
 
-#: .././db/command.c:92
+#: .././db/command.c:95
 #, c-format
 msgid "between %d and %d"
 msgstr "od %d do %d"
 
-#: .././db/command.c:93
+#: .././db/command.c:96
 msgid " arguments\n"
 msgstr " argumentów\n"
 
 #: .././db/convert.c:171
 #, c-format
 msgid "bad argument count %d to convert, expected 3,5,7,9 arguments\n"
-msgstr "błędna liczba argumentów %d do konwersji, oczekiwano 3,5,7,9 argumentów\n"
+msgstr ""
+"błędna liczba argumentów %d do konwersji, oczekiwano 3,5,7,9 argumentów\n"
 
 #: .././db/convert.c:176 .././db/convert.c:183
 #, c-format
@@ -1745,6 +1940,65 @@ msgstr "konflikt typu konwersji %s\n"
 msgid "%s is not a number\n"
 msgstr "%s nie jest liczbą\n"
 
+#: .././db/crc.c:37
+msgid "manipulate crc values for V5 filesystem structures"
+msgstr "operowanie na wartościach crc struktur systemu plików V5"
+
+#: .././db/crc.c:50
+msgid ""
+"\n"
+" 'crc' validates, invalidates, or recalculates the crc value for\n"
+" the current on-disk metadata structures in Version 5 filesystems.\n"
+"\n"
+" Usage:  \"crc [-i|-r|-v]\"\n"
+"\n"
+msgstr ""
+"\n"
+" 'crc' sprawdza, unieważnia lub przelicza wartość crc dla bieżących\n"
+" struktur metadanych na dysku w systemach plików w wersji 5.\n"
+"\n"
+" Składnia: \"crc [-i|-r|-v]\"\n"
+"\n"
+
+#: .././db/crc.c:81
+#, c-format
+msgid "current type (%s) is not a structure\n"
+msgstr "bieżący typ (%s) nie jest strukturą\n"
+
+#: .././db/crc.c:98
+msgid "bad option for crc command\n"
+msgstr "błędna opcja dla polecenia crc\n"
+
+#: .././db/crc.c:105
+msgid "crc command accepts only one option\n"
+msgstr "polecenie crc przyjmuje tylko jedną opcję\n"
+
+#: .././db/crc.c:111
+#, c-format
+msgid "%s not in expert mode, writing disabled\n"
+msgstr "%s: nie w trybie expert, zapis wyłączony\n"
+
+#: .././db/crc.c:128
+#, c-format
+msgid "No CRC field found for type %s\n"
+msgstr "Brak pola CRC dla typu %s\n"
+
+#: .././db/crc.c:135 .././db/write.c:702
+msgid "parsing error\n"
+msgstr "błąd składni\n"
+
+#: .././db/crc.c:171
+msgid "Invalidating CRC:\n"
+msgstr "Unieważnianie CRC:\n"
+
+#: .././db/crc.c:173
+msgid "Recalculating CRC:\n"
+msgstr "Przeliczanie CRC:\n"
+
+#: .././db/crc.c:181
+msgid "Verifying CRC:\n"
+msgstr "Sprawdzanie CRC:\n"
+
 #: .././db/debug.c:27
 msgid "[flagbits]"
 msgstr "[bity flag]"
@@ -1758,54 +2012,57 @@ msgstr "ustawienie bitów opcji diagnost
 msgid "bad value for debug %s\n"
 msgstr "błędna wartość diagnostyki %s\n"
 
-#: .././db/dir2.c:1019
+#: .././db/dir2.c:1023
 msgid "Unknown directory buffer type!\n"
 msgstr "Nieznany typ bufora katalogu!\n"
 
-#: .././db/dir2.c:1031
+#: .././db/dir2.c:1035
 msgid "Writing unknown directory buffer type!\n"
 msgstr "Zapis nieznanego typu bufora katalogu!\n"
 
 #: .././db/dquot.c:37
-msgid "[projid|gid|uid]"
-msgstr "[projid|gid|uid]"
+msgid "[-g|-p|-u] id"
+msgstr "[g|-p|-u] id"
 
 #: .././db/dquot.c:38
-msgid "set current address to project, group or user quota block"
-msgstr "ustawienie bieżącego adresu na blok limitu projektu, grupy lub użytkownika"
+msgid ""
+"set current address to a group, project or user quota block for given ID"
+msgstr ""
+"ustawienie bieżącego adresu na blok limitu grupy, projektu lub użytkownika o "
+"podanym ID"
 
-#: .././db/dquot.c:127
+#: .././db/dquot.c:129
 msgid "bad option for dquot command\n"
 msgstr "błędna opcja dla polecenia dquot\n"
 
-#: .././db/dquot.c:131
+#: .././db/dquot.c:133
 msgid "project"
 msgstr "projekt"
 
-#: .././db/dquot.c:131
+#: .././db/dquot.c:133
 msgid "group"
 msgstr "grupę"
 
-#: .././db/dquot.c:131
+#: .././db/dquot.c:133
 msgid "user"
 msgstr "użytkownika"
 
-#: .././db/dquot.c:133
+#: .././db/dquot.c:135
 #, c-format
 msgid "dquot command requires one %s id argument\n"
 msgstr "polecenie dquot wymaga jednego argumentu identyfikującego %s\n"
 
-#: .././db/dquot.c:143
+#: .././db/dquot.c:145
 #, c-format
 msgid "no %s quota inode present\n"
 msgstr "i-węzeł limitów na %s nie jest dostępny\n"
 
-#: .././db/dquot.c:148
+#: .././db/dquot.c:150
 #, c-format
 msgid "bad %s id for dquot %s\n"
 msgstr "błędna liczba identyfikująca %s dla dquot %s\n"
 
-#: .././db/dquot.c:160
+#: .././db/dquot.c:162
 #, c-format
 msgid "no %s quota data for id %d\n"
 msgstr "brak danych limitów na %s dla id %d\n"
@@ -1828,8 +2085,8 @@ msgstr "brak bieżącej grupy alokacji,
 msgid "null block number, cannot set new addr\n"
 msgstr "pusty numer bloku, nie można ustawić nowego adresu\n"
 
-#: .././db/faddr.c:68 .././db/faddr.c:353 .././db/faddr.c:371
-#: .././db/faddr.c:389
+#: .././db/faddr.c:68 .././db/faddr.c:353 .././db/faddr.c:370
+#: .././db/faddr.c:387
 msgid "null inode number, cannot set new addr\n"
 msgstr "pusty numer i-węzła, nie można ustawić nowego adresu\n"
 
@@ -1941,16 +2198,25 @@ msgstr "nic"
 msgid "actual %llu, ideal %llu, fragmentation factor %.2f%%\n"
 msgstr "obecnie %llu, idealnie %llu, współczynnik fragmentacji %.2f%%\n"
 
-#: .././db/frag.c:214
+#: .././db/frag.c:175
+msgid "Note, this number is largely meaningless.\n"
+msgstr "Uwaga, ta liczba jest zbyt duża, żeby miała znaczenie.\n"
+
+#: .././db/frag.c:177
+#, c-format
+msgid "Files on this filesystem average %.2f extents per file\n"
+msgstr "Pliki w tym systemie plików mają średnio %.2f ekstentów na plik\n"
+
+#: .././db/frag.c:218
 msgid "bad option for frag command\n"
 msgstr "błędna opcja dla polecenia frag\n"
 
-#: .././db/frag.c:350
+#: .././db/frag.c:354
 #, c-format
 msgid "inode %lld actual %lld ideal %lld\n"
 msgstr "i-węzeł %lld obecnie %lld idealnie %lld\n"
 
-#: .././db/frag.c:444 .././db/frag.c:454
+#: .././db/frag.c:448 .././db/frag.c:458
 #, c-format
 msgid "invalid numrecs (%u) in %s block\n"
 msgstr "błędne numrecs (%u) w bloku %s\n"
@@ -1971,8 +2237,10 @@ msgid "average free extent size %g\n"
 msgstr "średni rozmiar wolnego ekstentu: %g\n"
 
 #: .././db/freesp.c:203
-msgid "freesp arguments: [-bcds] [-a agno] [-e binsize] [-h h1]... [-m binmult]\n"
-msgstr "argumenty freesp: [-bcds] [-a agno] [-e binsize] [-h h1]... [-m binmult]\n"
+msgid ""
+"freesp arguments: [-bcds] [-a agno] [-e binsize] [-h h1]... [-m binmult]\n"
+msgstr ""
+"argumenty freesp: [-bcds] [-a agno] [-e binsize] [-h h1]... [-m binmult]\n"
 
 #: .././db/freesp.c:427
 msgid "from"
@@ -1994,6 +2262,54 @@ msgstr "bloków"
 msgid "pct"
 msgstr "proc."
 
+#: .././db/fsmap.c:39
+#, c-format
+msgid ""
+"%llu: %u/%u len %u owner %lld offset %llu bmbt %d attrfork %d extflag %d\n"
+msgstr ""
+"%llu: %u/%u długość %u właśc. %lld offset %llu bmbt %d attrfork %d extflag "
+"%d\n"
+
+#: .././db/fsmap.c:86
+#, c-format
+msgid "Error %d while reading AGF.\n"
+msgstr "Błąd %d podczas odczytu AGF.\n"
+
+#: .././db/fsmap.c:93
+msgid "Not enough memory.\n"
+msgstr "Za mało pamięci.\n"
+
+#: .././db/fsmap.c:103
+#, c-format
+msgid "Error %d while querying fsmap btree.\n"
+msgstr "Błąd %d podczas odpytywania b-drzewa fsmap.\n"
+
+#: .././db/fsmap.c:127
+msgid "Filesystem does not support reverse mapping btree.\n"
+msgstr "System plików nie obsługuje b-drzewa odwrotnego odwzorowania.\n"
+
+#: .././db/fsmap.c:134
+msgid "Bad option for fsmap command.\n"
+msgstr "Błędna opcja dla polecenia fsmap.\n"
+
+#: .././db/fsmap.c:142
+#, c-format
+msgid "Bad fsmap start_fsb %s.\n"
+msgstr "Błędna wartość start_fsb dla fsmap: %s.\n"
+
+#: .././db/fsmap.c:150
+#, c-format
+msgid "Bad fsmap end_fsb %s.\n"
+msgstr "Błędna wartość end_fsb dla fsmap: %s.\n"
+
+#: .././db/fsmap.c:162
+msgid "[start_fsb] [end_fsb]"
+msgstr "[start_fsb] [end_fsb]"
+
+#: .././db/fsmap.c:163
+msgid "display reverse mapping(s)"
+msgstr "wyświetlenie odwrotnych odwzorowań"
+
 #: .././db/hash.c:30
 msgid "string"
 msgstr "łańcuch"
@@ -2018,15 +2334,15 @@ msgstr ""
 " Składnia: \"hash <łańcuch>\"\n"
 "\n"
 
-#: .././db/help.c:30 .././db/io.c:48 .././libxcmd/help.c:92
+#: .././db/help.c:30 .././db/io.c:49 .././libxcmd/help.c:93
 msgid "[command]"
 msgstr "[polecenie]"
 
-#: .././db/help.c:31 .././libxcmd/help.c:93
+#: .././db/help.c:31 .././libxcmd/help.c:94
 msgid "help for one or all commands"
 msgstr "opis dla jednego lub wszystkich poleceń"
 
-#: .././db/help.c:40 .././libxcmd/help.c:33
+#: .././db/help.c:40 .././libxcmd/help.c:34
 #, c-format
 msgid ""
 "\n"
@@ -2040,12 +2356,13 @@ msgstr ""
 msgid "(or %s) "
 msgstr "(lub %s) "
 
-#: .././db/init.c:47
+#: .././db/init.c:49
 #, c-format
 msgid "Usage: %s [-ifFrxV] [-p prog] [-l logdev] [-c cmd]... device\n"
-msgstr "Składnia: %s [-ifFrxV] [-p prog] [-l urz-log] [-c polecenie]... urządzenie\n"
+msgstr ""
+"Składnia: %s [-ifFrxV] [-p prog] [-l urz-log] [-c polecenie]... urządzenie\n"
 
-#: .././db/init.c:114
+#: .././db/init.c:117
 msgid ""
 "\n"
 "fatal error -- couldn't initialize XFS library\n"
@@ -2053,46 +2370,56 @@ msgstr ""
 "\n"
 "błąd krytyczny - nie udało się zainicjować biblioteki XFS\n"
 
-#: .././db/init.c:129
+#: .././db/init.c:132
 #, c-format
 msgid "%s: %s is invalid (cannot read first 512 bytes)\n"
 msgstr "%s: %s jest nieprawidłowy (nie można odczytać pierwszych 512 bajtów)\n"
 
-#: .././db/init.c:141
+#: .././db/init.c:144
 #, c-format
-msgid "%s: %s is not a valid XFS filesystem (unexpected SB magic number 0x%08x)\n"
-msgstr "%s: %s nie jest poprawnym systemem plików XFS (nieoczekiwana liczba magiczna SB 0x%08x)\n"
+msgid ""
+"%s: %s is not a valid XFS filesystem (unexpected SB magic number 0x%08x)\n"
+msgstr ""
+"%s: %s nie jest poprawnym systemem plików XFS (nieoczekiwana liczba magiczna "
+"SB 0x%08x)\n"
 
-#: .././db/init.c:144
+#: .././db/init.c:147
 #, c-format
 msgid "Use -F to force a read attempt.\n"
 msgstr "Opcja -F pozwala wymusić próbę odczytu.\n"
 
-#: .././db/init.c:153
+#: .././db/init.c:157
 #, c-format
 msgid "%s: device %s unusable (not an XFS filesystem?)\n"
-msgstr "%s: urządzenie %s nie nadaje się do użycia (to nie jest system plików XFS?)\n"
+msgstr ""
+"%s: urządzenie %s nie nadaje się do użycia (to nie jest system plików XFS?)\n"
 
-#: .././db/init.c:167
+#: .././db/init.c:176
 #, c-format
 msgid "%s: cannot init perag data (%d). Continuing anyway.\n"
-msgstr "%s: nie można zainicjować danych perag (%d). Kontynuacja mimo wszystko.\n"
+msgstr ""
+"%s: nie można zainicjować danych perag (%d). Kontynuacja mimo wszystko.\n"
 
-#: .././db/inode.c:412
+#: .././db/inode.c:419
 #, c-format
 msgid "bad value for inode number %s\n"
 msgstr "błędna wartość numeru i-węzła %s\n"
 
-#: .././db/inode.c:419
+#: .././db/inode.c:426
 #, c-format
 msgid "current inode number is %lld\n"
 msgstr "numer bieżącego i-węzła to %lld\n"
 
-#: .././db/inode.c:654
+#: .././db/inode.c:660
 #, c-format
 msgid "bad inode number %lld\n"
 msgstr "błędny numer i-węzła %lld\n"
 
+#: .././db/inode.c:707
+#, c-format
+msgid "Metadata CRC error detected for ino %lld\n"
+msgstr "Wykryto błąd CRC metadanych dla i-węzła %lld\n"
+
 #: .././db/input.c:43
 msgid "source-file"
 msgstr "plik-źródłowy"
@@ -2101,45 +2428,45 @@ msgstr "plik-źródłowy"
 msgid "get commands from source-file"
 msgstr "odczyt poleceń z pliku-źródłowego"
 
-#: .././db/input.c:320
+#: .././db/input.c:331
 #, c-format
 msgid "can't open %s\n"
 msgstr "nie można otworzyć %s\n"
 
-#: .././db/io.c:46
+#: .././db/io.c:47
 msgid "pop location from the stack"
 msgstr "odtworzenie pozycji ze stosu"
 
-#: .././db/io.c:49
+#: .././db/io.c:50
 msgid "push location to the stack"
 msgstr "zapisanie pozycji na stos"
 
-#: .././db/io.c:52
+#: .././db/io.c:53
 msgid "view the location stack"
 msgstr "podejrzenie stosu pozycji"
 
-#: .././db/io.c:55
+#: .././db/io.c:56
 msgid "move forward to next entry in the position ring"
 msgstr "przejście na następną pozycję w kręgu"
 
-#: .././db/io.c:58
+#: .././db/io.c:59
 msgid "move to the previous location in the position ring"
 msgstr "przejście na poprzednią pozycję w kręgu"
 
-#: .././db/io.c:61
+#: .././db/io.c:62
 msgid "show position ring or move to a specific entry"
 msgstr "pokazanie kręgu pozycji lub przejście do określonego wpisu"
 
-#: .././db/io.c:91
+#: .././db/io.c:92
 #, c-format
 msgid "can't set block offset to %d\n"
 msgstr "nie można ustawić offsetu bloku na %d\n"
 
-#: .././db/io.c:104
+#: .././db/io.c:105
 msgid "can't pop anything from I/O stack\n"
 msgstr "nie można pobrać nic ze stosu we/wy\n"
 
-#: .././db/io.c:138
+#: .././db/io.c:139
 msgid ""
 "\n"
 " Changes the address and data type to the first entry on the stack.\n"
@@ -2149,51 +2476,51 @@ msgstr ""
 " Zmiana adresu i typu danych na pierwszy wpis ze stosu.\n"
 "\n"
 
-#: .././db/io.c:152
+#: .././db/io.c:153
 #, c-format
 msgid "\tbyte offset %lld, length %d\n"
 msgstr "\toffset w bajtach %lld, długość %d\n"
 
-#: .././db/io.c:153
+#: .././db/io.c:154
 #, c-format
 msgid "\tbuffer block %lld (fsbno %lld), %d bb%s\n"
 msgstr "\tblok bufora %lld (fsbno %lld), %d bb%s\n"
 
-#: .././db/io.c:157 .././db/io.c:508
+#: .././db/io.c:158 .././db/io.c:566
 #, c-format
 msgid "\tblock map"
 msgstr "\tmapa bloków"
 
-#: .././db/io.c:163
+#: .././db/io.c:164
 #, c-format
 msgid "\tinode %lld, dir inode %lld, type %s\n"
 msgstr "\ti-węzeł %lld, i-węzeł katalogu %lld, typ %s\n"
 
-#: .././db/io.c:164 .././growfs/xfs_growfs.c:83 .././logprint/log_misc.c:151
-#: .././mkfs/xfs_mkfs.c:2126
+#: .././db/io.c:165 .././growfs/xfs_growfs.c:88 .././logprint/log_misc.c:107
+#: .././mkfs/xfs_mkfs.c:2366
 #, c-format
 msgid "none"
 msgstr "brak"
 
-#: .././db/io.c:174
+#: .././db/io.c:175
 msgid "no entries in location ring.\n"
 msgstr "brak wpisów w kręgu pozycji.\n"
 
-#: .././db/io.c:178
+#: .././db/io.c:179
 msgid "      type    bblock  bblen    fsbno     inode\n"
 msgstr "      typ     bblok   bblen    fsbno     i-węzeł\n"
 
-#: .././db/io.c:232
+#: .././db/io.c:233
 #, c-format
 msgid "no such command %s\n"
 msgstr "nieznane polecenie %s\n"
 
-#: .././db/io.c:236
+#: .././db/io.c:237
 #, c-format
 msgid "no push form allowed for %s\n"
 msgstr "forma push niedozwolona dla %s\n"
 
-#: .././db/io.c:260
+#: .././db/io.c:261
 msgid ""
 "\n"
 " Allows you to push the current address and data type on the stack for\n"
@@ -2203,23 +2530,25 @@ msgid ""
 msgstr ""
 "\n"
 " Pozwala zapisać bieżący adres i typ danych na stos w celu późniejszego\n"
-" powrotu. 'push' akceptuje także dodatkowe polecenie do wykonania po zapisaniu\n"
+" powrotu. 'push' akceptuje także dodatkowe polecenie do wykonania po "
+"zapisaniu\n"
 " bieżącego adresu (np. 'push a rootino' z superbloku).\n"
 "\n"
 
-#: .././db/io.c:276 .././db/io.c:316
+#: .././db/io.c:277 .././db/io.c:317
 msgid "ring is empty\n"
 msgstr "krąg jest pusty\n"
 
-#: .././db/io.c:280
+#: .././db/io.c:281
 msgid "no further entries\n"
 msgstr "brak dalszych wpisów\n"
 
-#: .././db/io.c:299
+#: .././db/io.c:300
 msgid ""
 "\n"
 " The 'forward' ('f') command moves to the next location in the position\n"
-" ring, updating the current position and data type.  If the current location\n"
+" ring, updating the current position and data type.  If the current "
+"location\n"
 " is the top entry in the ring, then the 'forward' command will have\n"
 " no effect.\n"
 "\n"
@@ -2230,16 +2559,18 @@ msgstr ""
 " jest szczytowym wpisem w kręgu, polecenie nie przyniesie efektu.\n"
 "\n"
 
-#: .././db/io.c:320
+#: .././db/io.c:321
 msgid "no previous entries\n"
 msgstr "brak poprzednich wpisów\n"
 
-#: .././db/io.c:339
+#: .././db/io.c:340
 msgid ""
 "\n"
 " The 'back' ('b') command moves to the previous location in the position\n"
-" ring, updating the current position and data type.  If the current location\n"
-" is the last entry in the ring, then the 'back' command will have no effect.\n"
+" ring, updating the current position and data type.  If the current "
+"location\n"
+" is the last entry in the ring, then the 'back' command will have no "
+"effect.\n"
 "\n"
 msgstr ""
 "\n"
@@ -2248,12 +2579,12 @@ msgstr ""
 " jest ostatnim wpisem w kręgu, polecenie nie przyniesie efektu.\n"
 "\n"
 
-#: .././db/io.c:362
+#: .././db/io.c:363
 #, c-format
 msgid "invalid entry: %d\n"
 msgstr "błędny wpis: %d\n"
 
-#: .././db/io.c:381
+#: .././db/io.c:382
 #, c-format
 msgid ""
 "\n"
@@ -2295,30 +2626,30 @@ msgstr ""
 " powrotu, należy użyć poleceń 'push' i 'pop'.\n"
 "\n"
 
-#: .././db/io.c:434 .././db/io.c:450
+#: .././db/io.c:435 .././db/io.c:451
 #, c-format
 msgid "write error: %s\n"
 msgstr "błąd zapisu: %s\n"
 
-#: .././db/io.c:440 .././db/io.c:456
+#: .././db/io.c:441 .././db/io.c:457
 #, c-format
 msgid "read error: %s\n"
 msgstr "błąd odczytu: %s\n"
 
-#: .././db/io.c:463
+#: .././db/io.c:502
 msgid "nothing to write\n"
 msgstr "nie ma nic do zapisania\n"
 
-#: .././db/io.c:493
+#: .././db/io.c:551
 msgid "set_cur no stack element to set\n"
 msgstr "set_cur: brak elementu stosu do ustawienia\n"
 
-#: .././db/io.c:507
+#: .././db/io.c:565
 #, c-format
 msgid "xfs_db got a bbmap for %lld\n"
 msgstr "xfs_db ma bbmap dla %lld\n"
 
-#: .././db/io.c:583
+#: .././db/io.c:641
 msgid ""
 "\n"
 " The stack is used to explicitly store your location and data type\n"
@@ -2332,27 +2663,58 @@ msgid ""
 msgstr ""
 "\n"
 " Stos służy do jawnego zapisania pozycji i typu danych w celu późniejszego\n"
-" powrotu. Operacja 'push' zapisuje bieżący adres i typ na stosie, a operacja\n"
+" powrotu. Operacja 'push' zapisuje bieżący adres i typ na stosie, a "
+"operacja\n"
 " 'pop' odtwarza bieżący adres i typ danych z wierzchu stosu.\n"
 "\n"
 " Stos ('stack') pozwala na jawne zapisywanie pozycji; domyślnie pozycje są\n"
 " śledzone poprzez krąg (p. 'ring').\n"
 "\n"
 
+#: .././db/logformat.c:89
+msgid "The log is dirty. Please mount to replay the log.\n"
+msgstr "Log jest brudny. Proszę zamontować, aby odtworzyć log.\n"
+
+#: .././db/logformat.c:121
+msgid ""
+"\n"
+" The 'logformat' command reformats (clears) the log to the specified log\n"
+" cycle and log stripe unit. If the log cycle is not specified, the log is\n"
+" reformatted to the current cycle. If the log stripe unit is not specified,\n"
+" the stripe unit from the filesystem superblock is used.\n"
+"\n"
+msgstr ""
+"\n"
+" Polecenie 'logformat' reformatuje (czyści) log do określonego cyklu logu\n"
+" oraz jednostki pasa logu. Jeśli nie podano cyklu logu, log jest "
+"reformatowany\n"
+" do cyklu bieżącego. Jeśli nie podano jednostki pasa, używana jest "
+"jednostka\n"
+" pasa z superbloku systemu plików.\n"
+"\n"
+
+#: .././db/logformat.c:137
+msgid "[-c cycle] [-s sunit]"
+msgstr "[-c cykl] [-s jednostka-pasa]"
+
+#: .././db/logformat.c:138
+msgid "reformat the log"
+msgstr "reformatowanie logu"
+
 #: .././db/malloc.c:27
 #, c-format
 msgid "%s: out of memory\n"
 msgstr "%s: brak pamięci\n"
 
-#: .././db/metadump.c:59
-msgid "[-e] [-g] [-m max_extent] [-w] [-o] filename"
-msgstr "[-e] [-g] [-m max_extent] [-w] [-o] nazwa-pliku"
-
 #: .././db/metadump.c:60
+msgid "[-a] [-e] [-g] [-m max_extent] [-w] [-o] filename"
+msgstr "[-a] [-e] [-g] [-m max_extent] [-w] [-o] nazwa-pliku"
+
+#: .././db/metadump.c:61
 msgid "dump metadata to a file"
 msgstr "zrzut metadanych do pliku"
 
-#: .././db/metadump.c:90
+#: .././db/metadump.c:92
 #, c-format
 msgid ""
 "\n"
@@ -2361,6 +2723,7 @@ msgid ""
 " or xfs_repair failures.\n"
 "\n"
 " Options:\n"
+"   -a -- Copy full metadata blocks without zeroing unused space\n"
 "   -e -- Ignore read errors and keep going\n"
 "   -g -- Display dump progress\n"
 "   -m -- Specify max extent size in blocks to copy (default = %d blocks)\n"
@@ -2369,19 +2732,37 @@ msgid ""
 "\n"
 msgstr ""
 "\n"
-" Polecenie 'metadump' zrzuca znane metadane do zwięzłego pliku nadającego się\n"
-" do skompresowania i wysłania prowadzącym projekt XFS w celu analizy uszkodzeń\n"
+" Polecenie 'metadump' zrzuca znane metadane do zwięzłego pliku nadającego "
+"się\n"
+" do skompresowania i wysłania prowadzącym projekt XFS w celu analizy "
+"uszkodzeń\n"
 " lub błędów xfs_repair.\n"
 "\n"
 " Opcje:\n"
+"   -a - skopiowanie pełnych bloków metadanych bez zerowania nie używanego "
+"miejsca\n"
 "   -e - ignorowanie błędów odczytu i kontynuowanie\n"
 "   -g - wyświetlanie postępu\n"
-"   -m - określenie maksymalnego rozmiaru ekstentu (w blokach) do skopiowania\n"
+"   -m - określenie maksymalnego rozmiaru ekstentu (w blokach) do "
+"skopiowania\n"
 "        (domyślnie %d bloków)\n"
 "   -o - bez zaciemniania nazw i rozszerzonych atrybutów\n"
 "   -w - wyświetlanie ostrzeżeń o błędnych metadanych\n"
 "\n"
 
+#: .././db/metadump.c:2729
+msgid ""
+"Filesystem log is dirty; image will contain unobfuscated metadata in log."
+msgstr ""
+"Log systemu plików jest brudny; obraz będzie zawierał niezaciemnione "
+"metadane w logu."
+
+#: .././db/metadump.c:2735
+msgid "Could not discern log; image will contain unobfuscated metadata in log."
+msgstr ""
+"Nie udało się doszukać logu; obraz będzie zawierał niezaciemnione metadane w "
+"logu."
+
 #: .././db/output.c:30
 msgid "[stop|start <filename>]"
 msgstr "[stop|start <nazwa-pliku>]"
@@ -2426,15 +2807,15 @@ msgstr "wypisanie wartości pól"
 msgid "no print function for type %s\n"
 msgstr "brak funkcji wypisującej dla typu %s\n"
 
-#: .././db/print.c:153
+#: .././db/print.c:165
 msgid "(empty)\n"
 msgstr "(puste)\n"
 
-#: .././db/print.c:215
+#: .././db/print.c:227
 msgid "(empty)"
 msgstr "(puste)"
 
-#: .././db/print.c:275
+#: .././db/print.c:287
 msgid "no arguments allowed\n"
 msgstr "argumenty nie są dozwolone\n"
 
@@ -2442,35 +2823,35 @@ msgstr "argumenty nie są dozwolone\n"
 msgid "exit xfs_db"
 msgstr "zakończenie xfs_db"
 
-#: .././db/sb.c:43
+#: .././db/sb.c:45
 msgid "set current address to sb header"
 msgstr "ustawienie bieżącego adresu na nagłówek sb"
 
-#: .././db/sb.c:45
+#: .././db/sb.c:47
 msgid "[uuid]"
 msgstr "[uuid]"
 
-#: .././db/sb.c:46
+#: .././db/sb.c:48
 msgid "write/print FS uuid"
 msgstr "zapisanie/wypisanie uuida FS"
 
-#: .././db/sb.c:48
+#: .././db/sb.c:50
 msgid "[label]"
 msgstr "[etykieta]"
 
-#: .././db/sb.c:49
+#: .././db/sb.c:51
 msgid "write/print FS label"
 msgstr "zapisanie/wypisanie etykiety FS"
 
-#: .././db/sb.c:51
+#: .././db/sb.c:53
 msgid "[feature | [vnum fnum]]"
 msgstr "[cecha | [vnum fnum]]"
 
-#: .././db/sb.c:52
+#: .././db/sb.c:54
 msgid "set feature bit(s) in the sb version field"
 msgstr "ustawienie bitów cech w polu wersji sb"
 
-#: .././db/sb.c:136
+#: .././db/sb.c:140
 msgid ""
 "\n"
 " set allocation group superblock\n"
@@ -2497,37 +2878,42 @@ msgstr ""
 " informacje o systemie plików.\n"
 " Superblok w grupie alokacji 0 jest główny. Kopie w pozostałych grupach\n"
 " alokacji służą tylko jako kopie zapasowe do odtwarzania systemu plików.\n"
-" Liczby icount/ifree/fdblocks/frextents są uaktualniane tylko w superbloku 0.\n"
+" Liczby icount/ifree/fdblocks/frextents są uaktualniane tylko w superbloku "
+"0.\n"
 "\n"
 
-#: .././db/sb.c:195
+#: .././db/sb.c:199
 #, c-format
 msgid "can't read superblock for AG %u\n"
 msgstr "nie można odczytać superbloku dla AG %u\n"
 
-#: .././db/sb.c:203
+#: .././db/sb.c:207
 #, c-format
 msgid "bad sb magic # %#x in AG %u\n"
 msgstr "błędna liczba magiczna superbloku %#x w AG %u\n"
 
-#: .././db/sb.c:208
+#: .././db/sb.c:212
 #, c-format
 msgid "bad sb version # %#x in AG %u\n"
 msgstr "błędny numer wersji superbloku %#x w AG %u\n"
 
-#: .././db/sb.c:233
+#: .././db/sb.c:236
 msgid "aborting - external log specified for FS with an internal log\n"
-msgstr "przerwano - podano log zewnętrzny dla systemu plików z logiem wewnętrznym\n"
+msgstr ""
+"przerwano - podano log zewnętrzny dla systemu plików z logiem wewnętrznym\n"
 
-#: .././db/sb.c:239
+#: .././db/sb.c:242
 msgid "aborting - no external log specified for FS with an external log\n"
-msgstr "przerwano - nie podano logu zewnętrznego dla systemu plików z logiem zewnętrznym\n"
+msgstr ""
+"przerwano - nie podano logu zewnętrznego dla systemu plików z logiem "
+"zewnętrznym\n"
 
-#: .././db/sb.c:261
+#: .././db/sb.c:252
 msgid "ERROR: cannot find log head/tail, run xfs_repair\n"
-msgstr "BŁĄD: nie odnaleziono początku/końca logu, proszę uruchomić xfs_repair\n"
+msgstr ""
+"BŁĄD: nie odnaleziono początku/końca logu, proszę uruchomić xfs_repair\n"
 
-#: .././db/sb.c:266
+#: .././db/sb.c:256
 #, c-format
 msgid ""
 "ERROR: The filesystem has valuable metadata changes in a log which needs to\n"
@@ -2538,22 +2924,22 @@ msgid ""
 "of the filesystem before doing this.\n"
 msgstr ""
 "BŁĄD: system plików zawiera wartościowe zmiany metadanych w logu, który\n"
-"musi być odtworzony. Należy podmontować system plików, aby odtworzyć log,\n"
+"musi być odtworzony. Należy zamontować system plików, aby odtworzyć log,\n"
 "a następnie odmontować go przed ponownym uruchomieniem %s. Jeśli\n"
-"systemu plików nie da się podmontować, można użyć opcji -L, aby zniszczyć\n"
+"systemu plików nie da się zamontować, można użyć opcji -L, aby zniszczyć\n"
 "log i spróbować naprawić system plików.\n"
 "Należy zauważyć, że zniszczenie logu może spowodować uszkodzenia danych -\n"
-"proszę najpierw spróbować podmontować system plików.\n"
+"proszę najpierw spróbować zamontować system plików.\n"
 
-#: .././db/sb.c:283
+#: .././db/sb.c:284
 msgid "Clearing log and setting UUID\n"
 msgstr "Czyszczenei logu i ustawianie UUID-a\n"
 
-#: .././db/sb.c:291
+#: .././db/sb.c:293
 msgid "ERROR: cannot clear the log\n"
 msgstr "BŁĄD: nie można wyczyścić logu\n"
 
-#: .././db/sb.c:302
+#: .././db/sb.c:305
 msgid ""
 "\n"
 " write/print FS uuid\n"
@@ -2583,7 +2969,8 @@ msgstr ""
 " 'uuid generate'                             - wygenerowanie i zapisanie\n"
 " 'uuid rewrite'                              - skopiowanie UUID-a z sb 0\n"
 "\n"
-"Funkcja wypisująca sprawdza UUID w każdym superbloku i ostrzega, jeśli UUID-y\n"
+"Funkcja wypisująca sprawdza UUID w każdym superbloku i ostrzega, jeśli UUID-"
+"y\n"
 "się różnią między AG (log nie jest sprawdzany). Polecenia zapisu ustawiają\n"
 "UUID we wszystkich AG odpowiednio na określoną wartość, nowo wygenerowaną\n"
 "wartość lub wartość znalezioną w pierwszym superbloku (SB 0).\n"
@@ -2591,66 +2978,67 @@ msgstr ""
 "przy CZYSTO odmontowanym systemie plików).\n"
 "\n"
 
-#: .././db/sb.c:354 .././db/sb.c:506
+#: .././db/sb.c:383 .././db/sb.c:546
 msgid "invalid parameters\n"
 msgstr "błędne parametry\n"
 
-#: .././db/sb.c:361 .././db/sb.c:513 .././db/sb.c:670
+#: .././db/sb.c:390 .././db/sb.c:553 .././db/sb.c:720
 #, c-format
 msgid "%s: not in expert mode, writing disabled\n"
 msgstr "%s: nie w trybie expert, zapis wyłączony\n"
 
-#: .././db/sb.c:373
+#: .././db/sb.c:402
 msgid "failed to read UUID from AG 0\n"
 msgstr "nie udało się odczytać UUID-a z AG 0\n"
 
-#: .././db/sb.c:378
+#: .././db/sb.c:407
 #, c-format
 msgid "old UUID = %s\n"
 msgstr "stary UUID = %s\n"
 
-#: .././db/sb.c:381
+#: .././db/sb.c:421
 msgid "invalid UUID\n"
 msgstr "błędny UUID\n"
 
-#: .././db/sb.c:390 .././db/sb.c:518 .././db/sb.c:756
+#: .././db/sb.c:430 .././db/sb.c:558 .././db/sb.c:806
 msgid "writing all SBs\n"
 msgstr "zapisywanie wszystkich superbloków\n"
 
-#: .././db/sb.c:393
+#: .././db/sb.c:433
 #, c-format
 msgid "failed to set UUID in AG %d\n"
 msgstr "nie udało się ustawić UUID-a w AG %d\n"
 
-#: .././db/sb.c:398
+#: .././db/sb.c:438
 #, c-format
 msgid "new UUID = %s\n"
 msgstr "nowy UUID = %s\n"
 
-#: .././db/sb.c:406
+#: .././db/sb.c:446
 #, c-format
 msgid "failed to read UUID from AG %d\n"
 msgstr "nie udało się odczytać UUID-a z AG %d\n"
 
-#: .././db/sb.c:412
+#: .././db/sb.c:452
 #, c-format
 msgid "warning: UUID in AG %d differs to the primary SB\n"
 msgstr "uwaga: UUID w AG %d różni się od głównego SB\n"
 
-#: .././db/sb.c:423
+#: .././db/sb.c:463
 msgid "warning - external log specified for FS with an internal log\n"
 msgstr "uwaga: podano log zewnętrzny dla systemu plików z logiem wewnętrznym\n"
 
-#: .././db/sb.c:426
+#: .././db/sb.c:466
 msgid "warning - no external log specified for FS with an external log\n"
-msgstr "uwaga: nie podano logu zewnętrznego dla systemu plików z logiem zewnętrznym\n"
+msgstr ""
+"uwaga: nie podano logu zewnętrznego dla systemu plików z logiem zewnętrznym\n"
 
-#: .././db/sb.c:431
+#: .././db/sb.c:471
 #, c-format
 msgid "UUID = %s\n"
 msgstr "UUID = %s\n"
 
-#: .././db/sb.c:442
+#: .././db/sb.c:482
 msgid ""
 "\n"
 " write/print FS label\n"
@@ -2678,41 +3066,42 @@ msgstr ""
 "\n"
 "Funkcja wypisująca sprawdza etykietę w każdym superbloku i ostrzega, jeśli\n"
 "etykiety różnią się między AG. Polecenia zapisu ustawiają etykietw we\n"
-"wszystkich AG na określoną wartość. Maksymalna długość etykiety to 12 znaków;\n"
+"wszystkich AG na określoną wartość. Maksymalna długość etykiety to 12 "
+"znaków;\n"
 "użycie etykiety dłuższej zaskutkuje ucięciem jej i wypisaniem ostrzeżenia.\n"
 "\n"
 
-#: .././db/sb.c:479
+#: .././db/sb.c:519
 #, c-format
 msgid "%s: truncating label length from %d to %d\n"
 msgstr "%s: skrócono długość etykiety z %d do %d\n"
 
-#: .././db/sb.c:521
+#: .././db/sb.c:561
 #, c-format
 msgid "failed to set label in AG %d\n"
 msgstr "nie udało się ustawić etykiety w AG %d\n"
 
-#: .././db/sb.c:524
+#: .././db/sb.c:564
 #, c-format
 msgid "new label = \"%s\"\n"
 msgstr "nowa etykieta = \"%s\"\n"
 
-#: .././db/sb.c:531
+#: .././db/sb.c:571
 #, c-format
 msgid "failed to read label in AG %d\n"
 msgstr "nie udało się odczytać etykiety w AG %d\n"
 
-#: .././db/sb.c:537
+#: .././db/sb.c:577
 #, c-format
 msgid "warning: AG %d label differs\n"
 msgstr "uwaga: etykieta w AG %d różni się\n"
 
-#: .././db/sb.c:539
+#: .././db/sb.c:579
 #, c-format
 msgid "label = \"%s\"\n"
 msgstr "etykieta = \"%s\"\n"
 
-#: .././db/sb.c:549
+#: .././db/sb.c:589
 msgid ""
 "\n"
 " set/print feature bits in sb version\n"
@@ -2749,42 +3138,42 @@ msgstr ""
 "AG.\n"
 "\n"
 
-#: .././db/sb.c:578
+#: .././db/sb.c:617
 msgid "Superblock has mismatched features2 fields, skipping modification\n"
 msgstr "Superblok ma niepasujące pola features2, pominięto modyfikację\n"
 
-#: .././db/sb.c:690
+#: .././db/sb.c:740
 msgid "unwritten extents flag is already enabled\n"
 msgstr "flaga nie zapisanych ekstentów jest już włączona\n"
 
-#: .././db/sb.c:697
+#: .././db/sb.c:747
 msgid "unwritten extents always enabled for v5 superblocks.\n"
 msgstr "nie zapisane ekstenty są zawsze włączone dla superbloków v5.\n"
 
-#: .././db/sb.c:714
+#: .././db/sb.c:764
 msgid "version 2 log format is already in use\n"
 msgstr "format logu w wersji 2 jest już w użyciu\n"
 
-#: .././db/sb.c:721
+#: .././db/sb.c:771
 msgid "Version 2 logs always enabled for v5 superblocks.\n"
 msgstr "Logi w wersji 2 są zawsze włączone dla superbloków v5.\n"
 
-#: .././db/sb.c:726
+#: .././db/sb.c:776
 #, c-format
 msgid "%s: Cannot change %s on v5 superblocks.\n"
 msgstr "%s: Nie można zmienić %s przy superblokach v5.\n"
 
-#: .././db/sb.c:750
+#: .././db/sb.c:800
 #, c-format
 msgid "%s: invalid version change command \"%s\"\n"
 msgstr "%s: błędne polecenie zmiany wersji \"%s\"\n"
 
-#: .././db/sb.c:759
+#: .././db/sb.c:809
 #, c-format
 msgid "failed to set versionnum in AG %d\n"
 msgstr "nie udało się ustawić versionnum w AG %d\n"
 
-#: .././db/sb.c:777
+#: .././db/sb.c:827
 #, c-format
 msgid "versionnum [0x%x+0x%x] = %s\n"
 msgstr "versionnum [0x%x+0x%x] = %s\n"
@@ -2797,12 +3186,12 @@ msgstr "[nowy-typ]"
 msgid "set/show current data type"
 msgstr "ustawienie/wyświetlenie bieżącego typu danych"
 
-#: .././db/type.c:144
+#: .././db/type.c:210
 #, c-format
 msgid "current type is \"%s\"\n"
 msgstr "bieżący typ to \"%s\"\n"
 
-#: .././db/type.c:146
+#: .././db/type.c:212
 msgid ""
 "\n"
 " supported types are:\n"
@@ -2812,18 +3201,18 @@ msgstr ""
 " obsługiwane typy to:\n"
 " "
 
-#: .././db/type.c:163
+#: .././db/type.c:229
 #, c-format
 msgid "no such type %s\n"
 msgstr "nie ma typu %s\n"
 
-#: .././db/type.c:166
+#: .././db/type.c:232
 msgid "no current object\n"
 msgstr "brak bieżącego obiektu\n"
 
 #: .././db/write.c:41
-msgid "[field or value]..."
-msgstr "[pole lub wartość]..."
+msgid "[-c] [field or value]..."
+msgstr "[-c] [pole lub wartość]..."
 
 #: .././db/write.c:42
 msgid "write value to disk"
@@ -2846,17 +3235,25 @@ msgid ""
 "  Struct mode: 'write core.uid 23'          - set an inode uid field to 23.\n"
 "               'write fname \"hello\\000\"'    - write superblock fname.\n"
 "               (note: in struct mode strings are not null terminated)\n"
-"               'write fname #6669736800'    - write superblock fname with hex.\n"
+"               'write fname #6669736800'    - write superblock fname with "
+"hex.\n"
 "               'write uuid 00112233-4455-6677-8899-aabbccddeeff'\n"
 "                                            - write superblock uuid.\n"
 "  Data mode:   'write fill 0xff' - fill the entire block with 0xff's\n"
 "               'write lshift 3' - shift the block 3 bytes to the left\n"
 "               'write sequence 1 5' - write a cycle of number [1-5] through\n"
 "                                      the entire block.\n"
-"  String mode: 'write \"This_is_a_filename\" - write null terminated string.\n"
+"  String mode: 'write \"This_is_a_filename\" - write null terminated "
+"string.\n"
 "\n"
 " In data mode type 'write' by itself for a list of specific commands.\n"
 "\n"
+" Specifying the -c option will allow writes of invalid (corrupt) data with\n"
+" an invalid CRC. Specifying the -d option will allow writes of invalid "
+"data,\n"
+" but still recalculate the CRC so we are forced to check and detect the\n"
+" invalid data appropriately.\n"
+"\n"
 msgstr ""
 "\n"
 " Polecenie 'write' ma różne osobowości w zależności od rodzaju obiektu,\n"
@@ -2871,71 +3268,104 @@ msgstr ""
 "                   symbolicznych.\n"
 "\n"
 " Przykłady:\n"
-"  Tryb strukturalny: 'write core.uid 23' - ustawienie pola uid i-węzła na 23\n"
+"  Tryb strukturalny: 'write core.uid 23' - ustawienie pola uid i-węzła na "
+"23\n"
 "                     'write fname \"hello\\000\"' - zapis nazwy pliku sb\n"
-"                     (uwaga: w trybie strukturalnym łańcuchy nie są zakańczane)\n"
-"                     'write fname #6669736800' - zapis nazwy pliku sb w hex.\n"
+"                     (uwaga: w trybie strukturalnym łańcuchy nie są "
+"zakańczane)\n"
+"                     'write fname #6669736800' - zapis nazwy pliku sb w "
+"hex.\n"
 "                     'write uuid 00112233-4455-6677-8899-aabbccddeeff'\n"
 "                               - zapis UUID-a superbloku.\n"
-"  Tryb danych:       'write fill 0xff' - wypełnienie bloku bajtam 0xff\n"
+"  Tryb danych:       'write fill 0xff' - wypełnienie bloku bajtami 0xff\n"
 "                     'write lshift 3' - przesunięcie bloku o 3 bajty w lewo\n"
-"                     'write sequence 1 5' zapis cyklicznie liczb [1-5] przez\n"
+"                     'write sequence 1 5' zapis cyklicznie liczb [1-5] "
+"przez\n"
 "                               cały blok.\n"
 "  Tryb znakowy:      'write \"To_jest_nazwa_pliku\" - zapis łańcucha\n"
 "                               zakończonego znakiem NUL.\n"
 "\n"
 " W trybie danych samo 'write' wypisze listę bardziej specyficznych poleceń.\n"
 "\n"
+" Podanie opcji -c pozwala na zapis nieprawidłowych (uszkodzonych) danych,\n"
+" z błędną sumą CRC. Podanie opcji -d pozwala na zapis błędnych danych, ale\n"
+" przeliczy CRC, co zmusza do sprawdzenia i odpowiedniego wykrycia\n"
+" nieprawidłowych danych.\n"
+"\n"
 
-#: .././db/write.c:95
+#: .././db/write.c:104
 #, c-format
 msgid "%s started in read only mode, writing disabled\n"
 msgstr "%s uruchomiono w trybie tylko do odczytu, zapis wyłączony\n"
 
-#: .././db/write.c:107
+#: .././db/write.c:116
 #, c-format
 msgid "no handler function for type %s, write unsupported.\n"
 msgstr "brak funkcji obsługującej dla typu %s, zapis nie obsługiwany.\n"
 
-#: .././db/write.c:167 .././db/write.c:196 .././db/write.c:226
-#: .././db/write.c:259 .././db/write.c:295 .././db/write.c:344
-#: .././db/write.c:373
+#: .././db/write.c:130
+msgid "bad option for write command\n"
+msgstr "błędna opcja dla polecenia write\n"
+
+#: .././db/write.c:136
+msgid "Cannot specify both -c and -d options\n"
+msgstr "Nie można podać jednocześnie opcji -c i -d\n"
+
+#: .././db/write.c:144
+msgid "Cannot recalculate CRCs on this type of object\n"
+msgstr "Nie można przeliczyć CRC dla tego typu obiektu\n"
+
+#: .././db/write.c:169
+msgid "Allowing write of corrupted data and bad CRC\n"
+msgstr "Zezwolenie na zapis uszkodzonych danych i błędnej sumy CRC\n"
+
+#: .././db/write.c:172
+msgid "Allowing write of corrupted inode with good CRC\n"
+msgstr "Zezwolenie na zapis uszkodzonego i-węzła z dobrą sumą CRC\n"
+
+#: .././db/write.c:175
+msgid "Allowing write of corrupted dquot with good CRC\n"
+msgstr "Zezwolenie na zapis uszkodzonego dquot z dobrą sumą CRC\n"
+
+#: .././db/write.c:178
+msgid "Allowing write of corrupted data with good CRC\n"
+msgstr "Zezwolenie na zapis uszkodzonych danych z dobrą sumą CRC\n"
+
+#: .././db/write.c:234 .././db/write.c:263 .././db/write.c:293
+#: .././db/write.c:326 .././db/write.c:362 .././db/write.c:411
+#: .././db/write.c:440
 #, c-format
 msgid "length (%d) too large for data block size (%d)"
 msgstr "długość (%d) zbyt duża dla rozmiaru bloku danych (%d)"
 
-#: .././db/write.c:615
+#: .././db/write.c:682
 msgid "usage: write fieldname value\n"
 msgstr "składnia: write nazwa-pola wartość\n"
 
-#: .././db/write.c:621
+#: .././db/write.c:688
 #, c-format
 msgid "unable to parse '%s'.\n"
 msgstr "nie można przeanalizować '%s'.\n"
 
-#: .././db/write.c:635
-msgid "parsing error\n"
-msgstr "błąd składni\n"
-
-#: .././db/write.c:654
+#: .././db/write.c:737
 #, c-format
 msgid "unable to convert value '%s'.\n"
 msgstr "nie można przekonwertować wartości '%s'.\n"
 
-#: .././db/write.c:677
+#: .././db/write.c:761
 msgid "usage (in string mode): write \"string...\"\n"
 msgstr "składnia (w trybie znakowym): write \"łańcuch...\"\n"
 
-#: .././db/write.c:719
+#: .././db/write.c:803
 msgid "write: invalid subcommand\n"
 msgstr "write: błędne podpolecenie\n"
 
-#: .././db/write.c:724
+#: .././db/write.c:808
 #, c-format
 msgid "write %s: invalid number of arguments\n"
 msgstr "write %s: błędna liczba argumentów\n"
 
-#: .././db/write.c:748
+#: .././db/write.c:832
 msgid "usage: write (in data mode)\n"
 msgstr "składnia: write (w trybie danych)\n"
 
@@ -2984,8 +3414,12 @@ msgstr "już jest przypisany wewnętrzny
 
 #: .././estimate/xfs_estimate.c:160
 #, c-format
-msgid "directory                               bsize   blocks    megabytes    logsize\n"
-msgstr "katalog                                 rozmb   bloków    megabajtów  rozm.logu\n"
+msgid ""
+"directory                               bsize   blocks    megabytes    "
+"logsize\n"
+msgstr ""
+"katalog                                 rozmb   bloków    megabajtów  rozm."
+"logu\n"
 
 #: .././estimate/xfs_estimate.c:174
 #, c-format
@@ -3042,37 +3476,34 @@ msgstr "\tz zewnętrznym logiem zajmują
 msgid "or about %.1f megabytes\n"
 msgstr "lub około %.1f megabajtów\n"
 
-#: .././fsr/xfs_fsr.c:194
-#, c-format
-msgid "%s: cannot read %s\n"
-msgstr "%s: nie można odczytać %s\n"
-
-#: .././fsr/xfs_fsr.c:273
+#: .././fsr/xfs_fsr.c:268
 #, c-format
 msgid "%s: Stats not yet supported for XFS\n"
 msgstr "%s: statystyki nie są jeszcze obsługiwane dla XFS-a\n"
 
-#: .././fsr/xfs_fsr.c:337
+#: .././fsr/xfs_fsr.c:332
 #, c-format
 msgid "%s: could not stat: %s: %s\n"
 msgstr "%s: nie można wykonać stat: %s: %s\n"
 
-#: .././fsr/xfs_fsr.c:356
+#: .././fsr/xfs_fsr.c:351
 #, c-format
 msgid "%s: char special not supported: %s\n"
 msgstr "%s: urządzenia znakowe nie są obsługiwane: %s\n"
 
-#: .././fsr/xfs_fsr.c:362
+#: .././fsr/xfs_fsr.c:357
 #, c-format
 msgid "%s: cannot defragment: %s: Not XFS\n"
 msgstr "%s: nie można zdefragmentować: %s: to nie jest XFS\n"
 
-#: .././fsr/xfs_fsr.c:372
+#: .././fsr/xfs_fsr.c:367
 #, c-format
 msgid "%s: not fsys dev, dir, or reg file, ignoring\n"
-msgstr "%s: nie jest urządzeniem z systemem plików, katalogiem ani zwykłym plikiem, zignorowano\n"
+msgstr ""
+"%s: nie jest urządzeniem z systemem plików, katalogiem ani zwykłym plikiem, "
+"zignorowano\n"
 
-#: .././fsr/xfs_fsr.c:387
+#: .././fsr/xfs_fsr.c:382
 #, c-format
 msgid ""
 "Usage: %s [-d] [-v] [-g] [-t time] [-p passes] [-f leftf] [-m mtab]\n"
@@ -3094,7 +3525,8 @@ msgstr ""
 "          %s -V\n"
 "\n"
 "Opcje:\n"
-"       -g              Pisanie do sysloga (domyślne jeśli stdout to nie tty).\n"
+"       -g              Pisanie do sysloga (domyślne jeśli stdout to nie "
+"tty).\n"
 "       -t czas         Czas działania w sekundach.\n"
 "       -p przebiegi    Liczba przebiegów przed zakończeniem reorganizacji.\n"
 "       -f leftoff      Użycie tego pliku zamiast %s.\n"
@@ -3103,206 +3535,202 @@ msgstr ""
 "       -v              Tym więcej szczegółów, im więcej opcji -v.\n"
 "       -V              Wypisanie informacji o wersji i zakończenie.\n"
 
-#: .././fsr/xfs_fsr.c:417
-#, c-format
-msgid "could not open mtab file: %s\n"
-msgstr "nie udało się otworzyć pliku mtab: %s\n"
-
-#: .././fsr/xfs_fsr.c:423 .././fsr/xfs_fsr.c:455
+#: .././fsr/xfs_fsr.c:412 .././fsr/xfs_fsr.c:450
 #, c-format
 msgid "out of memory: %s\n"
 msgstr "brak pamięci: %s\n"
 
-#: .././fsr/xfs_fsr.c:446
+#: .././fsr/xfs_fsr.c:441
 #, c-format
 msgid "Skipping %s: not mounted rw\n"
 msgstr "Pominięto %s: nie zamontowany rw\n"
 
-#: .././fsr/xfs_fsr.c:460
+#: .././fsr/xfs_fsr.c:455
 #, c-format
 msgid "out of memory on realloc: %s\n"
 msgstr "brak pamięci przy realloc: %s\n"
 
-#: .././fsr/xfs_fsr.c:471 .././fsr/xfs_fsr.c:475
+#: .././fsr/xfs_fsr.c:466 .././fsr/xfs_fsr.c:470
 #, c-format
 msgid "strdup(%s) failed\n"
 msgstr "strdup(%s) nie powiodło się\n"
 
-#: .././fsr/xfs_fsr.c:485
+#: .././fsr/xfs_fsr.c:481
 #, c-format
 msgid "no rw xfs file systems in mtab: %s\n"
 msgstr "brak w pliku mtab systemów plików xfs w trybie rw: %s\n"
 
-#: .././fsr/xfs_fsr.c:489
+#: .././fsr/xfs_fsr.c:485
 #, c-format
 msgid "Found %d mounted, writable, XFS filesystems\n"
-msgstr "Liczba znalezionych zamontowanych, zapisywalnych systemów plików XFS: %d\n"
+msgstr ""
+"Liczba znalezionych zamontowanych, zapisywalnych systemów plików XFS: %d\n"
 
-#: .././fsr/xfs_fsr.c:519
+#: .././fsr/xfs_fsr.c:515
 #, c-format
 msgid "%s: open failed\n"
 msgstr "%s: open nie powiodło się\n"
 
-#: .././fsr/xfs_fsr.c:534
+#: .././fsr/xfs_fsr.c:530
 #, c-format
 msgid "Can't use %s: mode=0%o own=%d nlink=%d\n"
 msgstr "Nie można użyć %s: mode=0%o own=%d nlink=%d\n"
 
-#: .././fsr/xfs_fsr.c:554
+#: .././fsr/xfs_fsr.c:550
 #, c-format
 msgid "could not read %s, starting with %s\n"
 msgstr "nie można odczytać %s, rozpoczęcie z %s\n"
 
-#: .././fsr/xfs_fsr.c:593
+#: .././fsr/xfs_fsr.c:589
 #, c-format
 msgid "START: pass=%d ino=%llu %s %s\n"
 msgstr "START: przebieg=%d i-węzeł=%llu %s %s\n"
 
-#: .././fsr/xfs_fsr.c:610
+#: .././fsr/xfs_fsr.c:606
 #, c-format
 msgid "Completed all %d passes\n"
 msgstr "Zakończono wszystkie przebiegi w liczbie %d\n"
 
-#: .././fsr/xfs_fsr.c:620
+#: .././fsr/xfs_fsr.c:616
 msgid "couldn't fork sub process:"
 msgstr "nie udało się uruchomić podprocesu:"
 
-#: .././fsr/xfs_fsr.c:655
+#: .././fsr/xfs_fsr.c:651
 #, c-format
 msgid "%s startpass %d, endpass %d, time %d seconds\n"
 msgstr "%s pocz. przebieg %d, końc. przebieg %d, czas %d sekund\n"
 
-#: .././fsr/xfs_fsr.c:662
+#: .././fsr/xfs_fsr.c:658
 #, c-format
 msgid "open(%s) failed: %s\n"
 msgstr "open(%s) nie powiodło się: %s\n"
 
-#: .././fsr/xfs_fsr.c:668
+#: .././fsr/xfs_fsr.c:664
 #, c-format
 msgid "write(%s) failed: %s\n"
 msgstr "write(%s) nie powiodło się: %s\n"
 
-#: .././fsr/xfs_fsr.c:692
+#: .././fsr/xfs_fsr.c:688
 #, c-format
 msgid "%s start inode=%llu\n"
 msgstr "%s pocz. i-węzeł=%llu\n"
 
-#: .././fsr/xfs_fsr.c:697
+#: .././fsr/xfs_fsr.c:693
 #, c-format
 msgid "unable to get handle: %s: %s\n"
 msgstr "nie udało się uzyskać uchwytu: %s: %s\n"
 
-#: .././fsr/xfs_fsr.c:703
+#: .././fsr/xfs_fsr.c:699
 #, c-format
 msgid "unable to open: %s: %s\n"
 msgstr "nie udało się otworzyć: %s: %s\n"
 
-#: .././fsr/xfs_fsr.c:709
+#: .././fsr/xfs_fsr.c:706
 #, c-format
 msgid "Skipping %s: could not get XFS geometry\n"
 msgstr "Pominięto %s: nie można odczytać geometrii XFS\n"
 
-#: .././fsr/xfs_fsr.c:743
+#: .././fsr/xfs_fsr.c:741
 #, c-format
 msgid "could not open: inode %llu\n"
 msgstr "nie udało się otworzyć: i-węzeł %llu\n"
 
-#: .././fsr/xfs_fsr.c:773
+#: .././fsr/xfs_fsr.c:771
 #, c-format
 msgid "%s: xfs_bulkstat: %s\n"
 msgstr "%s: xfs_bulkstat: %s\n"
 
-#: .././fsr/xfs_fsr.c:799
+#: .././fsr/xfs_fsr.c:798
 #, c-format
 msgid "%s: Directory defragmentation not supported\n"
 msgstr "%s: Defragmentacja katalogów nie jest obsługiwana\n"
 
-#: .././fsr/xfs_fsr.c:818
+#: .././fsr/xfs_fsr.c:817
 #, c-format
 msgid "unable to construct sys handle for %s: %s\n"
 msgstr "nie udało się utworzyć uchwytu systemowego dla %s: %s\n"
 
-#: .././fsr/xfs_fsr.c:829
+#: .././fsr/xfs_fsr.c:828
 #, c-format
 msgid "unable to open sys handle for %s: %s\n"
 msgstr "nie udało się otworzyć uchwytu systemowego dla %s: %s\n"
 
-#: .././fsr/xfs_fsr.c:835
+#: .././fsr/xfs_fsr.c:834
 #, c-format
 msgid "unable to get bstat on %s: %s\n"
 msgstr "nie udało się uzyskać bstat na %s: %s\n"
 
-#: .././fsr/xfs_fsr.c:843
+#: .././fsr/xfs_fsr.c:841
 #, c-format
 msgid "unable to open handle %s: %s\n"
 msgstr "nie udało się otworzyć uchwytu %s: %s\n"
 
-#: .././fsr/xfs_fsr.c:851
+#: .././fsr/xfs_fsr.c:848
 #, c-format
 msgid "Unable to get geom on fs for: %s\n"
 msgstr "Nie udało się odczytać geometrii systemu plików dla: %s\n"
 
-#: .././fsr/xfs_fsr.c:900
+#: .././fsr/xfs_fsr.c:899
 #, c-format
 msgid "sync failed: %s: %s\n"
 msgstr "sync nie powiodło się: %s: %s\n"
 
-#: .././fsr/xfs_fsr.c:906
+#: .././fsr/xfs_fsr.c:905
 #, c-format
 msgid "%s: zero size, ignoring\n"
 msgstr "%s: zerowy rozmiar, zignorowano\n"
 
-#: .././fsr/xfs_fsr.c:925
+#: .././fsr/xfs_fsr.c:924
 #, c-format
 msgid "locking check failed: %s\n"
 msgstr "sprawdzenie blokowania nie powiodło się: %s\n"
 
-#: .././fsr/xfs_fsr.c:932
+#: .././fsr/xfs_fsr.c:931
 #, c-format
 msgid "mandatory lock: %s: ignoring\n"
 msgstr "obowiązkowa blokada: %s: zignorowano\n"
 
-#: .././fsr/xfs_fsr.c:945
+#: .././fsr/xfs_fsr.c:944
 #, c-format
 msgid "unable to get fs stat on %s: %s\n"
 msgstr "nie udało się uzyskać stat fs na %s: %s\n"
 
-#: .././fsr/xfs_fsr.c:952
+#: .././fsr/xfs_fsr.c:951
 #, c-format
 msgid "insufficient freespace for: %s: size=%lld: ignoring\n"
 msgstr "niewystarczająca ilość miejsca dla: %s: rozmiar=%lld: zignorowano\n"
 
-#: .././fsr/xfs_fsr.c:959
+#: .././fsr/xfs_fsr.c:958
 #, c-format
 msgid "failed to get inode attrs: %s\n"
 msgstr "nie udało się uzyskać atrybutów i-węzła: %s\n"
 
-#: .././fsr/xfs_fsr.c:964
+#: .././fsr/xfs_fsr.c:963
 #, c-format
 msgid "%s: immutable/append, ignoring\n"
 msgstr "%s: niezmienny/tylko do dołączania, zignorowano\n"
 
-#: .././fsr/xfs_fsr.c:969
+#: .././fsr/xfs_fsr.c:968
 #, c-format
 msgid "%s: marked as don't defrag, ignoring\n"
 msgstr "%s: oznaczony jako nie do defragmentacji, zignorowano\n"
 
-#: .././fsr/xfs_fsr.c:975
+#: .././fsr/xfs_fsr.c:974
 #, c-format
 msgid "cannot get realtime geometry for: %s\n"
 msgstr "nie można uzyskać geometrii realtime dla: %s\n"
 
-#: .././fsr/xfs_fsr.c:980
+#: .././fsr/xfs_fsr.c:979
 #, c-format
 msgid "low on realtime free space: %s: ignoring file\n"
 msgstr "mało wolnego miejsca realtime: %s: plik zignorowany\n"
 
-#: .././fsr/xfs_fsr.c:987
+#: .././fsr/xfs_fsr.c:986
 #, c-format
 msgid "cannot open: %s: Permission denied\n"
 msgstr "nie można otworzyć: %s: brak uprawnień\n"
 
-#: .././fsr/xfs_fsr.c:1045 .././fsr/xfs_fsr.c:1095 .././fsr/xfs_fsr.c:1187
+#: .././fsr/xfs_fsr.c:1045 .././fsr/xfs_fsr.c:1095 .././fsr/xfs_fsr.c:1175
 msgid "could not set ATTR\n"
 msgstr "nie udało się ustawić ATTR\n"
 
@@ -3321,211 +3749,207 @@ msgstr "nie udało się uzyskać bstat p
 msgid "orig forkoff %d, temp forkoff %d\n"
 msgstr "orig forkoff %d, temp forkoff %d\n"
 
-#: .././fsr/xfs_fsr.c:1126
-msgid "FSGETXATTRA failed on target\n"
-msgstr "FSGETXATTRA nie powiodło się na docelowym urządzeniu\n"
-
-#: .././fsr/xfs_fsr.c:1142
+#: .././fsr/xfs_fsr.c:1130
 msgid "big ATTR set failed\n"
 msgstr "duży zbiór ATTR nie powiódł się\n"
 
-#: .././fsr/xfs_fsr.c:1163
+#: .././fsr/xfs_fsr.c:1151
 #, c-format
 msgid "forkoff diff %d too large!\n"
 msgstr "różnica forkoff %d zbyt duża!\n"
 
-#: .././fsr/xfs_fsr.c:1180
+#: .././fsr/xfs_fsr.c:1168
 #, c-format
 msgid "data fork growth unimplemented\n"
-msgstr "powiększanie odgałęzienia danych nie jest zaimplementowane\n"
+msgstr "powiększanie gałęzi danych nie jest zaimplementowane\n"
 
-#: .././fsr/xfs_fsr.c:1195
+#: .././fsr/xfs_fsr.c:1183
 msgid "set temp attr\n"
 msgstr "ustawianie atrybutów pliku tymczasowego\n"
 
-#: .././fsr/xfs_fsr.c:1198
+#: .././fsr/xfs_fsr.c:1186
 msgid "failed to match fork offset\n"
-msgstr "nie udało się dopasować offsetu odgałęzienia\n"
+msgstr "nie udało się dopasować offsetu gałęzi\n"
 
-#: .././fsr/xfs_fsr.c:1244
+#: .././fsr/xfs_fsr.c:1233
 #, c-format
 msgid "%s already fully defragmented.\n"
 msgstr "%s jest już całkowicie zdefragmentowany.\n"
 
-#: .././fsr/xfs_fsr.c:1250
+#: .././fsr/xfs_fsr.c:1239
 #, c-format
 msgid "%s extents=%d can_save=%d tmp=%s\n"
 msgstr "%s extents=%d can_save=%d tmp=%s\n"
 
-#: .././fsr/xfs_fsr.c:1256
+#: .././fsr/xfs_fsr.c:1245
 #, c-format
 msgid "could not open tmp file: %s: %s\n"
 msgstr "nie udało się otworzyć pliku tymczasowego: %s: %s\n"
 
-#: .././fsr/xfs_fsr.c:1264
+#: .././fsr/xfs_fsr.c:1253
 #, c-format
 msgid "failed to set ATTR fork on tmp: %s:\n"
-msgstr "nie udało się ustawić odgałęzienia ATTR na tmp: %s\n"
+msgstr "nie udało się ustawić gałęzi ATTR na tmp: %s\n"
 
-#: .././fsr/xfs_fsr.c:1271
+#: .././fsr/xfs_fsr.c:1260
 #, c-format
 msgid "could not set inode attrs on tmp: %s\n"
 msgstr "nie udało się ustawić atrybutów i-węzła na tmp: %s\n"
 
-#: .././fsr/xfs_fsr.c:1278
+#: .././fsr/xfs_fsr.c:1267
 #, c-format
 msgid "could not get DirectIO info on tmp: %s\n"
 msgstr "nie udało się uzyskać informacji o bezpośrednim we/wy na tmp: %s\n"
 
-#: .././fsr/xfs_fsr.c:1293
+#: .././fsr/xfs_fsr.c:1282
 #, c-format
 msgid "DEBUG: fsize=%lld blsz_dio=%d d_min=%d d_max=%d pgsz=%d\n"
 msgstr "DEBUG: fsize=%lld blsz_dio=%d d_min=%d d_max=%d pgsz=%d\n"
 
-#: .././fsr/xfs_fsr.c:1300
+#: .././fsr/xfs_fsr.c:1289
 #, c-format
 msgid "could not allocate buf: %s\n"
 msgstr "nie udało się przydzielić bufora: %s\n"
 
-#: .././fsr/xfs_fsr.c:1310
+#: .././fsr/xfs_fsr.c:1299
 #, c-format
 msgid "could not open fragfile: %s : %s\n"
 msgstr "nie udało się otworzyć pliku frag: %s: %s\n"
 
-#: .././fsr/xfs_fsr.c:1325
+#: .././fsr/xfs_fsr.c:1314
 #, c-format
 msgid "could not trunc tmp %s\n"
 msgstr "nie udało się uciąć tmp %s\n"
 
-#: .././fsr/xfs_fsr.c:1329 .././fsr/xfs_fsr.c:1349 .././fsr/xfs_fsr.c:1377
+#: .././fsr/xfs_fsr.c:1318 .././fsr/xfs_fsr.c:1338 .././fsr/xfs_fsr.c:1366
 #, c-format
 msgid "could not lseek in tmpfile: %s : %s\n"
 msgstr "nie udało się przemieścić (lseek) w pliku tymczasowym: %s: %s\n"
 
-#: .././fsr/xfs_fsr.c:1344
+#: .././fsr/xfs_fsr.c:1333
 #, c-format
 msgid "could not pre-allocate tmp space: %s\n"
 msgstr "nie udało się wstępnie przydzielić miejsca tmp: %s\n"
 
-#: .././fsr/xfs_fsr.c:1357
+#: .././fsr/xfs_fsr.c:1346
 msgid "Couldn't rewind on temporary file\n"
 msgstr "Nie udało się przewinąć pliku tymczasowego\n"
 
-#: .././fsr/xfs_fsr.c:1364
+#: .././fsr/xfs_fsr.c:1353
 #, c-format
 msgid "Temporary file has %d extents (%d in original)\n"
 msgstr "Plik tymczasowy ma ekstentów: %d (%d w oryginale)\n"
 
-#: .././fsr/xfs_fsr.c:1367
+#: .././fsr/xfs_fsr.c:1356
 #, c-format
 msgid "No improvement will be made (skipping): %s\n"
 msgstr "Nie nastąpi poprawa (pominięto): %s\n"
 
-#: .././fsr/xfs_fsr.c:1382
+#: .././fsr/xfs_fsr.c:1371
 #, c-format
 msgid "could not lseek in file: %s : %s\n"
 msgstr "nie udało się przemieścić (lseek) w pliku: %s: %s\n"
 
-#: .././fsr/xfs_fsr.c:1418
+#: .././fsr/xfs_fsr.c:1407
 #, c-format
 msgid "bad read of %d bytes from %s: %s\n"
 msgstr "błędny odczyt %d bajtów z %s: %s\n"
 
-#: .././fsr/xfs_fsr.c:1422 .././fsr/xfs_fsr.c:1454
+#: .././fsr/xfs_fsr.c:1411 .././fsr/xfs_fsr.c:1443
 #, c-format
 msgid "bad write of %d bytes to %s: %s\n"
 msgstr "błędny zapis %d bajtów do %s: %s\n"
 
-#: .././fsr/xfs_fsr.c:1439
+#: .././fsr/xfs_fsr.c:1428
 #, c-format
 msgid "bad write2 of %d bytes to %s: %s\n"
 msgstr "błędny zapis 2 %d bajtów do %s: %s\n"
 
-#: .././fsr/xfs_fsr.c:1444
+#: .././fsr/xfs_fsr.c:1433
 #, c-format
 msgid "bad copy to %s\n"
 msgstr "błędna kopia do %s\n"
 
-#: .././fsr/xfs_fsr.c:1462
+#: .././fsr/xfs_fsr.c:1451
 #, c-format
 msgid "could not truncate tmpfile: %s : %s\n"
 msgstr "nie udało się obciąć pliku tymczasowego: %s: %s\n"
 
-#: .././fsr/xfs_fsr.c:1467
+#: .././fsr/xfs_fsr.c:1456
 #, c-format
 msgid "could not fsync tmpfile: %s : %s\n"
 msgstr "nie udało się wykonać fsync pliku tymczasowego: %s: %s\n"
 
-#: .././fsr/xfs_fsr.c:1482
+#: .././fsr/xfs_fsr.c:1471
 #, c-format
 msgid "failed to fchown tmpfile %s: %s\n"
 msgstr "nie udało się wykonać fchown na pliku tymczasowym %s: %s\n"
 
-#: .././fsr/xfs_fsr.c:1492
+#: .././fsr/xfs_fsr.c:1481
 #, c-format
 msgid "%s: file type not supported\n"
 msgstr "%s: tym pliku nie obsługiwany\n"
 
-#: .././fsr/xfs_fsr.c:1496
+#: .././fsr/xfs_fsr.c:1485
 #, c-format
 msgid "%s: file modified defrag aborted\n"
 msgstr "%s: plik zmodyfikowany, defragmentacja przerwana\n"
 
-#: .././fsr/xfs_fsr.c:1501
+#: .././fsr/xfs_fsr.c:1490
 #, c-format
 msgid "%s: file busy\n"
 msgstr "%s: plik zajęty\n"
 
-#: .././fsr/xfs_fsr.c:1503
+#: .././fsr/xfs_fsr.c:1492
 #, c-format
 msgid "XFS_IOC_SWAPEXT failed: %s: %s\n"
 msgstr "XFS_IOC_SWAPEXT nie powiodło się: %s: %s\n"
 
-#: .././fsr/xfs_fsr.c:1511
+#: .././fsr/xfs_fsr.c:1500
 #, c-format
 msgid "extents before:%d after:%d %s %s\n"
 msgstr "ekstentów przed: %d po: %d %s %s\n"
 
-#: .././fsr/xfs_fsr.c:1545
+#: .././fsr/xfs_fsr.c:1534
 #, c-format
 msgid "tmp file name too long: %s\n"
 msgstr "nazwa pliku tymczasowego zbyt długa: %s\n"
 
-#: .././fsr/xfs_fsr.c:1595
+#: .././fsr/xfs_fsr.c:1584
 #, c-format
 msgid "realloc failed: %s\n"
 msgstr "realloc nie powiodło się: %s\n"
 
-#: .././fsr/xfs_fsr.c:1608
+#: .././fsr/xfs_fsr.c:1597
 #, c-format
 msgid "malloc failed: %s\n"
 msgstr "malloc nie powiodło się: %s\n"
 
-#: .././fsr/xfs_fsr.c:1638
+#: .././fsr/xfs_fsr.c:1627
 #, c-format
 msgid "failed reading extents: inode %llu"
 msgstr "nie udało się odczytać ekstentów: i-węzeł %llu"
 
-#: .././fsr/xfs_fsr.c:1688
+#: .././fsr/xfs_fsr.c:1677
 msgid "failed reading extents"
 msgstr "nie udało się odczytać ekstentów"
 
-#: .././fsr/xfs_fsr.c:1776 .././fsr/xfs_fsr.c:1790
+#: .././fsr/xfs_fsr.c:1765 .././fsr/xfs_fsr.c:1779
 #, c-format
 msgid "tmpdir already exists: %s\n"
 msgstr "katalog tymczasowy już istnieje: %s\n"
 
-#: .././fsr/xfs_fsr.c:1779
+#: .././fsr/xfs_fsr.c:1768
 #, c-format
 msgid "could not create tmpdir: %s: %s\n"
 msgstr "nie udało się utworzyć katalogu tymczasowego: %s: %s\n"
 
-#: .././fsr/xfs_fsr.c:1792
+#: .././fsr/xfs_fsr.c:1781
 #, c-format
 msgid "cannot create tmpdir: %s: %s\n"
 msgstr "nie można utworzyć katalogu tymczasowego: %s: %s\n"
 
-#: .././fsr/xfs_fsr.c:1830 .././fsr/xfs_fsr.c:1838
+#: .././fsr/xfs_fsr.c:1819 .././fsr/xfs_fsr.c:1827
 #, c-format
 msgid "could not remove tmpdir: %s: %s\n"
 msgstr "nie udało się usunąć katalogu tymczasowego: %s: %s\n"
@@ -3567,12 +3991,13 @@ msgstr ""
 "\t-m imaxpct  ustawienie maksymalnego procentu i-węzłów na imaxpct\n"
 "\t-V          wypisanie informacji o wersji\n"
 
-#: .././growfs/xfs_growfs.c:63
+#: .././growfs/xfs_growfs.c:66
 #, c-format
 msgid ""
 "meta-data=%-22s isize=%-6u agcount=%u, agsize=%u blks\n"
 "         =%-22s sectsz=%-5u attr=%u, projid32bit=%u\n"
-"         =%-22s crc=%-8u finobt=%u\n"
+"         =%-22s crc=%-8u finobt=%u spinodes=%u rmapbt=%u\n"
+"         =%-22s reflink=%u\n"
 "data     =%-22s bsize=%-6u blocks=%llu, imaxpct=%u\n"
 "         =%-22s sunit=%-6u swidth=%u blks\n"
 "naming   =version %-14u bsize=%-6u ascii-ci=%d ftype=%d\n"
@@ -3582,161 +4007,163 @@ msgid ""
 msgstr ""
 "metadane=%-22s isize=%-6u agcount=%u, agsize=%u bloków\n"
 "        =%-22s sectsz=%-5u attr=%u, projid32bit=%u\n"
-"        =%-22s crc=%-8u finobt=%u\n"
+"        =%-22s crc=%-8u finobt=%u spinodes=%u rmapbt=%u\n"
+"        =%-22s reflink=%u\n"
 "dane    =%-22s bsize=%-6u blocks=%llu, imaxpct=%u\n"
 "        =%-22s sunit=%-6u swidth=%u bloków\n"
-"nazwy   =wersja %-14u bsize=%-6u ascii-ci=%d ftype=%d\n"
+"nazwy   =wersja %-14u  bsize=%-6u ascii-ci=%d ftype=%d\n"
 "log     =%-22s bsize=%-6u blocks=%u, wersja=%u\n"
 "        =%-22s sectsz=%-5u sunit=%u bloków, lazy-count=%u\n"
 "realtime=%-22s extsz=%-6u blocks=%llu, rtextents=%llu\n"
 
-#: .././growfs/xfs_growfs.c:80 .././growfs/xfs_growfs.c:453
-#: .././growfs/xfs_growfs.c:454
+#: .././growfs/xfs_growfs.c:85 .././growfs/xfs_growfs.c:466
+#: .././growfs/xfs_growfs.c:467
 msgid "internal"
 msgstr "wewnętrzny"
 
-#: .././growfs/xfs_growfs.c:80 .././growfs/xfs_growfs.c:83
-#: .././growfs/xfs_growfs.c:453 .././growfs/xfs_growfs.c:454
+#: .././growfs/xfs_growfs.c:85 .././growfs/xfs_growfs.c:88
+#: .././growfs/xfs_growfs.c:466 .././growfs/xfs_growfs.c:467
 msgid "external"
 msgstr "zewnętrzny"
 
-#: .././growfs/xfs_growfs.c:199
+#: .././growfs/xfs_growfs.c:207
 #, c-format
 msgid "%s: %s is not a mounted XFS filesystem\n"
-msgstr "%s: %s nie jest podmontowanym systemem plików XFS\n"
+msgstr "%s: %s nie jest zamontowanym systemem plików XFS\n"
 
-#: .././growfs/xfs_growfs.c:216
+#: .././growfs/xfs_growfs.c:224
 #, c-format
 msgid "%s: specified file [\"%s\"] is not on an XFS filesystem\n"
 msgstr "%s: podany plik [\"%s\"] nie jest na systemie plików XFS\n"
 
-#: .././growfs/xfs_growfs.c:233
+#: .././growfs/xfs_growfs.c:241
 #, c-format
 msgid "%s: cannot determine geometry of filesystem mounted at %s: %s\n"
-msgstr "%s: nie można określić geometrii systemu plików podmontowanego pod %s: %s\n"
+msgstr ""
+"%s: nie można określić geometrii systemu plików zamontowanego pod %s: %s\n"
 
-#: .././growfs/xfs_growfs.c:273
+#: .././growfs/xfs_growfs.c:285
 #, c-format
 msgid "%s: failed to access data device for %s\n"
 msgstr "%s: nie udało się uzyskać dostępu do urządzenia z danymi dla %s\n"
 
-#: .././growfs/xfs_growfs.c:278
+#: .././growfs/xfs_growfs.c:290
 #, c-format
 msgid "%s: failed to access external log for %s\n"
 msgstr "%s: nie udało się uzyskać dostępu do zewnętrznego logu dla %s\n"
 
-#: .././growfs/xfs_growfs.c:284
+#: .././growfs/xfs_growfs.c:296
 #, c-format
 msgid "%s: failed to access realtime device for %s\n"
 msgstr "%s: nie udało się uzyskać dostępu do urządzenia realtime dla %s\n"
 
-#: .././growfs/xfs_growfs.c:323
+#: .././growfs/xfs_growfs.c:336
 #, c-format
 msgid "data size %lld too large, maximum is %lld\n"
 msgstr "rozmiar danych %lld zbyt duży, maksymalny to %lld\n"
 
-#: .././growfs/xfs_growfs.c:330
+#: .././growfs/xfs_growfs.c:343
 #, c-format
 msgid "data size %lld too small, old size is %lld\n"
 msgstr "rozmiar danych %lld zbyt mały, stary rozmiar to %lld\n"
 
-#: .././growfs/xfs_growfs.c:338
+#: .././growfs/xfs_growfs.c:351
 #, c-format
 msgid "data size unchanged, skipping\n"
 msgstr "rozmiar danych nie zmieniony, pominięto\n"
 
-#: .././growfs/xfs_growfs.c:341
+#: .././growfs/xfs_growfs.c:354
 #, c-format
 msgid "inode max pct unchanged, skipping\n"
 msgstr "maksymalny procent i-węzłów nie zmieniony, pominięto\n"
 
-#: .././growfs/xfs_growfs.c:348 .././growfs/xfs_growfs.c:387
-#: .././growfs/xfs_growfs.c:422
+#: .././growfs/xfs_growfs.c:361 .././growfs/xfs_growfs.c:400
+#: .././growfs/xfs_growfs.c:435
 #, c-format
 msgid "%s: growfs operation in progress already\n"
 msgstr "%s: operacja growfs już trwa\n"
 
-#: .././growfs/xfs_growfs.c:352
+#: .././growfs/xfs_growfs.c:365
 #, c-format
 msgid "%s: XFS_IOC_FSGROWFSDATA xfsctl failed: %s\n"
 msgstr "%s: xfsctl XFS_IOC_FSGROWFSDATA nie powiodło się: %s\n"
 
-#: .././growfs/xfs_growfs.c:368
+#: .././growfs/xfs_growfs.c:381
 #, c-format
 msgid "realtime size %lld too large, maximum is %lld\n"
 msgstr "rozmiar realtime %lld zbyt duży, maksymalny to %lld\n"
 
-#: .././growfs/xfs_growfs.c:374
+#: .././growfs/xfs_growfs.c:387
 #, c-format
 msgid "realtime size %lld too small, old size is %lld\n"
 msgstr "rozmiar realtime %lld zbyt mały, stary rozmiar to %lld\n"
 
-#: .././growfs/xfs_growfs.c:380
+#: .././growfs/xfs_growfs.c:393
 #, c-format
 msgid "realtime size unchanged, skipping\n"
 msgstr "rozmiar realtime nie zmieniony, pominięto\n"
 
-#: .././growfs/xfs_growfs.c:391
+#: .././growfs/xfs_growfs.c:404
 #, c-format
 msgid "%s: realtime growth not implemented\n"
 msgstr "%s: powiększanie realtime nie jest zaimplementowane\n"
 
-#: .././growfs/xfs_growfs.c:395
+#: .././growfs/xfs_growfs.c:408
 #, c-format
 msgid "%s: XFS_IOC_FSGROWFSRT xfsctl failed: %s\n"
 msgstr "%s: xfsctl XFS_IOC_FSGROWFSRT nie powiodło się: %s\n"
 
-#: .././growfs/xfs_growfs.c:416
+#: .././growfs/xfs_growfs.c:429
 #, c-format
 msgid "log size unchanged, skipping\n"
 msgstr "rozmiar logu nie zmieniony, pominięto\n"
 
-#: .././growfs/xfs_growfs.c:426
+#: .././growfs/xfs_growfs.c:439
 #, c-format
 msgid "%s: log growth not supported yet\n"
 msgstr "%s: powiększanie logu nie jest jeszcze obsługiwane\n"
 
-#: .././growfs/xfs_growfs.c:430
+#: .././growfs/xfs_growfs.c:443
 #, c-format
 msgid "%s: XFS_IOC_FSGROWFSLOG xfsctl failed: %s\n"
 msgstr "%s: xfsctl XFS_IOC_FSGROWFSLOG nie powiodło się: %s\n"
 
-#: .././growfs/xfs_growfs.c:438
+#: .././growfs/xfs_growfs.c:451
 #, c-format
 msgid "%s: XFS_IOC_FSGEOMETRY xfsctl failed: %s\n"
 msgstr "%s: xfsctl XFS_IOC_FSGEOMETRY nie powiodło się: %s\n"
 
-#: .././growfs/xfs_growfs.c:443
+#: .././growfs/xfs_growfs.c:456
 #, c-format
 msgid "data blocks changed from %lld to %lld\n"
 msgstr "bloki danych zmienione z %lld na %lld\n"
 
-#: .././growfs/xfs_growfs.c:446
+#: .././growfs/xfs_growfs.c:459
 #, c-format
 msgid "inode max percent changed from %d to %d\n"
 msgstr "maksymalny procent i-węzłów zmieniony z %d na %d\n"
 
-#: .././growfs/xfs_growfs.c:449
+#: .././growfs/xfs_growfs.c:462
 #, c-format
 msgid "log blocks changed from %d to %d\n"
 msgstr "bloki logu zmienione z %d na %d\n"
 
-#: .././growfs/xfs_growfs.c:452
+#: .././growfs/xfs_growfs.c:465
 #, c-format
 msgid "log changed from %s to %s\n"
 msgstr "log zmieniony - był %s, jest %s\n"
 
-#: .././growfs/xfs_growfs.c:456
+#: .././growfs/xfs_growfs.c:469
 #, c-format
 msgid "realtime blocks changed from %lld to %lld\n"
 msgstr "bloki realtime zmienione z %lld na %lld\n"
 
-#: .././growfs/xfs_growfs.c:459
+#: .././growfs/xfs_growfs.c:472
 #, c-format
 msgid "realtime extent size changed from %d to %d\n"
 msgstr "rozmiar ekstentu realtime zmieniony z %d na %d\n"
 
-#: .././io/attr.c:59
+#: .././io/attr.c:60
 #, c-format
 msgid ""
 "\n"
@@ -3757,6 +4184,8 @@ msgid ""
 " E -- children created in this directory inherit the extent size value\n"
 " f -- do not include this file when defragmenting the filesystem\n"
 " S -- enable filestreams allocator for this directory\n"
+" x -- Use direct access (DAX) for data in this file\n"
+" C -- for files with shared blocks, observe the inode CoW extent size value\n"
 "\n"
 " Options:\n"
 " -R -- recursively descend (useful when current file is a directory)\n"
@@ -3766,7 +4195,8 @@ msgid ""
 "\n"
 msgstr ""
 "\n"
-" wyświetlanie zbioru rozszerzonych flag i-węzłów związanych z bieżącym plikiem\n"
+" wyświetlenie zbioru rozszerzonych flag i-węzłów związanych z bieżącym "
+"plikiem\n"
 "\n"
 " Każda flaga jest wyświetlana jako pojedynczy znak, w tej kolejności:\n"
 " r - dane pliku są zapisane w sekcji realtime\n"
@@ -3775,23 +4205,29 @@ msgstr ""
 " a - tylko do dopisywania, do pliku można tylko dopisywać\n"
 " s - wszystkie uaktualnienia są synchroniczne\n"
 " A - czas dostępu nie jest uaktualniany dla tego i-węzła\n"
-" d - nie dołączanie pliku do zrzutu systemu plików\n"
+" d - niedołączanie pliku do zrzutu systemu plików\n"
 " t - wpisy tworzone w tym katalogu mają domyślnie ustawiony bit realtime\n"
 " P - wpisy tworzone w tym katalogu mają domyślnie ID projektu rodzica\n"
 " n - w tym katalogu nie można tworzyć dowiązań symbolicznych\n"
-" e - dla plików nie-realtime - przestrzeganie wartości rozmiaru ekstentu i-węzła\n"
+" e - dla plików nie-realtime - przestrzeganie wartości rozmiaru ekstentu i-"
+"węzła\n"
 " E - wpisy tworzone w tym katalogu dziedziczą wartość rozmiaru ekstentu\n"
-" f - nie uwzględnianie tego pliku przy defragmentacji systemu plików\n"
+" f - nieuwzględnianie tego pliku przy defragmentacji systemu plików\n"
 " S - włączenie przydzielania strumieni plikowych dla tego katalogu\n"
+" x - użycie bezpośredniego dostępu (DAX) dla danych w tym pliku\n"
+" C - dla plików z blokami współdzielonymi: obserw. rozm. ekstentu CoW i-węzła\n"
 "\n"
 " Opcje:\n"
-" -R - rekurencyjne zagłębianie się (przydatne kiedy bieżący plik jest katalogiem)\n"
-" -D - rekurencyjne zagłębianie się, ale wypisywanie atrybutów tylko katalogów\n"
+" -R - rekurencyjne zagłębianie się (przydatne kiedy bieżący plik jest "
+"katalogiem)\n"
+" -D - rekurencyjne zagłębianie się, ale wypisywanie atrybutów tylko "
+"katalogów\n"
 " -a - pokazywanie wszystkich flag, które można ustawić, obok ustawionych\n"
-" -v - tryb szczegółowy; pokazywanie długich nazw flag zamiast pojedynczych znaków\n"
+" -v - tryb szczegółowy; pokazywanie długich nazw flag zamiast pojedynczych "
+"znaków\n"
 "\n"
 
-#: .././io/attr.c:90
+#: .././io/attr.c:93
 #, c-format
 msgid ""
 "\n"
@@ -3816,7 +4252,10 @@ msgid ""
 " +/-E -- set/clear the extent-size inheritance flag\n"
 " +/-f -- set/clear the no-defrag flag\n"
 " +/-S -- set/clear the filestreams allocator flag\n"
-" Note1: user must have certain capabilities to modify immutable/append-only.\n"
+" +/-x -- set/clear the direct access (DAX) flag\n"
+" +/-C -- set/clear the CoW extent-size flag\n"
+" Note1: user must have certain capabilities to modify immutable/append-"
+"only.\n"
 " Note2: immutable/append-only files cannot be deleted; removing these files\n"
 "        requires the immutable/append-only flag to be cleared first.\n"
 " Note3: the realtime flag can only be set if the filesystem has a realtime\n"
@@ -3830,7 +4269,8 @@ msgstr ""
 " 'chattr +a' - ustawia flagę tylko do dopisywania\n"
 " 'chattr -a' - zdejmuje flagę tylko do dopisywania\n"
 "\n"
-" -R - rekurencyjne zagłębianie się (przydatne kiedy bieżący plik jest katalogiem)\n"
+" -R - rekurencyjne zagłębianie się (przydatne kiedy bieżący plik jest "
+"katalogiem)\n"
 " -D - rekurencyjne zagłębianie się, ale zmiana atrybutów tylko katalogów\n"
 " +/-r - ustawienie/zdjęcie flagi realtime\n"
 " +/-i - ustawienie/zdjęcie flagi immutable (niezmienności)\n"
@@ -3845,56 +4285,60 @@ msgstr ""
 " +/-E - ustawienie/zdjęcie flagi dziedziczenia rozmiaru ekstentu\n"
 " +/-f - ustawienie/zdjęcie flagi no-defrag\n"
 " +/-S - ustawienie/zdjęcie flagi przydzielania strumieni plikowych\n"
+" +/-x - ustawienie/zdjęcie flagi bezpośredniego dostępu (DAX)\n"
+" +/-C - ustawienie/zdjęcie flagi rozmiaru ekstentu CoW\n"
 " Uwaga1: użytkownik musi mieć pewne uprawnienia do zmiany flag\n"
 "         immutable/append-only\n"
-" Uwaga2: plików immutable/append-only nie można usuwać; usuwanie tych plików\n"
+" Uwaga2: plików immutable/append-only nie można usuwać; usuwanie tych "
+"plików\n"
 "         wymaga zdjęcia flag immutable/append-only przed usunięciem.\n"
 " Uwaga3: flagę realtime można ustawić tylko jeśli system plików ma sekcję\n"
 "         realtime i (zwykły) plik musi być pusty przy ustawianiu flagi.\n"
 "\n"
 
-#: .././io/attr.c:171 .././io/attr.c:247 .././io/open.c:424 .././io/open.c:496
-#: .././io/open.c:620 .././io/open.c:642 .././libxfs/init.c:109
-#: .././mkfs/proto.c:293 .././quota/project.c:118 .././quota/project.c:163
+#: .././io/attr.c:176 .././io/attr.c:252 .././io/cowextsize.c:109
+#: .././io/cowextsize.c:132 .././io/open.c:334 .././io/open.c:406
+#: .././io/open.c:530 .././io/open.c:552 .././libxfs/init.c:127
+#: .././mkfs/proto.c:302 .././quota/project.c:118 .././quota/project.c:163
 #: .././quota/project.c:210
 #, c-format
 msgid "%s: cannot open %s: %s\n"
 msgstr "%s: nie można otworzyć %s: %s\n"
 
-#: .././io/attr.c:174 .././io/attr.c:221 .././io/attr.c:250 .././io/attr.c:321
+#: .././io/attr.c:179 .././io/attr.c:226 .././io/attr.c:255 .././io/attr.c:326
 #: .././quota/project.c:122 .././quota/project.c:168 .././quota/project.c:215
 #, c-format
 msgid "%s: cannot get flags on %s: %s\n"
 msgstr "%s: nie można pobrać flag %s: %s\n"
 
-#: .././io/attr.c:256 .././io/attr.c:327
+#: .././io/attr.c:261 .././io/attr.c:332
 #, c-format
 msgid "%s: cannot set flags on %s: %s\n"
 msgstr "%s: nie można ustawić flag %s: %s\n"
 
-#: .././io/attr.c:291 .././io/attr.c:305
+#: .././io/attr.c:296 .././io/attr.c:310
 #, c-format
 msgid "%s: unknown flag\n"
 msgstr "%s: nieznana flaga\n"
 
-#: .././io/attr.c:311
+#: .././io/attr.c:316
 #, c-format
 msgid "%s: bad chattr command, not +/-X\n"
 msgstr "%s: złe polecenie chattr - nie +/-X\n"
 
-#: .././io/attr.c:338
+#: .././io/attr.c:343
 msgid "[-R|-D] [+/-"
 msgstr "[-R|-D] [+/-"
 
-#: .././io/attr.c:343
+#: .././io/attr.c:348
 msgid "change extended inode flags on the currently open file"
 msgstr "zmiana rozszerzonych flag i-węzłów aktualnie otwartego pliku"
 
-#: .././io/attr.c:348
+#: .././io/attr.c:353
 msgid "[-R|-D|-a|-v]"
 msgstr "[-R|-D|-a|-v]"
 
-#: .././io/attr.c:353
+#: .././io/attr.c:358
 msgid "list extended inode flags set on the currently open file"
 msgstr "wypisanie rozszerzonych flag i-węzłów aktualnie otwartego pliku"
 
@@ -3914,10 +4358,13 @@ msgid ""
 " Holes are marked by replacing the startblock..endblock with 'hole'.\n"
 " All the file offsets and disk blocks are in units of 512-byte blocks.\n"
 " -a -- prints the attribute fork map instead of the data fork.\n"
+" -c -- prints the copy-on-write fork map instead of the data fork.\n"
 " -d -- suppresses a DMAPI read event, offline portions shown as holes.\n"
+" -e -- print delayed allocation extents.\n"
 " -l -- also displays the length of each extent in 512-byte blocks.\n"
 " -n -- query n extents.\n"
-" -p -- obtain all unwritten extents as well (w/ -v show which are unwritten.)\n"
+" -p -- obtain all unwritten extents as well (w/ -v show which are "
+"unwritten.)\n"
 " -v -- Verbose information, specify ag info.  Show flags legend on 2nd -v\n"
 " Note: the bmap for non-regular files can be obtained provided the file\n"
 " was opened appropriately (in particular, must be opened read-only).\n"
@@ -3937,8 +4384,12 @@ msgstr ""
 " Dziury są oznaczane przez zastąpienie blokpocz..blokkońc przez 'dziura'.\n"
 " Wszystkie offsety w plikach i bloki dysku są w jednostkach 512-bajtowych.\n"
 " -a - wypisanie mapy gałęzi atrybutów zamiast gałęzi danych.\n"
-" -d - pominięcie zdarzenia odczytu DMAPI, pokazanie części offline jako dziur.\n"
-" -l - wyświetlenie także długości każdego fragmentu w 512-bajtowych blokach.\n"
+" -c - wypisanie mapy gałęzi CoW zamiast gałęzi danych.\n"
+" -d - pominięcie zdarzenia odczytu DMAPI, pokazanie części offline jako "
+"dziur.\n"
+" -e - wypisanie ekstentów opóźnionego przydzielania.\n"
+" -l - wyświetlenie także długości każdego ekstentu w 512-bajtowych "
+"blokach.\n"
 " -n - odpytanie n ekstentów.\n"
 " -p - wypisanie także nie zapisanych ekstentów (z -v pokazuje, które są nie\n"
 "      zapisane).\n"
@@ -3948,127 +4399,281 @@ msgstr ""
 " otwarty tylko do odczytu).\n"
 "\n"
 
-#: .././io/bmap.c:123
+#: .././io/bmap.c:133
 #, c-format
 msgid "%s: can't get geometry [\"%s\"]: %s\n"
 msgstr "%s: nie można uzyskać geometrii [\"%s\"]: %s\n"
 
-#: .././io/bmap.c:131
+#: .././io/bmap.c:141
 #, c-format
 msgid "%s: cannot read attrs on \"%s\": %s\n"
 msgstr "%s: nie można odczytać atrybutów \"%s\": %s\n"
 
-#: .././io/bmap.c:149 .././io/fiemap.c:259
+#: .././io/bmap.c:159 .././io/fiemap.c:258
 #, c-format
 msgid "%s: malloc of %d bytes failed.\n"
 msgstr "%s: przydzielenie %d bajtów nie powiodło się.\n"
 
-#: .././io/bmap.c:197
+#: .././io/bmap.c:207
 #, c-format
 msgid "%s: xfsctl(XFS_IOC_GETBMAPX) iflags=0x%x [\"%s\"]: %s\n"
 msgstr "%s: xfsctl(XFS_IOC_GETBMAPX) iflags=0x%x [\"%s\"]: %s\n"
 
-#: .././io/bmap.c:228
+#: .././io/bmap.c:238
 #, c-format
 msgid "%s: cannot realloc %d bytes\n"
 msgstr "%s: nie można wykonać realloc na %d bajtów\n"
 
-#: .././io/bmap.c:237
+#: .././io/bmap.c:247
 #, c-format
 msgid "%s: no extents\n"
 msgstr "%s: brak ekstentów\n"
 
-#: .././io/bmap.c:251 .././io/bmap.c:379 .././io/fiemap.c:105
-#: .././io/fiemap.c:340 .././io/fiemap.c:344
+#: .././io/bmap.c:261 .././io/bmap.c:396 .././io/fiemap.c:104
+#: .././io/fiemap.c:339 .././io/fiemap.c:343
 #, c-format
 msgid "hole"
 msgstr "dziura"
 
-#: .././io/bmap.c:260
+#: .././io/bmap.c:263 .././io/bmap.c:404
+#, c-format
+msgid "delalloc"
+msgstr "delalloc"
+
+#: .././io/bmap.c:272
 #, c-format
 msgid " %lld blocks\n"
 msgstr " %lld bloków\n"
 
-#: .././io/bmap.c:339 .././io/fiemap.c:94
+#: .././io/bmap.c:352 .././io/fiemap.c:93
 msgid "EXT"
 msgstr "EXT"
 
-#: .././io/bmap.c:340 .././io/fiemap.c:95
+#: .././io/bmap.c:353 .././io/fiemap.c:94
 msgid "FILE-OFFSET"
 msgstr "OFFSET-W-PLIKU"
 
-#: .././io/bmap.c:341
+#: .././io/bmap.c:354
 msgid "RT-BLOCK-RANGE"
 msgstr "ZAKRES-BLOKÓW-RT"
 
-#: .././io/bmap.c:341 .././io/fiemap.c:96
+#: .././io/bmap.c:354 .././io/fiemap.c:95
 msgid "BLOCK-RANGE"
 msgstr "ZAKRES-BLOKÓW"
 
-#: .././io/bmap.c:342
+#: .././io/bmap.c:355
 msgid "AG"
 msgstr "AG"
 
-#: .././io/bmap.c:343
+#: .././io/bmap.c:356
 msgid "AG-OFFSET"
 msgstr "OFFSET-AG"
 
-#: .././io/bmap.c:344 .././io/fiemap.c:97
+#: .././io/bmap.c:357 .././io/fiemap.c:96
 msgid "TOTAL"
 msgstr "RAZEM"
 
-#: .././io/bmap.c:345
+#: .././io/bmap.c:358
 msgid " FLAGS"
 msgstr " FLAGI"
 
-#: .././io/bmap.c:413
+#: .././io/bmap.c:438
 #, c-format
 msgid " FLAG Values:\n"
 msgstr " Wartości FLAG:\n"
 
-#: .././io/bmap.c:414
+#: .././io/bmap.c:439
+#, c-format
+msgid "    %*.*o Shared extent\n"
+msgstr "    %*.*o Ekstent współdzielony\n"
+
+#: .././io/bmap.c:441
 #, c-format
 msgid "    %*.*o Unwritten preallocated extent\n"
-msgstr "    %*.*o Nie zapisany, już przydzielony ekstent\n"
+msgstr "    %*.*o Ekstent nie zapisany, już przydzielony\n"
 
-#: .././io/bmap.c:416
+#: .././io/bmap.c:443
 #, c-format
 msgid "    %*.*o Doesn't begin on stripe unit\n"
 msgstr "    %*.*o Nie zaczyna się od jednostki pasa\n"
 
-#: .././io/bmap.c:418
+#: .././io/bmap.c:445
 #, c-format
 msgid "    %*.*o Doesn't end   on stripe unit\n"
 msgstr "    %*.*o Nie kończy się na jednostce pasa\n"
 
-#: .././io/bmap.c:420
+#: .././io/bmap.c:447
 #, c-format
 msgid "    %*.*o Doesn't begin on stripe width\n"
 msgstr "    %*.*o Nie zaczyna się na szerokości pasa\n"
 
-#: .././io/bmap.c:422
+#: .././io/bmap.c:449
 #, c-format
 msgid "    %*.*o Doesn't end   on stripe width\n"
 msgstr "    %*.*o Nie kończy się na szerokości pasa\n"
 
-#: .././io/bmap.c:438
+#: .././io/bmap.c:465
 msgid "[-adlpv] [-n nx]"
 msgstr "[-adlpv] [-n nx]"
 
-#: .././io/bmap.c:439
+#: .././io/bmap.c:466
 msgid "print block mapping for an XFS file"
 msgstr "wypisanie mapowania bloków dla pliku na XFS-ie"
 
-#: .././io/fadvise.c:31
+#: .././io/copy_file_range.c:32
 #, c-format
 msgid ""
 "\n"
-" advise the page cache about expected I/O patterns on the current file\n"
+" Copies a range of bytes from a file into the open file, overwriting any "
+"data\n"
+" already there.\n"
 "\n"
-" Modifies kernel page cache behaviour when operating on the current file.\n"
-" The range arguments are required by some advise commands ([*] below).\n"
-" With no arguments, the POSIX_FADV_NORMAL advice is implied.\n"
-" -d -- don't need these pages (POSIX_FADV_DONTNEED) [*]\n"
+" Example:\n"
+" 'copy_range -s 100 -d 200 -l 300 some_file' - copies 300 bytes from "
+"some_file\n"
+"                                               at offset 100 into the open\n"
+"\t\t\t\t\t       file at offset 200\n"
+" 'copy_range some_file' - copies all bytes from some_file into the open "
+"file\n"
+"                          at position 0\n"
+msgstr ""
+"\n"
+" Skopiowanie zakresu bajtów z pliku do otwartego pliku, nadpisując wszelkie\n"
+" dane, które się tam już znajdują.\n"
+"\n"
+" Przykład:\n"
+" 'copy_range -s 100 -d 200 -l 300 jakiś_plik' - kopiuje 300 bajtów\n"
+"                                                z jakiegoś_pliku do "
+"otwartego\n"
+"                                                pliku pod offset 200\n"
+" 'copy_range jakiś_plik' - kopiuje wszystkie bajty z jakiegoś_pliku do\n"
+"                           otwartego pliku od pozycji 0\n"
+
+#: .././io/copy_file_range.c:100
+#, c-format
+msgid "invalid source offset -- %s\n"
+msgstr "nieprawidłowy offset źródłowy - %s\n"
+
+#: .././io/copy_file_range.c:107
+#, c-format
+msgid "invalid destination offset -- %s\n"
+msgstr "nieprawidłowy offset docelowy - %s\n"
+
+#: .././io/copy_file_range.c:114
+#, c-format
+msgid "invalid length -- %s\n"
+msgstr "nieprawidłowa długość - %s\n"
+
+#: .././io/copy_file_range.c:146
+msgid "[-s src_off] [-d dst_off] [-l len] src_file"
+msgstr "[-s off_źródłowy] [-d off_docelowy] [-l długość] plik_źródłowy"
+
+#: .././io/copy_file_range.c:147
+msgid "Copy a range of data between two files"
+msgstr "Kopiowanie zakresu danych między dwoma plikami"
+
+#: .././io/cowextsize.c:40
+#, c-format
+msgid ""
+"\n"
+" report or modify preferred CoW extent size (in bytes) for the current path\n"
+"\n"
+" -R -- recursively descend (useful when current path is a directory)\n"
+" -D -- recursively descend, only modifying cowextsize on directories\n"
+"\n"
+msgstr ""
+"\n"
+" odczyt lub zmiana preferowanego rozmiaru ekstentu CoW (w bajtach) dla bieżącej\n"
+" ścieżki\n"
+"\n"
+" -R - rekurencyjne zagłębianie się (przydatne kiedy bieżący plik jest "
+"katalogiem)\n"
+" -D - rekurencyjne zagłębianie się, ale zmiana cowextsize tylko katalogów\n"
+"\n"
+
+#: .././io/cowextsize.c:81 .././io/open.c:503
+#, c-format
+msgid "invalid target file type - file %s\n"
+msgstr "nieprawidłowy rodzaj bliku docelowego - plik %s\n"
+
+#: .././io/cowextsize.c:169
+#, c-format
+msgid "non-numeric cowextsize argument -- %s\n"
+msgstr "nieliczbowy argument cowextsize - %s\n"
+
+#: .././io/cowextsize.c:193
+msgid "[-D | -R] [cowextsize]"
+msgstr "[-D | -R] [rozmiar_ekstentu_cow]"
+
+#: .././io/cowextsize.c:198
+msgid "get/set preferred CoW extent size (in bytes) for the open file"
+msgstr "odczyt/ustawienie rozmiaru ekstentu CoW (w bajtach) dla otwartego pliku"
+
+#: .././io/encrypt.c:76
+#, c-format
+msgid ""
+"\n"
+" assign an encryption policy to the currently open file\n"
+"\n"
+" Examples:\n"
+" 'set_encpolicy' - assign policy with default key [0000000000000000]\n"
+" 'set_encpolicy 0000111122223333' - assign policy with specified key\n"
+"\n"
+" -c MODE -- contents encryption mode\n"
+" -n MODE -- filenames encryption mode\n"
+" -f FLAGS -- policy flags\n"
+" -v VERSION -- version of policy structure\n"
+"\n"
+" MODE can be numeric or one of the following predefined values:\n"
+"    AES-256-XTS, AES-256-CTS, AES-256-GCM, AES-256-CBC\n"
+" FLAGS and VERSION must be numeric.\n"
+"\n"
+" Note that it's only possible to set an encryption policy on an empty\n"
+" directory.  It's then inherited by new files and subdirectories.\n"
+"\n"
+msgstr ""
+"\n"
+" przypisanie polityki szyfrowania do aktualnie otwartego pliku\n"
+"\n"
+" Przykłady:\n"
+" 'set_encpolicy' - przypisanie polityki z kluczem domyślnym [0000000000000000]\n"
+" 'set_encpolicy 0000111122223333' - przypisanie polityki z podanym kluczem\n"
+"\n"
+" -c TRYB - tryb szyfrowania zawartości\n"
+" -n TRYB -- tryb szyfrowania nazw plików\n"
+" -f FLAGI -- flagi polityki\n"
+" -v WERSJA -- wersja struktury polityki\n"
+"\n"
+" TRYB może być liczbą lub jedną z następujących, predefiniowanych wartości:\n"
+"    AES-256-XTS, AES-256-CTS, AES-256-GCM, AES-256-CBC\n"
+" FLAGI i WERSJA muszą być liczbami.\n"
+"\n"
+" Uwaga: możliwe jest ustawienie polityki tylko na pustym katalogu. Następnie\n"
+" jest ona dziedziczona na nowe pliki i podkatalogi.\n"
+"\n"
+
+#: .././io/encrypt.c:287
+msgid "display the encryption policy of the current file"
+msgstr "wyświetlenie polityki szyfrowania bieżącego pliku"
+
+#: .././io/encrypt.c:292
+msgid "[-c mode] [-n mode] [-f flags] [-v version] [keydesc]"
+msgstr "[-c tryb] [-n tryb] [-f flagi] [-v wersja] [opis_klucza]"
+
+#: .././io/encrypt.c:297
+msgid "assign an encryption policy to the current file"
+msgstr "przypisanie polityki szyfrowania do bieżącego pliku"
+
+#: .././io/fadvise.c:30
+#, c-format
+msgid ""
+"\n"
+" advise the page cache about expected I/O patterns on the current file\n"
+"\n"
+" Modifies kernel page cache behaviour when operating on the current file.\n"
+" The range arguments are required by some advise commands ([*] below).\n"
+" With no arguments, the POSIX_FADV_NORMAL advice is implied.\n"
+" -d -- don't need these pages (POSIX_FADV_DONTNEED) [*]\n"
 " -n -- data will be accessed once (POSIX_FADV_NOREUSE) [*]\n"
 " -r -- expect random page references (POSIX_FADV_RANDOM)\n"
 " -s -- expect sequential page references (POSIX_FADV_SEQUENTIAL)\n"
@@ -4081,16 +4686,19 @@ msgid ""
 "\n"
 msgstr ""
 "\n"
-" doradzenie buforowi stron w sprawie oczekiwanych schematów we/wy na bieżącym\n"
+" doradzenie buforowi stron w sprawie oczekiwanych schematów we/wy na "
+"bieżącym\n"
 " pliku\n"
 "\n"
-" fadvise modyfikuje zachowanie bufora stron przy operacjach na bieżącym pliku.\n"
+" fadvise modyfikuje zachowanie bufora stron przy operacjach na bieżącym "
+"pliku.\n"
 " Niektóre polecenia fadvise ([*] poniżej) wymagają podania zakresu.\n"
 " Bez argumentów zakłada się doradzenie POSIX_FADV_NORMAL.\n"
 " -d - podane strony nie są wymagane (POSIX_FADV_DONTNEED) [*]\n"
 " -n - dostęp do danych będzie jednokrotny (POSIX_FADV_NOREUSE) [*]\n"
 " -r - należy oczekiwać losowych odwołań do stron (POSIX_FADV_RANDOM)\n"
-" -s - należy oczekiwać sekwencyjnych odwołań do stron (POSIX_FADV_SEQUENTIAL)\n"
+" -s - należy oczekiwać sekwencyjnych odwołań do stron "
+"(POSIX_FADV_SEQUENTIAL)\n"
 " -w - podane strony będą potrzebne (POSIX_FADV_WILLNEED) [*]\n"
 " Uwagi: te interfejsy nie były obsługiwane przez jądra Linuksa przed 2.6.\n"
 "  NORMAL ustawia domyślną wartość czytania z wyprzedzeniem dla pliku.\n"
@@ -4100,31 +4708,31 @@ msgstr ""
 "  z wyprzedzeniem.\n"
 "\n"
 
-#: .././io/fadvise.c:92 .././io/madvise.c:87 .././io/mincore.c:48
-#: .././io/mmap.c:206 .././io/mmap.c:301 .././io/mmap.c:387 .././io/mmap.c:546
-#: .././io/prealloc.c:65 .././io/pwrite.c:344 .././io/sendfile.c:126
-#: .././io/sync_file_range.c:75
+#: .././io/fadvise.c:91 .././io/madvise.c:86 .././io/mincore.c:47
+#: .././io/mmap.c:213 .././io/mmap.c:320 .././io/mmap.c:406 .././io/mmap.c:565
+#: .././io/mmap.c:647 .././io/prealloc.c:73 .././io/pwrite.c:346
+#: .././io/sendfile.c:124 .././io/sync_file_range.c:74
 #, c-format
 msgid "non-numeric offset argument -- %s\n"
 msgstr "nieliczbowy argument będący offsetem - %s\n"
 
-#: .././io/fadvise.c:99 .././io/madvise.c:94 .././io/mincore.c:54
-#: .././io/mmap.c:212 .././io/mmap.c:308 .././io/mmap.c:394 .././io/mmap.c:553
-#: .././io/pread.c:452 .././io/pread.c:460 .././io/prealloc.c:70
-#: .././io/pwrite.c:350 .././io/sendfile.c:133 .././io/sync_file_range.c:82
+#: .././io/fadvise.c:98 .././io/madvise.c:93 .././io/mincore.c:53
+#: .././io/mmap.c:219 .././io/mmap.c:327 .././io/mmap.c:413 .././io/mmap.c:572
+#: .././io/pread.c:454 .././io/pread.c:462 .././io/prealloc.c:78
+#: .././io/pwrite.c:352 .././io/sendfile.c:131 .././io/sync_file_range.c:81
 #, c-format
 msgid "non-numeric length argument -- %s\n"
 msgstr "nieliczbowy argument będący długością - %s\n"
 
-#: .././io/fadvise.c:122
+#: .././io/fadvise.c:121
 msgid "[-dnrsw] [off len]"
 msgstr "[-dnrsw] [offset długość]"
 
-#: .././io/fadvise.c:123
+#: .././io/fadvise.c:122
 msgid "advisory commands for sections of a file"
 msgstr "polecenia doradcze dla sekcji pliku"
 
-#: .././io/fiemap.c:32
+#: .././io/fiemap.c:31
 #, c-format
 msgid ""
 "\n"
@@ -4158,113 +4766,114 @@ msgstr ""
 " Dziury są oznaczane przez zastąpienie blokpocz..blokkońc przez 'dziura'.\n"
 " Wszystkie offsety w plikach i bloki dysku są w jednostkach 512-bajtowych.\n"
 " -a - wypisanie mapy gałęzi atrybutów zamiast gałęzi danych.\n"
-" -l - wyświetlenie także długości każdego fragmentu w 512-bajtowych blokach.\n"
+" -l - wyświetlenie także długości każdego ekstentu w 512-bajtowych "
+"blokach.\n"
 " -n - odpytanie n ekstentów.\n"
 " -v - szczegółowe informacje\n"
 "\n"
 
-#: .././io/fiemap.c:98
+#: .././io/fiemap.c:97
 msgid "FLAGS"
 msgstr "FLAGI"
 
-#: .././io/fiemap.c:147 .././io/fiemap.c:161 .././io/fiemap.c:346
+#: .././io/fiemap.c:146 .././io/fiemap.c:160 .././io/fiemap.c:345
 #, c-format
 msgid " %llu blocks\n"
 msgstr " %llu bloków\n"
 
-#: .././io/fiemap.c:366
+#: .././io/fiemap.c:365
 msgid "[-alv] [-n nx]"
 msgstr "[-alv] [-n nx]"
 
-#: .././io/fiemap.c:367
+#: .././io/fiemap.c:366
 msgid "print block mapping for a file"
 msgstr "wypisanie mapowania bloków dla pliku"
 
-#: .././io/file.c:39
+#: .././io/file.c:38
 #, c-format
 msgid "%c%03d%c %-14s (%s,%s,%s,%s%s%s%s%s)\n"
 msgstr "%c%03d%c %-14s (%s,%s,%s,%s%s%s%s%s)\n"
 
-#: .././io/file.c:41
+#: .././io/file.c:40
 msgid "foreign"
 msgstr "obcy"
 
-#: .././io/file.c:41
+#: .././io/file.c:40
 msgid "xfs"
 msgstr "xfs"
 
-#: .././io/file.c:42 .././io/open.c:97
+#: .././io/file.c:41 .././io/stat.c:97
 msgid "sync"
 msgstr "synchr"
 
-#: .././io/file.c:42 .././io/open.c:97
+#: .././io/file.c:41 .././io/stat.c:97
 msgid "non-sync"
 msgstr "niesynchr"
 
-#: .././io/file.c:43 .././io/open.c:98
+#: .././io/file.c:42 .././io/stat.c:98
 msgid "direct"
 msgstr "bezpośredni"
 
-#: .././io/file.c:43 .././io/open.c:98
+#: .././io/file.c:42 .././io/stat.c:98
 msgid "non-direct"
 msgstr "niebezpośredni"
 
-#: .././io/file.c:44 .././io/open.c:99
+#: .././io/file.c:43 .././io/stat.c:99
 msgid "read-only"
 msgstr "tylko do odczytu"
 
-#: .././io/file.c:44 .././io/open.c:99
+#: .././io/file.c:43 .././io/stat.c:99
 msgid "read-write"
 msgstr "odczyt i zapis"
 
-#: .././io/file.c:45 .././io/open.c:100
+#: .././io/file.c:44 .././io/stat.c:100
 msgid ",real-time"
 msgstr ",real-time"
 
-#: .././io/file.c:46 .././io/open.c:101
+#: .././io/file.c:45 .././io/stat.c:101
 msgid ",append-only"
 msgstr ",tylko dopisywanie"
 
-#: .././io/file.c:47 .././io/open.c:102
+#: .././io/file.c:46 .././io/stat.c:102
 msgid ",non-block"
 msgstr ",nieblokujący"
 
-#: .././io/file.c:48 .././io/open.c:103
+#: .././io/file.c:47 .././io/stat.c:103
 msgid ",tmpfile"
 msgstr ",tmpfile"
 
-#: .././io/file.c:82 .././io/sendfile.c:103 .././quota/path.c:112
+#: .././io/file.c:81 .././io/sendfile.c:101 .././quota/path.c:126
 #, c-format
 msgid "value %d is out of range (0-%d)\n"
 msgstr "wartość %d jest spoza zakresu (0-%d)\n"
 
-#: .././io/file.c:95 .././quota/path.c:126
+#: .././io/file.c:94 .././quota/path.c:140
 msgid "[N]"
 msgstr "[N]"
 
-#: .././io/file.c:100
+#: .././io/file.c:99
 msgid "set the current file"
 msgstr "ustawienie bieżącego pliku"
 
-#: .././io/file.c:109
+#: .././io/file.c:108
 msgid "list current open files and memory mappings"
 msgstr "wypisanie aktualnie otwartych plików i odwzorowań w pamięci"
 
-#: .././io/freeze.c:37
+#: .././io/freeze.c:36
 #, c-format
 msgid "%s: cannot freeze filesystem at %s: %s\n"
 msgstr "%s: nie można zamrozić systemu plików na %s: %s\n"
 
-#: .././io/freeze.c:54
+#: .././io/freeze.c:53
 #, c-format
 msgid "%s: cannot unfreeze filesystem mounted at %s: %s\n"
-msgstr "%s: nie można odmrozić systemu plików podmontowanego pod %s: %s\n"
+msgstr "%s: nie można odmrozić systemu plików zamontowanego pod %s: %s\n"
 
-#: .././io/freeze.c:70
+#: .././io/freeze.c:69
 msgid "freeze filesystem of current file"
 msgstr "zamrożenie systemu plików na bieżącym pliku"
 
-#: .././io/freeze.c:77
+#: .././io/freeze.c:76
 msgid "unfreeze filesystem of current file"
 msgstr "odmrożenie systemu plików na bieżącym pliku"
 
@@ -4280,46 +4889,47 @@ msgstr "wywołanie fdatasync(2) aby zrzu
 msgid "report process resource usage"
 msgstr "informacje o wykorzystaniu zasobów przez proces"
 
-#: .././io/imap.c:53
+#: .././io/imap.c:54
 #, c-format
 msgid "ino %10llu count %2d mask %016llx\n"
 msgstr "i-węzeł %10llu liczba %2d maska %016llx\n"
 
-#: .././io/imap.c:71
+#: .././io/imap.c:74
 msgid "[nentries]"
 msgstr "[liczba_wpisów]"
 
-#: .././io/imap.c:73
+#: .././io/imap.c:76
 msgid "inode map for filesystem of current file"
 msgstr "map i-węzłów dla systemu plików bieżącego pliku"
 
-#: .././io/init.c:35
+#: .././io/init.c:37
 #, c-format
-msgid "Usage: %s [-adfmnrRstVx] [-p prog] [-c cmd]... file\n"
-msgstr "Składnia: %s [-adfmnrRstVx] [-p program] [-c polecenie]... plik\n"
+msgid "Usage: %s [-adfinrRstVx] [-m mode] [-p prog] [[-c|-C] cmd]... file\n"
+msgstr "Składnia: %s [-adfinrRstVx] [-m tryb] [-p prog] [[-c|-C] polecenie]... plik\n"
 
-#: .././io/init.c:105 .././io/mmap.c:168 .././io/mmap.c:175 .././io/mmap.c:178
-#: .././io/open.c:292
+#: .././io/init.c:116 .././io/mmap.c:171 .././io/mmap.c:178 .././io/mmap.c:181
+#: .././io/open.c:202
 #, c-format
 msgid "no files are open, try 'help open'\n"
 msgstr "nie ma otwartych plików, spróbuj 'help open'\n"
 
-#: .././io/init.c:109 .././io/mmap.c:167 .././io/mmap.c:174
+#: .././io/init.c:120 .././io/mmap.c:170 .././io/mmap.c:177
 #, c-format
 msgid "no mapped regions, try 'help mmap'\n"
 msgstr "nie ma podmapowanych regionów, spróbuj 'help mmap'\n"
 
-#: .././io/init.c:115
+#: .././io/init.c:126
 #, c-format
 msgid "foreign file active, %s command is for XFS filesystems only\n"
-msgstr "aktywny jest plik obcy, polecenie %s jest tylko dla systemów plików XFS\n"
+msgstr ""
+"aktywny jest plik obcy, polecenie %s jest tylko dla systemów plików XFS\n"
 
-#: .././io/init.c:160 .././io/open.c:314
+#: .././io/init.c:177 .././io/open.c:224
 #, c-format
 msgid "non-numeric mode -- %s\n"
 msgstr "tryb nieliczbowy - %s\n"
 
-#: .././io/inject.c:109
+#: .././io/inject.c:120
 #, c-format
 msgid ""
 "\n"
@@ -4346,20 +4956,20 @@ msgstr ""
 " błędów.\n"
 "\n"
 
-#: .././io/inject.c:135
+#: .././io/inject.c:146
 #, c-format
 msgid "no such tag -- %s\n"
 msgstr "nie ma takiego znacznika - %s\n"
 
-#: .././io/inject.c:156
+#: .././io/inject.c:167
 msgid "[tag ...]"
 msgstr "[znacznik ...]"
 
-#: .././io/inject.c:157
+#: .././io/inject.c:168
 msgid "inject errors into a filesystem"
 msgstr "wprowadzanie błędów do systemu plików"
 
-#: .././io/link.c:35
+#: .././io/link.c:34
 #, c-format
 msgid ""
 "\n"
@@ -4372,15 +4982,15 @@ msgstr ""
 "\n"
 "\n"
 
-#: .././io/link.c:64
+#: .././io/link.c:63
 msgid "filename"
 msgstr "nazwa_pliku"
 
-#: .././io/link.c:66
+#: .././io/link.c:65
 msgid "link the open file descriptor to the supplied filename"
 msgstr "dowiązanie otwartego deskryptora pliku do podanej nazwy pliku"
 
-#: .././io/madvise.c:32
+#: .././io/madvise.c:31
 #, c-format
 msgid ""
 "\n"
@@ -4401,14 +5011,17 @@ msgid ""
 "\n"
 msgstr ""
 "\n"
-" doradzenie buforowi stron w sprawie oczekiwanych schematów dostępu do odwzorowań\n"
+" doradzenie buforowi stron w sprawie oczekiwanych schematów dostępu do "
+"odwzorowań\n"
 "\n"
 " madvise modyfikuje zachowanie bufora stron przy operacjach na bieżącym\n"
-" odwzorowaniu. Niektóre polecenia madvise ([*] poniżej) wymagają podania zakresu.\n"
+" odwzorowaniu. Niektóre polecenia madvise ([*] poniżej) wymagają podania "
+"zakresu.\n"
 " Bez argumentów zakłada się doradzenie POSIX_MADV_NORMAL.\n"
 " -d - podane strony nie są wymagane (POSIX_MADV_DONTNEED) [*]\n"
 " -r - należy oczekiwać losowych odwołań do stron (POSIX_MADV_RANDOM)\n"
-" -s - należy oczekiwać sekwencyjnych odwołań do stron (POSIX_MADV_SEQUENTIAL)\n"
+" -s - należy oczekiwać sekwencyjnych odwołań do stron "
+"(POSIX_MADV_SEQUENTIAL)\n"
 " -w - podane strony będą potrzebne (POSIX_MADV_WILLNEED) [*]\n"
 " Uwagi:\n"
 "  NORMAL ustawia domyślną wartość czytania z wyprzedzeniem dla pliku.\n"
@@ -4417,53 +5030,53 @@ msgstr ""
 "  WILLNEED wymusza maksymalne czytanie z wyprzedzeniem.\n"
 "\n"
 
-#: .././io/madvise.c:98 .././io/mincore.c:58
+#: .././io/madvise.c:97 .././io/mincore.c:57
 #, c-format
 msgid "length argument too large -- %lld\n"
 msgstr "zbyt duży argument będący długością - %lld\n"
 
-#: .././io/madvise.c:127
+#: .././io/madvise.c:126
 msgid "[-drsw] [off len]"
 msgstr "[-drsw] [offset długość]"
 
-#: .././io/madvise.c:128
+#: .././io/madvise.c:127
 msgid "give advice about use of memory"
 msgstr "doradzenie w sprawie użycia pamięci"
 
-#: .././io/mincore.c:92 .././io/mincore.c:102
+#: .././io/mincore.c:91 .././io/mincore.c:101
 #, c-format
 msgid "0x%lx  %lu pages (%llu : %lu)\n"
 msgstr "0x%lx  %lu stron (%llu : %lu)\n"
 
-#: .././io/mincore.c:122
+#: .././io/mincore.c:121
 msgid "[off len]"
 msgstr "[offset długość]"
 
-#: .././io/mincore.c:123
+#: .././io/mincore.c:122
 msgid "find mapping pages that are memory resident"
 msgstr "odnalezienie stron odwzorowań przechowywanych w pamięci"
 
-#: .././io/mmap.c:76
+#: .././io/mmap.c:78
 #, c-format
 msgid "offset (%lld) is before start of mapping (%lld)\n"
 msgstr "offset (%lld) przed początkiem odwzorowania (%lld)\n"
 
-#: .././io/mmap.c:82
+#: .././io/mmap.c:84
 #, c-format
 msgid "offset (%lld) is beyond end of mapping (%lld)\n"
 msgstr "offset (%lld) za końcem odwzorowania (%lld)\n"
 
-#: .././io/mmap.c:87
+#: .././io/mmap.c:89
 #, c-format
 msgid "range (%lld:%lld) is beyond mapping (%lld:%ld)\n"
 msgstr "przedział (%lld:%lld) poza odwzorowaniem (%lld:%ld)\n"
 
-#: .././io/mmap.c:93
+#: .././io/mmap.c:95
 #, c-format
 msgid "offset address (%p) is not page aligned\n"
 msgstr "adres offsetu (%p) nie jest wyrównany do rozmiaru strony\n"
 
-#: .././io/mmap.c:133
+#: .././io/mmap.c:135
 #, c-format
 msgid ""
 "\n"
@@ -4480,6 +5093,8 @@ msgid ""
 " -r -- map with PROT_READ protection\n"
 " -w -- map with PROT_WRITE protection\n"
 " -x -- map with PROT_EXEC protection\n"
+" -s <size> -- first do mmap(size)/munmap(size), try to reserve some free "
+"space\n"
 " If no protection mode is specified, all are used by default.\n"
 "\n"
 msgstr ""
@@ -4489,7 +5104,8 @@ msgstr ""
 "Przykład:\n"
 " 'mmap -rw 0 1m' - odwzorowuje 1MB od początku bieżącego pliku\n"
 "\n"
-" mmap odwzorowuje w pamięci przedział z pliku do dalszego wykorzystania przez\n"
+" mmap odwzorowuje w pamięci przedział z pliku do dalszego wykorzystania "
+"przez\n"
 " inne polecenia xfs_io.\n"
 " Bez argumentów mmap pokazuje aktualne odwzorowania. Bieżące odwzorowanie\n"
 " można ustawić przy użyciu formy jednoargumentowej (mmap numer lub adres).\n"
@@ -4498,10 +5114,12 @@ msgstr ""
 " -r - odwzorowanie z ochroną PROT_READ\n"
 " -w - odwzorowanie z ochroną PROT_WRITE\n"
 " -x - odwzorowanie z ochroną PROT_EXEC\n"
+" -s <rozmiar> - najpierw wykonanie mmap(rozmiar)/munmap(rozmiar) i próba\n"
+"    zarezerwowania wolnego miejsca\n"
 " Jeśli nie podano trybu ochrony, domyślnie używane są wszystkie.\n"
 "\n"
 
-#: .././io/mmap.c:254
+#: .././io/mmap.c:273
 #, c-format
 msgid ""
 "\n"
@@ -4529,7 +5147,7 @@ msgstr ""
 " -s - wykonanie zapisu synchronicznego (MS_SYNC)\n"
 "\n"
 
-#: .././io/mmap.c:330
+#: .././io/mmap.c:349
 #, c-format
 msgid ""
 "\n"
@@ -4541,7 +5159,8 @@ msgid ""
 " Accesses a range of the current memory mapping, optionally dumping it to\n"
 " the standard output stream (with -v option) for subsequent inspection.\n"
 " -f -- verbose mode, dump bytes with offsets relative to start of file.\n"
-" -r -- reverse order; start accessing from the end of range, moving backward\n"
+" -r -- reverse order; start accessing from the end of range, moving "
+"backward\n"
 " -v -- verbose mode, dump bytes with offsets relative to start of mapping.\n"
 " The accesses are performed sequentially from the start offset by default.\n"
 " Notes:\n"
@@ -4559,22 +5178,28 @@ msgstr ""
 " 'mread -v 512 20' - zrzucenie 20 bajtów odczytanych od 512 bajtu\n"
 "                     w odwzorowaniu\n"
 "\n"
-" mread odwołuje się do przedziału bieżącego odwzorowania pamięci, opcjonalnie\n"
-" zrzucając go na strumień standardowego wyjścia (z opcją -v) do dalszych badań.\n"
-" -f - tryb szczegółowy, zrzucenie bajtów z offsetami względem początku pliku.\n"
+" mread odwołuje się do przedziału bieżącego odwzorowania pamięci, "
+"opcjonalnie\n"
+" zrzucając go na strumień standardowego wyjścia (z opcją -v) do dalszych "
+"badań.\n"
+" -f - tryb szczegółowy, zrzucenie bajtów z offsetami względem początku "
+"pliku.\n"
 " -r - odwrotna kolejność; dostęp począwszy od końca przedziału do początku.\n"
 " -v - tryb szczegółowy, zrzucenie bajtów z offsetami względem początku\n"
 " odwzorowania.\n"
 " Dostępy są wykonywane sekwencyjnie, domyślnie od offsetu początkowego.\n"
 " Uwagi:\n"
-"   Odwołania do całych stron za końcem pliku powodują w efekcie sygnał SIGBUS.\n"
-"   Sygnały SIGBUS mogą być wywołane także przy różnych zdarzeniach związanych\n"
+"   Odwołania do całych stron za końcem pliku powodują w efekcie sygnał "
+"SIGBUS.\n"
+"   Sygnały SIGBUS mogą być wywołane także przy różnych zdarzeniach "
+"związanych\n"
 "   z systemem plików, włącznie z błędami przekroczenia limitów (quota) oraz\n"
-"   fizycznymi błędami urządzenia (takimi jak nieczytelne bloki dysku). Na tym\n"
+"   fizycznymi błędami urządzenia (takimi jak nieczytelne bloki dysku). Na "
+"tym\n"
 "   etapie nie ma prób wyłapania sygnałów...\n"
 "\n"
 
-#: .././io/mmap.c:494
+#: .././io/mmap.c:513
 #, c-format
 msgid ""
 "\n"
@@ -4597,169 +5222,94 @@ msgstr ""
 " 'mwrite 512 20' - zapisuje 20 bajtów od 512 bajtu w bieżącym odwzorowaniu.\n"
 "\n"
 " mwrite zapisuje bajt do przedziału pamięci w ramach odwzorowania.\n"
-" Domyślnie zapisywaną wartością jest 'X', powtarzane do wypełnienia przedziału.\n"
+" Domyślnie zapisywaną wartością jest 'X', powtarzane do wypełnienia "
+"przedziału.\n"
 " -S - użycie alternatywnego znaku\n"
 " -r - odwrotna kolejność; rozpoczęcie zapisywania od końca przedziału do\n"
 " początku\n"
 " Zapisy są wykonywane kolejno, domyślnie od offsetu początkowego.\n"
 "\n"
 
-#: .././io/mmap.c:530 .././io/pread.c:437 .././io/pwrite.c:303
-#: .././io/pwrite.c:330
+#: .././io/mmap.c:549 .././io/pread.c:439 .././io/pwrite.c:305
+#: .././io/pwrite.c:332
 #, c-format
 msgid "non-numeric seed -- %s\n"
 msgstr "nieliczbowy zarodek - %s\n"
 
-#: .././io/mmap.c:586
-msgid "[N] | [-rwx] [off len]"
-msgstr "[N] | [-rwx] [offset długość]"
+#: .././io/mmap.c:601
+#, c-format
+msgid ""
+"\n"
+" resizes the current memory mapping\n"
+"\n"
+" Examples:\n"
+" 'mremap 8192' - resizes the current mapping to 8192 bytes.\n"
+"\n"
+" Resizes the mappping, growing or shrinking from the current size.\n"
+" The default stored value is 'X', repeated to fill the range specified.\n"
+" -f <new_address> -- use MREMAP_FIXED flag to mremap on new_address\n"
+" -m -- use the MREMAP_MAYMOVE flag\n"
+"\n"
+msgstr ""
+"\n"
+" zmiana bieżącego odwzorowania w pamięci\n"
+"\n"
+" Przykłady:\n"
+" 'mremap 8192' - zmiana bieżącego odwzorowania na 8192 bajty.\n"
+"\n"
+" mremap zmienia odwzorowanie, zwiększając lub zmniejszając w stosunku do\n"
+" bieżącego rozmiaru. Domyślną zapisaną wartością jest 'X', powtarzane do\n"
+" wypełnienia podanego rozmiaru.\n"
+" -f <nowy_adres> - użycie flagi MREMAP_FIXED do wykonania mremap na "
+"nowy_adres\n"
+" -m - użycie flagi MREMAP_MAYMOVE\n"
+"\n"
+
+#: .././io/mmap.c:679
+msgid "[N] | [-rwx] [-s size] [off len]"
+msgstr "[N] | [-rwx] [-s rozmiar] [offset długość]"
 
-#: .././io/mmap.c:588
+#: .././io/mmap.c:681
 msgid "mmap a range in the current file, show mappings"
 msgstr "odwzorowanie przedziału w bieżącym pliku, pokazanie odwzorowań"
 
-#: .././io/mmap.c:597
+#: .././io/mmap.c:690
 msgid "[-r] [off len]"
 msgstr "[-r] [offset długość]"
 
-#: .././io/mmap.c:599
+#: .././io/mmap.c:692
 msgid "reads data from a region in the current memory mapping"
 msgstr "odczyt danych z regionu w bieżącym odwzorowaniu pamięci"
 
-#: .././io/mmap.c:608
+#: .././io/mmap.c:701
 msgid "[-ais] [off len]"
 msgstr "[-ais] [offset długość]"
 
-#: .././io/mmap.c:609
+#: .././io/mmap.c:702
 msgid "flush a region in the current memory mapping"
 msgstr "zrzucenie regionu w bieżącym odwzorowaniu pamięci"
 
-#: .././io/mmap.c:618
+#: .././io/mmap.c:711
 msgid "unmaps the current memory mapping"
 msgstr "usunięcie bieżącego odwzorowania pamięci"
 
-#: .././io/mmap.c:626
+#: .././io/mmap.c:719
 msgid "[-r] [-S seed] [off len]"
 msgstr "[-r] [-S wartość] [offset długość]"
 
-#: .././io/mmap.c:628
+#: .././io/mmap.c:721
 msgid "writes data into a region in the current memory mapping"
 msgstr "zapis danych do regionu w bieżącym odwzorowaniu pamięci"
 
-#: .././io/open.c:68
-msgid "socket"
-msgstr "gniazdo"
-
-#: .././io/open.c:70
-msgid "directory"
-msgstr "katalog"
-
-#: .././io/open.c:72
-msgid "char device"
-msgstr "urządzenie znakowe"
-
-#: .././io/open.c:74
-msgid "block device"
-msgstr "urządzenie blokowe"
-
-#: .././io/open.c:76
-msgid "regular file"
-msgstr "plik zwykły"
-
-#: .././io/open.c:78
-msgid "symbolic link"
-msgstr "dowiązanie symboliczne"
-
-#: .././io/open.c:80
-msgid "fifo"
-msgstr "potok"
-
-#: .././io/open.c:95 .././io/open.c:707
-#, c-format
-msgid "fd.path = \"%s\"\n"
-msgstr "fd.path = \"%s\"\n"
-
-#: .././io/open.c:96
-#, c-format
-msgid "fd.flags = %s,%s,%s%s%s%s%s\n"
-msgstr "fd.flags = %s,%s,%s%s%s%s%s\n"
-
-#: .././io/open.c:107
-#, c-format
-msgid "stat.ino = %lld\n"
-msgstr "stat.ino = %lld\n"
-
-#: .././io/open.c:108
-#, c-format
-msgid "stat.type = %s\n"
-msgstr "stat.type = %s\n"
-
-#: .././io/open.c:109
-#, c-format
-msgid "stat.size = %lld\n"
-msgstr "stat.size = %lld\n"
-
-#: .././io/open.c:110
-#, c-format
-msgid "stat.blocks = %lld\n"
-msgstr "stat.blocks = %lld\n"
-
-#: .././io/open.c:112
-#, c-format
-msgid "stat.atime = %s"
-msgstr "stat.atime = %s"
-
-#: .././io/open.c:113
-#, c-format
-msgid "stat.mtime = %s"
-msgstr "stat.mtime = %s"
-
-#: .././io/open.c:114
-#, c-format
-msgid "stat.ctime = %s"
-msgstr "stat.ctime = %s"
-
-#: .././io/open.c:123
-#, c-format
-msgid "fsxattr.xflags = 0x%x "
-msgstr "fsxattr.xflags = 0x%x "
-
-#: .././io/open.c:125
-#, c-format
-msgid "fsxattr.projid = %u\n"
-msgstr "fsxattr.projid = %u\n"
-
-#: .././io/open.c:126
-#, c-format
-msgid "fsxattr.extsize = %u\n"
-msgstr "fsxattr.extsize = %u\n"
-
-#: .././io/open.c:127
-#, c-format
-msgid "fsxattr.nextents = %u\n"
-msgstr "fsxattr.nextents = %u\n"
-
-#: .././io/open.c:128
-#, c-format
-msgid "fsxattr.naextents = %u\n"
-msgstr "fsxattr.naextents = %u\n"
-
-#: .././io/open.c:133
-#, c-format
-msgid "dioattr.mem = 0x%x\n"
-msgstr "dioattr.mem = 0x%x\n"
-
-#: .././io/open.c:134
-#, c-format
-msgid "dioattr.miniosz = %u\n"
-msgstr "dioattr.miniosz = %u\n"
-
-#: .././io/open.c:135
-#, c-format
-msgid "dioattr.maxiosz = %u\n"
-msgstr "dioattr.maxiosz = %u\n"
+#: .././io/mmap.c:731
+msgid "[-m|-f <new_address>] newsize"
+msgstr "[-m|-f <nowy_adres>] nowy_rozmiar"
+
+#: .././io/mmap.c:733
+msgid "alters the size of the current memory mapping"
+msgstr "zmiana rozmiary bieżącego odwzorowania pamięci"
 
-#: .././io/open.c:254
+#: .././io/open.c:164
 #, c-format
 msgid ""
 "\n"
@@ -4790,14 +5340,17 @@ msgstr ""
 " otwarcie nowego pliku w żądanym trybie\n"
 "\n"
 " Przykład:\n"
-" 'open -cd /tmp/data' - utworzenie/otwarcie pliku danych do odczytu i zapisu\n"
+" 'open -cd /tmp/data' - utworzenie/otwarcie pliku danych do odczytu i "
+"zapisu\n"
 "                        z bezpośrednim we/wy\n"
 "\n"
-" open otwiera plik do późniejszego wykorzystania przez wszystkie inne polecenia\n"
+" open otwiera plik do późniejszego wykorzystania przez wszystkie inne "
+"polecenia\n"
 " xfs_io.\n"
 " Bez argumentów używa polecenia stat do pokazania bieżącego pliku.\n"
 " -a - otwarcie z flagą O_APPEND (w trybie tylko dopisywania)\n"
-" -d - otwarcie z flagą O_DIRECT (niebuforowane we/wy, ograniczenia wyrównania)\n"
+" -d - otwarcie z flagą O_DIRECT (niebuforowane we/wy, ograniczenia "
+"wyrównania)\n"
 " -f - otwarcie z flagą O_CREAT (utworzenie pliku jeśli nie istnieje)\n"
 " -m - uprawnienia do użycia w przypadku tworzenia pliku (domyślnie 0600)\n"
 " -n - otwarcie z flagą O_NONBLOCK\n"
@@ -4805,20 +5358,23 @@ msgstr ""
 " -s - otwarcie z flagą O_SYNC\n"
 " -t - otwarcie z flagą O_TRUNC (ucięcie do zerowej długości jeśli istnieje)\n"
 " -R - oznaczenie pliku jako realtime na XFS-ie zaraz po otwarciu\n"
-" -T - otwarcie z flagą O_TMPFILE (utworzenie pliku niewidocznego w przestrzni\n"
+" -T - otwarcie z flagą O_TMPFILE (utworzenie pliku niewidocznego w "
+"przestrzni\n"
 "      nazw)\n"
-" Uwaga1: zwykle żądania bezpośredniego we/wy muszą być wyrównane do rozmiaru\n"
+" Uwaga1: zwykle żądania bezpośredniego we/wy muszą być wyrównane do "
+"rozmiaru\n"
 "         bloku; niektóre jądra pozwalają na wyrównanie do rozmiaru sektora\n"
 " Uwaga2: bmap dla plików innych niż zwykłe można uzyskać pod warunkiem, że\n"
-"         plik zostanie poprawnie otwarty (w szczególności tylko do odczytu).\n"
+"         plik zostanie poprawnie otwarty (w szczególności tylko do "
+"odczytu).\n"
 "\n"
 
-#: .././io/open.c:346
+#: .././io/open.c:256
 #, c-format
 msgid "-T and -r options are incompatible\n"
 msgstr "Opcje -T i -r nie są zgodne ze sobą\n"
 
-#: .././io/open.c:401
+#: .././io/open.c:311
 #, c-format
 msgid ""
 "\n"
@@ -4833,16 +5389,18 @@ msgstr ""
 " wyświetlenie identyfikatora projektu związanego z bieżącą ścieżką\n"
 "\n"
 " Opcje:\n"
-" -R - rekurencyjne zagłębianie się (przydatne kiedy bieżący plik jest katalogiem)\n"
-" -D - rekurencyjne zagłębianie się, ale wypisywanie projektów tylko katalogów\n"
+" -R - rekurencyjne zagłębianie się (przydatne kiedy bieżący plik jest "
+"katalogiem)\n"
+" -D - rekurencyjne zagłębianie się, ale wypisywanie projektów tylko "
+"katalogów\n"
 "\n"
 
-#: .././io/open.c:467
+#: .././io/open.c:377
 #, c-format
 msgid "projid = %u\n"
 msgstr "projid = %u\n"
 
-#: .././io/open.c:475
+#: .././io/open.c:385
 #, c-format
 msgid ""
 "\n"
@@ -4855,16 +5413,17 @@ msgstr ""
 "\n"
 " modyfikacja identyfikatora projektu związanego z bieżącą ścieżką\n"
 "\n"
-" -R - rekurencyjne zagłębianie się (przydatne kiedy bieżący plik jest katalogiem)\n"
+" -R - rekurencyjne zagłębianie się (przydatne kiedy bieżący plik jest "
+"katalogiem)\n"
 " -D - rekurencyjne zagłębianie się, ale zmiana projektów tylko katalogów\n"
 "\n"
 
-#: .././io/open.c:534
+#: .././io/open.c:444
 #, c-format
 msgid "invalid project ID -- %s\n"
 msgstr "nieprawidłowy ID projektu - %s\n"
 
-#: .././io/open.c:550
+#: .././io/open.c:460
 #, c-format
 msgid ""
 "\n"
@@ -4878,264 +5437,194 @@ msgstr ""
 " odczyt lub zmiana preferowanego rozmiaru ekstentu (w bajtach) dla bieżącej\n"
 " ścieżki\n"
 "\n"
-" -R - rekurencyjne zagłębianie się (przydatne kiedy bieżący plik jest katalogiem)\n"
+" -R - rekurencyjne zagłębianie się (przydatne kiedy bieżący plik jest "
+"katalogiem)\n"
 " -D - rekurencyjne zagłębianie się, ale zmiana extsize tylko katalogów\n"
 "\n"
 
-#: .././io/open.c:593
-#, c-format
-msgid "invalid target file type - file %s\n"
-msgstr "nieprawidłowy rodzaj bliku docelowego - plik %s\n"
-
-#: .././io/open.c:679
+#: .././io/open.c:589
 #, c-format
 msgid "non-numeric extsize argument -- %s\n"
 msgstr "nieliczbowy argument extsize - %s\n"
 
-#: .././io/open.c:711
+#: .././io/open.c:612
 #, c-format
-msgid "statfs.f_bsize = %lld\n"
-msgstr "statfs.f_bsize = %lld\n"
+msgid ""
+"\n"
+"Query physical information about an inode\n"
+" Default:\t-- Return 1 if any inode number greater than 32 bits exists in\n"
+"\t\t   the filesystem, or 0 if none exist\n"
+" num\t\t-- Return inode number [num] if in use, or 0 if not in use\n"
+" -n num\t-- Return the next used inode after [num]\n"
+" -v\t\t-- Verbose mode - display returned inode number's size in bits\n"
+"\n"
+msgstr ""
+"\n"
+"Odpytanie o fizyczne informacje dotyczące i-węzła\n"
+" Domyślnie: - zwraca 1, jeśli numer i-węzła większy niż 32 bity istnieje\n"
+"              w systemie plików, 0 jeśli nie\n"
+" num - zwraca numer i-węzła [num], jeśli jest w użyciu, 0 jeśli nie\n"
+" -n num - zwracan następny używany i-węzeł po [num]\n"
+" -v - tryb szczegółowy - wyświetla rozmiar zwracanego i-węzła w bitach\n"
+"\n"
 
-#: .././io/open.c:712
+#: .././io/open.c:695
 #, c-format
-msgid "statfs.f_blocks = %lld\n"
-msgstr "statfs.f_blocks = %lld\n"
+msgid "%s is not a numeric inode value\n"
+msgstr "%s nie jest liczbową wartością i-węzła\n"
 
-#: .././io/open.c:714
-#, c-format
-msgid "statfs.f_frsize = %lld\n"
-msgstr "statfs.f_frsize = %lld\n"
+#: .././io/open.c:775
+msgid "[-acdrstxT] [-m mode] [path]"
+msgstr "[-acdrstxT] [-m tryb] [ścieżka]"
 
-#: .././io/open.c:716
-#, c-format
-msgid "statfs.f_bavail = %lld\n"
-msgstr "statfs.f_bavail = %lld\n"
+#: .././io/open.c:776
+msgid "open the file specified by path"
+msgstr "otwarcie pliku określonego ścieżką"
 
-#: .././io/open.c:718
-#, c-format
-msgid "statfs.f_files = %lld\n"
-msgstr "statfs.f_files = %lld\n"
+#: .././io/open.c:785
+msgid "close the current open file"
+msgstr "zamknięcie bieżącego otwartego pliku"
 
-#: .././io/open.c:719
-#, c-format
-msgid "statfs.f_ffree = %lld\n"
-msgstr "statfs.f_ffree = %lld\n"
+#: .././io/open.c:789
+msgid "[-D | -R] projid"
+msgstr "[-D | -R] projid"
 
-#: .././io/open.c:726
-#, c-format
-msgid "geom.bsize = %u\n"
-msgstr "geom.bsize = %u\n"
+#: .././io/open.c:794
+msgid "change project identifier on the currently open file"
+msgstr "zmiana identyfikatora projektu aktualnie otwartego pliku"
 
-#: .././io/open.c:727
-#, c-format
-msgid "geom.agcount = %u\n"
-msgstr "geom.agcount = %u\n"
+#: .././io/open.c:799
+msgid "[-D | -R]"
+msgstr "[-D | -R]"
 
-#: .././io/open.c:728
-#, c-format
-msgid "geom.agblocks = %u\n"
-msgstr "geom.agblocks = %u\n"
+#: .././io/open.c:804
+msgid "list project identifier set on the currently open file"
+msgstr "wypisanie identyfikatora projektu aktualnie otwartego pliku"
 
-#: .././io/open.c:729
-#, c-format
-msgid "geom.datablocks = %llu\n"
-msgstr "geom.datablocks = %llu\n"
+#: .././io/open.c:809
+msgid "[-D | -R] [extsize]"
+msgstr "[-D | -R] [rozmiar_ekstentu]"
 
-#: .././io/open.c:731
-#, c-format
-msgid "geom.rtblocks = %llu\n"
-msgstr "geom.rtblocks = %llu\n"
+#: .././io/open.c:814
+msgid "get/set preferred extent size (in bytes) for the open file"
+msgstr ""
+"pobranie/ustawienie preferowanego rozmiaru ekstentu (w bajtach) dla "
+"otwartego pliku"
 
-#: .././io/open.c:733
+#: .././io/open.c:819
+msgid "[-nv] [num]"
+msgstr "[-nv] [num]"
+
+#: .././io/open.c:824
+msgid "Query inode number usage in the filesystem"
+msgstr "Zapytanie o wykorzystanie numeru i-węzła w systemie plików"
+
+#: .././io/parent.c:48
 #, c-format
-msgid "geom.rtextents = %llu\n"
-msgstr "geom.rtextents = %llu\n"
+msgid "%s%s"
+msgstr "%s%s"
 
-#: .././io/open.c:735
+#: .././io/parent.c:53
 #, c-format
-msgid "geom.rtextsize = %u\n"
-msgstr "geom.rtextsize = %u\n"
+msgid "inode-path for inode: %llu is incorrect - path \"%s\" non-existent\n"
+msgstr ""
+"inode-path dla i-węzła: %llu jest niepoprawna - ścieżka \"%s\" nie istnieje\n"
 
-#: .././io/open.c:736
+#: .././io/parent.c:57
 #, c-format
-msgid "geom.sunit = %u\n"
-msgstr "geom.sunit = %u\n"
+msgid "path \"%s\" does not stat for inode: %llu; err = %s\n"
+msgstr "ścieżka \"%s\" nie pozwala na stat dla i-węzła: %llu; błąd = %s\n"
 
-#: .././io/open.c:737
+#: .././io/parent.c:66
 #, c-format
-msgid "geom.swidth = %u\n"
-msgstr "geom.swidth = %u\n"
+msgid "path \"%s\" found\n"
+msgstr "ścieżki \"%s\" nie znaleziono\n"
 
-#: .././io/open.c:742
+#: .././io/parent.c:72
 #, c-format
-msgid "counts.freedata = %llu\n"
-msgstr "counts.freedata = %llu\n"
+msgid "inode-path for inode: %llu is incorrect - wrong inode#\n"
+msgstr ""
+"inode-path dla i-węzła: %llu jest niepoprawna - niewłaściwy numer i-węzła\n"
 
-#: .././io/open.c:744
+#: .././io/parent.c:76 .././io/parent.c:106
 #, c-format
-msgid "counts.freertx = %llu\n"
-msgstr "counts.freertx = %llu\n"
+msgid "ino mismatch for path \"%s\" %llu vs %llu\n"
+msgstr "niezgodność i-węzła dla ścieżki \"%s\" %llu vs %llu\n"
 
-#: .././io/open.c:746
-#, c-format
-msgid "counts.freeino = %llu\n"
-msgstr "counts.freeino = %llu\n"
-
-#: .././io/open.c:748
-#, c-format
-msgid "counts.allocino = %llu\n"
-msgstr "counts.allocino = %llu\n"
-
-#: .././io/open.c:763
-msgid "[-acdrstxT] [path]"
-msgstr "[-acdrstxT] [ścieżka]"
-
-#: .././io/open.c:764
-msgid "open the file specified by path"
-msgstr "otwarcie pliku określonego ścieżką"
-
-#: .././io/open.c:772
-msgid "[-v]"
-msgstr "[-v]"
-
-#: .././io/open.c:773
-msgid "statistics on the currently open file"
-msgstr "statystyki dla aktualnie otwartego pliku"
-
-#: .././io/open.c:781
-msgid "close the current open file"
-msgstr "zamknięcie bieżącego otwartego pliku"
-
-#: .././io/open.c:787
-msgid "statistics on the filesystem of the currently open file"
-msgstr "statystyki dla systemu plików aktualnie otwartego pliku"
-
-#: .././io/open.c:791
-msgid "[-D | -R] projid"
-msgstr "[-D | -R] projid"
-
-#: .././io/open.c:796
-msgid "change project identifier on the currently open file"
-msgstr "zmiana identyfikatora projektu aktualnie otwartego pliku"
-
-#: .././io/open.c:801
-msgid "[-D | -R]"
-msgstr "[-D | -R]"
-
-#: .././io/open.c:806
-msgid "list project identifier set on the currently open file"
-msgstr "wypisanie identyfikatora projektu aktualnie otwartego pliku"
-
-#: .././io/open.c:811
-msgid "[-D | -R] [extsize]"
-msgstr "[-D | -R] [rozmiar_fragmentu]"
-
-#: .././io/open.c:816
-msgid "get/set preferred extent size (in bytes) for the open file"
-msgstr "pobranie/ustawienie preferowanego rozmiaru ekstentu (w bajtach) dla otwartego pliku"
-
-#: .././io/parent.c:49
-#, c-format
-msgid "%s%s"
-msgstr "%s%s"
-
-#: .././io/parent.c:54
-#, c-format
-msgid "inode-path for inode: %llu is incorrect - path \"%s\" non-existent\n"
-msgstr "inode-path dla i-węzła: %llu jest niepoprawna - ścieżka \"%s\" nie istnieje\n"
-
-#: .././io/parent.c:58
-#, c-format
-msgid "path \"%s\" does not stat for inode: %llu; err = %s\n"
-msgstr "ścieżka \"%s\" nie pozwala na stat dla i-węzła: %llu; błąd = %s\n"
-
-#: .././io/parent.c:67
-#, c-format
-msgid "path \"%s\" found\n"
-msgstr "ścieżki \"%s\" nie znaleziono\n"
-
-#: .././io/parent.c:73
-#, c-format
-msgid "inode-path for inode: %llu is incorrect - wrong inode#\n"
-msgstr "inode-path dla i-węzła: %llu jest niepoprawna - niewłaściwy numer i-węzła\n"
-
-#: .././io/parent.c:77 .././io/parent.c:107
-#, c-format
-msgid "ino mismatch for path \"%s\" %llu vs %llu\n"
-msgstr "niezgodność i-węzła dla ścieżki \"%s\" %llu vs %llu\n"
-
-#: .././io/parent.c:85
+#: .././io/parent.c:84
 #, c-format
 msgid "inode number match: %llu\n"
 msgstr "zgodność numeru i-węzła: %llu\n"
 
-#: .././io/parent.c:95
+#: .././io/parent.c:94
 #, c-format
 msgid "parent path \"%s\" does not stat: %s\n"
 msgstr "ścieżka nadrzędna \"%s\" nie pozwala na stat: %s\n"
 
-#: .././io/parent.c:103
+#: .././io/parent.c:102
 #, c-format
 msgid "inode-path for inode: %llu is incorrect - wrong parent inode#\n"
-msgstr "inode-path dla i-węzła: %llu jest niepoprawna - niewłaściwy numer i-węzła nadrzędnego\n"
+msgstr ""
+"inode-path dla i-węzła: %llu jest niepoprawna - niewłaściwy numer i-węzła "
+"nadrzędnego\n"
 
-#: .././io/parent.c:116
+#: .././io/parent.c:115
 #, c-format
 msgid "parent ino match for %llu\n"
 msgstr "zgodność numeru i-węzła nadrzędnego dla %llu\n"
 
-#: .././io/parent.c:138
+#: .././io/parent.c:137
 #, c-format
 msgid "parentpaths failed for ino %llu: %s\n"
 msgstr "parentpaths nie powiodło się dla i-węzła %llu: %s\n"
 
-#: .././io/parent.c:149
+#: .././io/parent.c:148
 #, c-format
 msgid "inode-path for inode: %llu is missing\n"
 msgstr "brak inode-path dla i-węzła: %llu\n"
 
-#: .././io/parent.c:173
+#: .././io/parent.c:172
 #, c-format
 msgid "can't stat mount point \"%s\": %s\n"
 msgstr "nie można wykonać stat na punkcie montowania \"%s\": %s\n"
 
-#: .././io/parent.c:194
+#: .././io/parent.c:193
 #, c-format
 msgid "failed to get bulkstat information for inode %llu\n"
 msgstr "nie udało się uzyskać informacji bulkstat dla i-węzła %llu\n"
 
-#: .././io/parent.c:200
+#: .././io/parent.c:199
 #, c-format
 msgid "failed to get valid bulkstat information for inode %llu\n"
-msgstr "nie udało się uzyskać prawidłowych informacji bulkstat dla i-węzła %llu\n"
+msgstr ""
+"nie udało się uzyskać prawidłowych informacji bulkstat dla i-węzła %llu\n"
 
-#: .././io/parent.c:212
+#: .././io/parent.c:211
 #, c-format
 msgid "checking inode %llu\n"
 msgstr "sprawdzanie i-węzła %llu\n"
 
-#: .././io/parent.c:227
+#: .././io/parent.c:226
 #, c-format
 msgid "syssgi bulkstat failed: %s\n"
 msgstr "syssgi bulkstat nie powiodło się: %s\n"
 
-#: .././io/parent.c:249
+#: .././io/parent.c:248
 #, c-format
 msgid "unable to open \"%s\" for jdm: %s\n"
 msgstr "nie udało się otworzyć \"%s\" dla jdm: %s\n"
 
-#: .././io/parent.c:259
+#: .././io/parent.c:258
 #, c-format
 msgid "unable to allocate buffers: %s\n"
 msgstr "nie udało się przydzielić buforów: %s\n"
 
-#: .././io/parent.c:270
+#: .././io/parent.c:268
 #, c-format
 msgid "num errors: %d\n"
 msgstr "liczba błędów: %d\n"
 
-#: .././io/parent.c:272
+#: .././io/parent.c:270
 #, c-format
 msgid "succeeded checking %llu inodes\n"
 msgstr "udało się sprawdzić %llu i-węzłów\n"
@@ -5170,32 +5659,32 @@ msgstr "p_name   = \"%s\"\n"
 msgid "%s: failed path_to_fshandle \"%s\": %s\n"
 msgstr "%s: path_to_fshandle nie powiodło się dla \"%s\": %s\n"
 
-#: .././io/parent.c:318
+#: .././io/parent.c:319
 #, c-format
 msgid "%s: path_to_handle failed for \"%s\"\n"
 msgstr "%s: path_to_handle nie powiodło się dla \"%s\"\n"
 
-#: .././io/parent.c:325
+#: .././io/parent.c:326
 #, c-format
 msgid "%s: unable to allocate parent buffer: %s\n"
 msgstr "%s: nie udało się przydzielić bufora nadrzędnego: %s\n"
 
-#: .././io/parent.c:346
+#: .././io/parent.c:347
 #, c-format
 msgid "%s: %s call failed for \"%s\": %s\n"
 msgstr "%s: wywołanie %s nie powiodło się dla \"%s\": %s\n"
 
-#: .././io/parent.c:355
+#: .././io/parent.c:356
 #, c-format
 msgid "%s: inode-path is missing\n"
 msgstr "%s: brak inode-path\n"
 
-#: .././io/parent.c:386
+#: .././io/parent.c:388
 #, c-format
 msgid "file argument, \"%s\", is not in a mounted XFS filesystem\n"
-msgstr "argument plikowy \"%s\" nie jest na podmontowanym systemie plików XFS\n"
+msgstr "argument plikowy \"%s\" nie jest na zamontowanym systemie plików XFS\n"
 
-#: .././io/parent.c:426
+#: .././io/parent.c:428
 #, c-format
 msgid ""
 "\n"
@@ -5214,15 +5703,15 @@ msgstr ""
 " -v - tryb szczegółowy\n"
 "\n"
 
-#: .././io/parent.c:442
+#: .././io/parent.c:444
 msgid "[-cpv]"
 msgstr "[-cpv]"
 
-#: .././io/parent.c:444
+#: .././io/parent.c:446
 msgid "print or check parent inodes"
 msgstr "wypisanie lub sprawdzenie i-węzłów nadrzędnych"
 
-#: .././io/pread.c:33
+#: .././io/pread.c:32
 #, c-format
 msgid ""
 "\n"
@@ -5257,104 +5746,144 @@ msgstr ""
 " 'pread -v 512 20' - zrzucenie 20 bajtów odczytanych od 512 bajtu w pliku\n"
 "\n"
 " pread odczytuje segment aktualnie otwartego pliku, opcjonalnie zrzucając\n"
-" zawartość na strumień standardowego wyjścia (z opcją -v) dla dalszych badań.\n"
-" Odczyty są wykonywane sekwencyjnie blokami począwszy od offsetu z rozmiarem\n"
-" bloku ustawianym przy użyciu opcji -b (domyślny rozmiar bloku to 4096 bajtów),\n"
+" zawartość na strumień standardowego wyjścia (z opcją -v) dla dalszych "
+"badań.\n"
+" Odczyty są wykonywane sekwencyjnie blokami począwszy od offsetu z "
+"rozmiarem\n"
+" bloku ustawianym przy użyciu opcji -b (domyślny rozmiar bloku to 4096 "
+"bajtów),\n"
 " chyba że zażądano innego schematu.\n"
 " -B   - odczyt przedziału od tyłu począwszy od offsetu (N bajtów do tyłu)\n"
 " -F   - odczyt przedziału od przodu począwszy od offsetu (domyślny)\n"
 " -v   - tryb szczegółowy, zrzucenie bufora (przy odczycie od przodu)\n"
 " -R   - odczyt losowych offsetów z przedziału bajtów\n"
-" -Z N - (\"zeed\") nakarmienie generatora liczb losowych (przy odczycie losowym)\n"
-"        (nieztety opcje -s/-S pasujące do \"seed\" były już zajęte w pwrite)\n"
+" -Z N - (\"zeed\") nakarmienie generatora liczb losowych (przy odczycie "
+"losowym)\n"
+"        (nieztety opcje -s/-S pasujące do \"seed\" były już zajęte w "
+"pwrite)\n"
 " -V N - użycie wektorowego we/wy z N iovec, każdym o rozmiarze blocksize\n"
 "        (preadv)\n"
 "\n"
 " W przypadku trybu losowego liczba operacji odczytu będzie równa liczbie\n"
-" potrzebnej do pełnego przeskanowania od przodu lub od tyłu całego przedziału.\n"
-" Należy zauważyć, że offset w przedziale jest wybierany za każdym razem losowo\n"
+" potrzebnej do pełnego przeskanowania od przodu lub od tyłu całego "
+"przedziału.\n"
+" Należy zauważyć, że offset w przedziale jest wybierany za każdym razem "
+"losowo\n"
 " (dowolny offset może być w tym trybie czytany więcej niż raz).\n"
 "\n"
 
-#: .././io/pread.c:398 .././io/pwrite.c:269
+#: .././io/pread.c:400 .././io/pwrite.c:271
 #, c-format
 msgid "non-numeric bsize -- %s\n"
 msgstr "nieliczbowy rozmiar bloku - %s\n"
 
-#: .././io/pread.c:428 .././io/pwrite.c:316
+#: .././io/pread.c:430 .././io/pwrite.c:318
 #, c-format
 msgid "non-numeric vector count == %s\n"
 msgstr "nieliczbowa liczba wektorów - %s\n"
 
-#: .././io/pread.c:497
-#, c-format
-msgid "read %lld/%lld bytes at offset %lld\n"
-msgstr "odczytano %lld/%lld bajtów od offsetu %lld\n"
-
-#: .././io/pread.c:499 .././io/pwrite.c:396 .././io/sendfile.c:163
-#, c-format
-msgid "%s, %d ops; %s (%s/sec and %.4f ops/sec)\n"
-msgstr "%s, %d operacji; %s (%s/sek i %.4f operacji/sek)\n"
-
-#: .././io/pread.c:518
+#: .././io/pread.c:507
 msgid "[-b bs] [-v] [-i N] [-FBR [-Z N]] off len"
 msgstr "[-b rozm_bloku] [-v] [-i N] [-FBR [-Z N]] offset długość"
 
-#: .././io/pread.c:519
+#: .././io/pread.c:508
 msgid "reads a number of bytes at a specified offset"
 msgstr "odczyt podanej liczby bajtów od podanego offsetu"
 
-#: .././io/prealloc.c:273 .././io/prealloc.c:281 .././io/prealloc.c:289
-#: .././io/prealloc.c:297 .././io/prealloc.c:307 .././io/prealloc.c:333
-#: .././io/prealloc.c:343
+#: .././io/prealloc.c:175
+#, c-format
+msgid ""
+"\n"
+" modifies space associated with part of a file via fallocate\n"
+" Example:\n"
+" 'falloc 0 1m' - fills all holes within the first megabyte\n"
+"\n"
+" falloc uses the fallocate system call to alter space allocations in the\n"
+" open file.  The following operations are supported:\n"
+" All the file offsets are in units of bytes.\n"
+" -c -- collapses the given range.\n"
+" -i -- inserts a hole into the given range of the file.\n"
+" -k -- do not change file size.\n"
+" -p -- unmap the given range from the file.\n"
+" -u -- unshare shared extents in the given range.\n"
+"\n"
+msgstr ""
+"\n"
+" modyfikacja miejsca powiązanego z częścią pliku poprzez fallocate\n"
+" Przykład:\n"
+" 'falloc 0 1m' - wypełnienie wszystkich dziur w pierwszym megabajcie\n"
+"\n"
+" falloc wykorzustuje wywołanie systemowe fallocate do zmiany przydzielonego\n"
+" miejsca w otwartym pliku. Obsługiwane są następujące operacje:\n"
+" (wszystkie offsety plików są w bajtach)\n"
+" -c - wycięcie podanego przedziału.\n"
+" -i - wstawienie dziury w podanym przedziale pliku.\n"
+" -k - bez zmiany rozmiaru pliku.\n"
+" -p - odwiązane podanego przedziału z pliku.\n"
+" -u - rozdzielenie współdzielonych ekstentów w podanym przedziale.\n"
+"\n"
+
+#: .././io/prealloc.c:347 .././io/prealloc.c:355 .././io/prealloc.c:363
+#: .././io/prealloc.c:371 .././io/prealloc.c:381 .././io/prealloc.c:408
+#: .././io/prealloc.c:418 .././io/prealloc.c:428 .././io/prealloc.c:448
 msgid "off len"
 msgstr "offset długość"
 
-#: .././io/prealloc.c:274
+#: .././io/prealloc.c:348
 msgid "allocates zeroed space for part of a file"
 msgstr "przydzielenie wyzerowanej przestrzeni dla części pliku"
 
-#: .././io/prealloc.c:282
+#: .././io/prealloc.c:356
 msgid "frees space associated with part of a file"
 msgstr "zwolnienie miejsca związanego z częścią pliku"
 
-#: .././io/prealloc.c:291
+#: .././io/prealloc.c:365
 msgid "reserves space associated with part of a file"
 msgstr "zarezerwowanie miejsca związanego z częścią pliku"
 
-#: .././io/prealloc.c:300
+#: .././io/prealloc.c:374
 msgid "frees reserved space associated with part of a file"
 msgstr "zwolnienie zarezerwowanego miejsca związanego z częścią pliku"
 
-#: .././io/prealloc.c:309
+#: .././io/prealloc.c:383
 msgid "Converts the given range of a file to allocated zeros"
 msgstr "Zamiana podanego przedziału pliku na przydzielone zera"
 
-#: .././io/prealloc.c:323
-msgid "[-c] [-k] [-p] off len"
-msgstr "[-c] [-k] [-p] offset długość"
+#: .././io/prealloc.c:397
+msgid "[-c] [-k] [-p] [-u] off len"
+msgstr "[-c] [-k] [-p] [-u] offset długość"
 
-#: .././io/prealloc.c:325
+#: .././io/prealloc.c:399
 msgid "allocates space associated with part of a file via fallocate"
 msgstr "przydzielenie miejsca powiązanego z częścią pliku przez fallocate"
 
-#: .././io/prealloc.c:335
+#: .././io/prealloc.c:410
 msgid "de-allocates space assocated with part of a file via fallocate"
 msgstr "zwolnienie miejsca powiązanego z częścią pliku przez fallocate"
 
-#: .././io/prealloc.c:345
+#: .././io/prealloc.c:420
 msgid "de-allocates space and eliminates the hole by shifting extents"
 msgstr "zwolnienie miejsca i usunięcie dziury poprzez przesunięcie ekstentów"
 
-#: .././io/prealloc.c:353
+#: .././io/prealloc.c:430
+msgid "creates new space for writing within file by shifting extents"
+msgstr ""
+"utworzenie nowego miejsca na zapis wewnątrz pliku poprzez przesunięcie "
+"ekstentów"
+
+#: .././io/prealloc.c:438
 msgid "[-k] off len"
 msgstr "[-k] offset długość"
 
-#: .././io/prealloc.c:355
+#: .././io/prealloc.c:440
 msgid "zeroes space and eliminates holes by preallocating"
 msgstr "wyzerowanie miejsca i usunięcie dziur poprzez prealokację"
 
-#: .././io/pwrite.c:32
+#: .././io/prealloc.c:450
+msgid "unshares shared blocks within the range"
+msgstr "rozdzielenie współdzielonych bloków o podanym przedziale"
+
+#: .././io/pwrite.c:31
 #, c-format
 msgid ""
 "\n"
@@ -5388,10 +5917,13 @@ msgstr ""
 " Przykład:\n"
 " 'pwrite 512 20' - zapisanie 20 bajtów odczytanych od 512 bajtu w pliku\n"
 "\n"
-" pwrite zapisuje segment aktualnie otwartego pliku, używając bufora wypełnionego\n"
-" ustawionym wzorcem (0xcdcdcdcd) lub danymi odczytanymi z pliku wejściowego.\n"
+" pwrite zapisuje segment aktualnie otwartego pliku, używając bufora "
+"wypełnionego\n"
+" ustawionym wzorcem (0xcdcdcdcd) lub danymi odczytanymi z pliku "
+"wejściowego.\n"
 " Zapisy są wykonywane sekwencyjnie blokami począwszy od offsetu z rozmiarem\n"
-" bloku ustawianym przy użyciu opcji -b (domyślny rozmiar bloku to 4096 bajtów),\n"
+" bloku ustawianym przy użyciu opcji -b (domyślny rozmiar bloku to 4096 "
+"bajtów),\n"
 " chyba że zażądano innego schematu.\n"
 " -S   - użycie innej liczby do wypełnienia bufora zapisu\n"
 " -i   - plik wejściowy, źródło danych do zapisania (przy pisaniu od przodu)\n"
@@ -5402,72 +5934,191 @@ msgstr ""
 " -B   - zapis przedziału od tyłu począwszy od offsetu (N bajtów do tyłu)\n"
 " -F   - zapis przedziału od przodu począwszy od offsetu (domyślny)\n"
 " -R   - zapis losowych offsetów z przedziału bajtów\n"
-" -Z N - (\"zeed\") nakarmienie generatora liczb losowych (przy zapisie losowym)\n"
-"        (niestety opcje -s/-S pasujące do \"seed\" były już zajęte w pwrite)\n"
+" -Z N - (\"zeed\") nakarmienie generatora liczb losowych (przy zapisie "
+"losowym)\n"
+"        (niestety opcje -s/-S pasujące do \"seed\" były już zajęte w "
+"pwrite)\n"
 " -V N - użycie wektorowego we/wy z N iovec, każdym o rozmiarze blocksize\n"
 "        (pwritev)\n"
 "\n"
 
-#: .././io/pwrite.c:296
+#: .././io/pwrite.c:298
 #, c-format
 msgid "non-numeric skip -- %s\n"
 msgstr "nieliczbowy liczba bajtów do pominięcia - %s\n"
 
-#: .././io/pwrite.c:394
-#, c-format
-msgid "wrote %lld/%lld bytes at offset %lld\n"
-msgstr "zapisano %lld/%lld bajtów od offsetu %lld\n"
-
-#: .././io/pwrite.c:419
-msgid "[-i infile [-d] [-s skip]] [-b bs] [-S seed] [-wW] [-FBR [-Z N]] [-V N] off len"
-msgstr "[-i plik_wej [-d] [-s do_pominięcia]] [-b rozm_bloku] [-S zarodek] [-wW] [-FBR [-Z N]] [-V N] offset długość"
+#: .././io/pwrite.c:409
+msgid ""
+"[-i infile [-d] [-s skip]] [-b bs] [-S seed] [-wW] [-FBR [-Z N]] [-V N] off "
+"len"
+msgstr ""
+"[-i plik_wej [-d] [-s do_pominięcia]] [-b rozm_bloku] [-S zarodek] [-wW] [-"
+"FBR [-Z N]] [-V N] offset długość"
 
-#: .././io/pwrite.c:421
+#: .././io/pwrite.c:411
 msgid "writes a number of bytes at a specified offset"
 msgstr "zapis podanej liczby bajtów od podanego offsetu"
 
-#: .././io/readdir.c:182
+#: .././io/readdir.c:198
 #, c-format
 msgid "read %llu bytes from offset %lld\n"
 msgstr "odczytano %llu bajtów z offsetu %lld\n"
 
-#: .././io/readdir.c:183
+#: .././io/readdir.c:199
 #, c-format
 msgid "%s, %d ops, %s (%s/sec and %.4f ops/sec)\n"
 msgstr "%s, %d operacji; %s (%s/sek i %.4f operacji/sek)\n"
 
-#: .././io/readdir.c:196
+#: .././io/readdir.c:212
 msgid "[-v][-o offset][-l length]"
 msgstr "[-v][-o offset][-l długość]"
 
-#: .././io/readdir.c:197
+#: .././io/readdir.c:213
 msgid "read directory entries"
 msgstr "odczyt wpisów katalogu"
 
-#: .././io/resblks.c:39
+#: .././io/reflink.c:32
+#, c-format
+msgid ""
+"\n"
+" Links a range of bytes (in block size increments) from a file into a range\n"
+" of bytes in the open file.  The contents of both file ranges must match.\n"
+"\n"
+" Example:\n"
+" 'dedupe some_file 0 4096 32768' - links 32768 bytes from some_file at\n"
+"                                    offset 0 to into the open file at\n"
+"                                    position 4096\n"
+"\n"
+" Reflink a range of blocks from a given input file to the open file.  Both\n"
+" files share the same range of physical disk blocks; a write to the shared\n"
+" range of either file should result in the write landing in a new block and\n"
+" that range of the file being remapped (i.e. copy-on-write).  Both files\n"
+" must reside on the same filesystem, and the contents of both ranges must\n"
+" match.\n"
+msgstr ""
+"\n"
+" Dowiązanie zakresu bajtów (o granicach podzielnych przez rozmiar bloku)\n"
+" do zakresu bajtów w otwartym pliku. Zawartość obu zakresów plików musi być\n"
+" taka sama.\n"
+"\n"
+" Przykład:\n"
+" 'dedupe plik1 0 4096 32768' - dowiązanie 32768 bajtów z pliku1 od offsetu "
+"0\n"
+"                               do otwartego pliku na pozycji 4096\n"
+"\n"
+" dedupe dowiązuje zakres bloków z podanego pliku wejściowego do otwartego\n"
+" pliku. Oba pliki współdzielą ten sam zakres fizycznych bloków na dysku; "
+"zapis\n"
+" do współdzielonego obszaru dowolnego pliku będzie skutkował zapisem do "
+"nowego\n"
+" bloku i zmianą odwzorowania tego obszaru pliku (czyli copy-on-write). Oba\n"
+" pliki muszą się mieścić na tym samym systemie plików, a zawartość obu "
+"zakresów\n"
+" musi być taka sama.\n"
+
+#: .././io/reflink.c:87
+msgid "Extents did not match."
+msgstr "Ekstenty nie są takie same."
+
+#: .././io/reflink.c:141 .././io/reflink.c:264
+#, c-format
+msgid "non-numeric src offset argument -- %s\n"
+msgstr "nieliczbowy argument będący offsetem źródłowym - %s\n"
+
+#: .././io/reflink.c:147 .././io/reflink.c:270
+#, c-format
+msgid "non-numeric dest offset argument -- %s\n"
+msgstr "nieliczbowy argument będący offsetem docelowym - %s\n"
+
+#: .././io/reflink.c:153 .././io/reflink.c:276
+#, c-format
+msgid "non-positive length argument -- %s\n"
+msgstr "niedodatni argument będący długością - %s\n"
+
+#: .././io/reflink.c:178
+#, c-format
+msgid ""
+"\n"
+" Links a range of bytes (in block size increments) from a file into a range\n"
+" of bytes in the open file.  The two extent ranges need not contain "
+"identical\n"
+" data.\n"
+"\n"
+" Example:\n"
+" 'reflink some_file 0 4096 32768' - links 32768 bytes from some_file at\n"
+"                                    offset 0 to into the open file at\n"
+"                                    position 4096\n"
+" 'reflink some_file' - links all bytes from some_file into the open file\n"
+"                       at position 0\n"
+"\n"
+" Reflink a range of blocks from a given input file to the open file.  Both\n"
+" files share the same range of physical disk blocks; a write to the shared\n"
+" range of either file should result in the write landing in a new block and\n"
+" that range of the file being remapped (i.e. copy-on-write).  Both files\n"
+" must reside on the same filesystem.\n"
+msgstr ""
+"\n"
+" Dowiązanie zakresu bajtów (o granicach podzielnych przez rozmiar bloku)\n"
+" do zakresu bajtów w otwartym pliku. Oba zakresy ekstentów nie muszą "
+"zawierać\n"
+" takich samych danych.\n"
+"\n"
+" Przykład:\n"
+" 'reflink plik1 0 4096 32768' - dowiązanie 32768 bajtów z pliku1 od offsetu "
+"0\n"
+"                                do otwartego pliku na pozycji 4096\n"
+" 'reflink plik1' - dowiązanie wszystkich bajtów z pliku1 do otwartego pliku\n"
+"                   na pozycji 0\n"
+"\n"
+" reflink dowiązuje zakres bloków z podanego pliku wejściowego do otwartego\n"
+" pliku. Oba pliki współdzielą ten sam zakres fizycznych bloków na dysku; "
+"zapis\n"
+" do współdzielonego obszaru dowolnego pliku będzie skutkował zapisem do "
+"nowego\n"
+" bloku i zmianą odwzorowania tego obszaru pliku (czyli copy-on-write). Oba\n"
+" pliki muszą się mieścić na tym samym systemie plików.\n"
+
+#: .././io/reflink.c:309
+msgid "infile [src_off dst_off len]"
+msgstr "plik_wej [offset_źr offset_doc długość]"
+
+#: .././io/reflink.c:311
+msgid "reflinks an entire file, or a number of bytes at a specified offset"
+msgstr "dowiązanie całego pliku lub podanej liczby bajtów od podanego offsetu"
+
+#: .././io/reflink.c:323
+msgid "infile src_off dst_off len"
+msgstr "plik_wej offset_źr offset_doc długość"
+
+#: .././io/reflink.c:325
+msgid "dedupes a number of bytes at a specified offset"
+msgstr "deduplikacja podanej liczby bajtów od podanego offsetu"
+
+#: .././io/resblks.c:38
 #, c-format
 msgid "non-numeric argument -- %s\n"
 msgstr "nieliczbowy argument - %s\n"
 
-#: .././io/resblks.c:51
+#: .././io/resblks.c:50
 #, c-format
 msgid "reserved blocks = %llu\n"
 msgstr "zarezerwowane bloki = %llu\n"
 
-#: .././io/resblks.c:53
+#: .././io/resblks.c:52
 #, c-format
 msgid "available reserved blocks = %llu\n"
 msgstr "dostępne zarezerwowane bloki = %llu\n"
 
-#: .././io/resblks.c:66
+#: .././io/resblks.c:65
 msgid "[blocks]"
 msgstr "[bloki]"
 
-#: .././io/resblks.c:68
+#: .././io/resblks.c:67
 msgid "get and/or set count of reserved filesystem blocks"
-msgstr "pobranie i/lub ustawienie liczby zarezerwowanych bloków w systemie plików"
+msgstr ""
+"pobranie i/lub ustawienie liczby zarezerwowanych bloków w systemie plików"
 
-#: .././io/seek.c:33
+#: .././io/seek.c:32
 #, c-format
 msgid ""
 "\n"
@@ -5488,13 +6139,15 @@ msgid ""
 "\n"
 msgstr ""
 "\n"
-" zwrócenie offsetu następnej dziury i/lub danych pod lub za żądanym offsetem\n"
+" zwrócenie offsetu następnej dziury i/lub danych pod lub za żądanym "
+"offsetem\n"
 "\n"
 " Przykłady:\n"
 " 'seek -d 512'  - offset danych pod lub za offsetem 512\n"
 " 'seek -a -r 0' - offsety wszystkich danych i dziur w całym pliku\n"
 "\n"
-" seek zwraca offset następnych danych i/lub dziury. Istnieje domyślna dziura\n"
+" seek zwraca offset następnych danych i/lub dziury. Istnieje domyślna "
+"dziura\n"
 " na końcu pliku. Jeśli podany offset jest za końcem pliku lub nie ma danych\n"
 " za podanym offsetem, zwracany jest EOF.\n"
 " -a\t- następne dane i dziura od podanego offsetu\n"
@@ -5504,15 +6157,15 @@ msgstr ""
 " -s\t- wypisane także offsetu początkowego\n"
 "\n"
 
-#: .././io/seek.c:219
+#: .././io/seek.c:218
 msgid "-a | -d | -h [-r] off"
 msgstr "-a | -d | -h [-r] offset"
 
-#: .././io/seek.c:220
+#: .././io/seek.c:219
 msgid "locate the next data and/or hole"
 msgstr "odnalezienie następnych danych i/lub dziury"
 
-#: .././io/sendfile.c:32
+#: .././io/sendfile.c:31
 #, c-format
 msgid ""
 "\n"
@@ -5535,7 +6188,8 @@ msgstr ""
 " Przykład:\n"
 " 'send -f 2 512 20' - zapisanie 20 bajtów od 512 bajtu do otwartego pliku\n"
 "\n"
-" sendfile kopiuje dane między jednym deskryptorem pliku a innym. Ponieważ to\n"
+" sendfile kopiuje dane między jednym deskryptorem pliku a innym. Ponieważ "
+"to\n"
 " kopiowanie jest wykonywane przez jądro, sendfile nie potrzebuje przesyłać\n"
 " danych do i z przestrzeni użytkownika.\n"
 " -f - podanie plików wejściowego z którego dane mają być czytane\n"
@@ -5543,28 +6197,298 @@ msgstr ""
 " Opcjonalnie można podać offset i długość danych w pliku źródłowym.\n"
 "\n"
 
-#: .././io/sendfile.c:161
+#: .././io/sendfile.c:171
+msgid "-i infile | -f N [off len]"
+msgstr "-i plik_wej | -f N [offset długość]"
+
+#: .././io/sendfile.c:173
+msgid "Transfer data directly between file descriptors"
+msgstr "Przesłanie danych bezpośrednio między deskryptorami plików"
+
+#: .././io/shutdown.c:58
+msgid "[-f]"
+msgstr "[-f]"
+
+#: .././io/shutdown.c:60
+msgid "shuts down the filesystem where the current file resides"
+msgstr "wyłączenie systemu plików na którym znajduje się bieżący plik"
+
+#: .././io/stat.c:52
+msgid "socket"
+msgstr "gniazdo"
+
+#: .././io/stat.c:54 .././repair/da_util.c:105
+msgid "directory"
+msgstr "katalog"
+
+#: .././io/stat.c:56
+msgid "char device"
+msgstr "urządzenie znakowe"
+
+#: .././io/stat.c:58
+msgid "block device"
+msgstr "urządzenie blokowe"
+
+#: .././io/stat.c:60
+msgid "regular file"
+msgstr "plik zwykły"
+
+#: .././io/stat.c:62
+msgid "symbolic link"
+msgstr "dowiązanie symboliczne"
+
+#: .././io/stat.c:64
+msgid "fifo"
+msgstr "potok"
+
+#: .././io/stat.c:95 .././io/stat.c:193
+#, c-format
+msgid "fd.path = \"%s\"\n"
+msgstr "fd.path = \"%s\"\n"
+
+#: .././io/stat.c:96
+#, c-format
+msgid "fd.flags = %s,%s,%s%s%s%s%s\n"
+msgstr "fd.flags = %s,%s,%s%s%s%s%s\n"
+
+#: .././io/stat.c:115
+#, c-format
+msgid "fsxattr.xflags = 0x%x "
+msgstr "fsxattr.xflags = 0x%x "
+
+#: .././io/stat.c:117
+#, c-format
+msgid "fsxattr.projid = %u\n"
+msgstr "fsxattr.projid = %u\n"
+
+#: .././io/stat.c:118
+#, c-format
+msgid "fsxattr.extsize = %u\n"
+msgstr "fsxattr.extsize = %u\n"
+
+#: .././io/stat.c:119
+#, c-format
+msgid "fsxattr.cowextsize = %u\n"
+msgstr "fsxattr.cowextsize = %u\n"
+
+#: .././io/stat.c:120
+#, c-format
+msgid "fsxattr.nextents = %u\n"
+msgstr "fsxattr.nextents = %u\n"
+
+#: .././io/stat.c:121
+#, c-format
+msgid "fsxattr.naextents = %u\n"
+msgstr "fsxattr.naextents = %u\n"
+
+#: .././io/stat.c:126
+#, c-format
+msgid "dioattr.mem = 0x%x\n"
+msgstr "dioattr.mem = 0x%x\n"
+
+#: .././io/stat.c:127
+#, c-format
+msgid "dioattr.miniosz = %u\n"
+msgstr "dioattr.miniosz = %u\n"
+
+#: .././io/stat.c:128
+#, c-format
+msgid "dioattr.maxiosz = %u\n"
+msgstr "dioattr.maxiosz = %u\n"
+
+#: .././io/stat.c:166 .././io/stat.c:364
+#, c-format
+msgid "stat.ino = %lld\n"
+msgstr "stat.ino = %lld\n"
+
+#: .././io/stat.c:167 .././io/stat.c:365
+#, c-format
+msgid "stat.type = %s\n"
+msgstr "stat.type = %s\n"
+
+#: .././io/stat.c:168 .././io/stat.c:366
+#, c-format
+msgid "stat.size = %lld\n"
+msgstr "stat.size = %lld\n"
+
+#: .././io/stat.c:169 .././io/stat.c:367
+#, c-format
+msgid "stat.blocks = %lld\n"
+msgstr "stat.blocks = %lld\n"
+
+#: .././io/stat.c:171 .././io/stat.c:369
+#, c-format
+msgid "stat.atime = %s"
+msgstr "stat.atime = %s"
+
+#: .././io/stat.c:172 .././io/stat.c:370
+#, c-format
+msgid "stat.mtime = %s"
+msgstr "stat.mtime = %s"
+
+#: .././io/stat.c:173 .././io/stat.c:371
+#, c-format
+msgid "stat.ctime = %s"
+msgstr "stat.ctime = %s"
+
+#: .././io/stat.c:197
+#, c-format
+msgid "statfs.f_bsize = %lld\n"
+msgstr "statfs.f_bsize = %lld\n"
+
+#: .././io/stat.c:198
+#, c-format
+msgid "statfs.f_blocks = %lld\n"
+msgstr "statfs.f_blocks = %lld\n"
+
+#: .././io/stat.c:199
+#, c-format
+msgid "statfs.f_bavail = %lld\n"
+msgstr "statfs.f_bavail = %lld\n"
+
+#: .././io/stat.c:200
+#, c-format
+msgid "statfs.f_files = %lld\n"
+msgstr "statfs.f_files = %lld\n"
+
+#: .././io/stat.c:201
+#, c-format
+msgid "statfs.f_ffree = %lld\n"
+msgstr "statfs.f_ffree = %lld\n"
+
+#: .././io/stat.c:208
+#, c-format
+msgid "geom.bsize = %u\n"
+msgstr "geom.bsize = %u\n"
+
+#: .././io/stat.c:209
+#, c-format
+msgid "geom.agcount = %u\n"
+msgstr "geom.agcount = %u\n"
+
+#: .././io/stat.c:210
+#, c-format
+msgid "geom.agblocks = %u\n"
+msgstr "geom.agblocks = %u\n"
+
+#: .././io/stat.c:211
+#, c-format
+msgid "geom.datablocks = %llu\n"
+msgstr "geom.datablocks = %llu\n"
+
+#: .././io/stat.c:213
+#, c-format
+msgid "geom.rtblocks = %llu\n"
+msgstr "geom.rtblocks = %llu\n"
+
+#: .././io/stat.c:215
+#, c-format
+msgid "geom.rtextents = %llu\n"
+msgstr "geom.rtextents = %llu\n"
+
+#: .././io/stat.c:217
+#, c-format
+msgid "geom.rtextsize = %u\n"
+msgstr "geom.rtextsize = %u\n"
+
+#: .././io/stat.c:218
+#, c-format
+msgid "geom.sunit = %u\n"
+msgstr "geom.sunit = %u\n"
+
+#: .././io/stat.c:219
+#, c-format
+msgid "geom.swidth = %u\n"
+msgstr "geom.swidth = %u\n"
+
+#: .././io/stat.c:224
+#, c-format
+msgid "counts.freedata = %llu\n"
+msgstr "counts.freedata = %llu\n"
+
+#: .././io/stat.c:226
+#, c-format
+msgid "counts.freertx = %llu\n"
+msgstr "counts.freertx = %llu\n"
+
+#: .././io/stat.c:228
+#, c-format
+msgid "counts.freeino = %llu\n"
+msgstr "counts.freeino = %llu\n"
+
+#: .././io/stat.c:230
+#, c-format
+msgid "counts.allocino = %llu\n"
+msgstr "counts.allocino = %llu\n"
+
+#: .././io/stat.c:256
+#, c-format
+msgid ""
+"\n"
+" Display extended file status.\n"
+"\n"
+" Options:\n"
+" -v -- More verbose output\n"
+" -r -- Print raw statx structure fields\n"
+" -m mask -- Specify the field mask for the statx call\n"
+"            (can also be 'basic' or 'all'; default STATX_ALL)\n"
+" -D -- Don't sync attributes with the server\n"
+" -F -- Force the attributes to be sync'd with the server\n"
+"\n"
+msgstr ""
+"\n"
+" Wyświetlenie rozszerzonego stanu pliku.\n"
+"\n"
+" Opcje:\n"
+" -v - bardziej szczegółowe wyjście\n"
+" -r - wypisanie surowych pól struktury statx\n"
+" -m maska - określenie maski pól dla wywołania statx\n"
+"            (może być też 'basic' lub 'all'; domyślnie STATX_ALL)\n"
+" -D - bez synchronizacji atrybutów z serwerem\n"
+" -F - wymuszenie synchronizacji atrybutów z serwerem\n"
+"\n"
+
+#: .././io/stat.c:326
+#, c-format
+msgid "non-numeric mask -- %s\n"
+msgstr "nieliczbowa maska - %s\n"
+
+#: .././io/stat.c:373
 #, c-format
-msgid "sent %lld/%lld bytes from offset %lld\n"
-msgstr "przesłano %lld/%lld bajtów od offsetu %lld\n"
+msgid "stat.btime = %s"
+msgstr "stat.btime = %s"
 
-#: .././io/sendfile.c:186
-msgid "-i infile | -f N [off len]"
-msgstr "-i plik_wej | -f N [offset długość]"
+#: .././io/stat.c:393
+msgid "[-v|-r]"
+msgstr "[-v|-r]"
 
-#: .././io/sendfile.c:188
-msgid "Transfer data directly between file descriptors"
-msgstr "Przesłanie danych bezpośrednio między deskryptorami plików"
+#: .././io/stat.c:394
+msgid "statistics on the currently open file"
+msgstr "statystyki dla aktualnie otwartego pliku"
 
-#: .././io/shutdown.c:59
-msgid "[-f]"
-msgstr "[-f]"
+#: .././io/stat.c:401
+msgid "[-v|-r][-m basic | -m all | -m <mask>][-FD]"
+msgstr "[-v|-r][-m basic | -m all | -m <maska>][-FD]"
+
+#: .././io/stat.c:402
+msgid "extended statistics on the currently open file"
+msgstr "rozszerzone statystyki dla aktualnie otwartego pliku"
 
-#: .././io/shutdown.c:61
-msgid "shuts down the filesystem where the current file resides"
-msgstr "wyłączenie systemu plików na którym znajduje się bieżący plik"
+#: .././io/stat.c:409
+msgid "statistics on the filesystem of the currently open file"
+msgstr "statystyki dla systemu plików aktualnie otwartego pliku"
+
+#: .././io/sync.c:58
+msgid "calls sync(2) to flush all in-core filesystem state to disk"
+msgstr ""
+"wywołanie sync(2) aby zrzucić cały stan systemu plików z pamięci na dysk"
+
+#: .././io/sync.c:67
+msgid "calls syncfs(2) to flush all in-core filesystem state to disk"
+msgstr ""
+"wywołanie syncfs(2) aby zrzucić cały stan systemu plików z pamięci na dysk"
 
-#: .././io/sync_file_range.c:31
+#: .././io/sync_file_range.c:30
 #, c-format
 msgid ""
 "\n"
@@ -5577,100 +6501,182 @@ msgid ""
 "\n"
 msgstr ""
 "\n"
-" Wyzwolenie określonych poleceń zapisu w tle na pewnym zakresie bieżącego pliku\n"
+" Wyzwolenie określonych poleceń zapisu w tle na pewnym zakresie bieżącego "
+"pliku\n"
 "\n"
 " Bez opcji przyjmowana jest operacja SYNC_FILE_RANGE_WRITE.\n"
-" -a - oczekiwanie na zakończenie we/wy po zapisie (SYNC_FILE_RANGE_WAIT_AFTER).\n"
-" -b - oczekiwanie na zakończenie we/wy przedtem (SYNC_FILE_RANGE_WAIT_BEFORE).\n"
+" -a - oczekiwanie na zakończenie we/wy po zapisie "
+"(SYNC_FILE_RANGE_WAIT_AFTER).\n"
+" -b - oczekiwanie na zakończenie we/wy przedtem "
+"(SYNC_FILE_RANGE_WAIT_BEFORE).\n"
 " -w - zapis zmodyfikowanych danych z zakresu (SYNC_FILE_RANGE_WRITE).\n"
 "\n"
 
-#: .././io/sync_file_range.c:102
+#: .././io/sync_file_range.c:101
 msgid "[-abw] off len"
 msgstr "[-abw] offset długość"
 
-#: .././io/sync_file_range.c:103
+#: .././io/sync_file_range.c:102
 msgid "Control writeback on a range of a file"
 msgstr "Sterowanie zapisem w tle dla zakresu pliku"
 
-#: .././io/truncate.c:38
+#: .././io/truncate.c:37
 #, c-format
 msgid "non-numeric truncate argument -- %s\n"
 msgstr "nieliczbowy argument truncate - %s\n"
 
-#: .././io/truncate.c:58
+#: .././io/truncate.c:57
 msgid "off"
 msgstr "offset"
 
-#: .././io/truncate.c:60
+#: .././io/truncate.c:59
 msgid "truncates the current file at the given offset"
 msgstr "ucięcie bieżącego pliku na podanym offsecie"
 
+#: .././io/utimes.c:30
+#, c-format
+msgid ""
+"\n"
+" Update file atime and mtime of the current file with nansecond precision.\n"
+"\n"
+" Usage: utimes atime_sec atime_nsec mtime_sec mtime_nsec.\n"
+" *_sec: Seconds elapsed since 1970-01-01 00:00:00 UTC.\n"
+" *_nsec: Nanoseconds since the corresponding *_sec.\n"
+"\n"
+msgstr ""
+"\n"
+" Uaktualnienie atime i mtime bieżącego pliku z dokładnością nanosekundową.\n"
+"\n"
+" Składnia: utimes atime_sec atime_nsec mtime_sec mtime_nsec.\n"
+" *_sec: Sekundy od 1970-01-01 00:00:00 UTC.\n"
+" *_nsec: Nanosekundy od odpowiedniego *_sec.\n"
+"\n"
+
+#: .././io/utimes.c:76
+msgid "atime_sec atime_nsec mtime_sec mtime_nsec"
+msgstr "atime_sec atime_nsec mtime_sec mtime_nsec"
+
+#: .././io/utimes.c:77
+msgid "Update file times of the current file"
+msgstr "Uaktualnienie czasów dla bieżącego pliku"
 
-#: .././libxcmd/command.c:85
+#: .././libxcmd/command.c:95
 #, c-format
 msgid "bad argument count %d to %s, expected at least %d arguments\n"
-msgstr "błędna liczba argumentów %d dla %s, oczekiwano co najmniej %d argumentów\n"
+msgstr ""
+"błędna liczba argumentów %d dla %s, oczekiwano co najmniej %d argumentów\n"
 
-#: .././libxcmd/command.c:89
+#: .././libxcmd/command.c:99
 #, c-format
 msgid "bad argument count %d to %s, expected %d arguments\n"
 msgstr "błędna liczba argumentów %d dla %s, oczekiwano %d argumentów\n"
 
-#: .././libxcmd/command.c:93
+#: .././libxcmd/command.c:103
 #, c-format
 msgid "bad argument count %d to %s, expected between %d and %d arguments\n"
-msgstr "błędna liczba argumentów %d dla %s, oczekiwano od %d do %d argumentów\n"
+msgstr ""
+"błędna liczba argumentów %d dla %s, oczekiwano od %d do %d argumentów\n"
 
-#: .././libxcmd/command.c:155
+#: .././libxcmd/command.c:202
+#, c-format
+msgid "command \"%s\" not found\n"
+msgstr "nie znaleziono polecenia \"%s\"\n"
+
+#: .././libxcmd/command.c:239
 #, c-format
 msgid "cannot strdup command '%s': %s\n"
 msgstr "nie można wykonać strdup na poleceniu '%s': %s\n"
 
-#: .././libxcmd/command.c:171 .././libxcmd/command.c:189
+#: .././libxcmd/command.c:265
 #, c-format
-msgid "command \"%s\" not found\n"
-msgstr "nie znaleziono polecenia \"%s\"\n"
+msgid "%s %lld/%lld bytes at offset %lld\n"
+msgstr "odczytano %s %lld/%lld bajtów od offsetu %lld\n"
+
+#: .././libxcmd/command.c:267
+#, c-format
+msgid "%s, %d ops; %s (%s/sec and %.4f ops/sec)\n"
+msgstr "%s, %d operacji; %s (%s/sek i %.4f operacji/sek)\n"
 
-#: .././libxcmd/paths.c:264
+#: .././libxcmd/paths.c:285
 #, c-format
 msgid "%s: unable to extract mount options for \"%s\"\n"
 msgstr "%s: nie udało się wydobyć opcji montowania dla \"%s\"\n"
 
-#: .././libxcmd/paths.c:344
+#: .././libxcmd/paths.c:371
 #, c-format
 msgid "%s: getmntinfo() failed: %s\n"
 msgstr "%s: getmntinfo() nie powiodło się: %s\n"
 
-#: .././libxcmd/paths.c:413
+#: .././libxcmd/paths.c:440
 #, c-format
 msgid "%s: cannot setup path for mount %s: %s\n"
 msgstr "%s: nie można ustawić ścieżki dla montowania %s: %s\n"
 
-#: .././libxcmd/paths.c:435
+#: .././libxcmd/paths.c:462
 #, c-format
 msgid "%s: cannot find mount point for path `%s': %s\n"
 msgstr "%s: nie można znaleźć punktu montowania dla ścieżki `%s': %s\n"
 
-#: .././libxcmd/paths.c:463
+#: .././libxcmd/paths.c:490
 #, c-format
 msgid "%s: cannot setup path for project %s: %s\n"
 msgstr "%s: nie można ustawić ścieżki dla projektu %s: %s\n"
 
-#: .././libxcmd/paths.c:504
+#: .././libxcmd/paths.c:531
 #, c-format
 msgid "%s: cannot initialise path table: %s\n"
 msgstr "%s: nie można zainicjować tabeli ścieżek: %s\n"
 
-#: .././libxcmd/paths.c:524
+#: .././libxcmd/paths.c:551
 #, c-format
 msgid "%s: cannot setup path for project dir %s: %s\n"
 msgstr "%s: nie można ustawić ścieżki dla katalogu projektu %s: %s\n"
 
-#: .././libxcmd/quit.c:42
+#: .././libxcmd/quit.c:43
 msgid "exit the program"
 msgstr "wyjście z programu"
 
+#: .././libxcmd/topology.c:165
+#, c-format
+msgid "%s: %s appears to contain an existing filesystem (%s).\n"
+msgstr "%s: %s zdaje się zawierać istniejący system plików (%s).\n"
+
+#: .././libxcmd/topology.c:169
+#, c-format
+msgid "%s: %s appears to contain a partition table (%s).\n"
+msgstr "%s: %s zdaje się zawierać tablicę partycji (%s).\n"
+
+#: .././libxcmd/topology.c:173
+#, c-format
+msgid "%s: %s appears to contain something weird according to blkid\n"
+msgstr "%s: %s zdaje się zawierać coś dziwnego wg blkid\n"
+
+#: .././libxcmd/topology.c:182
+#, c-format
+msgid "%s: probe of %s failed, cannot detect existing filesystem.\n"
+msgstr ""
+"%s: test %s nie powiódł się, nie można wykryć istniejącego systemu plików.\n"
+
+#: .././libxcmd/topology.c:204
+#, c-format
+msgid "%s: Warning: trying to probe topology of a file %s!\n"
+msgstr "%s: uwaga: próba sprawdzenia topologii pliku %s!\n"
+
+#: .././libxcmd/topology.c:245
+#, c-format
+msgid "warning: device is not properly aligned %s\n"
+msgstr "uwaga: urządzenie nie jest właściwie wyrównane: %s\n"
+
+#: .././libxcmd/topology.c:250
+#, c-format
+msgid "Use -f to force usage of a misaligned device\n"
+msgstr "Można użyć -f do wymuszenia użycia źle wyrównanego urządzenia\n"
+
+#: .././libxcmd/topology.c:264
+#, c-format
+msgid "warning: unable to probe device topology for device %s\n"
+msgstr "uwaga: nie udało się odczytać topologii urządzenia %s\n"
+
 #: .././libxfs/darwin.c:41
 #, c-format
 msgid "%s: error opening the device special file \"%s\": %s\n"
@@ -5682,7 +6688,7 @@ msgid "%s: can't tell if \"%s\" is writa
 msgstr "%s: nie można stwierdzić czy \"%s\" jest zapisywalny: %s\n"
 
 #: .././libxfs/darwin.c:76 .././libxfs/freebsd.c:116 .././libxfs/irix.c:58
-#: .././libxfs/linux.c:138
+#: .././libxfs/linux.c:170
 #, c-format
 msgid "%s: cannot stat the device file \"%s\": %s\n"
 msgstr "%s: nie można wykonać stat na pliku urządzenia \"%s\": %s\n"
@@ -5693,30 +6699,30 @@ msgid "%s: can't determine device size:
 msgstr "%s: nie można określić rozmiaru urządzenia: %s\n"
 
 #: .././libxfs/darwin.c:139 .././libxfs/freebsd.c:196 .././libxfs/irix.c:106
-#: .././libxfs/linux.c:226
+#: .././libxfs/linux.c:260
 #, c-format
 msgid "%s: can't determine memory size\n"
 msgstr "%s: nie można określić rozmiaru pamięci\n"
 
-#: .././libxfs/freebsd.c:49
+#: .././libxfs/freebsd.c:49 .././libxfs/linux.c:76
 #, c-format
 msgid "%s: %s possibly contains a mounted filesystem\n"
-msgstr "%s: %s może zawierać podmontowany system plików\n"
+msgstr "%s: %s może zawierać zamontowany system plików\n"
 
-#: .././libxfs/freebsd.c:60 .././libxfs/linux.c:67
+#: .././libxfs/freebsd.c:60 .././libxfs/linux.c:104
 #, c-format
 msgid "%s: %s contains a mounted filesystem\n"
-msgstr "%s: %s zawiera podmontowany system plików\n"
+msgstr "%s: %s zawiera zamontowany system plików\n"
 
-#: .././libxfs/freebsd.c:75 .././libxfs/linux.c:85
+#: .././libxfs/freebsd.c:75
 #, c-format
 msgid "%s: %s contains a possibly writable, mounted filesystem\n"
-msgstr "%s: %s zawiera podmontowany, być może zapisywalny system plików\n"
+msgstr "%s: %s zawiera zamontowany, być może zapisywalny system plików\n"
 
-#: .././libxfs/freebsd.c:89 .././libxfs/linux.c:99
+#: .././libxfs/freebsd.c:89 .././libxfs/linux.c:100
 #, c-format
 msgid "%s: %s contains a mounted and writable filesystem\n"
-msgstr "%s: %s zawiera podmontowany, zapisywalny system plików\n"
+msgstr "%s: %s zawiera zamontowany, zapisywalny system plików\n"
 
 #: .././libxfs/freebsd.c:129
 #, c-format
@@ -5733,117 +6739,142 @@ msgstr "%s: DIOCGMEDIASIE nie powiodło
 msgid "%s: DIOCGSECTORSIZE failed on \"%s\": %s\n"
 msgstr "%s: DIOCGSECTORSIZE nie powiodło się dla \"%s\": %s\n"
 
-#: .././libxfs/init.c:79 .././libxfs/init.c:178
+#: .././libxfs/init.c:97 .././libxfs/init.c:196
 #, c-format
 msgid "%s: %s: device %lld is not open\n"
 msgstr "%s: %s: urządzenie %lld nie jest otwarte\n"
 
-#: .././libxfs/init.c:115
+#: .././libxfs/init.c:133
 #, c-format
 msgid "%s: cannot stat %s: %s\n"
 msgstr "%s: nie można wykonać stat na %s: %s\n"
 
-#: .././libxfs/init.c:140
+#: .././libxfs/init.c:158
 #, c-format
 msgid "%s: device %lld is already open\n"
 msgstr "%s: urządzenie %lld jest już otwarte\n"
 
-#: .././libxfs/init.c:153
+#: .././libxfs/init.c:171
 #, c-format
 msgid "%s: %s: too many open devices\n"
 msgstr "%s: %s: zbyt dużo otwartych urządzeń\n"
 
-#: .././libxfs/init.c:196
+#: .././libxfs/init.c:214
 #, c-format
 msgid "%s: can't find a character device matching %s\n"
 msgstr "%s: nie można odnaleźć urządzenia znakowego odpowiadającego %s\n"
 
-#: .././libxfs/init.c:202
+#: .././libxfs/init.c:220
 #, c-format
 msgid "%s: can't find a block device matching %s\n"
 msgstr "%s: nie można odnaleźć urządzenia blokowego odpowiadającego %s\n"
 
-#: .././libxfs/init.c:319
+#: .././libxfs/init.c:348
 #, c-format
 msgid "%s: can't get size for data subvolume\n"
 msgstr "%s: nie można pobrać rozmiaru podwolumenu danych\n"
 
-#: .././libxfs/init.c:324
+#: .././libxfs/init.c:353
 #, c-format
 msgid "%s: can't get size for log subvolume\n"
 msgstr "%s: nie można pobrać rozmiaru podwolumenu logu\n"
 
-#: .././libxfs/init.c:329
+#: .././libxfs/init.c:358
 #, c-format
 msgid "%s: can't get size for realtime subvolume\n"
 msgstr "%s: nie można pobrać rozmiaru podwolumenu realtime\n"
 
-#: .././libxfs/init.c:423
+#: .././libxfs/init.c:453
 #, c-format
 msgid "%s: filesystem has a realtime subvolume\n"
 msgstr "%s: system plików ma podwolumen realtime\n"
 
-#: .././libxfs/init.c:445
+#: .././libxfs/init.c:475
 #, c-format
 msgid "%s: realtime init - %llu != %llu\n"
 msgstr "%s: inicjalizacja realtime - %llu != %llu\n"
 
-#: .././libxfs/init.c:453
+#: .././libxfs/init.c:483
 #, c-format
 msgid "%s: realtime size check failed\n"
 msgstr "%s: sprawdzenie rozmiaru realtime nie powiodło się\n"
 
-#: .././libxfs/init.c:573
+#: .././libxfs/init.c:605
 #, c-format
 msgid "%s: buftarg init failed\n"
 msgstr "%s: nie udało się zainicjować buftarg\n"
 
-#: .././libxfs/init.c:594
+#: .././libxfs/init.c:626
 #, c-format
 msgid "%s: bad buftarg reinit, ddev\n"
 msgstr "%s: błędna reinicjacja buftarg, ddev\n"
 
-#: .././libxfs/init.c:601
+#: .././libxfs/init.c:633
 #, c-format
 msgid "%s: bad buftarg reinit, ldev mismatch\n"
 msgstr "%s: błędna reinicjacja buftarg, niezgodność ldev\n"
 
-#: .././libxfs/init.c:608
+#: .././libxfs/init.c:640
 #, c-format
 msgid "%s: bad buftarg reinit, logdev\n"
 msgstr "%s: błędna reinicjacja buftarg, logdev\n"
 
-#: .././libxfs/init.c:615
+#: .././libxfs/init.c:647
 #, c-format
 msgid "%s: bad buftarg reinit, rtdev\n"
 msgstr "%s: błędna reinicjacja buftarg, rtdev\n"
 
-#: .././libxfs/init.c:707
+#: .././libxfs/init.c:741
 #, c-format
 msgid "%s: size check failed\n"
 msgstr "%s: sprawdzenie rozmiaru nie powiodło się\n"
 
-#: .././libxfs/init.c:716
+#: .././libxfs/init.c:753
+#, c-format
+msgid "%s: V1 inodes unsupported. Please try an older xfsprogs.\n"
+msgstr ""
+"%s: i-węzły V1 nie są obsługiwane. Proszę spróbować starszą wersją "
+"xfsprogs.\n"
+
+#: .././libxfs/init.c:762
 #, c-format
 msgid "%s: V1 directories unsupported. Please try an older xfsprogs.\n"
-msgstr "%s: katalogi V1 nie są obsługiwane. Proszę spróbować starszą wersją xfsprogs.\n"
+msgstr ""
+"%s: katalogi V1 nie są obsługiwane. Proszę spróbować starszą wersją "
+"xfsprogs.\n"
+
+#: .././libxfs/init.c:770
+#, c-format
+msgid "%s: Unsupported features detected. Please try a newer xfsprogs.\n"
+msgstr ""
+"%s: Wykryto nie obsługiwane cechy. Proszę spróbować nowszą wersją xfsprogs.\n"
 
-#: .././libxfs/init.c:737
+#: .././libxfs/init.c:790
 #, c-format
 msgid "%s: data size check failed\n"
 msgstr "%s: sprawdzenie rozmiaru danych nie powiodło się\n"
 
-#: .././libxfs/init.c:751
+#: .././libxfs/init.c:804
 #, c-format
 msgid "%s: log size checks failed\n"
 msgstr "%s: sprawdzenie rozmiaru logu nie powiodło się\n"
 
-#: .././libxfs/init.c:762
+#: .././libxfs/init.c:815
 #, c-format
 msgid "%s: realtime device init failed\n"
 msgstr "%s: inicjalizacja urządzenia realtime nie powiodła się\n"
 
-#: .././libxfs/init.c:769
+#: .././libxfs/init.c:832
+#, c-format
+msgid "%s: read of AG %u failed\n"
+msgstr "%s: odczyt AG %u nie powiódł się\n"
+
+#: .././libxfs/init.c:836
+#, c-format
+msgid "%s: limiting reads to AG 0\n"
+msgstr "%s: ograniczenie odczytu do AG 0\n"
+
+#: .././libxfs/init.c:845
 #, c-format
 msgid "%s: perag init failed\n"
 msgstr "%s: nie udało się zainicjować perag\n"
@@ -5868,122 +6899,135 @@ msgstr "%s: malloc nie powiodło się (%
 msgid "%s: realloc failed (%d bytes): %s\n"
 msgstr "%s: realloc nie powiodło się (%d bajtów): %s\n"
 
-#: .././libxfs/linux.c:114
+#: .././libxfs/linux.c:137
 #, c-format
 msgid "%s: %s - cannot set blocksize %d on block device %s: %s\n"
-msgstr "%s: %s - nie można ustawić rozmiaru bloku %d dla urządzenia blokowego %s: %s\n"
+msgstr ""
+"%s: %s - nie można ustawić rozmiaru bloku %d dla urządzenia blokowego %s: "
+"%s\n"
 
-#: .././libxfs/linux.c:171
+#: .././libxfs/linux.c:205
 #, c-format
 msgid "%s: can't determine device size\n"
 msgstr "%s: nie można określić rozmiaru urządzenia\n"
 
-#: .././libxfs/linux.c:179
+#: .././libxfs/linux.c:213
 #, c-format
 msgid "%s: warning - cannot get sector size from block device %s: %s\n"
-msgstr "%s: uwaga - nie można pobrać rozmiaru sektora urządzenia blokowego %s: %s\n"
+msgstr ""
+"%s: uwaga - nie można pobrać rozmiaru sektora urządzenia blokowego %s: %s\n"
 
-#: .././libxfs/rdwr.c:68
+#: .././libxfs/rdwr.c:82
 #, c-format
 msgid "%s: %s can't memalign %d bytes: %s\n"
 msgstr "%s: %s nie można wykonać memalign dla %d bajtów: %s\n"
 
-#: .././libxfs/rdwr.c:78
+#: .././libxfs/rdwr.c:92
 #, c-format
 msgid "%s: %s seek to offset %llu failed: %s\n"
 msgstr "%s: %s zmiana offsetu na %llu nie powiodła się: %s\n"
 
-#: .././libxfs/rdwr.c:88
+#: .././libxfs/rdwr.c:102
 #, c-format
 msgid "%s: %s write failed: %s\n"
 msgstr "%s: %s zapis nie powiódł się: %s\n"
 
-#: .././libxfs/rdwr.c:92
+#: .././libxfs/rdwr.c:106
 #, c-format
 msgid "%s: %s not progressing?\n"
 msgstr "%s: %s nie postępuje?\n"
 
-#: .././libxfs/rdwr.c:409
+#: .././libxfs/rdwr.c:581
 #, c-format
 msgid "%s: %s can't memalign %u bytes: %s\n"
 msgstr "%s: %s nie można wykonać memalign dla %u bajtów: %s\n"
 
-#: .././libxfs/rdwr.c:441
+#: .././libxfs/rdwr.c:614
 #, c-format
 msgid "%s: %s can't malloc %u bytes: %s\n"
 msgstr "%s: %s nie można przydzielić %u bajtów: %s\n"
 
-#: .././libxfs/rdwr.c:522
+#: .././libxfs/rdwr.c:697
 #, c-format
 msgid "%s: %s invalid map %p or nmaps %d\n"
 msgstr "%s: %s nieprawidłowa mapa %p lub nmaps %d\n"
 
-#: .././libxfs/rdwr.c:529
+#: .././libxfs/rdwr.c:704
 #, c-format
 msgid "%s: %s map blkno 0x%llx doesn't match key 0x%llx\n"
 msgstr "%s: %s map blkno 0x%llx nie pasuje do klucza 0x%llx\n"
 
-#: .././libxfs/rdwr.c:574
+#: .././libxfs/rdwr.c:749
 #, c-format
 msgid "Warning: recursive buffer locking at block %<PRIu64> detected\n"
 msgstr "Uwaga: wykryto rekurencyjną blokadę bufora na bloku %<PRIu64>\n"
 
-#: .././libxfs/rdwr.c:710
+#: .././libxfs/rdwr.c:921
 #, c-format
 msgid "%s: read failed: %s\n"
 msgstr "%s: odczyt nie powiódł się: %s\n"
 
-#: .././libxfs/rdwr.c:716
+#: .././libxfs/rdwr.c:927
 #, c-format
 msgid "%s: error - read only %d of %d bytes\n"
 msgstr "%s: błąd - odczytano tylko %d z %d bajtów\n"
 
-#: .././libxfs/rdwr.c:878
+#: .././libxfs/rdwr.c:1089
 #, c-format
 msgid "%s: pwrite failed: %s\n"
 msgstr "%s: pwrite nie powiodło się: %s\n"
 
-#: .././libxfs/rdwr.c:884
+#: .././libxfs/rdwr.c:1095
 #, c-format
 msgid "%s: error - pwrite only %d of %d bytes\n"
 msgstr "%s: błąd - wykonano pwrite tylko %d z %d bajtów\n"
 
-#: .././libxfs/rdwr.c:920
+#: .././libxfs/rdwr.c:1130
 #, c-format
-msgid "%s: write verifer failed on bno 0x%llx/0x%x\n"
-msgstr "%s: weryfikacja zapisu nie powiodła się na bno 0x%llx/0x%x\n"
+msgid "%s: write verifer failed on %s bno 0x%llx/0x%x\n"
+msgstr "%s: weryfikacja zapisu nie powiodła się na %s bno 0x%llx/0x%x\n"
 
-#: .././libxfs/trans.c:56
+#: .././libxfs/trans.c:69
 #, c-format
 msgid "%s: lidp calloc failed (%d bytes): %s\n"
 msgstr "%s: calloc lidp nie powiodło się (%d bajtów): %s\n"
 
-#: .././libxfs/trans.c:151
+#: .././libxfs/trans.c:183
 #, c-format
 msgid "%s: xact calloc failed (%d bytes): %s\n"
 msgstr "%s: xact calloc nie powiodło się (%d bajtów): %s\n"
 
-#: .././libxfs/trans.c:676
+#: .././libxfs/trans.c:670
 #, c-format
 msgid "%s: warning - imap_to_bp failed (%d)\n"
 msgstr "%s: uwaga - imap_to_bp nie powiodło się (%d)\n"
 
-#: .././libxfs/trans.c:684
+#: .././libxfs/trans.c:678
 #, c-format
 msgid "%s: warning - iflush_int failed (%d)\n"
 msgstr "%s: uwaga - iflush_int nie powiodło się (%d)\n"
 
-#: .././libxfs/trans.c:744 .././libxfs/trans.c:799
+#: .././libxfs/trans.c:738 .././libxfs/trans.c:792
 #, c-format
 msgid "%s: unrecognised log item type\n"
 msgstr "%s: nierozpoznany typ elementu logu\n"
 
-#: .././libxfs/util.c:691
+#: .././libxfs/util.c:626
+#, c-format
+msgid "%s: cannot duplicate transaction: %s\n"
+msgstr "%s: nie można powielić transakcji: %s\n"
+
+#: .././libxlog/util.c:67
+#, c-format
+msgid "%s: cannot find log head/tail (xlog_find_tail=%d)\n"
+msgstr "%s: nie odnaleziono początku/końca logu (xlog_find_tail=%d)\n"
+
+#: .././libxlog/util.c:75
 #, c-format
-msgid "%s: cannot reserve space: %s\n"
-msgstr "%s: nie można zarezerwować przestrzeni: %s\n"
+msgid "%s: head block %<PRId64> tail block %<PRId64>\n"
+msgstr "%s: blok początku %<PRId64> blok końca %<PRId64>\n"
 
-#: .././libxlog/util.c:37
+#: .././libxlog/util.c:97
 #, c-format
 msgid ""
 "* ERROR: mismatched uuid in log\n"
@@ -5994,7 +7038,7 @@ msgstr ""
 "             SB : %s\n"
 "             log: %s\n"
 
-#: .././libxlog/util.c:50
+#: .././libxlog/util.c:110
 #, c-format
 msgid ""
 "\n"
@@ -6003,387 +7047,364 @@ msgstr ""
 "\n"
 "LOG REC AT LSN cykl %d blok %d (0x%x, 0x%x)\n"
 
-#: .././libxlog/util.c:58
+#: .././libxlog/util.c:118
 #, c-format
 msgid "* ERROR: bad magic number in log header: 0x%x\n"
 msgstr "* BŁĄD: błędna liczba magiczna w nagłówku logu: 0x%x\n"
 
-#: .././libxlog/util.c:67
+#: .././libxlog/util.c:127
 #, c-format
 msgid "* ERROR: log format incompatible (log=%d, ours=%d)\n"
 msgstr "* BŁĄD: niekompatybilny format logu (log=%d, nasz=%d)\n"
 
-#: .././libxlog/util.c:77 .././libxlog/util.c:89
+#: .././libxlog/util.c:137 .././libxlog/util.c:149
 msgid "Bad log"
 msgstr "Błędny log"
 
-#: .././logprint/log_copy.c:44 .././logprint/log_dump.c:43
+#: .././logprint/log_copy.c:46 .././logprint/log_dump.c:45
 #, c-format
 msgid "%s: read error (%lld): %s\n"
 msgstr "%s: błąd odczytu (%lld): %s\n"
 
-#: .././logprint/log_copy.c:49 .././logprint/log_dump.c:48
+#: .././logprint/log_copy.c:51 .././logprint/log_dump.c:50
 #, c-format
 msgid "%s: physical end of log at %lld\n"
 msgstr "%s: fizyczny koniec logu na %lld\n"
 
-#: .././logprint/log_copy.c:53
+#: .././logprint/log_copy.c:55
 #, c-format
 msgid "%s: short read? (%lld)\n"
 msgstr "%s: skrócony odczyt? (%lld)\n"
 
-#: .././logprint/log_copy.c:60
+#: .././logprint/log_copy.c:62
 #, c-format
 msgid "%s: write error (%lld): %s\n"
 msgstr "%s: błąd zapisu (%lld): %s\n"
 
-#: .././logprint/log_copy.c:65
+#: .././logprint/log_copy.c:67
 #, c-format
 msgid "%s: short write? (%lld)\n"
 msgstr "%s: skrócony zapis? (%lld)\n"
 
-#: .././logprint/log_dump.c:56
+#: .././logprint/log_dump.c:58
 #, c-format
 msgid "%6lld HEADER Cycle %d tail %d:%06d len %6d ops %d\n"
 msgstr "%6lld NAGŁÓWEK Cykl %d koniec %d:%06d len %6d ops %d\n"
 
-#: .././logprint/log_dump.c:67
+#: .././logprint/log_dump.c:69
 #, c-format
 msgid "[%05lld - %05lld] Cycle 0x%08x New Cycle 0x%08x\n"
 msgstr "[%05lld - %05lld] Cykl 0x%08x Nowy cykl 0x%08x\n"
 
-#: .././logprint/log_misc.c:131
+#: .././logprint/log_misc.c:87
 #, c-format
 msgid "Oper (%d): tid: %x  len: %d  clientid: %s  "
 msgstr "Operacja (%d): tid: %x  len: %d  clientid: %s  "
 
-#: .././logprint/log_misc.c:136
+#: .././logprint/log_misc.c:92
 #, c-format
 msgid "flags: "
 msgstr "flagi: "
 
-#: .././logprint/log_misc.c:230
+#: .././logprint/log_misc.c:186
 #, c-format
 msgid "   Not enough data to decode further\n"
 msgstr "   Za mało danych do dalszego dekodowania\n"
 
-#: .././logprint/log_misc.c:234
+#: .././logprint/log_misc.c:190
 #, c-format
-msgid "    type: %s       tid: %x       num_items: %d\n"
-msgstr "    typ: %s        tid: %x       num_items: %d\n"
+msgid "     tid: %x  num_items: %d\n"
+msgstr "    tid: %x  num_items: %d\n"
 
-#: .././logprint/log_misc.c:282
+#: .././logprint/log_misc.c:235
 #, c-format
-msgid "#regs: %d   start blkno: %lld (0x%llx)  len: %d  bmap size: %d  flags: 0x%x\n"
-msgstr "#regs: %d   start blkno: %lld (0x%llx)  len: %d  bmap size: %d  flags: 0x%x\n"
+msgid ""
+"#regs: %d   start blkno: %lld (0x%llx)  len: %d  bmap size: %d  flags: 0x%x\n"
+msgstr ""
+"#regs: %d   start blkno: %lld (0x%llx)  len: %d  bmap size: %d  flags: 0x%x\n"
 
-#: .././logprint/log_misc.c:288
+#: .././logprint/log_misc.c:241
 #, c-format
 msgid "#regs: %d   Not printing rest of data\n"
 msgstr "#regs: %d   Bez wypisywania reszty danych\n"
 
-#: .././logprint/log_misc.c:305
+#: .././logprint/log_misc.c:258
 #, c-format
 msgid "SUPER BLOCK Buffer: "
 msgstr "Bufor SUPER BLOKU: "
 
-#: .././logprint/log_misc.c:307 .././logprint/log_misc.c:371
-#: .././logprint/log_misc.c:397
+#: .././logprint/log_misc.c:260 .././logprint/log_misc.c:348
+#: .././logprint/log_misc.c:378
 #, c-format
 msgid "Out of space\n"
 msgstr "Brak miejsca na dysku\n"
 
-#: .././logprint/log_misc.c:315
+#: .././logprint/log_misc.c:268
 #, c-format
 msgid "icount: %llu  ifree: %llu  "
 msgstr "icount: %llu  ifree: %llu  "
 
-#: .././logprint/log_misc.c:320
+#: .././logprint/log_misc.c:273
 #, c-format
 msgid "fdblks: %llu  frext: %llu\n"
 msgstr "fdblks: %llu  frext: %llu\n"
 
-#: .././logprint/log_misc.c:327
+#: .././logprint/log_misc.c:284
 #, c-format
 msgid "AGI Buffer: XAGI  "
 msgstr "Bufor AGI: XAGI  "
 
-#: .././logprint/log_misc.c:330
+#: .././logprint/log_misc.c:295
 #, c-format
 msgid "out of space\n"
 msgstr "brak miejsca na dysku\n"
 
-#: .././logprint/log_misc.c:333
+#: .././logprint/log_misc.c:298
 #, c-format
 msgid "ver: %d  "
 msgstr "wersja: %d  "
 
-#: .././logprint/log_misc.c:335
+#: .././logprint/log_misc.c:300
 #, c-format
 msgid "seq#: %d  len: %d  cnt: %d  root: %d\n"
 msgstr "seq#: %d  len: %d  cnt: %d  root: %d\n"
 
-#: .././logprint/log_misc.c:340
+#: .././logprint/log_misc.c:305
 #, c-format
 msgid "level: %d  free#: 0x%x  newino: 0x%x\n"
 msgstr "level: %d  free#: 0x%x  newino: 0x%x\n"
 
-#: .././logprint/log_misc.c:350
+#: .././logprint/log_misc.c:315
 #, c-format
 msgid "AGI unlinked data skipped "
 msgstr "Pominięto niedowiązane dane AGI "
 
-#: .././logprint/log_misc.c:351
+#: .././logprint/log_misc.c:316
 #, c-format
 msgid "(CONTINUE set, no space)\n"
 msgstr "(KONTYNUACJA, brak miejsca)\n"
 
-#: .././logprint/log_misc.c:357 .././logprint/log_print_all.c:146
+#: .././logprint/log_misc.c:322 .././logprint/log_print_all.c:148
 #, c-format
 msgid "bucket[%d - %d]: "
 msgstr "kubełek[%d - %d]: "
 
-#: .././logprint/log_misc.c:369
+#: .././logprint/log_misc.c:338
 #, c-format
 msgid "AGF Buffer: XAGF  "
 msgstr "Bufor AGF: XAGF  "
 
-#: .././logprint/log_misc.c:374
+#: .././logprint/log_misc.c:351
 #, c-format
 msgid "ver: %d  seq#: %d  len: %d  \n"
 msgstr "ver: %d  seq#: %d  len: %d  \n"
 
-#: .././logprint/log_misc.c:378
+#: .././logprint/log_misc.c:355
 #, c-format
 msgid "root BNO: %d  CNT: %d\n"
 msgstr "root BNO: %d  CNT: %d\n"
 
-#: .././logprint/log_misc.c:381
+#: .././logprint/log_misc.c:358
 #, c-format
 msgid "level BNO: %d  CNT: %d\n"
 msgstr "level BNO: %d  CNT: %d\n"
 
-#: .././logprint/log_misc.c:384
+#: .././logprint/log_misc.c:361
 #, c-format
 msgid "1st: %d  last: %d  cnt: %d  freeblks: %d  longest: %d\n"
 msgstr "1st: %d  last: %d  cnt: %d  freeblks: %d  longest: %d\n"
 
-#: .././logprint/log_misc.c:394
+#: .././logprint/log_misc.c:375
 #, c-format
 msgid "DQUOT Buffer: DQ  "
 msgstr "Bufor DQUOT: DQ  "
 
-#: .././logprint/log_misc.c:401
+#: .././logprint/log_misc.c:382
 #, c-format
 msgid "ver: %d  flags: 0x%x  id: %d  \n"
 msgstr "ver: %d  flags: 0x%x  id: %d  \n"
 
-#: .././logprint/log_misc.c:404
+#: .././logprint/log_misc.c:385
 #, c-format
 msgid "blk limits  hard: %llu  soft: %llu\n"
 msgstr "blk limits  hard: %llu  soft: %llu\n"
 
-#: .././logprint/log_misc.c:409
+#: .././logprint/log_misc.c:390
 #, c-format
 msgid "blk  count: %llu  warns: %d  timer: %d\n"
 msgstr "blk  count: %llu  warns: %d  timer: %d\n"
 
-#: .././logprint/log_misc.c:413
+#: .././logprint/log_misc.c:394
 #, c-format
 msgid "ino limits  hard: %llu  soft: %llu\n"
 msgstr "ino limits  hard: %llu  soft: %llu\n"
 
-#: .././logprint/log_misc.c:418
+#: .././logprint/log_misc.c:399
 #, c-format
 msgid "ino  count: %llu  warns: %d  timer: %d\n"
 msgstr "ino  count: %llu  warns: %d  timer: %d\n"
 
-#: .././logprint/log_misc.c:424
+#: .././logprint/log_misc.c:405
 #, c-format
 msgid "BUF DATA\n"
 msgstr "DANE BUFORA\n"
 
-#: .././logprint/log_misc.c:466
-#, c-format
-msgid "EFD:  #regs: %d    num_extents: %d  id: 0x%llx\n"
-msgstr "EFD:  #regs: %d    num_extents: %d  id: 0x%llx\n"
-
-#: .././logprint/log_misc.c:473
-#, c-format
-msgid "EFD: Not enough data to decode further\n"
-msgstr "EFD: Za mało danych do dalszego dekodowania\n"
-
-#: .././logprint/log_misc.c:497 .././logprint/log_misc.c:513
-#, c-format
-msgid "%s: xlog_print_trans_efi: malloc failed\n"
-msgstr "%s: xlog_print_trans_efi: malloc nie powiodło się\n"
-
-#: .././logprint/log_misc.c:507
-#, c-format
-msgid "EFI: Not enough data to decode further\n"
-msgstr "EFI: Za mało danych do dalszego dekodowania\n"
-
-#: .././logprint/log_misc.c:521
-#, c-format
-msgid "EFI:  #regs: %d    num_extents: %d  id: 0x%llx\n"
-msgstr "EFI:  #regs: %d    num_extents: %d  id: 0x%llx\n"
-
-#: .././logprint/log_misc.c:525
-#, c-format
-msgid "EFI free extent data skipped (CONTINUE set, no space)\n"
-msgstr "Pominięto dane wolnego ekstentu EFI (KONTYNUACJA, brak miejsca)\n"
-
-#: .././logprint/log_misc.c:554
+#: .././logprint/log_misc.c:441
 #, c-format
 msgid "QOFF:  #regs: %d    flags: 0x%x\n"
 msgstr "QOFF:  #regs: %d    flags: 0x%x\n"
 
-#: .././logprint/log_misc.c:557
+#: .././logprint/log_misc.c:444
 #, c-format
 msgid "QOFF: Not enough data to decode further\n"
 msgstr "QOFF: Za mało danych do dalszego dekodowania\n"
 
-#: .././logprint/log_misc.c:566
+#: .././logprint/log_misc.c:454
 #, c-format
 msgid "INODE CORE\n"
 msgstr "RDZEŃ I-WĘZŁA\n"
 
-#: .././logprint/log_misc.c:567
+#: .././logprint/log_misc.c:455
 #, c-format
 msgid "magic 0x%hx mode 0%ho version %d format %d\n"
 msgstr "magic 0x%hx mode 0%ho version %d format %d\n"
 
-#: .././logprint/log_misc.c:570
+#: .././logprint/log_misc.c:458
 #, c-format
 msgid "nlink %hd uid %d gid %d\n"
 msgstr "nlink %hd uid %d gid %d\n"
 
-#: .././logprint/log_misc.c:572
+#: .././logprint/log_misc.c:460
 #, c-format
 msgid "atime 0x%x mtime 0x%x ctime 0x%x\n"
 msgstr "atime 0x%x mtime 0x%x ctime 0x%x\n"
 
-#: .././logprint/log_misc.c:574
+#: .././logprint/log_misc.c:462
 #, c-format
 msgid "size 0x%llx nblocks 0x%llx extsize 0x%x nextents 0x%x\n"
 msgstr "size 0x%llx nblocks 0x%llx extsize 0x%x nextents 0x%x\n"
 
-#: .././logprint/log_misc.c:577
+#: .././logprint/log_misc.c:465
 #, c-format
 msgid "naextents 0x%x forkoff %d dmevmask 0x%x dmstate 0x%hx\n"
 msgstr "naextents 0x%x forkoff %d dmevmask 0x%x dmstate 0x%hx\n"
 
-#: .././logprint/log_misc.c:580
+#: .././logprint/log_misc.c:468
 #, c-format
 msgid "flags 0x%x gen 0x%x\n"
 msgstr "flags 0x%x gen 0x%x\n"
 
-#: .././logprint/log_misc.c:596
+#: .././logprint/log_misc.c:471 .././logprint/log_print_all.c:276
+#, c-format
+msgid "flags2 0x%llx cowextsize 0x%x\n"
+msgstr "flags2 0x%llx cowextsize 0x%x\n"
+
+#: .././logprint/log_misc.c:488
 #, c-format
 msgid "SHORTFORM DIRECTORY size %d\n"
 msgstr "Rozmiar KATALOGU W POSTACI KRÓTKIEJ %d\n"
 
-#: .././logprint/log_misc.c:602
+#: .././logprint/log_misc.c:494
 #, c-format
 msgid "SHORTFORM DIRECTORY size %d count %d\n"
 msgstr "KATALOG W POSTACI KRÓTKIEJ: rozmiar %d liczba %d\n"
 
-#: .././logprint/log_misc.c:605
+#: .././logprint/log_misc.c:497
 #, c-format
 msgid ".. ino 0x%llx\n"
 msgstr ".. ino 0x%llx\n"
 
-#: .././logprint/log_misc.c:613
+#: .././logprint/log_misc.c:505
 #, c-format
 msgid "%s ino 0x%llx namelen %d\n"
 msgstr "%s ino 0x%llx namelen %d\n"
 
-#: .././logprint/log_misc.c:652
+#: .././logprint/log_misc.c:545
 #, c-format
 msgid "INODE: "
 msgstr "I-WĘZEŁ: "
 
-#: .././logprint/log_misc.c:653
+#: .././logprint/log_misc.c:546
 #, c-format
 msgid "#regs: %d   ino: 0x%llx  flags: 0x%x   dsize: %d\n"
 msgstr "#regs: %d   ino: 0x%llx  flags: 0x%x   dsize: %d\n"
 
-#: .././logprint/log_misc.c:656
+#: .././logprint/log_misc.c:549
 #, c-format
 msgid "        blkno: %lld  len: %d  boff: %d\n"
 msgstr "        blkno: %lld  len: %d  boff: %d\n"
 
-#: .././logprint/log_misc.c:661
+#: .././logprint/log_misc.c:554
 #, c-format
 msgid "INODE: #regs: %d   Not printing rest of data\n"
 msgstr "I-WĘZEŁ: #regs: %d   Bez wypisywania reszty danych\n"
 
-#: .././logprint/log_misc.c:692
+#: .././logprint/log_misc.c:581
 #, c-format
 msgid "DEV inode: no extra region\n"
 msgstr "I-węzeł DEV: brak dodatkowego regionu\n"
 
-#: .././logprint/log_misc.c:695
+#: .././logprint/log_misc.c:584
 #, c-format
 msgid "UUID inode: no extra region\n"
 msgstr "I-węzeł UUID: brak dodatkowego regionu\n"
 
-#: .././logprint/log_misc.c:712
+#: .././logprint/log_misc.c:606
 #, c-format
 msgid "EXTENTS inode data\n"
 msgstr "EKSTENTY danych i-węzła\n"
 
-#: .././logprint/log_misc.c:715
+#: .././logprint/log_misc.c:609
 #, c-format
 msgid "BTREE inode data\n"
 msgstr "B-DRZEWO danych i-węzła\n"
 
-#: .././logprint/log_misc.c:718
+#: .././logprint/log_misc.c:612
 #, c-format
 msgid "LOCAL inode data\n"
 msgstr "LOKALNE dane i-węzła\n"
 
-#: .././logprint/log_misc.c:739
+#: .././logprint/log_misc.c:636
 #, c-format
 msgid "EXTENTS attr data\n"
 msgstr "EKSTENTY danych atrybutów\n"
 
-#: .././logprint/log_misc.c:742
+#: .././logprint/log_misc.c:639
 #, c-format
 msgid "BTREE attr data\n"
 msgstr "B-DRZEWO danych atrybutów\n"
 
-#: .././logprint/log_misc.c:745
+#: .././logprint/log_misc.c:642
 #, c-format
 msgid "LOCAL attr data\n"
 msgstr "LOKALNE dane atrybutów\n"
 
-#: .././logprint/log_misc.c:783
+#: .././logprint/log_misc.c:683
 #, c-format
 msgid "#regs: %d   id: 0x%x"
 msgstr "#regs: %d   id: 0x%x"
 
-#: .././logprint/log_misc.c:784
+#: .././logprint/log_misc.c:684
 #, c-format
 msgid "  blkno: %lld  len: %d  boff: %d\n"
 msgstr "  blkno: %lld  len: %d  boff: %d\n"
 
-#: .././logprint/log_misc.c:788
+#: .././logprint/log_misc.c:688
 #, c-format
 msgid "DQUOT: #regs: %d   Not printing rest of data\n"
 msgstr "DQUOT: #regs: %d   Bez wypisywania reszty danych\n"
 
-#: .././logprint/log_misc.c:807
+#: .././logprint/log_misc.c:707
 #, c-format
 msgid "DQUOT: magic 0x%hx flags 0%ho\n"
 msgstr "DQUOT: magic 0x%hx flags 0%ho\n"
 
-#: .././logprint/log_misc.c:833
+#: .././logprint/log_misc.c:733
 #, c-format
 msgid "ICR: split header, not printing\n"
 msgstr "ICR: nagłówek podzielony, bez wypisywania\n"
 
-#: .././logprint/log_misc.c:837
+#: .././logprint/log_misc.c:737
 #, c-format
 msgid ""
 "ICR:  #ag: %d  agbno: 0x%x  len: %d\n"
@@ -6392,107 +7413,107 @@ msgstr ""
 "ICR:  #ag: %d  agbno: 0x%x  len: %d\n"
 "      cnt: %d  isize: %d    gen: 0x%x\n"
 
-#: .././logprint/log_misc.c:863
+#: .././logprint/log_misc.c:763
 #, c-format
 msgid "%s: lseek to %lld failed: %s\n"
 msgstr "%s: lseek na %lld nie powiodło się: %s\n"
 
-#: .././logprint/log_misc.c:909
+#: .././logprint/log_misc.c:809
 #, c-format
 msgid "%s: xlog_print_record: malloc failed\n"
 msgstr "%s: xlog_print_record: malloc nie powiodło się\n"
 
-#: .././logprint/log_misc.c:918
+#: .././logprint/log_misc.c:818
 #, c-format
 msgid "%s: xlog_print_record: read error\n"
 msgstr "%s: xlog_print_record: błąd odczytu\n"
 
-#: .././logprint/log_misc.c:1013 .././logprint/log_misc.c:1083
+#: .././logprint/log_misc.c:913 .././logprint/log_misc.c:1016
 #, c-format
 msgid "Left over region from split log item\n"
 msgstr "Region pozostały z podziału elementu logu\n"
 
-#: .././logprint/log_misc.c:1068
+#: .././logprint/log_misc.c:1001
 #, c-format
 msgid "Unmount filesystem\n"
 msgstr "Niezamontowany system plików\n"
 
-#: .././logprint/log_misc.c:1075
+#: .././logprint/log_misc.c:1008
 #, c-format
 msgid "%s: unknown log operation type (%x)\n"
 msgstr "%s: nieznany typ operacji w logu (%x)\n"
 
-#: .././logprint/log_misc.c:1116
+#: .././logprint/log_misc.c:1049
 #, c-format
 msgid "Header 0x%x wanted 0x%x\n"
 msgstr "Nagłówek 0x%x, pożądany 0x%x\n"
 
-#: .././logprint/log_misc.c:1130
+#: .././logprint/log_misc.c:1063
 #, c-format
 msgid "cycle: %d\tversion: %d\t"
 msgstr "cykl: %d\twersja: %d\t"
 
-#: .././logprint/log_misc.c:1136
+#: .././logprint/log_misc.c:1069
 #, c-format
 msgid "length of Log Record: %d\tprev offset: %d\t\tnum ops: %d\n"
 msgstr "długość rekordu logu: %d\tpoprz.offset: %d\t\tl.oper.: %d\n"
 
-#: .././logprint/log_misc.c:1142 .././logprint/log_misc.c:1184
+#: .././logprint/log_misc.c:1075 .././logprint/log_misc.c:1117
 #, c-format
 msgid "cycle num overwrites: "
 msgstr "liczba nadpisań cyklu: "
 
-#: .././logprint/log_misc.c:1151
+#: .././logprint/log_misc.c:1084
 #, c-format
 msgid "uuid: %s   format: "
 msgstr "uuid: %s   format: "
 
-#: .././logprint/log_misc.c:1154
+#: .././logprint/log_misc.c:1087
 #, c-format
 msgid "unknown\n"
 msgstr "nieznany\n"
 
-#: .././logprint/log_misc.c:1157
+#: .././logprint/log_misc.c:1090
 #, c-format
 msgid "little endian linux\n"
 msgstr "Linux little endian\n"
 
-#: .././logprint/log_misc.c:1160
+#: .././logprint/log_misc.c:1093
 #, c-format
 msgid "big endian linux\n"
 msgstr "Linux big endian\n"
 
-#: .././logprint/log_misc.c:1163
+#: .././logprint/log_misc.c:1096
 #, c-format
 msgid "big endian irix\n"
 msgstr "IRIX big endian\n"
 
-#: .././logprint/log_misc.c:1169
+#: .././logprint/log_misc.c:1102
 #, c-format
 msgid "h_size: %d\n"
 msgstr "h_size: %d\n"
 
-#: .././logprint/log_misc.c:1181
+#: .././logprint/log_misc.c:1114
 #, c-format
 msgid "extended-header: cycle: %d\n"
 msgstr "nagłówek-rozszerzony: cykl: %d\n"
 
-#: .././logprint/log_misc.c:1197
+#: .././logprint/log_misc.c:1130
 #, c-format
 msgid "* ERROR: found data after zeroed blocks block=%-21lld  *\n"
 msgstr "* BŁĄD: znaleziono dane za wyzerowanymi blokami blok=%-21lld  *\n"
 
-#: .././logprint/log_misc.c:1208
+#: .././logprint/log_misc.c:1141
 #, c-format
 msgid "* ERROR: header cycle=%-11d block=%-21lld        *\n"
 msgstr "* BŁĄD: nagłówek cykl=%-11d blok=%-21lld                *\n"
 
-#: .././logprint/log_misc.c:1219
+#: .././logprint/log_misc.c:1152
 #, c-format
 msgid "* ERROR: data block=%-21lld                             *\n"
 msgstr "* BŁĄD: blok danych=%-21lld                                   *\n"
 
-#: .././logprint/log_misc.c:1230
+#: .././logprint/log_misc.c:1163
 #, c-format
 msgid ""
 "* ERROR: for header block=%lld\n"
@@ -6501,352 +7522,482 @@ msgstr ""
 "* BŁĄD: dla bloku nagłówka %lld\n"
 "*       za mało nagłówków dla długości danych, wymaganych = %d, liczba = %d\n"
 
-#: .././logprint/log_misc.c:1236
+#: .././logprint/log_misc.c:1169
 msgid "Not enough headers for data length."
 msgstr "Za mało nagłówków dla długości danych."
 
-#: .././logprint/log_misc.c:1246
+#: .././logprint/log_misc.c:1179
 #, c-format
 msgid "%s: xlog_print: malloc failed for ext hdrs\n"
 msgstr "%s: xlog_print: malloc dla rozszerzonych nagłówków nie powiódł się\n"
 
-#: .././logprint/log_misc.c:1292 .././logprint/log_misc.c:1368
-#: .././logprint/log_misc.c:1439 .././logprint/log_misc.c:1476
+#: .././logprint/log_misc.c:1227 .././logprint/log_misc.c:1303
+#: .././logprint/log_misc.c:1374 .././logprint/log_misc.c:1411
 #, c-format
 msgid "%s: physical end of log\n"
 msgstr "%s: fizyczny koniec logu\n"
 
-#: .././logprint/log_misc.c:1298 .././logprint/log_misc.c:1373
-#: .././logprint/log_misc.c:1491
+#: .././logprint/log_misc.c:1233 .././logprint/log_misc.c:1308
+#: .././logprint/log_misc.c:1426
 #, c-format
 msgid "BLKNO: %lld\n"
 msgstr "BLKNO: %lld\n"
 
-#: .././logprint/log_misc.c:1356
+#: .././logprint/log_misc.c:1291
 #, c-format
 msgid "%s: problem finding oldest LR\n"
 msgstr "%s: problem ze znalezieniem najstarszego rekordu logu\n"
 
-#: .././logprint/log_misc.c:1382
+#: .././logprint/log_misc.c:1317
 #, c-format
 msgid "%s: after %d zeroed blocks\n"
 msgstr "%s: po %d wyzerowanych blokach\n"
 
-#: .././logprint/log_misc.c:1451
+#: .././logprint/log_misc.c:1386
 msgid "illegal value"
 msgstr "niedozwolona wartość"
 
-#: .././logprint/log_misc.c:1457
+#: .././logprint/log_misc.c:1392
 #, c-format
 msgid "%s: skipped %d cleared blocks in range: %lld - %lld\n"
 msgstr "%s: pominięto %d wyzerowanych bloków w przedziale: %lld - %lld\n"
 
-#: .././logprint/log_misc.c:1462
+#: .././logprint/log_misc.c:1397
 #, c-format
 msgid "%s: totally cleared log\n"
 msgstr "%s: całkowicie wyczyszczony log\n"
 
-#: .././logprint/log_misc.c:1467
+#: .././logprint/log_misc.c:1402
 #, c-format
 msgid "%s: skipped %d zeroed blocks in range: %lld - %lld\n"
 msgstr "%s: pominięto %d wyzerowanych bloków w przedziale %lld - %lld\n"
 
-#: .././logprint/log_misc.c:1472
+#: .././logprint/log_misc.c:1407
 #, c-format
 msgid "%s: totally zeroed log\n"
 msgstr "%s: całkowicie wyzerowany log\n"
 
-#: .././logprint/log_misc.c:1488
+#: .././logprint/log_misc.c:1423
 msgid "xlog_find_head: bad read"
 msgstr "xlog_find_head: błędny odczyt"
 
-#: .././logprint/log_misc.c:1540
+#: .././logprint/log_misc.c:1475
 #, c-format
 msgid "%s: logical end of log\n"
 msgstr "%s: logiczny koniec logu\n"
 
-#: .././logprint/log_misc.c:1636
-#, c-format
-msgid "%s: bad size of efi format: %u; expected %u or %u; nextents = %u\n"
-msgstr "%s: błędny rozmiar formatu efi: %u; oczekiwano %u lub %u; nextents = %u\n"
-
-#: .././logprint/log_print_all.c:94
+#: .././logprint/log_print_all.c:96
 #, c-format
-msgid "BUF:  #regs:%d   start blkno:0x%llx   len:%d   bmap size:%d   flags:0x%x\n"
-msgstr "BUF:  #regs:%d   blok pocz.:0x%llx  dług.:%d  rozm.bmapy:%d   flagi:0x%x\n"
+msgid ""
+"BUF:  #regs:%d   start blkno:0x%llx   len:%d   bmap size:%d   flags:0x%x\n"
+msgstr ""
+"BUF:  #regs:%d   blok pocz.:0x%llx  dług.:%d  rozm.bmapy:%d   flagi:0x%x\n"
 
-#: .././logprint/log_print_all.c:104
+#: .././logprint/log_print_all.c:106
 #, c-format
 msgid "\tSUPER Block Buffer:\n"
 msgstr "\tBufor SUPER bloku:\n"
 
-#: .././logprint/log_print_all.c:107
+#: .././logprint/log_print_all.c:109
 #, c-format
 msgid "              icount:%llu ifree:%llu  "
 msgstr "              icount:%llu ifree:%llu  "
 
-#: .././logprint/log_print_all.c:112
+#: .././logprint/log_print_all.c:114
 #, c-format
 msgid "fdblks:%llu  frext:%llu\n"
 msgstr "fdblks:%llu  frext:%llu\n"
 
-#: .././logprint/log_print_all.c:117
+#: .././logprint/log_print_all.c:119
 #, c-format
 msgid "\t\tsunit:%u  swidth:%u\n"
 msgstr "\t\tsunit:%u  swidth:%u\n"
 
-#: .././logprint/log_print_all.c:123
+#: .././logprint/log_print_all.c:125
 #, c-format
 msgid "\tAGI Buffer: (XAGI)\n"
 msgstr "\tBufor AGI: (XAGI)\n"
 
-#: .././logprint/log_print_all.c:126
+#: .././logprint/log_print_all.c:128
 #, c-format
 msgid "\t\tver:%d  "
 msgstr "\t\twersja:%d  "
 
-#: .././logprint/log_print_all.c:128
+#: .././logprint/log_print_all.c:130
 #, c-format
 msgid "seq#:%d  len:%d  cnt:%d  root:%d\n"
 msgstr "seq#:%d  len:%d  cnt:%d  root:%d\n"
 
-#: .././logprint/log_print_all.c:133
+#: .././logprint/log_print_all.c:135
 #, c-format
 msgid "\t\tlevel:%d  free#:0x%x  newino:0x%x\n"
 msgstr "\t\tlevel:%d  free#:0x%x  newino:0x%x\n"
 
-#: .././logprint/log_print_all.c:157
+#: .././logprint/log_print_all.c:159
 #, c-format
 msgid "\tAGF Buffer: (XAGF)\n"
 msgstr "\tBufor AGI: (XAGF)\n"
 
-#: .././logprint/log_print_all.c:160
+#: .././logprint/log_print_all.c:162
 #, c-format
 msgid "\t\tver:%d  seq#:%d  len:%d  \n"
 msgstr "\t\tver:%d  seq#:%d  len:%d  \n"
 
-#: .././logprint/log_print_all.c:164
+#: .././logprint/log_print_all.c:166
 #, c-format
 msgid "\t\troot BNO:%d  CNT:%d\n"
 msgstr "\t\troot BNO:%d  CNT:%d\n"
 
-#: .././logprint/log_print_all.c:167
+#: .././logprint/log_print_all.c:169
 #, c-format
 msgid "\t\tlevel BNO:%d  CNT:%d\n"
 msgstr "\t\tlevel BNO:%d  CNT:%d\n"
 
-#: .././logprint/log_print_all.c:170
+#: .././logprint/log_print_all.c:172
 #, c-format
 msgid "\t\t1st:%d  last:%d  cnt:%d  freeblks:%d  longest:%d\n"
 msgstr "\t\t1st:%d  last:%d  cnt:%d  freeblks:%d  longest:%d\n"
 
-#: .././logprint/log_print_all.c:179
+#: .././logprint/log_print_all.c:181
 #, c-format
 msgid "\tDQUOT Buffer:\n"
 msgstr "\tBufor DQUOT:\n"
 
-#: .././logprint/log_print_all.c:182
+#: .././logprint/log_print_all.c:184
 #, c-format
 msgid "\t\tUIDs 0x%lx-0x%lx\n"
 msgstr "\t\tUIDs 0x%lx-0x%lx\n"
 
-#: .././logprint/log_print_all.c:187
+#: .././logprint/log_print_all.c:189
 #, c-format
 msgid "\tBUF DATA\n"
 msgstr "\tDANE BUF\n"
 
-#: .././logprint/log_print_all.c:209
+#: .././logprint/log_print_all.c:211
 #, c-format
 msgid "\tQUOTAOFF: #regs:%d   type:%s\n"
 msgstr "\tQUOTAOFF: #regs:%d   type:%s\n"
 
-#: .././logprint/log_print_all.c:224
+#: .././logprint/log_print_all.c:226
 #, c-format
 msgid "\tDQUOT: #regs:%d  blkno:%lld  boffset:%u id: %d\n"
 msgstr "\tDQUOT: #regs:%d  blkno:%lld  boffset:%u id: %d\n"
 
-#: .././logprint/log_print_all.c:228
+#: .././logprint/log_print_all.c:230
 #, c-format
 msgid "\t\tmagic 0x%x\tversion 0x%x\tID 0x%x (%d)\t\n"
 msgstr "\t\tmagic 0x%x\twersja 0x%x\tID 0x%x (%d)\t\n"
 
-#: .././logprint/log_print_all.c:233
+#: .././logprint/log_print_all.c:235
 #, c-format
 msgid "\t\tblk_hard 0x%x\tblk_soft 0x%x\tino_hard 0x%x\tino_soft 0x%x\n"
 msgstr "\t\tblk_hard 0x%x\tblk_soft 0x%x\tino_hard 0x%x\tino_soft 0x%x\n"
 
-#: .././logprint/log_print_all.c:239
+#: .././logprint/log_print_all.c:241
 #, c-format
 msgid "\t\tbcount 0x%x (%d) icount 0x%x (%d)\n"
 msgstr "\t\tbcount 0x%x (%d) icount 0x%x (%d)\n"
 
-#: .././logprint/log_print_all.c:244
+#: .././logprint/log_print_all.c:246
 #, c-format
 msgid "\t\tbtimer 0x%x itimer 0x%x \n"
 msgstr "\t\tbtimer 0x%x itimer 0x%x \n"
 
-#: .././logprint/log_print_all.c:253
+#: .././logprint/log_print_all.c:255
 #, c-format
 msgid "\tCORE inode:\n"
 msgstr "\tGŁÓWNY i-węzeł:\n"
 
-#: .././logprint/log_print_all.c:256
+#: .././logprint/log_print_all.c:258
 #, c-format
-msgid "\t\tmagic:%c%c  mode:0x%x  ver:%d  format:%d  onlink:%d\n"
-msgstr "\t\tmagic:%c%c  mode:0x%x  ver:%d  format:%d  onlin:%d\n"
+msgid "\t\tmagic:%c%c  mode:0x%x  ver:%d  format:%d\n"
+msgstr "\t\tmagic:%c%c  mode:0x%x  ver:%d  format:%d\n"
 
-#: .././logprint/log_print_all.c:260
+#: .././logprint/log_print_all.c:261
 #, c-format
-msgid "\t\tuid:%d  gid:%d  nlink:%d projid:%u\n"
-msgstr "\t\tuid:%d  gid:%d  nlink:%d projid:%u\n"
+msgid "\t\tuid:%d  gid:%d  nlink:%d projid:0x%04x%04x\n"
+msgstr "\t\tuid:%d  gid:%d  nlink:%d projid:0x%04x%04x\n"
 
-#: .././logprint/log_print_all.c:262
+#: .././logprint/log_print_all.c:264
 #, c-format
 msgid "\t\tatime:%d  mtime:%d  ctime:%d\n"
 msgstr "\t\tatime:%d  mtime:%d  ctime:%d\n"
 
-#: .././logprint/log_print_all.c:264
+#: .././logprint/log_print_all.c:266
 #, c-format
 msgid "\t\tflushiter:%d\n"
 msgstr "\t\tflushiter:%d\n"
 
-#: .././logprint/log_print_all.c:265
+#: .././logprint/log_print_all.c:267
+#, c-format
+msgid "\t\tsize:0x%llx  nblks:0x%llx  exsize:%d  nextents:%d  anextents:%d\n"
+msgstr "\t\tsize:0x%llx  nblks:0x%llx  exsize:%d  nextents:%d  anextents:%d\n"
+
+#: .././logprint/log_print_all.c:271
+#, c-format
+msgid "\t\tforkoff:%d  dmevmask:0x%x  dmstate:%d  flags:0x%x  gen:%u\n"
+msgstr "\t\tforkoff:%d  dmevmask:0x%x  dmstate:%d  flags:0x%x  gen:%u\n"
+
+#: .././logprint/log_print_all.c:295
+#, c-format
+msgid "\tINODE: #regs:%d   ino:0x%llx  flags:0x%x   dsize:%d\n"
+msgstr "\tINODE: #regs:%d   ino:0x%llx  flags:0x%x   dsize:%d\n"
+
+#: .././logprint/log_print_all.c:311
+#, c-format
+msgid "\t\tDATA FORK EXTENTS inode data:\n"
+msgstr "\t\tDane EKSTENTÓW GAŁĘZI DANYCH i-węzła:\n"
+
+#: .././logprint/log_print_all.c:318
+#, c-format
+msgid "\t\tDATA FORK BTREE inode data:\n"
+msgstr "\t\tDane B-DRZEWA GAŁĘZI DANYCH i-węzła:\n"
+
+#: .././logprint/log_print_all.c:325
+#, c-format
+msgid "\t\tDATA FORK LOCAL inode data:\n"
+msgstr "\t\tDane LOKALNE GAŁĘZI DANYCH i-węzła:\n"
+
+#: .././logprint/log_print_all.c:332
+#, c-format
+msgid "\t\tDEV inode: no extra region\n"
+msgstr "\t\tI-węzeł DEV: brak dodatkowego regionu\n"
+
+#: .././logprint/log_print_all.c:336
+#, c-format
+msgid "\t\tUUID inode: no extra region\n"
+msgstr "\t\tI-węzeł UUID: brak dodatkowego regionu\n"
+
+#: .././logprint/log_print_all.c:351
+#, c-format
+msgid "\t\tATTR FORK EXTENTS inode data:\n"
+msgstr "\t\tDane EKSTENTÓW GAŁĘZI ATRYBUTÓW i-węzła:\n"
+
+#: .././logprint/log_print_all.c:359
+#, c-format
+msgid "\t\tATTR FORK BTREE inode data:\n"
+msgstr "\t\tDane B-DRZEWA GAŁĘZI ATRYBUTÓW i-węzła:\n"
+
+#: .././logprint/log_print_all.c:367
+#, c-format
+msgid "\t\tATTR FORK LOCAL inode data:\n"
+msgstr "\t\tDane LOKALNE GAŁĘZI ATRYBUTÓW i-węzła:\n"
+
+#: .././logprint/log_print_all.c:388
+#, c-format
+msgid ""
+"\tICR:  #ag: %d  agbno: 0x%x  len: %d\n"
+"\t      cnt: %d  isize: %d    gen: 0x%x\n"
+msgstr ""
+"\tICR:  #ag: %d  agbno: 0x%x  len: %d\n"
+"\t      cnt: %d  isize: %d    gen: 0x%x\n"
+
+#: .././logprint/log_print_all.c:440
+#, c-format
+msgid "xlog_recover_print_logitem: illegal type\n"
+msgstr "xlog_recover_print_logitem: niedozwolony typ\n"
+
+#: .././logprint/log_print_all.c:492
+#, c-format
+msgid "%s: illegal type"
+msgstr "%s: niedozwolony typ"
+
+#: .././logprint/log_print_all.c:500
+#, c-format
+msgid ": cnt:%d total:%d "
+msgstr ": cnt:%d total:%d "
+
+#: .././logprint/log_print_all.c:502
+#, c-format
+msgid "a:0x%lx len:%d "
+msgstr "a:0x%lx len:%d "
+
+#: .././logprint/log_print_trans.c:27
+#, c-format
+msgid "TRANS: tid:0x%x  #items:%d  trans:0x%x  q:0x%lx\n"
+msgstr "TRANS: tid:0x%x  #items:%d  trans:0x%0x  q:0x%lx\n"
+
+#: .././logprint/log_print_trans.c:53
+#, c-format
+msgid "%s: failed to find head and tail, error: %d\n"
+msgstr "%s: nie udało się odnaleźć początku ani końca, błąd: %d\n"
+
+#: .././logprint/log_print_trans.c:58
+#, c-format
+msgid "    log tail: %lld head: %lld state: %s\n"
+msgstr "    koniec logu: %lld początek: %lld stan: %s\n"
+
+#: .././logprint/log_print_trans.c:64
+#, c-format
+msgid "    override tail: %d\n"
+msgstr "    koniec override: %d\n"
+
+#: .././logprint/log_print_trans.c:84
+#, c-format
+msgid ""
+"Superblock has unknown incompatible log features (0x%x) enabled.\n"
+"Output may be incomplete or inaccurate. It is recommended that you\n"
+"upgrade your xfsprogs installation to match the filesystem features.\n"
+msgstr ""
+"Superblok ma włączone nieznane, niezgodne opcje logu (0x%x).\n"
+"Wyjście może być niekompletne lub niedokładne. Zalecana jest\n"
+"aktualizacja zainstalowanej wersji xfsprogs, aby zgadzała się z opcjami\n"
+"systemu plików.\n"
+
+#: .././logprint/log_print_trans.c:92
+#, c-format
+msgid "%s: failed in xfs_do_recovery_pass, error: %d\n"
+msgstr "%s: xfs_do_recovery_pass nie powiodło się, błąd: %d\n"
+
+#: .././logprint/log_redo.c:71
+#, c-format
+msgid "%s: bad size of efi format: %u; expected %u or %u; nextents = %u\n"
+msgstr ""
+"%s: błędny rozmiar formatu efi: %u; oczekiwano %u lub %u; nextents = %u\n"
+
+#: .././logprint/log_redo.c:94 .././logprint/log_redo.c:110
+#, c-format
+msgid "%s: xlog_print_trans_efi: malloc failed\n"
+msgstr "%s: xlog_print_trans_efi: malloc nie powiodło się\n"
+
+#: .././logprint/log_redo.c:104
+#, c-format
+msgid "EFI: Not enough data to decode further\n"
+msgstr "EFI: Za mało danych do dalszego dekodowania\n"
+
+#: .././logprint/log_redo.c:118
+#, c-format
+msgid "EFI:  #regs: %d\tnum_extents: %d  id: 0x%llx\n"
+msgstr "EFI:  #regs: %d\tnum_extents: %d  id: 0x%llx\n"
+
+#: .././logprint/log_redo.c:122
 #, c-format
-msgid "\t\tsize:0x%llx  nblks:0x%llx  exsize:%d  nextents:%d  anextents:%d\n"
-msgstr "\t\tsize:0x%llx  nblks:0x%llx  exsize:%d  nextents:%d  anextents:%d\n"
+msgid "EFI free extent data skipped (CONTINUE set, no space)\n"
+msgstr "Pominięto dane wolnego ekstentu EFI (KONTYNUACJA, brak miejsca)\n"
 
-#: .././logprint/log_print_all.c:269
+#: .././logprint/log_redo.c:161
 #, c-format
-msgid "\t\tforkoff:%d  dmevmask:0x%x  dmstate:%d  flags:0x%x  gen:%d\n"
-msgstr "\t\tforkoff:%d  dmevmask:0x%x  dmstate:%d  flags:0x%x  gen:%d\n"
+msgid "%s: xlog_recover_print_efi: malloc failed\n"
+msgstr "%s: xlog_recover_print_efi: malloc nie powiodło się\n"
 
-#: .././logprint/log_print_all.c:289
+#: .././logprint/log_redo.c:170
 #, c-format
-msgid "\tINODE: #regs:%d   ino:0x%llx  flags:0x%x   dsize:%d\n"
-msgstr "\tINODE: #regs:%d   ino:0x%llx  flags:0x%x   dsize:%d\n"
+msgid "\tEFI:  #regs:%d\tnum_extents:%d  id:0x%llx\n"
+msgstr "\tEFI:  #regs:%d\tnum_extents:%d  id:0x%llx\n"
 
-#: .././logprint/log_print_all.c:305
+#: .././logprint/log_redo.c:202
 #, c-format
-msgid "\t\tDATA FORK EXTENTS inode data:\n"
-msgstr "\t\tDane EKSTENTÓW GAŁĘZI DANYCH i-węzła:\n"
+msgid "EFD:  #regs: %d\tnum_extents: %d  id: 0x%llx\n"
+msgstr "EFD:  #regs: %d\tnum_extents: %d  id: 0x%llx\n"
 
-#: .././logprint/log_print_all.c:312
+#: .././logprint/log_redo.c:210
 #, c-format
-msgid "\t\tDATA FORK BTREE inode data:\n"
-msgstr "\t\tDane B-DRZEWA GAŁĘZI DANYCH i-węzła:\n"
+msgid "EFD: Not enough data to decode further\n"
+msgstr "EFD: Za mało danych do dalszego dekodowania\n"
 
-#: .././logprint/log_print_all.c:319
+#: .././logprint/log_redo.c:228
 #, c-format
-msgid "\t\tDATA FORK LOCAL inode data:\n"
-msgstr "\t\tDane LOKALNE GAŁĘZI DANYCH i-węzła:\n"
+msgid "\tEFD:  #regs: %d\tnum_extents: %d  id: 0x%llx\n"
+msgstr "\tEFD:  #regs: %d\tnum_extents: %d  id: 0x%llx\n"
 
-#: .././logprint/log_print_all.c:326
+#: .././logprint/log_redo.c:249
 #, c-format
-msgid "\t\tDEV inode: no extra region\n"
-msgstr "\t\tI-węzeł DEV: brak dodatkowego regionu\n"
+msgid "%s: bad size of RUI format: %u; expected %u; nextents = %u\n"
+msgstr "%s: błędny rozmiar formatu RUI: %u; oczekiwano %u; nextents = %u\n"
 
-#: .././logprint/log_print_all.c:330
+#: .././logprint/log_redo.c:276 .././logprint/log_redo.c:295
+#: .././logprint/log_redo.c:424 .././logprint/log_redo.c:443
+#: .././logprint/log_redo.c:567 .././logprint/log_redo.c:586
 #, c-format
-msgid "\t\tUUID inode: no extra region\n"
-msgstr "\t\tI-węzeł UUID: brak dodatkowego regionu\n"
+msgid "%s: %s: malloc failed\n"
+msgstr "%s: %s: malloc nie powiodło się\n"
 
-#: .././logprint/log_print_all.c:345
+#: .././logprint/log_redo.c:288
 #, c-format
-msgid "\t\tATTR FORK EXTENTS inode data:\n"
-msgstr "\t\tDane EKSTENTÓW GAŁĘZI ATRYBUTÓW i-węzła:\n"
+msgid "RUI: Not enough data to decode further\n"
+msgstr "RUI: Za mało danych do dalszego dekodowania\n"
 
-#: .././logprint/log_print_all.c:353
+#: .././logprint/log_redo.c:304
 #, c-format
-msgid "\t\tATTR FORK BTREE inode data:\n"
-msgstr "\t\tDane B-DRZEWA GAŁĘZI ATRYBUTÓW i-węzła:\n"
+msgid "RUI:  #regs: %d\tnum_extents: %d  id: 0x%llx\n"
+msgstr "RUI:  #regs: %d\tnum_extents: %d  id: 0x%llx\n"
 
-#: .././logprint/log_print_all.c:361
+#: .././logprint/log_redo.c:308
 #, c-format
-msgid "\t\tATTR FORK LOCAL inode data:\n"
-msgstr "\t\tDane LOKALNE GAŁĘZI ATRYBUTÓW i-węzła:\n"
+msgid "RUI extent data skipped (CONTINUE set, no space)\n"
+msgstr "Pominięto dane ekstentu RUI (ustawiona KONTYNUACJA, brak miejsca)\n"
 
-#: .././logprint/log_print_all.c:386
+#: .././logprint/log_redo.c:359
 #, c-format
-msgid "\tEFD:  #regs: %d    num_extents: %d  id: 0x%llx\n"
-msgstr "\tEFD:  #regs: %d    num_extents: %d  id: 0x%llx\n"
+msgid "RUD:  #regs: %d\t                 id: 0x%llx\n"
+msgstr "RUD:  #regs: %d\t                 id: 0x%llx\n"
 
-#: .././logprint/log_print_all.c:410
+#: .././logprint/log_redo.c:367
 #, c-format
-msgid "%s: xlog_recover_print_efi: malloc failed\n"
-msgstr "%s: xlog_recover_print_efi: malloc nie powiodło się\n"
+msgid "RUD: Not enough data to decode further\n"
+msgstr "RUD: Za mało danych do dalszego dekodowania\n"
 
-#: .././logprint/log_print_all.c:418
+#: .././logprint/log_redo.c:401
 #, c-format
-msgid "\tEFI:  #regs:%d    num_extents:%d  id:0x%llx\n"
-msgstr "\tEFI:  #regs:%d    num_extents:%d  id:0x%llx\n"
+msgid "%s: bad size of CUI format: %u; expected %u; nextents = %u\n"
+msgstr "%s: błędny rozmiar formatu CUI: %u; oczekiwano %u; nextents = %u\n"
 
-#: .././logprint/log_print_all.c:442
+#: .././logprint/log_redo.c:436
 #, c-format
-msgid ""
-"\tICR:  #ag: %d  agbno: 0x%x  len: %d\n"
-"\t      cnt: %d  isize: %d    gen: 0x%x\n"
-msgstr ""
-"\tICR:  #ag: %d  agbno: 0x%x  len: %d\n"
-"\t      cnt: %d  isize: %d    gen: 0x%x\n"
+msgid "CUI: Not enough data to decode further\n"
+msgstr "CUI: Za mało danych do dalszego dekodowania\n"
 
-#: .././logprint/log_print_all.c:476
+#: .././logprint/log_redo.c:452
 #, c-format
-msgid "xlog_recover_print_logitem: illegal type\n"
-msgstr "xlog_recover_print_logitem: niedozwolony typ\n"
+msgid "CUI:  #regs: %d\tnum_extents: %d  id: 0x%llx\n"
+msgstr "CUI:  #regs: %d\tnum_extents: %d  id: 0x%llx\n"
 
-#: .././logprint/log_print_all.c:510
+#: .././logprint/log_redo.c:456
 #, c-format
-msgid "%s: illegal type"
-msgstr "%s: niedozwolony typ"
+msgid "CUI extent data skipped (CONTINUE set, no space)\n"
+msgstr "Pominięto dane ekstentu CUI (ustawiona KONTYNUACJA, brak miejsca)\n"
 
-#: .././logprint/log_print_all.c:518
+#: .././logprint/log_redo.c:502
 #, c-format
-msgid ": cnt:%d total:%d "
-msgstr ": cnt:%d total:%d "
+msgid "CUD:  #regs: %d\t                 id: 0x%llx\n"
+msgstr "CUD:  #regs: %d\t                 id: 0x%llx\n"
 
-#: .././logprint/log_print_all.c:520
+#: .././logprint/log_redo.c:510
 #, c-format
-msgid "a:0x%lx len:%d "
-msgstr "a:0x%lx len:%d "
+msgid "CUD: Not enough data to decode further\n"
+msgstr "CUD: Za mało danych do dalszego dekodowania\n"
 
-#: .././logprint/log_print_trans.c:25
+#: .././logprint/log_redo.c:544
 #, c-format
-msgid "TRANS: tid:0x%x  type:%s  #items:%d  trans:0x%x  q:0x%lx\n"
-msgstr "TRANS: tid:0x%x  typ:%s   #elem:%d   trans:0x%x  q:0x%lx\n"
+msgid "%s: bad size of BUI format: %u; expected %u; nextents = %u\n"
+msgstr "%s: błędny rozmiar formatu BUI: %u; oczekiwano %u; nextents = %u\n"
 
-#: .././logprint/log_print_trans.c:51
+#: .././logprint/log_redo.c:579
 #, c-format
-msgid "%s: failed to find head and tail, error: %d\n"
-msgstr "%s: nie udało się odnaleźć początku ani końca, błąd: %d\n"
+msgid "BUI: Not enough data to decode further\n"
+msgstr "BUI: Za mało danych do dalszego dekodowania\n"
 
-#: .././logprint/log_print_trans.c:56
+#: .././logprint/log_redo.c:595
 #, c-format
-msgid "    log tail: %lld head: %lld state: %s\n"
-msgstr "    koniec logu: %lld początek: %lld stan: %s\n"
+msgid "BUI:  #regs: %d\tnum_extents: %d  id: 0x%llx\n"
+msgstr "BUI:  #regs: %d\tnum_extents: %d  id: 0x%llx\n"
 
-#: .././logprint/log_print_trans.c:62
+#: .././logprint/log_redo.c:599
 #, c-format
-msgid "    override tail: %d\n"
-msgstr "    koniec override: %d\n"
+msgid "BUI extent data skipped (CONTINUE set, no space)\n"
+msgstr "Pominięto dane ekstentu BUI (ustawiona KONTYNUACJA, brak miejsca)\n"
 
-#: .././logprint/log_print_trans.c:82
+#: .././logprint/log_redo.c:646
 #, c-format
-msgid ""
-"Superblock has unknown incompatible log features (0x%x) enabled.\n"
-"Output may be incomplete or inaccurate. It is recommended that you\n"
-"upgrade your xfsprogs installation to match the filesystem features.\n"
-msgstr ""
-"Superblok ma włączone nieznane, niezgodne opcje logu (0x%x).\n"
-"Wyjście może być niekompletne lub niedokładne. Zalecana jest\n"
-"aktualizacja zainstalowanej wersji xfsprogs, aby zgadzała się z opcjami\n"
-"systemu plików.\n"
+msgid "BUD:  #regs: %d\t                 id: 0x%llx\n"
+msgstr "BUD:  #regs: %d\t                 id: 0x%llx\n"
 
-#: .././logprint/log_print_trans.c:90
+#: .././logprint/log_redo.c:654
 #, c-format
-msgid "%s: failed in xfs_do_recovery_pass, error: %d\n"
-msgstr "%s: xfs_do_recovery_pass nie powiodło się, błąd: %d\n"
+msgid "BUD: Not enough data to decode further\n"
+msgstr "BUD: Za mało danych do dalszego dekodowania\n"
 
-#: .././logprint/logprint.c:42
+#: .././logprint/logprint.c:45
 #, c-format
 msgid ""
 "Usage: %s [options...] <device>\n"
@@ -6873,7 +8024,8 @@ msgstr ""
 "\n"
 "Opcje:\n"
 "    -c             próba kontynuacji w przypadku błędu w logu\n"
-"    -C <plik>      skopiowanie logu z systemu plików do pliku o podanej nazwie\n"
+"    -C <plik>      skopiowanie logu z systemu plików do pliku o podanej "
+"nazwie\n"
 "    -d             zrzut logu w formacie jego rekordów\n"
 "    -e             zakończenie po napotkaniu błędu w logu\n"
 "    -f             podane urządzenie jest plikiem\n"
@@ -6889,17 +8041,17 @@ msgstr ""
 "    -D             wypisywanie tylko danych, bez dekodowania\n"
 "    -V             wypisanie informacji o wersji\n"
 
-#: .././logprint/logprint.c:76
+#: .././logprint/logprint.c:79
 #, c-format
 msgid "    Can't open device %s: %s\n"
 msgstr "    Nie można otworzyć urządzenia %s: %s\n"
 
-#: .././logprint/logprint.c:82
+#: .././logprint/logprint.c:85
 #, c-format
 msgid "    read of XFS superblock failed\n"
 msgstr "    odczyt superbloku XFS-a nie powiódł się\n"
 
-#: .././logprint/logprint.c:102
+#: .././logprint/logprint.c:105
 #, c-format
 msgid ""
 "    external log device not specified\n"
@@ -6908,32 +8060,32 @@ msgstr ""
 "    Nie podano urządzenia zewnętrznego loga\n"
 "\n"
 
-#: .././logprint/logprint.c:118
+#: .././logprint/logprint.c:121
 #, c-format
 msgid "Can't open file %s: %s\n"
 msgstr "Nie można otworzyć pliku %s: %s\n"
 
-#: .././logprint/logprint.c:219
+#: .././logprint/logprint.c:222
 #, c-format
 msgid "xfs_logprint:\n"
 msgstr "xfs_logprint:\n"
 
-#: .././logprint/logprint.c:228
+#: .././logprint/logprint.c:231
 #, c-format
 msgid "    data device: 0x%llx\n"
 msgstr "    urządzenie danych: 0x%llx\n"
 
-#: .././logprint/logprint.c:231
+#: .././logprint/logprint.c:234
 #, c-format
 msgid "    log file: \"%s\" "
 msgstr "    plik logu: \"%s\" "
 
-#: .././logprint/logprint.c:233
+#: .././logprint/logprint.c:236
 #, c-format
 msgid "    log device: 0x%llx "
 msgstr "    urządzenie logu: 0x%llx "
 
-#: .././logprint/logprint.c:236
+#: .././logprint/logprint.c:239
 #, c-format
 msgid ""
 "daddr: %lld length: %lld\n"
@@ -6942,522 +8094,521 @@ msgstr ""
 "daddr: %lld długość: %lld\n"
 "\n"
 
-#: .././mkfs/proto.c:60
+#: .././mkfs/proto.c:79
 #, c-format
 msgid "%s: failed to open %s: %s\n"
 msgstr "%s: nie udało się otworzyć %s: %s\n"
 
-#: .././mkfs/proto.c:67 .././mkfs/proto.c:300
+#: .././mkfs/proto.c:86 .././mkfs/proto.c:309
 #, c-format
 msgid "%s: read failed on %s: %s\n"
 msgstr "%s: odczyt nie powiódł się dla %s: %s\n"
 
-#: .././mkfs/proto.c:72
+#: .././mkfs/proto.c:91
 #, c-format
 msgid "%s: proto file %s premature EOF\n"
 msgstr "%s: plik prototypu %s skończył się przedwcześnie\n"
 
-#: .././mkfs/proto.c:116
+#: .././mkfs/proto.c:125
 msgid "cannot reserve space"
 msgstr "nie można zarezerwować miejsca"
 
-#: .././mkfs/proto.c:171
+#: .././mkfs/proto.c:180
 #, c-format
 msgid "%s: premature EOF in prototype file\n"
 msgstr "%s: przedwczesny EOF w pliku prototypu\n"
 
-#: .././mkfs/proto.c:190
+#: .././mkfs/proto.c:200
 msgid "error reserving space for a file"
 msgstr "błąd podczas rezerwowania miejsca na plik"
 
-#: .././mkfs/proto.c:258
+#: .././mkfs/proto.c:267
 msgid "error allocating space for a file"
 msgstr "błąd podczas przydzielania miejsca na plik"
 
-#: .././mkfs/proto.c:262
+#: .././mkfs/proto.c:271
 #, c-format
 msgid "%s: cannot allocate space for file\n"
 msgstr "%s: nie można przydzielić miejsca na plik\n"
 
-#: .././mkfs/proto.c:327
+#: .././mkfs/proto.c:336
 msgid "directory createname error"
 msgstr "błąd tworzenia nazwy katalogu"
 
-#: .././mkfs/proto.c:341
+#: .././mkfs/proto.c:350
 msgid "directory create error"
 msgstr "błąd tworzenia katalogu"
 
-#: .././mkfs/proto.c:407 .././mkfs/proto.c:419 .././mkfs/proto.c:430
-#: .././mkfs/proto.c:437
+#: .././mkfs/proto.c:415 .././mkfs/proto.c:427 .././mkfs/proto.c:438
+#: .././mkfs/proto.c:445
 #, c-format
 msgid "%s: bad format string %s\n"
 msgstr "%s: błędny łańcuch formatujący %s\n"
 
-#: .././mkfs/proto.c:459 .././mkfs/proto.c:499 .././mkfs/proto.c:514
-#: .././mkfs/proto.c:526 .././mkfs/proto.c:538 .././mkfs/proto.c:549
+#: .././mkfs/proto.c:466 .././mkfs/proto.c:513 .././mkfs/proto.c:528
+#: .././mkfs/proto.c:540 .././mkfs/proto.c:552 .././mkfs/proto.c:563
 msgid "Inode allocation failed"
 msgstr "Przydzielanie i-węzła nie powiodło się"
 
-#: .././mkfs/proto.c:476
+#: .././mkfs/proto.c:481
+#, c-format
+msgid "%s: Bad value %s for proto file %s\n"
+msgstr "%s: błędna wartość %s dla pliku proto %s\n"
+
+#: .././mkfs/proto.c:490
 msgid "Inode pre-allocation failed"
 msgstr "Wczesne przydzielanie i-węzła nie powiodło się"
 
-#: .././mkfs/proto.c:486
+#: .././mkfs/proto.c:500
 msgid "Pre-allocated file creation failed"
 msgstr "Tworzenie wcześnie przydzielonego pliku nie powiodło się"
 
-#: .././mkfs/proto.c:568
+#: .././mkfs/proto.c:582
 msgid "Directory creation failed"
 msgstr "Tworzenie katalogu nie powiodło się"
 
-#: .././mkfs/proto.c:589
+#: .././mkfs/proto.c:603
 msgid "Unknown format"
 msgstr "Nieznany format"
 
-#: .././mkfs/proto.c:594
+#: .././mkfs/proto.c:608
 msgid "Error encountered creating file from prototype file"
 msgstr "Wystąpił błąd podczas tworzenia pliku z pliku prototypu"
 
-#: .././mkfs/proto.c:648
+#: .././mkfs/proto.c:660
 msgid "Realtime bitmap inode allocation failed"
 msgstr "Przydzielanie i-węzła bitmapy realtime nie powiodło się"
 
-#: .././mkfs/proto.c:665
+#: .././mkfs/proto.c:677
 msgid "Realtime summary inode allocation failed"
 msgstr "Tworzenie i-węzła opisu realtime nie powiodło się"
 
-#: .././mkfs/proto.c:692
+#: .././mkfs/proto.c:704
 msgid "Allocation of the realtime bitmap failed"
 msgstr "Przydzielenie bitmapy realtime nie powiodło się"
 
-#: .././mkfs/proto.c:705
+#: .././mkfs/proto.c:717
 msgid "Completion of the realtime bitmap failed"
 msgstr "Uzupełnienie bitmapy realtime nie powiodło się"
 
-#: .././mkfs/proto.c:728
+#: .././mkfs/proto.c:740
 msgid "Allocation of the realtime summary failed"
 msgstr "Przydzielenie opisu realtime nie powiodło się"
 
-#: .././mkfs/proto.c:740
+#: .././mkfs/proto.c:752
 msgid "Completion of the realtime summary failed"
 msgstr "Uzupełnienie opisu realtime nie powiodło się"
 
-#: .././mkfs/proto.c:759
+#: .././mkfs/proto.c:770
 msgid "Error initializing the realtime space"
 msgstr "Błąd podczas inicjalizacji przestrzeni realtime"
 
-#: .././mkfs/proto.c:764
+#: .././mkfs/proto.c:775
 msgid "Error completing the realtime space"
 msgstr "Błąd podczas uzupełniania przestrzeni realtime"
 
-#: .././mkfs/xfs_mkfs.c:230
-#, c-format
-msgid "data su/sw must not be used in conjunction with data sunit/swidth\n"
-msgstr "su/sw danych nie można użyć w połączeniu z sunit/swidth danych\n"
-
-#: .././mkfs/xfs_mkfs.c:237
+#: .././mkfs/xfs_mkfs.c:752
 #, c-format
 msgid "both data sunit and data swidth options must be specified\n"
 msgstr "trzeba podać obie opcje sunit i swidth dla danych\n"
 
-#: .././mkfs/xfs_mkfs.c:246
-#, c-format
-msgid "data sunit/swidth must not be used in conjunction with data su/sw\n"
-msgstr "sunit/swidth danych nie można użyć w połączeniu z su/sw danych\n"
-
-#: .././mkfs/xfs_mkfs.c:253
+#: .././mkfs/xfs_mkfs.c:760
 #, c-format
 msgid "both data su and data sw options must be specified\n"
 msgstr "trzeba podać obie opcje su i sw dla danych\n"
 
-#: .././mkfs/xfs_mkfs.c:260
+#: .././mkfs/xfs_mkfs.c:767
 #, c-format
 msgid "data su must be a multiple of the sector size (%d)\n"
 msgstr "su danych musi być wielokrotnością rozmiaru sektora (%d)\n"
 
-#: .././mkfs/xfs_mkfs.c:271
+#: .././mkfs/xfs_mkfs.c:778
 #, c-format
-msgid "data stripe width (%d) must be a multiple of the data stripe unit (%d)\n"
-msgstr "szerokość pasa danych (%d) musi być wielokrotnością jednostki pasa danych (%d)\n"
-
-#: .././mkfs/xfs_mkfs.c:281
-#, c-format
-msgid "log su should not be used in conjunction with log sunit\n"
-msgstr "su logu nie powinno być używane w połączeniu z sunit logu\n"
-
-#: .././mkfs/xfs_mkfs.c:290
-#, c-format
-msgid "log sunit should not be used in conjunction with log su\n"
-msgstr "sunit logu nie powinno być używane w połączeniu z su logu\n"
+msgid ""
+"data stripe width (%d) must be a multiple of the data stripe unit (%d)\n"
+msgstr ""
+"szerokość pasa danych (%d) musi być wielokrotnością jednostki pasa danych "
+"(%d)\n"
 
-#: .././mkfs/xfs_mkfs.c:360 .././mkfs/xfs_mkfs.c:503
+#: .././mkfs/xfs_mkfs.c:791 .././mkfs/xfs_mkfs.c:797
 #, c-format
-msgid "%s: %s appears to contain an existing filesystem (%s).\n"
-msgstr "%s: %s zdaje się zawierać istniejący system plików (%s).\n"
+msgid "log stripe unit (%d) must be a multiple of the block size (%d)\n"
+msgstr ""
+"jednostka pasa logu (%d) musi być wielokrotnością rozmiaru bloku (%d)\n"
 
-#: .././mkfs/xfs_mkfs.c:364 .././mkfs/xfs_mkfs.c:509
+#: .././mkfs/xfs_mkfs.c:817
 #, c-format
-msgid "%s: %s appears to contain a partition table (%s).\n"
-msgstr "%s: %s zdaje się zawierać tablicę partycji (%s).\n"
+msgid "if -%s file then -%s name and -%s size are required\n"
+msgstr "jeśli podano -%s file, to -%s name i -%s size są wymagane\n"
 
-#: .././mkfs/xfs_mkfs.c:368
+#: .././mkfs/xfs_mkfs.c:823
 #, c-format
-msgid "%s: %s appears to contain something weird according to blkid\n"
-msgstr "%s: %s zdaje się zawierać coś dziwnego wg blkid\n"
+msgid "No device name specified\n"
+msgstr "Nie podano nazwy urządzenia\n"
 
-#: .././mkfs/xfs_mkfs.c:378
+#: .././mkfs/xfs_mkfs.c:835
 #, c-format
-msgid "%s: probe of %s failed, cannot detect existing filesystem.\n"
-msgstr "%s: test %s nie powiódł się, nie można wykryć istniejącego systemu plików.\n"
+msgid "Error accessing specified device %s: %s\n"
+msgstr "Błąd podczas dostępu do podanego urządzenia %s: %s\n"
 
-#: .././mkfs/xfs_mkfs.c:431
+#: .././mkfs/xfs_mkfs.c:843
 #, c-format
-msgid "warning: device is not properly aligned %s\n"
-msgstr "uwaga: urządzenie nie jest właściwie wyrównane: %s\n"
+msgid "%s: Use the -f option to force overwrite.\n"
+msgstr "%s: Można użyć opcji -f do wymuszenia nadpisania.\n"
 
-#: .././mkfs/xfs_mkfs.c:436
+#: .././mkfs/xfs_mkfs.c:864
 #, c-format
-msgid "Use -f to force usage of a misaligned device\n"
-msgstr "Można użyć -f do wymuszenia użycia źle wyrównanego urządzenia\n"
+msgid "specified \"-%s file\" on a block device %s\n"
+msgstr "podano \"-%s plik\" dla urządzenia blokowego %s\n"
 
-#: .././mkfs/xfs_mkfs.c:450
+#: .././mkfs/xfs_mkfs.c:872
 #, c-format
-msgid "warning: unable to probe device topology for device %s\n"
-msgstr "uwaga: nie udało się odczytać topologii urządzenia %s\n"
+msgid "specified device %s not a file or block device\n"
+msgstr "podane urządzenie %s nie jest plikiem ani urządzeniem blokowym\n"
 
-#: .././mkfs/xfs_mkfs.c:578
+#: .././mkfs/xfs_mkfs.c:903
 #, c-format
 msgid "log size %lld is not a multiple of the log stripe unit %d\n"
 msgstr "rozmiar logu %lld nie jest wielokrotnością jednostki pasa logu %d\n"
 
-#: .././mkfs/xfs_mkfs.c:606
+#: .././mkfs/xfs_mkfs.c:931
 #, c-format
 msgid "Due to stripe alignment, the internal log size (%lld) is too large.\n"
-msgstr "Ze względu na wyrównanie do rozmiaru pasa rozmiar wewnętrznego logu (%lld) jest zbyt duży.\n"
+msgstr ""
+"Ze względu na wyrównanie do rozmiaru pasa rozmiar wewnętrznego logu (%lld) "
+"jest zbyt duży.\n"
 
-#: .././mkfs/xfs_mkfs.c:608
+#: .././mkfs/xfs_mkfs.c:933
 #, c-format
 msgid "Must fit within an allocation group.\n"
 msgstr "Musi zmieścić się wewnątrz grupy alokacji.\n"
 
-#: .././mkfs/xfs_mkfs.c:619
+#: .././mkfs/xfs_mkfs.c:944
 #, c-format
 msgid "log size %lld blocks too small, minimum size is %d blocks\n"
-msgstr "rozmiar logu %lld bloków jest zbyt mały, minimalny rozmiar to %d bloków\n"
+msgstr ""
+"rozmiar logu %lld bloków jest zbyt mały, minimalny rozmiar to %d bloków\n"
 
-#: .././mkfs/xfs_mkfs.c:625
+#: .././mkfs/xfs_mkfs.c:950
 #, c-format
 msgid "log size %lld blocks too large, maximum size is %lld blocks\n"
-msgstr "rozmiar logu %lld bloków jest zbyt duży, maksymalny rozmiar to %lld bloków\n"
+msgstr ""
+"rozmiar logu %lld bloków jest zbyt duży, maksymalny rozmiar to %lld bloków\n"
 
-#: .././mkfs/xfs_mkfs.c:631
+#: .././mkfs/xfs_mkfs.c:956
 #, c-format
 msgid "log size %lld bytes too large, maximum size is %lld bytes\n"
-msgstr "rozmiar logu %lld bajtów jest zbyt duży, maksymalny rozmiar to %lld bajtów\n"
+msgstr ""
+"rozmiar logu %lld bajtów jest zbyt duży, maksymalny rozmiar to %lld bajtów\n"
 
-#: .././mkfs/xfs_mkfs.c:739
+#: .././mkfs/xfs_mkfs.c:993
 #, c-format
 msgid "agsize (%lld blocks) too small, need at least %lld blocks\n"
 msgstr "agsize (%lld bloków) zbyt małe, potrzeba co najmniej %lld bloków\n"
 
-#: .././mkfs/xfs_mkfs.c:747
+#: .././mkfs/xfs_mkfs.c:1001
 #, c-format
 msgid "agsize (%lld blocks) too big, maximum is %lld blocks\n"
 msgstr "agsize (%lld bloków) zbyt duże, maksimum to %lld bloków\n"
 
-#: .././mkfs/xfs_mkfs.c:755
+#: .././mkfs/xfs_mkfs.c:1009
 #, c-format
 msgid "agsize (%lld blocks) too big, data area is %lld blocks\n"
 msgstr "agsize (%lld bloków) zbyt duże, obszar danych to %lld bloków\n"
 
-#: .././mkfs/xfs_mkfs.c:762
+#: .././mkfs/xfs_mkfs.c:1016
 #, c-format
 msgid "too many allocation groups for size = %lld\n"
 msgstr "zbyt dużo grup alokacji dla rozmiaru = %lld\n"
 
-#: .././mkfs/xfs_mkfs.c:764
+#: .././mkfs/xfs_mkfs.c:1018
 #, c-format
 msgid "need at most %lld allocation groups\n"
 msgstr "potrzeba najwyżej %lld grup alokacji\n"
 
-#: .././mkfs/xfs_mkfs.c:772
+#: .././mkfs/xfs_mkfs.c:1026
 #, c-format
 msgid "too few allocation groups for size = %lld\n"
 msgstr "zbyt mało grup alokacji dla rozmiaru = %lld\n"
 
-#: .././mkfs/xfs_mkfs.c:774
+#: .././mkfs/xfs_mkfs.c:1028
 #, c-format
 msgid "need at least %lld allocation groups\n"
 msgstr "potrzeba co najmniej %lld grup alokacji\n"
 
-#: .././mkfs/xfs_mkfs.c:787
+#: .././mkfs/xfs_mkfs.c:1041
 #, c-format
 msgid "last AG size %lld blocks too small, minimum size is %lld blocks\n"
-msgstr "rozmiar ostatniej AG %lld bloków zbyt mały, minimalny rozmiar to %lld bloków\n"
+msgstr ""
+"rozmiar ostatniej AG %lld bloków zbyt mały, minimalny rozmiar to %lld "
+"bloków\n"
 
-#: .././mkfs/xfs_mkfs.c:798
+#: .././mkfs/xfs_mkfs.c:1052
 #, c-format
 msgid "%lld allocation groups is too many, maximum is %lld\n"
 msgstr "%lld grup alokacji to zbyt dużo, maksimum to %lld\n"
 
-#: .././mkfs/xfs_mkfs.c:822
+#: .././mkfs/xfs_mkfs.c:1082
 #, c-format
 msgid "error reading existing superblock -- failed to memalign buffer\n"
-msgstr "błąd podczas odczytu istniejącego superbloku - nie udało się wykonać memalign dla bufora\n"
+msgstr ""
+"błąd podczas odczytu istniejącego superbloku - nie udało się wykonać "
+"memalign dla bufora\n"
 
-#: .././mkfs/xfs_mkfs.c:828
+#: .././mkfs/xfs_mkfs.c:1097
 #, c-format
-msgid "existing superblock read failed: %s\n"
-msgstr "odczyt istniejącego superbloku nie powiódł się: %s\n"
+msgid "error reading existing superblock: %s\n"
+msgstr "błąd podczas odczytu istniejącego superbloku: %s\n"
 
-#: .././mkfs/xfs_mkfs.c:1133
+#: .././mkfs/xfs_mkfs.c:1267
 #, c-format
-msgid "%s: Specify data sunit in 512-byte blocks, no unit suffix\n"
-msgstr "%s: sunit danych należy podać w 512-bajtowych blokach, bez jednostki\n"
+msgid "Illegal value %s for -%c %s option. %s\n"
+msgstr "niedozwolona wartość %s dla opcji -%c %s. %s\n"
 
-#: .././mkfs/xfs_mkfs.c:1149
+#: .././mkfs/xfs_mkfs.c:1342
 #, c-format
-msgid "%s: Specify data swidth in 512-byte blocks, no unit suffix\n"
-msgstr "%s: swidth danych należy podać w 512-bajtowych blokach, bez jednostki\n"
+msgid ""
+"Option -%c %s has undefined minval/maxval.Can't verify value range. This is "
+"a bug.\n"
+msgstr ""
+"Opcja -%c %s nie ma określonych wartości minimalnej/maksymalnej. Nie można "
+"sprawdzić zakresu - to błąd.\n"
 
-#: .././mkfs/xfs_mkfs.c:1176
-#, c-format
-msgid "%s: Specify data sw as multiple of su, no unit suffix\n"
-msgstr "%s: sw danych należy podać jako wielokrotność su, bez jednostki\n"
+#: .././mkfs/xfs_mkfs.c:1368
+msgid "value is too small"
+msgstr "wartość zbyt mała"
 
-#: .././mkfs/xfs_mkfs.c:1405
-#, c-format
-msgid "Specify log sunit in 512-byte blocks, no size suffix\n"
-msgstr "sunit należy podać w 512-bajtowych blokach, bez jednostki\n"
+#: .././mkfs/xfs_mkfs.c:1370
+msgid "value is too large"
+msgstr "wartość zbyt duża"
 
-#: .././mkfs/xfs_mkfs.c:1508 .././mkfs/xfs_mkfs.c:1585
-#, c-format
-msgid "cannot specify both crc and ftype\n"
-msgstr "nie można podać jednocześnie crc i ftype\n"
+#: .././mkfs/xfs_mkfs.c:1372
+msgid "value must be a power of 2"
+msgstr "wartość musi być potęgą liczby 2"
 
-#: .././mkfs/xfs_mkfs.c:1710
+#: .././mkfs/xfs_mkfs.c:1932
 #, c-format
 msgid "extra arguments\n"
 msgstr "nadmiarowe argumenty\n"
 
-#: .././mkfs/xfs_mkfs.c:1716
-#, c-format
-msgid "cannot specify both %s and -d name=%s\n"
-msgstr "nie można podać jednocześnie %s i -d name=%s\n"
-
-#: .././mkfs/xfs_mkfs.c:1733
+#: .././mkfs/xfs_mkfs.c:1949
 #, c-format
 msgid "illegal block size %d\n"
 msgstr "niedozwolony rozmiar bloku %d\n"
 
-#: .././mkfs/xfs_mkfs.c:1768
+#: .././mkfs/xfs_mkfs.c:1954
+#, c-format
+msgid "Minimum block size for CRC enabled filesystems is %d bytes.\n"
+msgstr "Minimalny rozmiar bloku systemów plików z CRC to %d bajtów.\n"
+
+#: .././mkfs/xfs_mkfs.c:1959
+#, c-format
+msgid "cannot disable ftype with crcs enabled\n"
+msgstr "nie można wyłączyć ftype przy włączonych crc\n"
+
+#: .././mkfs/xfs_mkfs.c:2013
 #, c-format
 msgid "specified blocksize %d is less than device physical sector size %d\n"
-msgstr "podany rozmiar bloku %d jest mniejszy niż rozmiar fizycznego sektora urządzenia (%d)\n"
+msgstr ""
+"podany rozmiar bloku %d jest mniejszy niż rozmiar fizycznego sektora "
+"urządzenia (%d)\n"
 
-#: .././mkfs/xfs_mkfs.c:1771
+#: .././mkfs/xfs_mkfs.c:2016
 #, c-format
 msgid "switching to logical sector size %d\n"
 msgstr "przełączono na rozmiar sektora logicznego %d\n"
 
-#: .././mkfs/xfs_mkfs.c:1789
+#: .././mkfs/xfs_mkfs.c:2034
 #, c-format
 msgid "illegal sector size %d\n"
 msgstr "niedozwolony rozmiar sektora %d\n"
 
-#: .././mkfs/xfs_mkfs.c:1792
+#: .././mkfs/xfs_mkfs.c:2037
 #, c-format
 msgid "block size %d cannot be smaller than logical sector size %d\n"
-msgstr "rozmiar bloku %d nie może być mniejszy niż rozmiar sektora logicznego %d\n"
+msgstr ""
+"rozmiar bloku %d nie może być mniejszy niż rozmiar sektora logicznego %d\n"
 
-#: .././mkfs/xfs_mkfs.c:1797
+#: .././mkfs/xfs_mkfs.c:2042
 #, c-format
 msgid "illegal sector size %d; hw sector is %d\n"
 msgstr "niedozwolony rozmiar sektora %d; sektor sprzętowy ma %d\n"
 
-#: .././mkfs/xfs_mkfs.c:1803
+#: .././mkfs/xfs_mkfs.c:2048
 #, c-format
 msgid "illegal log sector size %d\n"
 msgstr "niedozwolony rozmiar sektora logu %d\n"
 
-#: .././mkfs/xfs_mkfs.c:1819 .././mkfs/xfs_mkfs.c:1924
+#: .././mkfs/xfs_mkfs.c:2064 .././mkfs/xfs_mkfs.c:2194
 #, c-format
 msgid "Minimum inode size for CRCs is %d bytes\n"
 msgstr "Minimalny rozmiar i-węzła dla CRC to %d bajtów\n"
 
-#: .././mkfs/xfs_mkfs.c:1827
+#: .././mkfs/xfs_mkfs.c:2072
 #, c-format
 msgid "Inodes always aligned for CRC enabled filesytems\n"
 msgstr "I-węzły są zawsze wyrównane dla systemów plików z CRC\n"
 
-#: .././mkfs/xfs_mkfs.c:1834
+#: .././mkfs/xfs_mkfs.c:2079
 #, c-format
 msgid "Lazy superblock counted always enabled for CRC enabled filesytems\n"
-msgstr "Leniwe liczenie syperbloków jest zawsze włączone dla systemów plików z CRC\n"
+msgstr ""
+"Leniwe liczenie syperbloków jest zawsze włączone dla systemów plików z CRC\n"
 
-#: .././mkfs/xfs_mkfs.c:1841
+#: .././mkfs/xfs_mkfs.c:2086
 #, c-format
 msgid "V2 logs always enabled for CRC enabled filesytems\n"
 msgstr "Logi V2 są zawsze włączone dla systemów plików z CRC\n"
 
-#: .././mkfs/xfs_mkfs.c:1848
+#: .././mkfs/xfs_mkfs.c:2093
 #, c-format
 msgid "V2 attribute format always enabled on CRC enabled filesytems\n"
 msgstr "Format atrybutów V2 jest zawsze włączony dla systemów plików z CRC\n"
 
-#: .././mkfs/xfs_mkfs.c:1856
+#: .././mkfs/xfs_mkfs.c:2101
 #, c-format
 msgid "32 bit Project IDs always enabled on CRC enabled filesytems\n"
 msgstr "32-bitowe ID projektów są zawsze włączone dla systemów plików z CRC\n"
 
-#: .././mkfs/xfs_mkfs.c:1867
+#: .././mkfs/xfs_mkfs.c:2116
 #, c-format
-msgid "warning: finobt not supported without CRC support, disabled.\n"
-msgstr "uwaga: finobt nie jest obsługiwane bez obsługi CRC, wyłączono.\n"
+msgid "finobt not supported without CRC support\n"
+msgstr "finobt nie jest obsługiwane bez obsługi CRC\n"
 
-#: .././mkfs/xfs_mkfs.c:1874
+#: .././mkfs/xfs_mkfs.c:2123
 #, c-format
-msgid "illegal directory block size %d\n"
-msgstr "niedozwolony rozmiar bloku katalogu %d\n"
+msgid "sparse inodes not supported without CRC support\n"
+msgstr "i-węzły rzadkie nie są obsługiwane bez obsługi CRC\n"
+
+#: .././mkfs/xfs_mkfs.c:2130
+#, c-format
+msgid "rmapbt not supported without CRC support\n"
+msgstr "rmapbt nie jest obsługiwane bez obsługi CRC\n"
+
+#: .././mkfs/xfs_mkfs.c:2137
+#, c-format
+msgid "reflink not supported without CRC support\n"
+msgstr "reflink nie jest obsługiwane bez obsługi CRC\n"
 
-#: .././mkfs/xfs_mkfs.c:1888
+#: .././mkfs/xfs_mkfs.c:2146
 #, c-format
-msgid "both -d agcount= and agsize= specified, use one or the other\n"
-msgstr "podano jednocześnie -d agcount= i agsize=, można użyć tylko jednej z tych opcji\n"
+msgid "rmapbt not supported with realtime devices\n"
+msgstr "rmapbt nie jest obsługiwane dla urządzeń realtime\n"
 
-#: .././mkfs/xfs_mkfs.c:1894
+#: .././mkfs/xfs_mkfs.c:2154
 #, c-format
-msgid "if -d file then -d name and -d size are required\n"
-msgstr "jeśli podano -d file, to -d name i -d size są wymagane\n"
+msgid "illegal directory block size %d\n"
+msgstr "niedozwolony rozmiar bloku katalogu %d\n"
 
-#: .././mkfs/xfs_mkfs.c:1903
+#: .././mkfs/xfs_mkfs.c:2173
 #, c-format
 msgid "illegal data length %lld, not a multiple of %d\n"
 msgstr "niedozwolona długość danych %lld, nie jest wielokrotnością %d\n"
 
-#: .././mkfs/xfs_mkfs.c:1909
+#: .././mkfs/xfs_mkfs.c:2179
 #, c-format
 msgid "warning: data length %lld not a multiple of %d, truncated to %lld\n"
-msgstr "uwaga: długość danych %lld nie jest wielokrotnością %d, ucięto do %lld\n"
-
-#: .././mkfs/xfs_mkfs.c:1931
-#, c-format
-msgid "if -l file then -l name and -l size are required\n"
-msgstr "jeśli podano -l file to -l name i -l size są wymagane\n"
+msgstr ""
+"uwaga: długość danych %lld nie jest wielokrotnością %d, ucięto do %lld\n"
 
-#: .././mkfs/xfs_mkfs.c:1940
+#: .././mkfs/xfs_mkfs.c:2205
 #, c-format
 msgid "illegal log length %lld, not a multiple of %d\n"
 msgstr "niedozwolona długość logu %lld, nie jest wielokrotnością %d\n"
 
-#: .././mkfs/xfs_mkfs.c:1947
+#: .././mkfs/xfs_mkfs.c:2212
 #, c-format
 msgid "warning: log length %lld not a multiple of %d, truncated to %lld\n"
 msgstr "uwaga: długość logu %lld nie jest wielokrotnością %d, ucięto do %lld\n"
 
-#: .././mkfs/xfs_mkfs.c:1953
-#, c-format
-msgid "if -r file then -r name and -r size are required\n"
-msgstr "jeśli podano -r file, to -r name i -r size są wymagane\n"
-
-#: .././mkfs/xfs_mkfs.c:1962
+#: .././mkfs/xfs_mkfs.c:2222
 #, c-format
 msgid "illegal rt length %lld, not a multiple of %d\n"
 msgstr "niedozwolona długość rt %lld, nie jest wielokrotnością %d\n"
 
-#: .././mkfs/xfs_mkfs.c:1969
+#: .././mkfs/xfs_mkfs.c:2229
 #, c-format
 msgid "warning: rt length %lld not a multiple of %d, truncated to %lld\n"
 msgstr "uwaga: długość rt %lld nie jest wielokrotnością %d, ucięto do %lld\n"
 
-#: .././mkfs/xfs_mkfs.c:1982
+#: .././mkfs/xfs_mkfs.c:2242
 #, c-format
 msgid "illegal rt extent size %lld, not a multiple of %d\n"
 msgstr "niedozwolony rozmiar ekstentu rt %lld, nie jest wielokrotnością %d\n"
 
-#: .././mkfs/xfs_mkfs.c:1988
-#, c-format
-msgid "rt extent size %s too large, maximum %d\n"
-msgstr "rozmiar ekstentu rt %s zbyt duży, maksimum to %d\n"
-
-#: .././mkfs/xfs_mkfs.c:1994
-#, c-format
-msgid "rt extent size %s too small, minimum %d\n"
-msgstr "rozmiar ekstentu rt %s zbyt mały, minimum to %d\n"
-
-#: .././mkfs/xfs_mkfs.c:2037
+#: .././mkfs/xfs_mkfs.c:2285
 #, c-format
 msgid "illegal inode size %d\n"
 msgstr "niedozwolony rozmiar i-węzła %d\n"
 
-#: .././mkfs/xfs_mkfs.c:2042
+#: .././mkfs/xfs_mkfs.c:2290
 #, c-format
 msgid "allowable inode size with %d byte blocks is %d\n"
 msgstr "dozwolony rozmiar i-węzła przy blokach %d-bajtowych to %d\n"
 
-#: .././mkfs/xfs_mkfs.c:2046
+#: .././mkfs/xfs_mkfs.c:2294
 #, c-format
 msgid "allowable inode size with %d byte blocks is between %d and %d\n"
 msgstr "dozwolone rozmiary i-węzła przy blokach %d-bajtowych są od %d do %d\n"
 
-#: .././mkfs/xfs_mkfs.c:2054
+#: .././mkfs/xfs_mkfs.c:2302
 #, c-format
 msgid "log stripe unit specified, using v2 logs\n"
 msgstr "podano jednostkę pasa logu, użyto logów v2\n"
 
-#: .././mkfs/xfs_mkfs.c:2069
+#: .././mkfs/xfs_mkfs.c:2317
 #, c-format
 msgid "no device name given in argument list\n"
 msgstr "nie podano nazwy urządzenia w liście argumentów\n"
 
-#: .././mkfs/xfs_mkfs.c:2094
-#, c-format
-msgid "%s: Use the -f option to force overwrite.\n"
-msgstr "%s: Można użyć opcji -f do wymuszenia nadpisania.\n"
-
-#: .././mkfs/xfs_mkfs.c:2113
+#: .././mkfs/xfs_mkfs.c:2353
 msgid "internal log"
 msgstr "log wewnętrzny"
 
-#: .././mkfs/xfs_mkfs.c:2115
+#: .././mkfs/xfs_mkfs.c:2355
 msgid "volume log"
 msgstr "log na wolumenie"
 
-#: .././mkfs/xfs_mkfs.c:2117
+#: .././mkfs/xfs_mkfs.c:2357
 #, c-format
 msgid "no log subvolume or internal log\n"
 msgstr "brak podwolumenu logu ani logu wewnętrznego\n"
 
-#: .././mkfs/xfs_mkfs.c:2124
+#: .././mkfs/xfs_mkfs.c:2364
 msgid "volume rt"
 msgstr "wolumen rt"
 
-#: .././mkfs/xfs_mkfs.c:2129
+#: .././mkfs/xfs_mkfs.c:2369
 #, c-format
-msgid "size %s specified for data subvolume is too large, maximum is %lld blocks\n"
-msgstr "rozmiar %s podany dla podwolumenu danych jest zbyt duży, maksimum to %lld bloków\n"
+msgid ""
+"size %s specified for data subvolume is too large, maximum is %lld blocks\n"
+msgstr ""
+"rozmiar %s podany dla podwolumenu danych jest zbyt duży, maksimum to %lld "
+"bloków\n"
 
-#: .././mkfs/xfs_mkfs.c:2136
+#: .././mkfs/xfs_mkfs.c:2376
 #, c-format
 msgid "can't get size of data subvolume\n"
 msgstr "nie można pobrać rozmiaru podwolumenu danych\n"
 
-#: .././mkfs/xfs_mkfs.c:2141
+#: .././mkfs/xfs_mkfs.c:2381
 #, c-format
 msgid "size %lld of data subvolume is too small, minimum %d blocks\n"
-msgstr "rozmiar %lld dla podwolumenu danych jest zbyt mały, minimum to %d bloków\n"
+msgstr ""
+"rozmiar %lld dla podwolumenu danych jest zbyt mały, minimum to %d bloków\n"
 
-#: .././mkfs/xfs_mkfs.c:2148
+#: .././mkfs/xfs_mkfs.c:2388
 #, c-format
 msgid "can't have both external and internal logs\n"
 msgstr "nie można mieć jednocześnie zewnętrznego i wewnętrznego logu\n"
 
-#: .././mkfs/xfs_mkfs.c:2152
+#: .././mkfs/xfs_mkfs.c:2392
 #, c-format
 msgid "data and log sector sizes must be equal for internal logs\n"
-msgstr "rozmiary sektora danych i logu muszą być równe dla logów wewnętrznych\n"
+msgstr ""
+"rozmiary sektora danych i logu muszą być równe dla logów wewnętrznych\n"
 
-#: .././mkfs/xfs_mkfs.c:2158
+#: .././mkfs/xfs_mkfs.c:2398
 #, c-format
 msgid ""
 "Warning: the data subvolume sector size %u is less than the sector size \n"
@@ -7466,7 +8617,7 @@ msgstr ""
 "Uwaga: rozmiar sektora podwolumenu danych %u jest mniejszy od rozmiaru\n"
 "sektora zgłaszanego przez urządzenie (%u).\n"
 
-#: .././mkfs/xfs_mkfs.c:2164
+#: .././mkfs/xfs_mkfs.c:2404
 #, c-format
 msgid ""
 "Warning: the log subvolume sector size %u is less than the sector size\n"
@@ -7475,7 +8626,7 @@ msgstr ""
 "Uwaga: rozmiar sektora podwolumenu logu %u jest mniejszy od rozmiaru\n"
 "sektora zgłaszanego przez urządzenie (%u).\n"
 
-#: .././mkfs/xfs_mkfs.c:2170
+#: .././mkfs/xfs_mkfs.c:2410
 #, c-format
 msgid ""
 "Warning: the realtime subvolume sector size %u is less than the sector size\n"
@@ -7484,41 +8635,54 @@ msgstr ""
 "Uwaga: rozmiar sektora podwolumenu realtime %u jest mniejszy od rozmiaru\n"
 "sektora zgłaszanego przez urządzenie (%u).\n"
 
-#: .././mkfs/xfs_mkfs.c:2177
+#: .././mkfs/xfs_mkfs.c:2417
 #, c-format
-msgid "size %s specified for rt subvolume is too large, maximum is %lld blocks\n"
-msgstr "rozmiar %s podany dla podwolumenu rt jest zbyt duży, maksimum to %lld bloków\n"
+msgid ""
+"size %s specified for rt subvolume is too large, maximum is %lld blocks\n"
+msgstr ""
+"rozmiar %s podany dla podwolumenu rt jest zbyt duży, maksimum to %lld "
+"bloków\n"
 
-#: .././mkfs/xfs_mkfs.c:2185
+#: .././mkfs/xfs_mkfs.c:2425
 #, c-format
 msgid "size specified for non-existent rt subvolume\n"
 msgstr "podano rozmiar dla nie istniejącego podwolumenu rt\n"
 
-#: .././mkfs/xfs_mkfs.c:2200
+#: .././mkfs/xfs_mkfs.c:2440
 #, c-format
-msgid "%s: Specified data stripe unit %d is not the same as the volume stripe unit %d\n"
-msgstr "%s: Podana jednostka pasa danych %d nie jest taka sama jak jednostka pasa wolumenu %d\n"
+msgid ""
+"%s: Specified data stripe unit %d is not the same as the volume stripe unit "
+"%d\n"
+msgstr ""
+"%s: Podana jednostka pasa danych %d nie jest taka sama jak jednostka pasa "
+"wolumenu %d\n"
 
-#: .././mkfs/xfs_mkfs.c:2207
+#: .././mkfs/xfs_mkfs.c:2447
 #, c-format
-msgid "%s: Specified data stripe width %d is not the same as the volume stripe width %d\n"
-msgstr "%s: Podana szerokość pasa danych %d nie jest taka sama jak szerokość pasa wolumenu %d\n"
+msgid ""
+"%s: Specified data stripe width %d is not the same as the volume stripe "
+"width %d\n"
+msgstr ""
+"%s: Podana szerokość pasa danych %d nie jest taka sama jak szerokość pasa "
+"wolumenu %d\n"
 
-#: .././mkfs/xfs_mkfs.c:2225
+#: .././mkfs/xfs_mkfs.c:2465
 #, c-format
 msgid "agsize (%lld) not a multiple of fs blk size (%d)\n"
-msgstr "agsize (%lld) nie jest wielokrotnością rozmiaru bloku systemu plików (%d)\n"
+msgstr ""
+"agsize (%lld) nie jest wielokrotnością rozmiaru bloku systemu plików (%d)\n"
 
-#: .././mkfs/xfs_mkfs.c:2275
+#: .././mkfs/xfs_mkfs.c:2515
 #, c-format
 msgid "agsize rounded to %lld, swidth = %d\n"
 msgstr "agsize zaokrąglone do %lld, swidth = %d\n"
 
-#: .././mkfs/xfs_mkfs.c:2307
+#: .././mkfs/xfs_mkfs.c:2547
 #, c-format
 msgid ""
 "Warning: AG size is a multiple of stripe width.  This can cause performance\n"
-"problems by aligning all AGs on the same disk.  To avoid this, run mkfs with\n"
+"problems by aligning all AGs on the same disk.  To avoid this, run mkfs "
+"with\n"
 "an AG size that is one stripe unit smaller, for example %llu.\n"
 msgstr ""
 "Uwaga: rozmiar AG jest wielokrotnością szerokości pasa. Może to spowodować\n"
@@ -7526,57 +8690,61 @@ msgstr ""
 "Aby temu zapobiec, należy uruchomić mkfs z rozmiarem AG o jedną jednostkę\n"
 "pasa mniejszym, na przykład %llu.\n"
 
-#: .././mkfs/xfs_mkfs.c:2332
-#, c-format
-msgid "%s: Stripe unit(%d) or stripe width(%d) is not a multiple of the block size(%d)\n"
-msgstr "%s: Jednostka pasa (%d) lub szerokość pasa (%d) nie jest wielokrotnością rozmiaru bloku (%d)\n"
-
-#: .././mkfs/xfs_mkfs.c:2364
+#: .././mkfs/xfs_mkfs.c:2572
 #, c-format
-msgid "log stripe unit (%d) must be a multiple of the block size (%d)\n"
-msgstr "jednostka pasa logu (%d) musi być wielokrotnością rozmiaru bloku (%d)\n"
+msgid ""
+"%s: Stripe unit(%d) or stripe width(%d) is not a multiple of the block "
+"size(%d)\n"
+msgstr ""
+"%s: Jednostka pasa (%d) lub szerokość pasa (%d) nie jest wielokrotnością "
+"rozmiaru bloku (%d)\n"
 
-#: .././mkfs/xfs_mkfs.c:2377
+#: .././mkfs/xfs_mkfs.c:2613
 #, c-format
 msgid "log stripe unit (%d bytes) is too large (maximum is 256KiB)\n"
 msgstr "jednostka pasa logu (%d bajtów) jest zbyt duża (maksimum to 256KiB)\n"
 
-#: .././mkfs/xfs_mkfs.c:2380
+#: .././mkfs/xfs_mkfs.c:2616
 #, c-format
 msgid "log stripe unit adjusted to 32KiB\n"
 msgstr "jednostka pasa logu zmodyfikowana na 32KiB\n"
 
-#: .././mkfs/xfs_mkfs.c:2392
+#: .././mkfs/xfs_mkfs.c:2632
 #, c-format
-msgid "size %s specified for log subvolume is too large, maximum is %lld blocks\n"
-msgstr "rozmiar %s podany dla podwolumenu logu jest zbyt duży, maksimum to %lld bloków\n"
+msgid ""
+"size %s specified for log subvolume is too large, maximum is %lld blocks\n"
+msgstr ""
+"rozmiar %s podany dla podwolumenu logu jest zbyt duży, maksimum to %lld "
+"bloków\n"
 
-#: .././mkfs/xfs_mkfs.c:2399
+#: .././mkfs/xfs_mkfs.c:2639
 #, c-format
 msgid "size specified for non-existent log subvolume\n"
 msgstr "podano rozmiar dla nie istniejącego podwolumenu logu\n"
 
-#: .././mkfs/xfs_mkfs.c:2402
+#: .././mkfs/xfs_mkfs.c:2642
 #, c-format
 msgid "size %lld too large for internal log\n"
 msgstr "rozmiar %lld jest zbyt duży dla logu wewnętrznego\n"
 
-#: .././mkfs/xfs_mkfs.c:2495
+#: .././mkfs/xfs_mkfs.c:2720
 #, c-format
 msgid "internal log size %lld too large, must fit in allocation group\n"
-msgstr "rozmiar wewnętrznego logu %lld zbyt duży, musi się zmieścić w grupie alokacji\n"
+msgstr ""
+"rozmiar wewnętrznego logu %lld zbyt duży, musi się zmieścić w grupie "
+"alokacji\n"
 
-#: .././mkfs/xfs_mkfs.c:2503
+#: .././mkfs/xfs_mkfs.c:2728
 #, c-format
 msgid "log ag number %d too large, must be less than %lld\n"
 msgstr "liczba ag logu %d zbyt duża, musi być mniejsza niż %lld\n"
 
-#: .././mkfs/xfs_mkfs.c:2541
+#: .././mkfs/xfs_mkfs.c:2758
 #, c-format
 msgid ""
 "meta-data=%-22s isize=%-6d agcount=%lld, agsize=%lld blks\n"
 "         =%-22s sectsz=%-5u attr=%u, projid32bit=%u\n"
-"         =%-22s crc=%-8u finobt=%u\n"
+"         =%-22s crc=%-8u finobt=%u, sparse=%u, rmapbt=%u, reflink=%u\n"
 "data     =%-22s bsize=%-6u blocks=%llu, imaxpct=%u\n"
 "         =%-22s sunit=%-6u swidth=%u blks\n"
 "naming   =version %-14u bsize=%-6u ascii-ci=%d ftype=%d\n"
@@ -7586,71 +8754,76 @@ msgid ""
 msgstr ""
 "metadane=%-22s isize=%-6d agcount=%lld, agsize=%lld bloków\n"
 "        =%-22s sectsz=%-5u attr=%u, projid32bit=%u\n"
-"        =%-22s crc=%-8u finobt=%u\n"
+"        =%-22s crc=%-8u finobt=%u, sparse=%u, rmapbt=%u, reflink=%u\n"
 "dane    =%-22s bsize=%-6u blocks=%llu, imaxpct=%u\n"
 "        =%-22s sunit=%-6u swidth=%u bloków\n"
-"nazwy   =wersja %-14u bsize=%-6u ascii-ci=%d ftype=%d\n"
+"nazwy   =wersja %-14u  bsize=%-6u ascii-ci=%d ftype=%d\n"
 "log     =%-22s bsize=%-6d blocks=%lld, wersja=%d\n"
 "        =%-22s sectsz=%-5u sunit=%d bloków, lazy-count=%d\n"
 "realtime=%-22s extsz=%-6d blocks=%lld, rtextents=%lld\n"
 
-#: .././mkfs/xfs_mkfs.c:2650
+#: .././mkfs/xfs_mkfs.c:2876
 #, c-format
 msgid "%s: Growing the data section failed\n"
 msgstr "%s: Powiększenie sekcji danych nie powiodło się\n"
 
-#: .././mkfs/xfs_mkfs.c:2679
+#: .././mkfs/xfs_mkfs.c:2906
 #, c-format
 msgid "%s: filesystem failed to initialize\n"
 msgstr "%s: nie udało się zainicjować systemu plików\n"
 
-#: .././mkfs/xfs_mkfs.c:2979
+#: .././mkfs/xfs_mkfs.c:3298
 #, c-format
 msgid "%s: root inode created in AG %u, not AG 0\n"
 msgstr "%s: główny i-węzeł utworzony w AG %u, nie AG 0\n"
 
-#: .././mkfs/xfs_mkfs.c:3045
+#: .././mkfs/xfs_mkfs.c:3364
 #, c-format
 msgid "Cannot specify both -%c %s and -%c %s\n"
 msgstr "Nie można podać jednocześnie -%c %s i %c %s\n"
 
-#: .././mkfs/xfs_mkfs.c:3056
+#: .././mkfs/xfs_mkfs.c:3375
 #, c-format
 msgid "Illegal value %s for -%s option\n"
 msgstr "Niedozwolona wartość %s dla opcji -%s\n"
 
-#: .././mkfs/xfs_mkfs.c:3073
+#: .././mkfs/xfs_mkfs.c:3392
 #, c-format
 msgid "-%c %s option requires a value\n"
 msgstr "Opcja -%c %s wymaga wartości\n"
 
-#: .././mkfs/xfs_mkfs.c:3086 .././repair/xfs_repair.c:164
+#: .././mkfs/xfs_mkfs.c:3405 .././repair/xfs_repair.c:170
 #, c-format
 msgid "option respecified\n"
 msgstr "ponownie podana opcja\n"
 
-#: .././mkfs/xfs_mkfs.c:3095 .././repair/xfs_repair.c:171
+#: .././mkfs/xfs_mkfs.c:3414 .././repair/xfs_repair.c:177
 #, c-format
 msgid "unknown option -%c %s\n"
 msgstr "nieznana opcja -%c %s\n"
 
-#: .././mkfs/xfs_mkfs.c:3134
+#: .././mkfs/xfs_mkfs.c:3440
+#, c-format
+msgid "Blocksize must be provided prior to using 'b' suffix.\n"
+msgstr "Rozmiar bloku musi być przekazany przed użyciem przyrostka 'b'.\n"
+
+#: .././mkfs/xfs_mkfs.c:3449
 #, c-format
-msgid "blocksize not available yet.\n"
-msgstr "rozmiar bloku jeszcze nie dostępny.\n"
+msgid "Sectorsize must be specified prior to using 's' suffix.\n"
+msgstr "Rozmiar sektora musi być przekazany przed użyciem przyrostka 's'.\n"
 
-#: .././mkfs/xfs_mkfs.c:3160
+#: .././mkfs/xfs_mkfs.c:3484
 #, c-format
 msgid ""
 "Usage: %s\n"
 "/* blocksize */\t\t[-b log=n|size=num]\n"
-"/* metadata */\t\t[-m crc=0|1,finobt=0|1]\n"
+"/* metadata */\t\t[-m crc=0|1,finobt=0|1,uuid=xxx,rmapbt=0|1,reflink=0|1]\n"
 "/* data subvol */\t[-d agcount=n,agsize=n,file,name=xxx,size=num,\n"
 "\t\t\t    (sunit=value,swidth=value|su=num,sw=num|noalign),\n"
 "\t\t\t    sectlog=n|sectsize=num\n"
 "/* force overwrite */\t[-f]\n"
 "/* inode size */\t[-i log=n|perblock=n|size=num,maxpct=n,attr=0|1|2,\n"
-"\t\t\t    projid32bit=0|1]\n"
+"\t\t\t    projid32bit=0|1,sparse=0|1]\n"
 "/* no discard */\t[-K]\n"
 "/* log subvol */\t[-l agnum=n,internal,size=num,logdev=xxx,version=n\n"
 "\t\t\t    sunit=value|su=num,sectlog=n|sectsize=num,\n"
@@ -7671,14 +8844,14 @@ msgid ""
 msgstr ""
 "Składnia: %s\n"
 "/* rozmiar bloku */     [-b log=n|size=liczba]\n"
-"/* metadane */          [-m crc=0|1,finobt=0|1]\n"
+"/* metadane */          [-m crc=0|1,finobt=0|1,uuid=xxx,rmapbt=0|1,reflink=0|1]\n"
 "/* podwolumen danych */ [-d agcount=n,agsize=n,file,name=xxx,size=liczba,\n"
 "                           (sunit=wartość,swidth=wartość|su=ile,sw=ile|noalign),\n"
 "                           sectlog=n|sectsize=ile]\n"
 "/* wym. nadpisania */   [-f]\n"
 "/* rozmiar i-węzła */   [-i log=n|perblock=n|size=ile,maxpct=n,attr=0|1|2,\n"
-"                           projid32bit=0|1]\n"
-"/* bez porzucenia */    [-K]\n"
+"                           projid32bit=0|1,sparse=0|1]\n"
+"/* bez porzucania */    [-K]\n"
 "/* podwolumen logu */   [-l agnum=n,internal,size=ile,logdev=xxx,version=n\n"
 "                           sunit=wartość|su=ile,sectlog=n|sectsize=ile,\n"
 "                           lazy-count=0|1]\n"
@@ -7724,10 +8897,13 @@ msgstr ""
 "Przykład:\n"
 " 'limit bsoft=100m bhard=110m tanya'\n"
 "\n"
-" limit zmienia miękki i/lub twardy limit bloków, limity i-węzłów i/lub limity\n"
-" bloków realtime aktualnie używane dla podanego użytkownika, grupy lub projektu.\n"
+" limit zmienia miękki i/lub twardy limit bloków, limity i-węzłów i/lub "
+"limity\n"
+" bloków realtime aktualnie używane dla podanego użytkownika, grupy lub "
+"projektu.\n"
 " System plików określony bieżącą ścieżką jest modyfikowany.\n"
-" -d - ustawienie wartości domyślnych, użytych pierwszy raz przy tworzeniu pliku\n"
+" -d - ustawienie wartości domyślnych, użytych pierwszy raz przy tworzeniu "
+"pliku\n"
 " -g - zmiana limitów quot grupy\n"
 " -p - zmiana limitów quot projektu\n"
 " -u - zmiana limitów quot użytkownika\n"
@@ -7774,22 +8950,28 @@ msgstr ""
 " (zmiana czasu wymuszenia miękkiego limitu i-węzłów na 3 dni)\n"
 "\n"
 " timer zmienia wartość ograniczenia czasu związanego z limitami bloków,\n"
-" limitami i-węzłów i/lub limitami bloków realtime dla wszystkich użytkowników,\n"
+" limitami i-węzłów i/lub limitami bloków realtime dla wszystkich "
+"użytkowników,\n"
 " grup lub projektów na bieżącym systemie plików.\n"
-" Po tym jak użytkownik wykorzysta ilość miejsca lub liczbę i-węzłów ustawioną\n"
-" jako miękki limit, zaczyna działać zegar. Kiedy czas minie, a użytkownik nadal\n"
+" Po tym jak użytkownik wykorzysta ilość miejsca lub liczbę i-węzłów "
+"ustawioną\n"
+" jako miękki limit, zaczyna działać zegar. Kiedy czas minie, a użytkownik "
+"nadal\n"
 " przekracza miękki limit, miękki limit staje się twardym.\n"
 " Domyślne ograniczenie czasowe to 7 dni.\n"
-" -d - ustawienie wartości domyślnych, użytych pierwszy raz przy tworzeniu pliku\n"
+" -d - ustawienie wartości domyślnych, użytych pierwszy raz przy tworzeniu "
+"pliku\n"
 " -g - zmiana czasu dla limitów quot grup\n"
 " -p - zmiana czasu dla limitów quot projektów\n"
 " -u - zmiana czasu dla limitów quot użytkowników\n"
 " -b - zmiana czasu dla użytych bloków\n"
 " -i - zmiana czasu dla użytych i-węzłów\n"
-" -r - zmiana czasu dla użytych bloków na (opcjonalnym) podwolumenie realtime\n"
+" -r - zmiana czasu dla użytych bloków na (opcjonalnym) podwolumenie "
+"realtime\n"
 " Wartość ograniczenia czasu jest podawana domyślnie jako liczba sekund.\n"
 " Jednak można dodać końcówkę, aby podać czas w minutach (m), godzinach (h),\n"
-" dniach (d) lub tygodniach (w) - można użyć pełnego słowa lub pierwsze litery.\n"
+" dniach (d) lub tygodniach (w) - można użyć pełnego słowa lub pierwsze "
+"litery.\n"
 "\n"
 
 #: .././quota/edit.c:91
@@ -7807,7 +8989,8 @@ msgid ""
 " When a user has been warned the maximum number of times allowed, the soft\n"
 " limit is enforced as the hard limit.  It is intended as an alternative to\n"
 " the timeout system, where the system administrator updates a count of the\n"
-" number of warnings issued to people, and they are penalised if the warnings\n"
+" number of warnings issued to people, and they are penalised if the "
+"warnings\n"
 " are ignored.\n"
 " -d -- set maximum warning count, which triggers soft limit enforcement\n"
 " -g -- set group quota warning count\n"
@@ -7824,21 +9007,27 @@ msgstr ""
 "\n"
 " Przykład:\n"
 " 'warn 2 jimmy'\n"
-" (przekazanie systemowi quota, że wysłano 2 ostrzeżenia do użytkownika jimmy)\n"
+" (przekazanie systemowi quota, że wysłano 2 ostrzeżenia do użytkownika "
+"jimmy)\n"
 "\n"
-" warn zmienia liczbę ostrzeżeń związanych z limitami bloków, limitami i-węzłów\n"
-" i/lub limitami bloków realtime dla podanego użytkownika, grupy lub projektu.\n"
-" Kiedy użytkownik został ostrzeżony maksymalną dozwoloną liczbę razy, miękki\n"
+" warn zmienia liczbę ostrzeżeń związanych z limitami bloków, limitami i-"
+"węzłów\n"
+" i/lub limitami bloków realtime dla podanego użytkownika, grupy lub "
+"projektu.\n"
+" Kiedy użytkownik został ostrzeżony maksymalną dozwoloną liczbę razy, "
+"miękki\n"
 " limit staje się twardym. Jest to pomyślane jako alternatywa dla systemu\n"
 " ograniczeń czasowych, gdzie administrator uaktualnia licznik ostrzeżeń\n"
 " wysłanych do ludzi i karze użytkowników ignorujących ostrzeżenia.\n"
-" -d - ustawienie maksymalnej liczby ostrzeżeń, po której wymuszane są limity\n"
+" -d - ustawienie maksymalnej liczby ostrzeżeń, po której wymuszane są "
+"limity\n"
 " -g - ustawienie liczby ostrzeżeń dla grupy\n"
 " -p - ustawienie liczby ostrzeżeń dla projektu\n"
 " -u - ustawienie liczby ostrzeżeń dla grupy\n"
 " -b - ustawienie liczby ostrzeżeń dla użytych bloków\n"
 " -i - ustawienie liczby ostrzeżeń dla użytych i-węzłów\n"
-" -r - ustawienie liczby ostrzeżeń dla użytych bloków na podwolumenie realtime\n"
+" -r - ustawienie liczby ostrzeżeń dla użytych bloków na podwolumenie "
+"realtime\n"
 " Użytkownik/grupa/projekt może być podany za pomocą nazwy lub numeru.\n"
 "\n"
 
@@ -7847,17 +9036,17 @@ msgstr ""
 msgid "%s: cannot set limits: %s\n"
 msgstr "%s: nie można ustawić limitów: %s\n"
 
-#: .././quota/edit.c:166 .././quota/edit.c:569
+#: .././quota/edit.c:166 .././quota/edit.c:584
 #, c-format
 msgid "%s: invalid user name: %s\n"
 msgstr "%s: nieprawidłowa nazwa użytkownika: %s\n"
 
-#: .././quota/edit.c:189 .././quota/edit.c:586
+#: .././quota/edit.c:189 .././quota/edit.c:601
 #, c-format
 msgid "%s: invalid group name: %s\n"
 msgstr "%s: nieprawidłowa nazwa grupy: %s\n"
 
-#: .././quota/edit.c:212 .././quota/edit.c:603
+#: .././quota/edit.c:212 .././quota/edit.c:618
 #, c-format
 msgid "%s: invalid project name: %s\n"
 msgstr "%s: nieprawidłowa nazwa projektu: %s\n"
@@ -7882,50 +9071,54 @@ msgstr "%s: nierozpoznany argument %s\n"
 msgid "%s: cannot find any valid arguments\n"
 msgstr "%s: nie można znaleźć żadnych poprawnych argumentów\n"
 
-#: .././quota/edit.c:447
+#: .././quota/edit.c:457
 #, c-format
 msgid "%s: fopen on %s failed: %s\n"
 msgstr "%s: fopen na %s nie powiodło się: %s\n"
 
-#: .././quota/edit.c:479
+#: .././quota/edit.c:489
 #, c-format
 msgid "%s: cannot set timer: %s\n"
 msgstr "%s: nie można ustawić czasu: %s\n"
 
-#: .././quota/edit.c:553
+#: .././quota/edit.c:568
 #, c-format
 msgid "%s: cannot set warnings: %s\n"
 msgstr "%s: nie można ustawić ostrzeżeń: %s\n"
 
-#: .././quota/edit.c:689
-msgid "[-gpu] bsoft|bhard|isoft|ihard|rtbsoft|rtbhard=N -d|id|name"
-msgstr "[-gpu] bsoft|bhard|isoft|ihard|rtbsoft|rtbhard=N -d|id|nazwa"
+#: .././quota/edit.c:709
+msgid "[-g|-p|-u] bsoft|bhard|isoft|ihard|rtbsoft|rtbhard=N -d|id|name"
+msgstr "[-g|-p|-u] bsoft|bhard|isoft|ihard|rtbsoft|rtbhard=N -d|id|nazwa"
 
-#: .././quota/edit.c:690
+#: .././quota/edit.c:710
 msgid "modify quota limits"
 msgstr "zmiana limitów quot"
 
-#: .././quota/edit.c:697 .././quota/report.c:33 .././quota/report.c:647
-msgid "[-gpu] [-f file]"
-msgstr "[-gpu] [-f plik]"
+#: .././quota/edit.c:718 .././quota/report.c:33 .././quota/report.c:768
+msgid "[-g|-p|-u] [-f file]"
+msgstr "[-g|-p|-u] [-f plik]"
 
-#: .././quota/edit.c:698
+#: .././quota/edit.c:719
 msgid "restore quota limits from a backup file"
 msgstr "odtworzenie limitów quot z pliku kopii zapasowej"
 
-#: .././quota/edit.c:704 .././quota/edit.c:712
-msgid "[-bir] [-gpu] value -d|id|name"
-msgstr "[-bir] [-gpu] wartość -d|id|nazwa"
-
-#: .././quota/edit.c:705
-msgid "get/set quota enforcement timeouts"
-msgstr "pobranie/ustawienie czasu wymuszenia quot"
+#: .././quota/edit.c:726
+msgid "[-bir] [-g|-p|-u] value"
+msgstr "[-bir] [-g|-p|-u] wartość"
+
+#: .././quota/edit.c:727
+msgid "set quota enforcement timeouts"
+msgstr "ustawienie czasu wymuszenia quot"
+
+#: .././quota/edit.c:735
+msgid "[-bir] [-g|-p|-u] value -d|id|name"
+msgstr "[-bir] [-g|-p|-u] wartość -d|id|nazwa"
 
-#: .././quota/edit.c:713
+#: .././quota/edit.c:736
 msgid "get/set enforcement warning counter"
 msgstr "pobranie/ustawienie licznika ostrzeżeń"
 
-#: .././quota/free.c:29
+#: .././quota/free.c:30
 #, c-format
 msgid ""
 "\n"
@@ -7946,7 +9139,8 @@ msgstr ""
 " informacje o liczbie wolnych bloków i i-węzłów dysku\n"
 "\n"
 " To polecenie informuje o liczbie wszystkich, używanych i dostępnych bloków\n"
-" dysku. Opcjonalnie informuje o tym samym zestawie liczb dla i-węzłów i bloków\n"
+" dysku. Opcjonalnie informuje o tym samym zestawie liczb dla i-węzłów i "
+"bloków\n"
 " realtime oraz domyślnie zgłasza wszystkie znane punkty montowania systemu\n"
 " plików XFS i ścieżki quot projektów (patrz lista w poleceniu 'print').\n"
 " -b - informacje o liczbach bloków\n"
@@ -7956,103 +9150,120 @@ msgstr ""
 " -N - pominięcie nagłówka z wyjścia\n"
 "\n"
 
-#: .././quota/free.c:154
+#: .././quota/free.c:171
 #, c-format
 msgid "%s: project quota flag not set on %s\n"
 msgstr "%s: flaga quot projektu nie ustawiona dla %s\n"
 
-#: .././quota/free.c:163
+#: .././quota/free.c:180
 #, c-format
 msgid "%s: project ID %u (%s) doesn't match ID %u (%s)\n"
 msgstr "%s: ID projektu %u (%s) nie zgadza się z ID %u (%s)\n"
 
-#: .././quota/free.c:230
+#: .././quota/free.c:247
 #, c-format
 msgid "Filesystem  "
 msgstr "System plików "
 
-#: .././quota/free.c:230
+#: .././quota/free.c:247
 #, c-format
 msgid "Filesystem          "
 msgstr "System plików       "
 
-#: .././quota/free.c:233
+#: .././quota/free.c:250
 #, c-format
 msgid "   Size   Used  Avail Use%%"
 msgstr " Rozmiar  Użyto Dost. %%uż."
 
-#: .././quota/free.c:234
+#: .././quota/free.c:251
 #, c-format
 msgid " 1K-blocks       Used  Available  Use%%"
 msgstr " Bloki 1K        Użyto Dostępnych %%uż."
 
-#: .././quota/free.c:237
+#: .././quota/free.c:254
 #, c-format
 msgid " Inodes   Used   Free Use%%"
 msgstr " I-węzły  Użyto Wolne %%uż."
 
-#: .././quota/free.c:238
+#: .././quota/free.c:255
 #, c-format
 msgid "    Inodes      IUsed      IFree IUse%%"
 msgstr "   I-węzły      UżytoI     WolneI %%użI"
 
-#: .././quota/free.c:239
+#: .././quota/free.c:256
 #, c-format
 msgid " Pathname\n"
 msgstr " Ścieżka\n"
 
-#: .././quota/free.c:371
-msgid "[-bir] [-hn] [-f file]"
-msgstr "[-bir] [hn] [-f plik]"
+#: .././quota/free.c:388
+msgid "[-bir] [-hN] [-f file]"
+msgstr "[-bir] [-hN] [-f plik]"
 
-#: .././quota/free.c:372
+#: .././quota/free.c:389
 msgid "show free and used counts for blocks and inodes"
 msgstr "pokazanie liczby wolnych i zajętych bloków i i-węzłów"
 
-#: .././quota/init.c:48
+#: .././quota/init.c:49
+#, c-format
+msgid "Usage: %s [-V] [-x] [-f] [-p prog] [-c cmd]... [-d project]... [path]\n"
+msgstr ""
+"Składnia: %s [-V] [-x] [-f] [-p program] [-c polecenie]... [-d projekt]... "
+"[ścieżka]\n"
+
+#: .././quota/init.c:131
 #, c-format
-msgid "Usage: %s [-V] [-x] [-p prog] [-c cmd]... [-d project]... [path]\n"
-msgstr "Składnia: %s [-V] [-x] [-p program] [-c polecenie]... [-d projekt]... [ścieżka]\n"
+msgid "%s: command is for XFS filesystems only\n"
+msgstr "%s: polecenie jest tylko dla systemów plików XFS\n"
+
+#: .././quota/init.c:138
+#, c-format
+msgid "%s: foreign filesystem. Invoke xfs_quota with -f to enable.\n"
+msgstr ""
+"%s: obcy system plików; zby włączyć, należy uruchomić xfs_quota z opcją -f.\n"
 
 #: .././quota/path.c:39
 #, c-format
-msgid "%sFilesystem          Pathname\n"
-msgstr "%sSystem plików       Ścieżka\n"
+msgid "%s%sFilesystem          Pathname\n"
+msgstr "%s%sSystem plików       Ścieżka\n"
 
 #: .././quota/path.c:40
 msgid "      "
 msgstr "      "
 
-#: .././quota/path.c:43
+#: .././quota/path.c:41
+msgid "    "
+msgstr "    "
+
+#: .././quota/path.c:44
 #, c-format
 msgid "%c%03d%c "
 msgstr "%c%03d%c "
 
-#: .././quota/path.c:45
+#: .././quota/path.c:47
 #, c-format
 msgid "%-19s %s"
 msgstr "%-19s %s"
 
-#: .././quota/path.c:48
+#: .././quota/path.c:50
 #, c-format
 msgid " (project %u"
 msgstr " (projekt %u"
 
-#: .././quota/path.c:50
+#: .././quota/path.c:52
 #, c-format
 msgid ", %s"
 msgstr ", %s"
 
-#: .././quota/path.c:103
+#: .././quota/path.c:117
 #, c-format
 msgid "No paths are available\n"
 msgstr "Brak ścieżek\n"
 
-#: .././quota/path.c:131
+#: .././quota/path.c:145
 msgid "set current path, or show the list of paths"
 msgstr "ustawienie bieżącej ścieżki lub pokazanie listy ścieżek"
 
-#: .././quota/path.c:139
+#: .././quota/path.c:153
 msgid "list known mount points and projects"
 msgstr "wypisanie znanych punktów montowań i projektów"
 
@@ -8080,7 +9291,8 @@ msgid ""
 " Once this has been done, new files created in the tree will automatically\n"
 " be accounted to the tree based on their project identifier.  An attempt to\n"
 " create a hard link to a file in the tree will only succeed if the project\n"
-" identifier matches the project identifier for the tree.  The xfs_io utility\n"
+" identifier matches the project identifier for the tree.  The xfs_io "
+"utility\n"
 " can be used to set the project ID for an arbitrary file, but this can only\n"
 " be done by a privileged user.\n"
 "\n"
@@ -8096,22 +9308,27 @@ msgid ""
 " The -p <path> option can be used to manually specify project path without\n"
 " need to create /etc/projects file. This option can be used multiple times\n"
 " to specify multiple paths. When using this option only one projid/name can\n"
-" be specified at command line. Note that /etc/projects is also used if exists.\n"
+" be specified at command line. Note that /etc/projects is also used if "
+"exists.\n"
 "\n"
-" The -d <depth> option allows to descend at most <depth> levels of directories\n"
+" The -d <depth> option allows to descend at most <depth> levels of "
+"directories\n"
 " below the command line arguments. -d 0 means only apply the actions\n"
-" to the top level of the projects. -d -1 means no recursion limit (default).\n"
+" to the top level of the projects. -d -1 means no recursion limit "
+"(default).\n"
 "\n"
 " The /etc/projid and /etc/projects file formats are simple, and described\n"
 " on the xfs_quota man page.\n"
 "\n"
 msgstr ""
 "\n"
-" wypisanie projektów lub ustanowienie drzewa projektu do zarządzania limitami\n"
+" wypisanie projektów lub ustanowienie drzewa projektu do zarządzania "
+"limitami\n"
 "\n"
 " Przykład:\n"
 " 'project -c logfiles'\n"
-" (dopasowanie projektu 'logfiles' do katalogu i ustanowienie drzewa katalogów)\n"
+" (dopasowanie projektu 'logfiles' do katalogu i ustanowienie drzewa "
+"katalogów)\n"
 "\n"
 " Bez argumentów project wypisuje wszystkie projekty znalezione w pliku\n"
 " /etc/projects. Mechanizm quota dla projektów w XFS-ie może być używany do\n"
@@ -8119,25 +9336,34 @@ msgstr ""
 " i wszystkie pliki i podkatalogi poniżej niego (czyli drzewo) mogą być\n"
 " ograniczone do używania podzbioru miejsca dostępnego w systemie plików.\n"
 "\n"
-" Zarządzane drzewo musi być ustanowione początkowo przy użyciu opcji project -c.\n"
+" Zarządzane drzewo musi być ustanowione początkowo przy użyciu opcji project "
+"-c.\n"
 " Podana nazwa lub identyfikator projektu jest dopasowywany do jednego lub\n"
-" większej liczby drzew zdefiniowanych w /etc/projects, a następnie te drzewa są\n"
-" rekurencyjnie przechodzone w celu oznaczenia i-węzłów jako będących częścią\n"
-" tego drzewa - co ustawia flagi i-węzłów i identyfikator projektu dla każdego\n"
+" większej liczby drzew zdefiniowanych w /etc/projects, a następnie te drzewa "
+"są\n"
+" rekurencyjnie przechodzone w celu oznaczenia i-węzłów jako będących "
+"częścią\n"
+" tego drzewa - co ustawia flagi i-węzłów i identyfikator projektu dla "
+"każdego\n"
 " pliku.\n"
-" Po zrobieniu tego nowe pliki tworzone w drzewie będą automatycznie liczone jako\n"
+" Po zrobieniu tego nowe pliki tworzone w drzewie będą automatycznie liczone "
+"jako\n"
 " część drzewa o ich identyfikatorze projektu. Próba utworzenia dowiązania\n"
-" zwykłego do pliku w drzewie powiedzie się tylko jeśli identyfikator projektu\n"
+" zwykłego do pliku w drzewie powiedzie się tylko jeśli identyfikator "
+"projektu\n"
 " pasuje do identyfikatora projektu drzewa. Można użyć narzędzia xfs_io do\n"
 " ustawienia ID projektu dla dowolnego pliku, ale może tego dokonać tylko\n"
 " uprzywilejowany użytkownik.\n"
 "\n"
-" Poprzednio ustanowione drzewa można usunąć z kontroli limitów projektu poprzez\n"
-" użycie opcji -C, która rekurencyjnie przejdzie drzewo, usuwając i-węzły spod\n"
+" Poprzednio ustanowione drzewa można usunąć z kontroli limitów projektu "
+"poprzez\n"
+" użycie opcji -C, która rekurencyjnie przejdzie drzewo, usuwając i-węzły "
+"spod\n"
 " kontroli limitów projektu.\n"
 "\n"
 " Opcji -c można użyć do sprawdzenia czy drzewo zostało ustanowione - nie\n"
-" informuje o niczym jeśli drzewo jest poprawne, a w przeciwnym wypadku zgłasza\n"
+" informuje o niczym jeśli drzewo jest poprawne, a w przeciwnym wypadku "
+"zgłasza\n"
 " ścieżki i-węzłów nie mające ID projektu takiego jak reszta drzewa lub nie\n"
 " mające ustawionej flagi.\n"
 "\n"
@@ -8203,7 +9429,9 @@ msgstr "Usuwanie projektu %s (ścieżka
 
 #: .././quota/project.c:271
 #, c-format
-msgid "Processed %d (%s and cmdline) paths for project %s with recursion depth %s (%d).\n"
+msgid ""
+"Processed %d (%s and cmdline) paths for project %s with recursion depth %s "
+"(%d).\n"
 msgstr ""
 "Przetworzono %d (z %s oraz z linii poleceń) ścieżek dla projektu %s\n"
 "z ograniczeniem %s (%d)\n"
@@ -8223,8 +9451,11 @@ msgstr "plik projektów \"%s\" nie istni
 
 #: .././quota/project.c:326
 #, c-format
-msgid "%s: only one projid/name can be specified when using -p <path>, %d found.\n"
-msgstr "%s: tylko jeden id projektu/nazwa może być podana kiedy opcja -p <ścieżka> jest w użyciu. Znaleziono %d.\n"
+msgid ""
+"%s: only one projid/name can be specified when using -p <path>, %d found.\n"
+msgstr ""
+"%s: tylko jeden id projektu/nazwa może być podana kiedy opcja -p <ścieżka> "
+"jest w użyciu. Znaleziono %d.\n"
 
 #: .././quota/project.c:336
 #, c-format
@@ -8239,7 +9470,7 @@ msgstr "[-c|-s|-C| -d <poziom>|-p <ście
 msgid "check, setup or clear project quota trees"
 msgstr "sprawdzenie, ustanowienie lub usunięcie drzew projektów"
 
-#: .././quota/quot.c:55
+#: .././quota/quot.c:56
 #, c-format
 msgid ""
 "\n"
@@ -8271,8 +9502,10 @@ msgstr ""
 " -a - podsumowanie dla wszystkich punktów montowania systemów plików XFS\n"
 " -c - wyświetlenie trzech kolumn z rozmiarem plików w kilobajtach, liczbą\n"
 "      plików tego rozmiaru i sumą kilobajtów w plikach o tym lub mniejszym\n"
-"      rozmiarze. Ostatni wiersz podsumowuje pliki większe niż 500 kilobajtów.\n"
-" -v - wyświetlenie trzech kolumn zawierających liczbę kilobajtów, do których\n"
+"      rozmiarze. Ostatni wiersz podsumowuje pliki większe niż 500 "
+"kilobajtów.\n"
+" -v - wyświetlenie trzech kolumn zawierających liczbę kilobajtów, do "
+"których\n"
 "      nie było odwołań przez ostatnie 30, 60 i 90 dni.\n"
 " -g - wyświetlenie podsumowania dla grup\n"
 " -p - wyświetlenie podsumowania dla projektów\n"
@@ -8286,30 +9519,30 @@ msgstr ""
 " (opcjonalny) użytkownik/grupa/projekt może być podany za pomocą nazwy lub\n"
 " numeru (tzn. uid/gid/projid).\n"
 
-#: .././quota/quot.c:220
+#: .././quota/quot.c:221
 #, c-format
 msgid "%s (%s) %s:\n"
 msgstr "%s (%s) %s:\n"
 
-#: .././quota/quot.c:296
+#: .././quota/quot.c:297
 #, c-format
 msgid "%s (%s):\n"
 msgstr "%s (%s):\n"
 
-#: .././quota/quot.c:301 .././quota/quot.c:305
+#: .././quota/quot.c:302 .././quota/quot.c:306
 #, c-format
 msgid "%d\t%llu\t%llu\n"
 msgstr "%d\t%llu\t%llu\n"
 
-#: .././quota/quot.c:419
-msgid "[-bir] [-gpu] [-acv] [-f file]"
-msgstr "[-bir] [-gpu] [-acv] [-f plik]"
+#: .././quota/quot.c:425
+msgid "[-bir] [-g|-p|-u] [-acv] [-f file]"
+msgstr "[-bir] [-g|-p|-u] [-acv] [-f plik]"
 
-#: .././quota/quot.c:420
+#: .././quota/quot.c:426
 msgid "summarize filesystem ownership"
 msgstr "podsumowanie własności systemu plików"
 
-#: .././quota/quota.c:32
+#: .././quota/quota.c:33
 #, c-format
 msgid ""
 "\n"
@@ -8347,7 +9580,7 @@ msgstr ""
 " (opcjonalny) użytkownik/grupa/projekt może być podany za pomocą nazwy lub\n"
 " numeru (tzn. uid/gid/projid).\n"
 
-#: .././quota/quota.c:85
+#: .././quota/quota.c:86
 #, c-format
 msgid ""
 "Disk quotas for %s %s (%u)\n"
@@ -8356,65 +9589,65 @@ msgstr ""
 "Limity dyskowe (quota) dla %s %s (%u)\n"
 "System plików%s"
 
-#: .././quota/quota.c:90
+#: .././quota/quota.c:91
 #, c-format
 msgid " Blocks  Quota  Limit Warn/Time    "
 msgstr " Bloki   Quota  Limit Czas ostrz.  "
 
-#: .././quota/quota.c:91
+#: .././quota/quota.c:92
 #, c-format
 msgid "     Blocks      Quota      Limit  Warn/Time      "
 msgstr "     Bloki       Quota      Limit  Czas ostrz.    "
 
-#: .././quota/quota.c:94
+#: .././quota/quota.c:95
 #, c-format
 msgid "  Files  Quota  Limit Warn/Time    "
 msgstr "  Pliki  Quota  Limit Czas ostrz.  "
 
-#: .././quota/quota.c:95
+#: .././quota/quota.c:96
 #, c-format
 msgid "      Files      Quota      Limit  Warn/Time      "
 msgstr "      Pliki      Quota      Limit  Czas ostrz.    "
 
-#: .././quota/quota.c:98
+#: .././quota/quota.c:99
 #, c-format
 msgid "Realtime Quota  Limit Warn/Time    "
 msgstr "Realtime Quota  Limit Czas ostrz.  "
 
-#: .././quota/quota.c:99
+#: .././quota/quota.c:100
 #, c-format
 msgid "   Realtime      Quota      Limit  Warn/Time      "
 msgstr "   Realtime      Quota      Limit  Czas ostrz.    "
 
-#: .././quota/quota.c:235
+#: .././quota/quota.c:236
 #, c-format
 msgid "%s: cannot find user %s\n"
 msgstr "%s: nie można odnaleźć użytkownika %s\n"
 
-#: .././quota/quota.c:285
+#: .././quota/quota.c:286
 #, c-format
 msgid "%s: cannot find group %s\n"
 msgstr "%s: nie można odnaleźć grupy %s\n"
 
-#: .././quota/quota.c:346
+#: .././quota/quota.c:347
 #, c-format
 msgid "%s: must specify a project name/ID\n"
 msgstr "%s: należy podać nazwę/ID projektu\n"
 
-#: .././quota/quota.c:359
+#: .././quota/quota.c:360
 #, c-format
 msgid "%s: cannot find project %s\n"
 msgstr "%s: nie można odnaleźć projektu %s\n"
 
-#: .././quota/quota.c:464
-msgid "[-bir] [-gpu] [-hnNv] [-f file] [id|name]..."
-msgstr "[-bir] [-gpu] [-hnNv] [-f plik] [id|nazwa]..."
+#: .././quota/quota.c:470
+msgid "[-bir] [-g|-p|-u] [-hnNv] [-f file] [id|name]..."
+msgstr "[-bir] [-g|-p|-u] [-hnNv] [-f plik] [id|nazwa]..."
 
-#: .././quota/quota.c:465
+#: .././quota/quota.c:471
 msgid "show usage and limits"
 msgstr "pokazanie wykorzystania i limitów"
 
-#: .././quota/report.c:34 .././quota/report.c:648
+#: .././quota/report.c:34 .././quota/report.c:769
 msgid "dump quota information for backup utilities"
 msgstr "zrzucenie informacji o limitach (quota) dla narzędzi backupowych"
 
@@ -8430,7 +9663,8 @@ msgid ""
 "\n"
 msgstr ""
 "\n"
-" utworzenie pliku kopii zapasowej zawierającego informacje o limitach (quota)\n"
+" utworzenie pliku kopii zapasowej zawierającego informacje o limitach "
+"(quota)\n"
 " -g - zrzucenie limitów dla grup\n"
 " -p - zrzucenie limitów dla projektów\n"
 " -u - zrzucenie limitów dla użytkowników (domyślne)\n"
@@ -8438,10 +9672,10 @@ msgstr ""
 "\n"
 
 #: .././quota/report.c:48
-msgid "[-bir] [-gpu] [-ahntLNU] [-f file]"
-msgstr "[-bir] [-gpu] [-ahntLNU] [-f plik]"
+msgid "[-bir] [-gpu] [-ahntlLNU] [-f file]"
+msgstr "[-bir] [-gpu] [-ahntlLNU] [-f plik]"
 
-#: .././quota/report.c:49 .././quota/report.c:658
+#: .././quota/report.c:49 .././quota/report.c:779
 msgid "report filesystem quota information"
 msgstr "raportowanie informacji o limitach (quota) w systemie plików"
 
@@ -8463,6 +9697,7 @@ msgid ""
 " -t -- terse output format, hides rows which are all zero\n"
 " -L -- lower ID bound to report on\n"
 " -U -- upper ID bound to report on\n"
+" -l -- look up names for IDs in lower-upper range\n"
 " -g -- report group usage and quota information\n"
 " -p -- report project usage and quota information\n"
 " -u -- report user usage and quota information\n"
@@ -8472,15 +9707,18 @@ msgid ""
 "\n"
 msgstr ""
 "\n"
-" informacje o wykorzystanym miejscu i i-węzłach oraz limitach quota dla systemu\n"
+" informacje o wykorzystanym miejscu i i-węzłach oraz limitach quota dla "
+"systemu\n"
 " plików\n"
 "\n"
 " Przykład:\n"
 " 'report -igh'\n"
 " (raport o wykorzystaniu i-węzłów dla wszystkich grup w czytelnym formacie)\n"
 "\n"
-" To polecenie jest odpowiednikiem tradycyjnego polecenia repquota, wypisującego\n"
-" podsumowanie wykorzystania dysku i limitów dla bieżącego systemu plików lub\n"
+" To polecenie jest odpowiednikiem tradycyjnego polecenia repquota, "
+"wypisującego\n"
+" podsumowanie wykorzystania dysku i limitów dla bieżącego systemu plików "
+"lub\n"
 " wszystkich systemów plików.\n"
 " -a - informacje o wszystkich zamontowanych systemach plików z limitami\n"
 " -h - informacje w formacie czytelnym dla człowieka\n"
@@ -8489,6 +9727,7 @@ msgstr ""
 " -t - zwięzły format, ukrycie wierszy zerowych\n"
 " -L - dolna granica ID dla wypisywanych informacji\n"
 " -U - górna granica ID dla wypisywanych informacji\n"
+" -l - wyszukiwanie nazw dla identyfikatorów w przedziale dolny-górny\n"
 " -g - informacje o wykorzystanym miejscu i limitach dla grup\n"
 " -p - informacje o wykorzystanym miejscu i limitach dla projektów\n"
 " -u - informacje o wykorzystanym miejscu i limitach dla użytkowników\n"
@@ -8497,32 +9736,32 @@ msgstr ""
 " -r - tylko informacje o wykorzystanych blokach realtime\n"
 "\n"
 
-#: .././quota/report.c:228
+#: .././quota/report.c:273
 #, c-format
 msgid "%s quota on %s (%s)\n"
 msgstr "limit %s na %s (%s)\n"
 
-#: .././quota/report.c:253 .././quota/report.c:261
+#: .././quota/report.c:298 .././quota/report.c:306
 #, c-format
 msgid "  Used   Soft   Hard Warn/Grace   "
 msgstr " Użyto  Miękki Twardy Ostrzeżenie "
 
-#: .././quota/report.c:254 .././quota/report.c:262
+#: .././quota/report.c:299 .././quota/report.c:307
 #, c-format
 msgid "      Used       Soft       Hard    Warn/Grace     "
 msgstr "     Użyto      Miękki     Twardy   Ostrzeżenie    "
 
-#: .././quota/report.c:257
+#: .././quota/report.c:302
 #, c-format
 msgid "  Used   Soft   Hard Warn/Grace  "
 msgstr " Użyto  Miękki Twardy Ostrzeżenie"
 
-#: .././quota/report.c:258
+#: .././quota/report.c:303
 #, c-format
 msgid "      Used       Soft       Hard    Warn/ Grace     "
 msgstr "     Użyto      Miękki     Twardy   Ostrzeżenie     "
 
-#: .././quota/report.c:657
+#: .././quota/report.c:778
 msgid "[-bir] [-gpu] [-ahnt] [-f file]"
 msgstr "[-bir] [-gpu] [-ahnt] [-f plik]"
 
@@ -8554,7 +9793,7 @@ msgstr ""
 " 'off -uv'  (wyłączenie limitów użytkownika w bieżącym systemie plików)\n"
 "\n"
 " To polecenie jest odpowiednikiem tradycyjnego polecenia quotaoff,\n"
-" wyłączającego całkowicie limity na podmontowanym systemie plików.\n"
+" wyłączającego całkowicie limity na zamontowanym systemie plików.\n"
 " Należy zauważyć, że nie ma polecenia 'on' - dla systemów plików XFS\n"
 " (z wyjątkiem głównego systemu plików pod systemem IRIX) limity można\n"
 " włączyć wyłącznie na etapie montowania, poprzez użycie jednej z opcji\n"
@@ -8589,8 +9828,10 @@ msgstr ""
 " jest rozliczanie i/lub wymuszanie limitów w systemie plików, które i-węzły\n"
 " są wykorzystywane jako i-węzły stanu quot oraz ile ekstentów i bloków jest\n"
 " aktualnie używana do przechowywania tych informacji.\n"
-" Rodzaj limitów podaje się opcją -g (grupy), -p (projekty) lub -u (użytkownicy);\n"
-" domyślnie polecenie dotyczy limitów użytkowników (można podać wiele rodzajów).\n"
+" Rodzaj limitów podaje się opcją -g (grupy), -p (projekty) lub -u "
+"(użytkownicy);\n"
+" domyślnie polecenie dotyczy limitów użytkowników (można podać wiele "
+"rodzajów).\n"
 "\n"
 
 #: .././quota/state.c:72
@@ -8610,12 +9851,14 @@ msgstr ""
 "\n"
 " włączenie wymuszania limitów w systemie plików\n"
 "\n"
-" Jeśli system plików jest podmontowany i ma włączone rozliczanie limitów,\n"
+" Jeśli system plików jest zamontowany i ma włączone rozliczanie limitów,\n"
 " ale nie ma wymuszania limitów, można włączyć wymuszanie tym poleceniem.\n"
 " Z opcją -v (szczegółowość) po zakończeniu operacji zostanie zraportowany\n"
 " stan systemu plików.\n"
-" Rodzaj limitów podaje się opcją -g (grupy), -p (projekty) lub -u (użytkownicy);\n"
-" domyślnie polecenie dotyczy limitów użytkowników (można podać wiele rodzajów).\n"
+" Rodzaj limitów podaje się opcją -g (grupy), -p (projekty) lub -u "
+"(użytkownicy);\n"
+" domyślnie polecenie dotyczy limitów użytkowników (można podać wiele "
+"rodzajów).\n"
 "\n"
 
 #: .././quota/state.c:88
@@ -8633,10 +9876,11 @@ msgstr ""
 "\n"
 " wyłączenie wymuszania limitów w systemie plików\n"
 "\n"
-" Jeśli system plików jest podmontowany i aktualnie wymusza przestrzeganie\n"
+" Jeśli system plików jest zamontowany i aktualnie wymusza przestrzeganie\n"
 " limitów, tym poleceniem można wyłączyć wymuszanie, ale nadal pozostawić\n"
 " rozliczanie wykorzystanego miejsca (oraz i-węzłów).\n"
-" Rodzaj limitów podaje się opcją -g (grupy), -p (projekty) lub -u (użytkownicy).\n"
+" Rodzaj limitów podaje się opcją -g (grupy), -p (projekty) lub -u "
+"(użytkownicy).\n"
 "\n"
 
 #: .././quota/state.c:102
@@ -8654,10 +9898,13 @@ msgstr ""
 "\n"
 " zwolnienie miejsca zajmowanego przez podsystem quota\n"
 "\n"
-" Po wyłączeniu limitów dla systemu plików można tym poleceniem zwolnić miejsce\n"
+" Po wyłączeniu limitów dla systemu plików można tym poleceniem zwolnić "
+"miejsce\n"
 " przydzielone na przechowywanie metadanych quot.\n"
-" Rodzaj limitów podaje się opcją -g (grupy), -p (projekty) lub -u (użytkownicy);\n"
-" domyślnie polecenie dotyczy limitów użytkowników (można podać wiele rodzajów).\n"
+" Rodzaj limitów podaje się opcją -g (grupy), -p (projekty) lub -u "
+"(użytkownicy);\n"
+" domyślnie polecenie dotyczy limitów użytkowników (można podać wiele "
+"rodzajów).\n"
 "\n"
 
 #: .././quota/state.c:121
@@ -8698,99 +9945,99 @@ msgstr "  I-węzeł: N/A\n"
 msgid "%s grace time: %s\n"
 msgstr "czas pobłażliwości %s: %s\n"
 
-#: .././quota/state.c:157
+#: .././quota/state.c:212
 #, c-format
 msgid "%s quota are not enabled on %s\n"
 msgstr "Limity %s nie są włączone na %s\n"
 
-#: .././quota/state.c:527 .././quota/state.c:543 .././quota/state.c:551
-#: .././quota/state.c:559
+#: .././quota/state.c:584 .././quota/state.c:601 .././quota/state.c:609
+#: .././quota/state.c:617
 msgid "[-gpu] [-v]"
 msgstr "[-gpu] [-v]"
 
-#: .././quota/state.c:528
+#: .././quota/state.c:585
 msgid "permanently switch quota off for a path"
 msgstr "wyłączenie limitów na stałe dla ścieżki"
 
-#: .././quota/state.c:535
+#: .././quota/state.c:592
 msgid "[-gpu] [-a] [-v] [-f file]"
 msgstr "[-gpu] [-a] [-v] [-f plik]"
 
-#: .././quota/state.c:536
+#: .././quota/state.c:593
 msgid "get overall quota state information"
 msgstr "uzyskanie ogólnych informacji o stanie quot"
 
-#: .././quota/state.c:544
+#: .././quota/state.c:602
 msgid "enable quota enforcement"
 msgstr "włączenie wymuszania limitów"
 
-#: .././quota/state.c:552
+#: .././quota/state.c:610
 msgid "disable quota enforcement"
 msgstr "wyłączenie wymuszania limitów"
 
-#: .././quota/state.c:560
+#: .././quota/state.c:618
 msgid "remove quota extents from a filesystem"
 msgstr "usunięcie ekstentów związanych z limitami z systemu plików"
 
-#: .././quota/util.c:59
+#: .././quota/util.c:70
 #, c-format
 msgid "[-none-]"
 msgstr "[-brak-]"
 
-#: .././quota/util.c:59
+#: .././quota/util.c:70
 #, c-format
 msgid "[--none--]"
 msgstr "[--brak--]"
 
-#: .././quota/util.c:62
+#: .././quota/util.c:73
 #, c-format
 msgid "[------]"
 msgstr "[------]"
 
-#: .././quota/util.c:62
+#: .././quota/util.c:73
 #, c-format
 msgid "[--------]"
 msgstr "[--------]"
 
 # XXX: ngettext()
-#: .././quota/util.c:66 .././quota/util.c:69
+#: .././quota/util.c:77 .././quota/util.c:80
 msgid "day"
 msgstr "dzień"
 
-#: .././quota/util.c:66 .././quota/util.c:69
+#: .././quota/util.c:77 .././quota/util.c:80
 msgid "days"
 msgstr "dni"
 
-#: .././quota/util.c:194
+#: .././quota/util.c:205
 msgid "Blocks"
 msgstr "Bloki"
 
-#: .././quota/util.c:194
+#: .././quota/util.c:205
 msgid "Inodes"
 msgstr "I-węzły"
 
-#: .././quota/util.c:194
+#: .././quota/util.c:205
 msgid "Realtime Blocks"
 msgstr "Bloki realtime"
 
-#: .././quota/util.c:209
+#: .././quota/util.c:220
 msgid "User"
 msgstr "użytkowników"
 
-#: .././quota/util.c:209
+#: .././quota/util.c:220
 msgid "Group"
 msgstr "grup"
 
-#: .././quota/util.c:209
+#: .././quota/util.c:220
 msgid "Project"
 msgstr "projektów"
 
-#: .././quota/util.c:417
+#: .././quota/util.c:428
 #, c-format
 msgid "%s: open on %s failed: %s\n"
 msgstr "%s: open dla %s nie powiodło się: %s\n"
 
-#: .././quota/util.c:423
+#: .././quota/util.c:434
 #, c-format
 msgid "%s: fdopen on %s failed: %s\n"
 msgstr "%s: fdopen dla %s nie powiodło się: %s\n"
@@ -8835,84 +10082,79 @@ msgstr "fllast %d w agf %d zbyt duże (m
 msgid "bad uuid %s for agf %d\n"
 msgstr "błędny uuid %s dla agf %d\n"
 
-#: .././repair/agheader.c:138
+#: .././repair/agheader.c:139
 #, c-format
 msgid "bad magic # 0x%x for agi %d\n"
 msgstr "błędna liczba magiczna 0x%x dla agi %d\n"
 
-#: .././repair/agheader.c:147
+#: .././repair/agheader.c:148
 #, c-format
 msgid "bad version # %d for agi %d\n"
 msgstr "błędny numer wersji %d dla agi %d\n"
 
-#: .././repair/agheader.c:156
+#: .././repair/agheader.c:157
 #, c-format
 msgid "bad sequence # %d for agi %d\n"
 msgstr "błędny numer sekwencji %d dla agi %d\n"
 
-#: .././repair/agheader.c:166
+#: .././repair/agheader.c:167
 #, c-format
 msgid "bad length # %d for agi %d, should be %d\n"
 msgstr "błędna długość %d dla agi %d, powinno być %d\n"
 
-#: .././repair/agheader.c:179
+#: .././repair/agheader.c:180
 #, c-format
 msgid "bad length # %d for agi %d, should be %<PRIu64>\n"
 msgstr "błędna długość %d dla agi %d, powinno być %<PRIu64>\n"
 
-#: .././repair/agheader.c:198
+#: .././repair/agheader.c:199
 #, c-format
 msgid "bad uuid %s for agi %d\n"
 msgstr "błędny uuid %s dla agi %d\n"
 
-#: .././repair/agheader.c:302
+#: .././repair/agheader.c:305
 #, c-format
 msgid "zeroing unused portion of %s superblock (AG #%u)\n"
 msgstr "zerowanie nieużywanej części superbloku %s (AG #%u)\n"
 
-#: .././repair/agheader.c:303 .././repair/agheader.c:318
+#: .././repair/agheader.c:306 .././repair/agheader.c:324
 msgid "primary"
 msgstr "głównego"
 
-#: .././repair/agheader.c:303 .././repair/agheader.c:318
+#: .././repair/agheader.c:306 .././repair/agheader.c:324
 msgid "secondary"
 msgstr "zapasowego"
 
-#: .././repair/agheader.c:317
+#: .././repair/agheader.c:323
 #, c-format
 msgid "would zero unused portion of %s superblock (AG #%u)\n"
 msgstr "nieużywana część superbloku %s (AG #%u) zostałaby wyzerowana\n"
 
-#: .././repair/agheader.c:335
+#: .././repair/agheader.c:341
 #, c-format
 msgid "bad flags field in superblock %d\n"
 msgstr "błędne pole flag w superbloku %d\n"
 
-#: .././repair/agheader.c:358
+#: .././repair/agheader.c:364
 #, c-format
 msgid "non-null user quota inode field in superblock %d\n"
 msgstr "niezerowe pole i-węzła limitów użytkowników w superbloku %d\n"
 
-#: .././repair/agheader.c:373
+#: .././repair/agheader.c:379
 #, c-format
 msgid "non-null group quota inode field in superblock %d\n"
 msgstr "niezerowe pole i-węzła limitów grup w superbloku %d\n"
 
-#: .././repair/agheader.c:388
+#: .././repair/agheader.c:400
 #, c-format
 msgid "non-null project quota inode field in superblock %d\n"
 msgstr "niezerowe pole i-węzła limitów projektu w superbloku %d\n"
 
-#: .././repair/agheader.c:400
+#: .././repair/agheader.c:412
 #, c-format
 msgid "non-null quota flags in superblock %d\n"
 msgstr "niezerowe flagi limitów w superbloku %d\n"
 
-#: .././repair/agheader.c:418
-#, c-format
-msgid "bad shared version number in superblock %d\n"
-msgstr "błędny numer wersji dzielonej w superbloku %d\n"
-
 #: .././repair/agheader.c:430
 #, c-format
 msgid "bad inode alignment field in superblock %d\n"
@@ -8938,392 +10180,364 @@ msgstr "błędny superblok %d na dysku -
 msgid "primary/secondary superblock %d conflict - %s\n"
 msgstr "konflikt głównego/zapasowego superbloku %d - %s\n"
 
-#: .././repair/attr_repair.c:110
+#: .././repair/attr_repair.c:70
 #, c-format
 msgid "bad range claimed [%d, %d) in da block\n"
 msgstr "błędny przedział [%d, %d) przypisany w bloku da\n"
 
-#: .././repair/attr_repair.c:117
+#: .././repair/attr_repair.c:77
 #, c-format
 msgid "byte range end [%d %d) in da block larger than blocksize %d\n"
-msgstr "koniec przedziału bajtów [%d %d) w bloku da większy niż rozmiar bloku %d\n"
+msgstr ""
+"koniec przedziału bajtów [%d %d) w bloku da większy niż rozmiar bloku %d\n"
 
-#: .././repair/attr_repair.c:124
+#: .././repair/attr_repair.c:84
 #, c-format
 msgid "multiply claimed byte %d in da block\n"
 msgstr "wielokrotnie użyty bajt %d w bloku da\n"
 
-#: .././repair/attr_repair.c:177
-#, c-format
-msgid "can't read block %u (fsbno %<PRIu64>) for directory inode %<PRIu64>\n"
-msgstr "nie można odczytać bloku %u (fsbno %<PRIu64>) dla i-węzła katalogu %<PRIu64>\n"
-
-#: .././repair/attr_repair.c:181
-#, c-format
-msgid "can't read block %u (fsbno %<PRIu64>) for attrbute fork of inode %<PRIu64>\n"
-msgstr "nie można odczytać bloku %u (fsbno %<PRIu64>) dla gałęzi atrybutów i-węzła %<PRIu64>\n"
-
-#: .././repair/attr_repair.c:192
-#, c-format
-msgid "bad dir/attr magic number in inode %<PRIu64>, file bno = %u, fsbno = %<PRIu64>\n"
-msgstr "błędna liczba magiczna katalogu/atrybutu w i-węźle %<PRIu64>, bno pliku = %u, fsbno = %<PRIu64>\n"
-
-#: .././repair/attr_repair.c:200 .././repair/dir2.c:205
-#, c-format
-msgid "bad record count in inode %<PRIu64>, count = %d, max = %d\n"
-msgstr "błędna liczba rekordów w i-węźle %<PRIu64>, liczba = %d, maksimum = %d\n"
-
-#: .././repair/attr_repair.c:219 .././repair/dir2.c:229
-#, c-format
-msgid "bad directory btree for directory inode %<PRIu64>\n"
-msgstr "błędne b-drzewo katalogu dla i-węzła katalogu %<PRIu64>\n"
-
-#: .././repair/attr_repair.c:223
-#, c-format
-msgid "bad attribute fork btree for inode %<PRIu64>\n"
-msgstr "błędne b-drzewo gałęzi atrybutów dla i-węzła %<PRIu64>\n"
-
-#: .././repair/attr_repair.c:276
-#, c-format
-msgid "release_da_cursor_int got unexpected non-null bp, dabno = %u\n"
-msgstr "release_da_cursor_int otrzymało nieoczekiwany niepusty bp, dabno = %u\n"
-
-#: .././repair/attr_repair.c:348
-#, c-format
-msgid "directory/attribute block used/count inconsistency - %d/%hu\n"
-msgstr "niespójność wartości used/count bloku katalogu/atrybutu - %d/%hu\n"
-
-#: .././repair/attr_repair.c:358 .././repair/dir2.c:354
-#, c-format
-msgid "directory/attribute block hashvalue inconsistency, expected > %u / saw %u\n"
-msgstr "niespójność wartości hasza bloku katalogu/atrybutu - oczekiwano > %u, widziano %u\n"
-
-#: .././repair/attr_repair.c:365 .././repair/dir2.c:361
-#, c-format
-msgid "bad directory/attribute forward block pointer, expected 0, saw %u\n"
-msgstr "błędny wskaźnik bloku w przód katalogu/atrybutu - oczekiwano 0, widziano %u\n"
-
-#: .././repair/attr_repair.c:371
-#, c-format
-msgid "bad directory block in dir ino %<PRIu64>\n"
-msgstr "błędny blok katalogu w i-węźle katalogu %<PRIu64>\n"
-
-#: .././repair/attr_repair.c:399
-#, c-format
-msgid ""
-"correcting bad hashval in non-leaf dir/attr block\n"
-"\tin (level %d) in inode %<PRIu64>.\n"
-msgstr ""
-"poprawiono błędne hashval w bloku katalogu/atrybutu nie będącego liściem\n"
-"\tw i-węźle (poziomu %d) %<PRIu64>.\n"
-
-#: .././repair/attr_repair.c:407
-#, c-format
-msgid ""
-"would correct bad hashval in non-leaf dir/attr block\n"
-"\tin (level %d) in inode %<PRIu64>.\n"
-msgstr ""
-"błędne hashval zostałoby poprawione w bloku katalogu/atrybutu nie będącego liściem\n"
-"\tw i-węźle (poziomu %d) %<PRIu64>.\n"
-
-#: .././repair/attr_repair.c:549 .././repair/dir2.c:530
-#, c-format
-msgid "can't get map info for block %u of directory inode %<PRIu64>\n"
-msgstr "nie można uzyskać informacji o mapie dla bloku %u i-węzła katalogu %<PRIu64>\n"
-
-#: .././repair/attr_repair.c:559
-#, c-format
-msgid "can't read block %u (%<PRIu64>) for directory inode %<PRIu64>\n"
-msgstr "nie można odczytać bloku %u (%<PRIu64>) dla i-węzła katalogu %<PRIu64>\n"
-
-#: .././repair/attr_repair.c:575
-#, c-format
-msgid "bad magic number %x in block %u (%<PRIu64>) for directory inode %<PRIu64>\n"
-msgstr "błędna liczba magiczna %x w bloku %u (%<PRIu64>) dla i-węzła katalogu %<PRIu64>\n"
-
-#: .././repair/attr_repair.c:582
-#, c-format
-msgid "bad back pointer in block %u (%<PRIu64>) for directory inode %<PRIu64>\n"
-msgstr "błędny wskaźnik wstecz w bloku %u (%<PRIu64>) dla i-węzła katalogu %<PRIu64>\n"
-
-#: .././repair/attr_repair.c:588
-#, c-format
-msgid "entry count %d too large in block %u (%<PRIu64>) for directory inode %<PRIu64>\n"
-msgstr "liczba wpisów %d zbyt duża w bloku %u (%<PRIu64>) dla i-węzła katalogu %<PRIu64>\n"
-
-#: .././repair/attr_repair.c:595
-#, c-format
-msgid "bad level %d in block %u (%<PRIu64>) for directory inode %<PRIu64>\n"
-msgstr "błędny poziom %d w bloku %u (%<PRIu64>) dla i-węzła katalogu %<PRIu64>\n"
-
-#: .././repair/attr_repair.c:660
-#, c-format
-msgid ""
-"correcting bad hashval in interior dir/attr block\n"
-"\tin (level %d) in inode %<PRIu64>.\n"
-msgstr ""
-"poprawiono błędne hashval w wewnętrznym bloku katalogu/atrybutu\n"
-"\tw i-węźle (poziomu %d) %<PRIu64>.\n"
-
-#: .././repair/attr_repair.c:668
-#, c-format
-msgid ""
-"would correct bad hashval in interior dir/attr block\n"
-"\tin (level %d) in inode %<PRIu64>.\n"
-msgstr ""
-"błędne hashval zostałoby poprawione w wewnętrznym bloku katalogu/atrybutu\n"
-"\tw i-węźle (poziomu %d) %<PRIu64>.\n"
-
-#: .././repair/attr_repair.c:755
+#: .././repair/attr_repair.c:164
 msgid "No memory for ACL check!\n"
 msgstr "Brak pamięci na sprawdzenie ACL!\n"
 
-#: .././repair/attr_repair.c:763
-msgid "entry contains illegal value in attribute named SGI_ACL_FILE or SGI_ACL_DEFAULT\n"
-msgstr "wpis zawiera niedozwoloną wartość w atrybucie SGI_ACL_FILE lub SGI_ACL_DEFAULT\n"
+#: .././repair/attr_repair.c:172
+msgid ""
+"entry contains illegal value in attribute named SGI_ACL_FILE or "
+"SGI_ACL_DEFAULT\n"
+msgstr ""
+"wpis zawiera niedozwoloną wartość w atrybucie SGI_ACL_FILE lub "
+"SGI_ACL_DEFAULT\n"
 
-#: .././repair/attr_repair.c:789
+#: .././repair/attr_repair.c:198
 msgid "entry contains illegal value in attribute named SGI_MAC_LABEL\n"
 msgstr "wpis zawiera niedozwoloną wartość w atrybucie SGI_MAC_LABEL\n"
 
-#: .././repair/attr_repair.c:795
+#: .././repair/attr_repair.c:204
 msgid "entry contains illegal value in attribute named SGI_CAP_FILE\n"
 msgstr "wpis zawiera niedozwoloną wartość w atrybucie SGI_CAP_FILE\n"
 
-#: .././repair/attr_repair.c:835
+#: .././repair/attr_repair.c:244
 #, c-format
 msgid "there are no attributes in the fork for inode %<PRIu64>\n"
 msgstr "nie ma atrybutów w gałęzi dla i-węzła %<PRIu64>\n"
 
-#: .././repair/attr_repair.c:843
+#: .././repair/attr_repair.c:252
 #, c-format
 msgid "would junk the attribute fork since count is 0 for inode %<PRIu64>\n"
-msgstr "gałąź atrybutów zostałaby usunięta ponieważ licznik wynosi 0 dla i-węzła %<PRIu64>\n"
+msgstr ""
+"gałąź atrybutów zostałaby usunięta ponieważ licznik wynosi 0 dla i-węzła "
+"%<PRIu64>\n"
 
-#: .././repair/attr_repair.c:863
+#: .././repair/attr_repair.c:272
 msgid "zero length name entry in attribute fork,"
 msgstr "wpis nazwy zerowej długości w gałęzi atrybutów,"
 
-#: .././repair/attr_repair.c:866 .././repair/attr_repair.c:886
+#: .././repair/attr_repair.c:275 .././repair/attr_repair.c:295
 #, c-format
 msgid " truncating attributes for inode %<PRIu64> to %d\n"
 msgstr " ucięto atrybuty dla i-węzła %<PRIu64> do %d\n"
 
-#: .././repair/attr_repair.c:871 .././repair/attr_repair.c:892
+#: .././repair/attr_repair.c:280 .././repair/attr_repair.c:301
 #, c-format
 msgid " would truncate attributes for inode %<PRIu64> to %d\n"
 msgstr " atrybuty dla i-węzła %<PRIu64> zostałyby ucięte do %d\n"
 
-#: .././repair/attr_repair.c:883
+#: .././repair/attr_repair.c:292
 msgid "name or value attribute lengths are too large,\n"
 msgstr "długości nazwy lub wartości atrybutów są zbyt duże,\n"
 
-#: .././repair/attr_repair.c:905
+#: .././repair/attr_repair.c:314
 msgid "entry contains illegal character in shortform attribute name\n"
 msgstr "wpis zawiera niedozwolony znak w nazwie atrybutu krótkiego\n"
 
-#: .././repair/attr_repair.c:911
+#: .././repair/attr_repair.c:320
 msgid "entry has INCOMPLETE flag on in shortform attribute\n"
 msgstr "wpis ma flagę NIEPEŁNY w atrybucie krótkim\n"
 
-#: .././repair/attr_repair.c:928
+#: .././repair/attr_repair.c:338
 #, c-format
 msgid "removing attribute entry %d for inode %<PRIu64>\n"
 msgstr "usunięto wpis atrybutu %d dla i-węzła %<PRIu64>\n"
 
-#: .././repair/attr_repair.c:940
+#: .././repair/attr_repair.c:350
 #, c-format
 msgid "would remove attribute entry %d for inode %<PRIu64>\n"
 msgstr "wpis atrybutu %d dla i-węzła %<PRIu64> zostałby usunięty\n"
 
-#: .././repair/attr_repair.c:955
+#: .././repair/attr_repair.c:365
 #, c-format
-msgid "would have corrected attribute entry count in inode %<PRIu64> from %d to %d\n"
-msgstr "liczba wpisów atrybutów w i-węźle %<PRIu64> zostałaby poprawiona z %d na %d\n"
+msgid ""
+"would have corrected attribute entry count in inode %<PRIu64> from %d to %d\n"
+msgstr ""
+"liczba wpisów atrybutów w i-węźle %<PRIu64> zostałaby poprawiona z %d na %d\n"
 
-#: .././repair/attr_repair.c:959
+#: .././repair/attr_repair.c:369
 #, c-format
 msgid "corrected attribute entry count in inode %<PRIu64>, was %d, now %d\n"
-msgstr "poprawiono liczbę wpisów atrybutów w i-węźle %<PRIu64> - było %d, jest %d\n"
+msgstr ""
+"poprawiono liczbę wpisów atrybutów w i-węźle %<PRIu64> - było %d, jest %d\n"
 
-#: .././repair/attr_repair.c:970
+#: .././repair/attr_repair.c:380
 #, c-format
-msgid "would have corrected attribute totsize in inode %<PRIu64> from %d to %d\n"
+msgid ""
+"would have corrected attribute totsize in inode %<PRIu64> from %d to %d\n"
 msgstr "totsize atrybutów w i-węźle %<PRIu64> zostałby poprawiony z %d na %d\n"
 
-#: .././repair/attr_repair.c:975
+#: .././repair/attr_repair.c:385
 #, c-format
 msgid "corrected attribute entry totsize in inode %<PRIu64>, was %d, now %d\n"
-msgstr "poprawiono totsize wpisu atrybutów w i-węźle %<PRIu64> - było %d, jest %d\n"
+msgstr ""
+"poprawiono totsize wpisu atrybutów w i-węźle %<PRIu64> - było %d, jest %d\n"
 
-#: .././repair/attr_repair.c:1009
+#: .././repair/attr_repair.c:419
 #, c-format
 msgid "remote block for attributes of inode %<PRIu64> is missing\n"
 msgstr "brak odległego bloku dla atrybutów i-węzła %<PRIu64>\n"
 
-#: .././repair/attr_repair.c:1018
+#: .././repair/attr_repair.c:428
 #, c-format
 msgid "can't read remote block for attributes of inode %<PRIu64>\n"
 msgstr "nie można odczytać odległego bloku dla atrybutów i-węzła %<PRIu64>\n"
 
-#: .././repair/attr_repair.c:1025
+#: .././repair/attr_repair.c:435
 #, c-format
 msgid "Corrupt remote block for attributes of inode %<PRIu64>\n"
 msgstr "Uszkodzony odległy blok dla atrybutów i-węzła %<PRIu64>\n"
 
-#: .././repair/attr_repair.c:1066
+#: .././repair/attr_repair.c:476
 #, c-format
-msgid "attribute entry %d in attr block %u, inode %<PRIu64> has bad name (namelen = %d)\n"
-msgstr "wpis atrybutu %d w bloku atrybutów %u, i-węźle %<PRIu64> ma błędną nazwę (namelen = %d)\n"
+msgid ""
+"attribute entry %d in attr block %u, inode %<PRIu64> has bad name (namelen = "
+"%d)\n"
+msgstr ""
+"wpis atrybutu %d w bloku atrybutów %u, i-węźle %<PRIu64> ma błędną nazwę "
+"(namelen = %d)\n"
 
-#: .././repair/attr_repair.c:1083
+#: .././repair/attr_repair.c:493
 #, c-format
-msgid "bad hashvalue for attribute entry %d in attr block %u, inode %<PRIu64>\n"
-msgstr "błędna wartość hasza dla wpisu atrybutu %d w bloku atrybutów %u, i-węźle %<PRIu64>\n"
+msgid ""
+"bad hashvalue for attribute entry %d in attr block %u, inode %<PRIu64>\n"
+msgstr ""
+"błędna wartość hasza dla wpisu atrybutu %d w bloku atrybutów %u, i-węźle "
+"%<PRIu64>\n"
 
-#: .././repair/attr_repair.c:1093
+#: .././repair/attr_repair.c:503
 #, c-format
-msgid "bad security value for attribute entry %d in attr block %u, inode %<PRIu64>\n"
-msgstr "błędna wartość bezpieczeństwa dla wpisu atrybutu %d w bloku atrybutów %u, i-węźle %<PRIu64>\n"
+msgid ""
+"bad security value for attribute entry %d in attr block %u, inode %<PRIu64>\n"
+msgstr ""
+"błędna wartość bezpieczeństwa dla wpisu atrybutu %d w bloku atrybutów %u, i-"
+"węźle %<PRIu64>\n"
 
-#: .././repair/attr_repair.c:1126
+#: .././repair/attr_repair.c:536
 #, c-format
-msgid "inconsistent remote attribute entry %d in attr block %u, ino %<PRIu64>\n"
-msgstr "niespójny wpis odległego atrybutu %d w bloku atrybutów %u, i-węźle %<PRIu64>\n"
+msgid ""
+"inconsistent remote attribute entry %d in attr block %u, ino %<PRIu64>\n"
+msgstr ""
+"niespójny wpis odległego atrybutu %d w bloku atrybutów %u, i-węźle "
+"%<PRIu64>\n"
 
-#: .././repair/attr_repair.c:1136
+#: .././repair/attr_repair.c:546
 #, c-format
 msgid "cannot malloc enough for remotevalue attribute for inode %<PRIu64>\n"
-msgstr "nie można przydzielić wystarczająco dużo dla atrybutu remotevalue dla i-węzła %<PRIu64>\n"
+msgstr ""
+"nie można przydzielić wystarczająco dużo dla atrybutu remotevalue dla i-"
+"węzła %<PRIu64>\n"
 
-#: .././repair/attr_repair.c:1138
+#: .././repair/attr_repair.c:548
 msgid "SKIPPING this remote attribute\n"
 msgstr "POMINIĘTO ten atrybut odległy\n"
 
-#: .././repair/attr_repair.c:1144
+#: .././repair/attr_repair.c:554
 #, c-format
 msgid "remote attribute get failed for entry %d, inode %<PRIu64>\n"
-msgstr "pobranie odległego atrybutu nie powiodło się dla wpisu %d, i-węzła %<PRIu64>\n"
+msgstr ""
+"pobranie odległego atrybutu nie powiodło się dla wpisu %d, i-węzła "
+"%<PRIu64>\n"
 
-#: .././repair/attr_repair.c:1151
+#: .././repair/attr_repair.c:561
 #, c-format
 msgid "remote attribute value check failed for entry %d, inode %<PRIu64>\n"
-msgstr "sprawdzenie wartości odległego atrybutu nie powiodło się dla wpisu %d, i-węzła %<PRIu64>\n"
+msgstr ""
+"sprawdzenie wartości odległego atrybutu nie powiodło się dla wpisu %d, i-"
+"węzła %<PRIu64>\n"
 
-#: .././repair/attr_repair.c:1189
+#: .././repair/attr_repair.c:600
 #, c-format
 msgid "bad attribute count %d in attr block %u, inode %<PRIu64>\n"
 msgstr "błędna liczba atrybutów %d w bloku atrybutów %u, i-węźle %<PRIu64>\n"
 
-#: .././repair/attr_repair.c:1204
+#: .././repair/attr_repair.c:615
 #, c-format
 msgid "bad attribute nameidx %d in attr block %u, inode %<PRIu64>\n"
 msgstr "błędny nameidx atrybutu %d w bloku atrybutów %u, i-węźle %<PRIu64>\n"
 
-#: .././repair/attr_repair.c:1213
+#: .././repair/attr_repair.c:624
 #, c-format
 msgid "attribute entry #%d in attr block %u, inode %<PRIu64> is INCOMPLETE\n"
-msgstr "wpis atrybutu #%d w bloku atrybutów %u, i-węźle %<PRIu64> jest NIEPEŁNY\n"
+msgstr ""
+"wpis atrybutu #%d w bloku atrybutów %u, i-węźle %<PRIu64> jest NIEPEŁNY\n"
+
+#: .././repair/attr_repair.c:635
+#, c-format
+msgid ""
+"attribute entry %d in attr block %u, inode %<PRIu64> claims already used "
+"space\n"
+msgstr ""
+"wpis atrybutu %d w bloku atrybutów %u, i-węźle %<PRIu64> odwołuje się do już "
+"użytego miejsca\n"
 
-#: .././repair/attr_repair.c:1224
+#: .././repair/attr_repair.c:658
 #, c-format
-msgid "attribute entry %d in attr block %u, inode %<PRIu64> claims already used space\n"
-msgstr "wpis atrybutu %d w bloku atrybutów %u, i-węźle %<PRIu64> odwołuje się do już użytego miejsca\n"
+msgid ""
+"attribute entry %d in attr block %u, inode %<PRIu64> claims used space\n"
+msgstr ""
+"wpis atrybutu %d w bloku atrybutów %u, i-węźle %<PRIu64> odwołuje się do "
+"używanego miejsca\n"
 
-#: .././repair/attr_repair.c:1247
+#: .././repair/attr_repair.c:682
 #, c-format
-msgid "attribute entry %d in attr block %u, inode %<PRIu64> claims used space\n"
-msgstr "wpis atrybutu %d w bloku atrybutów %u, i-węźle %<PRIu64> odwołuje się do używanego miejsca\n"
+msgid ""
+"- resetting first used heap value from %d to %d in block %u of attribute "
+"fork of inode %<PRIu64>\n"
+msgstr ""
+"- przestawiono pierwszą używaną wartość sterty z %d na %d w bloku %u gałęzi "
+"atrybutów i-węzła %<PRIu64>\n"
 
-#: .././repair/attr_repair.c:1271
+#: .././repair/attr_repair.c:690
 #, c-format
-msgid "- resetting first used heap value from %d to %d in block %u of attribute fork of inode %<PRIu64>\n"
-msgstr "- przestawiono pierwszą używaną wartość sterty z %d na %d w bloku %u gałęzi atrybutów i-węzła %<PRIu64>\n"
+msgid ""
+"- would reset first used value from %d to %d in block %u of attribute fork "
+"of inode %<PRIu64>\n"
+msgstr ""
+"- pierwsza używana wartość zostałaby przestawiona z %d na %d w bloku %u "
+"gałęzi atrybutów i-węzła %<PRIu64>\n"
 
-#: .././repair/attr_repair.c:1279
+#: .././repair/attr_repair.c:700
 #, c-format
-msgid "- would reset first used value from %d to %d in block %u of attribute fork of inode %<PRIu64>\n"
-msgstr "- pierwsza używana wartość zostałaby przestawiona z %d na %d w bloku %u gałęzi atrybutów i-węzła %<PRIu64>\n"
+msgid ""
+"- resetting usedbytes cnt from %d to %d in block %u of attribute fork of "
+"inode %<PRIu64>\n"
+msgstr ""
+"- przestawiono liczbę użytych bajtów z %d na %d w bloku %u gałęzi atrybutów "
+"i-węzła %<PRIu64>\n"
 
-#: .././repair/attr_repair.c:1289
+#: .././repair/attr_repair.c:708
 #, c-format
-msgid "- resetting usedbytes cnt from %d to %d in block %u of attribute fork of inode %<PRIu64>\n"
-msgstr "- przestawiono liczbę użytych bajtów z %d na %d w bloku %u gałęzi atrybutów i-węzła %<PRIu64>\n"
+msgid ""
+"- would reset usedbytes cnt from %d to %d in block %u of attribute fork of "
+"%<PRIu64>\n"
+msgstr ""
+"- liczba użytych bajtów zostałaby przestawiona z %d na %d w bloku %u gałęzi "
+"atrybutów i-węzła %<PRIu64>\n"
 
-#: .././repair/attr_repair.c:1297
+#: .././repair/attr_repair.c:763
 #, c-format
-msgid "- would reset usedbytes cnt from %d to %d in block %u of attribute fork of %<PRIu64>\n"
-msgstr "- liczba użytych bajtów zostałaby przestawiona z %d na %d w bloku %u gałęzi atrybutów i-węzła %<PRIu64>\n"
+msgid "btree cycle detected in attribute fork for inode %<PRIu64>\n"
+msgstr "wykryto cykl b-drzewa w gałęzi atrybutów dla i-węzła %<PRIu64>\n"
 
-#: .././repair/attr_repair.c:1352
+#: .././repair/attr_repair.c:775
 #, c-format
 msgid "can't map block %u for attribute fork for inode %<PRIu64>\n"
-msgstr "nie można odwzorować bloku %u dla gałęzi atrybutów dla i-węzła %<PRIu64>\n"
+msgstr ""
+"nie można odwzorować bloku %u dla gałęzi atrybutów dla i-węzła %<PRIu64>\n"
 
-#: .././repair/attr_repair.c:1362
+#: .././repair/attr_repair.c:785
 #, c-format
-msgid "can't read file block %u (fsbno %<PRIu64>) for attribute fork of inode %<PRIu64>\n"
-msgstr "nie można odczytać bloku pliku %u (fsbno %<PRIu64>) dla gałęzi atrybutów i-węzła %<PRIu64>\n"
+msgid ""
+"can't read file block %u (fsbno %<PRIu64>) for attribute fork of inode "
+"%<PRIu64>\n"
+msgstr ""
+"nie można odczytać bloku pliku %u (fsbno %<PRIu64>) dla gałęzi atrybutów i-"
+"węzła %<PRIu64>\n"
 
-#: .././repair/attr_repair.c:1376
+#: .././repair/attr_repair.c:797
 #, c-format
 msgid "bad attribute leaf magic %#x for inode %<PRIu64>\n"
 msgstr "błędna liczba magiczna liścia atrybutu %#x dla i-węzła %<PRIu64>\n"
 
-#: .././repair/attr_repair.c:1407
+#: .././repair/attr_repair.c:828
 #, c-format
-msgid "bad sibling back pointer for block %u in attribute fork for inode %<PRIu64>\n"
-msgstr "błędny wskaźnik wsteczny dla bloku %u w gałęzi atrybutów dla i-węzła %<PRIu64>\n"
+msgid ""
+"bad sibling back pointer for block %u in attribute fork for inode %<PRIu64>\n"
+msgstr ""
+"błędny wskaźnik wsteczny dla bloku %u w gałęzi atrybutów dla i-węzła "
+"%<PRIu64>\n"
 
-#: .././repair/attr_repair.c:1434
+#: .././repair/attr_repair.c:863
 #, c-format
 msgid "bad hash path in attribute fork for inode %<PRIu64>\n"
 msgstr "błędna ścieżka hasza w gałęzi atrybutów dla i-węzła %<PRIu64>\n"
 
-#: .././repair/attr_repair.c:1534
+#: .././repair/attr_repair.c:945
+#, c-format
+msgid "expected owner inode %<PRIu64>, got %llu, attr block %<PRIu64>\n"
+msgstr ""
+"oczekiwano i-węzła właściciela %<PRIu64>, napotkano %llu, blok attr "
+"%<PRIu64>\n"
+
+#: .././repair/attr_repair.c:952
+#, c-format
+msgid "expected block %<PRIu64>, got %llu, inode %<PRIu64>attr block\n"
+msgstr ""
+"oczekiwano bloku %<PRIu64>, napotkano %llu, blok attr i-węzła %<PRIu64>\n"
+
+#: .././repair/attr_repair.c:959
+#, c-format
+msgid "wrong FS UUID, inode %<PRIu64> attr block %<PRIu64>\n"
+msgstr "błędny UUID systemu plików, i-węzeł %<PRIu64> blok attr %<PRIu64>\n"
+
+#: .././repair/attr_repair.c:1001
 #, c-format
 msgid "block 0 of inode %<PRIu64> attribute fork is missing\n"
 msgstr "brak bloku 0 i-węzła %<PRIu64> gałęzi atrybutów\n"
 
-#: .././repair/attr_repair.c:1541
+#: .././repair/attr_repair.c:1008
 #, c-format
 msgid "agno of attribute fork of inode %<PRIu64> out of regular partition\n"
 msgstr "agno gałęzi atrybutów i-węzła %<PRIu64> spoza zwykłej partycji\n"
 
-#: .././repair/attr_repair.c:1549
+#: .././repair/attr_repair.c:1016
 #, c-format
 msgid "can't read block 0 of inode %<PRIu64> attribute fork\n"
 msgstr "nie można odczytać bloku 0 i-węzła %<PRIu64> gałęzi atrybutów\n"
 
-#: .././repair/attr_repair.c:1566
+#: .././repair/attr_repair.c:1040
 #, c-format
-msgid "clearing forw/back pointers in block 0 for attributes in inode %<PRIu64>\n"
-msgstr "wyczyszczono wskaźniki forw/back w bloku 0 dla atrybutów w i-węźle %<PRIu64>\n"
+msgid ""
+"clearing forw/back pointers in block 0 for attributes in inode %<PRIu64>\n"
+msgstr ""
+"wyczyszczono wskaźniki forw/back w bloku 0 dla atrybutów w i-węźle "
+"%<PRIu64>\n"
 
-#: .././repair/attr_repair.c:1574
+#: .././repair/attr_repair.c:1049
 #, c-format
-msgid "would clear forw/back pointers in block 0 for attributes in inode %<PRIu64>\n"
-msgstr "wskaźniki forw/back w bloku 0 dla atrybutów w i-węźle %<PRIu64> zostałyby wyczyszczone\n"
+msgid ""
+"would clear forw/back pointers in block 0 for attributes in inode %<PRIu64>\n"
+msgstr ""
+"wskaźniki forw/back w bloku 0 dla atrybutów w i-węźle %<PRIu64> zostałyby "
+"wyczyszczone\n"
 
-#: .././repair/attr_repair.c:1606
+#: .././repair/attr_repair.c:1085
 #, c-format
 msgid "bad attribute leaf magic # %#x for dir ino %<PRIu64>\n"
-msgstr "błędna liczba magiczna liścia atrybutu %#x dla i-węzła katalogu %<PRIu64>\n"
+msgstr ""
+"błędna liczba magiczna liścia atrybutu %#x dla i-węzła katalogu %<PRIu64>\n"
 
-#: .././repair/attr_repair.c:1635
+#: .././repair/attr_repair.c:1115
 #, c-format
 msgid "Too many ACL entries, count %d\n"
 msgstr "Za dużo wpisów ACL, liczba %d\n"
 
-#: .././repair/attr_repair.c:1644
+#: .././repair/attr_repair.c:1124
 msgid "cannot malloc enough for ACL attribute\n"
 msgstr "nie można wykonać wystarczającego malloc dla atrybutu ACL\n"
 
-#: .././repair/attr_repair.c:1645
+#: .././repair/attr_repair.c:1125
 msgid "SKIPPING this ACL\n"
 msgstr "POMINIĘTO ten ACL\n"
 
-#: .././repair/attr_repair.c:1695 .././repair/dinode.c:2053
+#: .././repair/attr_repair.c:1175 .././repair/dinode.c:2070
 #, c-format
 msgid "illegal attribute format %d, ino %<PRIu64>\n"
 msgstr "niedozwolony format atrybutu %d, i-węzeł %<PRIu64>\n"
@@ -9384,12 +10598,12 @@ msgstr ""
 msgid "malloc failed in blkmap_alloc (%zu bytes)\n"
 msgstr "malloc nie powiodło się w blkmap_alloc (%zu bajtów)\n"
 
-#: .././repair/bmap.c:174
+#: .././repair/bmap.c:189
 #, c-format
 msgid "blkmap_getn malloc failed (%<PRIu64> bytes)\n"
 msgstr "malloc w blkmap_getn nie powiodło się (%<PRIu64> bajtów)\n"
 
-#: .././repair/bmap.c:281
+#: .././repair/bmap.c:296
 #, c-format
 msgid ""
 "Number of extents requested in blkmap_grow (%d) overflows 32 bits.\n"
@@ -9398,7 +10612,7 @@ msgstr ""
 "Liczba ekstentów żądanych w blkmap_grow (%d) przepełnia 32 bity.\n"
 "Do naprawy tego systemu plików niezbędny jest system 64-bitowy.\n"
 
-#: .././repair/bmap.c:289
+#: .././repair/bmap.c:304
 #, c-format
 msgid ""
 "Number of extents requested in blkmap_grow (%d) overflowed the\n"
@@ -9407,10 +10621,142 @@ msgstr ""
 "Liczba ekstentów żądanych w blkmap_grow (%d) przepełniła maksymalną\n"
 "liczbę obsługiwanych ekstentów (%d).\n"
 
-#: .././repair/bmap.c:297
+#: .././repair/bmap.c:312
 msgid "realloc failed in blkmap_grow\n"
 msgstr "realloc nie powiodło się w blkmap_grow\n"
 
+#: .././repair/da_util.c:88 .././repair/prefetch.c:238
+msgid "couldn't malloc dir2 buffer list\n"
+msgstr "nie można przydzielić listy bufora dir2\n"
+
+#: .././repair/da_util.c:105
+msgid "attribute"
+msgstr "atrybut"
+
+#: .././repair/da_util.c:164 .././repair/da_util.c:585
+#, c-format
+msgid "can't read %s block %u for inode %<PRIu64>\n"
+msgstr "nie można odczytać bloku %su %u dla i-węzła %<PRIu64>\n"
+
+#: .././repair/da_util.c:177
+#, c-format
+msgid "found non-root LEAFN node in inode %<PRIu64> bno = %u\n"
+msgstr "znaleziono niegłówny węzeł LEAFN w i-węźle %<PRIu64> bno = %u\n"
+
+#: .././repair/da_util.c:188
+#, c-format
+msgid "bad %s magic number 0x%x in inode %<PRIu64> bno = %u\n"
+msgstr "błędna liczba magiczna %su 0x%x w i-węźle %<PRIu64> bno = %u\n"
+
+#: .././repair/da_util.c:199
+#, c-format
+msgid "corrupt %s tree block %u for inode %<PRIu64>\n"
+msgstr "uszkodzony blok drzewa %su %u w i-węźle %<PRIu64>\n"
+
+#: .././repair/da_util.c:207
+#, c-format
+msgid "bad %s record count in inode %<PRIu64>, count = %d, max = %d\n"
+msgstr ""
+"błędna liczba rekordów %su w i-węźle %<PRIu64>, liczba = %d, maksimum = %d\n"
+
+#: .././repair/da_util.c:221
+#, c-format
+msgid "bad header depth for directory inode %<PRIu64>\n"
+msgstr "błędna głębokość nagłówka dla i-węzła katalogu %<PRIu64>\n"
+
+#: .././repair/da_util.c:232
+#, c-format
+msgid "bad %s btree for inode %<PRIu64>\n"
+msgstr "błędne b-drzewo %su dla i-węzła %<PRIu64>\n"
+
+#: .././repair/da_util.c:282
+#, c-format
+msgid "release_da_cursor_int got unexpected non-null bp, dabno = %u\n"
+msgstr ""
+"release_da_cursor_int otrzymało nieoczekiwany niepusty bp, dabno = %u\n"
+
+#: .././repair/da_util.c:360
+#, c-format
+msgid "%s block used/count inconsistency - %d/%hu\n"
+msgstr "niespójność wartości used/count bloku %su - %d / %hu\n"
+
+#: .././repair/da_util.c:370
+#, c-format
+msgid "%s block hashvalue inconsistency, expected > %u / saw %u\n"
+msgstr "niespójność wartości hasza bloku %su - oczekiwano > %u, napotkano %u\n"
+
+#: .././repair/da_util.c:378
+#, c-format
+msgid "bad %s forward block pointer, expected 0, saw %u\n"
+msgstr "błędny wskaźnik bloku w przód %su - oczekiwano 0, napotkano %u\n"
+
+#: .././repair/da_util.c:383
+#, c-format
+msgid "bad %s block in inode %<PRIu64>\n"
+msgstr "błędny blok %su w i-węźle %<PRIu64>\n"
+
+#: .././repair/da_util.c:413
+#, c-format
+msgid ""
+"correcting bad hashval in non-leaf %s block\n"
+"\tin (level %d) in inode %<PRIu64>.\n"
+msgstr ""
+"poprawiono błędne hashval w bloku %su nie będącego liściem\n"
+"\tw i-węźle (poziomu %d) %<PRIu64>.\n"
+
+#: .././repair/da_util.c:421
+#, c-format
+msgid ""
+"would correct bad hashval in non-leaf %s block\n"
+"\tin (level %d) in inode %<PRIu64>.\n"
+msgstr ""
+"błędne hashval w bloku %su nie będącego liściem zostałoby poprawione\n"
+"\tw i-węźle (poziomu %d) %<PRIu64>.\n"
+
+#: .././repair/da_util.c:574
+#, c-format
+msgid "can't get map info for %s block %u of inode %<PRIu64>\n"
+msgstr ""
+"nie można uzyskać informacji o mapie dla bloku %su %u i-węzła %<PRIu64>\n"
+
+#: .././repair/da_util.c:602
+#, c-format
+msgid "bad magic number %x in %s block %u for inode %<PRIu64>\n"
+msgstr "błędna liczba magiczna %x w bloku %su %u dla i-węzła %<PRIu64>\n"
+
+#: .././repair/da_util.c:609
+#, c-format
+msgid "bad back pointer in %s block %u for inode %<PRIu64>\n"
+msgstr "błędny wskaźnik wstecz w bloku %su %u dla i-węzła %<PRIu64>\n"
+
+#: .././repair/da_util.c:615
+#, c-format
+msgid "entry count %d too large in %s block %u for inode %<PRIu64>\n"
+msgstr "liczba wpisów %d zbyt duża w bloku %su %u dla i-węzła %<PRIu64>\n"
+
+#: .././repair/da_util.c:622
+#, c-format
+msgid "bad level %d in %s block %u for inode %<PRIu64>\n"
+msgstr "błędny poziom %d w bloku %su %u dla i-węzła %<PRIu64>\n"
+
+#: .././repair/da_util.c:686
+#, c-format
+msgid ""
+"correcting bad hashval in interior %s block\n"
+"\tin (level %d) in inode %<PRIu64>.\n"
+msgstr ""
+"poprawiono błędne hashval w wewnętrznym bloku %su\n"
+"\tw i-węźle (poziomu %d) %<PRIu64>.\n"
+
+#: .././repair/da_util.c:694
+#, c-format
+msgid ""
+"would correct bad hashval in interior %s block\n"
+"\tin (level %d) in inode %<PRIu64>.\n"
+msgstr ""
+"błędne hashval w wewnętrznym bloku %su zostałoby poprawione\n"
+"\tw i-węźle (poziomu %d) %<PRIu64>.\n"
+
 #: .././repair/dino_chunks.c:57
 #, c-format
 msgid "cannot read agbno (%u/%u), disk block %<PRId64>\n"
@@ -9442,178 +10788,223 @@ msgstr "niepewny blok i-węzła pokrywa
 msgid "uncertain inode block %<PRIu64> already known\n"
 msgstr "niepewny blok i-węzła %<PRIu64> już znany\n"
 
-#: .././repair/dino_chunks.c:621
-#, c-format
-msgid "failed to allocate %zd bytes of memory\n"
-msgstr "nie udało się przydzielić %zd bajtów pamięci\n"
-
-#: .././repair/dino_chunks.c:633
-#, c-format
-msgid "cannot read inode %<PRIu64>, disk block %<PRId64>, cnt %d\n"
-msgstr "nie można odczytać i-węzła %<PRIu64>, blok dysku %<PRId64>, cnt %d\n"
-
-#: .././repair/dino_chunks.c:750 .././repair/dino_chunks.c:939
+#: .././repair/dino_chunks.c:578
 #, c-format
 msgid "bad state in block map %d\n"
 msgstr "błędny stan w mapie bloku %d\n"
 
-#: .././repair/dino_chunks.c:754 .././repair/dino_chunks.c:945
+#: .././repair/dino_chunks.c:583
 #, c-format
 msgid "inode block %<PRIu64> multiply claimed, state was %d\n"
 msgstr "blok i-węzła %<PRIu64> wielokrotnie przydzielony, stan był %d\n"
 
-#: .././repair/dino_chunks.c:796
+#: .././repair/dino_chunks.c:654
+#, c-format
+msgid "failed to allocate %zd bytes of memory\n"
+msgstr "nie udało się przydzielić %zd bajtów pamięci\n"
+
+#: .././repair/dino_chunks.c:678
+#, c-format
+msgid "cannot read inode %<PRIu64>, disk block %<PRId64>, cnt %d\n"
+msgstr "nie można odczytać i-węzła %<PRIu64>, blok dysku %<PRId64>, cnt %d\n"
+
+#: .././repair/dino_chunks.c:832
 #, c-format
 msgid "imap claims in-use inode %<PRIu64> is free, "
 msgstr "imap twierdzi, że używany i-węzeł %<PRIu64> jest wolny, "
 
-#: .././repair/dino_chunks.c:801
+#: .././repair/dino_chunks.c:837
 msgid "correcting imap\n"
 msgstr "poprawiono imap\n"
 
-#: .././repair/dino_chunks.c:803
+#: .././repair/dino_chunks.c:839
 msgid "would correct imap\n"
 msgstr "imap zostałoby poprawione\n"
 
-#: .././repair/dino_chunks.c:858
+#: .././repair/dino_chunks.c:892
 #, c-format
 msgid "cleared root inode %<PRIu64>\n"
 msgstr "wyczyszczono główny i-węzeł %<PRIu64>\n"
 
-#: .././repair/dino_chunks.c:862
+#: .././repair/dino_chunks.c:896
 #, c-format
 msgid "would clear root inode %<PRIu64>\n"
 msgstr "główny węzeł %<PRIu64> zostałby wyczyszczony\n"
 
-#: .././repair/dino_chunks.c:870
+#: .././repair/dino_chunks.c:904
 #, c-format
 msgid "cleared realtime bitmap inode %<PRIu64>\n"
 msgstr "wyczyszczono i-węzeł bitmapy realtime %<PRIu64>\n"
 
-#: .././repair/dino_chunks.c:874
+#: .././repair/dino_chunks.c:908
 #, c-format
 msgid "would clear realtime bitmap inode %<PRIu64>\n"
 msgstr "i-węzeł bitmapy realtime %<PRIu64> zostałby wyczyszczony\n"
 
-#: .././repair/dino_chunks.c:882
+#: .././repair/dino_chunks.c:916
 #, c-format
 msgid "cleared realtime summary inode %<PRIu64>\n"
 msgstr "wyczyszczono i-węzeł opisu realtime %<PRIu64>\n"
 
-#: .././repair/dino_chunks.c:886
+#: .././repair/dino_chunks.c:920
 #, c-format
 msgid "would clear realtime summary inode %<PRIu64>\n"
 msgstr "i-węzeł opisu realtime %<PRIu64> zostałby wyczyszczony\n"
 
-#: .././repair/dino_chunks.c:890
+#: .././repair/dino_chunks.c:924
 #, c-format
 msgid "cleared inode %<PRIu64>\n"
 msgstr "wyczyszczono i-węzeł %<PRIu64>\n"
 
-#: .././repair/dino_chunks.c:893
+#: .././repair/dino_chunks.c:927
 #, c-format
 msgid "would have cleared inode %<PRIu64>\n"
 msgstr "i-węzeł %<PRIu64> zostałby wyczyszczony\n"
 
-#: .././repair/dino_chunks.c:1100 .././repair/dino_chunks.c:1135
-#: .././repair/dino_chunks.c:1249
+#: .././repair/dino_chunks.c:1118 .././repair/dino_chunks.c:1153
+#: .././repair/dino_chunks.c:1267
 msgid "found inodes not in the inode allocation tree\n"
 msgstr "znaleziono i-węzły nieobecne w drzewie alokacji i-węzłów\n"
 
-#: .././repair/dinode.c:52
+#: .././repair/dinode.c:54
 msgid "real-time"
 msgstr "realtime"
 
-#: .././repair/dinode.c:53
+#: .././repair/dinode.c:55
 msgid "regular"
 msgstr "zwykłym"
 
-#: .././repair/dinode.c:76
+#: .././repair/dinode.c:78
 #, c-format
 msgid "clearing inode %<PRIu64> attributes\n"
 msgstr "wyczyszczono atrybuty i-węzła %<PRIu64>\n"
 
-#: .././repair/dinode.c:79
+#: .././repair/dinode.c:81
 #, c-format
 msgid "would have cleared inode %<PRIu64> attributes\n"
 msgstr "atrybuty i-węzła %<PRIu64> zostałyby wyczyszczone\n"
 
-#: .././repair/dinode.c:443
+#: .././repair/dinode.c:444
 #, c-format
-msgid "inode %<PRIu64> - bad rt extent start block number %<PRIu64>, offset %<PRIu64>\n"
-msgstr "i-węzeł %<PRIu64> - błędny numer bloku początkowego ekstentu rt %<PRIu64>, offset %<PRIu64>\n"
+msgid ""
+"inode %<PRIu64> - bad rt extent start block number %<PRIu64>, offset "
+"%<PRIu64>\n"
+msgstr ""
+"i-węzeł %<PRIu64> - błędny numer bloku początkowego ekstentu rt %<PRIu64>, "
+"offset %<PRIu64>\n"
 
-#: .././repair/dinode.c:451
+#: .././repair/dinode.c:452
 #, c-format
-msgid "inode %<PRIu64> - bad rt extent last block number %<PRIu64>, offset %<PRIu64>\n"
-msgstr "i-węzeł %<PRIu64> - błędny numer bloku końcowego ekstentu rt %<PRIu64>, offset %<PRIu64>\n"
+msgid ""
+"inode %<PRIu64> - bad rt extent last block number %<PRIu64>, offset "
+"%<PRIu64>\n"
+msgstr ""
+"i-węzeł %<PRIu64> - błędny numer bloku końcowego ekstentu rt %<PRIu64>, "
+"offset %<PRIu64>\n"
 
-#: .././repair/dinode.c:459
+#: .././repair/dinode.c:460
 #, c-format
-msgid "inode %<PRIu64> - bad rt extent overflows - start %<PRIu64>, end %<PRIu64>, offset %<PRIu64>\n"
-msgstr "i-węzeł %<PRIu64> - błędne przepełnienie ekstentu rt - początek %<PRIu64>, koniec %<PRIu64>, offset %<PRIu64>\n"
+msgid ""
+"inode %<PRIu64> - bad rt extent overflows - start %<PRIu64>, end %<PRIu64>, "
+"offset %<PRIu64>\n"
+msgstr ""
+"i-węzeł %<PRIu64> - błędne przepełnienie ekstentu rt - początek %<PRIu64>, "
+"koniec %<PRIu64>, offset %<PRIu64>\n"
 
-#: .././repair/dinode.c:476
+#: .././repair/dinode.c:477
 #, c-format
 msgid "malformed rt inode extent [%<PRIu64> %<PRIu64>] (fs rtext size = %u)\n"
-msgstr "zniekształcony ekstent i-węzła rt [%<PRIu64> %<PRIu64>] (rozmiar fs rtext = %u)\n"
+msgstr ""
+"zniekształcony ekstent i-węzła rt [%<PRIu64> %<PRIu64>] (rozmiar fs rtext = "
+"%u)\n"
 
-#: .././repair/dinode.c:497
+#: .././repair/dinode.c:498
 #, c-format
-msgid "data fork in rt ino %<PRIu64> claims dup rt extent,off - %<PRIu64>, start - %<PRIu64>, count %<PRIu64>\n"
-msgstr "gałąź danych w i-węźle rt %<PRIu64> odwołuje się do powtórzonego ekstentu rt, offset %<PRIu64>, początek %<PRIu64>, liczba %<PRIu64>\n"
+msgid ""
+"data fork in rt ino %<PRIu64> claims dup rt extent,off - %<PRIu64>, start - "
+"%<PRIu64>, count %<PRIu64>\n"
+msgstr ""
+"gałąź danych w i-węźle rt %<PRIu64> odwołuje się do powtórzonego ekstentu "
+"rt, offset %<PRIu64>, początek %<PRIu64>, liczba %<PRIu64>\n"
 
-#: .././repair/dinode.c:516
+#: .././repair/dinode.c:517
 #, c-format
 msgid "bad state in rt block map %<PRIu64>\n"
 msgstr "błędny stan w mapie bloku rt %<PRIu64>\n"
 
-#: .././repair/dinode.c:522
+#: .././repair/dinode.c:523
 #, c-format
-msgid "data fork in rt inode %<PRIu64> found metadata block %<PRIu64> in rt bmap\n"
-msgstr "gałąź danych w i-węźle rt %<PRIu64> - znaleziono blok metadanych %<PRIu64> w bmapie rt\n"
+msgid ""
+"data fork in rt inode %<PRIu64> found metadata block %<PRIu64> in rt bmap\n"
+msgstr ""
+"gałąź danych w i-węźle rt %<PRIu64> - znaleziono blok metadanych %<PRIu64> w "
+"bmapie rt\n"
 
-#: .././repair/dinode.c:530
+#: .././repair/dinode.c:531
 #, c-format
 msgid "data fork in rt inode %<PRIu64> claims used rt block %<PRIu64>\n"
-msgstr "gałąź danych w i-węźle rt %<PRIu64> odwołuje się do używanego bloku rt %<PRIu64>\n"
+msgstr ""
+"gałąź danych w i-węźle rt %<PRIu64> odwołuje się do używanego bloku rt "
+"%<PRIu64>\n"
 
-#: .././repair/dinode.c:536
+#: .././repair/dinode.c:537
 #, c-format
 msgid "illegal state %d in rt block map %<PRIu64>\n"
 msgstr "niedozwolony stan %d w mapie bloku rt %<PRIu64>\n"
 
-#: .././repair/dinode.c:599
+#: .././repair/dinode.c:600
 #, c-format
-msgid "bmap rec out of order, inode %<PRIu64> entry %d [o s c] [%<PRIu64> %<PRIu64> %<PRIu64>], %d [%<PRIu64> %<PRIu64> %<PRIu64>]\n"
-msgstr "rekord bmap uszkodzony, i-węzeł %<PRIu64> wpis %d [o s c] [%<PRIu64> %<PRIu64> %<PRIu64>], %d [%<PRIu64> %<PRIu64> %<PRIu64>]\n"
+msgid ""
+"bmap rec out of order, inode %<PRIu64> entry %d [o s c] [%<PRIu64> %<PRIu64> "
+"%<PRIu64>], %d [%<PRIu64> %<PRIu64> %<PRIu64>]\n"
+msgstr ""
+"rekord bmap uszkodzony, i-węzeł %<PRIu64> wpis %d [o s c] [%<PRIu64> "
+"%<PRIu64> %<PRIu64>], %d [%<PRIu64> %<PRIu64> %<PRIu64>]\n"
 
-#: .././repair/dinode.c:615
+#: .././repair/dinode.c:616
 #, c-format
-msgid "zero length extent (off = %<PRIu64>, fsbno = %<PRIu64>) in ino %<PRIu64>\n"
-msgstr "ekstent zerowej długości (off = %<PRIu64>, fsbno = %<PRIu64>) w i-węźle %<PRIu64>\n"
+msgid ""
+"zero length extent (off = %<PRIu64>, fsbno = %<PRIu64>) in ino %<PRIu64>\n"
+msgstr ""
+"ekstent zerowej długości (off = %<PRIu64>, fsbno = %<PRIu64>) w i-węźle "
+"%<PRIu64>\n"
 
-#: .././repair/dinode.c:646
+#: .././repair/dinode.c:647
 #, c-format
-msgid "inode %<PRIu64> - bad extent starting block number %<PRIu64>, offset %<PRIu64>\n"
-msgstr "i-węzeł %<PRIu64> - błędny numer bloku początkowego ekstentu %<PRIu64>, offset %<PRIu64>\n"
+msgid ""
+"inode %<PRIu64> - bad extent starting block number %<PRIu64>, offset "
+"%<PRIu64>\n"
+msgstr ""
+"i-węzeł %<PRIu64> - błędny numer bloku początkowego ekstentu %<PRIu64>, "
+"offset %<PRIu64>\n"
 
-#: .././repair/dinode.c:654
+#: .././repair/dinode.c:655
 #, c-format
-msgid "inode %<PRIu64> - bad extent last block number %<PRIu64>, offset %<PRIu64>\n"
-msgstr "i-węzeł %<PRIu64> - błędny numer bloku końcowego ekstentu %<PRIu64>, offset %<PRIu64>\n"
+msgid ""
+"inode %<PRIu64> - bad extent last block number %<PRIu64>, offset %<PRIu64>\n"
+msgstr ""
+"i-węzeł %<PRIu64> - błędny numer bloku końcowego ekstentu %<PRIu64>, offset "
+"%<PRIu64>\n"
 
-#: .././repair/dinode.c:662
+#: .././repair/dinode.c:663
 #, c-format
-msgid "inode %<PRIu64> - bad extent overflows - start %<PRIu64>, end %<PRIu64>, offset %<PRIu64>\n"
-msgstr "i-węzeł %<PRIu64> - błędne przepełnienie ekstentu - początek %<PRIu64>, koniec %<PRIu64>, offset %<PRIu64>\n"
+msgid ""
+"inode %<PRIu64> - bad extent overflows - start %<PRIu64>, end %<PRIu64>, "
+"offset %<PRIu64>\n"
+msgstr ""
+"i-węzeł %<PRIu64> - błędne przepełnienie ekstentu - początek %<PRIu64>, "
+"koniec %<PRIu64>, offset %<PRIu64>\n"
 
-#: .././repair/dinode.c:672
+#: .././repair/dinode.c:675
 #, c-format
-msgid "inode %<PRIu64> - extent offset too large - start %<PRIu64>, count %<PRIu64>, offset %<PRIu64>\n"
-msgstr "i-węzeł %<PRIu64> - offset ekstentu zbyt duży - początek %<PRIu64>, liczba %<PRIu64>, offset %<PRIu64>\n"
+msgid ""
+"inode %<PRIu64> - extent exceeds max offset - start %<PRIu64>, count "
+"%<PRIu64>, physical block %<PRIu64>\n"
+msgstr ""
+"i-węzeł %<PRIu64> - ekstent przekracza maksymalny offset - początek "
+"%<PRIu64>, liczba %<PRIu64>, blok fizyczny %<PRIu64>\n"
 
-#: .././repair/dinode.c:693
+#: .././repair/dinode.c:696
 #, c-format
 msgid ""
 "Fatal error: inode %<PRIu64> - blkmap_set_ext(): %s\n"
@@ -9622,1088 +11013,1103 @@ msgstr ""
 "Błąd krytyczny: i-węzeł %<PRIu64> - blkmap_set_ext(): %s\n"
 "\tgałąź %s, offset %<PRIu64>, początek %<PRIu64>, liczba %<PRIu64>\n"
 
-#: .././repair/dinode.c:724
+#: .././repair/dinode.c:729
 #, c-format
-msgid "%s fork in ino %<PRIu64> claims dup extent, off - %<PRIu64>, start - %<PRIu64>, cnt %<PRIu64>\n"
-msgstr "gałąź %s w i-węźle %<PRIu64> odwołuje się do powtórzonego ekstentu, offset %<PRIu64>, początek %<PRIu64>, liczba %<PRIu64>\n"
+msgid ""
+"%s fork in ino %<PRIu64> claims dup extent, off - %<PRIu64>, start - "
+"%<PRIu64>, cnt %<PRIu64>\n"
+msgstr ""
+"gałąź %s w i-węźle %<PRIu64> odwołuje się do powtórzonego ekstentu, offset "
+"%<PRIu64>, początek %<PRIu64>, liczba %<PRIu64>\n"
 
-#: .././repair/dinode.c:743
+#: .././repair/dinode.c:748
 #, c-format
 msgid "%s fork in ino %<PRIu64> claims free block %<PRIu64>\n"
 msgstr "gałąź %s w i-węźle %<PRIu64> odwołuje się do wolnego bloku %<PRIu64>\n"
 
-#: .././repair/dinode.c:751
+#: .././repair/dinode.c:757
 #, c-format
 msgid "bad state in block map %<PRIu64>\n"
 msgstr "błędny stan w mapie bloku %<PRIu64>\n"
 
-#: .././repair/dinode.c:757
+#: .././repair/dinode.c:762
+msgid "rmap claims metadata use!\n"
+msgstr "rmap ma przypisane użycie metadanych!\n"
+
+#: .././repair/dinode.c:768
 #, c-format
 msgid "%s fork in inode %<PRIu64> claims metadata block %<PRIu64>\n"
-msgstr "gałąź %s w i-węźle %<PRIu64> odwołuje się do bloku metadanych %<PRIu64>\n"
+msgstr ""
+"gałąź %s w i-węźle %<PRIu64> odwołuje się do bloku metadanych %<PRIu64>\n"
 
-#: .././repair/dinode.c:765
+#: .././repair/dinode.c:779
 #, c-format
 msgid "%s fork in %s inode %<PRIu64> claims used block %<PRIu64>\n"
-msgstr "gałąź %s w i-węźle %s %<PRIu64> odwołuje się do używanego bloku %<PRIu64>\n"
+msgstr ""
+"gałąź %s w i-węźle %s %<PRIu64> odwołuje się do używanego bloku %<PRIu64>\n"
 
-#: .././repair/dinode.c:771
+#: .././repair/dinode.c:785
 #, c-format
 msgid "illegal state %d in block map %<PRIu64>\n"
 msgstr "niedozwolony stan %d w mapie bloku %<PRIu64>\n"
 
-#: .././repair/dinode.c:784
+#: .././repair/dinode.c:793
+msgid "couldn't add reverse mapping\n"
+msgstr "nie udało się dodać odwzorowania odwrotnego\n"
+
+#: .././repair/dinode.c:805
 #, c-format
 msgid "correcting nextents for inode %<PRIu64>\n"
 msgstr "poprawiono nextents dla i-węzła %<PRIu64>\n"
 
-#: .././repair/dinode.c:857
+#: .././repair/dinode.c:897
 #, c-format
 msgid "cannot read inode (%u/%u), disk block %<PRIu64>\n"
 msgstr "nie można odczytać i-węzła (%u/%u), blok dysku %<PRIu64>\n"
 
-#: .././repair/dinode.c:928
+#: .././repair/dinode.c:965
 #, c-format
 msgid "bad level %d in inode %<PRIu64> bmap btree root block\n"
 msgstr "błędny poziom %d w bloku głównym bmap btree i-węzła %<PRIu64>\n"
 
-#: .././repair/dinode.c:934
+#: .././repair/dinode.c:971
 #, c-format
 msgid "bad numrecs 0 in inode %<PRIu64> bmap btree root block\n"
 msgstr "błędne numrecs 0 w bloku głównym bmap btree i-węzła %<PRIu64>\n"
 
-#: .././repair/dinode.c:943
+#: .././repair/dinode.c:980
 #, c-format
-msgid "indicated size of %s btree root (%d bytes) greater than space in inode %<PRIu64> %s fork\n"
-msgstr "oznaczony rozmiar korzenia b-drzewa %s (%d bajtów) większy niż miejsce w i-węźle %<PRIu64> gałęzi %s\n"
+msgid ""
+"indicated size of %s btree root (%d bytes) greater than space in inode "
+"%<PRIu64> %s fork\n"
+msgstr ""
+"oznaczony rozmiar korzenia b-drzewa %s (%d bajtów) większy niż miejsce w i-"
+"węźle %<PRIu64> gałęzi %s\n"
 
-#: .././repair/dinode.c:963 .././repair/scan.c:429
+#: .././repair/dinode.c:1001
 #, c-format
-msgid "bad bmap btree ptr 0x%llx in ino %<PRIu64>\n"
-msgstr "błędny wskaźnik bmap btree 0x%llx w i-węźle %<PRIu64>\n"
+msgid "bad bmap btree ptr 0x%<PRIx64> in ino %<PRIu64>\n"
+msgstr "błędny wskaźnik bmap btree 0x%<PRIx64> w i-węźle %<PRIu64>\n"
 
-#: .././repair/dinode.c:982
+#: .././repair/dinode.c:1021
 #, c-format
-msgid "correcting key in bmbt root (was %llu, now %<PRIu64>) in inode %<PRIu64> %s fork\n"
-msgstr "poprawiono klucz w korzeniu bmbt (był %llu, jest %<PRIu64>) w i-węźle %<PRIu64> gałęzi %s\n"
+msgid ""
+"correcting key in bmbt root (was %<PRIu64>, now %<PRIu64>) in inode "
+"%<PRIu64> %s fork\n"
+msgstr ""
+"poprawiono klucz w korzeniu bmbt (był %<PRIu64>, jest %<PRIu64>) w i-węźle "
+"%<PRIu64> gałęzi %s\n"
 
-#: .././repair/dinode.c:994
+#: .././repair/dinode.c:1033
 #, c-format
-msgid "bad key in bmbt root (is %llu, would reset to %<PRIu64>) in inode %<PRIu64> %s fork\n"
-msgstr "błędny klucz w korzeniu bmbt (jest %llu, zostałby przestawiony na %<PRIu64>) w i-węźle %<PRIu64> gałęzi %s\n"
+msgid ""
+"bad key in bmbt root (is %<PRIu64>, would reset to %<PRIu64>) in inode "
+"%<PRIu64> %s fork\n"
+msgstr ""
+"błędny klucz w korzeniu bmbt (jest %<PRIu64>, zostałby przestawiony na "
+"%<PRIu64>) w i-węźle %<PRIu64> gałęzi %s\n"
 
-#: .././repair/dinode.c:1011
+#: .././repair/dinode.c:1049
 #, c-format
 msgid "out of order bmbt root key %<PRIu64> in inode %<PRIu64> %s fork\n"
-msgstr "niepoprawny klucz korzenia bmbt %<PRIu64> w i-węźle %<PRIu64> gałęzi %s\n"
+msgstr ""
+"niepoprawny klucz korzenia bmbt %<PRIu64> w i-węźle %<PRIu64> gałęzi %s\n"
 
-#: .././repair/dinode.c:1028
+#: .././repair/dinode.c:1066
 #, c-format
-msgid "extent count for ino %<PRIu64> %s fork too low (%<PRIu64>) for file format\n"
-msgstr "i-węzeł %<PRIu64>: liczba ekstentów dla odgałęzienia %s zbyt mała (%<PRIu64>) dla formatu pliku\n"
+msgid ""
+"extent count for ino %<PRIu64> %s fork too low (%<PRIu64>) for file format\n"
+msgstr ""
+"i-węzeł %<PRIu64>: liczba ekstentów dla gałęzi %s zbyt mała "
+"(%<PRIu64>) dla formatu pliku\n"
 
-#: .././repair/dinode.c:1039
+#: .././repair/dinode.c:1077
 #, c-format
 msgid "bad fwd (right) sibling pointer (saw %<PRIu64> should be NULLFSBLOCK)\n"
-msgstr "błędny wskaźnik fwd (prawy) (widziano %<PRIu64>, powinno być NULLFSBLOCK)\n"
+msgstr ""
+"błędny wskaźnik fwd (prawy) (napotkano %<PRIu64>, powinno być NULLFSBLOCK)\n"
 
-#: .././repair/dinode.c:1042
+#: .././repair/dinode.c:1080
 #, c-format
 msgid "\tin inode %<PRIu64> (%s fork) bmap btree block %<PRIu64>\n"
 msgstr "\tw i-węźle %<PRIu64> (gałęzi %s) bloku bmap btree %<PRIu64>\n"
 
-#: .././repair/dinode.c:1124
+#: .././repair/dinode.c:1162
 #, c-format
 msgid "local inode %<PRIu64> data fork is too large (size = %lld, max = %d)\n"
-msgstr "gałąź danych lokalnego i-węzła %<PRIu64> zbyt duża (rozmiar = %lld, maksimum = %d)\n"
+msgstr ""
+"gałąź danych lokalnego i-węzła %<PRIu64> zbyt duża (rozmiar = %lld, maksimum "
+"= %d)\n"
 
-#: .././repair/dinode.c:1132
+#: .././repair/dinode.c:1170
 #, c-format
 msgid "local inode %<PRIu64> attr fork too large (size %d, max = %d)\n"
-msgstr "gałąź atrybutów lokalnego i-węzła %<PRIu64> zbyt duża (rozmiar %d, maksimum = %d)\n"
+msgstr ""
+"gałąź atrybutów lokalnego i-węzła %<PRIu64> zbyt duża (rozmiar %d, maksimum "
+"= %d)\n"
 
-#: .././repair/dinode.c:1139
+#: .././repair/dinode.c:1177
 #, c-format
 msgid "local inode %<PRIu64> attr too small (size = %d, min size = %zd)\n"
-msgstr "gałąź atrybutów lokalnego i-węzła %<PRIu64> zbyt mała (rozmiar = %d, minimum = %zd)\n"
+msgstr ""
+"gałąź atrybutów lokalnego i-węzła %<PRIu64> zbyt mała (rozmiar = %d, minimum "
+"= %zd)\n"
 
-#: .././repair/dinode.c:1163
+#: .././repair/dinode.c:1201
 #, c-format
-msgid "mismatch between format (%d) and size (%<PRId64>) in symlink ino %<PRIu64>\n"
-msgstr "niezgodność między formatem (%d) a rozmiarem (%<PRId64>) w i-węźle dowiązania symbolicznego %<PRIu64>\n"
+msgid ""
+"mismatch between format (%d) and size (%<PRId64>) in symlink ino %<PRIu64>\n"
+msgstr ""
+"niezgodność między formatem (%d) a rozmiarem (%<PRId64>) w i-węźle "
+"dowiązania symbolicznego %<PRIu64>\n"
 
-#: .././repair/dinode.c:1170
+#: .././repair/dinode.c:1208
 #, c-format
-msgid "mismatch between format (%d) and size (%<PRId64>) in symlink inode %<PRIu64>\n"
-msgstr "niezgodność między formatem (%d) a rozmiarem (%<PRId64>) w i-węźle dowiązania symbolicznego %<PRIu64>\n"
+msgid ""
+"mismatch between format (%d) and size (%<PRId64>) in symlink inode "
+"%<PRIu64>\n"
+msgstr ""
+"niezgodność między formatem (%d) a rozmiarem (%<PRId64>) w i-węźle "
+"dowiązania symbolicznego %<PRIu64>\n"
 
-#: .././repair/dinode.c:1185
+#: .././repair/dinode.c:1223
 #, c-format
 msgid "bad number of extents (%d) in symlink %<PRIu64> data fork\n"
-msgstr "błędna liczba ekstentów (%d) w gałęzi danych dowiązania symbolicznego %<PRIu64>\n"
+msgstr ""
+"błędna liczba ekstentów (%d) w gałęzi danych dowiązania symbolicznego "
+"%<PRIu64>\n"
 
-#: .././repair/dinode.c:1198
+#: .././repair/dinode.c:1235
 #, c-format
 msgid "bad extent #%d offset (%<PRIu64>) in symlink %<PRIu64> data fork\n"
-msgstr "błędny offset ekstentu %d (%<PRIu64>) w gałęzi danych dowiązania symbolicznego %<PRIu64>\n"
+msgstr ""
+"błędny offset ekstentu %d (%<PRIu64>) w gałęzi danych dowiązania "
+"symbolicznego %<PRIu64>\n"
 
-#: .././repair/dinode.c:1204
+#: .././repair/dinode.c:1241
 #, c-format
 msgid "bad extent #%d count (%<PRIu64>) in symlink %<PRIu64> data fork\n"
-msgstr "błędna liczba ekstentów #%d (%<PRIu64>) w gałęzi danych dowiązania symbolicznego %<PRIu64>\n"
+msgstr ""
+"błędna liczba ekstentów #%d (%<PRIu64>) w gałęzi danych dowiązania "
+"symbolicznego %<PRIu64>\n"
 
-#: .././repair/dinode.c:1262
+#: .././repair/dinode.c:1299
 #, c-format
 msgid "cannot read inode %<PRIu64>, file block %d, NULL disk block\n"
-msgstr "nie można odczytać i-węzła %<PRIu64>, blok pliku %d, zerowy blok dysku\n"
+msgstr ""
+"nie można odczytać i-węzła %<PRIu64>, blok pliku %d, zerowy blok dysku\n"
 
-#: .././repair/dinode.c:1284
+#: .././repair/dinode.c:1321
 #, c-format
 msgid "cannot read inode %<PRIu64>, file block %d, disk block %<PRIu64>\n"
-msgstr "nie można odczytać i-węzła %<PRIu64>, blok pliku %d, blok dysku %<PRIu64>\n"
+msgstr ""
+"nie można odczytać i-węzła %<PRIu64>, blok pliku %d, blok dysku %<PRIu64>\n"
 
-#: .././repair/dinode.c:1290
+#: .././repair/dinode.c:1327
 #, c-format
 msgid ""
 "Bad symlink buffer CRC, block %<PRIu64>, inode %<PRIu64>.\n"
 "Correcting CRC, but symlink may be bad.\n"
 msgstr ""
-"Błędna suma kontrolna bufora dowiązania symbolicznego, blok %<PRIu64>, i-węzeł %<PRIu64>.\n"
+"Błędna suma kontrolna bufora dowiązania symbolicznego, blok %<PRIu64>, i-"
+"węzeł %<PRIu64>.\n"
 "Poprawianie CRC, ale dowiązanie symboliczne może być błędne.\n"
 
-#: .././repair/dinode.c:1303
+#: .././repair/dinode.c:1340
 #, c-format
 msgid "bad symlink header ino %<PRIu64>, file block %d, disk block %<PRIu64>\n"
-msgstr "błędny i-węzeł nagłówka dowiązania symbolicznego %<PRIu64>, blok pliku %d, blok dysku %<PRIu64>\n"
+msgstr ""
+"błędny i-węzeł nagłówka dowiązania symbolicznego %<PRIu64>, blok pliku %d, "
+"blok dysku %<PRIu64>\n"
 
-#: .././repair/dinode.c:1346
+#: .././repair/dinode.c:1383
 #, c-format
 msgid "symlink in inode %<PRIu64> too long (%llu chars)\n"
 msgstr "dowiązanie symboliczne w i-węźle %<PRIu64> zbyt długie (%llu znaków)\n"
 
-#: .././repair/dinode.c:1378
+#: .././repair/dinode.c:1389
 #, c-format
-msgid "found illegal null character in symlink inode %<PRIu64>\n"
-msgstr "znaleziono niedozwolony znak null w i-węźle dowiązania symbolicznego %<PRIu64>\n"
+msgid "zero size symlink in inode %<PRIu64>\n"
+msgstr "dowiązanie symboliczne o zerowym rozmiarze w i-węźle %<PRIu64>\n"
 
-#: .././repair/dinode.c:1392 .././repair/dinode.c:1402
+#: .././repair/dinode.c:1420
 #, c-format
-msgid "component of symlink in inode %<PRIu64> too long\n"
-msgstr "składnik dowiązania symbolicznego w i-węźle %<PRIu64> zbyt długi\n"
+msgid "found illegal null character in symlink inode %<PRIu64>\n"
+msgstr ""
+"znaleziono niedozwolony znak null w i-węźle dowiązania symbolicznego "
+"%<PRIu64>\n"
 
-#: .././repair/dinode.c:1428
+#: .././repair/dinode.c:1445
 #, c-format
 msgid "inode %<PRIu64> has bad inode type (IFMNT)\n"
 msgstr "i-węzeł %<PRIu64> ma błędny typ i-węzła (IFMNT)\n"
 
-#: .././repair/dinode.c:1439
+#: .././repair/dinode.c:1456
 #, c-format
 msgid "size of character device inode %<PRIu64> != 0 (%<PRId64> bytes)\n"
-msgstr "rozmiar i-węzła urządzenia znakowego %<PRIu64> != 0 (%<PRId64> bajtów)\n"
+msgstr ""
+"rozmiar i-węzła urządzenia znakowego %<PRIu64> != 0 (%<PRId64> bajtów)\n"
 
-#: .././repair/dinode.c:1444
+#: .././repair/dinode.c:1461
 #, c-format
 msgid "size of block device inode %<PRIu64> != 0 (%<PRId64> bytes)\n"
-msgstr "rozmiar i-węzła urządzenia blokowego %<PRIu64> != 0 (%<PRId64> bajtów)\n"
+msgstr ""
+"rozmiar i-węzła urządzenia blokowego %<PRIu64> != 0 (%<PRId64> bajtów)\n"
 
-#: .././repair/dinode.c:1449
+#: .././repair/dinode.c:1466
 #, c-format
 msgid "size of socket inode %<PRIu64> != 0 (%<PRId64> bytes)\n"
 msgstr "rozmiar i-węzła gniazda %<PRIu64> != 0 (%<PRId64> bajtów)\n"
 
-#: .././repair/dinode.c:1454
+#: .././repair/dinode.c:1471
 #, c-format
 msgid "size of fifo inode %<PRIu64> != 0 (%<PRId64> bytes)\n"
 msgstr "rozmiar i-węzła potoku %<PRIu64> != 0 (%<PRId64> bajtów)\n"
 
-#: .././repair/dinode.c:1458
+#: .././repair/dinode.c:1475
 #, c-format
 msgid "Internal error - process_misc_ino_types, illegal type %d\n"
 msgstr "Błąd wewnętrzny - process_misc_ino_types, niedozwolony typ %d\n"
 
-#: .././repair/dinode.c:1485
+#: .././repair/dinode.c:1502
 #, c-format
 msgid "size of character device inode %<PRIu64> != 0 (%<PRIu64> blocks)\n"
-msgstr "rozmiar i-węzła urządzenia znakowego %<PRIu64> != 0 (%<PRIu64> bloków)\n"
+msgstr ""
+"rozmiar i-węzła urządzenia znakowego %<PRIu64> != 0 (%<PRIu64> bloków)\n"
 
-#: .././repair/dinode.c:1490
+#: .././repair/dinode.c:1507
 #, c-format
 msgid "size of block device inode %<PRIu64> != 0 (%<PRIu64> blocks)\n"
-msgstr "rozmiar i-węzła urządzenia blokowego %<PRIu64> != 0 (%<PRIu64> bloków)\n"
+msgstr ""
+"rozmiar i-węzła urządzenia blokowego %<PRIu64> != 0 (%<PRIu64> bloków)\n"
 
-#: .././repair/dinode.c:1495
+#: .././repair/dinode.c:1512
 #, c-format
 msgid "size of socket inode %<PRIu64> != 0 (%<PRIu64> blocks)\n"
 msgstr "rozmiar i-węzła gniazda %<PRIu64> != 0 (%<PRIu64> bloków)\n"
 
-#: .././repair/dinode.c:1500
+#: .././repair/dinode.c:1517
 #, c-format
 msgid "size of fifo inode %<PRIu64> != 0 (%<PRIu64> blocks)\n"
 msgstr "rozmiar i-węzła potoku %<PRIu64> != 0 (%<PRIu64> bloków)\n"
 
-#: .././repair/dinode.c:1578
+#: .././repair/dinode.c:1595
 #, c-format
 msgid "root inode %<PRIu64> has bad type 0x%x\n"
 msgstr "i-węzeł główny %<PRIu64> ma błędny typ 0x%x\n"
 
-#: .././repair/dinode.c:1582
+#: .././repair/dinode.c:1599
 msgid "resetting to directory\n"
 msgstr "przestawiono na katalog\n"
 
-#: .././repair/dinode.c:1586
+#: .././repair/dinode.c:1603
 msgid "would reset to directory\n"
 msgstr "zostałby przestawiony na katalog\n"
 
-#: .././repair/dinode.c:1592
+#: .././repair/dinode.c:1609
 #, c-format
 msgid "user quota inode %<PRIu64> has bad type 0x%x\n"
 msgstr "i-węzeł limitu użytkownika %<PRIu64> ma błędny typ 0x%x\n"
 
-#: .././repair/dinode.c:1601
+#: .././repair/dinode.c:1618
 #, c-format
 msgid "group quota inode %<PRIu64> has bad type 0x%x\n"
 msgstr "i-węzeł limitu grupy %<PRIu64> ma błędny typ 0x%x\n"
 
-#: .././repair/dinode.c:1610
+#: .././repair/dinode.c:1627
 #, c-format
 msgid "project quota inode %<PRIu64> has bad type 0x%x\n"
 msgstr "i-węzeł limitu projektu %<PRIu64> ma błędny typ 0x%x\n"
 
-#: .././repair/dinode.c:1620
+#: .././repair/dinode.c:1637
 #, c-format
 msgid "realtime summary inode %<PRIu64> has bad type 0x%x, "
 msgstr "i-węzeł opisu realtime %<PRIu64> ma błędny typ 0x%x, "
 
-#: .././repair/dinode.c:1623 .././repair/dinode.c:1644
+#: .././repair/dinode.c:1640 .././repair/dinode.c:1661
 msgid "resetting to regular file\n"
 msgstr "przestawiono na zwykły plik\n"
 
-#: .././repair/dinode.c:1627 .././repair/dinode.c:1648
+#: .././repair/dinode.c:1644 .././repair/dinode.c:1665
 msgid "would reset to regular file\n"
 msgstr "zostałby przestawiony na zwykły plik\n"
 
-#: .././repair/dinode.c:1632
+#: .././repair/dinode.c:1649
 #, c-format
 msgid "bad # of extents (%u) for realtime summary inode %<PRIu64>\n"
-msgstr "błędna liczba ekstentów (%u) dla i-węzłą opisu realtime %<PRIu64>\n"
+msgstr "błędna liczba ekstentów (%u) dla i-węzła opisu realtime %<PRIu64>\n"
 
-#: .././repair/dinode.c:1641
+#: .././repair/dinode.c:1658
 #, c-format
 msgid "realtime bitmap inode %<PRIu64> has bad type 0x%x, "
 msgstr "i-węzeł bitmapy realtime %<PRIu64> ma błędny typ 0x%x, "
 
-#: .././repair/dinode.c:1653
+#: .././repair/dinode.c:1670
 #, c-format
 msgid "bad # of extents (%u) for realtime bitmap inode %<PRIu64>\n"
-msgstr "błędna liczba ekstentów (%u) dla i-węzłą bitmapy realtime %<PRIu64>\n"
+msgstr "błędna liczba ekstentów (%u) dla i-węzła bitmapy realtime %<PRIu64>\n"
 
-#: .././repair/dinode.c:1688
+#: .././repair/dinode.c:1705
 #, c-format
-msgid "mismatch between format (%d) and size (%<PRId64>) in directory ino %<PRIu64>\n"
-msgstr "niezgodność między formatem (%d) a rozmiarem (%<PRId64>) w i-węźle katalogu %<PRIu64>\n"
+msgid ""
+"mismatch between format (%d) and size (%<PRId64>) in directory ino "
+"%<PRIu64>\n"
+msgstr ""
+"niezgodność między formatem (%d) a rozmiarem (%<PRId64>) w i-węźle katalogu "
+"%<PRIu64>\n"
 
-#: .././repair/dinode.c:1694
+#: .././repair/dinode.c:1711
 #, c-format
 msgid "directory inode %<PRIu64> has bad size %<PRId64>\n"
 msgstr "i-węzeł katalogu %<PRIu64> ma błędny rozmiar %<PRId64>\n"
 
-#: .././repair/dinode.c:1702
+#: .././repair/dinode.c:1719
 #, c-format
 msgid "bad data fork in symlink %<PRIu64>\n"
 msgstr "błędna gałąź danych w dowiązaniu symbolicznym %<PRIu64>\n"
 
-#: .././repair/dinode.c:1723
+#: .././repair/dinode.c:1740
 #, c-format
 msgid "found inode %<PRIu64> claiming to be a real-time file\n"
 msgstr "znaleziono i-węzeł %<PRIu64> twierdzący, że należy do pliku realtime\n"
 
-#: .././repair/dinode.c:1732
+#: .././repair/dinode.c:1749
 #, c-format
-msgid "realtime bitmap inode %<PRIu64> has bad size %<PRId64> (should be %<PRIu64>)\n"
-msgstr "i-węzeł bitmapy realtime %<PRIu64> ma błędny rozmiar %<PRId64> (powinien być %<PRIu64>)\n"
+msgid ""
+"realtime bitmap inode %<PRIu64> has bad size %<PRId64> (should be "
+"%<PRIu64>)\n"
+msgstr ""
+"i-węzeł bitmapy realtime %<PRIu64> ma błędny rozmiar %<PRId64> (powinien być "
+"%<PRIu64>)\n"
 
-#: .././repair/dinode.c:1743
+#: .././repair/dinode.c:1760
 #, c-format
-msgid "realtime summary inode %<PRIu64> has bad size %<PRId64> (should be %d)\n"
-msgstr "i-węzeł opisu realtime %<PRIu64> ma błędny rozmiar %<PRId64> (powinien być %d)\n"
+msgid ""
+"realtime summary inode %<PRIu64> has bad size %<PRId64> (should be %d)\n"
+msgstr ""
+"i-węzeł opisu realtime %<PRIu64> ma błędny rozmiar %<PRId64> (powinien być "
+"%d)\n"
 
-#: .././repair/dinode.c:1771
+#: .././repair/dinode.c:1788
 #, c-format
 msgid "bad attr fork offset %d in dev inode %<PRIu64>, should be %d\n"
-msgstr "błędny offset gałęzi atrybutów %d w i-węźle urządzenia %<PRIu64>, powinien być %d\n"
+msgstr ""
+"błędny offset gałęzi atrybutów %d w i-węźle urządzenia %<PRIu64>, powinien "
+"być %d\n"
 
-#: .././repair/dinode.c:1783
+#: .././repair/dinode.c:1800
 #, c-format
 msgid "bad attr fork offset %d in inode %<PRIu64>, max=%d\n"
 msgstr "błędny offset gałęzi atrybutów %d w i-węźle %<PRIu64>, maksimum=%d\n"
 
-#: .././repair/dinode.c:1790
+#: .././repair/dinode.c:1807
 #, c-format
 msgid "unexpected inode format %d\n"
 msgstr "nieoczekiwany format i-węzła %d\n"
 
-#: .././repair/dinode.c:1811
+#: .././repair/dinode.c:1828
 #, c-format
 msgid "correcting nblocks for inode %<PRIu64>, was %llu - counted %<PRIu64>\n"
-msgstr "poprawiono nblocks dla i-węzła %<PRIu64> - było %llu, naliczono %<PRIu64>\n"
+msgstr ""
+"poprawiono nblocks dla i-węzła %<PRIu64> - było %llu, naliczono %<PRIu64>\n"
 
-#: .././repair/dinode.c:1818
+#: .././repair/dinode.c:1835
 #, c-format
 msgid "bad nblocks %llu for inode %<PRIu64>, would reset to %<PRIu64>\n"
-msgstr "błędne nblocks %llu dla i-węzła %<PRIu64>, zostałoby przestawione na %<PRIu64>\n"
+msgstr ""
+"błędne nblocks %llu dla i-węzła %<PRIu64>, zostałoby przestawione na "
+"%<PRIu64>\n"
 
-#: .././repair/dinode.c:1826
+#: .././repair/dinode.c:1843
 #, c-format
 msgid "too many data fork extents (%<PRIu64>) in inode %<PRIu64>\n"
 msgstr "zbyt dużo ekstentów gałęzi danych (%<PRIu64>) w i-węźle %<PRIu64>\n"
 
-#: .././repair/dinode.c:1833
+#: .././repair/dinode.c:1850
 #, c-format
 msgid "correcting nextents for inode %<PRIu64>, was %d - counted %<PRIu64>\n"
-msgstr "poprawiono nextents dla i-węzła %<PRIu64> - było %d, naliczono %<PRIu64>\n"
+msgstr ""
+"poprawiono nextents dla i-węzła %<PRIu64> - było %d, naliczono %<PRIu64>\n"
 
-#: .././repair/dinode.c:1841
+#: .././repair/dinode.c:1858
 #, c-format
 msgid "bad nextents %d for inode %<PRIu64>, would reset to %<PRIu64>\n"
-msgstr "błędne nextents %d dla i-węzła %<PRIu64>, zostałoby przestawione na %<PRIu64>\n"
+msgstr ""
+"błędne nextents %d dla i-węzła %<PRIu64>, zostałoby przestawione na "
+"%<PRIu64>\n"
 
-#: .././repair/dinode.c:1849
+#: .././repair/dinode.c:1866
 #, c-format
 msgid "too many attr fork extents (%<PRIu64>) in inode %<PRIu64>\n"
 msgstr "zbyt dużo ekstentów gałęzi atrybutów (%<PRIu64>) w i-węźle %<PRIu64>\n"
 
-#: .././repair/dinode.c:1856
+#: .././repair/dinode.c:1873
 #, c-format
 msgid "correcting anextents for inode %<PRIu64>, was %d - counted %<PRIu64>\n"
-msgstr "poprawiono anextents dla i-węzła %<PRIu64> - było %d, naliczono %<PRIu64>\n"
+msgstr ""
+"poprawiono anextents dla i-węzła %<PRIu64> - było %d, naliczono %<PRIu64>\n"
 
-#: .././repair/dinode.c:1863
+#: .././repair/dinode.c:1880
 #, c-format
 msgid "bad anextents %d for inode %<PRIu64>, would reset to %<PRIu64>\n"
-msgstr "błędne anextents %d dla i-węzła %<PRIu64>, zostałoby przestawione na %<PRIu64>\n"
+msgstr ""
+"błędne anextents %d dla i-węzła %<PRIu64>, zostałoby przestawione na "
+"%<PRIu64>\n"
 
-#: .././repair/dinode.c:1875
+#: .././repair/dinode.c:1892
 #, c-format
 msgid "nblocks (%<PRIu64>) smaller than nextents for inode %<PRIu64>\n"
 msgstr "nblocks (%<PRIu64>) mniejsze niż nextents dla i-węzła %<PRIu64>\n"
 
-#: .././repair/dinode.c:1940 .././repair/dinode.c:1978
+#: .././repair/dinode.c:1957 .././repair/dinode.c:1995
 #, c-format
 msgid "unknown format %d, ino %<PRIu64> (mode = %d)\n"
 msgstr "nieznany format %d, i-węzeł %<PRIu64> (tryb = %d)\n"
 
-#: .././repair/dinode.c:1945
+#: .././repair/dinode.c:1962
 #, c-format
 msgid "bad data fork in inode %<PRIu64>\n"
 msgstr "błędna gałąź danych w i-węźle %<PRIu64>\n"
 
-#: .././repair/dinode.c:2016
+#: .././repair/dinode.c:2033
 #, c-format
 msgid "bad attribute format %d in inode %<PRIu64>, "
 msgstr "błędny format atrybutów %d w i-węźle %<PRIu64>, "
 
-#: .././repair/dinode.c:2019
+#: .././repair/dinode.c:2036
 msgid "resetting value\n"
 msgstr "przestawiono wartość\n"
 
-#: .././repair/dinode.c:2023
+#: .././repair/dinode.c:2040
 msgid "would reset value\n"
 msgstr "wartość zostałaby przestawiona\n"
 
-#: .././repair/dinode.c:2068
+#: .././repair/dinode.c:2085
 #, c-format
 msgid "bad attribute fork in inode %<PRIu64>"
 msgstr "błędna gałąź atrybutów w i-węźle %<PRIu64>"
 
-#: .././repair/dinode.c:2072
+#: .././repair/dinode.c:2089
 msgid ", clearing attr fork\n"
 msgstr ", wyczyszczono gałąź atrybutów\n"
 
-#: .././repair/dinode.c:2081
+#: .././repair/dinode.c:2098
 msgid ", would clear attr fork\n"
 msgstr ", gałąź atrybutów zostałaby wyczyszczona\n"
 
-#: .././repair/dinode.c:2109
+#: .././repair/dinode.c:2126
 #, c-format
 msgid "illegal attribute fmt %d, ino %<PRIu64>\n"
 msgstr "niedozwolony format atrybutów %d, i-węzeł %<PRIu64>\n"
 
-#: .././repair/dinode.c:2129
+#: .././repair/dinode.c:2146
 #, c-format
 msgid "problem with attribute contents in inode %<PRIu64>\n"
 msgstr "problem z zawartością atrybutu w i-węźle %<PRIu64>\n"
 
-#: .././repair/dinode.c:2137
+#: .././repair/dinode.c:2154
 msgid "would clear attr fork\n"
 msgstr "gałąź atrybutów zostałaby wyczyszczona\n"
 
-#: .././repair/dinode.c:2180
-#, c-format
-msgid "version 2 inode %<PRIu64> claims > %u links, "
-msgstr "i-węzeł %<PRIu64> w wersji 2 odwołuje się do > %u dowiązań, "
-
-#: .././repair/dinode.c:2184
-msgid "updating superblock version number\n"
-msgstr "uaktualniono numer wersji superbloku\n"
-
 #: .././repair/dinode.c:2187
-msgid "would update superblock version number\n"
-msgstr "numer wersji superbloku zostałby uaktualniony\n"
-
-#: .././repair/dinode.c:2195
-#, c-format
-msgid "WARNING:  version 2 inode %<PRIu64> claims > %u links, "
-msgstr "UWAGA: i-węzeł %<PRIu64> w wersji 2 odwołuje się do > %u dowiązań, "
-
-#: .././repair/dinode.c:2198
 #, c-format
 msgid ""
-"converting back to version 1,\n"
-"this may destroy %d links\n"
+"clearing obsolete nlink field in version 2 inode %<PRIu64>, was %d, now 0\n"
 msgstr ""
-"przekształcanie z powrotem do wersji 1,\n"
-"może to zniszczyć %d dowiązań\n"
+"wyczyszczono przestarzałe pole nlink w i-węźle %<PRIu64> w wersji 2 - było "
+"%d, jest 0\n"
 
-#: .././repair/dinode.c:2208
+#: .././repair/dinode.c:2193
 #, c-format
 msgid ""
-"would convert back to version 1,\n"
-"\tthis might destroy %d links\n"
+"would clear obsolete nlink field in version 2 inode %<PRIu64>, currently %d\n"
 msgstr ""
-"zostałby przekształcony z powrotem do wersji 1,\n"
-"\tco mogłoby zniszczyć %d dowiązań\n"
+"przestarzałe pole nlink w i-węźle %<PRIu64> w wersji 2 zostałoby "
+"wyczyszczone, aktualnie %d\n"
 
-#: .././repair/dinode.c:2223
+#: .././repair/dinode.c:2272
 #, c-format
-msgid "found version 2 inode %<PRIu64>, "
-msgstr "znaleziono i-węzeł %<PRIu64> w wersji 2, "
+msgid "bad CRC for inode %<PRIu64>%c"
+msgstr "błędne CRC dla i-węzła %<PRIu64>%c"
 
-#: .././repair/dinode.c:2225
-msgid "converting back to version 1\n"
-msgstr "przekształcono z powrotem do wersji 1\n"
+#: .././repair/dinode.c:2276
+msgid " will rewrite\n"
+msgstr " zostanie poprawione\n"
 
-#: .././repair/dinode.c:2231
-msgid "would convert back to version 1\n"
-msgstr "zostałby przekształcony z powrotem do wersji 1\n"
-
-#: .././repair/dinode.c:2245
-#, c-format
-msgid "clearing obsolete nlink field in version 2 inode %<PRIu64>, was %d, now 0\n"
-msgstr "wyczyszczono przestarzałe pole nlink w i-węźle %<PRIu64> w wersji 2 - było %d, jest 0\n"
-
-#: .././repair/dinode.c:2251
-#, c-format
-msgid "would clear obsolete nlink field in version 2 inode %<PRIu64>, currently %d\n"
-msgstr "przestarzałe pole nlink w i-węźle %<PRIu64> w wersji 2 zostałoby wyczyszczone, aktualnie %d\n"
+#: .././repair/dinode.c:2279
+msgid " would rewrite\n"
+msgstr " zostałoby poprawione\n"
 
-#: .././repair/dinode.c:2320
+#: .././repair/dinode.c:2286
 #, c-format
 msgid "bad magic number 0x%x on inode %<PRIu64>%c"
 msgstr "błędna liczba magiczna 0x%x w i-węźle %<PRIu64>%c"
 
-#: .././repair/dinode.c:2325
+#: .././repair/dinode.c:2291
 msgid " resetting magic number\n"
 msgstr " przestawiono liczbę magiczną\n"
 
-#: .././repair/dinode.c:2329
+#: .././repair/dinode.c:2295
 msgid " would reset magic number\n"
 msgstr " liczba magiczna zostałaby przestawiona\n"
 
-#: .././repair/dinode.c:2338
+#: .././repair/dinode.c:2302
 #, c-format
 msgid "bad version number 0x%x on inode %<PRIu64>%c"
 msgstr "błędny numer wersji 0x%x w i-węźle %<PRIu64>%c"
 
-#: .././repair/dinode.c:2343
+#: .././repair/dinode.c:2307
 msgid " resetting version number\n"
 msgstr " przestawiono numer wersji\n"
 
-#: .././repair/dinode.c:2349
+#: .././repair/dinode.c:2312
 msgid " would reset version number\n"
 msgstr " numer wersji zostałby przestawiony\n"
 
-#: .././repair/dinode.c:2362
+#: .././repair/dinode.c:2325
 #, c-format
 msgid "inode identifier %llu mismatch on inode %<PRIu64>\n"
 msgstr "niezgodność identyfikatora i-węzła %llu dla i-węzła %<PRIu64>\n"
 
-#: .././repair/dinode.c:2371
+#: .././repair/dinode.c:2335
 #, c-format
 msgid "UUID mismatch on inode %<PRIu64>\n"
 msgstr "niezgodność UUID-a dla i-węzła %<PRIu64>\n"
 
-#: .././repair/dinode.c:2384
+#: .././repair/dinode.c:2348
 #, c-format
 msgid "bad (negative) size %<PRId64> on inode %<PRIu64>\n"
 msgstr "błędny (ujemny) rozmiar %<PRId64> w i-węźle %<PRIu64>\n"
 
-#: .././repair/dinode.c:2417
+#: .././repair/dinode.c:2381
 #, c-format
 msgid "imap claims a free inode %<PRIu64> is in use, "
 msgstr "imap odwołuje się do wolnego bloku %<PRIu64>, który jest w użyciu, "
 
-#: .././repair/dinode.c:2419
+#: .././repair/dinode.c:2383
 msgid "correcting imap and clearing inode\n"
 msgstr "poprawiono imap i wyczyszczono i-węzeł\n"
 
-#: .././repair/dinode.c:2423
+#: .././repair/dinode.c:2387
 msgid "would correct imap and clear inode\n"
 msgstr "poprawiono by imap i wyczyszczono by i-węzeł\n"
 
-#: .././repair/dinode.c:2440
+#: .././repair/dinode.c:2404
 #, c-format
 msgid "bad inode format in inode %<PRIu64>\n"
 msgstr "błędny format i-węzła w i-węźle %<PRIu64>\n"
 
-#: .././repair/dinode.c:2456
+#: .././repair/dinode.c:2420
 #, c-format
 msgid "Bad flags set in inode %<PRIu64>\n"
 msgstr "Błędne flagi ustawione w i-węźle %<PRIu64>\n"
 
-#: .././repair/dinode.c:2467
+#: .././repair/dinode.c:2431
 #, c-format
 msgid "inode %<PRIu64> has RT flag set but there is no RT device\n"
 msgstr "i-węzeł %<PRIu64> ma ustawioną flagę RT, ale nie ma urządzenia RT\n"
 
-#: .././repair/dinode.c:2479
+#: .././repair/dinode.c:2443
 #, c-format
 msgid "inode %<PRIu64> not rt bitmap\n"
 msgstr "i-węzeł %<PRIu64> nie jest bitmapą rt\n"
 
-#: .././repair/dinode.c:2493
+#: .././repair/dinode.c:2457
 #, c-format
 msgid "directory flags set on non-directory inode %<PRIu64>\n"
-msgstr "flagi katalogu ustawione dla nie będącego katalogiem i-węzła %<PRIu64>\n"
+msgstr ""
+"flagi katalogu ustawione dla nie będącego katalogiem i-węzła %<PRIu64>\n"
 
-#: .././repair/dinode.c:2507
+#: .././repair/dinode.c:2471
 #, c-format
 msgid "file flags set on non-file inode %<PRIu64>\n"
 msgstr "flagi pliku ustawione dla nie będącego plikiem i-węzła %<PRIu64>\n"
 
-#: .././repair/dinode.c:2516
-msgid ", fixing bad flags.\n"
-msgstr ", poprawiono błędne flagi.\n"
-
-#: .././repair/dinode.c:2520
-msgid ", would fix bad flags.\n"
-msgstr ", poprawionoby błędne flagi.\n"
-
-#: .././repair/dinode.c:2571
-#, c-format
-msgid "bad inode type %#o inode %<PRIu64>\n"
-msgstr "błędny typ i-węzła %#o w i-węźle %<PRIu64>\n"
-
-#: .././repair/dinode.c:2595
-#, c-format
-msgid "bad non-zero extent size %u for non-realtime/extsize inode %<PRIu64>, "
-msgstr "błędny niezerowy rozmiar ekstentu %u dla extsize i-węzła nie-realtime %<PRIu64>, "
-
-#: .././repair/dinode.c:2598
-msgid "resetting to zero\n"
-msgstr "przestawiono na zero\n"
-
-#: .././repair/dinode.c:2602
-msgid "would reset to zero\n"
-msgstr "zostałby przestawiony na zero\n"
-
-#: .././repair/dinode.c:2655
-#, c-format
-msgid "problem with directory contents in inode %<PRIu64>\n"
-msgstr "problem z zawartością katalogu w i-węźle %<PRIu64>\n"
-
-#: .././repair/dinode.c:2663
-#, c-format
-msgid "problem with symbolic link in inode %<PRIu64>\n"
-msgstr "problem z dowiązaniem symbolicznym w i-węźle %<PRIu64>\n"
-
-#: .././repair/dinode.c:2758
-#, c-format
-msgid "processing inode %d/%d\n"
-msgstr "analiza i-węzła %d/%d\n"
-
-#: .././repair/dir2.c:49
-#, c-format
-msgid "malloc failed (%zu bytes) dir2_add_badlist:ino %<PRIu64>\n"
-msgstr "malloc nie powiodło się (%zu bajtów) w dir2_add_badlist:ino %<PRIu64>\n"
+#: .././repair/dinode.c:2480
+msgid "fixing bad flags.\n"
+msgstr "poprawiono błędne flagi.\n"
 
-#: .././repair/dir2.c:111 .././repair/prefetch.c:238
-msgid "couldn't malloc dir2 buffer list\n"
-msgstr "nie można przydzielić listy bufora dir2\n"
+#: .././repair/dinode.c:2484
+msgid "would fix bad flags.\n"
+msgstr "poprawionoby błędne flagi.\n"
 
-#: .././repair/dir2.c:174 .././repair/dir2.c:541 .././repair/dir2.c:1597
+#: .././repair/dinode.c:2499
 #, c-format
-msgid "can't read block %u for directory inode %<PRIu64>\n"
-msgstr "nie można odczytać bloku %u dla i-węzła katalogu %<PRIu64>\n"
+msgid "Bad flags2 set in inode %<PRIu64>\n"
+msgstr "Błędne flags2 ustawione w i-węźle %<PRIu64>\n"
 
-#: .././repair/dir2.c:186
+#: .././repair/dinode.c:2509
 #, c-format
-msgid "found non-root LEAFN node in inode %<PRIu64> bno = %u\n"
-msgstr "znaleziono niegłówny węzeł LEAFN w i-węźle %<PRIu64> bno = %u\n"
+msgid ""
+"inode %<PRIu64> is marked reflinked but file system does not support "
+"reflink\n"
+msgstr ""
+"i-węzeł %<PRIu64> oznaczony jako dowiązany, ale system plików nie obsługuje funkcji reflink\n"
 
-#: .././repair/dir2.c:196
+#: .././repair/dinode.c:2520
 #, c-format
-msgid "bad dir magic number 0x%x in inode %<PRIu64> bno = %u\n"
-msgstr "błędna liczba magiczna katalogu 0x%x w i-węźle %<PRIu64> bno = %u\n"
+msgid "reflink flag set on non-file inode %<PRIu64>\n"
+msgstr "flaga reflink ustawiona dla nie będącego plikiem i-węzła %<PRIu64>\n"
 
-#: .././repair/dir2.c:218
+#: .././repair/dinode.c:2531
 #, c-format
-msgid "bad header depth for directory inode %<PRIu64>\n"
-msgstr "błędna głębokość nagłówka dla i-węzła katalogu %<PRIu64>\n"
+msgid "Cannot have a reflinked realtime inode %<PRIu64>\n"
+msgstr "Nie można mieć dowiązanego i-węzla realtime %<PRIu64>\n"
 
-#: .././repair/dir2.c:278
+#: .././repair/dinode.c:2541
 #, c-format
-msgid "release_dir2_cursor_int got unexpected non-null bp, dabno = %u\n"
-msgstr "release_dir2_cursor_int otrzymał nieoczekiwany niezerowy bp, dabno = %u\n"
+msgid ""
+"inode %<PRIu64> has CoW extent size hint but file system does not support "
+"reflink\n"
+msgstr "i-węzeł %<PRIu64> ma rozmiar ekstentu CoW, ale system plików nie obsługuje funkcji reflink\n"
 
-#: .././repair/dir2.c:345
+#: .././repair/dinode.c:2552
 #, c-format
-msgid "directory block used/count inconsistency - %d / %hu\n"
-msgstr "niespójność wartości used/count bloku katalogu - %d / %hu\n"
+msgid "CoW extent size flag set on non-file, non-directory inode %<PRIu64>\n"
+msgstr "rozmiar ekstentu CoW ostawiony dla nie będącego plikiem ani katalogiem i-węzła %<PRIu64>\n"
 
-#: .././repair/dir2.c:367
+#: .././repair/dinode.c:2563
 #, c-format
-msgid "bad directory block in inode %<PRIu64>\n"
-msgstr "błędny blok katalogu w i-węźle %<PRIu64>\n"
+msgid "Cannot have CoW extent size hint on a realtime inode %<PRIu64>\n"
+msgstr "Nie mozna mieć rozmiaru ekstentu CoW dla i-węzła realtime %<PRIu64>\n"
+
+#: .././repair/dinode.c:2571
+msgid "fixing bad flags2.\n"
+msgstr "poprawiono błędne flags2.\n"
 
-#: .././repair/dir2.c:387
+#: .././repair/dinode.c:2575
+msgid "would fix bad flags2.\n"
+msgstr "poprawionoby błędne flags2.\n"
+
+#: .././repair/dinode.c:2626
 #, c-format
-msgid ""
-"correcting bad hashval in non-leaf dir block\n"
-"\tin (level %d) in inode %<PRIu64>.\n"
-msgstr ""
-"poprawiono błędne hashval w bloku katalogu nie będącego liściem\n"
-"\tw i-węźle (poziomu %d) %<PRIu64>.\n"
+msgid "bad inode type %#o inode %<PRIu64>\n"
+msgstr "błędny typ i-węzła %#o w i-węźle %<PRIu64>\n"
 
-#: .././repair/dir2.c:395
+#: .././repair/dinode.c:2650
 #, c-format
-msgid ""
-"would correct bad hashval in non-leaf dir block\n"
-"\tin (level %d) in inode %<PRIu64>.\n"
+msgid "bad non-zero extent size %u for non-realtime/extsize inode %<PRIu64>, "
 msgstr ""
-"błędne hashval w bloku katalogu nie będącego liściem zostałoby poprawione\n"
-"\tw i-węźle (poziomu %d) %<PRIu64>.\n"
+"błędny niezerowy rozmiar ekstentu %u dla extsize i-węzła nie-realtime "
+"%<PRIu64>, "
 
-#: .././repair/dir2.c:557
-#, c-format
-msgid "bad magic number %x in block %u for directory inode %<PRIu64>\n"
-msgstr "błędna liczba magiczna %x w bloku %u dla i-węzła katalogu %<PRIu64>\n"
+#: .././repair/dinode.c:2653 .././repair/dinode.c:2676
+msgid "resetting to zero\n"
+msgstr "przestawiono na zero\n"
+
+#: .././repair/dinode.c:2657 .././repair/dinode.c:2680
+msgid "would reset to zero\n"
+msgstr "zostałby przestawiony na zero\n"
 
-#: .././repair/dir2.c:564
+#: .././repair/dinode.c:2673
 #, c-format
-msgid "bad back pointer in block %u for directory inode %<PRIu64>\n"
-msgstr "błędny wskaźnik wstecz w bloku %u dla i-węzła katalogu %<PRIu64>\n"
+msgid ""
+"Cannot have non-zero CoW extent size %u on non-cowextsize inode %<PRIu64>, "
+msgstr ""
+"Nie można mieć niezerowego rozmiaru ekstentu CoW %u na i-węźle bez cowextsize %<PRIu64>, "
 
-#: .././repair/dir2.c:570
+#: .././repair/dinode.c:2739
 #, c-format
-msgid "entry count %d too large in block %u for directory inode %<PRIu64>\n"
-msgstr "liczba wpisów %d zbyt duża w bloku %u dla i-węzła katalogu %<PRIu64>\n"
+msgid "problem with directory contents in inode %<PRIu64>\n"
+msgstr "problem z zawartością katalogu w i-węźle %<PRIu64>\n"
 
-#: .././repair/dir2.c:577
+#: .././repair/dinode.c:2747
 #, c-format
-msgid "bad level %d in block %u for directory inode %<PRIu64>\n"
-msgstr "błędny poziom %d w bloku %u dla i-węzła katalogu %<PRIu64>\n"
+msgid "problem with symbolic link in inode %<PRIu64>\n"
+msgstr "problem z dowiązaniem symbolicznym w i-węźle %<PRIu64>\n"
 
-#: .././repair/dir2.c:624
+#: .././repair/dinode.c:2842
 #, c-format
-msgid ""
-"correcting bad hashval in interior dir block\n"
-"\tin (level %d) in inode %<PRIu64>.\n"
-msgstr ""
-"poprawiono błędne hashval w wewnętrznym bloku katalogu\n"
-"\tw i-węźle (poziomu %d) %<PRIu64>.\n"
+msgid "processing inode %d/%d\n"
+msgstr "analiza i-węzła %d/%d\n"
 
-#: .././repair/dir2.c:632
+#: .././repair/dir2.c:50
 #, c-format
-msgid ""
-"would correct bad hashval in interior dir block\n"
-"\tin (level %d) in inode %<PRIu64>.\n"
+msgid "malloc failed (%zu bytes) dir2_add_badlist:ino %<PRIu64>\n"
 msgstr ""
-"błędne hashval w wewnętrznym bloku katalogu zostałoby poprawione\n"
-"\tw i-węźle (poziomu %d) %<PRIu64>.\n"
+"malloc nie powiodło się (%zu bajtów) w dir2_add_badlist:ino %<PRIu64>\n"
 
-#: .././repair/dir2.c:667
+#: .././repair/dir2.c:93
 msgid "couldn't malloc dir2 shortform copy\n"
 msgstr "nie udało się przydzielić krótkiej kopii dir2\n"
 
-#: .././repair/dir2.c:803
+#: .././repair/dir2.c:229
 msgid "current"
 msgstr "bieżącego i-węzła"
 
-#: .././repair/dir2.c:806 .././repair/dir2.c:1328
+#: .././repair/dir2.c:232 .././repair/dir2.c:693
 msgid "invalid"
 msgstr "nieprawidłowego i-węzła"
 
-#: .././repair/dir2.c:809 .././repair/dir2.c:1330
+#: .././repair/dir2.c:235 .././repair/dir2.c:695
 msgid "realtime bitmap"
 msgstr "i-węzła bitmapy realtime"
 
-#: .././repair/dir2.c:812 .././repair/dir2.c:1332
+#: .././repair/dir2.c:238 .././repair/dir2.c:697
 msgid "realtime summary"
 msgstr "i-węzła opisu realtime"
 
-#: .././repair/dir2.c:815 .././repair/dir2.c:1334
+#: .././repair/dir2.c:241 .././repair/dir2.c:699
 msgid "user quota"
 msgstr "i-węzła limitów użytkownika"
 
-#: .././repair/dir2.c:818 .././repair/dir2.c:1336
+#: .././repair/dir2.c:244 .././repair/dir2.c:701
 msgid "group quota"
 msgstr "i-węzła limitów grupy"
 
-#: .././repair/dir2.c:821 .././repair/dir2.c:1338
+#: .././repair/dir2.c:247 .././repair/dir2.c:703
 msgid "project quota"
 msgstr "i-węzła limitów projektu"
 
-#: .././repair/dir2.c:839 .././repair/dir2.c:1368
+#: .././repair/dir2.c:265 .././repair/dir2.c:733
 msgid "free"
 msgstr "free"
 
-#: .././repair/dir2.c:856 .././repair/dir2.c:1348
+#: .././repair/dir2.c:282 .././repair/dir2.c:713
 msgid "non-existent"
 msgstr "nie istniejącego i-węzła"
 
-#: .././repair/dir2.c:861
+#: .././repair/dir2.c:287
 #, c-format
-msgid "entry \"%*.*s\" in shortform directory %<PRIu64> references %s inode %<PRIu64>\n"
-msgstr "wpis \"%*.*s\" w krótkim katalogu %<PRIu64> odwołuje się do %s %<PRIu64>\n"
+msgid ""
+"entry \"%*.*s\" in shortform directory %<PRIu64> references %s inode "
+"%<PRIu64>\n"
+msgstr ""
+"wpis \"%*.*s\" w krótkim katalogu %<PRIu64> odwołuje się do %s %<PRIu64>\n"
 
-#: .././repair/dir2.c:881
-#, c-format
-msgid "zero length entry in shortform dir %<PRIu64>, resetting to %d\n"
-msgstr "wpis zerowej długości w krótkim katalogu %<PRIu64>, przestawiono na %d\n"
+#: .././repair/dir2.c:293
+msgid "is zero length"
+msgstr "jest zerowej długości"
 
-#: .././repair/dir2.c:886
-#, c-format
-msgid "zero length entry in shortform dir %<PRIu64>, would set to %d\n"
-msgstr "wpis zerowej długości w krótkim katalogu %<PRIu64>, zostałby przestawiony na %d\n"
+#: .././repair/dir2.c:298
+msgid "extends past end of dir"
+msgstr "wykracza poza koniec katalogu"
 
-#: .././repair/dir2.c:891
+#: .././repair/dir2.c:304
 #, c-format
-msgid "zero length entry in shortform dir %<PRIu64>"
-msgstr "wpis zerowej długości w krótkim katalogu %<PRIu64>"
+msgid "entry #%d %s in shortform dir %<PRIu64>"
+msgstr "wpis #%d %s w krótkim katalogu %<PRIu64>"
 
-#: .././repair/dir2.c:894
+#: .././repair/dir2.c:307
 #, c-format
 msgid ", junking %d entries\n"
 msgstr ", wyrzucono %d wpisów\n"
 
-#: .././repair/dir2.c:897
+#: .././repair/dir2.c:310
 #, c-format
 msgid ", would junk %d entries\n"
 msgstr ", %d wpisów zostałoby wyrzucone\n"
 
-#: .././repair/dir2.c:915
-#, c-format
-msgid "size of last entry overflows space left in in shortform dir %<PRIu64>, "
-msgstr "rozmiar ostatniego wpisu przekracza miejsce pozostałe w krótkim katalogu %<PRIu64>, "
-
-#: .././repair/dir2.c:918
-#, c-format
-msgid "resetting to %d\n"
-msgstr "przestawiono na %d\n"
-
-#: .././repair/dir2.c:923
-#, c-format
-msgid "would reset to %d\n"
-msgstr "zostałby przestawiony na %d\n"
-
-#: .././repair/dir2.c:928
-#, c-format
-msgid "size of entry #%d overflows space left in in shortform dir %<PRIu64>\n"
-msgstr "rozmiar wpisu #%d przekracza miejsce pozostałe w krótkim katalogu %<PRIu64>\n"
-
-#: .././repair/dir2.c:933
-#, c-format
-msgid "junking entry #%d\n"
-msgstr "wyrzucono wpis #%d\n"
-
-#: .././repair/dir2.c:937
-#, c-format
-msgid "junking %d entries\n"
-msgstr "wyrzucono %d wpisów\n"
-
-#: .././repair/dir2.c:942
-#, c-format
-msgid "would junk entry #%d\n"
-msgstr "wpis #%d zostałby wyrzucony\n"
-
-#: .././repair/dir2.c:946
-#, c-format
-msgid "would junk %d entries\n"
-msgstr "%d wpisów zostałoby wyrzuconych\n"
-
-#: .././repair/dir2.c:965
+#: .././repair/dir2.c:330
 #, c-format
 msgid "entry contains illegal character in shortform dir %<PRIu64>\n"
 msgstr "wpis zawiera niedozwolony znak w krótkim katalogu %<PRIu64>\n"
 
-#: .././repair/dir2.c:972
+#: .././repair/dir2.c:337
 #, c-format
 msgid "entry contains offset out of order in shortform dir %<PRIu64>\n"
 msgstr "wpis zawiera uszkodzony offset w krótkim katalogu %<PRIu64>\n"
 
-#: .././repair/dir2.c:1029
+#: .././repair/dir2.c:394
 #, c-format
 msgid "junking entry \"%s\" in directory inode %<PRIu64>\n"
 msgstr "wyrzucono wpis \"%s\" w i-węźle katalogu %<PRIu64>\n"
 
-#: .././repair/dir2.c:1033
+#: .././repair/dir2.c:398
 #, c-format
 msgid "would have junked entry \"%s\" in directory inode %<PRIu64>\n"
 msgstr "wpis \"%s\" w i-węźle katalogu %<PRIu64> zostałby wyrzucony\n"
 
-#: .././repair/dir2.c:1058
+#: .././repair/dir2.c:423
 #, c-format
 msgid "would have corrected entry count in directory %<PRIu64> from %d to %d\n"
 msgstr "liczba wpisów w katalogu %<PRIu64> zostałaby poprawiona z %d na %d\n"
 
-#: .././repair/dir2.c:1062
+#: .././repair/dir2.c:427
 #, c-format
 msgid "corrected entry count in directory %<PRIu64>, was %d, now %d\n"
 msgstr "poprawiono liczbę wpisów w katalogu %<PRIu64> - było %d, jest %d\n"
 
-#: .././repair/dir2.c:1073
+#: .././repair/dir2.c:438
 #, c-format
 msgid "would have corrected i8 count in directory %<PRIu64> from %d to %d\n"
 msgstr "liczba i8 zostałaby poprawiona w katalogu %<PRIu64> z %d na %d\n"
 
-#: .././repair/dir2.c:1077
+#: .././repair/dir2.c:442
 #, c-format
 msgid "corrected i8 count in directory %<PRIu64>, was %d, now %d\n"
 msgstr "poprawiono liczbę i8 w katalogu %<PRIu64> - było %d, jest %d\n"
 
-#: .././repair/dir2.c:1091
+#: .././repair/dir2.c:456
 #, c-format
-msgid "would have corrected directory %<PRIu64> size from %<PRId64> to %<PRIdPTR>\n"
-msgstr "rozmiar katalogu %<PRIu64> zostałby poprawiony z %<PRId64> na %<PRIdPTR>\n"
+msgid ""
+"would have corrected directory %<PRIu64> size from %<PRId64> to %<PRIdPTR>\n"
+msgstr ""
+"rozmiar katalogu %<PRIu64> zostałby poprawiony z %<PRId64> na %<PRIdPTR>\n"
 
-#: .././repair/dir2.c:1096
+#: .././repair/dir2.c:461
 #, c-format
 msgid "corrected directory %<PRIu64> size, was %<PRId64>, now %<PRIdPTR>\n"
-msgstr "poprawiono rozmiar katalogu %<PRIu64> - było %<PRId64>, jest %<PRIdPTR>\n"
+msgstr ""
+"poprawiono rozmiar katalogu %<PRIu64> - było %<PRId64>, jest %<PRIdPTR>\n"
 
-#: .././repair/dir2.c:1108
+#: .././repair/dir2.c:473
 #, c-format
 msgid "directory %<PRIu64> offsets too high\n"
 msgstr "offsety zbyt duże w katalogu %<PRIu64>\n"
 
-#: .././repair/dir2.c:1114
+#: .././repair/dir2.c:479
 #, c-format
 msgid "would have corrected entry offsets in directory %<PRIu64>\n"
 msgstr "offsety wpisów w katalogu %<PRIu64> zostałyby poprawione\n"
 
-#: .././repair/dir2.c:1118
+#: .././repair/dir2.c:483
 #, c-format
 msgid "corrected entry offsets in directory %<PRIu64>\n"
 msgstr "poprawiono offsety wpisów w katalogu %<PRIu64>\n"
 
-#: .././repair/dir2.c:1137
+#: .././repair/dir2.c:502
 #, c-format
 msgid "bogus .. inode number (%<PRIu64>) in directory inode %<PRIu64>, "
 msgstr "błędny numer i-węzła .. (%<PRIu64>) w i-węźle katalogu %<PRIu64>, "
 
-#: .././repair/dir2.c:1141 .././repair/dir2.c:1176
+#: .././repair/dir2.c:506 .././repair/dir2.c:541
 msgid "clearing inode number\n"
 msgstr "wyczyszczono numer i-węzła\n"
 
-#: .././repair/dir2.c:1147 .././repair/dir2.c:1182
+#: .././repair/dir2.c:512 .././repair/dir2.c:547
 msgid "would clear inode number\n"
 msgstr "numer i-węzła zostałby wyczyszczony\n"
 
-#: .././repair/dir2.c:1155
+#: .././repair/dir2.c:520
 #, c-format
-msgid "corrected root directory %<PRIu64> .. entry, was %<PRIu64>, now %<PRIu64>\n"
-msgstr "poprawiono wpis .. głównego katalogu %<PRIu64> - było %<PRIu64>, jest %<PRIu64>\n"
+msgid ""
+"corrected root directory %<PRIu64> .. entry, was %<PRIu64>, now %<PRIu64>\n"
+msgstr ""
+"poprawiono wpis .. głównego katalogu %<PRIu64> - było %<PRIu64>, jest "
+"%<PRIu64>\n"
 
-#: .././repair/dir2.c:1163
+#: .././repair/dir2.c:528
 #, c-format
-msgid "would have corrected root directory %<PRIu64> .. entry from %<PRIu64> to %<PRIu64>\n"
-msgstr "wpis .. głównego katalogu %<PRIu64> zostałby poprawiony z %<PRIu64> na %<PRIu64>\n"
+msgid ""
+"would have corrected root directory %<PRIu64> .. entry from %<PRIu64> to "
+"%<PRIu64>\n"
+msgstr ""
+"wpis .. głównego katalogu %<PRIu64> zostałby poprawiony z %<PRIu64> na "
+"%<PRIu64>\n"
 
-#: .././repair/dir2.c:1173
+#: .././repair/dir2.c:538
 #, c-format
 msgid "bad .. entry in directory inode %<PRIu64>, points to self, "
 msgstr "błędny wpis .. w i-węźle katalogu %<PRIu64>, wskazuje na siebie, "
 
-#: .././repair/dir2.c:1286
+#: .././repair/dir2.c:651
 #, c-format
 msgid "corrupt block %u in directory inode %<PRIu64>\n"
 msgstr "uszkodzony blok %u w i-węźle katalogu %<PRIu64>\n"
 
-#: .././repair/dir2.c:1289
+#: .././repair/dir2.c:654
 msgid "\twill junk block\n"
 msgstr "\tblok zostanie wyrzucony\n"
 
-#: .././repair/dir2.c:1291
+#: .././repair/dir2.c:656
 msgid "\twould junk block\n"
 msgstr "\tblok zostałby wyrzucony\n"
 
-#: .././repair/dir2.c:1377
+#: .././repair/dir2.c:742
 #, c-format
-msgid "entry \"%*.*s\" at block %d offset %<PRIdPTR> in directory inode %<PRIu64> references %s inode %<PRIu64>\n"
-msgstr "wpis \"%*.*s\" w bloku %d offsecie %<PRIdPTR> w i-węźle katalogu %<PRIu64> odwołuje się do %s %<PRIu64>\n"
+msgid ""
+"entry \"%*.*s\" at block %d offset %<PRIdPTR> in directory inode %<PRIu64> "
+"references %s inode %<PRIu64>\n"
+msgstr ""
+"wpis \"%*.*s\" w bloku %d offsecie %<PRIdPTR> w i-węźle katalogu %<PRIu64> "
+"odwołuje się do %s %<PRIu64>\n"
 
-#: .././repair/dir2.c:1388
+#: .././repair/dir2.c:765
 #, c-format
-msgid "entry at block %u offset %<PRIdPTR> in directory inode %<PRIu64>has 0 namelength\n"
-msgstr "wpis w bloku %u offsecie %<PRIdPTR> w i-węźle katalogu %<PRIu64> ma zerową długość nazwy\n"
+msgid ""
+"entry at block %u offset %<PRIdPTR> in directory inode %<PRIu64>has 0 "
+"namelength\n"
+msgstr ""
+"wpis w bloku %u offsecie %<PRIdPTR> w i-węźle katalogu %<PRIu64> ma zerową "
+"długość nazwy\n"
 
-#: .././repair/dir2.c:1401
+#: .././repair/dir2.c:778
 #, c-format
 msgid "\tclearing inode number in entry at offset %<PRIdPTR>...\n"
 msgstr "\twyczyszczono numer i-węzła we wpisie o offsecie %<PRIdPTR>...\n"
 
-#: .././repair/dir2.c:1407
+#: .././repair/dir2.c:784
 #, c-format
 msgid "\twould clear inode number in entry at offset %<PRIdPTR>...\n"
-msgstr "\tnumer i-węzła we wpisie o offsecie %<PRIdPTR> zostałby wyczyszczony...\n"
+msgstr ""
+"\tnumer i-węzła we wpisie o offsecie %<PRIdPTR> zostałby wyczyszczony...\n"
 
-#: .././repair/dir2.c:1420
+#: .././repair/dir2.c:797
 #, c-format
-msgid "entry at block %u offset %<PRIdPTR> in directory inode %<PRIu64> has illegal name \"%*.*s\": "
-msgstr "wpis w bloku %u offsecie %<PRIdPTR> w i-węźle katalogu %<PRIu64> ma niedozwoloną nazwę \"%*.*s\": "
+msgid ""
+"entry at block %u offset %<PRIdPTR> in directory inode %<PRIu64> has illegal "
+"name \"%*.*s\": "
+msgstr ""
+"wpis w bloku %u offsecie %<PRIdPTR> w i-węźle katalogu %<PRIu64> ma "
+"niedozwoloną nazwę \"%*.*s\": "
 
-#: .././repair/dir2.c:1451
+#: .././repair/dir2.c:828
 #, c-format
 msgid "bad .. entry in directory inode %<PRIu64>, points to self: "
 msgstr "błędny wpis .. w i-węźle katalogu %<PRIu64>, wskazuje na siebie: "
 
-#: .././repair/dir2.c:1462
+#: .././repair/dir2.c:839
 #, c-format
 msgid "bad .. entry in root directory inode %<PRIu64>, was %<PRIu64>: "
 msgstr "błędny wpis w i-węźle głównego katalogu %<PRIu64>, było %<PRIu64>: "
 
-#: .././repair/dir2.c:1465 .././repair/dir2.c:1497 .././repair/phase2.c:184
-#: .././repair/phase2.c:193 .././repair/phase2.c:202
+#: .././repair/dir2.c:842 .././repair/dir2.c:875 .././repair/phase2.c:222
+#: .././repair/phase2.c:231 .././repair/phase2.c:240
 msgid "correcting\n"
 msgstr "poprawiono\n"
 
-#: .././repair/dir2.c:1469 .././repair/dir2.c:1501 .././repair/phase2.c:186
-#: .././repair/phase2.c:195 .././repair/phase2.c:204
+#: .././repair/dir2.c:846 .././repair/dir2.c:879 .././repair/phase2.c:224
+#: .././repair/phase2.c:233 .././repair/phase2.c:242
 msgid "would correct\n"
 msgstr "zostałby poprawiony\n"
 
-#: .././repair/dir2.c:1481
+#: .././repair/dir2.c:859
 #, c-format
 msgid "multiple .. entries in directory inode %<PRIu64>: "
 msgstr "wiele wpisów .. w i-węźle katalogu %<PRIu64>: "
 
-#: .././repair/dir2.c:1494
+#: .././repair/dir2.c:872
 #, c-format
 msgid "bad . entry in directory inode %<PRIu64>, was %<PRIu64>: "
 msgstr "błędny wpis . w i-węźle katalogu %<PRIu64>, było %<PRIu64>: "
 
-#: .././repair/dir2.c:1506
+#: .././repair/dir2.c:884
 #, c-format
 msgid "multiple . entries in directory inode %<PRIu64>: "
 msgstr "wiele wpisów . w i-węźle katalogu %<PRIu64>: "
 
-#: .././repair/dir2.c:1516
+#: .././repair/dir2.c:894
 #, c-format
 msgid "entry \"%*.*s\" in directory inode %<PRIu64> points to self: "
 msgstr "wpis \"%*.*s\" w i-węźle katalogu %<PRIu64> wskazuje na siebie: "
 
-#: .././repair/dir2.c:1527
+#: .././repair/dir2.c:905
 msgid "clearing entry\n"
 msgstr "wyczyszczono wpis\n"
 
-#: .././repair/dir2.c:1529
+#: .././repair/dir2.c:907
 msgid "would clear entry\n"
 msgstr "wpis zostałby wyczyszczony\n"
 
-#: .././repair/dir2.c:1542
+#: .././repair/dir2.c:920
 #, c-format
 msgid "bad bestfree table in block %u in directory inode %<PRIu64>: "
 msgstr "błędna tablica bestfree w bloku %u w i-węźle katalogu %<PRIu64>: "
 
-#: .././repair/dir2.c:1545
+#: .././repair/dir2.c:923
 msgid "repairing table\n"
 msgstr "naprawiono tablicę\n"
 
-#: .././repair/dir2.c:1549
+#: .././repair/dir2.c:928
 msgid "would repair table\n"
 msgstr "tablica zostałaby naprawiona\n"
 
-#: .././repair/dir2.c:1588
+#: .././repair/dir2.c:968
 #, c-format
 msgid "block %u for directory inode %<PRIu64> is missing\n"
 msgstr "brak bloku %u dla i-węzła katalogu %<PRIu64>\n"
 
-#: .././repair/dir2.c:1608
+#: .././repair/dir2.c:977
+#, c-format
+msgid "can't read block %u for directory inode %<PRIu64>\n"
+msgstr "nie można odczytać bloku %u dla i-węzła katalogu %<PRIu64>\n"
+
+#: .././repair/dir2.c:988
 #, c-format
-msgid "bad directory block magic # %#x in block %u for directory inode %<PRIu64>\n"
-msgstr "błędna liczba magiczna bloku katalogu %#x w bloku %u dla i-węzła katalogu %<PRIu64>\n"
+msgid ""
+"bad directory block magic # %#x in block %u for directory inode %<PRIu64>\n"
+msgstr ""
+"błędna liczba magiczna bloku katalogu %#x w bloku %u dla i-węzła katalogu "
+"%<PRIu64>\n"
 
-#: .././repair/dir2.c:1660
+#: .././repair/dir2.c:1040
 #, c-format
 msgid "bad entry count in block %u of directory inode %<PRIu64>\n"
 msgstr "błędna liczba wpisów w bloku %u i-węzła katalogu %<PRIu64>\n"
 
-#: .././repair/dir2.c:1668
+#: .././repair/dir2.c:1048
 #, c-format
 msgid "bad hash ordering in block %u of directory inode %<PRIu64>\n"
 msgstr "błędna kolejność hasza w bloku %u i-węzła katalogu %<PRIu64>\n"
 
-#: .././repair/dir2.c:1676
+#: .././repair/dir2.c:1056
 #, c-format
 msgid "bad stale count in block %u of directory inode %<PRIu64>\n"
 msgstr "błędna liczba stale %u i-węzła katalogu %<PRIu64>\n"
 
-#: .././repair/dir2.c:1725
+#: .././repair/dir2.c:1105
 #, c-format
 msgid "can't map block %u for directory inode %<PRIu64>\n"
 msgstr "nie można odwzorować bloku %u dla i-węzła katalogu %<PRIu64>\n"
 
-#: .././repair/dir2.c:1735
+#: .././repair/dir2.c:1115
 #, c-format
 msgid "can't read file block %u for directory inode %<PRIu64>\n"
 msgstr "nie można odczytać bloku pliku %u dla i-węzła katalogu %<PRIu64>\n"
 
-#: .././repair/dir2.c:1747
+#: .././repair/dir2.c:1127
 #, c-format
 msgid "bad directory leaf magic # %#x for directory inode %<PRIu64> block %u\n"
-msgstr "błędna liczba magiczna liścia katalogu %#x dla i-węzła katalogu %<PRIu64> bloku %u\n"
+msgstr ""
+"błędna liczba magiczna liścia katalogu %#x dla i-węzła katalogu %<PRIu64> "
+"bloku %u\n"
 
-#: .././repair/dir2.c:1775
+#: .././repair/dir2.c:1155
 #, c-format
 msgid "bad sibling back pointer for block %u in directory inode %<PRIu64>\n"
 msgstr "błędny wskaźnik wstecz dla bloku %u w i-węźle katalogu %<PRIu64>\n"
 
-#: .././repair/dir2.c:1806
+#: .././repair/dir2.c:1186
 #, c-format
 msgid "bad hash path in directory %<PRIu64>\n"
 msgstr "błędna ścieżka hasza w katalogu %<PRIu64>\n"
 
-#: .././repair/dir2.c:1916
+#: .././repair/dir2.c:1296
 #, c-format
 msgid "block %<PRIu64> for directory inode %<PRIu64> is missing\n"
 msgstr "brak bloku %<PRIu64> dla i-węzła katalogu %<PRIu64>\n"
 
-#: .././repair/dir2.c:1925
+#: .././repair/dir2.c:1305
 #, c-format
 msgid "can't read block %<PRIu64> for directory inode %<PRIu64>\n"
 msgstr "nie można odczytać bloku %<PRIu64> dla i-węzła katalogu %<PRIu64>\n"
 
-#: .././repair/dir2.c:1933
+#: .././repair/dir2.c:1313
 #, c-format
-msgid "bad directory block magic # %#x in block %<PRIu64> for directory inode %<PRIu64>\n"
-msgstr "błędna liczba magiczna bloku katalogu %#x w bloku %<PRIu64> dla i-węzła katalogu %<PRIu64>\n"
+msgid ""
+"bad directory block magic # %#x in block %<PRIu64> for directory inode "
+"%<PRIu64>\n"
+msgstr ""
+"błędna liczba magiczna bloku katalogu %#x w bloku %<PRIu64> dla i-węzła "
+"katalogu %<PRIu64>\n"
 
-#: .././repair/dir2.c:2014
+#: .././repair/dir2.c:1394
 #, c-format
 msgid "bad size/format for directory %<PRIu64>\n"
 msgstr "błędny rozmiar/format dla katalogu %<PRIu64>\n"
 
-#: .././repair/dir2.c:2021
+#: .././repair/dir2.c:1401
 #, c-format
 msgid "no . entry for directory %<PRIu64>\n"
 msgstr "brak wpisu . dla katalogu %<PRIu64>\n"
 
-#: .././repair/dir2.c:2031
+#: .././repair/dir2.c:1411
 #, c-format
 msgid "no .. entry for directory %<PRIu64>\n"
 msgstr "brak wpisu .. dla katalogu %<PRIu64>\n"
 
-#: .././repair/dir2.c:2033
+#: .././repair/dir2.c:1413
 #, c-format
 msgid "no .. entry for root directory %<PRIu64>\n"
 msgstr "brak wpisu .. dla katalogu głównego %<PRIu64>\n"
@@ -10739,15 +12145,21 @@ msgstr "powtórzony przedział ekstentó
 
 #: .././repair/incore_ext.c:752 .././repair/incore_ext.c:756
 msgid "couldn't malloc dup extent tree descriptor table\n"
-msgstr "nie udało się przydzielić tablicy deskryptorów drzewa powtórzonych ekstentów\n"
+msgstr ""
+"nie udało się przydzielić tablicy deskryptorów drzewa powtórzonych "
+"ekstentów\n"
 
 #: .././repair/incore_ext.c:761
 msgid "couldn't malloc free by-bno extent tree descriptor table\n"
-msgstr "nie udało się przydzielić tablicy deskryptorów drzewa wolnych ekstentów wg bno\n"
+msgstr ""
+"nie udało się przydzielić tablicy deskryptorów drzewa wolnych ekstentów wg "
+"bno\n"
 
 #: .././repair/incore_ext.c:766
 msgid "couldn't malloc free by-bcnt extent tree descriptor table\n"
-msgstr "nie udało się przydzielić tablicy deskryptorów drzewa wolnych ekstentów wg bcnt\n"
+msgstr ""
+"nie udało się przydzielić tablicy deskryptorów drzewa wolnych ekstentów wg "
+"bcnt\n"
 
 #: .././repair/incore_ext.c:772
 msgid "couldn't malloc bno extent tree descriptor\n"
@@ -10759,7 +12171,8 @@ msgstr "nie udało się przydzielić des
 
 #: .././repair/incore_ext.c:787
 msgid "couldn't malloc dup rt extent tree descriptor\n"
-msgstr "nie udało się przydzielić deskryptora drzewa powtórzonych ekstentów rt\n"
+msgstr ""
+"nie udało się przydzielić deskryptora drzewa powtórzonych ekstentów rt\n"
 
 #: .././repair/incore_ino.c:47
 msgid "could not allocate nlink array\n"
@@ -10773,70 +12186,72 @@ msgstr "nie udało się przydzielić tab
 msgid "inode map malloc failed\n"
 msgstr "przydzielenie mapy i-węzłów nie powiodło się\n"
 
-#: .././repair/incore_ino.c:364
+#: .././repair/incore_ino.c:367
 msgid "add_aginode_uncertain - duplicate inode range\n"
 msgstr "add_aginode_uncertain - powtórzony przedział i-węzłów\n"
 
-#: .././repair/incore_ino.c:459
+#: .././repair/incore_ino.c:462
 msgid "add_inode - duplicate inode range\n"
 msgstr "add_inode - powtórzony przedział i-węzłów\n"
 
-#: .././repair/incore_ino.c:553
+#: .././repair/incore_ino.c:556
 #, c-format
 msgid "good inode list is --\n"
 msgstr "lista dobrych i-węzłów to:\n"
 
-#: .././repair/incore_ino.c:556
+#: .././repair/incore_ino.c:559
 #, c-format
 msgid "uncertain inode list is --\n"
 msgstr "lista niepewnych i-węzłów to:\n"
 
-#: .././repair/incore_ino.c:561
+#: .././repair/incore_ino.c:564
 #, c-format
 msgid "agno %d -- no inodes\n"
 msgstr "agno %d - brak i-węzłów\n"
 
-#: .././repair/incore_ino.c:565
+#: .././repair/incore_ino.c:568
 #, c-format
 msgid "agno %d\n"
 msgstr "agno %d\n"
 
-#: .././repair/incore_ino.c:569
+#: .././repair/incore_ino.c:572
 #, c-format
 msgid "\tptr = %lx, start = 0x%x, free = 0x%llx, confirmed = 0x%llx\n"
 msgstr "\tptr = %lx, start = 0x%x, wolne = 0x%llx, potwierdzone = 0x%llx\n"
 
-#: .././repair/incore_ino.c:620
+#: .././repair/incore_ino.c:623
 msgid "couldn't malloc parent list table\n"
 msgstr "nie udało się przydzielić tablicy listy rodziców\n"
 
-#: .././repair/incore_ino.c:631 .././repair/incore_ino.c:677
+#: .././repair/incore_ino.c:634 .././repair/incore_ino.c:680
 msgid "couldn't memalign pentries table\n"
 msgstr "nie udało się memalign na tablicy pentries\n"
 
-#: .././repair/incore_ino.c:735
+#: .././repair/incore_ino.c:738
 msgid "could not malloc inode extra data\n"
 msgstr "nie udało się przydzielić dodatkowych danych i-węzła\n"
 
-#: .././repair/incore_ino.c:801
+#: .././repair/incore_ino.c:804
 msgid "couldn't malloc inode tree descriptor table\n"
 msgstr "nie udało się przydzielić tablicy deskryptorów drzewa i-węzłów\n"
 
-#: .././repair/incore_ino.c:805
+#: .././repair/incore_ino.c:808
 msgid "couldn't malloc uncertain ino tree descriptor table\n"
-msgstr "nie udało się przydzielić tablicy deskryptorów drzewa i-węzłów niepewnych\n"
+msgstr ""
+"nie udało się przydzielić tablicy deskryptorów drzewa i-węzłów niepewnych\n"
 
-#: .././repair/incore_ino.c:810
+#: .././repair/incore_ino.c:813
 msgid "couldn't malloc inode tree descriptor\n"
 msgstr "nie udało się przydzielić deskryptora drzewa i-węzłów\n"
 
-#: .././repair/incore_ino.c:814
+#: .././repair/incore_ino.c:817
 msgid "couldn't malloc uncertain ino tree descriptor\n"
 msgstr "nie udało się przydzielić deskryptora drzewa i-węzłów niepewnych\n"
 
-#: .././repair/incore_ino.c:822
+#: .././repair/incore_ino.c:825
 msgid "couldn't malloc uncertain inode cache area\n"
-msgstr "nie udało się przydzielić obszaru pamięci podręcznej i-węzłów niepewnych\n"
+msgstr ""
+"nie udało się przydzielić obszaru pamięci podręcznej i-węzłów niepewnych\n"
 
 #: .././repair/init.c:46
 #, c-format
@@ -10850,8 +12265,12 @@ msgstr "setrlimit nie powiodło się - b
 
 #: .././repair/init.c:107
 #, c-format
-msgid "Unmount or use the dangerous (-d) option to repair a read-only mounted filesystem\n"
-msgstr "Aby naprawić system plików zamontowany do odczytu, trzeba go odmontować lub użyć opcji niebezpiecznej (-d).\n"
+msgid ""
+"Unmount or use the dangerous (-d) option to repair a read-only mounted "
+"filesystem\n"
+msgstr ""
+"Aby naprawić system plików zamontowany do odczytu, trzeba go odmontować lub "
+"użyć opcji niebezpiecznej (-d).\n"
 
 #: .././repair/init.c:109
 msgid "couldn't initialize XFS library\n"
@@ -10897,51 +12316,82 @@ msgstr "superblok ma niepasujące featur
 msgid "Enabling lazy-counters\n"
 msgstr "Włączanie leniwych liczników\n"
 
-#: .././repair/phase1.c:128
+#: .././repair/phase1.c:127
+#, c-format
+msgid "Cannot disable lazy-counters on V5 fs\n"
+msgstr "Nie można wyłączyć leniwych liczników w systemie plików V5\n"
+
+#: .././repair/phase1.c:132
 #, c-format
 msgid "Disabling lazy-counters\n"
 msgstr "Wyłączanie leniwych liczników\n"
 
-#: .././repair/phase1.c:131
+#: .././repair/phase1.c:135
 #, c-format
 msgid "Lazy-counters are already %s\n"
 msgstr "Leniwe liczniki już są %s\n"
 
-#: .././repair/phase1.c:132
+#: .././repair/phase1.c:136
 msgid "enabled"
 msgstr "włączone"
 
-#: .././repair/phase1.c:132
+#: .././repair/phase1.c:136
 msgid "disabled"
 msgstr "wyłączone"
 
-#: .././repair/phase1.c:139
+#: .././repair/phase1.c:143
+msgid "resetting shared_vn to zero\n"
+msgstr "przestawianie shared_vn na zero\n"
+
+#: .././repair/phase1.c:150
 msgid "writing modified primary superblock\n"
 msgstr "zapisano zmodyfikowany główny superblok\n"
 
-#: .././repair/phase1.c:142
+#: .././repair/phase1.c:153
 msgid "would write modified primary superblock\n"
 msgstr "zmodyfikowany główny superblok zostałby zapisany\n"
 
-#: .././repair/phase2.c:69
+#: .././repair/phase2.c:79
 #, c-format
-msgid "zero_log: cannot find log head/tail (xlog_find_tail=%d), zeroing it anyway\n"
-msgstr "zero_log: nie znaleziono początku/końca logu (xlog_find_tail=%d), wyzerowano go\n"
+msgid "zero_log: cannot find log head/tail (xlog_find_tail=%d)\n"
+msgstr "zero_log: nie znaleziono początku/końca logu (xlog_find_tail=%d)\n"
+
+#: .././repair/phase2.c:83
+msgid ""
+"ERROR: The log head and/or tail cannot be discovered. Attempt to mount the\n"
+"filesystem to replay the log or use the -L option to destroy the log and\n"
+"attempt a repair.\n"
+msgstr ""
+"BŁĄD: nie można wykryć początku i/lub końca logu. Proszę spróbować "
+"zamontować\n"
+"system plików, aby odtworzyć log, albo użyć opcji -L, aby zniszczyć log\n"
+"i spróbować naprawić.\n"
 
-#: .././repair/phase2.c:75
+#: .././repair/phase2.c:90
 #, c-format
 msgid "zero_log: head block %<PRId64> tail block %<PRId64>\n"
 msgstr "zero_log: blok początku %<PRId64> blok końca %<PRId64>\n"
 
-#: .././repair/phase2.c:81
+#: .././repair/phase2.c:96
 msgid ""
 "ALERT: The filesystem has valuable metadata changes in a log which is being\n"
 "destroyed because the -L option was used.\n"
 msgstr ""
-"UWAGA: system plików zawiera wartościowe zmiany metadanych w logu, który jest\n"
+"UWAGA: system plików zawiera wartościowe zmiany metadanych w logu, który "
+"jest\n"
 "niszczony, ponieważ użyto opcji -L.\n"
 
-#: .././repair/phase2.c:85
+#: .././repair/phase2.c:100
+msgid ""
+"ALERT: The filesystem has valuable metadata changes in a log which is being\n"
+"ignored because the -n option was used.  Expect spurious inconsistencies\n"
+"which may be resolved by first mounting the filesystem to replay the log.\n"
+msgstr ""
+"UWAGA: system plików zawiera wartościowe zmiany metadanych w logu, który jest\n"
+"ignorowany, ponieważ użyto opcji -n. Należy oczekiwać fałszywych niespójności,\n"
+"które można rozwiązać najpierw montując system plików w celu odtworzenia logu.\n"
+
+#: .././repair/phase2.c:105
 msgid ""
 "ERROR: The filesystem has valuable metadata changes in a log which needs to\n"
 "be replayed.  Mount the filesystem to replay the log, and unmount it before\n"
@@ -10951,191 +12401,266 @@ msgid ""
 "of the filesystem before doing this.\n"
 msgstr ""
 "BŁĄD: system plików zawiera wartościowe zmiany metadanych w logu, który\n"
-"musi być odtworzony. Należy podmontować system plików, aby odtworzyć log,\n"
+"musi być odtworzony. Należy zamontować system plików, aby odtworzyć log,\n"
 "a następnie odmontować go przed ponownym uruchomieniem xfs_repair. Jeśli\n"
-"systemu plików nie da się podmontować, można użyć opcji -L, aby zniszczyć\n"
+"systemu plików nie da się zamontować, można użyć opcji -L, aby zniszczyć\n"
 "log i spróbować naprawić system plików.\n"
 "Należy zauważyć, że zniszczenie logu może spowodować uszkodzenia danych -\n"
-"proszę najpierw spróbować podmontować system plików.\n"
+"proszę najpierw spróbować zamontować system plików.\n"
+
+#: .././repair/phase2.c:133
+msgid "failed to clear log"
+msgstr "nie udało się wyczyścić logu"
 
-#: .././repair/phase2.c:127
-msgid "This filesystem has an external log.  Specify log device with the -l option.\n"
-msgstr "Ten system plików ma zewnętrzny log. Należy podać urządzenie logu przy użyciu opcji -l.\n"
+#: .././repair/phase2.c:167
+msgid ""
+"This filesystem has an external log.  Specify log device with the -l "
+"option.\n"
+msgstr ""
+"Ten system plików ma zewnętrzny log. Należy podać urządzenie logu przy "
+"użyciu opcji -l.\n"
 
-#: .././repair/phase2.c:130
+#: .././repair/phase2.c:170
 #, c-format
 msgid "Phase 2 - using external log on %s\n"
 msgstr "Faza 2 - użycie zewnętrznego logu na %s\n"
 
-#: .././repair/phase2.c:132
+#: .././repair/phase2.c:172
 msgid "Phase 2 - using internal log\n"
 msgstr "Faza 2 - użycie wewnętrznego logu\n"
 
-#: .././repair/phase2.c:136
+#: .././repair/phase2.c:175
 msgid "        - zero log...\n"
 msgstr "        - zerowanie logu...\n"
 
-#: .././repair/phase2.c:140
+#: .././repair/phase2.c:178
 msgid "        - scan filesystem freespace and inode maps...\n"
-msgstr "        - przeszukiwanie wolnego miejsca i map i-węzłów w systemie plików...\n"
+msgstr ""
+"        - przeszukiwanie wolnego miejsca i map i-węzłów w systemie "
+"plików...\n"
 
-#: .././repair/phase2.c:156
+#: .././repair/phase2.c:194
 msgid "root inode chunk not found\n"
 msgstr "nie znaleziono danych głównego i-węzła\n"
 
-#: .././repair/phase2.c:175
+#: .././repair/phase2.c:213
 msgid "        - found root inode chunk\n"
 msgstr "        - znaleziono dane głównego i-węzła\n"
 
-#: .././repair/phase2.c:181
+#: .././repair/phase2.c:219
 msgid "root inode marked free, "
 msgstr "główny i-węzeł oznaczony jako wolny, "
 
-#: .././repair/phase2.c:190
+#: .././repair/phase2.c:228
 msgid "realtime bitmap inode marked free, "
 msgstr "i-węzeł bitmapy realtime oznaczony jako wolny, "
 
-#: .././repair/phase2.c:199
+#: .././repair/phase2.c:237
 msgid "realtime summary inode marked free, "
 msgstr "i-węzeł opisu realtime oznaczony jako wolny, "
 
-#: .././repair/phase3.c:45
+#: .././repair/phase3.c:47
 #, c-format
 msgid "cannot read agi block %<PRId64> for ag %u\n"
 msgstr "nie można odczytać bloku agi %<PRId64> dla ag %u\n"
 
-#: .././repair/phase3.c:76 .././repair/phase4.c:139 .././repair/phase5.c:1525
-#: .././repair/phase6.c:3059
+#: .././repair/phase3.c:78 .././repair/phase4.c:142 .././repair/phase5.c:2217
+#: .././repair/phase6.c:3131
 #, c-format
 msgid "        - agno = %d\n"
 msgstr "        - agno = %d\n"
 
-#: .././repair/phase3.c:93
+#: .././repair/phase3.c:119
 msgid "Phase 3 - for each AG...\n"
 msgstr "Faza 3 - dla każdej AG...\n"
 
-#: .././repair/phase3.c:95
+#: .././repair/phase3.c:121
 msgid "        - scan and clear agi unlinked lists...\n"
 msgstr "        - przeszukiwanie i czyszczenie odłączonych list agi...\n"
 
-#: .././repair/phase3.c:97
+#: .././repair/phase3.c:123
 msgid "        - scan (but don't clear) agi unlinked lists...\n"
-msgstr "        - przeszukiwanie (ale nie czyszczenie) odłączonych list agi...\n"
+msgstr ""
+"        - przeszukiwanie (ale nie czyszczenie) odłączonych list agi...\n"
 
-#: .././repair/phase3.c:117
+#: .././repair/phase3.c:143
 msgid "        - process known inodes and perform inode discovery...\n"
 msgstr "        - przetwarzanie znanych i-węzłów i rozpoznawanie i-węzłów...\n"
 
-#: .././repair/phase3.c:128
+#: .././repair/phase3.c:154
 msgid "        - process newly discovered inodes...\n"
 msgstr "        - przetwarzanie nowo rozpoznanych i-węzłów...\n"
 
-#: .././repair/phase4.c:174
+#: .././repair/phase3.c:159
+msgid "no memory for uncertain inode counts\n"
+msgstr "brak pamięci na liczniki niepewnych i-węzłów\n"
+
+#: .././repair/phase4.c:165
+#, c-format
+msgid ""
+"unable to finish adding attr/data fork reverse-mapping data for AG %u.\n"
+msgstr ""
+"nie udało się ukończyć dodawania danych odwrotnego odwzorowania gałęzi "
+"atrybutów/danych dla AG %u.\n"
+
+#: .././repair/phase4.c:181
+#, c-format
+msgid "unable to add AG %u metadata reverse-mapping data.\n"
+msgstr "nie udało się dodać danych odwrotnego odwzorowania metadanych AG %u.\n"
+
+#: .././repair/phase4.c:186
+#, c-format
+msgid "unable to merge AG %u metadata reverse-mapping data.\n"
+msgstr ""
+"nie udało się dołączyć danych odwrotnego odwzorowania metadanych AG %u.\n"
+
+#: .././repair/phase4.c:191
+#, c-format
+msgid "%s while checking reverse-mappings"
+msgstr "%s podczas sprawdzania odwrotnych odwzorowań"
+
+#: .././repair/phase4.c:206
+#, c-format
+msgid "%s while computing reference count records.\n"
+msgstr "%s podczas przeliczania rekordów licznika odwołań.\n"
+
+#: .././repair/phase4.c:221
+#, c-format
+msgid "%s while fixing inode reflink flags.\n"
+msgstr "%s podczas poprawiania flag odwołań i-węzłów.\n"
+
+#: .././repair/phase4.c:236
+#, c-format
+msgid "%s while checking reference counts"
+msgstr "%s podczas sprawdzania liczników odwołań"
+
+#: .././repair/phase4.c:290
 msgid "Phase 4 - check for duplicate blocks...\n"
 msgstr "Faza 4 - sprawdzanie powtórzonych bloków...\n"
 
-#: .././repair/phase4.c:175
+#: .././repair/phase4.c:291
 msgid "        - setting up duplicate extent list...\n"
 msgstr "        - tworzenie listy powtórzonych ekstentów...\n"
 
-#: .././repair/phase4.c:189
+#: .././repair/phase4.c:305
 msgid "root inode would be lost\n"
 msgstr "główny i-węzeł zostałby utracony\n"
 
-#: .././repair/phase4.c:191
+#: .././repair/phase4.c:307
 msgid "root inode lost\n"
 msgstr "główny i-węzeł utracony\n"
 
-#: .././repair/phase4.c:208
+#: .././repair/phase4.c:324
 #, c-format
 msgid "unknown block state, ag %d, block %d\n"
 msgstr "nieznany stan bloku, ag %d, blok %d\n"
 
-#: .././repair/phase4.c:241
+#: .././repair/phase4.c:357
 #, c-format
 msgid "unknown rt extent state, extent %<PRIu64>\n"
 msgstr "nieznany stan ekstentu rt, ekstent %<PRIu64>\n"
 
-#: .././repair/phase4.c:290
+#: .././repair/phase4.c:406
 msgid "        - check for inodes claiming duplicate blocks...\n"
-msgstr "        - szukanie i-węzłów odwołujących się do powtórzonych bloków...\n"
+msgstr ""
+"        - szukanie i-węzłów odwołujących się do powtórzonych bloków...\n"
 
-#: .././repair/phase5.c:219
+#: .././repair/phase5.c:223
 msgid "could not set up btree block array\n"
 msgstr "nie udało się utworzyć tablicy bloków b-drzewa\n"
 
-#: .././repair/phase5.c:231
+#: .././repair/phase5.c:244
 msgid "error - not enough free space in filesystem\n"
 msgstr "błąd - za mało wolnego miejsca w systemie plików\n"
 
-#: .././repair/phase5.c:445
+#: .././repair/phase5.c:259
+#, c-format
+msgid "could not set up btree rmaps: %s\n"
+msgstr "nie udało się ustanowić rmap b-drzewa: %s\n"
+
+#: .././repair/phase5.c:475
 #, c-format
 msgid "can't rebuild fs trees -- not enough free space on ag %u\n"
-msgstr "nie można przebudować drzew systemu plików - za mało wolnego miejsca w ag %u\n"
+msgstr ""
+"nie można przebudować drzew systemu plików - za mało wolnego miejsca w ag "
+"%u\n"
 
-#: .././repair/phase5.c:468
+#: .././repair/phase5.c:498
 #, c-format
 msgid "ag %u - not enough free space to build freespace btrees\n"
-msgstr "ag %u - za mało wolnego miejsca na przebudowanie b-drzew wolnego miejsca\n"
+msgstr ""
+"ag %u - za mało wolnego miejsca na przebudowanie b-drzew wolnego miejsca\n"
 
-#: .././repair/phase5.c:503
+#: .././repair/phase5.c:533
 #, c-format
 msgid "not enough free blocks left to describe all free blocks in AG %u\n"
 msgstr "za mało wolnych bloków na opisanie wszystkich wolnych bloków w AG %u\n"
 
-#: .././repair/phase5.c:1399
-#, c-format
-msgid "lost %d blocks in ag %u\n"
-msgstr "utracono %d bloków w ag %u\n"
-
-#: .././repair/phase5.c:1402
-#, c-format
-msgid "thought we were going to lose %d blocks in ag %u, actually lost %d\n"
-msgstr "przewidywano utracenie %d bloków w ag %u, a utracono %d\n"
+#: .././repair/phase5.c:1584
+msgid "Insufficient memory to construct reverse-map cursor."
+msgstr "Za mało pamięci, aby utworzyć kursor odwzorowania odwrotnego."
+
+#: .././repair/phase5.c:1887
+msgid "Insufficient memory to construct refcount cursor."
+msgstr "Za mało pamięci, aby utworzyć kursor zliczania odwołań."
+
+#: .././repair/phase5.c:2097 .././repair/phase5.c:2105
+msgid "Insufficient memory saving lost blocks.\n"
+msgstr "Za mało pamięci podczas zapisu utraconych bloków.\n"
 
-#: .././repair/phase5.c:1471 .././repair/xfs_repair.c:891
+#: .././repair/phase5.c:2160 .././repair/xfs_repair.c:1034
 msgid "couldn't get superblock\n"
 msgstr "nie udało się pobrać superbloku\n"
 
-#: .././repair/phase5.c:1548
+#: .././repair/phase5.c:2240
 #, c-format
 msgid "unable to rebuild AG %u.  Not enough free space in on-disk AG.\n"
-msgstr "nie udało się przebudować AG %u. Za mało wolnego miejsca w AG na dysku.\n"
+msgstr ""
+"nie udało się przebudować AG %u. Za mało wolnego miejsca w AG na dysku.\n"
 
-#: .././repair/phase5.c:1588
+#: .././repair/phase5.c:2292
 #, c-format
 msgid "unable to rebuild AG %u.  No free space.\n"
 msgstr "nie udało się przebudować AG %u. Brak wolnego miejsca.\n"
 
-#: .././repair/phase5.c:1615
+#: .././repair/phase5.c:2413
 #, c-format
-msgid "lost %d blocks in agno %d, sorry.\n"
-msgstr "niestety utracono %d bloków w agno %d.\n"
+msgid "unable to add AG %u reverse-mapping data to btree.\n"
+msgstr ""
+"nie udało się dodać danych odwrotnego odwzorowania AG %u do b-drzewa.\n"
 
-#: .././repair/phase5.c:1704
+#: .././repair/phase5.c:2473
 msgid "Phase 5 - rebuild AG headers and trees...\n"
 msgstr "Faza 5 - przebudowywanie nagłówków i drzew AG...\n"
 
-#: .././repair/phase5.c:1734
+#: .././repair/phase5.c:2502
 msgid "cannot alloc sb_icount_ag buffers\n"
 msgstr "nie można przydzielić buforów sb_icount_ag\n"
 
-#: .././repair/phase5.c:1738
+#: .././repair/phase5.c:2506
 msgid "cannot alloc sb_ifree_ag buffers\n"
 msgstr "nie można przydzielić buforów sb_ifree_ag\n"
 
-#: .././repair/phase5.c:1742
+#: .././repair/phase5.c:2510
 msgid "cannot alloc sb_fdblocks_ag buffers\n"
 msgstr "nie można przydzielić buforów sb_fdblocks_ag\n"
 
-#: .././repair/phase5.c:1761
+#: .././repair/phase5.c:2514
+msgid "cannot alloc lost block slab\n"
+msgstr "nie można przydzielić płyty utraconego bloku\n"
+
+#: .././repair/phase5.c:2533
 msgid "        - generate realtime summary info and bitmap...\n"
 msgstr "        - generowanie opisu i bitmapy realtime...\n"
 
-#: .././repair/phase5.c:1766
+#: .././repair/phase5.c:2538
 msgid "        - reset superblock...\n"
 msgstr "        - przestawianie superbloku...\n"
 
+#: .././repair/phase5.c:2547
+msgid "Unable to reinsert lost blocks into filesystem.\n"
+msgstr "Nie udało się ponownie wstawić utraconych bloków do systemu plików.\n"
+
 #: .././repair/phase6.c:64
 #, c-format
 msgid "malloc failed add_dotdot_update (%zu bytes)\n"
@@ -11187,544 +12712,653 @@ msgstr "zostałaby przebudowana\n"
 msgid "calloc failed in dir_hash_init\n"
 msgstr "calloc nie powiodło się w dir_hash_init\n"
 
-#: .././repair/phase6.c:471
+#: .././repair/phase6.c:468
 msgid "ran out of disk space!\n"
 msgstr "brak miejsca na dysku!\n"
 
-#: .././repair/phase6.c:473
+#: .././repair/phase6.c:470
 #, c-format
 msgid "xfs_trans_reserve returned %d\n"
 msgstr "xfs_trans_reserve zwróciło %d\n"
 
-#: .././repair/phase6.c:506 .././repair/phase6.c:615
+#: .././repair/phase6.c:500 .././repair/phase6.c:602
 #, c-format
 msgid "couldn't iget realtime bitmap inode -- error - %d\n"
 msgstr "nie udało się wykonać iget dla i-węzła bitmapy realtime - błąd %d\n"
 
-#: .././repair/phase6.c:570
+#: .././repair/phase6.c:558
 #, c-format
 msgid "couldn't allocate realtime bitmap, error = %d\n"
 msgstr "nie udało się przydzielić bitmapy realtime, błąd = %d\n"
 
-#: .././repair/phase6.c:583
+#: .././repair/phase6.c:571
 #, c-format
 msgid "allocation of the realtime bitmap failed, error = %d\n"
 msgstr "przydzielenie bitmapy realtime nie powiodło się, błąd = %d\n"
 
-#: .././repair/phase6.c:629
+#: .././repair/phase6.c:616
 #, c-format
 msgid "couldn't map realtime bitmap block %<PRIu64>, error = %d\n"
 msgstr "nie udało się odwzorować bloku bitmapy realtime %<PRIu64>, błąd = %d\n"
 
-#: .././repair/phase6.c:642
+#: .././repair/phase6.c:629
 #, c-format
-msgid "can't access block %<PRIu64> (fsbno %<PRIu64>) of realtime bitmap inode %<PRIu64>\n"
-msgstr "brak dostępu do bloku %<PRIu64> (fsbno %<PRIu64>) i-węzła bitmapy realtime %<PRIu64>\n"
+msgid ""
+"can't access block %<PRIu64> (fsbno %<PRIu64>) of realtime bitmap inode "
+"%<PRIu64>\n"
+msgstr ""
+"brak dostępu do bloku %<PRIu64> (fsbno %<PRIu64>) i-węzła bitmapy realtime "
+"%<PRIu64>\n"
 
-#: .././repair/phase6.c:687 .././repair/phase6.c:762
+#: .././repair/phase6.c:673 .././repair/phase6.c:747
 #, c-format
 msgid "couldn't iget realtime summary inode -- error - %d\n"
 msgstr "nie udało się wykonać iget dla i-węzła opisu realtime - błąd %d\n"
 
-#: .././repair/phase6.c:701
+#: .././repair/phase6.c:687
 #, c-format
 msgid "couldn't map realtime summary inode block %<PRIu64>, error = %d\n"
-msgstr "nie udało się odwzorować bloku i-węzła opisu realtime %<PRIu64>, błąd = %d\n"
+msgstr ""
+"nie udało się odwzorować bloku i-węzła opisu realtime %<PRIu64>, błąd = %d\n"
 
-#: .././repair/phase6.c:714
+#: .././repair/phase6.c:700
 #, c-format
-msgid "can't access block %<PRIu64> (fsbno %<PRIu64>) of realtime summary inode %<PRIu64>\n"
-msgstr "brak dostępu do bloku %<PRIu64> (fsbno %<PRIu64>) i-węzła opisu realtime %<PRIu64>\n"
+msgid ""
+"can't access block %<PRIu64> (fsbno %<PRIu64>) of realtime summary inode "
+"%<PRIu64>\n"
+msgstr ""
+"brak dostępu do bloku %<PRIu64> (fsbno %<PRIu64>) i-węzła opisu realtime "
+"%<PRIu64>\n"
 
-#: .././repair/phase6.c:831
+#: .././repair/phase6.c:810
 #, c-format
 msgid "couldn't allocate realtime summary inode, error = %d\n"
 msgstr "nie udało się przydzielić i-węzła opisu realtime, błąd = %d\n"
 
-#: .././repair/phase6.c:844
+#: .././repair/phase6.c:823
 #, c-format
 msgid "allocation of the realtime summary ino failed, error = %d\n"
 msgstr "przydzielenie i-węzła opisu realtime nie powiodło się, błąd = %d\n"
 
-#: .././repair/phase6.c:876
+#: .././repair/phase6.c:852
 #, c-format
 msgid "could not iget root inode -- error - %d\n"
 msgstr "nie udało się wykonać iget dla głównego i-węzła - błąd %d\n"
 
-#: .././repair/phase6.c:958
+#: .././repair/phase6.c:929
 #, c-format
 msgid "%d - couldn't iget root inode to obtain %s\n"
 msgstr "%d - nie udało się wykonać iget dla głównego węzła, aby uzyskać %s\n"
 
-#: .././repair/phase6.c:991
+#: .././repair/phase6.c:959
 #, c-format
 msgid "%s inode allocation failed %d\n"
-msgstr "przydzielenie i-węzłą %s nie powiodło się - %d\n"
+msgstr "przydzielenie i-węzła %s nie powiodło się - %d\n"
 
-#: .././repair/phase6.c:1038
+#: .././repair/phase6.c:1006
 #, c-format
 msgid "can't make %s, createname error %d\n"
 msgstr "nie można zrobić %s, błąd createname %d\n"
 
-#: .././repair/phase6.c:1058
+#: .././repair/phase6.c:1026
 #, c-format
 msgid "%s directory creation failed -- bmapf error %d\n"
 msgstr "tworzenie katalogu %s nie powiodło się - błąd bmapf %d\n"
 
-#: .././repair/phase6.c:1105
+#: .././repair/phase6.c:1068
 #, c-format
 msgid "%d - couldn't iget orphanage inode\n"
 msgstr "%d - nie udało się wykonać iget dla i-węzła sierocińca\n"
 
-#: .././repair/phase6.c:1118
+#: .././repair/phase6.c:1079
 #, c-format
 msgid "%d - couldn't iget disconnected inode\n"
 msgstr "%d - nie udało się wykonać iget dla odłączonego i-węzła\n"
 
-#: .././repair/phase6.c:1137 .././repair/phase6.c:1180
-#: .././repair/phase6.c:1237
+#: .././repair/phase6.c:1100 .././repair/phase6.c:1142
+#: .././repair/phase6.c:1198
 #, c-format
 msgid "space reservation failed (%d), filesystem may be out of space\n"
-msgstr "nie udało się zarezerwować miejsca (%d), może brakować miejsca w systemie plików\n"
+msgstr ""
+"nie udało się zarezerwować miejsca (%d), może brakować miejsca w systemie "
+"plików\n"
 
-#: .././repair/phase6.c:1148 .././repair/phase6.c:1192
-#: .././repair/phase6.c:1248
+#: .././repair/phase6.c:1111 .././repair/phase6.c:1154
+#: .././repair/phase6.c:1209
 #, c-format
 msgid "name create failed in %s (%d), filesystem may be out of space\n"
-msgstr "tworzenie nazwy nie powiodło się w %s (%d), może brakować miejsca w systemie plików\n"
+msgstr ""
+"tworzenie nazwy nie powiodło się w %s (%d), może brakować miejsca w systemie "
+"plików\n"
 
-#: .././repair/phase6.c:1161
+#: .././repair/phase6.c:1124
 #, c-format
 msgid "creation of .. entry failed (%d), filesystem may be out of space\n"
-msgstr "tworzenie wpisu .. nie powiodło się (%d), może brakować miejsca w systemie plików\n"
+msgstr ""
+"tworzenie wpisu .. nie powiodło się (%d), może brakować miejsca w systemie "
+"plików\n"
 
-#: .././repair/phase6.c:1170
+#: .././repair/phase6.c:1133
 #, c-format
 msgid "bmap finish failed (err - %d), filesystem may be out of space\n"
-msgstr "zakończenie bmap nie powiodło się (błąd %d), może brakować miejsca w systemie plików\n"
+msgstr ""
+"zakończenie bmap nie powiodło się (błąd %d), może brakować miejsca w "
+"systemie plików\n"
 
-#: .././repair/phase6.c:1211
+#: .././repair/phase6.c:1173
 #, c-format
 msgid "name replace op failed (%d), filesystem may be out of space\n"
-msgstr "operacja zastąpienia nazwy nie powiodła się (%d), może brakować miejsca w systemie plików\n"
+msgstr ""
+"operacja zastąpienia nazwy nie powiodła się (%d), może brakować miejsca w "
+"systemie plików\n"
 
-#: .././repair/phase6.c:1218 .././repair/phase6.c:1258
-#: .././repair/phase6.c:1388
+#: .././repair/phase6.c:1180 .././repair/phase6.c:1219
+#: .././repair/phase6.c:1353
 #, c-format
 msgid "bmap finish failed (%d), filesystem may be out of space\n"
-msgstr "zakończenie bmap nie powiodło się (%d), może brakować miejsca w systemie plików\n"
+msgstr ""
+"zakończenie bmap nie powiodło się (%d), może brakować miejsca w systemie "
+"plików\n"
 
-#: .././repair/phase6.c:1277
+#: .././repair/phase6.c:1238
 msgid ", marking entry to be junked\n"
 msgstr ", zaznaczono wpis do wyrzucenia\n"
 
-#: .././repair/phase6.c:1281
+#: .././repair/phase6.c:1242
 msgid ", would junk entry\n"
 msgstr ", wpis zostałby wyrzucony\n"
 
-#: .././repair/phase6.c:1315
+#: .././repair/phase6.c:1275
 #, c-format
 msgid "rebuilding directory inode %<PRIu64>\n"
 msgstr "przebudowywanie i-węzła katalogu %<PRIu64>\n"
 
-#: .././repair/phase6.c:1338
+#: .././repair/phase6.c:1297
 #, c-format
 msgid "xfs_bmap_last_offset failed -- error - %d\n"
 msgstr "xfs_bmap_last_offset nie powiodło się - błąd %d\n"
 
-#: .././repair/phase6.c:1345
+#: .././repair/phase6.c:1304
 #, c-format
 msgid "xfs_bunmapi failed -- error - %d\n"
 msgstr "xfs_bunmapi nie powiodło się - błąd %d\n"
 
-#: .././repair/phase6.c:1380
+#: .././repair/phase6.c:1312
+#, c-format
+msgid "xfs_dir_init failed -- error - %d\n"
+msgstr "xfs_dir_init nie powiodło się - błąd %d\n"
+
+#: .././repair/phase6.c:1345
 #, c-format
-msgid "name create failed in ino %<PRIu64> (%d), filesystem may be out of space\n"
-msgstr "tworzenie nazwy nie powiodło się w i-węźle %<PRIu64> (%d), może brakować miejsca w systemie plików\n"
+msgid ""
+"name create failed in ino %<PRIu64> (%d), filesystem may be out of space\n"
+msgstr ""
+"tworzenie nazwy nie powiodło się w i-węźle %<PRIu64> (%d), może brakować "
+"miejsca w systemie plików\n"
 
-#: .././repair/phase6.c:1445
+#: .././repair/phase6.c:1408
 #, c-format
 msgid "shrink_inode failed inode %<PRIu64> block %u\n"
 msgstr "shrink_inode nie powiodło się dla i-węzła %<PRIu64> bloku %u\n"
 
-#: .././repair/phase6.c:1532 .././repair/phase6.c:2227
+#: .././repair/phase6.c:1499 .././repair/phase6.c:2297
 #, c-format
 msgid "realloc failed in %s (%zu bytes)\n"
 msgstr "realloc nie powiodło się w %s (bajtów: %zu)\n"
 
-#: .././repair/phase6.c:1589
+#: .././repair/phase6.c:1556
 #, c-format
 msgid "empty data block %u in directory inode %<PRIu64>: "
 msgstr "pusty blok danych %u w i-węźle katalogu %<PRIu64>: "
 
-#: .././repair/phase6.c:1593
+#: .././repair/phase6.c:1560
 #, c-format
 msgid "corrupt block %u in directory inode %<PRIu64>: "
 msgstr "uszkodzony blok %u w i-węźle katalogu %<PRIu64>: "
 
-#: .././repair/phase6.c:1597
+#: .././repair/phase6.c:1564
 msgid "junking block\n"
 msgstr "wyrzucono blok\n"
 
-#: .././repair/phase6.c:1600
+#: .././repair/phase6.c:1567
 msgid "would junk block\n"
 msgstr "blok zostałby wyrzucony\n"
 
-#: .././repair/phase6.c:1622
+#: .././repair/phase6.c:1589
 #, c-format
-msgid "bad directory block magic # %#x for directory inode %<PRIu64> block %d: "
-msgstr "błędna liczba magiczna bloku katalogu %#x dla i-węzła katalogu %<PRIu64> bloku %d: "
+msgid ""
+"bad directory block magic # %#x for directory inode %<PRIu64> block %d: "
+msgstr ""
+"błędna liczba magiczna bloku katalogu %#x dla i-węzła katalogu %<PRIu64> "
+"bloku %d: "
 
-#: .././repair/phase6.c:1625
+#: .././repair/phase6.c:1592
 #, c-format
 msgid "fixing magic # to %#x\n"
 msgstr "poprawiono liczbę magiczną na %#x\n"
 
-#: .././repair/phase6.c:1629
+#: .././repair/phase6.c:1596
 #, c-format
 msgid "would fix magic # to %#x\n"
 msgstr "liczba magiczna zostałaby poprawiona na %#x\n"
 
-#: .././repair/phase6.c:1650
+#: .././repair/phase6.c:1617
 #, c-format
 msgid "directory inode %<PRIu64> block %u has consecutive free entries: "
 msgstr "i-węzeł katalogu %<PRIu64> blok %u ma kolejne wolne wpisy: "
 
-#: .././repair/phase6.c:1653
+#: .././repair/phase6.c:1621
 msgid "joining together\n"
 msgstr "połączono\n"
 
-#: .././repair/phase6.c:1662
+#: .././repair/phase6.c:1630
 msgid "would join together\n"
 msgstr "zostałyby połączone\n"
 
-#: .././repair/phase6.c:1694
+#: .././repair/phase6.c:1663
 #, c-format
-msgid "entry \"%s\" in directory inode %<PRIu64> points to non-existent inode %<PRIu64>"
-msgstr "wpis \"%s\" w i-węźle katalogu %<PRIu64> wskazuje na nie istniejący i-węzeł %<PRIu64>"
+msgid ""
+"entry \"%s\" in directory inode %<PRIu64> points to non-existent inode "
+"%<PRIu64>"
+msgstr ""
+"wpis \"%s\" w i-węźle katalogu %<PRIu64> wskazuje na nie istniejący i-węzeł "
+"%<PRIu64>"
 
-#: .././repair/phase6.c:1711
+#: .././repair/phase6.c:1680
 #, c-format
-msgid "entry \"%s\" in directory inode %<PRIu64> points to free inode %<PRIu64>"
-msgstr "wpis \"%s\" w i-węźle katalogu %<PRIu64> wskazuje na wolny i-węzeł %<PRIu64>"
+msgid ""
+"entry \"%s\" in directory inode %<PRIu64> points to free inode %<PRIu64>"
+msgstr ""
+"wpis \"%s\" w i-węźle katalogu %<PRIu64> wskazuje na wolny i-węzeł %<PRIu64>"
 
-#: .././repair/phase6.c:1729 .././repair/phase6.c:2541
+#: .././repair/phase6.c:1698 .././repair/phase6.c:2624
 #, c-format
 msgid "%s (ino %<PRIu64>) in root (%<PRIu64>) is not a directory"
-msgstr "%s (i-węzeł %<PRIu64>) w katalogu głównym (%<PRIu64>) nie jest katalogiem"
+msgstr ""
+"%s (i-węzeł %<PRIu64>) w katalogu głównym (%<PRIu64>) nie jest katalogiem"
 
-#: .././repair/phase6.c:1751 .././repair/phase6.c:2563
+#: .././repair/phase6.c:1720 .././repair/phase6.c:2646
 #, c-format
 msgid "entry \"%s\" (ino %<PRIu64>) in dir %<PRIu64> is a duplicate name"
-msgstr "wpis \"%s\" (i-węzeł %<PRIu64>) w katalogu %<PRIu64> jest powtórzoną nazwą"
+msgstr ""
+"wpis \"%s\" (i-węzeł %<PRIu64>) w katalogu %<PRIu64> jest powtórzoną nazwą"
 
-#: .././repair/phase6.c:1782
+#: .././repair/phase6.c:1751
 #, c-format
-msgid "entry \"%s\" (ino %<PRIu64>) in dir %<PRIu64> is not in the the first block"
-msgstr "wpis \"%s\" (i-węzeł %<PRIu64>) w katalogu %<PRIu64> nie jest w pierwszym bloku"
+msgid ""
+"entry \"%s\" (ino %<PRIu64>) in dir %<PRIu64> is not in the the first block"
+msgstr ""
+"wpis \"%s\" (i-węzeł %<PRIu64>) w katalogu %<PRIu64> nie jest w pierwszym "
+"bloku"
 
-#: .././repair/phase6.c:1808
+#: .././repair/phase6.c:1777
 #, c-format
 msgid "entry \"%s\" in dir %<PRIu64> is not the first entry"
 msgstr "wpis \"%s\" w katalogu %<PRIu64> nie jest pierwszym wpisem"
 
-#: .././repair/phase6.c:1834 .././repair/phase6.c:2632
+#: .././repair/phase6.c:1803 .././repair/phase6.c:2715
 #, c-format
-msgid "would fix ftype mismatch (%d/%d) in directory/child inode %<PRIu64>/%<PRIu64>\n"
-msgstr "niezgodność ftype (%d/%d) w i-węźle katalogu/potomnym %<PRIu64>/%<PRIu64> zostałaby poprawiona\n"
+msgid ""
+"would fix ftype mismatch (%d/%d) in directory/child inode %<PRIu64>/"
+"%<PRIu64>\n"
+msgstr ""
+"niezgodność ftype (%d/%d) w i-węźle katalogu/potomnym %<PRIu64>/%<PRIu64> "
+"zostałaby poprawiona\n"
 
-#: .././repair/phase6.c:1839 .././repair/phase6.c:2637
+#: .././repair/phase6.c:1808 .././repair/phase6.c:2720
 #, c-format
-msgid "fixing ftype mismatch (%d/%d) in directory/child inode %<PRIu64>/%<PRIu64>\n"
-msgstr "niezgodność ftype (%d/%d) w i-węźle katalogu/potomnym %<PRIu64>/%<PRIu64> zostanie poprawiona\n"
+msgid ""
+"fixing ftype mismatch (%d/%d) in directory/child inode %<PRIu64>/%<PRIu64>\n"
+msgstr ""
+"niezgodność ftype (%d/%d) w i-węźle katalogu/potomnym %<PRIu64>/%<PRIu64> "
+"zostanie poprawiona\n"
 
-#: .././repair/phase6.c:1872
+#: .././repair/phase6.c:1841
 #, c-format
-msgid "entry \"%s\" in dir %<PRIu64> points to an already connected directory inode %<PRIu64>\n"
-msgstr "wpis \"%s\" w katalogu %<PRIu64> wskazuje na już podłączony i-węzeł katalogu %<PRIu64>\n"
+msgid ""
+"entry \"%s\" in dir %<PRIu64> points to an already connected directory inode "
+"%<PRIu64>\n"
+msgstr ""
+"wpis \"%s\" w katalogu %<PRIu64> wskazuje na już podłączony i-węzeł katalogu "
+"%<PRIu64>\n"
 
-#: .././repair/phase6.c:1881 .././repair/phase6.c:2601
+#: .././repair/phase6.c:1850 .././repair/phase6.c:2684
 #, c-format
-msgid "entry \"%s\" in dir ino %<PRIu64> doesn't have a .. entry, will set it in ino %<PRIu64>.\n"
-msgstr "wpis \"%s\" w i-węźle katalogu %<PRIu64> nie ma wpisu .., zostanie ustawiony w i-węźle %<PRIu64>.\n"
+msgid ""
+"entry \"%s\" in dir ino %<PRIu64> doesn't have a .. entry, will set it in "
+"ino %<PRIu64>.\n"
+msgstr ""
+"wpis \"%s\" w i-węźle katalogu %<PRIu64> nie ma wpisu .., zostanie ustawiony "
+"w i-węźle %<PRIu64>.\n"
 
-#: .././repair/phase6.c:1891
+#: .././repair/phase6.c:1860
 #, c-format
-msgid "entry \"%s\" in dir inode %<PRIu64> inconsistent with .. value (%<PRIu64>) in ino %<PRIu64>\n"
-msgstr "wpis \"%s\" w i-węźle katalogu %<PRIu64> niespójny z wartością .. (%<PRIu64>) w i-węźle %<PRIu64>\n"
+msgid ""
+"entry \"%s\" in dir inode %<PRIu64> inconsistent with .. value (%<PRIu64>) "
+"in ino %<PRIu64>\n"
+msgstr ""
+"wpis \"%s\" w i-węźle katalogu %<PRIu64> niespójny z wartością .. "
+"(%<PRIu64>) w i-węźle %<PRIu64>\n"
 
-#: .././repair/phase6.c:1903
+#: .././repair/phase6.c:1872
 #, c-format
 msgid "\twill clear entry \"%s\"\n"
 msgstr "\twpis \"%s\" zostanie wyczyszczony\n"
 
-#: .././repair/phase6.c:1906
+#: .././repair/phase6.c:1875
 #, c-format
 msgid "\twould clear entry \"%s\"\n"
 msgstr "\twpis \"%s\" zostałby wyczyszczony\n"
 
-#: .././repair/phase6.c:1953
+#: .././repair/phase6.c:1909
+#, c-format
+msgid "expected owner inode %<PRIu64>, got %llu, directory block %<PRIu64>\n"
+msgstr ""
+"oczekiwano i-węzła właściciela %<PRIu64>, napotkano %llu, blok katalogu "
+"%<PRIu64>\n"
+
+#: .././repair/phase6.c:1916
+#, c-format
+msgid "expected block %<PRIu64>, got %llu, directory inode %<PRIu64>\n"
+msgstr ""
+"oczekiwano bloku %<PRIu64>, napotkano %llu, i-węzeł katalogu %<PRIu64>\n"
+
+#: .././repair/phase6.c:1923
+#, c-format
+msgid "wrong FS UUID, directory inode %<PRIu64> block %<PRIu64>\n"
+msgstr ""
+"błędny UUID systemu plików, i-węzeł katalogu %<PRIu64> blok %<PRIu64>\n"
+
+#: .././repair/phase6.c:1983
+#, c-format
+msgid "leaf block %u for directory inode %<PRIu64> bad CRC\n"
+msgstr "blok liścia %u dla i-węzła katalogu %<PRIu64> ma błędne CRC\n"
+
+#: .././repair/phase6.c:1988
 #, c-format
 msgid "can't read block %u for directory inode %<PRIu64>, error %d\n"
 msgstr "nie można odczytać bloku %u dla i-węzła katalogu %<PRIu64>, błąd %d\n"
 
-#: .././repair/phase6.c:1971 .././repair/phase6.c:2071
+#: .././repair/phase6.c:2006 .././repair/phase6.c:2129
 #, c-format
 msgid "leaf block %u for directory inode %<PRIu64> bad header\n"
 msgstr "błędny nagłówek bloku liścia %u dla i-węzła katalogu %<PRIu64>\n"
 
-#: .././repair/phase6.c:1988
+#: .././repair/phase6.c:2032
 #, c-format
 msgid "leaf block %u for directory inode %<PRIu64> bad tail\n"
 msgstr "błędna końcówka bloku liścia %u dla i-węzła katalogu %<PRIu64>\n"
 
-#: .././repair/phase6.c:2042
+#: .././repair/phase6.c:2086
 #, c-format
 msgid "can't read leaf block %u for directory inode %<PRIu64>, error %d\n"
-msgstr "nie można odczytać bloku liścia %u dla i-węzła katalogu %<PRIu64>, błąd %d\n"
+msgstr ""
+"nie można odczytać bloku liścia %u dla i-węzła katalogu %<PRIu64>, błąd %d\n"
 
-#: .././repair/phase6.c:2057
+#: .././repair/phase6.c:2098
 #, c-format
 msgid "unknown magic number %#x for block %u in directory inode %<PRIu64>\n"
-msgstr "nieznana liczba magiczna %#x dla bloku %u w i-węźle katalogu %<PRIu64>\n"
+msgstr ""
+"nieznana liczba magiczna %#x dla bloku %u w i-węźle katalogu %<PRIu64>\n"
 
-#: .././repair/phase6.c:2096
+#: .././repair/phase6.c:2154
 #, c-format
 msgid "can't read freespace block %u for directory inode %<PRIu64>, error %d\n"
-msgstr "nie można odczytać bloku wolnego miejsca %u dla i-węzła katalogu %<PRIu64>, błąd %d\n"
+msgstr ""
+"nie można odczytać bloku wolnego miejsca %u dla i-węzła katalogu %<PRIu64>, "
+"błąd %d\n"
 
-#: .././repair/phase6.c:2111
+#: .././repair/phase6.c:2169
 #, c-format
 msgid "free block %u for directory inode %<PRIu64> bad header\n"
 msgstr "błędny nagłówek wolnego bloku %u dla i-węzła katalogu %<PRIu64>\n"
 
-#: .././repair/phase6.c:2121
+#: .././repair/phase6.c:2187
 #, c-format
 msgid "free block %u entry %i for directory ino %<PRIu64> bad\n"
 msgstr "błędny wpis wolnego bloku %u numer %i dla i-węzła katalogu %<PRIu64>\n"
 
-#: .././repair/phase6.c:2131
+#: .././repair/phase6.c:2197
 #, c-format
 msgid "free block %u for directory inode %<PRIu64> bad nused\n"
 msgstr "błędna liczba nused w wolnym bloku %u dla i-węzła katalogu %<PRIu64>\n"
 
-#: .././repair/phase6.c:2142
+#: .././repair/phase6.c:2208
 #, c-format
 msgid "missing freetab entry %u for directory inode %<PRIu64>\n"
 msgstr "brak wpisu freetab %u dla i-węzła katalogu %<PRIu64>\n"
 
-#: .././repair/phase6.c:2180
+#: .././repair/phase6.c:2247
 #, c-format
 msgid "malloc failed in %s (%<PRId64> bytes)\n"
 msgstr "malloc nie powiodło się w %s (bajtów: %<PRId64>)\n"
 
-#: .././repair/phase6.c:2194
+#: .././repair/phase6.c:2261
 #, c-format
 msgid "calloc failed in %s (%zu bytes)\n"
 msgstr "calloc nie powiodło się w %s (bajtów: %zu)\n"
 
-#: .././repair/phase6.c:2240
+#: .././repair/phase6.c:2310
 #, c-format
 msgid "can't read data block %u for directory inode %<PRIu64> error %d\n"
-msgstr "nie można odczytać bloku danych %u dla i-węzła katalogu %<PRIu64>, błąd %d\n"
+msgstr ""
+"nie można odczytać bloku danych %u dla i-węzła katalogu %<PRIu64>, błąd %d\n"
 
-#: .././repair/phase6.c:2333
+#: .././repair/phase6.c:2417
 msgid "would junk entry\n"
 msgstr "wpis zostałby wyrzucony\n"
 
-#: .././repair/phase6.c:2357
+#: .././repair/phase6.c:2441
 msgid "junking entry\n"
 msgstr "wyrzucono wpis\n"
 
-#: .././repair/phase6.c:2403
+#: .././repair/phase6.c:2487
 #, c-format
 msgid "would set .. in sf dir inode %<PRIu64> to %<PRIu64>\n"
-msgstr "wpis .. w i-węźle katalogu sf %<PRIu64> zostałby ustawiony na %<PRIu64>\n"
+msgstr ""
+"wpis .. w i-węźle katalogu sf %<PRIu64> zostałby ustawiony na %<PRIu64>\n"
 
-#: .././repair/phase6.c:2407
+#: .././repair/phase6.c:2491
 #, c-format
 msgid "setting .. in sf dir inode %<PRIu64> to %<PRIu64>\n"
 msgstr "ustawiono wpis .. w i-węźle katalogu sf %<PRIu64> na %<PRIu64>\n"
 
-#: .././repair/phase6.c:2508
+#: .././repair/phase6.c:2591
 #, c-format
-msgid "entry \"%s\" in shortform directory %<PRIu64> references non-existent inode %<PRIu64>\n"
-msgstr "wpis \"%s\" w krótkim katalogu %<PRIu64> odwołuje się do nie istniejącego i-węzła %<PRIu64>\n"
+msgid ""
+"entry \"%s\" in shortform directory %<PRIu64> references non-existent inode "
+"%<PRIu64>\n"
+msgstr ""
+"wpis \"%s\" w krótkim katalogu %<PRIu64> odwołuje się do nie istniejącego i-"
+"węzła %<PRIu64>\n"
 
-#: .././repair/phase6.c:2525
+#: .././repair/phase6.c:2608
 #, c-format
-msgid "entry \"%s\" in shortform directory inode %<PRIu64> points to free inode %<PRIu64>\n"
-msgstr "wpis \"%s\" w i-węźle krótkiego katalogu %<PRIu64> wskazuje na wolny i-węzeł %<PRIu64>\n"
+msgid ""
+"entry \"%s\" in shortform directory inode %<PRIu64> points to free inode "
+"%<PRIu64>\n"
+msgstr ""
+"wpis \"%s\" w i-węźle krótkiego katalogu %<PRIu64> wskazuje na wolny i-węzeł "
+"%<PRIu64>\n"
 
-#: .././repair/phase6.c:2587
+#: .././repair/phase6.c:2670
 #, c-format
-msgid "entry \"%s\" in directory inode %<PRIu64> references already connected inode %<PRIu64>.\n"
-msgstr "wpis \"%s\" w i-węźle katalogu %<PRIu64> odwołuje się do już podłączonego i-węzła %<PRIu64>.\n"
+msgid ""
+"entry \"%s\" in directory inode %<PRIu64> references already connected inode "
+"%<PRIu64>.\n"
+msgstr ""
+"wpis \"%s\" w i-węźle katalogu %<PRIu64> odwołuje się do już podłączonego i-"
+"węzła %<PRIu64>.\n"
 
-#: .././repair/phase6.c:2610
+#: .././repair/phase6.c:2693
 #, c-format
-msgid "entry \"%s\" in directory inode %<PRIu64> not consistent with .. value (%<PRIu64>) in inode %<PRIu64>,\n"
-msgstr "wpis \"%s\" w i-węźle katalogu %<PRIu64> niespójny z wartością .. (%<PRIu64>) w i-węźle %<PRIu64>,\n"
+msgid ""
+"entry \"%s\" in directory inode %<PRIu64> not consistent with .. value "
+"(%<PRIu64>) in inode %<PRIu64>,\n"
+msgstr ""
+"wpis \"%s\" w i-węźle katalogu %<PRIu64> niespójny z wartością .. "
+"(%<PRIu64>) w i-węźle %<PRIu64>,\n"
 
-#: .././repair/phase6.c:2667
+#: .././repair/phase6.c:2750
 #, c-format
 msgid "would fix i8count in inode %<PRIu64>\n"
 msgstr "i8count w i-węźle %<PRIu64> zostałoby poprawione\n"
 
-#: .././repair/phase6.c:2682
+#: .././repair/phase6.c:2765
 #, c-format
 msgid "fixing i8count in inode %<PRIu64>\n"
 msgstr "poprawiono i8count w i-węźle %<PRIu64>\n"
 
-#: .././repair/phase6.c:2702
+#: .././repair/phase6.c:2785
 #, c-format
 msgid "setting size to %<PRId64> bytes to reflect junked entries\n"
 msgstr "ustawiono rozmiar na %<PRId64>, aby odzwierciedlał wyrzucone wpisy\n"
 
-#: .././repair/phase6.c:2741 .././repair/phase6.c:2745 .././repair/phase7.c:84
+#: .././repair/phase6.c:2824 .././repair/phase6.c:2828 .././repair/phase7.c:52
 #, c-format
 msgid "couldn't map inode %<PRIu64>, err = %d\n"
 msgstr "nie udało się odwzorować i-węzła %<PRIu64>, błąd = %d\n"
 
-#: .././repair/phase6.c:2850
+#: .././repair/phase6.c:2929
 msgid "recreating root directory .. entry\n"
 msgstr "ponowne tworzenie wpisu .. głównego katalogu\n"
 
-#: .././repair/phase6.c:2868
+#: .././repair/phase6.c:2945
 #, c-format
 msgid "can't make \"..\" entry in root inode %<PRIu64>, createname error %d\n"
-msgstr "nie można utworzyć wpisu \"..\" w i-węźle głównego katalogu %<PRIu64>, błąd createname %d\n"
+msgstr ""
+"nie można utworzyć wpisu \"..\" w i-węźle głównego katalogu %<PRIu64>, błąd "
+"createname %d\n"
 
-#: .././repair/phase6.c:2879
+#: .././repair/phase6.c:2955
 msgid "would recreate root directory .. entry\n"
 msgstr "wpis .. głównego katalogu zostałby ponownie utworzony\n"
 
-#: .././repair/phase6.c:2903
+#: .././repair/phase6.c:2979
 #, c-format
 msgid "would create missing \".\" entry in dir ino %<PRIu64>\n"
 msgstr "brakujący wpis \".\" w i-węźle katalogu %<PRIu64> zostałby utworzony\n"
 
-#: .././repair/phase6.c:2910
+#: .././repair/phase6.c:2986
 #, c-format
 msgid "creating missing \".\" entry in dir ino %<PRIu64>\n"
 msgstr "tworzenie brakującego wpisu \".\" w i-węźle katalogu %<PRIu64>\n"
 
-#: .././repair/phase6.c:2929
+#: .././repair/phase6.c:3002
 #, c-format
 msgid "can't make \".\" entry in dir ino %<PRIu64>, createname error %d\n"
-msgstr "nie można utworzyć wpisu \".\" w i-węźle katalogu %<PRIu64>, błąd createname %d\n"
+msgstr ""
+"nie można utworzyć wpisu \".\" w i-węźle katalogu %<PRIu64>, błąd createname "
+"%d\n"
 
-#: .././repair/phase6.c:3026
+#: .././repair/phase6.c:3098
 #, c-format
 msgid "disconnected dir inode %<PRIu64>, "
 msgstr "odłączony i-węzeł katalogu %<PRIu64>, "
 
-#: .././repair/phase6.c:3028
+#: .././repair/phase6.c:3100
 #, c-format
 msgid "disconnected inode %<PRIu64>, "
 msgstr "odłączony i-węzeł %<PRIu64>, "
 
-#: .././repair/phase6.c:3032
+#: .././repair/phase6.c:3104
 #, c-format
 msgid "moving to %s\n"
 msgstr "przeniesiono do %s\n"
 
-#: .././repair/phase6.c:3035
+#: .././repair/phase6.c:3107
 #, c-format
 msgid "would move to %s\n"
 msgstr "zostałby przeniesiony do %s\n"
 
-#: .././repair/phase6.c:3120
+#: .././repair/phase6.c:3192
 msgid "Phase 6 - check inode connectivity...\n"
 msgstr "Faza 6 - sprawdzanie łączności i-węzłów...\n"
 
-#: .././repair/phase6.c:3134
+#: .././repair/phase6.c:3206
 msgid "reinitializing root directory\n"
 msgstr "ponowne inicjowanie głównego katalogu\n"
 
-#: .././repair/phase6.c:3139
+#: .././repair/phase6.c:3211
 msgid "would reinitialize root directory\n"
 msgstr "główny katalog zostałby ponownie zainicjowany\n"
 
-#: .././repair/phase6.c:3145
+#: .././repair/phase6.c:3217
 msgid "reinitializing realtime bitmap inode\n"
 msgstr "ponowne inicjowanie i-węzła bitmapy realtime\n"
 
-#: .././repair/phase6.c:3149
+#: .././repair/phase6.c:3221
 msgid "would reinitialize realtime bitmap inode\n"
 msgstr "i-węzeł bitmapy realtime zostałby ponownie zainicjowany\n"
 
-#: .././repair/phase6.c:3155
+#: .././repair/phase6.c:3227
 msgid "reinitializing realtime summary inode\n"
 msgstr "ponowne inicjowanie i-węzła opisu realtime\n"
 
-#: .././repair/phase6.c:3159
+#: .././repair/phase6.c:3231
 msgid "would reinitialize realtime summary inode\n"
 msgstr "i-węzeł opisu realtime zostałby ponownie zainicjowany\n"
 
-#: .././repair/phase6.c:3165
+#: .././repair/phase6.c:3237
 msgid "        - resetting contents of realtime bitmap and summary inodes\n"
 msgstr "        - przestawianie zawartości i-węzłów bitmapy i opisu realtime\n"
 
-#: .././repair/phase6.c:3168 .././repair/phase6.c:3173
+#: .././repair/phase6.c:3240 .././repair/phase6.c:3245
 msgid "Warning:  realtime bitmap may be inconsistent\n"
 msgstr "Uwaga: bitmapa realtime może być niespójna\n"
 
-#: .././repair/phase6.c:3179
+#: .././repair/phase6.c:3251
 msgid "        - traversing filesystem ...\n"
 msgstr "        - przechodzenie systemu plików...\n"
 
-#: .././repair/phase6.c:3202
+#: .././repair/phase6.c:3274
 msgid "        - traversal finished ...\n"
 msgstr "        - przechodzenie zakończone...\n"
 
-#: .././repair/phase6.c:3203
+#: .././repair/phase6.c:3275
 #, c-format
 msgid "        - moving disconnected inodes to %s ...\n"
 msgstr "        - przenoszenie odłączonych i-węzłów do %s...\n"
 
-#: .././repair/phase7.c:43
+#: .././repair/phase7.c:56
 #, c-format
-msgid "resetting inode %<PRIu64> nlinks from %u to %u\n"
-msgstr "przestawiono nlinks i-węzła %<PRIu64> z %u na %u\n"
+msgid "couldn't map inode %<PRIu64>, err = %d, can't compare link counts\n"
+msgstr ""
+"nie udało się odwzorować i-węzła %<PRIu64>, błąd %d, nie można porównać "
+"liczby dowiązań\n"
 
-#: .././repair/phase7.c:49
+#: .././repair/phase7.c:68
 #, c-format
-msgid "nlinks %u will overflow v1 ino, ino %<PRIu64> will be converted to version 2\n"
-msgstr "nlinks %u przepełni i-węzeł v1, i-węzeł %<PRIu64> będzie skonwertowany do wersji 2\n"
+msgid "resetting inode %<PRIu64> nlinks from %u to %u\n"
+msgstr "przestawiono nlinks i-węzła %<PRIu64> z %u na %u\n"
 
-#: .././repair/phase7.c:56
+#: .././repair/phase7.c:74
 #, c-format
 msgid "would have reset inode %<PRIu64> nlinks from %u to %u\n"
 msgstr "nlinks i-węzła %<PRIu64> zostałoby przestawione z %u na %u\n"
 
-#: .././repair/phase7.c:88
-#, c-format
-msgid "couldn't map inode %<PRIu64>, err = %d, can't compare link counts\n"
-msgstr "nie udało się odwzorować i-węzła %<PRIu64>, błąd %d, nie można porównać liczby dowiązań\n"
-
-#: .././repair/phase7.c:127
+#: .././repair/phase7.c:142
 msgid "Phase 7 - verify and correct link counts...\n"
 msgstr "Faza 7 - sprawdzanie i poprawianie liczby dowiązań...\n"
 
-#: .././repair/phase7.c:129
+#: .././repair/phase7.c:144
 msgid "Phase 7 - verify link counts...\n"
 msgstr "Faza 7 - sprawdzanie liczby dowiązań...\n"
 
-#: .././repair/prefetch.c:532
+#: .././repair/prefetch.c:543
 msgid "prefetch corruption\n"
 msgstr "uszkodzenie prefetch\n"
 
-#: .././repair/prefetch.c:692 .././repair/prefetch.c:795
+#: .././repair/prefetch.c:704 .././repair/prefetch.c:817
 #, c-format
 msgid "failed to create prefetch thread: %s\n"
 msgstr "nie udało się utworzyć wątku prefetch: %s\n"
 
-#: .././repair/prefetch.c:832
+#: .././repair/prefetch.c:854
 msgid "failed to initialize prefetch mutex\n"
 msgstr "nie udało się zainicjować muteksu prefetch\n"
 
-#: .././repair/prefetch.c:834 .././repair/prefetch.c:836
+#: .././repair/prefetch.c:856 .././repair/prefetch.c:858
 msgid "failed to initialize prefetch cond var\n"
 msgstr "nie udało się zainicjować zmiennej warunkowej prefetch\n"
 
@@ -11834,100 +13468,106 @@ msgstr "nie udało się utworzyć wątku
 msgid "progress_rpt: cannot malloc progress msg buffer\n"
 msgstr "progress_rpt: nie udało się przydzielić bufora komunikatów postępu\n"
 
-#: .././repair/progress.c:192
+#: .././repair/progress.c:191
 msgid "progress_rpt: cannot create timer\n"
 msgstr "progress_rpt: nie można utworzyć zegara\n"
 
-#: .././repair/progress.c:195
+#: .././repair/progress.c:194
 msgid "progress_rpt: cannot set timer\n"
 msgstr "progress_rpt: nie można ustawić zegara\n"
 
-#: .././repair/progress.c:219
+#: .././repair/progress.c:218
 msgid "progress_rpt: cannot lock progress mutex\n"
 msgstr "progress_rpt: nie można zablokować muteksu\n"
 
-#: .././repair/progress.c:256 .././repair/progress.c:359
+#: .././repair/progress.c:255 .././repair/progress.c:358
 #, c-format
 msgid "%s"
 msgstr "%s"
 
-#: .././repair/progress.c:264
+#: .././repair/progress.c:263
 #, c-format
-msgid "\t- %02d:%02d:%02d: Phase %d: elapsed time %s - processed %d %s per minute\n"
-msgstr "\t- %02d:%02d:%02d: Faza %d: miniony czas %s - przetworzono %d %s na minutę\n"
+msgid ""
+"\t- %02d:%02d:%02d: Phase %d: elapsed time %s - processed %d %s per minute\n"
+msgstr ""
+"\t- %02d:%02d:%02d: Faza %d: miniony czas %s - przetworzono %d %s na minutę\n"
 
-#: .././repair/progress.c:269
+#: .././repair/progress.c:268
 #, c-format
-msgid "\t- %02d:%02d:%02d: Phase %d: %<PRIu64>%% done - estimated remaining time %s\n"
-msgstr "\t- %02d:%02d:%02d: Faza %d: %<PRIu64>%% zrobione - przewidywany pozostały czas %s\n"
+msgid ""
+"\t- %02d:%02d:%02d: Phase %d: %<PRIu64>%% done - estimated remaining time "
+"%s\n"
+msgstr ""
+"\t- %02d:%02d:%02d: Faza %d: %<PRIu64>%% zrobione - przewidywany pozostały "
+"czas %s\n"
 
-#: .././repair/progress.c:277
+#: .././repair/progress.c:276
 msgid "progress_rpt: error unlock msg mutex\n"
 msgstr "progress_rpt: błąd odblokowywania muteksu komunikatów\n"
 
-#: .././repair/progress.c:283
+#: .././repair/progress.c:282
 msgid "cannot delete timer\n"
 msgstr "nie można usunąć zegara\n"
 
-#: .././repair/progress.c:297
+#: .././repair/progress.c:296
 msgid "set_progress_msg: cannot lock progress mutex\n"
 msgstr "set_progress_msg: nie można zablokować mutekstu postępu\n"
 
-#: .././repair/progress.c:307
+#: .././repair/progress.c:306
 msgid "set_progress_msg: cannot unlock progress mutex\n"
 msgstr "set_progress_msg: nie można odblokować mutekstu postępu\n"
 
-#: .././repair/progress.c:327
+#: .././repair/progress.c:326
 msgid "print_final_rpt: cannot lock progress mutex\n"
 msgstr "print_final_rpt: nie można zablokować mutekstu postępu\n"
 
-#: .././repair/progress.c:363
+#: .././repair/progress.c:362
 msgid "print_final_rpt: cannot unlock progress mutex\n"
 msgstr "print_final_rpt: nie można odblokować muteksu postępu\n"
 
-#: .././repair/progress.c:412
+#: .././repair/progress.c:411
 #, c-format
 msgid "%02d:%02d:%02d"
 msgstr "%02d:%02d:%02d"
 
-#: .././repair/progress.c:434
+#: .././repair/progress.c:433
 #, c-format
 msgid "%d week"
 msgstr "%d tygodni"
 
-#: .././repair/progress.c:435 .././repair/progress.c:445
-#: .././repair/progress.c:461 .././repair/progress.c:479
-#: .././repair/progress.c:494
+#: .././repair/progress.c:434 .././repair/progress.c:444
+#: .././repair/progress.c:460 .././repair/progress.c:478
+#: .././repair/progress.c:493
 msgid "s"
 msgstr " "
 
 # XXX: ngettext()
-#: .././repair/progress.c:444
+#: .././repair/progress.c:443
 #, c-format
 msgid "%d day"
 msgstr "%d dni"
 
-#: .././repair/progress.c:451 .././repair/progress.c:468
-#: .././repair/progress.c:486 .././repair/progress.c:496
+#: .././repair/progress.c:450 .././repair/progress.c:467
+#: .././repair/progress.c:485 .././repair/progress.c:495
 msgid ", "
 msgstr ", "
 
-#: .././repair/progress.c:460
+#: .././repair/progress.c:459
 #, c-format
 msgid "%d hour"
 msgstr "%d godzin"
 
-#: .././repair/progress.c:478
+#: .././repair/progress.c:477
 #, c-format
 msgid "%d minute"
 msgstr "%d minut"
 
-#: .././repair/progress.c:493
+#: .././repair/progress.c:492
 #, c-format
 msgid "%d second"
 msgstr "%d sekund"
 
-#: .././repair/progress.c:514
+#: .././repair/progress.c:513
 #, c-format
 msgid ""
 "\n"
@@ -11936,21 +13576,21 @@ msgstr ""
 "\n"
 "        Podsumowanie XFS_REPAIR %s\n"
 
-#: .././repair/progress.c:516
+#: .././repair/progress.c:515
 msgid "Phase\t\tStart\t\tEnd\t\tDuration\n"
 msgstr "Faza\t\tPoczątek\tKoniec\t\tCzas trwania\n"
 
-#: .././repair/progress.c:521 .././repair/progress.c:524
+#: .././repair/progress.c:520 .././repair/progress.c:523
 #, c-format
 msgid "Phase %d:\tSkipped\n"
 msgstr "Faza %d:\tPominięta\n"
 
-#: .././repair/progress.c:528
+#: .././repair/progress.c:527
 #, c-format
 msgid "Phase %d:\t%02d/%02d %02d:%02d:%02d\t%02d/%02d %02d:%02d:%02d\t%s\n"
 msgstr "Faza %d:\t%02d.%02d %02d:%02d:%02d\t%02d.%02d %02d:%02d:%02d\t%s\n"
 
-#: .././repair/progress.c:534
+#: .././repair/progress.c:533
 #, c-format
 msgid ""
 "\n"
@@ -11959,6 +13599,101 @@ msgstr ""
 "\n"
 "Całkowity czas trwania: %s\n"
 
+#: .././repair/rmap.c:112
+msgid "couldn't allocate per-AG reverse map roots\n"
+msgstr "nie udało się przydzielić korzeni odwrotnej mapy AG\n"
+
+#: .././repair/rmap.c:119
+msgid "Insufficient memory while allocating reverse mapping slabs."
+msgstr "Za mało pamięci podczas przydzielania płyt odwrotnych odwzorowań."
+
+#: .././repair/rmap.c:124 .././repair/rmap.c:363
+msgid ""
+"Insufficient memory while allocating raw metadata reverse mapping slabs."
+msgstr ""
+"Za mało pamięci podczas przydzielania płyt odwrotnych odwzorowań surowych "
+"metadanych."
+
+#: .././repair/rmap.c:130
+msgid "Insufficient memory while allocating refcount item slabs."
+msgstr "Za mało pamięci podczas przydzielania płyt elementów zliczania odwołań."
+
+#: .././repair/rmap.c:736
+msgid "Insufficient memory while recreating refcount tree."
+msgstr "Za mało pamięci podczas ponownego tworzenia drzewa zliczania odwołań."
+
+#: .././repair/rmap.c:993
+msgid "would rebuild corrupt rmap btrees.\n"
+msgstr "uszkodzone b-drzewa rmap zostałyby przebudowane.\n"
+
+#: .././repair/rmap.c:1036
+#, c-format
+msgid ""
+"Missing reverse-mapping record for (%u/%u) %slen %u owner %<PRId64> %s%soff "
+"%<PRIu64>\n"
+msgstr ""
+"Brak rekordu odwrotnego odwzorowania dla: (%u/%u) %sdługość %u właściciel "
+"%<PRId64> %s%soff %<PRIu64>\n"
+
+#: .././repair/rmap.c:1040 .././repair/rmap.c:1058 .././repair/rmap.c:1068
+msgid "unwritten "
+msgstr "nie zapisana "
+
+#: .././repair/rmap.c:1044 .././repair/rmap.c:1062 .././repair/rmap.c:1072
+msgid "attr "
+msgstr "attr "
+
+#: .././repair/rmap.c:1046 .././repair/rmap.c:1064 .././repair/rmap.c:1074
+msgid "bmbt "
+msgstr "bmbt "
+
+#: .././repair/rmap.c:1054
+#, c-format
+msgid ""
+"Incorrect reverse-mapping: saw (%u/%u) %slen %u owner %<PRId64> %s%soff "
+"%<PRIu64>; should be (%u/%u) %slen %u owner %<PRId64> %s%soff %<PRIu64>\n"
+msgstr ""
+"Nieprawidłowe odwrotne odwzorowanie: widziano (%u/%u) %sdługość %u "
+"właściciel %<PRId64> %s%soff %<PRIu64>; powinno być (%u/%u) %sdługość %u "
+"właściciel %<PRId64> %s%soff %<PRIu64>\n"
+
+#: .././repair/rmap.c:1189
+#, c-format
+msgid "setting reflink flag on inode %<PRIu64>\n"
+msgstr "ustawiono flagę reflink dla i-węzła %<PRIu64>\n"
+
+#: .././repair/rmap.c:1193
+#, c-format
+msgid "clearing reflink flag on inode %<PRIu64>\n"
+msgstr "wyczyszczono flagę reflink dla i-węzła %<PRIu64>\n"
+
+#: .././repair/rmap.c:1264
+#, c-format
+msgid "Unable to fix reflink flag on inode %<PRIu64>.\n"
+msgstr "Nie udało się poprawić flagi reflink dla i-węzła %<PRIu64>.\n"
+
+#: .././repair/rmap.c:1325
+msgid "would rebuild corrupt refcount btrees.\n"
+msgstr "uszkodzone b-drzewa zliczania odwołań zostałyby przebudowane.\n"
+
+#: .././repair/rmap.c:1358 .././repair/rmap.c:1369
+#, c-format
+msgid "Missing reference count record for (%u/%u) len %u count %u\n"
+msgstr "Brak rekordu zliczania odwołań dla (%u/%u) długość %u licznik %u\n"
+
+#: .././repair/rmap.c:1380
+#, c-format
+msgid ""
+"Incorrect reference count: saw (%u/%u) len %u nlinks %u; should be (%u/%u) "
+"len %u nlinks %u\n"
+msgstr ""
+"Nieprawidłowy licznik odwołań: widziano (%u/%u) długość %u nlinks %u; powinno być (%u/%u) długość %u nlinks %u\n"
+
+#: .././repair/rmap.c:1422 .././repair/rmap.c:1453
+#, c-format
+msgid "failed to fix AGFL on AG %d, error %d\n"
+msgstr "nie udało się naprawić AGFL w AG %d, błąd %d\n"
+
 #: .././repair/rt.c:47
 msgid "couldn't allocate memory for incore realtime bitmap.\n"
 msgstr "nie udało się przydzielić pamięci dla bitmapy realtime.\n"
@@ -11987,167 +13722,210 @@ msgstr "brak bloku %d dla i-węzła opis
 msgid "can't read block %d for rtsummary inode\n"
 msgstr "nie można odczytać bloku %d dla i-węzła opisu realtime\n"
 
-#: .././repair/sb.c:103
-msgid ""
-"\n"
-"attempting to find secondary superblock...\n"
-msgstr ""
-"\n"
-"próba odnalezienia zapasowego superbloku...\n"
-
-#: .././repair/sb.c:108
+#: .././repair/sb.c:125
 msgid "error finding secondary superblock -- failed to memalign buffer\n"
-msgstr "błąd podczas szukania zapasowego superbloku - nie udało się memalign bufora\n"
+msgstr ""
+"błąd podczas szukania zapasowego superbloku - nie udało się memalign bufora\n"
 
-#: .././repair/sb.c:146
+#: .././repair/sb.c:162
 msgid "found candidate secondary superblock...\n"
 msgstr "znaleziono potencjalny zapasowy superblok...\n"
 
-#: .././repair/sb.c:158
+#: .././repair/sb.c:174
 msgid "verified secondary superblock...\n"
 msgstr "sprawdzono zapasowy superblok...\n"
 
-#: .././repair/sb.c:163
+#: .././repair/sb.c:179
 msgid "unable to verify superblock, continuing...\n"
 msgstr "nie udało się sprawdzić superbloku, kontynuacja...\n"
 
-#: .././repair/sb.c:482
+#: .././repair/sb.c:229
+msgid ""
+"\n"
+"attempting to find secondary superblock...\n"
+msgstr ""
+"\n"
+"próba odnalezienia zapasowego superbloku...\n"
+
+#: .././repair/sb.c:517
 msgid "failed to memalign superblock buffer\n"
 msgstr "nie udało się wykonać memalign dla bufora superbloku\n"
 
-#: .././repair/sb.c:489
+#: .././repair/sb.c:524
 msgid "couldn't seek to offset 0 in filesystem\n"
 msgstr "nie udało się wykonać seek na offset 0 w systemie plików\n"
 
-#: .././repair/sb.c:499
+#: .././repair/sb.c:534
 msgid "primary superblock write failed!\n"
 msgstr "zapis głównego superbloku nie powiódł się!\n"
 
-#: .././repair/sb.c:517
+#: .././repair/sb.c:552
 #, c-format
 msgid "error reading superblock %u -- failed to memalign buffer\n"
-msgstr "błąd podczas odczytu superbloku %u - nie udało się wykonać memalign dla bufora\n"
+msgstr ""
+"błąd podczas odczytu superbloku %u - nie udało się wykonać memalign dla "
+"bufora\n"
 
-#: .././repair/sb.c:528
+#: .././repair/sb.c:563
 #, c-format
 msgid "error reading superblock %u -- seek to offset %<PRId64> failed\n"
-msgstr "błąd podczas odczytu superbloku %u - seek na offset %<PRId64> nie powiódł się\n"
+msgstr ""
+"błąd podczas odczytu superbloku %u - seek na offset %<PRId64> nie powiódł "
+"się\n"
 
-#: .././repair/sb.c:537
+#: .././repair/sb.c:572
 #, c-format
 msgid "superblock read failed, offset %<PRId64>, size %d, ag %u, rval %d\n"
-msgstr "odczyt superbloku nie powiódł się, offset %<PRId64>, rozmiar %d, ag %u, rval %d\n"
+msgstr ""
+"odczyt superbloku nie powiódł się, offset %<PRId64>, rozmiar %d, ag %u, rval "
+"%d\n"
 
-#: .././repair/sb.c:585
+#: .././repair/sb.c:619
 msgid "couldn't malloc geometry structure\n"
 msgstr "nie udało się przydzielić struktury geometrii\n"
 
-#: .././repair/sb.c:735
-msgid "calloc failed in verify_set_primary_sb\n"
-msgstr "calloc nie powiodło się w verify_set_primary_sb\n"
-
-#: .././repair/sb.c:806
+#: .././repair/sb.c:773
 msgid ""
-"Only two AGs detected and they do not match - cannot validate filesystem geometry.\n"
+"Only two AGs detected and they do not match - cannot validate filesystem "
+"geometry.\n"
 "Use the -o force_geometry option to proceed.\n"
 msgstr ""
-"Wykryto tylko dwie AG i nie zgadzają się - nie można sprawdzić poprawności geometrii systemu plików.\n"
+"Wykryto tylko dwie AG i nie zgadzają się - nie można sprawdzić poprawności "
+"geometrii systemu plików.\n"
 "Proszę użyć opcji -o force_geometry, aby kontynuować.\n"
 
-#: .././repair/sb.c:822
+#: .././repair/sb.c:789
 msgid ""
 "Only one AG detected - cannot validate filesystem geometry.\n"
 "Use the -o force_geometry option to proceed.\n"
 msgstr ""
-"Wykryto tylko dwie AG - nie można sprawdzić poprawności geometrii systemu plików.\n"
+"Wykryto tylko dwie AG - nie można sprawdzić poprawności geometrii systemu "
+"plików.\n"
 "Proszę użyć opcji -o force_geometry, aby kontynuować.\n"
 
-#: .././repair/sb.c:837
+#: .././repair/sb.c:804
 msgid "Not enough matching superblocks - cannot proceed.\n"
 msgstr "Za mało pasujących superbloków - nie można kontynuować.\n"
 
-#: .././repair/sb.c:852
+#: .././repair/sb.c:819
 msgid "could not read superblock\n"
 msgstr "nie udało się odczytać superbloku\n"
 
-#: .././repair/scan.c:83 .././repair/scan.c:138
+#: .././repair/scan.c:85 .././repair/scan.c:140
 #, c-format
 msgid "can't read btree block %d/%d\n"
 msgstr "nie można odczytać bloku b-drzewa %d/%d\n"
 
-#: .././repair/scan.c:87 .././repair/scan.c:150
+#: .././repair/scan.c:89 .././repair/scan.c:152
 #, c-format
 msgid "btree block %d/%d is suspect, error %d\n"
 msgstr "blok b-drzewa %d/%d jest podejrzany, błąd %d\n"
 
-#: .././repair/scan.c:210
+#: .././repair/scan.c:213
 #, c-format
 msgid "bad magic # %#x in inode %<PRIu64> (%s fork) bmbt block %<PRIu64>\n"
-msgstr "błędna liczba magiczna %#x w i-węźle %<PRIu64> (gałąź %s) blok bmbt %<PRIu64>\n"
+msgstr ""
+"błędna liczba magiczna %#x w i-węźle %<PRIu64> (gałąź %s) blok bmbt "
+"%<PRIu64>\n"
 
-#: .././repair/scan.c:216
+#: .././repair/scan.c:219
 #, c-format
-msgid "expected level %d got %d in inode %<PRIu64>, (%s fork) bmbt block %<PRIu64>\n"
-msgstr "oczekiwano poziomu %d, a uzyskano %d w i-węźle %<PRIu64>, (gałęzi %s) blok bmbt %<PRIu64>\n"
+msgid ""
+"expected level %d got %d in inode %<PRIu64>, (%s fork) bmbt block %<PRIu64>\n"
+msgstr ""
+"oczekiwano poziomu %d, a uzyskano %d w i-węźle %<PRIu64>, (gałęzi %s) blok "
+"bmbt %<PRIu64>\n"
 
-#: .././repair/scan.c:226
+#: .././repair/scan.c:229
 #, c-format
 msgid "expected owner inode %<PRIu64>, got %llu, bmbt block %<PRIu64>\n"
-msgstr "oczekiwano i-węzła właściciela %<PRIu64>, napotkano %llu, blok bmbt %<PRIu64>\n"
+msgstr ""
+"oczekiwano i-węzła właściciela %<PRIu64>, napotkano %llu, blok bmbt "
+"%<PRIu64>\n"
+
+#: .././repair/scan.c:237
+#, c-format
+msgid "expected block %<PRIu64>, got %llu, bmbt block %<PRIu64>\n"
+msgstr "oczekiwano bloku %<PRIu64>, napotkano %llu, blok bmbt %<PRIu64>\n"
 
 #: .././repair/scan.c:246
 #, c-format
+msgid "wrong FS UUID, bmbt block %<PRIu64>\n"
+msgstr "błędny UUID systemu plików, blok bmbt %<PRIu64>\n"
+
+#: .././repair/scan.c:266
+#, c-format
 msgid ""
 "bad fwd (right) sibling pointer (saw %<PRIu64> parent block says %<PRIu64>)\n"
 "\tin inode %<PRIu64> (%s fork) bmap btree block %<PRIu64>\n"
 msgstr ""
-"błędny wskaźnik w przód (prawy) (widziano %<PRIu64>, blok nadrzędny mówi %<PRIu64>)\n"
+"błędny wskaźnik w przód (prawy) (napotkano %<PRIu64>, blok nadrzędny mówi "
+"%<PRIu64>)\n"
 "\tw i-węźle %<PRIu64> (gałęzi %s) bloku bmap btree %<PRIu64>\n"
 
-#: .././repair/scan.c:256
+#: .././repair/scan.c:276
 #, c-format
 msgid ""
 "bad back (left) sibling pointer (saw %llu parent block says %<PRIu64>)\n"
 "\tin inode %<PRIu64> (%s fork) bmap btree block %<PRIu64>\n"
 msgstr ""
-"błędny wskaźnik wstecz (lewy) (widziano %llu, blok nadrzędny mówi %<PRIu64>)\n"
+"błędny wskaźnik wstecz (lewy) (napotkano %llu, blok nadrzędny mówi "
+"%<PRIu64>)\n"
 "\tw i-węźle %<PRIu64> (gałęzi %s) bloku bmap btree %<PRIu64>\n"
 
-#: .././repair/scan.c:271
+#: .././repair/scan.c:291
 #, c-format
 msgid ""
 "bad back (left) sibling pointer (saw %llu should be NULL (0))\n"
 "\tin inode %<PRIu64> (%s fork) bmap btree block %<PRIu64>\n"
 msgstr ""
-"błędny wskaźnik wstecz (lewy) (widziano %llu, powinien być NULL (0))\n"
+"błędny wskaźnik wstecz (lewy) (napotkano %llu, powinien być NULL (0))\n"
 "\tw i-węźle %<PRIu64> (gałęzi %s) bloku bmap btree %<PRIu64>\n"
 
-#: .././repair/scan.c:312
+#: .././repair/scan.c:339
 #, c-format
 msgid "inode 0x%<PRIx64>bmap block 0x%<PRIx64> claimed, state is %d\n"
 msgstr "i-węzeł 0x%<PRIx64> blok bmap 0x%<PRIx64> przypisany, stan to %d\n"
 
-#: .././repair/scan.c:319
+#: .././repair/scan.c:346
 #, c-format
 msgid "inode 0x%<PRIx64> bmap block 0x%<PRIx64> claimed, state is %d\n"
 msgstr "i-węzeł 0x%<PRIx64> blok bmap 0x%<PRIx64> przypisany, stan to %d\n"
 
-#: .././repair/scan.c:334
+#: .././repair/scan.c:361
 #, c-format
 msgid "bad state %d, inode %<PRIu64> bmap block 0x%<PRIx64>\n"
 msgstr "błędny stan %d, i-węzeł %<PRIu64> blok bmap 0x%<PRIx64>\n"
 
-#: .././repair/scan.c:361 .././repair/scan.c:412
+#: .././repair/scan.c:389
+#, c-format
+msgid "couldn't add inode %<PRIu64> bmbt block %<PRIu64> reverse-mapping data."
+msgstr ""
+"nie udało się dodać i-węzła %<PRIu64>, dane odwrotnego odwzorowania bloku "
+"bmbt %<PRIu64>."
+
+#: .././repair/scan.c:397 .././repair/scan.c:448
 #, c-format
 msgid "inode %<PRIu64> bad # of bmap records (%u, min - %u, max - %u)\n"
-msgstr "błędna liczba rekordów bmap w i-węźle %<PRIu64> (%u, minimum - %u, maksimum - %u)\n"
+msgstr ""
+"błędna liczba rekordów bmap w i-węźle %<PRIu64> (%u, minimum - %u, maksimum "
+"- %u)\n"
+
+#: .././repair/scan.c:427
+#, c-format
+msgid ""
+"out-of-order bmap key (file offset) in inode %<PRIu64>, %s fork, fsbno "
+"%<PRIu64>\n"
+msgstr ""
+"uszkodzony klucz bmap (offset pliku) w i-węźle %<PRIu64>, gałęzi %s, fsbno "
+"%<PRIu64>\n"
 
-#: .././repair/scan.c:391
+#: .././repair/scan.c:465
 #, c-format
-msgid "out-of-order bmap key (file offset) in inode %<PRIu64>, %s fork, fsbno %<PRIu64>\n"
-msgstr "uszkodzony klucz bmap (offset pliku) w i-węźle %<PRIu64>, gałęzi %s, fsbno %<PRIu64>\n"
+msgid "bad bmap btree ptr 0x%llx in ino %<PRIu64>\n"
+msgstr "błędny wskaźnik bmap btree 0x%llx w i-węźle %<PRIu64>\n"
 
-#: .././repair/scan.c:457
+#: .././repair/scan.c:493
 #, c-format
 msgid ""
 "correcting bt key (was %llu, now %<PRIu64>) in inode %<PRIu64>\n"
@@ -12156,284 +13934,509 @@ msgstr ""
 "poprawiono klucz bt (było %llu, jest %<PRIu64>) w i-węźle %<PRIu64>\n"
 "\t\tgałąź %s, blok b-drzewa %<PRIu64>\n"
 
-#: .././repair/scan.c:469
+#: .././repair/scan.c:505
 #, c-format
 msgid ""
 "bad btree key (is %llu, should be %<PRIu64>) in inode %<PRIu64>\n"
 "\t\t%s fork, btree block %<PRIu64>\n"
 msgstr ""
-"błędny klucz b-drzewa (jest %llu, powinno być %<PRIu64>) w i-węźle %<PRIu64>\n"
+"błędny klucz b-drzewa (jest %llu, powinno być %<PRIu64>) w i-węźle "
+"%<PRIu64>\n"
 "\t\tgałąź %s, blok b-drzewa %<PRIu64>\n"
 
-#: .././repair/scan.c:487
+#: .././repair/scan.c:523
 #, c-format
 msgid ""
 "bad fwd (right) sibling pointer (saw %<PRIu64> should be NULLFSBLOCK)\n"
 "\tin inode %<PRIu64> (%s fork) bmap btree block %<PRIu64>\n"
 msgstr ""
-"błędny wskaźnik w przód (prawy) (widziano %<PRIu64>, powinien być NULLFSBLOCK)\n"
+"błędny wskaźnik w przód (prawy) (napotkano %<PRIu64>, powinien być "
+"NULLFSBLOCK)\n"
 "\tw i-węźle %<PRIu64> (gałęzi %s) bloku bmap btree %<PRIu64>\n"
 
-#: .././repair/scan.c:545
+#: .././repair/scan.c:581 .././repair/scan.c:958
 #, c-format
 msgid "bad magic # %#x in bt%s block %d/%d\n"
 msgstr "błędna liczba magiczna %#x w bloku bt%s %d/%d\n"
 
-#: .././repair/scan.c:563
+#: .././repair/scan.c:599 .././repair/scan.c:977
 #, c-format
 msgid "expected level %d got %d in bt%s block %d/%d\n"
 msgstr "oczekiwano poziomu %d, a uzyskano %d w bloku bt%s %d/%d\n"
 
-#: .././repair/scan.c:577
+#: .././repair/scan.c:613
 #, c-format
-msgid "%s freespace btree block claimed (state %d), agno %d, bno %d, suspect %d\n"
-msgstr "blok b-drzewa wolnego miejsca %s przypisany (stan %d), agno %d, bno %d, podejrzany %d\n"
+msgid ""
+"%s freespace btree block claimed (state %d), agno %d, bno %d, suspect %d\n"
+msgstr ""
+"blok b-drzewa wolnego miejsca %s przypisany (stan %d), agno %d, bno %d, "
+"podejrzany %d\n"
 
-#: .././repair/scan.c:597 .././repair/scan.c:698
+#: .././repair/scan.c:633 .././repair/scan.c:734 .././repair/scan.c:1008
+#: .././repair/scan.c:1152
 #, c-format
 msgid "bad btree nrecs (%u, min=%u, max=%u) in bt%s block %u/%u\n"
-msgstr "błędna liczba rekordów b-drzewa (%u, min=%u, max=%u) w bt%s, blok %u/%u\n"
+msgstr ""
+"błędna liczba rekordów b-drzewa (%u, min=%u, max=%u) w bt%s, blok %u/%u\n"
 
-#: .././repair/scan.c:615
+#: .././repair/scan.c:651 .././repair/scan.c:1043 .././repair/scan.c:1329
 #, c-format
 msgid "invalid start block %u in record %u of %s btree block %u/%u\n"
 msgstr "błędny blok początkowy %u w rekordzie %u bloku b-drzewa %s %u/%u\n"
 
-#: .././repair/scan.c:621
+#: .././repair/scan.c:657 .././repair/scan.c:1049 .././repair/scan.c:1335
 #, c-format
 msgid "invalid length %u in record %u of %s btree block %u/%u\n"
 msgstr "błędna długość %u w rekordzie %u bloku b-drzewa %s %u/%u\n"
 
-#: .././repair/scan.c:668
+#: .././repair/scan.c:704
 #, c-format
 msgid "block (%d,%d-%d) multiply claimed by %s space tree, state - %d\n"
-msgstr "blok (%d,%d-%d) wielokrotnie przypisany do drzewa miejsca %s, stan - %d\n"
+msgstr ""
+"blok (%d,%d-%d) wielokrotnie przypisany do drzewa miejsca %s, stan - %d\n"
+
+#: .././repair/scan.c:833
+#, c-format
+msgid ""
+"Static meta block (%d,%d-%d) mismatch in %s tree, state - %d,%<PRIx64>\n"
+msgstr ""
+"niezgodność statycznego bloku metadanych (%d,%d-%d) w drzewie %s, stan - %d,"
+"%<PRIx64>\n"
+
+#: .././repair/scan.c:842
+#, c-format
+msgid "AG meta block (%d,%d-%d) mismatch in %s tree, state - %d,%<PRIx64>\n"
+msgstr ""
+"niezgodność bloku metadanych AG (%d,%d-%d) w drzewie %s, stan - %d,"
+"%<PRIx64>\n"
+
+#: .././repair/scan.c:850
+#, c-format
+msgid "inode block (%d,%d-%d) mismatch in %s tree, state - %d,%<PRIx64>\n"
+msgstr ""
+"niezgodność bloku i-węzła (%d,%d-%d) w drzewie %s, stan - %d,%<PRIx64>\n"
 
-#: .././repair/scan.c:775
+#: .././repair/scan.c:858
 #, c-format
-msgid "badly aligned inode rec (starting inode = %<PRIu64>)\n"
-msgstr "błędnie wyrównany rekord i-węzła (początkowy i-węzeł = %<PRIu64>)\n"
+msgid ""
+"AG refcount block (%d,%d-%d) mismatch in %s tree, state - %d,%<PRIx64>\n"
+msgstr ""
+"niezgodność bloku zliczania odwołań AG (%d,%d-%d) w drzewie %s, stan - %d,"
+"%<PRIx64>\n"
 
-#: .././repair/scan.c:791
+#: .././repair/scan.c:867
 #, c-format
-msgid "bad starting inode # (%<PRIu64> (0x%x 0x%x)) in ino rec, skipping rec\n"
-msgstr "błędny numer początkowego i-węzła (%<PRIu64> (0x%x 0x%x)) w rekordzie i-węzła, pominięto rekord\n"
+msgid "in use block (%d,%d-%d) mismatch in %s tree, state - %d,%<PRIx64>\n"
+msgstr ""
+"niezgodność używanego bloku (%d,%d-%d) w drzewie %s, stan - %d,%<PRIx64>\n"
 
-#: .././repair/scan.c:799
+#: .././repair/scan.c:889
 #, c-format
-msgid "bad ending inode # (%<PRIu64> (0x%x 0x%zx)) in ino rec, skipping rec\n"
-msgstr "błędny numer końcowego i-węzła (%<PRIu64> (0x%x 0x%zx)) w rekordzie i-węzła, pominięto rekord\n"
+msgid "unknown block (%d,%d-%d) mismatch on %s tree, state - %d,%<PRIx64>\n"
+msgstr ""
+"niezgodność nieznanego bloku (%d,%d-%d) w drzewie %s, stan - %d,%<PRIx64>\n"
 
-#: .././repair/scan.c:824
+#: .././repair/scan.c:989
 #, c-format
-msgid "inode chunk claims used block, inobt block - agno %d, bno %d, inopb %d\n"
-msgstr "część i-węzła odwołuje się do używanego bloku, blok inobt - agno %d, bno %d, inopb %d\n"
+msgid "%s rmap btree block claimed (state %d), agno %d, bno %d, suspect %d\n"
+msgstr ""
+"blok b-drzewa rmap %s przypisany (stan %d), agno %d, bno %d, podejrzany %d\n"
 
-#: .././repair/scan.c:846
+#: .././repair/scan.c:1033
 #, c-format
-msgid "inode rec for ino %<PRIu64> (%d/%d) overlaps existing rec (start %d/%d)\n"
-msgstr "rekord i-węzła dla i-węzła %<PRIu64> (%d/%d) nachodzi na istniejący rekord (początek %d/%d)\n"
+msgid "invalid flags in record %u of %s btree block %u/%u\n"
+msgstr "błędne flagi w rekordzie %u bloku b-drzewa %s %u/%u\n"
 
-#: .././repair/scan.c:893
+#: .././repair/scan.c:1062
 #, c-format
-msgid "ir_freecount/free mismatch, inode chunk %d/%u, freecount %d nfree %d\n"
-msgstr "niezgodność ir_freecount/free, porcja i-węzłów %d/%u, freecount %d nfree %d\n"
+msgid "invalid owner in rmap btree record %d (%<PRId64> %u) block %u/%u\n"
+msgstr ""
+"błędny właściciel w rekordzie %d b-drzewa rmap (%<PRId64> %u) blok %u/%u\n"
+
+#: .././repair/scan.c:1069
+#, c-format
+msgid ""
+"record %d of block (%u/%u) in %s btree cannot have non-inode owner with "
+"flags\n"
+msgstr ""
+"rekord %d bloku (%u/%u) w b-drzewie %s nie może mieć nie będącego i-węzłem "
+"właściciela z flagami\n"
+
+#: .././repair/scan.c:1073
+#, c-format
+msgid ""
+"record %d of block (%u/%u) in %s btree cannot have non-inode owner with "
+"offset\n"
+msgstr ""
+"rekord %d bloku (%u/%u) w b-drzewie %s nie może mieć nie będącego i-węzłem "
+"właściciela z offsetem\n"
+
+#: .././repair/scan.c:1094
+#, c-format
+msgid ""
+"out-of-order rmap btree record %d (%u %<PRId64> %<PRIx64> %u) block %u/%u\n"
+msgstr ""
+"rekord %d b-drzewa rmap poza kolejnością (%u %<PRId64> %<PRIx64> %u), blok "
+"%u/%u\n"
+
+#: .././repair/scan.c:1103 .././repair/scan.c:1381
+#, c-format
+msgid ""
+"record %d in block (%u/%u) of %s tree should be merged with previous record\n"
+msgstr ""
+"rekord %d w bloku (%u/%u) drzewa %s powinien być połączony z poprzednim "
+"rekordem\n"
+
+#: .././repair/scan.c:1118
+#, c-format
+msgid "record %d greater than high key of block (%u/%u) in %s tree\n"
+msgstr "rekord %d większy niż górny klucz bloku (%u/%u) w drzewie %s\n"
+
+#: .././repair/scan.c:1174
+#, c-format
+msgid "invalid flags in key %u of %s btree block %u/%u\n"
+msgstr "błędne flagi w kluczu %u bloku b-drzewa %s %u/%u\n"
+
+#: .././repair/scan.c:1180
+#, c-format
+msgid "key %d greater than high key of block (%u/%u) in %s tree\n"
+msgstr "klucz %d większy niż górny klucz bloku (%u/%u) w drzewie %s\n"
+
+#: .././repair/scan.c:1206
+#, c-format
+msgid "invalid flags in high key %u of %s btree block %u/%u\n"
+msgstr "błędne flagi w górnym kluczu %u bloku b-drzewa %s %u/%u\n"
+
+#: .././repair/scan.c:1257
+#, c-format
+msgid "bad magic # %#x in %s btree block %d/%d\n"
+msgstr "błędna liczba magiczna %#x w bloku b-drzewa %s %d/%d\n"
+
+#: .././repair/scan.c:1265
+#, c-format
+msgid "expected level %d got %d in %s btree block %d/%d\n"
+msgstr "oczekiwano poziomu %d, a uzyskano %d w bloku b-drzewa %s %d/%d\n"
+
+#: .././repair/scan.c:1279
+#, c-format
+msgid "%s btree block claimed (state %d), agno %d, bno %d, suspect %d\n"
+msgstr "blok b-drzewa %s przypisany (stan %d), agno %d, bno %d, podejrzany %d\n"
+
+#: .././repair/scan.c:1298 .././repair/scan.c:1415
+#, c-format
+msgid "bad btree nrecs (%u, min=%u, max=%u) in %s btree block %u/%u\n"
+msgstr "błędna liczba rekordów b-drzewa (%u, min=%u, max=%u) w bloku b-drzewa %s, blok %u/%u\n"
 
-#: .././repair/scan.c:934
+#: .././repair/scan.c:1316
 #, c-format
-msgid "badly aligned finobt inode rec (starting inode = %<PRIu64>)\n"
-msgstr "błędnie wyrównany rekord i-węzła finobt (początkowy i-węzeł = %<PRIu64>)\n"
+msgid ""
+"leftover CoW extent has incorrect refcount in record %u of %s btree block %u/"
+"%u\n"
+msgstr "pozostały ekstent CoW ma niepoprawną liczbę odwołań w rekordzie %u bloku b-drzewa %s %u/%u\n"
+
+#: .././repair/scan.c:1321
+#, c-format
+msgid ""
+"leftover CoW extent has invalid startblock in record %u of %s btree block %u/"
+"%u\n"
+msgstr "pozostały ekstent CoW ma błędny blok początkowy w rekordzie %u bloku b-drzewa %s %u/%u\n"
+
+#: .././repair/scan.c:1356
+#, c-format
+msgid "extent (%u/%u) len %u claimed, state is %d\n"
+msgstr "ekstent (%u/%u) długość %u przypisany, stan %d\n"
+
+#: .././repair/scan.c:1363
+#, c-format
+msgid "invalid reference count %u in record %u of %s btree block %u/%u\n"
+msgstr "błędna liczba odwołań %u w rekordzie %u bloku b-drzewa %s %u/%u\n"
+
+#: .././repair/scan.c:1370
+#, c-format
+msgid "out-of-order %s btree record %d (%u %u) block %u/%u\n"
+msgstr "rekord b-drzewa %s poza kolejnością: %d (%u %u), blok %u/%u\n"
+
+#: .././repair/scan.c:1496
+#, c-format
+msgid "badly aligned %s rec (starting inode = %<PRIu64>)\n"
+msgstr "błędnie wyrównany rekord %s (początkowy i-węzeł = %<PRIu64>)\n"
+
+#: .././repair/scan.c:1510
+#, c-format
+msgid "bad starting inode # (%<PRIu64> (0x%x 0x%x)) in %s rec, skipping rec\n"
+msgstr ""
+"błędny numer początkowego i-węzła (%<PRIu64> (0x%x 0x%x)) w rekordzie %s, "
+"pominięto rekord\n"
+
+#: .././repair/scan.c:1519
+#, c-format
+msgid "bad ending inode # (%<PRIu64> (0x%x 0x%zx)) in %s rec, skipping rec\n"
+msgstr ""
+"błędny numer końcowego i-węzła (%<PRIu64> (0x%x 0x%zx)) w rekordzie %s, "
+"pominięto rekord\n"
+
+#: .././repair/scan.c:1584
+#, c-format
+msgid ""
+"ir_holemask/ir_free mismatch, %s chunk %d/%u, holemask 0x%x free 0x%llx\n"
+msgstr ""
+"niezgodność ir_holemask/ir_free, porcja %s %d/%u, holemask 0x%x free 0x%llx\n"
+
+#: .././repair/scan.c:1671
+#, c-format
+msgid ""
+"inode chunk claims used block, inobt block - agno %d, bno %d, inopb %d\n"
+msgstr ""
+"część i-węzła odwołuje się do używanego bloku, blok inobt - agno %d, bno %d, "
+"inopb %d\n"
+
+#: .././repair/scan.c:1689
+#, c-format
+msgid ""
+"inode rec for ino %<PRIu64> (%d/%d) overlaps existing rec (start %d/%d)\n"
+msgstr ""
+"rekord i-węzła dla i-węzła %<PRIu64> (%d/%d) nachodzi na istniejący rekord "
+"(początek %d/%d)\n"
+
+#: .././repair/scan.c:1713
+#, c-format
+msgid "ir_freecount/free mismatch, inode chunk %d/%u, freecount %d nfree %d\n"
+msgstr ""
+"niezgodność ir_freecount/free, porcja i-węzłów %d/%u, freecount %d nfree %d\n"
 
-#: .././repair/scan.c:948
+#: .././repair/scan.c:1721 .././repair/scan.c:1911
 #, c-format
-msgid "bad starting inode # (%<PRIu64> (0x%x 0x%x)) in finobt rec, skipping rec\n"
-msgstr "błędny numer początkowego i-węzła (%<PRIu64> (0x%x 0x%x)) w rekordzie finobt, pominięto rekord\n"
+msgid "invalid inode count, inode chunk %d/%u, count %d ninodes %d\n"
+msgstr "błędna liczba i-węzłów, porcja i-węzłów %d/%u, licznik %d ninodes %d\n"
 
-#: .././repair/scan.c:956
+#: .././repair/scan.c:1775
 #, c-format
-msgid "bad ending inode # (%<PRIu64> (0x%x 0x%zx)) in finobt rec, skipping rec\n"
-msgstr "błędny numer końcowego i-węzła (%<PRIu64> (0x%x 0x%zx)) w rekordzie finobt, pominięto rekord\n"
+msgid ""
+"sparse inode chunk claims inode block, finobt block - agno %d, bno %d, inopb "
+"%d\n"
+msgstr ""
+"część rzadkiego i-węzła odwołuje się do bloku i-węzła, blok finobt - agno "
+"%d, bno %d, inopb %d\n"
 
-#: .././repair/scan.c:981
+#: .././repair/scan.c:1790 .././repair/scan.c:1802
 #, c-format
-msgid "inode chunk claims untracked block, finobt block - agno %d, bno %d, inopb %d\n"
-msgstr "część i-węzła odwołuje się do nieśledzonego bloku, blok finobt - agno %d, bno %d, inopb %d\n"
+msgid ""
+"inode chunk claims untracked block, finobt block - agno %d, bno %d, inopb "
+"%d\n"
+msgstr ""
+"część i-węzła odwołuje się do nieśledzonego bloku, blok finobt - agno %d, "
+"bno %d, inopb %d\n"
 
-#: .././repair/scan.c:988
+#: .././repair/scan.c:1812
 #, c-format
-msgid "inode chunk claims used block, finobt block - agno %d, bno %d, inopb %d\n"
-msgstr "część i-węzła odwołuje się do używanego bloku, blok finobt - agno %d, bno %d, inopb %d\n"
+msgid ""
+"inode chunk claims used block, finobt block - agno %d, bno %d, inopb %d\n"
+msgstr ""
+"część i-węzła odwołuje się do używanego bloku, blok finobt - agno %d, bno "
+"%d, inopb %d\n"
 
-#: .././repair/scan.c:1010
+#: .././repair/scan.c:1834
 #, c-format
-msgid "finobt rec for ino %<PRIu64> (%d/%u) does not match existing rec (%d/%d)\n"
-msgstr "rekord finobt dla i-węzła %<PRIu64> (%d/%u) nie pasuje do istniejącego rekordu (%d/%d)\n"
+msgid ""
+"finobt rec for ino %<PRIu64> (%d/%u) does not match existing rec (%d/%d)\n"
+msgstr ""
+"rekord finobt dla i-węzła %<PRIu64> (%d/%u) nie pasuje do istniejącego "
+"rekordu (%d/%d)\n"
 
-#: .././repair/scan.c:1038
+#: .././repair/scan.c:1876
 #, c-format
 msgid "undiscovered finobt record, ino %<PRIu64> (%d/%u)\n"
 msgstr "nie rozpoznany rekord finobt, i-węzeł %<PRIu64> (%d/%u)\n"
 
-#: .././repair/scan.c:1092
+#: .././repair/scan.c:1898
 #, c-format
-msgid "finobt ir_freecount/free mismatch, inode chunk %d/%u, freecount %d nfree %d\n"
-msgstr "niezgodność finobt ir_freecount/free, porcja i-węzłów %d/%u, freecount %d nfree %d\n"
+msgid ""
+"finobt ir_freecount/free mismatch, inode chunk %d/%u, freecount %d nfree %d\n"
+msgstr ""
+"niezgodność finobt ir_freecount/free, porcja i-węzłów %d/%u, freecount %d "
+"nfree %d\n"
 
-#: .././repair/scan.c:1098
+#: .././repair/scan.c:1904
 #, c-format
 msgid "finobt record with no free inodes, inode chunk %d/%u\n"
 msgstr "rekord finobt bez wolnych i-węzłów, porcja i-węzłów %d/%u\n"
 
-#: .././repair/scan.c:1142
+#: .././repair/scan.c:1957
 #, c-format
 msgid "bad magic # %#x in inobt block %d/%d\n"
 msgstr "błędna liczba magiczna %#x w bloku inobt %d/%d\n"
 
-#: .././repair/scan.c:1150
+#: .././repair/scan.c:1965
 #, c-format
 msgid "expected level %d got %d in inobt block %d/%d\n"
 msgstr "oczekiwano poziomu %d, a uzyskano %d w bloku inobt %d/%d\n"
 
-#: .././repair/scan.c:1172
+#: .././repair/scan.c:1988
 #, c-format
 msgid "inode btree block claimed (state %d), agno %d, bno %d, suspect %d\n"
-msgstr "blok b-drzewa i-węzłów przypisany (stan %d), agno %d, bno %d, podejrzany %d\n"
+msgstr ""
+"blok b-drzewa i-węzłów przypisany (stan %d), agno %d, bno %d, podejrzany %d\n"
 
-#: .././repair/scan.c:1195
+#: .././repair/scan.c:2011
 #, c-format
 msgid "dubious inode btree block header %d/%d\n"
 msgstr "wątpliwy nagłówek bloku b-drzewa i-węzłów %d/%d\n"
 
-#: .././repair/scan.c:1306
+#: .././repair/scan.c:2129
 #, c-format
 msgid "can't read agfl block for ag %d\n"
 msgstr "nie można odczytać bloku agfl dla ag %d\n"
 
-#: .././repair/scan.c:1310
+#: .././repair/scan.c:2133
 #, c-format
 msgid "agfl has bad CRC for ag %d\n"
 msgstr "agfl ma błędną sumę kontrolną dla ag %d\n"
 
-#: .././repair/scan.c:1331
+#: .././repair/scan.c:2154
 #, c-format
 msgid "bad agbno %u in agfl, agno %d\n"
 msgstr "błędne agbno %u w agfl, agno %d\n"
 
-#: .././repair/scan.c:1340
+#: .././repair/scan.c:2163
 #, c-format
 msgid "freeblk count %d != flcount %d in ag %d\n"
 msgstr "liczba freeblk %d != flcount %d w ag %d\n"
 
-#: .././repair/scan.c:1366
+#: .././repair/scan.c:2189
 #, c-format
 msgid "bad agbno %u for btbno root, agno %d\n"
-msgstr "błędne agbno %u dla głównego btbno, agno %d\n"
+msgstr "błędne agbno %u dla korzenia btbno, agno %d\n"
 
-#: .././repair/scan.c:1378
+#: .././repair/scan.c:2201
 #, c-format
 msgid "bad agbno %u for btbcnt root, agno %d\n"
-msgstr "błędne agbno %u dla głównego btbcnt, agno %d\n"
+msgstr "błędne agbno %u dla korzenia btbcnt, agno %d\n"
+
+#: .././repair/scan.c:2220
+#, c-format
+msgid "bad rmapbt block count %u, saw %u\n"
+msgstr "błędna liczba bloków rmapbt %u, widziano %u\n"
+
+#: .././repair/scan.c:2224
+#, c-format
+msgid "bad agbno %u for rmapbt root, agno %d\n"
+msgstr "błędne agbno %u dla korzenia rmapbt, agno %d\n"
+
+#: .././repair/scan.c:2241
+#, c-format
+msgid "bad refcountbt block count %u, saw %u\n"
+msgstr "błędna liczba bloków refcountbt %u, widziano %u\n"
+
+#: .././repair/scan.c:2245
+#, c-format
+msgid "bad agbno %u for refcntbt root, agno %d\n"
+msgstr "błędne agbno %u dla korzenia refcntbt, agno %d\n"
 
-#: .././repair/scan.c:1394
+#: .././repair/scan.c:2263
 #, c-format
 msgid "agf_btreeblks %u, counted %<PRIu64> in ag %u\n"
 msgstr "agf_btreeblks %u, naliczono %<PRIu64> w ag %u\n"
 
-#: .././repair/scan.c:1417
+#: .././repair/scan.c:2287
 #, c-format
 msgid "bad agbno %u for inobt root, agno %d\n"
 msgstr "błędne agbno %u dla głównego inobt, agno %d\n"
 
-#: .././repair/scan.c:1430
+#: .././repair/scan.c:2300
 #, c-format
 msgid "bad agbno %u for finobt root, agno %d\n"
 msgstr "błędne agbno %u dla głównego finobt, agno %d\n"
 
-#: .././repair/scan.c:1447
+#: .././repair/scan.c:2317
 #, c-format
 msgid "agi_freecount %u, counted %u in ag %u finobt\n"
 msgstr "agi_freecount %u, naliczono %u w ag %u finobt\n"
 
-#: .././repair/scan.c:1457
+#: .././repair/scan.c:2327
 #, c-format
 msgid "agi unlinked bucket %d is %u in ag %u (inode=%<PRIu64>)\n"
 msgstr "niedowiązany kubełek agi %d to %u w ag %u (i-węzeł=%<PRIu64>)\n"
 
-#: .././repair/scan.c:1488
+#: .././repair/scan.c:2358
 msgid "can't allocate memory for superblock\n"
 msgstr "nie można przydzielić pamięci dla superbloku\n"
 
-#: .././repair/scan.c:1495
+#: .././repair/scan.c:2365
 msgid "root superblock"
 msgstr "główny superblok"
 
-#: .././repair/scan.c:1505
+#: .././repair/scan.c:2374
 msgid "agf block"
 msgstr "blok agf"
 
-#: .././repair/scan.c:1514
+#: .././repair/scan.c:2383
 msgid "agi block"
 msgstr "blok agi"
 
-#: .././repair/scan.c:1535
+#: .././repair/scan.c:2404
 #, c-format
 msgid "reset bad sb for ag %d\n"
 msgstr "przestawiono błędny superblok dla ag %d\n"
 
-#: .././repair/scan.c:1538
+#: .././repair/scan.c:2407
 #, c-format
 msgid "would reset bad sb for ag %d\n"
 msgstr "błędny superblok dla ag %d zostałby przestawiony\n"
 
-#: .././repair/scan.c:1543
+#: .././repair/scan.c:2412
 #, c-format
 msgid "reset bad agf for ag %d\n"
 msgstr "przestawiono błędne agf dla ag %d\n"
 
-#: .././repair/scan.c:1546
+#: .././repair/scan.c:2415
 #, c-format
 msgid "would reset bad agf for ag %d\n"
 msgstr "błędne agf dla ag %d zostałoby przestawione\n"
 
-#: .././repair/scan.c:1551
+#: .././repair/scan.c:2420
 #, c-format
 msgid "reset bad agi for ag %d\n"
 msgstr "przestawiono błędne agi dla ag %d\n"
 
-#: .././repair/scan.c:1554
+#: .././repair/scan.c:2423
 #, c-format
 msgid "would reset bad agi for ag %d\n"
 msgstr "błędna agi dla ag %d zostałoby przestawione\n"
 
-#: .././repair/scan.c:1559
+#: .././repair/scan.c:2428
 #, c-format
 msgid "bad uncorrected agheader %d, skipping ag...\n"
 msgstr "błędny nie poprawiony agheader %d, pominięto ag...\n"
 
-#: .././repair/scan.c:1623
+#: .././repair/scan.c:2491
 #, c-format
 msgid "can't get %s for ag %d\n"
 msgstr "nie można uzyskać %s dla ag %d\n"
 
-#: .././repair/scan.c:1642
+#: .././repair/scan.c:2511
 msgid "no memory for ag header counts\n"
 msgstr "brak pamięci na liczniki nagłówków ag\n"
 
-#: .././repair/scan.c:1667
+#: .././repair/scan.c:2537
 #, c-format
 msgid "sb_icount %<PRIu64>, counted %<PRIu64>\n"
 msgstr "sb_icount %<PRIu64>, naliczono %<PRIu64>\n"
 
-#: .././repair/scan.c:1672
+#: .././repair/scan.c:2542
 #, c-format
 msgid "sb_ifree %<PRIu64>, counted %<PRIu64>\n"
 msgstr "sb_ifree %<PRIu64>, naliczono %<PRIu64>\n"
 
-#: .././repair/scan.c:1677
+#: .././repair/scan.c:2547
 #, c-format
 msgid "sb_fdblocks %<PRIu64>, counted %<PRIu64>\n"
 msgstr "sb_fdblocks %<PRIu64>, naliczono %<PRIu64>\n"
 
+#: .././repair/scan.c:2553
+#, c-format
+msgid "used blocks %<PRIu64>, counted %<PRIu64>\n"
+msgstr "użytych bloków %<PRIu64>, naliczono %<PRIu64>\n"
+
 #: .././repair/threads.c:90
 #, c-format
 msgid "cannot create worker threads, error = [%d] %s\n"
@@ -12444,28 +14447,29 @@ msgstr "nie można utworzyć wątków pr
 msgid "cannot allocate worker item, error = [%d] %s\n"
 msgstr "nie można przydzielić elementu pracującego, błąd: [%d] %s\n"
 
-#: .././repair/versions.c:70
+#: .././repair/versions.c:68
 #, c-format
 msgid "bogus quota flags 0x%x set in superblock"
 msgstr "niepoprawne flagi limitów 0x%x ustawione w superbloku"
 
-#: .././repair/versions.c:76
+#: .././repair/versions.c:74
 msgid ", bogus flags will be cleared\n"
 msgstr ", błędne flagi zostaną wyczyszczone\n"
 
-#: .././repair/versions.c:78
+#: .././repair/versions.c:76
 msgid ", bogus flags would be cleared\n"
 msgstr ", błędne flagi zostałyby wyczyszczone\n"
 
-#: .././repair/versions.c:132
+#: .././repair/versions.c:115 .././repair/versions.c:120
+#: .././repair/versions.c:125
+msgid "Shared Version bit set. Not supported. Ever.\n"
+msgstr "Ustawiony bit wersji współdzielonej. Nie jest obsługiwany. Nigdy.\n"
+
+#: .././repair/versions.c:138
 msgid "This filesystem has uninitialized extent flags.\n"
 msgstr "Ten system plików ma niezainicjowane flagi ekstentów.\n"
 
-#: .././repair/versions.c:140
-msgid "This filesystem is marked shared.\n"
-msgstr "Ten system plików jest oznaczony jako współdzielony.\n"
-
-#: .././repair/versions.c:146
+#: .././repair/versions.c:144
 msgid ""
 "This filesystem uses feature(s) not yet supported in this release.\n"
 "Please run a more recent version of xfs_repair.\n"
@@ -12473,16 +14477,16 @@ msgstr ""
 "Ten system plików używa możliwości jeszcze nie obsługiwanych w tym wydaniu.\n"
 "Proszę uruchomić nowszą wersję xfs_repair.\n"
 
-#: .././repair/versions.c:152
+#: .././repair/versions.c:150
 #, c-format
 msgid "WARNING:  unknown superblock version %d\n"
 msgstr "UWAGA: nieznana wersja superbloku %d\n"
 
-#: .././repair/versions.c:155
+#: .././repair/versions.c:153
 msgid "This filesystem contains features not understood by this program.\n"
 msgstr "Ten system plików zawiera cechę nie rozumianą przez ten program.\n"
 
-#: .././repair/versions.c:163
+#: .././repair/versions.c:161
 msgid ""
 "WARNING:  you have disallowed superblock-feature-bits-allowed\n"
 "\tbut this superblock has feature bits.  The superblock\n"
@@ -12492,7 +14496,7 @@ msgstr ""
 "\tsuperblok ma ustawione bity cech. Superblok zostanie zdegradowany.\n"
 "\tMoże to spowodować utratę metadanych systemu plików.\n"
 
-#: .././repair/versions.c:168
+#: .././repair/versions.c:166
 msgid ""
 "WARNING:  you have disallowed superblock-feature-bits-allowed\n"
 "\tbut this superblock has feature bits.  The superblock\n"
@@ -12504,6 +14508,15 @@ msgstr ""
 "\tMogłoby to spowodować utratę metadanych systemu plików.\n"
 
 #: .././repair/versions.c:182
+#, c-format
+msgid ""
+"Superblock has unknown compat/rocompat/incompat features (0x%x/0x%x/0x%x).\n"
+"Using a more recent xfs_repair is recommended.\n"
+msgstr ""
+"Superblok zawiera nieznane cechy compat/rocompat/incompat (0x%x/0x%x/0x%x).\n"
+"Zalecane jest użycie nowszej wersji xfs_repair.\n"
+
+#: .././repair/versions.c:194
 msgid ""
 "WARNING:  you have disallowed attributes but this filesystem\n"
 "\thas attributes.  The filesystem will be downgraded and\n"
@@ -12513,7 +14526,7 @@ msgstr ""
 "\tatrybuty. System plików zostanie zdegradowany, a wszystkie\n"
 "\tatrybuty usunięte.\n"
 
-#: .././repair/versions.c:187
+#: .././repair/versions.c:199
 msgid ""
 "WARNING:  you have disallowed attributes but this filesystem\n"
 "\thas attributes.  The filesystem would be downgraded and\n"
@@ -12523,7 +14536,7 @@ msgstr ""
 "\tatrybuty. System plików zostałby zdegradowany, a wszystkie\n"
 "\tatrybuty usunięte.\n"
 
-#: .././repair/versions.c:200
+#: .././repair/versions.c:212
 msgid ""
 "WARNING:  you have disallowed attr2 attributes but this filesystem\n"
 "\thas attributes.  The filesystem will be downgraded and\n"
@@ -12533,7 +14546,7 @@ msgstr ""
 "\tzawiera atrybuty. System plików zostanie zdegradowany, a wszystkie\n"
 "\tatrybuty attr2 usunięte.\n"
 
-#: .././repair/versions.c:205
+#: .././repair/versions.c:217
 msgid ""
 "WARNING:  you have disallowed attr2 attributes but this filesystem\n"
 "\thas attributes.  The filesystem would be downgraded and\n"
@@ -12543,33 +14556,27 @@ msgstr ""
 "\tzawiera atrybuty. System plików zostałby zdegradowany, a wszystkie\n"
 "\tatrybuty attr2 usunięte.\n"
 
-#: .././repair/versions.c:218
+#: .././repair/versions.c:229
+msgid ""
+"WARNING: you have a V1 inode filesystem. It will be converted to a\n"
+"\tversion 2 inode filesystem. If you do not want this, run an older\n"
+"\tversion of xfs_repair.\n"
+msgstr ""
+"UWAGA: to jest system plików z i-węzłami V1. Zostanie przekonwertowany\n"
+"\tdo systemu plików z i-węzłami V2. Jeżeli nie jest to pożądane, należy\n"
+"\tużyć starszej wersji xfs_repair.\n"
+
+#: .././repair/versions.c:234
 msgid ""
-"WARNING:  you have disallowed version 2 inodes but this filesystem\n"
-"\thas version 2 inodes.  The filesystem will be downgraded and\n"
-"\tall version 2 inodes will be converted to version 1 inodes.\n"
-"\tThis may cause some hard links to files to be destroyed\n"
-msgstr ""
-"UWAGA: zabroniono używania i-węzłów w wersji 2, ale ten system plików\n"
-"\tzawiera i-węzły w wersji 2. System plików zostanie zdegradowany,\n"
-"\ta wszystkie i-węzły w wersji 2 zostaną przekonwertowane do wersji 1.\n"
-"\tMoże to spowodować zniszczenie niektórych twardych dowiązań do\n"
-"\tplików.\n"
-
-#: .././repair/versions.c:224
-msgid ""
-"WARNING:  you have disallowed version 2 inodes but this filesystem\n"
-"\thas version 2 inodes.  The filesystem would be downgraded and\n"
-"\tall version 2 inodes would be converted to version 1 inodes.\n"
-"\tThis might cause some hard links to files to be destroyed\n"
-msgstr ""
-"UWAGA: zabroniono używania i-węzłów w wersji 2, ale ten system plików\n"
-"\tzawiera i-węzły w wersji 2. System plików zostałby zdegradowany,\n"
-"\ta wszystkie i-węzły w wersji 2 zostałyby przekonwertowane do\n"
-"\twersji 1. Mogłoby to spowodować zniszczenie niektórych twardych\n"
-"\tdowiązań do plików.\n"
+"WARNING: you have a V1 inode filesystem. It would be converted to a\n"
+"\tversion 2 inode filesystem. If you do not want this, run an older\n"
+"\tversion of xfs_repair.\n"
+msgstr ""
+"UWAGA: to jest system plików z i-węzłami V1. Zostałby przekonwertowany\n"
+"\tdo systemu plików z i-węzłami V2. Jeżeli nie jest to pożądane, należy\n"
+"\tużyć starszej wersji xfs_repair.\n"
 
-#: .././repair/versions.c:238
+#: .././repair/versions.c:244
 msgid ""
 "WARNING:  you have disallowed quotas but this filesystem\n"
 "\thas quotas.  The filesystem will be downgraded and\n"
@@ -12579,7 +14586,7 @@ msgstr ""
 "\tzawiera limity. System plików zostanie zdegradowany, a wszystkie\n"
 "\tinformacje o limitach usunięte.\n"
 
-#: .././repair/versions.c:243
+#: .././repair/versions.c:249
 msgid ""
 "WARNING:  you have disallowed quotas but this filesystem\n"
 "\thas quotas.  The filesystem would be downgraded and\n"
@@ -12589,7 +14596,7 @@ msgstr ""
 "\tzawiera limity. System plików zostałby zdegradowany, a wszystkie\n"
 "\tinformacje o limitach usunięte.\n"
 
-#: .././repair/versions.c:271
+#: .././repair/versions.c:277
 msgid ""
 "WARNING:  you have disallowed aligned inodes but this filesystem\n"
 "\thas aligned inodes.  The filesystem will be downgraded.\n"
@@ -12599,7 +14606,7 @@ msgstr ""
 "\tzawiera wyrównane i-węzły. System plików zostanie zdegradowany.\n"
 "\tTrwale zdegraduje to wydajność tego systemu plików.\n"
 
-#: .././repair/versions.c:276
+#: .././repair/versions.c:282
 msgid ""
 "WARNING:  you have disallowed aligned inodes but this filesystem\n"
 "\thas aligned inodes.  The filesystem would be downgraded.\n"
@@ -12609,7 +14616,7 @@ msgstr ""
 "\tzawiera wyrównane i-węzły. System plików zostałby zdegradowany.\n"
 "\tTrwale zdegradowałoby to wydajność tego systemu plików.\n"
 
-#: .././repair/xfs_repair.c:81
+#: .././repair/xfs_repair.c:85
 #, c-format
 msgid ""
 "Usage: %s [options] device\n"
@@ -12633,7 +14640,8 @@ msgstr ""
 "\n"
 "Opcje:\n"
 "  -f           Urządzenie jest plikiem\n"
-"  -L           Wymuszenie wyzerowania logu. Wykonywać tylko w ostateczności.\n"
+"  -L           Wymuszenie wyzerowania logu. Wykonywać tylko w "
+"ostateczności.\n"
 "  -l urz_logu  Określenie urządzenia z zewnętrznym logiem.\n"
 "  -m maks_pam  Maksymalna ilość pamięci do użycia w megabajtach.\n"
 "  -n           Tryb bez modyfikacji, tylko sprawdzenie systemu plików.\n"
@@ -12646,113 +14654,119 @@ msgstr ""
 "  -d           Naprawianie w sposób niebezpieczny.\n"
 "  -V           Wypisanie informacji o wersji i zakończenie.\n"
 
-#: .././repair/xfs_repair.c:107
+#: .././repair/xfs_repair.c:111
 msgid "no error"
 msgstr "brak błędu"
 
-#: .././repair/xfs_repair.c:108
+#: .././repair/xfs_repair.c:112
 msgid "bad magic number"
 msgstr "błędna liczba magiczna"
 
-#: .././repair/xfs_repair.c:109
+#: .././repair/xfs_repair.c:113
 msgid "bad blocksize field"
 msgstr "błędne pole blocksize"
 
-#: .././repair/xfs_repair.c:110
+#: .././repair/xfs_repair.c:114
 msgid "bad blocksize log field"
 msgstr "błędne pole logu blocksize"
 
-#: .././repair/xfs_repair.c:111
+#: .././repair/xfs_repair.c:115
 msgid "bad or unsupported version"
 msgstr "błędna lub nie obsługiwana wersja"
 
-#: .././repair/xfs_repair.c:113
+#: .././repair/xfs_repair.c:117
 msgid "filesystem mkfs-in-progress bit set"
 msgstr "ustawiony bit mkfs-in-progress systemu plików"
 
-#: .././repair/xfs_repair.c:115
+#: .././repair/xfs_repair.c:119
 msgid "inconsistent filesystem geometry information"
 msgstr "niespójne informacje o geometrii systemu plików"
 
-#: .././repair/xfs_repair.c:117
+#: .././repair/xfs_repair.c:121
 msgid "bad inode size or inconsistent with number of inodes/block"
 msgstr "błędny rozmiar i-węzła lub niespójność z liczbą i-węzłów/blok"
 
-#: .././repair/xfs_repair.c:118
+#: .././repair/xfs_repair.c:122
 msgid "bad sector size"
 msgstr "błędny rozmiar sektora"
 
-#: .././repair/xfs_repair.c:120
+#: .././repair/xfs_repair.c:124
 msgid "AGF geometry info conflicts with filesystem geometry"
 msgstr "informacje o geometrii AGF są w konflikcie z geometrią systemu plików"
 
-#: .././repair/xfs_repair.c:122
+#: .././repair/xfs_repair.c:126
 msgid "AGI geometry info conflicts with filesystem geometry"
 msgstr "informacje o geometrii AGI są w konflikcie z geometrią systemu plików"
 
-#: .././repair/xfs_repair.c:124
+#: .././repair/xfs_repair.c:128
 msgid "AG superblock geometry info conflicts with filesystem geometry"
-msgstr "informacje o geometrii superbloku AG są w konflikcie z geometrią systemu plików"
+msgstr ""
+"informacje o geometrii superbloku AG są w konflikcie z geometrią systemu "
+"plików"
 
-#: .././repair/xfs_repair.c:125
+#: .././repair/xfs_repair.c:129
 msgid "attempted to perform I/O beyond EOF"
 msgstr "próbowano wykonać operację we/wy poza końcem pliku"
 
-#: .././repair/xfs_repair.c:127
+#: .././repair/xfs_repair.c:131
 msgid "inconsistent filesystem geometry in realtime filesystem component"
 msgstr "niespójna geometria systemu plików w składniku realtime"
 
-#: .././repair/xfs_repair.c:129
+#: .././repair/xfs_repair.c:133
 msgid "maximum indicated percentage of inodes > 100%"
 msgstr "określono maksymalny procent i-węzłów > 100%"
 
-#: .././repair/xfs_repair.c:131
+#: .././repair/xfs_repair.c:135
 msgid "inconsistent inode alignment value"
 msgstr "niespójna wartość wyrównania i-węzła"
 
-#: .././repair/xfs_repair.c:133
+#: .././repair/xfs_repair.c:137
 msgid "not enough secondary superblocks with matching geometry"
 msgstr "za mało zapasowych superbloków o pasującej geometrii"
 
-#: .././repair/xfs_repair.c:135
+#: .././repair/xfs_repair.c:139
 msgid "bad stripe unit in superblock"
 msgstr "błędna jednostka pasa w superbloku"
 
-#: .././repair/xfs_repair.c:137
+#: .././repair/xfs_repair.c:141
 msgid "bad stripe width in superblock"
 msgstr "błędna szerokość pasa w superbloku"
 
-#: .././repair/xfs_repair.c:139
+#: .././repair/xfs_repair.c:143
 msgid "bad shared version number in superblock"
 msgstr "błędny numer wersji współdzielenia w superbloku"
 
-#: .././repair/xfs_repair.c:141
+#: .././repair/xfs_repair.c:145
 msgid "bad CRC in superblock"
 msgstr "błędna suma kontrolna w superbloku"
 
-#: .././repair/xfs_repair.c:146
+#: .././repair/xfs_repair.c:147
+msgid "inconsistent directory geometry information"
+msgstr "niespójne informacje o geometrii katalogu"
+
+#: .././repair/xfs_repair.c:152
 #, c-format
 msgid "bad error code - %d\n"
 msgstr "błędny kod błędu - %d\n"
 
-#: .././repair/xfs_repair.c:154
+#: .././repair/xfs_repair.c:160
 #, c-format
 msgid "-%c %s option cannot have a value\n"
 msgstr "opcja -%c %s nie przyjmuje wartości\n"
 
-#: .././repair/xfs_repair.c:245
+#: .././repair/xfs_repair.c:250
 msgid "-o ihash option has been removed and will be ignored\n"
 msgstr "opcja -o ihash została usunięta i zostanie zignorowana\n"
 
-#: .././repair/xfs_repair.c:250
+#: .././repair/xfs_repair.c:255
 msgid "-o bhash option cannot be used with -m option\n"
 msgstr "opcja -o bhash nie może być użyta wraz z opcją -m\n"
 
-#: .././repair/xfs_repair.c:302
+#: .././repair/xfs_repair.c:307
 msgid "-m option cannot be used with -o bhash option\n"
 msgstr "opcja -m nie może być użyta wraz z opcją -o bhash\n"
 
-#: .././repair/xfs_repair.c:344
+#: .././repair/xfs_repair.c:349
 #, c-format
 msgid ""
 "\n"
@@ -12761,52 +14775,77 @@ msgstr ""
 "\n"
 "błąd krytyczny - "
 
-#: .././repair/xfs_repair.c:460
+#: .././repair/xfs_repair.c:476
 #, c-format
 msgid "sb root inode value %<PRIu64> %sinconsistent with calculated value %u\n"
-msgstr "wartość i-węzła głównego superbloku %<PRIu64> %sniespójna z obliczoną wartością %u\n"
+msgstr ""
+"wartość i-węzła głównego superbloku %<PRIu64> %sniespójna z obliczoną "
+"wartością %u\n"
 
-#: .././repair/xfs_repair.c:467
+#: .././repair/xfs_repair.c:483
 #, c-format
 msgid "resetting superblock root inode pointer to %u\n"
 msgstr "przestawiono wskaźnik i-węzła głównego superbloku na %u\n"
 
-#: .././repair/xfs_repair.c:471
+#: .././repair/xfs_repair.c:487
 #, c-format
 msgid "would reset superblock root inode pointer to %u\n"
 msgstr "wskaźnik i-węzła głównego superbloku zostałby przestawiony na %u\n"
 
-#: .././repair/xfs_repair.c:483
+#: .././repair/xfs_repair.c:499
 #, c-format
-msgid "sb realtime bitmap inode %<PRIu64> %sinconsistent with calculated value %u\n"
-msgstr "i-węzeł bitmapy realtime superbloku %<PRIu64> %sniespójny z obliczoną wartością %u\n"
+msgid ""
+"sb realtime bitmap inode %<PRIu64> %sinconsistent with calculated value %u\n"
+msgstr ""
+"i-węzeł bitmapy realtime superbloku %<PRIu64> %sniespójny z obliczoną "
+"wartością %u\n"
 
-#: .././repair/xfs_repair.c:490
+#: .././repair/xfs_repair.c:506
 #, c-format
 msgid "resetting superblock realtime bitmap ino pointer to %u\n"
 msgstr "przestawiono wskaźnik i-węzła bitmapy realtime superbloku na %u\n"
 
-#: .././repair/xfs_repair.c:494
+#: .././repair/xfs_repair.c:510
 #, c-format
 msgid "would reset superblock realtime bitmap ino pointer to %u\n"
-msgstr "wskaźnik i-węzła bitmapy realtime superbloku zostałby przestawiony na %u\n"
+msgstr ""
+"wskaźnik i-węzła bitmapy realtime superbloku zostałby przestawiony na %u\n"
 
-#: .././repair/xfs_repair.c:506
+#: .././repair/xfs_repair.c:522
 #, c-format
-msgid "sb realtime summary inode %<PRIu64> %sinconsistent with calculated value %u\n"
-msgstr "i-węzeł opisu realtime superbloku %<PRIu64> %sniespójny z obliczoną wartością %u\n"
+msgid ""
+"sb realtime summary inode %<PRIu64> %sinconsistent with calculated value %u\n"
+msgstr ""
+"i-węzeł opisu realtime superbloku %<PRIu64> %sniespójny z obliczoną "
+"wartością %u\n"
 
-#: .././repair/xfs_repair.c:513
+#: .././repair/xfs_repair.c:529
 #, c-format
 msgid "resetting superblock realtime summary ino pointer to %u\n"
 msgstr "przestawiono wskaźnik i-węzła opisu realtime superbloku na %u\n"
 
-#: .././repair/xfs_repair.c:517
+#: .././repair/xfs_repair.c:533
 #, c-format
 msgid "would reset superblock realtime summary ino pointer to %u\n"
-msgstr "wskaźnik i-węzła opisu realtime superbloku zostałby przestawiony na %u\n"
+msgstr ""
+"wskaźnik i-węzła opisu realtime superbloku zostałby przestawiony na %u\n"
+
+#: .././repair/xfs_repair.c:589
+#, c-format
+msgid "Maximum metadata LSN (%d:%d) is ahead of log (%d:%d).\n"
+msgstr "Maksymalny LSN metadanych (%d:%d) jest poza logiem (%d:%d).\n"
+
+#: .././repair/xfs_repair.c:593
+#, c-format
+msgid "Would format log to cycle %d.\n"
+msgstr "Log zostałby sformatowany na cykl %d.\n"
 
-#: .././repair/xfs_repair.c:563
+#: .././repair/xfs_repair.c:597
+#, c-format
+msgid "Format log to cycle %d.\n"
+msgstr "Log zostanie sformatowany na cykl %d.\n"
+
+#: .././repair/xfs_repair.c:665
 msgid ""
 "Primary superblock would have been modified.\n"
 "Cannot proceed further in no_modify mode.\n"
@@ -12816,7 +14855,7 @@ msgstr ""
 "Nie można kontynuować w trybie bez modyfikacji.\n"
 "Zakończono.\n"
 
-#: .././repair/xfs_repair.c:571
+#: .././repair/xfs_repair.c:673
 msgid ""
 "Primary superblock bad after phase 1!\n"
 "Exiting now.\n"
@@ -12824,7 +14863,12 @@ msgstr ""
 "Nieprawidłowy główny superblok po fazie 1!\n"
 "Koniec działania.\n"
 
-#: .././repair/xfs_repair.c:587
+#: .././repair/xfs_repair.c:684
+#, c-format
+msgid "%s: couldn't stat \"%s\"\n"
+msgstr "%s: nie udało się wykonać stat na \"%s\"\n"
+
+#: .././repair/xfs_repair.c:701
 msgid ""
 "Cannot get host filesystem geometry.\n"
 "Repair may fail if there is a sector size mismatch between\n"
@@ -12834,30 +14878,35 @@ msgstr ""
 "Naprawienie może się nie powieść, jeśli istnieje niespójność rozmiaru\n"
 "sektora między obrazem a systemem plików hosta.\n"
 
-#: .././repair/xfs_repair.c:599
+#: .././repair/xfs_repair.c:713
 msgid ""
 "Sector size on host filesystem larger than image sector size.\n"
 "Cannot turn off direct IO, so exiting.\n"
 msgstr ""
-"Rozmiar sektora na systemie plików hosta większy niż rozmiar sektora obrazu.\n"
+"Rozmiar sektora na systemie plików hosta większy niż rozmiar sektora "
+"obrazu.\n"
 "Nie można wyłączyć bezpośredniego we/wy - zakończono działanie.\n"
 
-#: .././repair/xfs_repair.c:612
+#: .././repair/xfs_repair.c:730
 #, c-format
 msgid "%s: cannot repair this filesystem.  Sorry.\n"
 msgstr "%s: niestety nie można naprawić tego systemu plików.\n"
 
-#: .././repair/xfs_repair.c:671
+#: .././repair/xfs_repair.c:806
 #, c-format
 msgid "        - reporting progress in intervals of %s\n"
 msgstr "        - informowanie o postępie w odstępach %s\n"
 
-#: .././repair/xfs_repair.c:716
+#: .././repair/xfs_repair.c:851
 #, c-format
-msgid "        - max_mem = %lu, icount = %<PRIu64>, imem = %<PRIu64>, dblock = %<PRIu64>, dmem = %<PRIu64>\n"
-msgstr "        - max_mem = %lu, icount = %<PRIu64>, imem = %<PRIu64>, dblock = %<PRIu64>, dmem = %<PRIu64>\n"
+msgid ""
+"        - max_mem = %lu, icount = %<PRIu64>, imem = %<PRIu64>, dblock = "
+"%<PRIu64>, dmem = %<PRIu64>\n"
+msgstr ""
+"        - max_mem = %lu, icount = %<PRIu64>, imem = %<PRIu64>, dblock = "
+"%<PRIu64>, dmem = %<PRIu64>\n"
 
-#: .././repair/xfs_repair.c:725
+#: .././repair/xfs_repair.c:860
 #, c-format
 msgid ""
 "Required memory for repair is greater that the maximum specified\n"
@@ -12866,7 +14915,7 @@ msgstr ""
 "Pamięć wymagana do naprawy przekracza maksimum określone opcją -m.\n"
 "Proszę ją zwiększyć do co najmniej %lu.\n"
 
-#: .././repair/xfs_repair.c:730
+#: .././repair/xfs_repair.c:865
 #, c-format
 msgid ""
 "Memory available for repair (%luMB) may not be sufficient.\n"
@@ -12877,50 +14926,55 @@ msgstr ""
 "Aby wydajnie naprawić ten system plików, niezbędne jest co najmniej %luMB.\n"
 "Jeśli naprawa nie powiedzie się z powodu braku pamięci, proszę\n"
 
-#: .././repair/xfs_repair.c:736
+#: .././repair/xfs_repair.c:871
 msgid "turn prefetching off (-P) to reduce the memory footprint.\n"
 msgstr "wyłączyć prefetch (-P), aby zmniejszyć zużycie pamięci.\n"
 
-#: .././repair/xfs_repair.c:739
+#: .././repair/xfs_repair.c:874
 #, c-format
 msgid "increase system RAM and/or swap space to at least %luMB.\n"
-msgstr "proszę rozszerzyć rozmiar RAM systemu i/lub przestrzeni wymiany do co najmniej %luMB.\n"
+msgstr ""
+"proszę rozszerzyć rozmiar RAM systemu i/lub przestrzeni wymiany do co "
+"najmniej %luMB.\n"
 
-#: .././repair/xfs_repair.c:754
+#: .././repair/xfs_repair.c:889
 #, c-format
 msgid "        - block cache size set to %d entries\n"
 msgstr "        - rozmiar bufora bloku ustawiony na %d wpisów\n"
 
-#: .././repair/xfs_repair.c:778
+#: .././repair/xfs_repair.c:914
 msgid "Found unsupported filesystem features.  Exiting now.\n"
 msgstr "Znaleziono nie obsługiwane cechy systemu plików. Zakończono.\n"
 
-#: .././repair/xfs_repair.c:796
+#: .././repair/xfs_repair.c:932
 #, c-format
 msgid "No modify flag set, skipping phase 5\n"
 msgstr "Ustawiono flagę braku modyfikacji, pominięto fazę 5\n"
 
-#: .././repair/xfs_repair.c:815
+#: .././repair/xfs_repair.c:952
 msgid "Inode allocation btrees are too corrupted, skipping phases 6 and 7\n"
 msgstr "B-drzewa alokacji i-węzłów są zbyt uszkodzone, pominięto fazy 6 i 7\n"
 
-#: .././repair/xfs_repair.c:821
+#: .././repair/xfs_repair.c:958
 msgid "Warning:  no quota inodes were found.  Quotas disabled.\n"
 msgstr "Uwaga: nie znaleziono i-węzłów limitów (quot). Limity wyłączone.\n"
 
-#: .././repair/xfs_repair.c:824
+#: .././repair/xfs_repair.c:961
 msgid "Warning:  no quota inodes were found.  Quotas would be disabled.\n"
-msgstr "Uwaga: nie znaleziono i-węzłów limitów (quot). Limity zostałyby wyłączone.\n"
+msgstr ""
+"Uwaga: nie znaleziono i-węzłów limitów (quot). Limity zostałyby wyłączone.\n"
 
-#: .././repair/xfs_repair.c:829
+#: .././repair/xfs_repair.c:966
 msgid "Warning:  quota inodes were cleared.  Quotas disabled.\n"
 msgstr "Uwaga: i-węzły limitów (quot) były wyczyszczone. Limity wyłączone.\n"
 
-#: .././repair/xfs_repair.c:832
+#: .././repair/xfs_repair.c:969
 msgid "Warning:  quota inodes would be cleared.  Quotas would be disabled.\n"
-msgstr "Uwaga: i-węzły limitów (quot) zostałyby wyczyszczone. Limity zostałyby wyłączone.\n"
+msgstr ""
+"Uwaga: i-węzły limitów (quot) zostałyby wyczyszczone. Limity zostałyby "
+"wyłączone.\n"
 
-#: .././repair/xfs_repair.c:838
+#: .././repair/xfs_repair.c:975
 msgid ""
 "Warning:  user quota information was cleared.\n"
 "User quotas can not be enforced until limit information is recreated.\n"
@@ -12928,15 +14982,16 @@ msgstr ""
 "Uwaga: informacje o limitach użytkowników były wyczyszczone.\n"
 "Limity użytkowników nie mogą być wymuszone do czasu odtworzenia informacji.\n"
 
-#: .././repair/xfs_repair.c:842
+#: .././repair/xfs_repair.c:979
 msgid ""
 "Warning:  user quota information would be cleared.\n"
 "User quotas could not be enforced until limit information was recreated.\n"
 msgstr ""
 "Uwaga: informacje o limitach użytkowników zostałyby wyczyszczone.\n"
-"Limity użytkowników nie mogłyby być wymuszone do czasu odtworzenia informacji.\n"
+"Limity użytkowników nie mogłyby być wymuszone do czasu odtworzenia "
+"informacji.\n"
 
-#: .././repair/xfs_repair.c:850
+#: .././repair/xfs_repair.c:987
 msgid ""
 "Warning:  group quota information was cleared.\n"
 "Group quotas can not be enforced until limit information is recreated.\n"
@@ -12944,7 +14999,7 @@ msgstr ""
 "Uwaga: informacje o limitach grup były wyczyszczone.\n"
 "Limity grup nie mogą być wymuszone do czasu odtworzenia informacji.\n"
 
-#: .././repair/xfs_repair.c:854
+#: .././repair/xfs_repair.c:991
 msgid ""
 "Warning:  group quota information would be cleared.\n"
 "Group quotas could not be enforced until limit information was recreated.\n"
@@ -12952,7 +15007,7 @@ msgstr ""
 "Uwaga: informacje o limitach grup zostałyby wyczyszczone.\n"
 "Limity grup nie mogłyby być wymuszone do czasu odtworzenia informacji.\n"
 
-#: .././repair/xfs_repair.c:862
+#: .././repair/xfs_repair.c:999
 msgid ""
 "Warning:  project quota information was cleared.\n"
 "Project quotas can not be enforced until limit information is recreated.\n"
@@ -12960,7 +15015,7 @@ msgstr ""
 "Uwaga: informacje o limitach projektów były wyczyszczone.\n"
 "Limity projektów nie mogą być wymuszone do czasu odtworzenia informacji.\n"
 
-#: .././repair/xfs_repair.c:866
+#: .././repair/xfs_repair.c:1003
 msgid ""
 "Warning:  project quota information would be cleared.\n"
 "Project quotas could not be enforced until limit information was recreated.\n"
@@ -12968,35 +15023,44 @@ msgstr ""
 "Uwaga: informacje o limitach projektów zostałyby wyczyszczone.\n"
 "Limity projektów nie mogłyby być wymuszone do czasu odtworzenia informacji.\n"
 
-#: .././repair/xfs_repair.c:877
+#: .././repair/xfs_repair.c:1020
 msgid "No modify flag set, skipping filesystem flush and exiting.\n"
-msgstr "Flaga braku modyfikacji ustawiona, pominięto zrzucanie systemu plików, zakończono.\n"
+msgstr ""
+"Flaga braku modyfikacji ustawiona, pominięto zrzucanie systemu plików, "
+"zakończono.\n"
 
-#: .././repair/xfs_repair.c:896
+#: .././repair/xfs_repair.c:1039
 msgid "Note - quota info will be regenerated on next quota mount.\n"
-msgstr "Uwaga - informacje o limitach zostaną ponownie wygenerowane przy następnym montowaniu.\n"
+msgstr ""
+"Uwaga - informacje o limitach zostaną ponownie wygenerowane przy następnym "
+"montowaniu.\n"
 
-#: .././repair/xfs_repair.c:903
+#: .././repair/xfs_repair.c:1046
 #, c-format
 msgid ""
-"Note - stripe unit (%d) and width (%d) fields have been reset.\n"
-"Please set with mount -o sunit=<value>,swidth=<value>\n"
+"Note - stripe unit (%d) and width (%d) were copied from a backup "
+"superblock.\n"
+"Please reset with mount -o sunit=<value>,swidth=<value> if necessary\n"
 msgstr ""
-"Uwaga - pola jednostki pasa (%d) i szerokości pasa (%d) zostały przestawione.\n"
-"Proszę ustawić przy użyciu mount -o sunit=<wartość>,swidth=<wartość>\n"
+"Uwaga - pola jednostki pasa (%d) i szerokości pasa (%d) zostały skopiowane\n"
+"z kopii zapasowej superbloku. W razie potrzeby można je przestawić przy "
+"użyciu\n"
+"mount -o sunit=<wartość>,swidth=<wartość>\n"
 
-#: .././repair/xfs_repair.c:926
+#: .././repair/xfs_repair.c:1070
 msgid "done\n"
 msgstr "gotowe\n"
 
-#: .././repair/xfs_repair.c:930
+#: .././repair/xfs_repair.c:1074
 msgid "Repair of readonly mount complete.  Immediate reboot encouraged.\n"
-msgstr "Naprawa systemu zamontowanego tylko do odczytu zakończona. Zalecany natychmiastowy restart systemu.\n"
+msgstr ""
+"Naprawa systemu zamontowanego tylko do odczytu zakończona. Zalecany "
+"natychmiastowy restart systemu.\n"
 
 #: .././rtcp/xfs_rtcp.c:30
 #, c-format
 msgid "%s [-e extsize] [-p] [-V] source target\n"
-msgstr "%s [-e rozm_fragmentu] [-p] [-V] źródło cel\n"
+msgstr "%s [-e rozm_ekstentu] [-p] [-V] źródło cel\n"
 
 #: .././rtcp/xfs_rtcp.c:69
 #, c-format
@@ -13075,8 +15139,11 @@ msgstr "%s: zostanie dopełniony do %lld
 
 #: .././rtcp/xfs_rtcp.c:318
 #, c-format
-msgid "Use the -p option to pad %s to a size which is a multiple of %d bytes.\n"
-msgstr "Można użyć opcji -p do dopełnienia %s do rozmiaru będącego wielokrotnością %d bajtów.\n"
+msgid ""
+"Use the -p option to pad %s to a size which is a multiple of %d bytes.\n"
+msgstr ""
+"Można użyć opcji -p do dopełnienia %s do rozmiaru będącego wielokrotnością "
+"%d bajtów.\n"
 
 #: .././rtcp/xfs_rtcp.c:360
 #, c-format
diff -urpN xfsprogs-4.9.0/po/xfsprogs.pot xfsprogs-4.14.0/po/xfsprogs.pot
--- xfsprogs-4.9.0/po/xfsprogs.pot	2017-01-05 23:35:07.000000000 +0100
+++ xfsprogs-4.14.0/po/xfsprogs.pot	2017-11-27 17:59:43.000000000 +0100
@@ -8,10 +8,11 @@ msgid ""
 msgstr ""
 "Project-Id-Version: PACKAGE VERSION\n"
 "Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2017-01-05 16:35-0600\n"
+"POT-Creation-Date: 2017-11-27 10:59-0600\n"
 "PO-Revision-Date: YEAR-MO-DA HO:MI+ZONE\n"
 "Last-Translator: FULL NAME <EMAIL@ADDRESS>\n"
 "Language-Team: LANGUAGE <LL@li.org>\n"
+"Language: \n"
 "MIME-Version: 1.0\n"
 "Content-Type: text/plain; charset=CHARSET\n"
 "Content-Transfer-Encoding: 8bit\n"
@@ -31,8 +32,8 @@ msgstr ""
 msgid "Aborting XFS copy -- logfile error -- reason: %s\n"
 msgstr ""
 
-#: .././copy/xfs_copy.c:139 .././copy/xfs_copy.c:292 .././copy/xfs_copy.c:605
-#: .././copy/xfs_copy.c:612
+#: .././copy/xfs_copy.c:139 .././copy/xfs_copy.c:292 .././copy/xfs_copy.c:617
+#: .././copy/xfs_copy.c:624
 msgid "Aborting XFS copy - reason"
 msgstr ""
 
@@ -121,822 +122,782 @@ msgstr ""
 msgid "ag header buffer invalid!\n"
 msgstr ""
 
-#: .././copy/xfs_copy.c:585 .././db/init.c:96 .././estimate/xfs_estimate.c:144
-#: .././fsr/xfs_fsr.c:295 .././growfs/xfs_growfs.c:190 .././io/init.c:199
-#: .././logprint/logprint.c:206 .././mkfs/xfs_mkfs.c:1925
-#: .././quota/init.c:181 .././repair/xfs_repair.c:322 .././rtcp/xfs_rtcp.c:55
+#: .././copy/xfs_copy.c:597 .././db/init.c:97 .././estimate/xfs_estimate.c:144
+#: .././fsr/xfs_fsr.c:295 .././growfs/xfs_growfs.c:191 .././io/init.c:210
+#: .././logprint/logprint.c:206 .././mkfs/xfs_mkfs.c:1942 .././quota/init.c:182
+#: .././repair/xfs_repair.c:324 .././rtcp/xfs_rtcp.c:55 .././spaceman/init.c:89
 #, c-format
 msgid "%s version %s\n"
 msgstr ""
 
-#: .././copy/xfs_copy.c:603
+#: .././copy/xfs_copy.c:615
 #, c-format
 msgid "%s: couldn't open log file \"%s\"\n"
 msgstr ""
 
-#: .././copy/xfs_copy.c:610
+#: .././copy/xfs_copy.c:622
 #, c-format
 msgid "%s: couldn't set up logfile stream\n"
 msgstr ""
 
-#: .././copy/xfs_copy.c:622
+#: .././copy/xfs_copy.c:634
 msgid "Couldn't allocate target array\n"
 msgstr ""
 
-#: .././copy/xfs_copy.c:641
+#: .././copy/xfs_copy.c:653
 #, c-format
 msgid "%s:  couldn't open source \"%s\"\n"
 msgstr ""
 
-#: .././copy/xfs_copy.c:647
+#: .././copy/xfs_copy.c:659
 #, c-format
 msgid "%s:  couldn't stat source \"%s\"\n"
 msgstr ""
 
-#: .././copy/xfs_copy.c:657
+#: .././copy/xfs_copy.c:669
 #, c-format
 msgid "%s: Cannot set direct I/O flag on \"%s\".\n"
 msgstr ""
 
-#: .././copy/xfs_copy.c:662
+#: .././copy/xfs_copy.c:674
 #, c-format
 msgid "%s: xfsctl on file \"%s\" failed.\n"
 msgstr ""
 
-#: .././copy/xfs_copy.c:685
+#: .././copy/xfs_copy.c:697
 #, c-format
 msgid "%s:  Warning -- a filesystem is mounted on the source device.\n"
 msgstr ""
 
-#: .././copy/xfs_copy.c:688
+#: .././copy/xfs_copy.c:700
 msgid "\t\tGenerated copies may be corrupt unless the source is\n"
 msgstr ""
 
-#: .././copy/xfs_copy.c:690
+#: .././copy/xfs_copy.c:702
 msgid "\t\tunmounted or mounted read-only.  Copy proceeding...\n"
 msgstr ""
 
-#: .././copy/xfs_copy.c:707
+#: .././copy/xfs_copy.c:719
 #, c-format
 msgid ""
 "%s: couldn't initialize XFS library\n"
 "%s: Aborting.\n"
 msgstr ""
 
-#: .././copy/xfs_copy.c:731
+#: .././copy/xfs_copy.c:743
 #, c-format
 msgid ""
 "%s: %s filesystem failed to initialize\n"
 "%s: Aborting.\n"
 msgstr ""
 
-#: .././copy/xfs_copy.c:735
+#: .././copy/xfs_copy.c:747
 #, c-format
 msgid ""
 "%s %s filesystem failed to initialize\n"
 "%s: Aborting.\n"
 msgstr ""
 
-#: .././copy/xfs_copy.c:739
+#: .././copy/xfs_copy.c:751
 #, c-format
 msgid ""
 "%s: %s has an external log.\n"
 "%s: Aborting.\n"
 msgstr ""
 
-#: .././copy/xfs_copy.c:743
+#: .././copy/xfs_copy.c:755
 #, c-format
 msgid ""
 "%s: %s has a real-time section.\n"
 "%s: Aborting.\n"
 msgstr ""
 
-#: .././copy/xfs_copy.c:762
+#: .././copy/xfs_copy.c:774
 msgid ""
 "Error: source filesystem log is dirty. Mount the filesystem to replay the\n"
 "log, unmount and retry xfs_copy.\n"
 msgstr ""
 
-#: .././copy/xfs_copy.c:767
+#: .././copy/xfs_copy.c:779
 msgid ""
 "Error: could not determine the log head or tail of the source filesystem.\n"
 "Mount the filesystem to replay the log or run xfs_repair.\n"
 msgstr ""
 
-#: .././copy/xfs_copy.c:783
+#: .././copy/xfs_copy.c:795
 msgid ""
 "Error:  filesystem block size is smaller than the disk sectorsize.\n"
 "Aborting XFS copy now.\n"
 msgstr ""
 
-#: .././copy/xfs_copy.c:800
+#: .././copy/xfs_copy.c:812
 #, c-format
 msgid "Creating file %s\n"
 msgstr ""
 
-#: .././copy/xfs_copy.c:818
+#: .././copy/xfs_copy.c:830
 #, c-format
 msgid ""
 "%s:  a filesystem is mounted on target device \"%s\".\n"
 "%s cannot copy to mounted filesystems.  Aborting\n"
 msgstr ""
 
-#: .././copy/xfs_copy.c:829
+#: .././copy/xfs_copy.c:841
 #, c-format
 msgid "%s:  couldn't open target \"%s\"\n"
 msgstr ""
 
-#: .././copy/xfs_copy.c:839
+#: .././copy/xfs_copy.c:851
 #, c-format
 msgid "%s:  cannot grow data section.\n"
 msgstr ""
 
-#: .././copy/xfs_copy.c:847
+#: .././copy/xfs_copy.c:859
 #, c-format
 msgid "%s:  xfsctl on \"%s\" failed.\n"
 msgstr ""
 
-#: .././copy/xfs_copy.c:866
+#: .././copy/xfs_copy.c:878
 #, c-format
 msgid "%s:  failed to write last block\n"
 msgstr ""
 
-#: .././copy/xfs_copy.c:868
+#: .././copy/xfs_copy.c:880
 #, c-format
 msgid "\tIs target \"%s\" too small?\n"
 msgstr ""
 
-#: .././copy/xfs_copy.c:878
+#: .././copy/xfs_copy.c:890
 msgid "Couldn't initialize global thread mask\n"
 msgstr ""
 
-#: .././copy/xfs_copy.c:885
+#: .././copy/xfs_copy.c:897
 msgid "Error initializing wbuf 0\n"
 msgstr ""
 
-#: .././copy/xfs_copy.c:893
+#: .././copy/xfs_copy.c:905
 msgid "Error initializing btree buf 1\n"
 msgstr ""
 
-#: .././copy/xfs_copy.c:898
+#: .././copy/xfs_copy.c:910
 msgid "Error creating first semaphore.\n"
 msgstr ""
 
-#: .././copy/xfs_copy.c:913
+#: .././copy/xfs_copy.c:925
 msgid "Couldn't malloc space for thread args\n"
 msgstr ""
 
-#: .././copy/xfs_copy.c:925
+#: .././copy/xfs_copy.c:937
 #, c-format
 msgid "Error creating thread mutex %d\n"
 msgstr ""
 
-#: .././copy/xfs_copy.c:942
+#: .././copy/xfs_copy.c:954
 #, c-format
 msgid "Error creating thread for target %d\n"
 msgstr ""
 
-#: .././copy/xfs_copy.c:996
+#: .././copy/xfs_copy.c:1008
 #, c-format
 msgid "Error: current level %d >= btree levels %d\n"
 msgstr ""
 
-#: .././copy/xfs_copy.c:1015
+#: .././copy/xfs_copy.c:1027
 #, c-format
 msgid "Bad btree magic 0x%x\n"
 msgstr ""
 
-#: .././copy/xfs_copy.c:1042
+#: .././copy/xfs_copy.c:1054
 msgid "WARNING:  source filesystem inconsistent.\n"
 msgstr ""
 
-#: .././copy/xfs_copy.c:1044
+#: .././copy/xfs_copy.c:1056
 msgid "  A leaf btree rec isn't a leaf.  Aborting now.\n"
 msgstr ""
 
-#: .././db/addr.c:35
-msgid "[field-expression]"
-msgstr ""
-
-#: .././db/addr.c:36
-msgid "set current address"
-msgstr ""
-
-#: .././db/addr.c:42
+#: .././db/btdump.c:32
 msgid ""
 "\n"
-" 'addr' uses the given field to set the filesystem address and type\n"
-"\n"
-" Examples:\n"
+" If the cursor points to a btree block, 'btdump' dumps the btree\n"
+" downward from that block.  If the cursor points to an inode,\n"
+" the data fork btree root is selected by default.  If the cursor\n"
+" points to a directory or extended attribute btree node, the tree\n"
+" will be printed downward from that block.\n"
 "\n"
-" sb\n"
-" a rootino - set the type to inode and set position to the root inode\n"
-" a u.bmx[0].startblock (for inode with blockmap)\n"
+" Options:\n"
+"   -a -- Display an inode's extended attribute fork btree.\n"
+"   -i -- Print internal btree nodes.\n"
 "\n"
 msgstr ""
 
-#: .././db/addr.c:72 .././db/attrset.c:86 .././db/attrset.c:189
-#: .././db/crc.c:76 .././db/write.c:110 .././db/print.c:74 .././db/type.c:208
-msgid "no current type\n"
-msgstr ""
-
-#: .././db/addr.c:82
+#: .././db/btdump.c:92 .././db/btdump.c:395
 #, c-format
-msgid "no fields for type %s\n"
+msgid "%s level %u block %u daddr %llu\n"
 msgstr ""
 
-#: .././db/addr.c:94
-msgid "array not allowed for addr command\n"
+#: .././db/btdump.c:185
+msgid "attr fork not in btree format\n"
 msgstr ""
 
-#: .././db/addr.c:103
-#, c-format
-msgid "no next type for field %s\n"
+#: .././db/btdump.c:191
+msgid "data fork not in btree format\n"
 msgstr ""
 
-#: .././db/addr.c:110
+#: .././db/btdump.c:430
 #, c-format
-msgid "no addr function for field %s (type %s)\n"
+msgid "Current location is not part of a dir/attr btree.\n"
 msgstr ""
 
-#: .././db/agfl.c:36 .././db/agi.c:35 .././db/agf.c:35 .././db/sb.c:44
-msgid "[agno]"
+#: .././db/btdump.c:469 .././db/print.c:74 .././db/crc.c:76 .././db/write.c:110
+#: .././db/addr.c:72 .././db/type.c:209 .././db/fuzz.c:98 .././db/attrset.c:86
+#: .././db/attrset.c:189
+msgid "no current type\n"
 msgstr ""
 
-#: .././db/agfl.c:37
-msgid "set address to agfl block"
+#: .././db/btdump.c:481
+msgid "bad option for btdump command\n"
 msgstr ""
 
-#: .././db/agfl.c:79
-msgid ""
-"\n"
-" set allocation group freelist\n"
-"\n"
-" Example:\n"
-"\n"
-" agfl 5\n"
-" Located in the fourth sector of each allocation group,\n"
-" the agfl freelist for internal btree space allocation is maintained\n"
-" for each allocation group.  This acts as a reserved pool of space\n"
-" separate from the general filesystem freespace (not used for user data).\n"
-"\n"
+#: .././db/btdump.c:487
+msgid "bad options for btdump command\n"
 msgstr ""
 
-#: .././db/agfl.c:106 .././db/agi.c:94 .././db/agf.c:125 .././db/sb.c:167
-#, c-format
-msgid "bad allocation group number %s\n"
+#: .././db/btdump.c:491
+msgid "attrfork flag doesn't apply here\n"
 msgstr ""
 
-#: .././db/agi.c:36
-msgid "set address to agi header"
+#: .././db/btdump.c:513
+#, c-format
+msgid "type \"%s\" is not a btree type or inode\n"
 msgstr ""
 
-#: .././db/agi.c:69
-msgid ""
-"\n"
-" set allocation group inode btree\n"
-"\n"
-" Example:\n"
-"\n"
-" agi 3 (set location to 3rd allocation group inode btree and type to 'agi')\n"
-"\n"
-" Located in the 3rd 512 byte block of each allocation group,\n"
-" the agi inode btree tracks all used/free inodes in the allocation group.\n"
-" Inodes are allocated in 16k 'chunks', each btree entry tracks a 'chunk'.\n"
-"\n"
+#: .././db/btdump.c:521
+msgid "dump btree"
 msgstr ""
 
-#: .././db/attr.c:556
-msgid "Unknown attribute buffer type!\n"
+#: .././db/command.c:86 .././db/help.c:56 .././libxcmd/help.c:50
+#, c-format
+msgid "command %s not found\n"
 msgstr ""
 
-#: .././db/attr.c:568
-msgid "Writing unknown attribute buffer type!\n"
+#: .././db/command.c:90
+#, c-format
+msgid "bad argument count %d to %s, expected "
 msgstr ""
 
-#: .././db/attrset.c:38
-msgid "[-r|-s|-p|-u] [-n] [-R|-C] [-v n] name"
+#: .././db/command.c:92
+#, c-format
+msgid "at least %d"
 msgstr ""
 
-#: .././db/attrset.c:39
-msgid "set the named attribute on the current inode"
+#: .././db/command.c:96
+#, c-format
+msgid "between %d and %d"
 msgstr ""
 
-#: .././db/attrset.c:42
-msgid "[-r|-s|-p|-u] [-n] name"
+#: .././db/command.c:97
+msgid " arguments\n"
 msgstr ""
 
-#: .././db/attrset.c:43
-msgid "remove the named attribute from the current inode"
+#: .././db/faddr.c:40 .././db/faddr.c:63
+msgid "no current allocation group, cannot set new addr\n"
 msgstr ""
 
-#: .././db/attrset.c:49
-msgid ""
-"\n"
-" The 'attr_set' and 'attr_remove' commands provide interfaces for debugging\n"
-" the extended attribute allocation and removal code.\n"
-" Both commands require an attribute name to be specified, and the attr_set\n"
-" command allows an optional value length (-v) to be provided as well.\n"
-" There are 4 namespace flags:\n"
-"  -r -- 'root'\n"
-"  -u -- 'user'\t\t(default)\n"
-"  -s -- 'secure'\n"
-"\n"
-" For attr_set, these options further define the type of set operation:\n"
-"  -C -- 'create'    - create attribute, fail if it already exists\n"
-"  -R -- 'replace'   - replace attribute, fail if it does not exist\n"
-" The backward compatibility mode 'noattr2' can be emulated (-n) also.\n"
-"\n"
+#: .././db/faddr.c:45 .././db/faddr.c:117 .././db/faddr.c:148
+#: .././db/faddr.c:180 .././db/faddr.c:202 .././db/faddr.c:232
+#: .././db/faddr.c:262 .././db/faddr.c:316 .././db/faddr.c:335
+msgid "null block number, cannot set new addr\n"
 msgstr ""
 
-#: .././db/attrset.c:90 .././db/attrset.c:193
-msgid "current type is not inode\n"
+#: .././db/faddr.c:68 .././db/faddr.c:353 .././db/faddr.c:370
+#: .././db/faddr.c:387
+msgid "null inode number, cannot set new addr\n"
 msgstr ""
 
-#: .././db/attrset.c:125
-#, c-format
-msgid "bad attr_set valuelen %s\n"
+#: .././db/faddr.c:88
+msgid "null attribute block number, cannot set new addr\n"
 msgstr ""
 
-#: .././db/attrset.c:131
-msgid "bad option for attr_set command\n"
+#: .././db/faddr.c:94
+msgid "attribute block is unmapped\n"
 msgstr ""
 
-#: .././db/attrset.c:137
-msgid "too few options for attr_set (no name given)\n"
+#: .././db/faddr.c:123 .././db/faddr.c:155 .././db/faddr.c:208
+#: .././db/faddr.c:239
+msgid "file block is unmapped\n"
 msgstr ""
 
-#: .././db/attrset.c:146
-#, c-format
-msgid "cannot allocate buffer (%d)\n"
+#: .././db/faddr.c:285
+msgid "null directory block number, cannot set new addr\n"
 msgstr ""
 
-#: .././db/attrset.c:155 .././db/attrset.c:230
-#, c-format
-msgid "failed to iget inode %llu\n"
+#: .././db/faddr.c:292
+msgid "directory block is unmapped\n"
 msgstr ""
 
-#: .././db/attrset.c:162
+#: .././db/btblock.c:164
 #, c-format
-msgid "failed to set attr %s on inode %llu\n"
+msgid "Bad btree magic 0x%x; coercing to %s.\n"
 msgstr ""
 
-#: .././db/attrset.c:217
-msgid "bad option for attr_remove command\n"
+#: .././db/echo.c:27
+msgid "[args]..."
 msgstr ""
 
-#: .././db/attrset.c:223
-msgid "too few options for attr_remove (no name given)\n"
+#: .././db/echo.c:28
+msgid "echo arguments"
 msgstr ""
 
-#: .././db/attrset.c:236
-#, c-format
-msgid "failed to remove attr %s from inode %llu\n"
+#: .././db/print.c:41
+msgid "[value]..."
 msgstr ""
 
-#: .././db/block.c:43 .././db/block.c:49
-msgid "filoff"
+#: .././db/print.c:42
+msgid "print field values"
 msgstr ""
 
-#: .././db/block.c:44
-msgid "set address to file offset (attr fork)"
+#: .././db/print.c:79
+#, c-format
+msgid "no print function for type %s\n"
 msgstr ""
 
-#: .././db/block.c:46
-msgid "[d]"
+#: .././db/print.c:165
+msgid "(empty)\n"
 msgstr ""
 
-#: .././db/block.c:47
-msgid "set address to daddr value"
+#: .././db/print.c:227
+msgid "(empty)"
 msgstr ""
 
-#: .././db/block.c:50
-msgid "set address to file offset (data fork)"
+#: .././db/print.c:287
+msgid "no arguments allowed\n"
 msgstr ""
 
-#: .././db/block.c:52
-msgid "[fsb]"
+#: .././db/metadump.c:60
+msgid "[-a] [-e] [-g] [-m max_extent] [-w] [-o] filename"
 msgstr ""
 
-#: .././db/block.c:53
-msgid "set address to fsblock value"
+#: .././db/metadump.c:61
+msgid "dump metadata to a file"
 msgstr ""
 
-#: .././db/block.c:59
+#: .././db/metadump.c:93
+#, c-format
 msgid ""
 "\n"
-" Example:\n"
+" The 'metadump' command dumps the known metadata to a compact file suitable\n"
+" for compressing and sending to an XFS maintainer for corruption analysis \n"
+" or xfs_repair failures.\n"
 "\n"
-" 'ablock 23' - sets the file position to the 23rd filesystem block in\n"
-" the inode's attribute fork.  The filesystem block size is specified in\n"
-" the superblock.\n"
+" Options:\n"
+"   -a -- Copy full metadata blocks without zeroing unused space\n"
+"   -e -- Ignore read errors and keep going\n"
+"   -g -- Display dump progress\n"
+"   -m -- Specify max extent size in blocks to copy (default = %d blocks)\n"
+"   -o -- Don't obfuscate names and extended attributes\n"
+"   -w -- Show warnings of bad metadata information\n"
 "\n"
 msgstr ""
 
-#: .././db/block.c:82 .././db/block.c:177
-#, c-format
-msgid "bad block number %s\n"
+#: .././db/metadump.c:2765
+msgid ""
+"Warning: log recovery of an obfuscated metadata image can leak unobfuscated "
+"metadata and/or cause image corruption.  If possible, please mount the "
+"filesystem to clean the log, or disable obfuscation."
 msgstr ""
 
-#: .././db/block.c:90
-msgid "no attribute data for file\n"
+#: .././db/metadump.c:2773
+msgid "Could not discern log; image will contain unobfuscated metadata in log."
 msgstr ""
 
-#: .././db/block.c:96
-msgid "file attr block is unmapped\n"
+#: .././db/fprint.c:99
+msgid "null"
 msgstr ""
 
-#: .././db/block.c:119
-msgid ""
-"\n"
-" Example:\n"
-"\n"
-" 'daddr 102' - sets position to the 102nd absolute disk block\n"
-" (512 byte block).\n"
+#: .././db/sb.c:44 .././db/agf.c:35 .././db/agi.c:35 .././db/agfl.c:36
+msgid "[agno]"
 msgstr ""
 
-#: .././db/block.c:135
-#, c-format
-msgid "current daddr is %lld\n"
+#: .././db/sb.c:45
+msgid "set current address to sb header"
 msgstr ""
 
-#: .././db/block.c:141
-#, c-format
-msgid "bad daddr %s\n"
+#: .././db/sb.c:47
+msgid "[uuid]"
 msgstr ""
 
-#: .././db/block.c:153
-msgid ""
-"\n"
-" Example:\n"
-"\n"
-" 'dblock 23' - sets the file position to the 23rd filesystem block in\n"
-" the inode's data fork.  The filesystem block size is specified in the\n"
-" superblock.\n"
-"\n"
+#: .././db/sb.c:48
+msgid "write/print FS uuid"
 msgstr ""
 
-#: .././db/block.c:185
-msgid "no type for file data\n"
+#: .././db/sb.c:50
+msgid "[label]"
 msgstr ""
 
-#: .././db/block.c:192
-msgid "file data block is unmapped\n"
+#: .././db/sb.c:51
+msgid "write/print FS label"
 msgstr ""
 
-#: .././db/block.c:210
-msgid ""
-"\n"
-" Example:\n"
-"\n"
-" 'fsblock 1023' - sets the file position to the 1023rd filesystem block.\n"
-" The filesystem block size is specified in the superblock and set during\n"
-" mkfs time.  Offset is absolute (not AG relative).\n"
+#: .././db/sb.c:53
+msgid "[feature | [vnum fnum]]"
+msgstr ""
+
+#: .././db/sb.c:54
+msgid "set feature bit(s) in the sb version field"
+msgstr ""
+
+#: .././db/sb.c:140
+msgid ""
+"\n"
+" set allocation group superblock\n"
+"\n"
+" Example:\n"
+"\n"
+" 'sb 7' - set location to 7th allocation group superblock, set type to 'sb'\n"
+"\n"
+" Located in the first sector of each allocation group, the superblock\n"
+" contains the base information for the filesystem.\n"
+" The superblock in allocation group 0 is the primary.  The copies in the\n"
+" remaining allocation groups only serve as backup for filesystem recovery.\n"
+" The icount/ifree/fdblocks/frextents are only updated in superblock 0.\n"
 "\n"
 msgstr ""
 
-#: .././db/block.c:229
+#: .././db/sb.c:167 .././db/agf.c:125 .././db/agi.c:94 .././db/agfl.c:106
 #, c-format
-msgid "current fsblock is %lld\n"
+msgid "bad allocation group number %s\n"
 msgstr ""
 
-#: .././db/block.c:235 .././db/block.c:241
+#: .././db/sb.c:199
 #, c-format
-msgid "bad fsblock %s\n"
+msgid "can't read superblock for AG %u\n"
 msgstr ""
 
-#: .././db/bmap.c:39
-msgid "[-ad] [block [len]]"
+#: .././db/sb.c:207
+#, c-format
+msgid "bad sb magic # %#x in AG %u\n"
 msgstr ""
 
-#: .././db/bmap.c:40
-msgid "show block map for current file"
+#: .././db/sb.c:212
+#, c-format
+msgid "bad sb version # %#x in AG %u\n"
 msgstr ""
 
-#: .././db/bmap.c:152 .././db/inode.c:424
-msgid "no current inode\n"
+#: .././db/sb.c:217 .././db/check.c:3876
+msgid "mkfs not completed successfully\n"
 msgstr ""
 
-#: .././db/bmap.c:165
-msgid "bad option for bmap command\n"
+#: .././db/sb.c:236
+msgid "aborting - external log specified for FS with an internal log\n"
 msgstr ""
 
-#: .././db/bmap.c:182
-#, c-format
-msgid "bad block number for bmap %s\n"
+#: .././db/sb.c:242
+msgid "aborting - no external log specified for FS with an external log\n"
 msgstr ""
 
-#: .././db/bmap.c:190
-#, c-format
-msgid "bad len for bmap %s\n"
+#: .././db/sb.c:252
+msgid "ERROR: cannot find log head/tail, run xfs_repair\n"
 msgstr ""
 
-#: .././db/bmap.c:213
+#: .././db/sb.c:256
 #, c-format
-msgid "%s offset %lld startblock %llu (%u/%u) count %llu flag %u\n"
+msgid ""
+"ERROR: The filesystem has valuable metadata changes in a log which needs to\n"
+"be replayed.  Mount the filesystem to replay the log, and unmount it before\n"
+"re-running %s.  If you are unable to mount the filesystem, then use\n"
+"the xfs_repair -L option to destroy the log and attempt a repair.\n"
+"Note that destroying the log may cause corruption -- please attempt a mount\n"
+"of the filesystem before doing this.\n"
 msgstr ""
 
-#: .././db/bmap.c:215 .././db/check.c:2224 .././db/check.c:2236
-#: .././db/check.c:2263 .././repair/dinode.c:52
-msgid "data"
+#: .././db/sb.c:284
+msgid "Clearing log and setting UUID\n"
 msgstr ""
 
-#: .././db/bmap.c:215 .././db/check.c:2224 .././db/check.c:2236
-#: .././db/check.c:2263 .././repair/dinode.c:53
-msgid "attr"
+#: .././db/sb.c:293
+msgid "ERROR: cannot clear the log\n"
 msgstr ""
 
-#: .././db/command.c:85 .././db/help.c:56 .././libxcmd/help.c:50
-#, c-format
-msgid "command %s not found\n"
+#: .././db/sb.c:305
+msgid ""
+"\n"
+" write/print FS uuid\n"
+"\n"
+" Example:\n"
+"\n"
+" 'uuid'                                      - print UUID\n"
+" 'uuid 01234567-0123-0123-0123-0123456789ab' - write UUID\n"
+" 'uuid generate'                             - generate and write\n"
+" 'uuid rewrite'                              - copy UUID from SB 0\n"
+"\n"
+"The print function checks the UUID in each SB and will warn if the UUIDs\n"
+"differ between AGs (the log is not checked). The write commands will\n"
+"set the uuid in all AGs to either a specified value, a newly generated\n"
+"value or the value found in the first superblock (SB 0) respectively.\n"
+"As a side effect of writing the UUID, the log is cleared (which is fine\n"
+"on a CLEANLY unmounted FS).\n"
+"\n"
 msgstr ""
 
-#: .././db/command.c:89
-#, c-format
-msgid "bad argument count %d to %s, expected "
+#: .././db/sb.c:383 .././db/sb.c:546
+msgid "invalid parameters\n"
 msgstr ""
 
-#: .././db/command.c:91
+#: .././db/sb.c:390 .././db/sb.c:553 .././db/sb.c:722
 #, c-format
-msgid "at least %d"
+msgid "%s: not in expert mode, writing disabled\n"
+msgstr ""
+
+#: .././db/sb.c:402
+msgid "failed to read UUID from AG 0\n"
 msgstr ""
 
-#: .././db/command.c:95
+#: .././db/sb.c:407
 #, c-format
-msgid "between %d and %d"
+msgid "old UUID = %s\n"
 msgstr ""
 
-#: .././db/command.c:96
-msgid " arguments\n"
+#: .././db/sb.c:421
+msgid "invalid UUID\n"
 msgstr ""
 
-#: .././db/convert.c:171
-#, c-format
-msgid "bad argument count %d to convert, expected 3,5,7,9 arguments\n"
+#: .././db/sb.c:430 .././db/sb.c:558 .././db/sb.c:808
+msgid "writing all SBs\n"
 msgstr ""
 
-#: .././db/convert.c:176 .././db/convert.c:183
+#: .././db/sb.c:433
 #, c-format
-msgid "unknown conversion type %s\n"
+msgid "failed to set UUID in AG %d\n"
 msgstr ""
 
-#: .././db/convert.c:187
-msgid "result type same as argument\n"
+#: .././db/sb.c:438
+#, c-format
+msgid "new UUID = %s\n"
 msgstr ""
 
-#: .././db/convert.c:191
+#: .././db/sb.c:446
 #, c-format
-msgid "conflicting conversion type %s\n"
+msgid "failed to read UUID from AG %d\n"
 msgstr ""
 
-#: .././db/convert.c:269
+#: .././db/sb.c:452
 #, c-format
-msgid "%s is not a number\n"
+msgid "warning: UUID in AG %d differs to the primary SB\n"
 msgstr ""
 
-#: .././db/crc.c:37
-msgid "manipulate crc values for V5 filesystem structures"
+#: .././db/sb.c:463
+msgid "warning - external log specified for FS with an internal log\n"
 msgstr ""
 
-#: .././db/crc.c:50
+#: .././db/sb.c:466
+msgid "warning - no external log specified for FS with an external log\n"
+msgstr ""
+
+#: .././db/sb.c:471
+#, c-format
+msgid "UUID = %s\n"
+msgstr ""
+
+#: .././db/sb.c:482
 msgid ""
 "\n"
-" 'crc' validates, invalidates, or recalculates the crc value for\n"
-" the current on-disk metadata structures in Version 5 filesystems.\n"
+" write/print FS label\n"
 "\n"
-" Usage:  \"crc [-i|-r|-v]\"\n"
+" Example:\n"
+"\n"
+" 'label'              - print label\n"
+" 'label 123456789012' - write label\n"
+" 'label --'           - write an empty label\n"
+"\n"
+"The print function checks the label in each SB and will warn if the labels\n"
+"differ between AGs. The write commands will set the label in all AGs to the\n"
+"specified value.  The maximum length of a label is 12 characters - use of a\n"
+"longer label will result in truncation and a warning will be issued.\n"
 "\n"
 msgstr ""
 
-#: .././db/crc.c:81
+#: .././db/sb.c:519
 #, c-format
-msgid "current type (%s) is not a structure\n"
+msgid "%s: truncating label length from %d to %d\n"
 msgstr ""
 
-#: .././db/crc.c:98
-msgid "bad option for crc command\n"
+#: .././db/sb.c:561
+#, c-format
+msgid "failed to set label in AG %d\n"
 msgstr ""
 
-#: .././db/crc.c:105
-msgid "crc command accepts only one option\n"
+#: .././db/sb.c:564
+#, c-format
+msgid "new label = \"%s\"\n"
 msgstr ""
 
-#: .././db/crc.c:111
+#: .././db/sb.c:571
 #, c-format
-msgid "%s not in expert mode, writing disabled\n"
+msgid "failed to read label in AG %d\n"
 msgstr ""
 
-#: .././db/crc.c:128
+#: .././db/sb.c:577
 #, c-format
-msgid "No CRC field found for type %s\n"
+msgid "warning: AG %d label differs\n"
 msgstr ""
 
-#: .././db/crc.c:135 .././db/write.c:693
-msgid "parsing error\n"
+#: .././db/sb.c:579
+#, c-format
+msgid "label = \"%s\"\n"
 msgstr ""
 
-#: .././db/crc.c:171
-msgid "Invalidating CRC:\n"
+#: .././db/sb.c:589
+msgid ""
+"\n"
+" set/print feature bits in sb version\n"
+"\n"
+" Example:\n"
+"\n"
+" 'version'          - print current feature bits\n"
+" 'version extflg'   - enable unwritten extents\n"
+" 'version attr1'    - enable v1 inline extended attributes\n"
+" 'version attr2'    - enable v2 inline extended attributes\n"
+" 'version log2'     - enable v2 log format\n"
+"\n"
+"The version function prints currently enabled features for a filesystem\n"
+"according to the version field of its primary superblock.\n"
+"It can also be used to enable selected features, such as support for\n"
+"unwritten extents.  The updated version is written into all AGs.\n"
+"\n"
 msgstr ""
 
-#: .././db/crc.c:173
-msgid "Recalculating CRC:\n"
+#: .././db/sb.c:617
+msgid "Superblock has mismatched features2 fields, skipping modification\n"
 msgstr ""
 
-#: .././db/crc.c:181
-msgid "Verifying CRC:\n"
+#: .././db/sb.c:742
+msgid "unwritten extents flag is already enabled\n"
 msgstr ""
 
-#: .././db/debug.c:27
-msgid "[flagbits]"
+#: .././db/sb.c:749
+msgid "unwritten extents always enabled for v5 superblocks.\n"
 msgstr ""
 
-#: .././db/debug.c:28
-msgid "set debug option bits"
+#: .././db/sb.c:766
+msgid "version 2 log format is already in use\n"
 msgstr ""
 
-#: .././db/debug.c:42
-#, c-format
-msgid "bad value for debug %s\n"
+#: .././db/sb.c:773
+msgid "Version 2 logs always enabled for v5 superblocks.\n"
 msgstr ""
 
-#: .././db/dir2.c:1023
-msgid "Unknown directory buffer type!\n"
+#: .././db/sb.c:778
+#, c-format
+msgid "%s: Cannot change %s on v5 superblocks.\n"
 msgstr ""
 
-#: .././db/dir2.c:1035
-msgid "Writing unknown directory buffer type!\n"
+#: .././db/sb.c:802
+#, c-format
+msgid "%s: invalid version change command \"%s\"\n"
 msgstr ""
 
-#: .././db/dquot.c:37
-msgid "[-g|-p|-u] id"
+#: .././db/sb.c:811
+#, c-format
+msgid "failed to set versionnum in AG %d\n"
 msgstr ""
 
-#: .././db/dquot.c:38
-msgid ""
-"set current address to a group, project or user quota block for given ID"
+#: .././db/sb.c:829
+#, c-format
+msgid "versionnum [0x%x+0x%x] = %s\n"
 msgstr ""
 
-#: .././db/dquot.c:129
-msgid "bad option for dquot command\n"
+#: .././db/bmap.c:39
+msgid "[-ad] [block [len]]"
 msgstr ""
 
-#: .././db/dquot.c:133
-msgid "project"
+#: .././db/bmap.c:40
+msgid "show block map for current file"
 msgstr ""
 
-#: .././db/dquot.c:133
-msgid "group"
+#: .././db/bmap.c:152 .././db/inode.c:424
+msgid "no current inode\n"
 msgstr ""
 
-#: .././db/dquot.c:133
-msgid "user"
+#: .././db/bmap.c:165
+msgid "bad option for bmap command\n"
 msgstr ""
 
-#: .././db/dquot.c:135
-#, c-format
-msgid "dquot command requires one %s id argument\n"
-msgstr ""
-
-#: .././db/dquot.c:145
-#, c-format
-msgid "no %s quota inode present\n"
-msgstr ""
-
-#: .././db/dquot.c:150
-#, c-format
-msgid "bad %s id for dquot %s\n"
-msgstr ""
-
-#: .././db/dquot.c:162
-#, c-format
-msgid "no %s quota data for id %d\n"
-msgstr ""
-
-#: .././db/echo.c:27
-msgid "[args]..."
-msgstr ""
-
-#: .././db/echo.c:28
-msgid "echo arguments"
-msgstr ""
-
-#: .././db/faddr.c:40 .././db/faddr.c:63
-msgid "no current allocation group, cannot set new addr\n"
-msgstr ""
-
-#: .././db/faddr.c:45 .././db/faddr.c:117 .././db/faddr.c:148
-#: .././db/faddr.c:180 .././db/faddr.c:202 .././db/faddr.c:232
-#: .././db/faddr.c:262 .././db/faddr.c:316 .././db/faddr.c:335
-msgid "null block number, cannot set new addr\n"
-msgstr ""
-
-#: .././db/faddr.c:68 .././db/faddr.c:353 .././db/faddr.c:370
-#: .././db/faddr.c:387
-msgid "null inode number, cannot set new addr\n"
-msgstr ""
-
-#: .././db/faddr.c:88
-msgid "null attribute block number, cannot set new addr\n"
-msgstr ""
-
-#: .././db/faddr.c:94
-msgid "attribute block is unmapped\n"
-msgstr ""
-
-#: .././db/faddr.c:123 .././db/faddr.c:155 .././db/faddr.c:208
-#: .././db/faddr.c:239
-msgid "file block is unmapped\n"
-msgstr ""
-
-#: .././db/faddr.c:285
-msgid "null directory block number, cannot set new addr\n"
-msgstr ""
-
-#: .././db/faddr.c:292
-msgid "directory block is unmapped\n"
-msgstr ""
-
-#: .././db/flist.c:149
-#, c-format
-msgid "field %s not found\n"
-msgstr ""
-
-#: .././db/flist.c:159
+#: .././db/bmap.c:182
 #, c-format
-msgid "no elements in %s\n"
+msgid "bad block number for bmap %s\n"
 msgstr ""
 
-#: .././db/flist.c:165
+#: .././db/bmap.c:190
 #, c-format
-msgid "indices %d-%d for field %s out of range %d-%d\n"
+msgid "bad len for bmap %s\n"
 msgstr ""
 
-#: .././db/flist.c:173
+#: .././db/bmap.c:213
 #, c-format
-msgid "index %d for field %s out of range %d-%d\n"
+msgid "%s offset %lld startblock %llu (%u/%u) count %llu flag %u\n"
 msgstr ""
 
-#: .././db/flist.c:187
-#, c-format
-msgid "field %s is not an array\n"
+#: .././db/bmap.c:215 .././db/check.c:2224 .././db/check.c:2236
+#: .././db/check.c:2263 .././io/fsmap.c:105 .././repair/dinode.c:52
+msgid "data"
 msgstr ""
 
-#: .././db/flist.c:200
-#, c-format
-msgid "field %s has no subfields\n"
+#: .././db/bmap.c:215 .././db/check.c:2224 .././db/check.c:2236
+#: .././db/check.c:2263 .././io/fsmap.c:105 .././repair/dinode.c:53
+msgid "attr"
 msgstr ""
 
-#: .././db/flist.c:220
-#, c-format
-msgid "fl@%p:\n"
+#: .././db/crc.c:37
+msgid "manipulate crc values for V5 filesystem structures"
 msgstr ""
 
-#: .././db/flist.c:221
-#, c-format
-msgid "\tname=%s, fld=%p, child=%p, sibling=%p\n"
+#: .././db/crc.c:50
+msgid ""
+"\n"
+" 'crc' validates, invalidates, or recalculates the crc value for\n"
+" the current on-disk metadata structures in Version 5 filesystems.\n"
+"\n"
+" Usage:  \"crc [-i|-r|-v]\"\n"
+"\n"
 msgstr ""
 
-#: .././db/flist.c:223
+#: .././db/crc.c:81
 #, c-format
-msgid "\tlow=%d, high=%d, flags=%d (%s%s), offset=%d\n"
+msgid "current type (%s) is not a structure\n"
 msgstr ""
 
-#: .././db/flist.c:225
-msgid "oklow "
+#: .././db/crc.c:98
+msgid "bad option for crc command\n"
 msgstr ""
 
-#: .././db/flist.c:226
-msgid "okhigh"
+#: .././db/crc.c:105
+msgid "crc command accepts only one option\n"
 msgstr ""
 
-#: .././db/flist.c:227
+#: .././db/crc.c:111
 #, c-format
-msgid "\tfld->name=%s, fld->ftyp=%d (%s)\n"
+msgid "%s not in expert mode, writing disabled\n"
 msgstr ""
 
-#: .././db/flist.c:230
+#: .././db/crc.c:128
 #, c-format
-msgid "\tfld->flags=%d (%s%s%s%s%s)\n"
+msgid "No CRC field found for type %s\n"
 msgstr ""
 
-#: .././db/flist.c:322
-#, c-format
-msgid "bad syntax in field name %s\n"
+#: .././db/crc.c:135 .././db/write.c:700 .././db/fuzz.c:419
+msgid "parsing error\n"
 msgstr ""
 
-#: .././db/flist.c:378
-#, c-format
-msgid "missing closing quote %s\n"
+#: .././db/crc.c:171
+msgid "Invalidating CRC:\n"
 msgstr ""
 
-#: .././db/flist.c:395
-#, c-format
-msgid "bad character in field %s\n"
+#: .././db/crc.c:173
+msgid "Recalculating CRC:\n"
 msgstr ""
 
-#: .././db/fprint.c:99
-msgid "null"
+#: .././db/crc.c:181
+msgid "Verifying CRC:\n"
 msgstr ""
 
 #: .././db/frag.c:173
@@ -962,18 +923,18 @@ msgstr ""
 msgid "inode %lld actual %lld ideal %lld\n"
 msgstr ""
 
-#: .././db/frag.c:370 .././db/check.c:3890
+#: .././db/frag.c:370 .././db/check.c:3888
 #, c-format
 msgid "can't read agf block for ag %u\n"
 msgstr ""
 
-#: .././db/frag.c:379 .././db/check.c:3918
+#: .././db/frag.c:379 .././db/check.c:3916
 #, c-format
 msgid "can't read agi block for ag %u\n"
 msgstr ""
 
-#: .././db/frag.c:402 .././db/frag.c:425 .././db/freesp.c:289
-#: .././db/check.c:4111 .././db/check.c:4139
+#: .././db/frag.c:402 .././db/frag.c:425 .././db/check.c:4109
+#: .././db/check.c:4137 .././db/freesp.c:293
 #, c-format
 msgid "can't read btree block %u/%u\n"
 msgstr ""
@@ -983,2512 +944,2699 @@ msgstr ""
 msgid "invalid numrecs (%u) in %s block\n"
 msgstr ""
 
-#: .././db/frag.c:494 .././db/check.c:4466
+#: .././db/frag.c:494 .././db/check.c:4464
 #, c-format
 msgid "can't read inode block %u/%u\n"
 msgstr ""
 
-#: .././db/freesp.c:110
-#, c-format
-msgid "total free extents %lld\n"
-msgstr ""
-
-#: .././db/freesp.c:111
-#, c-format
-msgid "total free blocks %lld\n"
+#: .././db/write.c:41
+msgid "[-c] [field or value]..."
 msgstr ""
 
-#: .././db/freesp.c:112
-#, c-format
-msgid "average free extent size %g\n"
+#: .././db/write.c:42
+msgid "write value to disk"
 msgstr ""
 
-#: .././db/freesp.c:203
+#: .././db/write.c:58
 msgid ""
-"freesp arguments: [-bcds] [-a agno] [-e binsize] [-h h1]... [-m binmult]\n"
+"\n"
+" The 'write' command takes on different personalities depending on the\n"
+" type of object being worked with.\n"
+"\n"
+" Write has 3 modes:\n"
+"  'struct mode' - is active anytime you're looking at a filesystem object\n"
+"                  which contains individual fields (ex: an inode).\n"
+"  'data mode'   - is active anytime you set a disk address directly or set\n"
+"                  the type to 'data'.\n"
+"  'string mode' - only used for writing symlink blocks.\n"
+"\n"
+" Examples:\n"
+"  Struct mode: 'write core.uid 23'          - set an inode uid field to 23.\n"
+"               'write fname \"hello\\000\"'    - write superblock fname.\n"
+"               (note: in struct mode strings are not null terminated)\n"
+"               'write fname #6669736800'    - write superblock fname with "
+"hex.\n"
+"               'write uuid 00112233-4455-6677-8899-aabbccddeeff'\n"
+"                                            - write superblock uuid.\n"
+"  Data mode:   'write fill 0xff' - fill the entire block with 0xff's\n"
+"               'write lshift 3' - shift the block 3 bytes to the left\n"
+"               'write sequence 1 5' - write a cycle of number [1-5] through\n"
+"                                      the entire block.\n"
+"  String mode: 'write \"This_is_a_filename\" - write null terminated "
+"string.\n"
+"\n"
+" In data mode type 'write' by itself for a list of specific commands.\n"
+"\n"
+" Specifying the -c option will allow writes of invalid (corrupt) data with\n"
+" an invalid CRC. Specifying the -d option will allow writes of invalid "
+"data,\n"
+" but still recalculate the CRC so we are forced to check and detect the\n"
+" invalid data appropriately.\n"
+"\n"
 msgstr ""
 
-#: .././db/freesp.c:255 .././db/check.c:4060 .././repair/scan.c:2142
+#: .././db/write.c:104
 #, c-format
-msgid "agf %d freelist blocks bad, skipping freelist scan\n"
+msgid "%s started in read only mode, writing disabled\n"
 msgstr ""
 
-#: .././db/freesp.c:427
-msgid "from"
+#: .././db/write.c:116
+#, c-format
+msgid "no handler function for type %s, write unsupported.\n"
 msgstr ""
 
-#: .././db/freesp.c:427
-msgid "to"
+#: .././db/write.c:130
+msgid "bad option for write command\n"
 msgstr ""
 
-#: .././db/freesp.c:427 .././repair/progress.c:26
-msgid "extents"
+#: .././db/write.c:136 .././db/fuzz.c:124
+msgid "Cannot specify both -c and -d options\n"
 msgstr ""
 
-#: .././db/freesp.c:427 .././repair/progress.c:18
-msgid "blocks"
+#: .././db/write.c:143 .././db/fuzz.c:131
+msgid "Cannot recalculate CRCs on this type of object\n"
 msgstr ""
 
-#: .././db/freesp.c:427
-msgid "pct"
+#: .././db/write.c:170
+msgid "Allowing write of corrupted data and bad CRC\n"
 msgstr ""
 
-#: .././db/fsmap.c:39
-#, c-format
-msgid ""
-"%llu: %u/%u len %u owner %lld offset %llu bmbt %d attrfork %d extflag %d\n"
+#: .././db/write.c:173 .././db/write.c:176
+msgid "Allowing write of corrupted data with good CRC\n"
 msgstr ""
 
-#: .././db/fsmap.c:86
+#: .././db/write.c:232 .././db/write.c:261 .././db/write.c:291
+#: .././db/write.c:324 .././db/write.c:360 .././db/write.c:409
+#: .././db/write.c:438
 #, c-format
-msgid "Error %d while reading AGF.\n"
+msgid "length (%d) too large for data block size (%d)"
 msgstr ""
 
-#: .././db/fsmap.c:93
-msgid "Not enough memory.\n"
+#: .././db/write.c:680
+msgid "usage: write fieldname value\n"
 msgstr ""
 
-#: .././db/fsmap.c:103
+#: .././db/write.c:686 .././db/fuzz.c:397
 #, c-format
-msgid "Error %d while querying fsmap btree.\n"
-msgstr ""
-
-#: .././db/fsmap.c:127
-msgid "Filesystem does not support reverse mapping btree.\n"
-msgstr ""
-
-#: .././db/fsmap.c:134
-msgid "Bad option for fsmap command.\n"
+msgid "unable to parse '%s'.\n"
 msgstr ""
 
-#: .././db/fsmap.c:142
+#: .././db/write.c:735
 #, c-format
-msgid "Bad fsmap start_fsb %s.\n"
+msgid "unable to convert value '%s'.\n"
 msgstr ""
 
-#: .././db/fsmap.c:150
-#, c-format
-msgid "Bad fsmap end_fsb %s.\n"
+#: .././db/write.c:759
+msgid "usage (in string mode): write \"string...\"\n"
 msgstr ""
 
-#: .././db/fsmap.c:162
-msgid "[start_fsb] [end_fsb]"
+#: .././db/write.c:801
+msgid "write: invalid subcommand\n"
 msgstr ""
 
-#: .././db/fsmap.c:163
-msgid "display reverse mapping(s)"
+#: .././db/write.c:806
+#, c-format
+msgid "write %s: invalid number of arguments\n"
 msgstr ""
 
-#: .././db/hash.c:30
-msgid "string"
+#: .././db/write.c:830
+msgid "usage: write (in data mode)\n"
 msgstr ""
 
-#: .././db/hash.c:31
-msgid "calculate hash value"
+#: .././db/agf.c:36
+msgid "set address to agf header"
 msgstr ""
 
-#: .././db/hash.c:37
+#: .././db/agf.c:100
 msgid ""
 "\n"
-" 'hash' prints out the calculated hash value for a string using the\n"
-"directory/attribute code hash function.\n"
+" set allocation group free block list\n"
 "\n"
-" Usage:  \"hash <string>\"\n"
+" Example:\n"
 "\n"
+" agf 2 - move location to AGF in 2nd filesystem allocation group\n"
+"\n"
+" Located in the second sector of each allocation group, the AGF\n"
+" contains the root of two different freespace btrees:\n"
+" The 'cnt' btree keeps track freespace indexed on section size.\n"
+" The 'bno' btree tracks sections of freespace indexed on block number.\n"
 msgstr ""
 
-#: .././db/help.c:30 .././db/io.c:49 .././libxcmd/help.c:93
-msgid "[command]"
-msgstr ""
-
-#: .././db/help.c:31 .././libxcmd/help.c:94
-msgid "help for one or all commands"
+#: .././db/agi.c:36
+msgid "set address to agi header"
 msgstr ""
 
-#: .././db/help.c:40 .././libxcmd/help.c:34
-#, c-format
+#: .././db/agi.c:69
 msgid ""
 "\n"
-"Use 'help commandname' for extended help.\n"
+" set allocation group inode btree\n"
+"\n"
+" Example:\n"
+"\n"
+" agi 3 (set location to 3rd allocation group inode btree and type to 'agi')\n"
+"\n"
+" Located in the 3rd 512 byte block of each allocation group,\n"
+" the agi inode btree tracks all used/free inodes in the allocation group.\n"
+" Inodes are allocated in 16k 'chunks', each btree entry tracks a 'chunk'.\n"
+"\n"
 msgstr ""
 
-#: .././db/help.c:89
-#, c-format
-msgid "(or %s) "
+#: .././db/addr.c:35
+msgid "[field-expression]"
 msgstr ""
 
-#: .././db/init.c:49
-#, c-format
-msgid "Usage: %s [-ifFrxV] [-p prog] [-l logdev] [-c cmd]... device\n"
+#: .././db/addr.c:36
+msgid "set current address"
 msgstr ""
 
-#: .././db/init.c:116
+#: .././db/addr.c:42
 msgid ""
 "\n"
-"fatal error -- couldn't initialize XFS library\n"
+" 'addr' uses the given field to set the filesystem address and type\n"
+"\n"
+" Examples:\n"
+"\n"
+" sb\n"
+" a rootino - set the type to inode and set position to the root inode\n"
+" a u.bmx[0].startblock (for inode with blockmap)\n"
+"\n"
 msgstr ""
 
-#: .././db/init.c:131
+#: .././db/addr.c:82
 #, c-format
-msgid "%s: %s is invalid (cannot read first 512 bytes)\n"
+msgid "no fields for type %s\n"
 msgstr ""
 
-#: .././db/init.c:143
-#, c-format
-msgid ""
-"%s: %s is not a valid XFS filesystem (unexpected SB magic number 0x%08x)\n"
+#: .././db/addr.c:94
+msgid "array not allowed for addr command\n"
 msgstr ""
 
-#: .././db/init.c:146
+#: .././db/addr.c:103
 #, c-format
-msgid "Use -F to force a read attempt.\n"
+msgid "no next type for field %s\n"
 msgstr ""
 
-#: .././db/init.c:155
+#: .././db/addr.c:110
 #, c-format
-msgid "%s: device %s unusable (not an XFS filesystem?)\n"
+msgid "no addr function for field %s (type %s)\n"
 msgstr ""
 
-#: .././db/init.c:170
-#, c-format
-msgid "%s: cannot init perag data (%d). Continuing anyway.\n"
+#: .././db/block.c:43 .././db/block.c:49
+msgid "filoff"
 msgstr ""
 
-#: .././db/input.c:43
-msgid "source-file"
+#: .././db/block.c:44
+msgid "set address to file offset (attr fork)"
 msgstr ""
 
-#: .././db/input.c:44
-msgid "get commands from source-file"
+#: .././db/block.c:46
+msgid "[d]"
 msgstr ""
 
-#: .././db/input.c:320
-#, c-format
-msgid "can't open %s\n"
+#: .././db/block.c:47
+msgid "set address to daddr value"
 msgstr ""
 
-#: .././db/logformat.c:89
-msgid "The log is dirty. Please mount to replay the log.\n"
+#: .././db/block.c:50
+msgid "set address to file offset (data fork)"
 msgstr ""
 
-#: .././db/logformat.c:121
-msgid ""
-"\n"
-" The 'logformat' command reformats (clears) the log to the specified log\n"
-" cycle and log stripe unit. If the log cycle is not specified, the log is\n"
-" reformatted to the current cycle. If the log stripe unit is not specified,\n"
-" the stripe unit from the filesystem superblock is used.\n"
-"\n"
+#: .././db/block.c:52
+msgid "[fsb]"
 msgstr ""
 
-#: .././db/logformat.c:137
-msgid "[-c cycle] [-s sunit]"
+#: .././db/block.c:53
+msgid "set address to fsblock value"
 msgstr ""
 
-#: .././db/logformat.c:138
-msgid "reformat the log"
+#: .././db/block.c:59
+msgid ""
+"\n"
+" Example:\n"
+"\n"
+" 'ablock 23' - sets the file position to the 23rd filesystem block in\n"
+" the inode's attribute fork.  The filesystem block size is specified in\n"
+" the superblock.\n"
+"\n"
 msgstr ""
 
-#: .././db/malloc.c:27
+#: .././db/block.c:82 .././db/block.c:177
 #, c-format
-msgid "%s: out of memory\n"
-msgstr ""
-
-#: .././db/output.c:30
-msgid "[stop|start <filename>]"
+msgid "bad block number %s\n"
 msgstr ""
 
-#: .././db/output.c:31
-msgid "start or stop logging to a file"
+#: .././db/block.c:90
+msgid "no attribute data for file\n"
 msgstr ""
 
-#: .././db/output.c:68
-#, c-format
-msgid "logging to %s\n"
+#: .././db/block.c:96
+msgid "file attr block is unmapped\n"
 msgstr ""
 
-#: .././db/output.c:70 .././db/output.c:77
-msgid "no log file\n"
+#: .././db/block.c:119
+msgid ""
+"\n"
+" Example:\n"
+"\n"
+" 'daddr 102' - sets position to the 102nd absolute disk block\n"
+" (512 byte block).\n"
 msgstr ""
 
-#: .././db/output.c:80
+#: .././db/block.c:135
 #, c-format
-msgid "already logging to %s\n"
+msgid "current daddr is %lld\n"
 msgstr ""
 
-#: .././db/output.c:84
+#: .././db/block.c:141
 #, c-format
-msgid "can't open %s for writing\n"
-msgstr ""
-
-#: .././db/output.c:90
-msgid "bad log command, ignored\n"
+msgid "bad daddr %s\n"
 msgstr ""
 
-#: .././db/quit.c:27
-msgid "exit xfs_db"
+#: .././db/block.c:153
+msgid ""
+"\n"
+" Example:\n"
+"\n"
+" 'dblock 23' - sets the file position to the 23rd filesystem block in\n"
+" the inode's data fork.  The filesystem block size is specified in the\n"
+" superblock.\n"
+"\n"
 msgstr ""
 
-#: .././db/write.c:41
-msgid "[-c] [field or value]..."
+#: .././db/block.c:185
+msgid "no type for file data\n"
 msgstr ""
 
-#: .././db/write.c:42
-msgid "write value to disk"
+#: .././db/block.c:192
+msgid "file data block is unmapped\n"
 msgstr ""
 
-#: .././db/write.c:58
+#: .././db/block.c:210
 msgid ""
 "\n"
-" The 'write' command takes on different personalities depending on the\n"
-" type of object being worked with.\n"
-"\n"
-" Write has 3 modes:\n"
-"  'struct mode' - is active anytime you're looking at a filesystem object\n"
-"                  which contains individual fields (ex: an inode).\n"
-"  'data mode'   - is active anytime you set a disk address directly or set\n"
-"                  the type to 'data'.\n"
-"  'string mode' - only used for writing symlink blocks.\n"
-"\n"
-" Examples:\n"
-"  Struct mode: 'write core.uid 23'          - set an inode uid field to 23.\n"
-"               'write fname \"hello\\000\"'    - write superblock fname.\n"
-"               (note: in struct mode strings are not null terminated)\n"
-"               'write fname #6669736800'    - write superblock fname with "
-"hex.\n"
-"               'write uuid 00112233-4455-6677-8899-aabbccddeeff'\n"
-"                                            - write superblock uuid.\n"
-"  Data mode:   'write fill 0xff' - fill the entire block with 0xff's\n"
-"               'write lshift 3' - shift the block 3 bytes to the left\n"
-"               'write sequence 1 5' - write a cycle of number [1-5] through\n"
-"                                      the entire block.\n"
-"  String mode: 'write \"This_is_a_filename\" - write null terminated "
-"string.\n"
-"\n"
-" In data mode type 'write' by itself for a list of specific commands.\n"
+" Example:\n"
 "\n"
-" Specifying the -c option will allow writes of invalid (corrupt) data with\n"
-" an invalid CRC. Specifying the -d option will allow writes of invalid "
-"data,\n"
-" but still recalculate the CRC so we are forced to check and detect the\n"
-" invalid data appropriately.\n"
+" 'fsblock 1023' - sets the file position to the 1023rd filesystem block.\n"
+" The filesystem block size is specified in the superblock and set during\n"
+" mkfs time.  Offset is absolute (not AG relative).\n"
 "\n"
 msgstr ""
 
-#: .././db/write.c:104
+#: .././db/block.c:229
 #, c-format
-msgid "%s started in read only mode, writing disabled\n"
+msgid "current fsblock is %lld\n"
 msgstr ""
 
-#: .././db/write.c:116
+#: .././db/block.c:235 .././db/block.c:241
 #, c-format
-msgid "no handler function for type %s, write unsupported.\n"
+msgid "bad fsblock %s\n"
 msgstr ""
 
-#: .././db/write.c:130
-msgid "bad option for write command\n"
+#: .././db/convert.c:171
+#, c-format
+msgid "bad argument count %d to convert, expected 3,5,7,9 arguments\n"
 msgstr ""
 
-#: .././db/write.c:136
-msgid "Cannot specify both -c and -d options\n"
+#: .././db/convert.c:176 .././db/convert.c:183
+#, c-format
+msgid "unknown conversion type %s\n"
 msgstr ""
 
-#: .././db/write.c:141
-msgid "Cannot recalculate CRCs on this type of object\n"
+#: .././db/convert.c:187
+msgid "result type same as argument\n"
 msgstr ""
 
-#: .././db/write.c:166
-msgid "Allowing write of corrupted data and bad CRC\n"
+#: .././db/convert.c:191
+#, c-format
+msgid "conflicting conversion type %s\n"
 msgstr ""
 
-#: .././db/write.c:169
-msgid "Allowing write of corrupted data with good CRC\n"
+#: .././db/convert.c:269
+#, c-format
+msgid "%s is not a number\n"
 msgstr ""
 
-#: .././db/write.c:225 .././db/write.c:254 .././db/write.c:284
-#: .././db/write.c:317 .././db/write.c:353 .././db/write.c:402
-#: .././db/write.c:431
+#: .././db/flist.c:149
 #, c-format
-msgid "length (%d) too large for data block size (%d)"
+msgid "field %s not found\n"
 msgstr ""
 
-#: .././db/write.c:673
-msgid "usage: write fieldname value\n"
+#: .././db/flist.c:159
+#, c-format
+msgid "no elements in %s\n"
 msgstr ""
 
-#: .././db/write.c:679
+#: .././db/flist.c:165
 #, c-format
-msgid "unable to parse '%s'.\n"
+msgid "indices %d-%d for field %s out of range %d-%d\n"
 msgstr ""
 
-#: .././db/write.c:728
+#: .././db/flist.c:173
 #, c-format
-msgid "unable to convert value '%s'.\n"
+msgid "index %d for field %s out of range %d-%d\n"
 msgstr ""
 
-#: .././db/write.c:752
-msgid "usage (in string mode): write \"string...\"\n"
+#: .././db/flist.c:187
+#, c-format
+msgid "field %s is not an array\n"
 msgstr ""
 
-#: .././db/write.c:794
-msgid "write: invalid subcommand\n"
+#: .././db/flist.c:200
+#, c-format
+msgid "field %s has no subfields\n"
 msgstr ""
 
-#: .././db/write.c:799
+#: .././db/flist.c:220
 #, c-format
-msgid "write %s: invalid number of arguments\n"
+msgid "fl@%p:\n"
 msgstr ""
 
-#: .././db/write.c:823
-msgid "usage: write (in data mode)\n"
-msgstr ""
-
-#: .././db/agf.c:36
-msgid "set address to agf header"
-msgstr ""
-
-#: .././db/agf.c:100
-msgid ""
-"\n"
-" set allocation group free block list\n"
-"\n"
-" Example:\n"
-"\n"
-" agf 2 - move location to AGF in 2nd filesystem allocation group\n"
-"\n"
-" Located in the second sector of each allocation group, the AGF\n"
-" contains the root of two different freespace btrees:\n"
-" The 'cnt' btree keeps track freespace indexed on section size.\n"
-" The 'bno' btree tracks sections of freespace indexed on block number.\n"
-msgstr ""
-
-#: .././db/check.c:378
-msgid "free block usage information"
-msgstr ""
-
-#: .././db/check.c:381
-msgid "[-s|-v] [-n] [-t] [-b bno]... [-i ino] ..."
-msgstr ""
-
-#: .././db/check.c:382
-msgid "get block usage and check consistency"
-msgstr ""
-
-#: .././db/check.c:385
-msgid "[-n count] [-x minlen] [-y maxlen] [-s seed] [-0123] [-t type] ..."
-msgstr ""
-
-#: .././db/check.c:386
-msgid "trash randomly selected block(s)"
-msgstr ""
-
-#: .././db/check.c:389
-msgid "[-n] [-c blockcount]"
+#: .././db/flist.c:221
+#, c-format
+msgid "\tname=%s, fld=%p, child=%p, sibling=%p\n"
 msgstr ""
 
-#: .././db/check.c:390
-msgid "print usage for current block(s)"
+#: .././db/flist.c:223
+#, c-format
+msgid "\tlow=%d, high=%d, flags=%d (%s%s), offset=%d\n"
 msgstr ""
 
-#: .././db/check.c:393
-msgid "[-s] [-i ino] ..."
+#: .././db/flist.c:225
+msgid "oklow "
 msgstr ""
 
-#: .././db/check.c:394
-msgid "print inode-name pairs"
+#: .././db/flist.c:226
+msgid "okhigh"
 msgstr ""
 
-#: .././db/check.c:414
+#: .././db/flist.c:227
 #, c-format
-msgid "-i %lld bad inode number\n"
+msgid "\tfld->name=%s, fld->ftyp=%d (%s)\n"
 msgstr ""
 
-#: .././db/check.c:426
+#: .././db/flist.c:230
 #, c-format
-msgid "inode %lld add link, now %u\n"
+msgid "\tfld->flags=%d (%s%s%s%s%s)\n"
 msgstr ""
 
-#: .././db/check.c:453
+#: .././db/flist.c:322
 #, c-format
-msgid "inode %lld parent %lld\n"
-msgstr ""
-
-#: .././db/check.c:766
-msgid "block usage information not allocated\n"
-msgstr ""
-
-#: .././db/check.c:804
-msgid "already have block usage information\n"
-msgstr ""
-
-#: .././db/check.c:821 .././db/check.c:922
-msgid "WARNING: this may be a newer XFS filesystem.\n"
+msgid "bad syntax in field name %s\n"
 msgstr ""
 
-#: .././db/check.c:857
+#: .././db/flist.c:378
 #, c-format
-msgid "sb_icount %lld, counted %lld\n"
+msgid "missing closing quote %s\n"
 msgstr ""
 
-#: .././db/check.c:863
+#: .././db/flist.c:395
 #, c-format
-msgid "sb_ifree %lld, counted %lld\n"
+msgid "bad character in field %s\n"
 msgstr ""
 
-#: .././db/check.c:869
+#: .././db/malloc.c:27
 #, c-format
-msgid "sb_fdblocks %lld, counted %lld\n"
+msgid "%s: out of memory\n"
 msgstr ""
 
-#: .././db/check.c:875
+#: .././db/fsmap.c:39
 #, c-format
-msgid "sb_fdblocks %lld, aggregate AGF count %lld\n"
+msgid ""
+"%llu: %u/%u len %u owner %lld offset %llu bmbt %d attrfork %d extflag %d\n"
 msgstr ""
 
-#: .././db/check.c:881
+#: .././db/fsmap.c:86
 #, c-format
-msgid "sb_frextents %lld, counted %lld\n"
+msgid "Error %d while reading AGF.\n"
 msgstr ""
 
-#: .././db/check.c:888
-#, c-format
-msgid "sb_features2 (0x%x) not same as sb_bad_features2 (0x%x)\n"
+#: .././db/fsmap.c:93
+msgid "Not enough memory.\n"
 msgstr ""
 
-#: .././db/check.c:897
+#: .././db/fsmap.c:103
 #, c-format
-msgid "sb versionnum missing attr bit %x\n"
+msgid "Error %d while querying fsmap btree.\n"
 msgstr ""
 
-#: .././db/check.c:904
-#, c-format
-msgid "sb versionnum missing quota bit %x\n"
+#: .././db/fsmap.c:127
+msgid "Filesystem does not support reverse mapping btree.\n"
 msgstr ""
 
-#: .././db/check.c:911
-#, c-format
-msgid "sb versionnum extra align bit %x\n"
+#: .././db/fsmap.c:134
+msgid "Bad option for fsmap command.\n"
 msgstr ""
 
-#: .././db/check.c:950
-msgid "zeroed"
+#: .././db/fsmap.c:142
+#, c-format
+msgid "Bad fsmap start_fsb %s.\n"
 msgstr ""
 
-#: .././db/check.c:950
-msgid "set"
+#: .././db/fsmap.c:150
+#, c-format
+msgid "Bad fsmap end_fsb %s.\n"
 msgstr ""
 
-#: .././db/check.c:950
-msgid "flipped"
+#: .././db/fsmap.c:162
+msgid "[start_fsb] [end_fsb]"
 msgstr ""
 
-#: .././db/check.c:950
-msgid "randomized"
+#: .././db/fsmap.c:163
+msgid "display reverse mapping(s)"
 msgstr ""
 
-#: .././db/check.c:958
+#: .././db/inode.c:419
 #, c-format
-msgid "zero-length block %u/%u buffer to trash??\n"
+msgid "bad value for inode number %s\n"
 msgstr ""
 
-#: .././db/check.c:977
+#: .././db/inode.c:426
 #, c-format
-msgid "can't read block %u/%u for trashing\n"
+msgid "current inode number is %lld\n"
 msgstr ""
 
-#: .././db/check.c:1006
+#: .././db/inode.c:660
 #, c-format
-msgid "blocktrash: %u/%u %s block %d bit%s starting %d:%d %s\n"
+msgid "bad inode number %lld\n"
 msgstr ""
 
-#: .././db/check.c:1085
+#: .././db/inode.c:707
 #, c-format
-msgid "bad blocktrash count %s\n"
+msgid "Metadata CRC error detected for ino %lld\n"
 msgstr ""
 
-#: .././db/check.c:1097
-#, c-format
-msgid "bad blocktrash offset %s\n"
+#: .././db/input.c:43
+msgid "source-file"
 msgstr ""
 
-#: .././db/check.c:1114
-#, c-format
-msgid "bad blocktrash type %s\n"
+#: .././db/input.c:44
+msgid "get commands from source-file"
 msgstr ""
 
-#: .././db/check.c:1123
+#: .././db/input.c:331
 #, c-format
-msgid "bad blocktrash min %s\n"
+msgid "can't open %s\n"
 msgstr ""
 
-#: .././db/check.c:1131
-#, c-format
-msgid "bad blocktrash max %s\n"
+#: .././db/io.c:49
+msgid "pop location from the stack"
 msgstr ""
 
-#: .././db/check.c:1139
-msgid "bad option for blocktrash command\n"
+#: .././db/io.c:51 .././db/help.c:30 .././libxcmd/help.c:93
+msgid "[command]"
 msgstr ""
 
-#: .././db/check.c:1144 .././db/check.c:1235
-msgid "must run blockget first\n"
+#: .././db/io.c:52
+msgid "push location to the stack"
 msgstr ""
 
-#: .././db/check.c:1148
-msgid "nothing on stack\n"
+#: .././db/io.c:55
+msgid "view the location stack"
 msgstr ""
 
-#: .././db/check.c:1152
-msgid "bad min/max for blocktrash command\n"
+#: .././db/io.c:58
+msgid "move forward to next entry in the position ring"
 msgstr ""
 
-#: .././db/check.c:1170
-#, c-format
-msgid "blocktrash: seed %u\n"
+#: .././db/io.c:61
+msgid "move to the previous location in the position ring"
 msgstr ""
 
-#: .././db/check.c:1186
-msgid "blocktrash: no matching blocks\n"
+#: .././db/io.c:64
+msgid "show position ring or move to a specific entry"
 msgstr ""
 
-#: .././db/check.c:1250
+#: .././db/io.c:94
 #, c-format
-msgid "bad blockuse count %s\n"
+msgid "can't set block offset to %d\n"
 msgstr ""
 
-#: .././db/check.c:1256 .././db/check.c:1980
-msgid "must run blockget -n first\n"
+#: .././db/io.c:107
+msgid "can't pop anything from I/O stack\n"
 msgstr ""
 
-#: .././db/check.c:1262
-msgid "bad option for blockuse command\n"
+#: .././db/io.c:141
+msgid ""
+"\n"
+" Changes the address and data type to the first entry on the stack.\n"
+"\n"
 msgstr ""
 
-#: .././db/check.c:1269
+#: .././db/io.c:155
 #, c-format
-msgid "block %llu (%u/%u) type %s"
+msgid "\tbyte offset %lld, length %d\n"
 msgstr ""
 
-#: .././db/check.c:1273
+#: .././db/io.c:156
 #, c-format
-msgid " inode %lld"
+msgid "\tbuffer block %lld (fsbno %lld), %d bb%s\n"
 msgstr ""
 
-#: .././db/check.c:1317
+#: .././db/io.c:160 .././db/io.c:547
 #, c-format
-msgid "block %u/%u expected type %s got %s\n"
+msgid "\tblock map"
 msgstr ""
 
-#: .././db/check.c:1350
+#: .././db/io.c:166
 #, c-format
-msgid "blocks %u/%u..%u claimed by inode %lld\n"
+msgid "\tinode %lld, dir inode %lld, type %s\n"
 msgstr ""
 
-#: .././db/check.c:1358
+#: .././db/io.c:167 .././growfs/xfs_growfs.c:88 .././logprint/log_misc.c:107
+#: .././mkfs/xfs_mkfs.c:2392
 #, c-format
-msgid "block %u/%u claimed by inode %lld, previous inum %lld\n"
+msgid "none"
 msgstr ""
 
-#: .././db/check.c:1387
-#, c-format
-msgid "link count mismatch for inode %lld (name %s), nlink %d, counted %d\n"
+#: .././db/io.c:177
+msgid "no entries in location ring.\n"
 msgstr ""
 
-#: .././db/check.c:1395
-#, c-format
-msgid "disconnected inode %lld, nlink %d\n"
+#: .././db/io.c:181
+msgid "      type    bblock  bblen    fsbno     inode\n"
 msgstr ""
 
-#: .././db/check.c:1399
+#: .././db/io.c:248
 #, c-format
-msgid "allocated inode %lld has 0 link count\n"
+msgid "no such command %s\n"
 msgstr ""
 
-#: .././db/check.c:1409
+#: .././db/io.c:252
 #, c-format
-msgid "inode %lld name %s\n"
+msgid "no push form allowed for %s\n"
 msgstr ""
 
-#: .././db/check.c:1443 .././db/check.c:1458
-#, c-format
-msgid "block %u/%u out of range\n"
+#: .././db/io.c:269
+msgid ""
+"\n"
+" Allows you to push the current address and data type on the stack for\n"
+" later return.  'push' also accepts an additional command to execute after\n"
+" storing the current address (ex: 'push a rootino' from the superblock).\n"
+"\n"
 msgstr ""
 
-#: .././db/check.c:1446 .././db/check.c:1461
-#, c-format
-msgid "blocks %u/%u..%u out of range\n"
+#: .././db/io.c:285 .././db/io.c:325
+msgid "ring is empty\n"
 msgstr ""
 
-#: .././db/check.c:1484
-#, c-format
-msgid "rtblock %llu expected type %s got %s\n"
+#: .././db/io.c:289
+msgid "no further entries\n"
 msgstr ""
 
-#: .././db/check.c:1504
-#, c-format
-msgid "rtblocks %llu..%llu claimed by inode %lld\n"
-msgstr ""
+#: .././db/io.c:308
+msgid ""
+"\n"
+" The 'forward' ('f') command moves to the next location in the position\n"
+" ring, updating the current position and data type.  If the current "
+"location\n"
+" is the top entry in the ring, then the 'forward' command will have\n"
+" no effect.\n"
+"\n"
+msgstr ""
 
-#: .././db/check.c:1513
-#, c-format
-msgid "rtblock %llu claimed by inode %lld, previous inum %lld\n"
+#: .././db/io.c:329
+msgid "no previous entries\n"
 msgstr ""
 
-#: .././db/check.c:1531
-#, c-format
-msgid "root inode %lld is missing\n"
+#: .././db/io.c:348
+msgid ""
+"\n"
+" The 'back' ('b') command moves to the previous location in the position\n"
+" ring, updating the current position and data type.  If the current "
+"location\n"
+" is the last entry in the ring, then the 'back' command will have no "
+"effect.\n"
+"\n"
 msgstr ""
 
-#: .././db/check.c:1536
+#: .././db/io.c:371
 #, c-format
-msgid "root inode %lld is not a directory\n"
+msgid "invalid entry: %d\n"
 msgstr ""
 
-#: .././db/check.c:1552
+#: .././db/io.c:390
 #, c-format
-msgid "rtblock %llu out of range\n"
+msgid ""
+"\n"
+" The position ring automatically keeps track of each disk location and\n"
+" structure type for each change of position you make during your xfs_db\n"
+" session.  The last %d most recent entries are kept in the ring.\n"
+"\n"
+" To display the current list of ring entries type 'ring' by itself on\n"
+" the command line.  The entry highlighted by an asterisk ('*') is the\n"
+" current entry.\n"
+"\n"
+" To move to another entry in the ring type 'ring <num>' where <num> is\n"
+" your desired entry from the ring position list.\n"
+"\n"
+" You may also use the 'forward' ('f') or 'back' ('b') commands to move\n"
+" to the previous or next entry in the ring, respectively.\n"
+"\n"
+" Note: Unlike the 'stack', 'push' and 'pop' commands, the ring tracks your\n"
+" location implicitly.  Use the 'push' and 'pop' commands if you wish to\n"
+" store a specific location explicitly for later return.\n"
+"\n"
 msgstr ""
 
-#: .././db/check.c:1596
+#: .././db/io.c:443 .././db/io.c:459
 #, c-format
-msgid "blocks %u/%u..%u claimed by block %u/%u\n"
+msgid "write error: %s\n"
 msgstr ""
 
-#: .././db/check.c:1610
+#: .././db/io.c:449 .././db/io.c:465
 #, c-format
-msgid "setting block %u/%u to %s\n"
+msgid "read error: %s\n"
 msgstr ""
 
-#: .././db/check.c:1633
-#, c-format
-msgid "setting rtblock %llu to %s\n"
+#: .././db/io.c:488
+msgid "nothing to write\n"
 msgstr ""
 
-#: .././db/check.c:1654 .././repair/rt.c:151
-#, c-format
-msgid "rt summary mismatch, size %d block %llu, file: %d, computed: %d\n"
+#: .././db/io.c:533
+msgid "set_cur no stack element to set\n"
 msgstr ""
 
-#: .././db/check.c:1679
+#: .././db/io.c:546
 #, c-format
-msgid "block %u/%u type %s not expected\n"
+msgid "xfs_db got a bbmap for %lld\n"
 msgstr ""
 
-#: .././db/check.c:1700
-#, c-format
-msgid "rtblock %llu type %s not expected\n"
+#: .././db/io.c:646
+msgid ""
+"\n"
+" The stack is used to explicitly store your location and data type\n"
+" for later return.  The 'push' operation stores the current address\n"
+" and type on the stack, the 'pop' operation returns you to the\n"
+" position and datatype of the top entry on the stack.\n"
+"\n"
+" The 'stack' allows explicit location saves, see 'ring' for implicit\n"
+" position tracking.\n"
+"\n"
 msgstr ""
 
-#: .././db/check.c:1737
-#, c-format
-msgid "dir ino %lld missing leaf entry for %x/%x\n"
+#: .././db/check.c:378
+msgid "free block usage information"
 msgstr ""
 
-#: .././db/check.c:1856
-#, c-format
-msgid "bad superblock magic number %x, giving up\n"
+#: .././db/check.c:381
+msgid "[-s|-v] [-n] [-t] [-b bno]... [-i ino] ..."
 msgstr ""
 
-#: .././db/check.c:1910
-msgid "bad option for blockget command\n"
+#: .././db/check.c:382
+msgid "get block usage and check consistency"
 msgstr ""
 
-#: .././db/check.c:1997
-#, c-format
-msgid "bad option -%c for ncheck command\n"
+#: .././db/check.c:385
+msgid "[-n count] [-x minlen] [-y maxlen] [-s seed] [-0123] [-t type] ..."
 msgstr ""
 
-#: .././db/check.c:2071
-#, c-format
-msgid "block 0 for directory inode %lld is missing\n"
+#: .././db/check.c:386
+msgid "trash randomly selected block(s)"
 msgstr ""
 
-#: .././db/check.c:2091
-#, c-format
-msgid "can't read block 0 for directory inode %lld\n"
+#: .././db/check.c:389
+msgid "[-n] [-c blockcount]"
 msgstr ""
 
-#: .././db/check.c:2137
-#, c-format
-msgid "inode %lld extent [%lld,%lld,%lld,%d]\n"
+#: .././db/check.c:390
+msgid "print usage for current block(s)"
 msgstr ""
 
-#: .././db/check.c:2140
-#, c-format
-msgid "bmap rec out of order, inode %lld entry %d\n"
+#: .././db/check.c:393
+msgid "[-s] [-i ino] ..."
 msgstr ""
 
-#: .././db/check.c:2146
-#, c-format
-msgid "inode %lld bad rt block number %lld, offset %lld\n"
+#: .././db/check.c:394
+msgid "print inode-name pairs"
 msgstr ""
 
-#: .././db/check.c:2156 .././db/check.c:2162
+#: .././db/check.c:414
 #, c-format
-msgid "inode %lld bad block number %lld [%d,%d], offset %lld\n"
+msgid "-i %lld bad inode number\n"
 msgstr ""
 
-#: .././db/check.c:2180 .././db/check.c:2194
+#: .././db/check.c:426
 #, c-format
-msgid "inode %lld block %lld at offset %lld\n"
+msgid "inode %lld add link, now %u\n"
 msgstr ""
 
-#: .././db/check.c:2221
+#: .././db/check.c:453
 #, c-format
-msgid "level for ino %lld %s fork bmap root too large (%u)\n"
+msgid "inode %lld parent %lld\n"
 msgstr ""
 
-#: .././db/check.c:2233
-#, c-format
-msgid "numrecs for ino %lld %s fork bmap root too large (%u)\n"
+#: .././db/check.c:766
+msgid "block usage information not allocated\n"
 msgstr ""
 
-#: .././db/check.c:2260
-#, c-format
-msgid "extent count for ino %lld %s fork too low (%d) for file format\n"
+#: .././db/check.c:804
+msgid "already have block usage information\n"
 msgstr ""
 
-#: .././db/check.c:2312 .././db/check.c:3338
-#, c-format
-msgid "bad directory data magic # %#x for dir ino %lld block %d\n"
+#: .././db/check.c:821 .././db/check.c:922
+msgid "WARNING: this may be a newer XFS filesystem.\n"
 msgstr ""
 
-#: .././db/check.c:2330
+#: .././db/check.c:857
 #, c-format
-msgid "bad block directory tail for dir ino %lld\n"
+msgid "sb_icount %lld, counted %lld\n"
 msgstr ""
 
-#: .././db/check.c:2375
+#: .././db/check.c:863
 #, c-format
-msgid "dir %lld block %d bad free entry at %d\n"
+msgid "sb_ifree %lld, counted %lld\n"
 msgstr ""
 
-#: .././db/check.c:2399
+#: .././db/check.c:869
 #, c-format
-msgid "dir %lld block %d zero length entry at %d\n"
+msgid "sb_fdblocks %lld, counted %lld\n"
 msgstr ""
 
-#: .././db/check.c:2408
+#: .././db/check.c:875
 #, c-format
-msgid "dir %lld block %d bad entry at %d\n"
+msgid "sb_fdblocks %lld, aggregate AGF count %lld\n"
 msgstr ""
 
-#: .././db/check.c:2426
+#: .././db/check.c:881
 #, c-format
-msgid "dir %lld block %d entry %*.*s %lld\n"
+msgid "sb_frextents %lld, counted %lld\n"
 msgstr ""
 
-#: .././db/check.c:2433
+#: .././db/check.c:888
 #, c-format
-msgid "dir %lld block %d entry %*.*s bad inode number %lld\n"
+msgid "sb_features2 (0x%x) not same as sb_bad_features2 (0x%x)\n"
 msgstr ""
 
-#: .././db/check.c:2443
+#: .././db/check.c:897
 #, c-format
-msgid "multiple .. entries in dir %lld (%lld, %lld)\n"
+msgid "sb versionnum missing attr bit %x\n"
 msgstr ""
 
-#: .././db/check.c:2460
+#: .././db/check.c:904
 #, c-format
-msgid "dir %lld entry . inode number mismatch (%lld)\n"
+msgid "sb versionnum missing quota bit %x\n"
 msgstr ""
 
-#: .././db/check.c:2474
+#: .././db/check.c:911
 #, c-format
-msgid "dir %lld block %d bad count %u\n"
+msgid "sb versionnum extra align bit %x\n"
 msgstr ""
 
-#: .././db/check.c:2485 .././db/check.c:3352
-#, c-format
-msgid "dir %lld block %d extra leaf entry %x %x\n"
+#: .././db/check.c:950
+msgid "zeroed"
 msgstr ""
 
-#: .././db/check.c:2497
-#, c-format
-msgid "dir %lld block %d bad bestfree data\n"
+#: .././db/check.c:950
+msgid "set"
 msgstr ""
 
-#: .././db/check.c:2505
-#, c-format
-msgid "dir %lld block %d bad block tail count %d (stale %d)\n"
+#: .././db/check.c:950
+msgid "flipped"
 msgstr ""
 
-#: .././db/check.c:2515
-#, c-format
-msgid "dir %lld block %d bad stale tail count %d\n"
+#: .././db/check.c:950
+msgid "randomized"
 msgstr ""
 
-#: .././db/check.c:2521
+#: .././db/check.c:958
 #, c-format
-msgid "dir %lld block %d consecutive free entries\n"
+msgid "zero-length block %u/%u buffer to trash??\n"
 msgstr ""
 
-#: .././db/check.c:2527
+#: .././db/check.c:977
 #, c-format
-msgid "dir %lld block %d entry/unused tag mismatch\n"
+msgid "can't read block %u/%u for trashing\n"
 msgstr ""
 
-#: .././db/check.c:2576
+#: .././db/check.c:1006
 #, c-format
-msgid "no . entry for directory %lld\n"
+msgid "blocktrash: %u/%u %s block %d bit%s starting %d:%d %s\n"
 msgstr ""
 
-#: .././db/check.c:2581
+#: .././db/check.c:1085
 #, c-format
-msgid "no .. entry for directory %lld\n"
+msgid "bad blocktrash count %s\n"
 msgstr ""
 
-#: .././db/check.c:2585
+#: .././db/check.c:1097
 #, c-format
-msgid ". and .. same for non-root directory %lld\n"
+msgid "bad blocktrash offset %s\n"
 msgstr ""
 
-#: .././db/check.c:2590
+#: .././db/check.c:1114
 #, c-format
-msgid "root directory %lld has .. %lld\n"
+msgid "bad blocktrash type %s\n"
 msgstr ""
 
-#: .././db/check.c:2623
+#: .././db/check.c:1123
 #, c-format
-msgid "bad size (%lld) or format (%d) for directory inode %lld\n"
+msgid "bad blocktrash min %s\n"
 msgstr ""
 
-#: .././db/check.c:2651
+#: .././db/check.c:1131
 #, c-format
-msgid "bad number of extents %d for inode %lld\n"
+msgid "bad blocktrash max %s\n"
 msgstr ""
 
-#: .././db/check.c:2723
-#, c-format
-msgid "bad magic number %#x for inode %lld\n"
+#: .././db/check.c:1139
+msgid "bad option for blocktrash command\n"
 msgstr ""
 
-#: .././db/check.c:2730
-#, c-format
-msgid "bad version number %#x for inode %lld\n"
+#: .././db/check.c:1144 .././db/check.c:1235
+msgid "must run blockget first\n"
 msgstr ""
 
-#: .././db/check.c:2738
-#, c-format
-msgid "bad nblocks %lld for free inode %lld\n"
+#: .././db/check.c:1148
+msgid "nothing on stack\n"
 msgstr ""
 
-#: .././db/check.c:2745
-#, c-format
-msgid "bad nlink %d for free inode %lld\n"
+#: .././db/check.c:1152
+msgid "bad min/max for blocktrash command\n"
 msgstr ""
 
-#: .././db/check.c:2751
+#: .././db/check.c:1170
 #, c-format
-msgid "bad mode %#o for free inode %lld\n"
+msgid "blocktrash: seed %u\n"
 msgstr ""
 
-#: .././db/check.c:2760
-#, c-format
-msgid "bad next unlinked %#x for inode %lld\n"
+#: .././db/check.c:1186
+msgid "blocktrash: no matching blocks\n"
 msgstr ""
 
-#: .././db/check.c:2771
+#: .././db/check.c:1250
 #, c-format
-msgid "bad format %d for inode %lld type %#o\n"
+msgid "bad blockuse count %s\n"
 msgstr ""
 
-#: .././db/check.c:2779
-#, c-format
-msgid "bad fork offset %d for inode %lld\n"
+#: .././db/check.c:1256 .././db/check.c:1980
+msgid "must run blockget -n first\n"
 msgstr ""
 
-#: .././db/check.c:2786
-#, c-format
-msgid "bad attribute format %d for inode %lld\n"
+#: .././db/check.c:1262
+msgid "bad option for blockuse command\n"
 msgstr ""
 
-#: .././db/check.c:2792
+#: .././db/check.c:1269
 #, c-format
-msgid ""
-"inode %lld mode %#o fmt %s afmt %s nex %d anex %d nblk %lld sz %lld%s%s%s%s%s"
-"%s%s\n"
+msgid "block %llu (%u/%u) type %s"
 msgstr ""
 
-#: .././db/check.c:2911
+#: .././db/check.c:1273
 #, c-format
-msgid "bad nblocks %lld for inode %lld, counted %lld\n"
+msgid " inode %lld"
 msgstr ""
 
-#: .././db/check.c:2918
+#: .././db/check.c:1317
 #, c-format
-msgid "bad nextents %d for inode %lld, counted %d\n"
+msgid "block %u/%u expected type %s got %s\n"
 msgstr ""
 
-#: .././db/check.c:2924
+#: .././db/check.c:1350
 #, c-format
-msgid "bad anextents %d for inode %lld, counted %d\n"
+msgid "blocks %u/%u..%u claimed by inode %lld\n"
 msgstr ""
 
-#: .././db/check.c:2976
+#: .././db/check.c:1358
 #, c-format
-msgid "local inode %lld data is too large (size %lld)\n"
+msgid "block %u/%u claimed by inode %lld, previous inum %lld\n"
 msgstr ""
 
-#: .././db/check.c:2985
+#: .././db/check.c:1387
 #, c-format
-msgid "local inode %lld attr is too large (size %d)\n"
+msgid "link count mismatch for inode %lld (name %s), nlink %d, counted %d\n"
 msgstr ""
 
-#: .././db/check.c:3034
+#: .././db/check.c:1395
 #, c-format
-msgid "dir inode %lld block %u=%llu\n"
+msgid "disconnected inode %lld, nlink %d\n"
 msgstr ""
 
-#: .././db/check.c:3046
+#: .././db/check.c:1399
 #, c-format
-msgid "can't read block %u for directory inode %lld\n"
+msgid "allocated inode %lld has 0 link count\n"
 msgstr ""
 
-#: .././db/check.c:3060
+#: .././db/check.c:1409
 #, c-format
-msgid "multiple .. entries in dir %lld\n"
+msgid "inode %lld name %s\n"
 msgstr ""
 
-#: .././db/check.c:3082
+#: .././db/check.c:1443 .././db/check.c:1458
 #, c-format
-msgid "missing free index for data block %d in dir ino %lld\n"
+msgid "block %u/%u out of range\n"
 msgstr ""
 
-#: .././db/check.c:3110 .././db/check.c:3188
+#: .././db/check.c:1446 .././db/check.c:1461
 #, c-format
-msgid "bad free block firstdb %d for dir ino %lld block %d\n"
+msgid "blocks %u/%u..%u out of range\n"
 msgstr ""
 
-#: .././db/check.c:3121 .././db/check.c:3201
+#: .././db/check.c:1484
 #, c-format
-msgid "bad free block nvalid/nused %d/%d for dir ino %lld block %d\n"
+msgid "rtblock %llu expected type %s got %s\n"
 msgstr ""
 
-#: .././db/check.c:3135 .././db/check.c:3215
+#: .././db/check.c:1504
 #, c-format
-msgid "bad free block ent %d is %d should be %d for dir ino %lld block %d\n"
+msgid "rtblocks %llu..%llu claimed by inode %lld\n"
 msgstr ""
 
-#: .././db/check.c:3149 .././db/check.c:3229
+#: .././db/check.c:1513
 #, c-format
-msgid "bad free block nused %d should be %d for dir ino %lld block %d\n"
+msgid "rtblock %llu claimed by inode %lld, previous inum %lld\n"
 msgstr ""
 
-#: .././db/check.c:3174
+#: .././db/check.c:1531
 #, c-format
-msgid "bad free block magic # %#x for dir ino %lld block %d\n"
+msgid "root inode %lld is missing\n"
 msgstr ""
 
-#: .././db/check.c:3283
+#: .././db/check.c:1536
 #, c-format
-msgid "bad leaf block forw/back pointers %d/%d for dir ino %lld block %d\n"
+msgid "root inode %lld is not a directory\n"
 msgstr ""
 
-#: .././db/check.c:3292
+#: .././db/check.c:1552
 #, c-format
-msgid "single leaf block for dir ino %lld block %d should be at block %d\n"
+msgid "rtblock %llu out of range\n"
 msgstr ""
 
-#: .././db/check.c:3304
+#: .././db/check.c:1596
 #, c-format
-msgid "bestfree %d for dir ino %lld block %d doesn't match table value %d\n"
+msgid "blocks %u/%u..%u claimed by block %u/%u\n"
 msgstr ""
 
-#: .././db/check.c:3329
+#: .././db/check.c:1610
 #, c-format
-msgid "bad node block level %d for dir ino %lld block %d\n"
+msgid "setting block %u/%u to %s\n"
 msgstr ""
 
-#: .././db/check.c:3361
+#: .././db/check.c:1633
 #, c-format
-msgid "dir3 %lld block %d stale mismatch %d/%d\n"
+msgid "setting rtblock %llu to %s\n"
 msgstr ""
 
-#: .././db/check.c:3368
+#: .././db/check.c:1654 .././repair/rt.c:151
 #, c-format
-msgid "dir %lld block %d stale mismatch %d/%d\n"
+msgid "rt summary mismatch, size %d block %llu, file: %d, computed: %d\n"
 msgstr ""
 
-#: .././db/check.c:3424
+#: .././db/check.c:1679
 #, c-format
-msgid "can't read block %lld for %s quota inode (fsblock %lld)\n"
+msgid "block %u/%u type %s not expected\n"
 msgstr ""
 
-#: .././db/check.c:3434
+#: .././db/check.c:1700
 #, c-format
-msgid "%s dqblk %lld entry %d id %u bc %lld ic %lld rc %lld\n"
+msgid "rtblock %llu type %s not expected\n"
 msgstr ""
 
-#: .././db/check.c:3442
+#: .././db/check.c:1737
 #, c-format
-msgid "bad magic number %#x for %s dqblk %lld entry %d id %u\n"
+msgid "dir ino %lld missing leaf entry for %x/%x\n"
 msgstr ""
 
-#: .././db/check.c:3451
+#: .././db/check.c:1856
 #, c-format
-msgid "bad version number %#x for %s dqblk %lld entry %d id %u\n"
+msgid "bad superblock magic number %x, giving up\n"
 msgstr ""
 
-#: .././db/check.c:3461
-#, c-format
-msgid "bad flags %#x for %s dqblk %lld entry %d id %u\n"
+#: .././db/check.c:1910
+msgid "bad option for blockget command\n"
 msgstr ""
 
-#: .././db/check.c:3470
+#: .././db/check.c:1997
 #, c-format
-msgid "bad id %u for %s dqblk %lld entry %d id %u\n"
+msgid "bad option -%c for ncheck command\n"
 msgstr ""
 
-#: .././db/check.c:3516
+#: .././db/check.c:2071
 #, c-format
-msgid "block %lld for rtbitmap inode is missing\n"
+msgid "block 0 for directory inode %lld is missing\n"
 msgstr ""
 
-#: .././db/check.c:3527
+#: .././db/check.c:2091
 #, c-format
-msgid "can't read block %lld for rtbitmap inode\n"
+msgid "can't read block 0 for directory inode %lld\n"
 msgstr ""
 
-#: .././db/check.c:3583
+#: .././db/check.c:2137
 #, c-format
-msgid "block %lld for rtsummary inode is missing\n"
+msgid "inode %lld extent [%lld,%lld,%lld,%d]\n"
 msgstr ""
 
-#: .././db/check.c:3594
+#: .././db/check.c:2140
 #, c-format
-msgid "can't read block %lld for rtsummary inode\n"
+msgid "bmap rec out of order, inode %lld entry %d\n"
 msgstr ""
 
-#: .././db/check.c:3627
+#: .././db/check.c:2146
 #, c-format
-msgid "dir %lld entry . %lld\n"
+msgid "inode %lld bad rt block number %lld, offset %lld\n"
 msgstr ""
 
-#: .././db/check.c:3635
+#: .././db/check.c:2156 .././db/check.c:2162
 #, c-format
-msgid "dir %llu bad size in entry at %d\n"
+msgid "inode %lld bad block number %lld [%d,%d], offset %lld\n"
 msgstr ""
 
-#: .././db/check.c:3647
+#: .././db/check.c:2180 .././db/check.c:2194
 #, c-format
-msgid "dir %lld entry %*.*s bad inode number %lld\n"
+msgid "inode %lld block %lld at offset %lld\n"
 msgstr ""
 
-#: .././db/check.c:3659
+#: .././db/check.c:2221
 #, c-format
-msgid "dir %lld entry %*.*s offset %d %lld\n"
+msgid "level for ino %lld %s fork bmap root too large (%u)\n"
 msgstr ""
 
-#: .././db/check.c:3664
+#: .././db/check.c:2233
 #, c-format
-msgid "dir %lld entry %*.*s bad offset %d\n"
+msgid "numrecs for ino %lld %s fork bmap root too large (%u)\n"
 msgstr ""
 
-#: .././db/check.c:3677
+#: .././db/check.c:2260
 #, c-format
-msgid "dir %llu size is %lld, should be %u\n"
+msgid "extent count for ino %lld %s fork too low (%d) for file format\n"
 msgstr ""
 
-#: .././db/check.c:3685
+#: .././db/check.c:2312 .././db/check.c:3336
 #, c-format
-msgid "dir %llu offsets too high\n"
+msgid "bad directory data magic # %#x for dir ino %lld block %d\n"
 msgstr ""
 
-#: .././db/check.c:3696
+#: .././db/check.c:2330
 #, c-format
-msgid "dir %lld entry .. bad inode number %lld\n"
+msgid "bad block directory tail for dir ino %lld\n"
 msgstr ""
 
-#: .././db/check.c:3701
+#: .././db/check.c:2375
 #, c-format
-msgid "dir %lld entry .. %lld\n"
+msgid "dir %lld block %d bad free entry at %d\n"
 msgstr ""
 
-#: .././db/check.c:3704
+#: .././db/check.c:2399
 #, c-format
-msgid "dir %lld i8count mismatch is %d should be %d\n"
+msgid "dir %lld block %d zero length entry at %d\n"
 msgstr ""
 
-#: .././db/check.c:3786
+#: .././db/check.c:2408
 #, c-format
-msgid "%s quota id %u, have/exp"
+msgid "dir %lld block %d bad entry at %d\n"
 msgstr ""
 
-#: .././db/check.c:3789
+#: .././db/check.c:2426
 #, c-format
-msgid " bc %lld/%lld"
+msgid "dir %lld block %d entry %*.*s %lld\n"
 msgstr ""
 
-#: .././db/check.c:3793
+#: .././db/check.c:2433
 #, c-format
-msgid " ic %lld/%lld"
+msgid "dir %lld block %d entry %*.*s bad inode number %lld\n"
 msgstr ""
 
-#: .././db/check.c:3797
+#: .././db/check.c:2443
 #, c-format
-msgid " rc %lld/%lld"
+msgid "multiple .. entries in dir %lld (%lld, %lld)\n"
 msgstr ""
 
-#: .././db/check.c:3853
+#: .././db/check.c:2460
 #, c-format
-msgid "can't read superblock for ag %u\n"
+msgid "dir %lld entry . inode number mismatch (%lld)\n"
 msgstr ""
 
-#: .././db/check.c:3862
+#: .././db/check.c:2474
 #, c-format
-msgid "bad sb magic # %#x in ag %u\n"
+msgid "dir %lld block %d bad count %u\n"
 msgstr ""
 
-#: .././db/check.c:3868
+#: .././db/check.c:2485 .././db/check.c:3350
 #, c-format
-msgid "bad sb version # %#x in ag %u\n"
+msgid "dir %lld block %d extra leaf entry %x %x\n"
 msgstr ""
 
-#: .././db/check.c:3878 .././db/sb.c:217
-msgid "mkfs not completed successfully\n"
+#: .././db/check.c:2497
+#, c-format
+msgid "dir %lld block %d bad bestfree data\n"
 msgstr ""
 
-#: .././db/check.c:3896
+#: .././db/check.c:2505
 #, c-format
-msgid "bad agf magic # %#x in ag %u\n"
+msgid "dir %lld block %d bad block tail count %d (stale %d)\n"
 msgstr ""
 
-#: .././db/check.c:3902
+#: .././db/check.c:2515
 #, c-format
-msgid "bad agf version # %#x in ag %u\n"
+msgid "dir %lld block %d bad stale tail count %d\n"
 msgstr ""
 
-#: .././db/check.c:3924
+#: .././db/check.c:2521
 #, c-format
-msgid "bad agi magic # %#x in ag %u\n"
+msgid "dir %lld block %d consecutive free entries\n"
 msgstr ""
 
-#: .././db/check.c:3930
+#: .././db/check.c:2527
 #, c-format
-msgid "bad agi version # %#x in ag %u\n"
+msgid "dir %lld block %d entry/unused tag mismatch\n"
 msgstr ""
 
-#: .././db/check.c:3973 .././repair/scan.c:2252
+#: .././db/check.c:2576
 #, c-format
-msgid "agf_freeblks %u, counted %u in ag %u\n"
+msgid "no . entry for directory %lld\n"
 msgstr ""
 
-#: .././db/check.c:3980 .././repair/scan.c:2257
+#: .././db/check.c:2581
 #, c-format
-msgid "agf_longest %u, counted %u in ag %u\n"
+msgid "no .. entry for directory %lld\n"
 msgstr ""
 
-#: .././db/check.c:3988
+#: .././db/check.c:2585
 #, c-format
-msgid "agf_btreeblks %u, counted %u in ag %u\n"
+msgid ". and .. same for non-root directory %lld\n"
 msgstr ""
 
-#: .././db/check.c:3996 .././repair/scan.c:2306
+#: .././db/check.c:2590
 #, c-format
-msgid "agi_count %u, counted %u in ag %u\n"
+msgid "root directory %lld has .. %lld\n"
 msgstr ""
 
-#: .././db/check.c:4003 .././repair/scan.c:2311
+#: .././db/check.c:2623
 #, c-format
-msgid "agi_freecount %u, counted %u in ag %u\n"
+msgid "bad size (%lld) or format (%d) for directory inode %lld\n"
 msgstr ""
 
-#: .././db/check.c:4012
+#: .././db/check.c:2651
 #, c-format
-msgid "agi unlinked bucket %d is %u in ag %u (inode=%lld)\n"
+msgid "bad number of extents %d for inode %lld\n"
 msgstr ""
 
-#: .././db/check.c:4050
+#: .././db/check.c:2723
 #, c-format
-msgid "can't read agfl block for ag %u\n"
+msgid "bad magic number %#x for inode %lld\n"
 msgstr ""
 
-#: .././db/check.c:4082
+#: .././db/check.c:2730
 #, c-format
-msgid "freeblk count %u != flcount %u in ag %u\n"
+msgid "bad version number %#x for inode %lld\n"
 msgstr ""
 
-#: .././db/check.c:4173
+#: .././db/check.c:2738
 #, c-format
-msgid "bad magic # %#x in inode %lld bmbt block %u/%u\n"
+msgid "bad nblocks %lld for free inode %lld\n"
 msgstr ""
 
-#: .././db/check.c:4180
+#: .././db/check.c:2745
 #, c-format
-msgid "expected level %d got %d in inode %lld bmbt block %u/%u\n"
+msgid "bad nlink %d for free inode %lld\n"
 msgstr ""
 
-#: .././db/check.c:4192 .././db/check.c:4209
+#: .././db/check.c:2751
 #, c-format
-msgid "bad btree nrecs (%u, min=%u, max=%u) in inode %lld bmap block %lld\n"
+msgid "bad mode %#o for free inode %lld\n"
 msgstr ""
 
-#: .././db/check.c:4238
+#: .././db/check.c:2760
 #, c-format
-msgid "bad magic # %#x in btbno block %u/%u\n"
+msgid "bad next unlinked %#x for inode %lld\n"
 msgstr ""
 
-#: .././db/check.c:4247
+#: .././db/check.c:2771
 #, c-format
-msgid "expected level %d got %d in btbno block %u/%u\n"
+msgid "bad format %d for inode %lld type %#o\n"
 msgstr ""
 
-#: .././db/check.c:4256 .././db/check.c:4284 .././db/check.c:4330
-#: .././db/check.c:4361
+#: .././db/check.c:2779
 #, c-format
-msgid "bad btree nrecs (%u, min=%u, max=%u) in btbno block %u/%u\n"
+msgid "bad fork offset %d for inode %lld\n"
 msgstr ""
 
-#: .././db/check.c:4271 .././repair/scan.c:666
+#: .././db/check.c:2786
 #, c-format
-msgid "out-of-order bno btree record %d (%u %u) block %u/%u\n"
+msgid "bad attribute format %d for inode %lld\n"
 msgstr ""
 
-#: .././db/check.c:4312
+#: .././db/check.c:2792
 #, c-format
-msgid "bad magic # %#x in btcnt block %u/%u\n"
+msgid ""
+"inode %lld mode %#o fmt %s afmt %s nex %d anex %d nblk %lld sz %lld%s%s%s%s%s"
+"%s%s\n"
 msgstr ""
 
-#: .././db/check.c:4321
+#: .././db/check.c:2911
 #, c-format
-msgid "expected level %d got %d in btcnt block %u/%u\n"
+msgid "bad nblocks %lld for inode %lld, counted %lld\n"
 msgstr ""
 
-#: .././db/check.c:4349 .././repair/scan.c:678
+#: .././db/check.c:2918
 #, c-format
-msgid "out-of-order cnt btree record %d (%u %u) block %u/%u\n"
+msgid "bad nextents %d for inode %lld, counted %d\n"
 msgstr ""
 
-#: .././db/check.c:4407
+#: .././db/check.c:2924
 #, c-format
-msgid "bad magic # %#x in inobt block %u/%u\n"
+msgid "bad anextents %d for inode %lld, counted %d\n"
 msgstr ""
 
-#: .././db/check.c:4414
+#: .././db/check.c:2976
 #, c-format
-msgid "expected level %d got %d in inobt block %u/%u\n"
+msgid "local inode %lld data is too large (size %lld)\n"
 msgstr ""
 
-#: .././db/check.c:4423 .././db/check.c:4509
+#: .././db/check.c:2985
 #, c-format
-msgid "bad btree nrecs (%u, min=%u, max=%u) in inobt block %u/%u\n"
+msgid "local inode %lld attr is too large (size %d)\n"
 msgstr ""
 
-#: .././db/check.c:4497
+#: .././db/check.c:3034
 #, c-format
-msgid "ir_freecount/free mismatch, inode chunk %u/%u, freecount %d nfree %d\n"
+msgid "dir inode %lld block %u=%llu\n"
 msgstr ""
 
-#: .././db/check.c:4550
+#: .././db/check.c:3046
 #, c-format
-msgid "bad magic # %#x in finobt block %u/%u\n"
+msgid "can't read block %u for directory inode %lld\n"
 msgstr ""
 
-#: .././db/check.c:4557
+#: .././db/check.c:3060
 #, c-format
-msgid "expected level %d got %d in finobt block %u/%u\n"
+msgid "multiple .. entries in dir %lld\n"
 msgstr ""
 
-#: .././db/check.c:4566 .././db/check.c:4609
+#: .././db/check.c:3082
 #, c-format
-msgid "bad btree nrecs (%u, min=%u, max=%u) in finobt block %u/%u\n"
+msgid "missing free index for data block %d in dir ino %lld\n"
 msgstr ""
 
-#: .././db/check.c:4636
+#: .././db/check.c:3110 .././db/check.c:3188
 #, c-format
-msgid "bad magic # %#x in rmapbt block %u/%u\n"
+msgid "bad free block firstdb %d for dir ino %lld block %d\n"
 msgstr ""
 
-#: .././db/check.c:4643
+#: .././db/check.c:3121 .././db/check.c:3199
 #, c-format
-msgid "expected level %d got %d in rmapbt block %u/%u\n"
+msgid "bad free block nvalid/nused %d/%d for dir ino %lld block %d\n"
 msgstr ""
 
-#: .././db/check.c:4656 .././db/check.c:4680
+#: .././db/check.c:3135 .././db/check.c:3213
 #, c-format
-msgid "bad btree nrecs (%u, min=%u, max=%u) in rmapbt block %u/%u\n"
+msgid "bad free block ent %d is %d should be %d for dir ino %lld block %d\n"
 msgstr ""
 
-#: .././db/check.c:4668
+#: .././db/check.c:3149 .././db/check.c:3227
 #, c-format
-msgid "out-of-order rmap btree record %d (%u %u) block %u/%u\n"
+msgid "bad free block nused %d should be %d for dir ino %lld block %d\n"
 msgstr ""
 
-#: .././db/check.c:4708
+#: .././db/check.c:3174
 #, c-format
-msgid "bad magic # %#x in refcntbt block %u/%u\n"
+msgid "bad free block magic # %#x for dir ino %lld block %d\n"
 msgstr ""
 
-#: .././db/check.c:4715
+#: .././db/check.c:3281
 #, c-format
-msgid "expected level %d got %d in refcntbt block %u/%u\n"
+msgid "bad leaf block forw/back pointers %d/%d for dir ino %lld block %d\n"
 msgstr ""
 
-#: .././db/check.c:4724 .././db/check.c:4765
+#: .././db/check.c:3290
 #, c-format
-msgid "bad btree nrecs (%u, min=%u, max=%u) in refcntbt block %u/%u\n"
+msgid "single leaf block for dir ino %lld block %d should be at block %d\n"
 msgstr ""
 
-#: .././db/check.c:4736 .././repair/scan.c:1350
+#: .././db/check.c:3302
 #, c-format
-msgid "leftover CoW extent (%u/%u) len %u\n"
+msgid "bestfree %d for dir ino %lld block %d doesn't match table value %d\n"
 msgstr ""
 
-#: .././db/check.c:4752
+#: .././db/check.c:3327
 #, c-format
-msgid "out-of-order refcnt btree record %d (%u %u) block %u/%u\n"
+msgid "bad node block level %d for dir ino %lld block %d\n"
 msgstr ""
 
-#: .././db/check.c:4808
+#: .././db/check.c:3359
 #, c-format
-msgid "setting inode to %lld for block %u/%u\n"
+msgid "dir3 %lld block %d stale mismatch %d/%d\n"
 msgstr ""
 
-#: .././db/check.c:4840
+#: .././db/check.c:3366
 #, c-format
-msgid "setting inode to %lld for rtblock %llu\n"
+msgid "dir %lld block %d stale mismatch %d/%d\n"
 msgstr ""
 
-#: .././db/check.c:4856
+#: .././db/check.c:3422
 #, c-format
-msgid "inode %lld nlink %u %s dir\n"
+msgid "can't read block %lld for %s quota inode (fsblock %lld)\n"
 msgstr ""
 
-#: .././db/inode.c:419
+#: .././db/check.c:3432
 #, c-format
-msgid "bad value for inode number %s\n"
+msgid "%s dqblk %lld entry %d id %u bc %lld ic %lld rc %lld\n"
 msgstr ""
 
-#: .././db/inode.c:426
+#: .././db/check.c:3440
 #, c-format
-msgid "current inode number is %lld\n"
+msgid "bad magic number %#x for %s dqblk %lld entry %d id %u\n"
 msgstr ""
 
-#: .././db/inode.c:660
+#: .././db/check.c:3449
 #, c-format
-msgid "bad inode number %lld\n"
+msgid "bad version number %#x for %s dqblk %lld entry %d id %u\n"
 msgstr ""
 
-#: .././db/inode.c:707
+#: .././db/check.c:3459
 #, c-format
-msgid "Metadata CRC error detected for ino %lld\n"
+msgid "bad flags %#x for %s dqblk %lld entry %d id %u\n"
 msgstr ""
 
-#: .././db/metadump.c:60
-msgid "[-a] [-e] [-g] [-m max_extent] [-w] [-o] filename"
+#: .././db/check.c:3468
+#, c-format
+msgid "bad id %u for %s dqblk %lld entry %d id %u\n"
 msgstr ""
 
-#: .././db/metadump.c:61
-msgid "dump metadata to a file"
+#: .././db/check.c:3514
+#, c-format
+msgid "block %lld for rtbitmap inode is missing\n"
 msgstr ""
 
-#: .././db/metadump.c:92
+#: .././db/check.c:3525
 #, c-format
-msgid ""
-"\n"
-" The 'metadump' command dumps the known metadata to a compact file suitable\n"
-" for compressing and sending to an XFS maintainer for corruption analysis \n"
-" or xfs_repair failures.\n"
-"\n"
-" Options:\n"
-"   -a -- Copy full metadata blocks without zeroing unused space\n"
-"   -e -- Ignore read errors and keep going\n"
-"   -g -- Display dump progress\n"
-"   -m -- Specify max extent size in blocks to copy (default = %d blocks)\n"
-"   -o -- Don't obfuscate names and extended attributes\n"
-"   -w -- Show warnings of bad metadata information\n"
-"\n"
+msgid "can't read block %lld for rtbitmap inode\n"
 msgstr ""
 
-#: .././db/metadump.c:2728
-msgid ""
-"Filesystem log is dirty; image will contain unobfuscated metadata in log."
+#: .././db/check.c:3581
+#, c-format
+msgid "block %lld for rtsummary inode is missing\n"
 msgstr ""
 
-#: .././db/metadump.c:2734
-msgid "Could not discern log; image will contain unobfuscated metadata in log."
+#: .././db/check.c:3592
+#, c-format
+msgid "can't read block %lld for rtsummary inode\n"
 msgstr ""
 
-#: .././db/print.c:41
-msgid "[value]..."
+#: .././db/check.c:3625
+#, c-format
+msgid "dir %lld entry . %lld\n"
 msgstr ""
 
-#: .././db/print.c:42
-msgid "print field values"
+#: .././db/check.c:3633
+#, c-format
+msgid "dir %llu bad size in entry at %d\n"
 msgstr ""
 
-#: .././db/print.c:79
+#: .././db/check.c:3645
 #, c-format
-msgid "no print function for type %s\n"
+msgid "dir %lld entry %*.*s bad inode number %lld\n"
 msgstr ""
 
-#: .././db/print.c:156
-msgid "(empty)\n"
+#: .././db/check.c:3657
+#, c-format
+msgid "dir %lld entry %*.*s offset %d %lld\n"
 msgstr ""
 
-#: .././db/print.c:218
-msgid "(empty)"
+#: .././db/check.c:3662
+#, c-format
+msgid "dir %lld entry %*.*s bad offset %d\n"
 msgstr ""
 
-#: .././db/print.c:278
-msgid "no arguments allowed\n"
+#: .././db/check.c:3675
+#, c-format
+msgid "dir %llu size is %lld, should be %u\n"
 msgstr ""
 
-#: .././db/sb.c:45
-msgid "set current address to sb header"
+#: .././db/check.c:3683
+#, c-format
+msgid "dir %llu offsets too high\n"
 msgstr ""
 
-#: .././db/sb.c:47
-msgid "[uuid]"
+#: .././db/check.c:3694
+#, c-format
+msgid "dir %lld entry .. bad inode number %lld\n"
 msgstr ""
 
-#: .././db/sb.c:48
-msgid "write/print FS uuid"
+#: .././db/check.c:3699
+#, c-format
+msgid "dir %lld entry .. %lld\n"
 msgstr ""
 
-#: .././db/sb.c:50
-msgid "[label]"
+#: .././db/check.c:3702
+#, c-format
+msgid "dir %lld i8count mismatch is %d should be %d\n"
 msgstr ""
 
-#: .././db/sb.c:51
-msgid "write/print FS label"
+#: .././db/check.c:3784
+#, c-format
+msgid "%s quota id %u, have/exp"
 msgstr ""
 
-#: .././db/sb.c:53
-msgid "[feature | [vnum fnum]]"
+#: .././db/check.c:3787
+#, c-format
+msgid " bc %lld/%lld"
 msgstr ""
 
-#: .././db/sb.c:54
-msgid "set feature bit(s) in the sb version field"
+#: .././db/check.c:3791
+#, c-format
+msgid " ic %lld/%lld"
 msgstr ""
 
-#: .././db/sb.c:140
-msgid ""
-"\n"
-" set allocation group superblock\n"
-"\n"
-" Example:\n"
-"\n"
-" 'sb 7' - set location to 7th allocation group superblock, set type to 'sb'\n"
-"\n"
-" Located in the first sector of each allocation group, the superblock\n"
-" contains the base information for the filesystem.\n"
-" The superblock in allocation group 0 is the primary.  The copies in the\n"
-" remaining allocation groups only serve as backup for filesystem recovery.\n"
-" The icount/ifree/fdblocks/frextents are only updated in superblock 0.\n"
-"\n"
+#: .././db/check.c:3795
+#, c-format
+msgid " rc %lld/%lld"
 msgstr ""
 
-#: .././db/sb.c:199
+#: .././db/check.c:3851
 #, c-format
-msgid "can't read superblock for AG %u\n"
+msgid "can't read superblock for ag %u\n"
 msgstr ""
 
-#: .././db/sb.c:207
+#: .././db/check.c:3860
 #, c-format
-msgid "bad sb magic # %#x in AG %u\n"
+msgid "bad sb magic # %#x in ag %u\n"
 msgstr ""
 
-#: .././db/sb.c:212
+#: .././db/check.c:3866
 #, c-format
-msgid "bad sb version # %#x in AG %u\n"
+msgid "bad sb version # %#x in ag %u\n"
 msgstr ""
 
-#: .././db/sb.c:236
-msgid "aborting - external log specified for FS with an internal log\n"
+#: .././db/check.c:3894
+#, c-format
+msgid "bad agf magic # %#x in ag %u\n"
 msgstr ""
 
-#: .././db/sb.c:242
-msgid "aborting - no external log specified for FS with an external log\n"
+#: .././db/check.c:3900
+#, c-format
+msgid "bad agf version # %#x in ag %u\n"
 msgstr ""
 
-#: .././db/sb.c:252
-msgid "ERROR: cannot find log head/tail, run xfs_repair\n"
+#: .././db/check.c:3922
+#, c-format
+msgid "bad agi magic # %#x in ag %u\n"
 msgstr ""
 
-#: .././db/sb.c:256
+#: .././db/check.c:3928
 #, c-format
-msgid ""
-"ERROR: The filesystem has valuable metadata changes in a log which needs to\n"
-"be replayed.  Mount the filesystem to replay the log, and unmount it before\n"
-"re-running %s.  If you are unable to mount the filesystem, then use\n"
-"the xfs_repair -L option to destroy the log and attempt a repair.\n"
-"Note that destroying the log may cause corruption -- please attempt a mount\n"
-"of the filesystem before doing this.\n"
+msgid "bad agi version # %#x in ag %u\n"
 msgstr ""
 
-#: .././db/sb.c:284
-msgid "Clearing log and setting UUID\n"
+#: .././db/check.c:3971 .././repair/scan.c:2258
+#, c-format
+msgid "agf_freeblks %u, counted %u in ag %u\n"
 msgstr ""
 
-#: .././db/sb.c:293
-msgid "ERROR: cannot clear the log\n"
+#: .././db/check.c:3978 .././repair/scan.c:2263
+#, c-format
+msgid "agf_longest %u, counted %u in ag %u\n"
 msgstr ""
 
-#: .././db/sb.c:305
-msgid ""
-"\n"
-" write/print FS uuid\n"
-"\n"
-" Example:\n"
-"\n"
-" 'uuid'                                      - print UUID\n"
-" 'uuid 01234567-0123-0123-0123-0123456789ab' - write UUID\n"
-" 'uuid generate'                             - generate and write\n"
-" 'uuid rewrite'                              - copy UUID from SB 0\n"
-"\n"
-"The print function checks the UUID in each SB and will warn if the UUIDs\n"
-"differ between AGs (the log is not checked). The write commands will\n"
-"set the uuid in all AGs to either a specified value, a newly generated\n"
-"value or the value found in the first superblock (SB 0) respectively.\n"
-"As a side effect of writing the UUID, the log is cleared (which is fine\n"
-"on a CLEANLY unmounted FS).\n"
-"\n"
+#: .././db/check.c:3986
+#, c-format
+msgid "agf_btreeblks %u, counted %u in ag %u\n"
 msgstr ""
 
-#: .././db/sb.c:383 .././db/sb.c:546
-msgid "invalid parameters\n"
+#: .././db/check.c:3994 .././repair/scan.c:2312
+#, c-format
+msgid "agi_count %u, counted %u in ag %u\n"
 msgstr ""
 
-#: .././db/sb.c:390 .././db/sb.c:553 .././db/sb.c:720
+#: .././db/check.c:4001 .././repair/scan.c:2317
 #, c-format
-msgid "%s: not in expert mode, writing disabled\n"
+msgid "agi_freecount %u, counted %u in ag %u\n"
 msgstr ""
 
-#: .././db/sb.c:402
-msgid "failed to read UUID from AG 0\n"
+#: .././db/check.c:4010
+#, c-format
+msgid "agi unlinked bucket %d is %u in ag %u (inode=%lld)\n"
 msgstr ""
 
-#: .././db/sb.c:407
+#: .././db/check.c:4048
 #, c-format
-msgid "old UUID = %s\n"
+msgid "can't read agfl block for ag %u\n"
 msgstr ""
 
-#: .././db/sb.c:421
-msgid "invalid UUID\n"
+#: .././db/check.c:4058 .././db/freesp.c:259 .././repair/scan.c:2148
+#, c-format
+msgid "agf %d freelist blocks bad, skipping freelist scan\n"
 msgstr ""
 
-#: .././db/sb.c:430 .././db/sb.c:558 .././db/sb.c:806
-msgid "writing all SBs\n"
+#: .././db/check.c:4080
+#, c-format
+msgid "freeblk count %u != flcount %u in ag %u\n"
 msgstr ""
 
-#: .././db/sb.c:433
+#: .././db/check.c:4171
 #, c-format
-msgid "failed to set UUID in AG %d\n"
+msgid "bad magic # %#x in inode %lld bmbt block %u/%u\n"
 msgstr ""
 
-#: .././db/sb.c:438
+#: .././db/check.c:4178
 #, c-format
-msgid "new UUID = %s\n"
+msgid "expected level %d got %d in inode %lld bmbt block %u/%u\n"
 msgstr ""
 
-#: .././db/sb.c:446
+#: .././db/check.c:4190 .././db/check.c:4207
 #, c-format
-msgid "failed to read UUID from AG %d\n"
+msgid "bad btree nrecs (%u, min=%u, max=%u) in inode %lld bmap block %lld\n"
 msgstr ""
 
-#: .././db/sb.c:452
+#: .././db/check.c:4236
 #, c-format
-msgid "warning: UUID in AG %d differs to the primary SB\n"
+msgid "bad magic # %#x in btbno block %u/%u\n"
 msgstr ""
 
-#: .././db/sb.c:463
-msgid "warning - external log specified for FS with an internal log\n"
+#: .././db/check.c:4245
+#, c-format
+msgid "expected level %d got %d in btbno block %u/%u\n"
 msgstr ""
 
-#: .././db/sb.c:466
-msgid "warning - no external log specified for FS with an external log\n"
+#: .././db/check.c:4254 .././db/check.c:4282 .././db/check.c:4328
+#: .././db/check.c:4359
+#, c-format
+msgid "bad btree nrecs (%u, min=%u, max=%u) in btbno block %u/%u\n"
 msgstr ""
 
-#: .././db/sb.c:471
+#: .././db/check.c:4269 .././repair/scan.c:672
 #, c-format
-msgid "UUID = %s\n"
+msgid "out-of-order bno btree record %d (%u %u) block %u/%u\n"
 msgstr ""
 
-#: .././db/sb.c:482
-msgid ""
-"\n"
-" write/print FS label\n"
-"\n"
-" Example:\n"
-"\n"
-" 'label'              - print label\n"
-" 'label 123456789012' - write label\n"
-" 'label --'           - write an empty label\n"
-"\n"
-"The print function checks the label in each SB and will warn if the labels\n"
-"differ between AGs. The write commands will set the label in all AGs to the\n"
-"specified value.  The maximum length of a label is 12 characters - use of a\n"
-"longer label will result in truncation and a warning will be issued.\n"
-"\n"
+#: .././db/check.c:4310
+#, c-format
+msgid "bad magic # %#x in btcnt block %u/%u\n"
 msgstr ""
 
-#: .././db/sb.c:519
+#: .././db/check.c:4319
 #, c-format
-msgid "%s: truncating label length from %d to %d\n"
+msgid "expected level %d got %d in btcnt block %u/%u\n"
 msgstr ""
 
-#: .././db/sb.c:561
+#: .././db/check.c:4347 .././repair/scan.c:684
 #, c-format
-msgid "failed to set label in AG %d\n"
+msgid "out-of-order cnt btree record %d (%u %u) block %u/%u\n"
 msgstr ""
 
-#: .././db/sb.c:564
+#: .././db/check.c:4405
 #, c-format
-msgid "new label = \"%s\"\n"
+msgid "bad magic # %#x in inobt block %u/%u\n"
 msgstr ""
 
-#: .././db/sb.c:571
+#: .././db/check.c:4412
 #, c-format
-msgid "failed to read label in AG %d\n"
+msgid "expected level %d got %d in inobt block %u/%u\n"
 msgstr ""
 
-#: .././db/sb.c:577
+#: .././db/check.c:4421 .././db/check.c:4507
 #, c-format
-msgid "warning: AG %d label differs\n"
+msgid "bad btree nrecs (%u, min=%u, max=%u) in inobt block %u/%u\n"
 msgstr ""
 
-#: .././db/sb.c:579
+#: .././db/check.c:4495
 #, c-format
-msgid "label = \"%s\"\n"
+msgid "ir_freecount/free mismatch, inode chunk %u/%u, freecount %d nfree %d\n"
 msgstr ""
 
-#: .././db/sb.c:589
-msgid ""
-"\n"
-" set/print feature bits in sb version\n"
-"\n"
-" Example:\n"
-"\n"
-" 'version'          - print current feature bits\n"
-" 'version extflg'   - enable unwritten extents\n"
-" 'version attr1'    - enable v1 inline extended attributes\n"
-" 'version attr2'    - enable v2 inline extended attributes\n"
-" 'version log2'     - enable v2 log format\n"
-"\n"
-"The version function prints currently enabled features for a filesystem\n"
-"according to the version field of its primary superblock.\n"
-"It can also be used to enable selected features, such as support for\n"
-"unwritten extents.  The updated version is written into all AGs.\n"
-"\n"
+#: .././db/check.c:4548
+#, c-format
+msgid "bad magic # %#x in finobt block %u/%u\n"
 msgstr ""
 
-#: .././db/sb.c:617
-msgid "Superblock has mismatched features2 fields, skipping modification\n"
+#: .././db/check.c:4555
+#, c-format
+msgid "expected level %d got %d in finobt block %u/%u\n"
 msgstr ""
 
-#: .././db/sb.c:740
-msgid "unwritten extents flag is already enabled\n"
+#: .././db/check.c:4564 .././db/check.c:4607
+#, c-format
+msgid "bad btree nrecs (%u, min=%u, max=%u) in finobt block %u/%u\n"
 msgstr ""
 
-#: .././db/sb.c:747
-msgid "unwritten extents always enabled for v5 superblocks.\n"
+#: .././db/check.c:4634
+#, c-format
+msgid "bad magic # %#x in rmapbt block %u/%u\n"
 msgstr ""
 
-#: .././db/sb.c:764
-msgid "version 2 log format is already in use\n"
+#: .././db/check.c:4641
+#, c-format
+msgid "expected level %d got %d in rmapbt block %u/%u\n"
 msgstr ""
 
-#: .././db/sb.c:771
-msgid "Version 2 logs always enabled for v5 superblocks.\n"
+#: .././db/check.c:4654 .././db/check.c:4678
+#, c-format
+msgid "bad btree nrecs (%u, min=%u, max=%u) in rmapbt block %u/%u\n"
 msgstr ""
 
-#: .././db/sb.c:776
+#: .././db/check.c:4666
 #, c-format
-msgid "%s: Cannot change %s on v5 superblocks.\n"
+msgid "out-of-order rmap btree record %d (%u %u) block %u/%u\n"
 msgstr ""
 
-#: .././db/sb.c:800
+#: .././db/check.c:4706
 #, c-format
-msgid "%s: invalid version change command \"%s\"\n"
+msgid "bad magic # %#x in refcntbt block %u/%u\n"
 msgstr ""
 
-#: .././db/sb.c:809
+#: .././db/check.c:4713
 #, c-format
-msgid "failed to set versionnum in AG %d\n"
+msgid "expected level %d got %d in refcntbt block %u/%u\n"
 msgstr ""
 
-#: .././db/sb.c:827
+#: .././db/check.c:4722 .././db/check.c:4763
 #, c-format
-msgid "versionnum [0x%x+0x%x] = %s\n"
+msgid "bad btree nrecs (%u, min=%u, max=%u) in refcntbt block %u/%u\n"
 msgstr ""
 
-#: .././db/type.c:49
-msgid "[newtype]"
+#: .././db/check.c:4734 .././repair/scan.c:1356
+#, c-format
+msgid "leftover CoW extent (%u/%u) len %u\n"
+msgstr ""
+
+#: .././db/check.c:4750
+#, c-format
+msgid "out-of-order refcnt btree record %d (%u %u) block %u/%u\n"
+msgstr ""
+
+#: .././db/check.c:4806
+#, c-format
+msgid "setting inode to %lld for block %u/%u\n"
+msgstr ""
+
+#: .././db/check.c:4838
+#, c-format
+msgid "setting inode to %lld for rtblock %llu\n"
+msgstr ""
+
+#: .././db/check.c:4854
+#, c-format
+msgid "inode %lld nlink %u %s dir\n"
 msgstr ""
 
 #: .././db/type.c:50
+msgid "[newtype]"
+msgstr ""
+
+#: .././db/type.c:51
 msgid "set/show current data type"
 msgstr ""
 
-#: .././db/type.c:210
+#: .././db/type.c:211
 #, c-format
 msgid "current type is \"%s\"\n"
 msgstr ""
 
-#: .././db/type.c:212
+#: .././db/type.c:213
 msgid ""
 "\n"
 " supported types are:\n"
 " "
 msgstr ""
 
-#: .././db/type.c:229
+#: .././db/type.c:230
 #, c-format
 msgid "no such type %s\n"
 msgstr ""
 
-#: .././db/type.c:232
+#: .././db/type.c:233
 msgid "no current object\n"
 msgstr ""
 
-#: .././db/io.c:47
-msgid "pop location from the stack"
-msgstr ""
-
-#: .././db/io.c:50
-msgid "push location to the stack"
+#: .././db/type.c:286
+msgid "string fuzzing not supported.\n"
 msgstr ""
 
-#: .././db/io.c:53
-msgid "view the location stack"
+#: .././db/type.c:306
+msgid "use 'blocktrash' or 'write' to fuzz a block.\n"
 msgstr ""
 
-#: .././db/io.c:56
-msgid "move forward to next entry in the position ring"
+#: .././db/type.c:322
+msgid "text writing/fuzzing not supported.\n"
 msgstr ""
 
-#: .././db/io.c:59
-msgid "move to the previous location in the position ring"
+#: .././db/quit.c:27
+msgid "exit xfs_db"
 msgstr ""
 
-#: .././db/io.c:62
-msgid "show position ring or move to a specific entry"
+#: .././db/freesp.c:111 .././spaceman/freesp.c:365
+#, c-format
+msgid "total free extents %lld\n"
 msgstr ""
 
-#: .././db/io.c:92
+#: .././db/freesp.c:112 .././spaceman/freesp.c:366
 #, c-format
-msgid "can't set block offset to %d\n"
+msgid "total free blocks %lld\n"
 msgstr ""
 
-#: .././db/io.c:105
-msgid "can't pop anything from I/O stack\n"
+#: .././db/freesp.c:113 .././spaceman/freesp.c:367
+#, c-format
+msgid "average free extent size %g\n"
 msgstr ""
 
-#: .././db/io.c:139
+#: .././db/freesp.c:207
 msgid ""
-"\n"
-" Changes the address and data type to the first entry on the stack.\n"
-"\n"
+"freesp arguments: [-bcds] [-a agno] [-e binsize] [-h h1]... [-m binmult]\n"
 msgstr ""
 
-#: .././db/io.c:153
-#, c-format
-msgid "\tbyte offset %lld, length %d\n"
+#: .././db/freesp.c:434 .././spaceman/freesp.c:131
+msgid "from"
 msgstr ""
 
-#: .././db/io.c:154
-#, c-format
-msgid "\tbuffer block %lld (fsbno %lld), %d bb%s\n"
+#: .././db/freesp.c:434 .././spaceman/freesp.c:131
+msgid "to"
 msgstr ""
 
-#: .././db/io.c:158 .././db/io.c:544
-#, c-format
-msgid "\tblock map"
+#: .././db/freesp.c:434 .././repair/progress.c:26 .././spaceman/freesp.c:131
+msgid "extents"
 msgstr ""
 
-#: .././db/io.c:164
-#, c-format
-msgid "\tinode %lld, dir inode %lld, type %s\n"
+#: .././db/freesp.c:434 .././repair/progress.c:18 .././spaceman/freesp.c:131
+msgid "blocks"
 msgstr ""
 
-#: .././db/io.c:165 .././growfs/xfs_growfs.c:88 .././logprint/log_misc.c:107
-#: .././mkfs/xfs_mkfs.c:2366
-#, c-format
-msgid "none"
+#: .././db/freesp.c:434 .././spaceman/freesp.c:131
+msgid "pct"
 msgstr ""
 
-#: .././db/io.c:175
-msgid "no entries in location ring.\n"
+#: .././db/output.c:30
+msgid "[stop|start <filename>]"
 msgstr ""
 
-#: .././db/io.c:179
-msgid "      type    bblock  bblen    fsbno     inode\n"
+#: .././db/output.c:31
+msgid "start or stop logging to a file"
 msgstr ""
 
-#: .././db/io.c:233
+#: .././db/output.c:68
 #, c-format
-msgid "no such command %s\n"
+msgid "logging to %s\n"
 msgstr ""
 
-#: .././db/io.c:237
-#, c-format
-msgid "no push form allowed for %s\n"
+#: .././db/output.c:70 .././db/output.c:77
+msgid "no log file\n"
 msgstr ""
 
-#: .././db/io.c:261
-msgid ""
-"\n"
-" Allows you to push the current address and data type on the stack for\n"
-" later return.  'push' also accepts an additional command to execute after\n"
-" storing the current address (ex: 'push a rootino' from the superblock).\n"
-"\n"
+#: .././db/output.c:80
+#, c-format
+msgid "already logging to %s\n"
 msgstr ""
 
-#: .././db/io.c:277 .././db/io.c:317
-msgid "ring is empty\n"
+#: .././db/output.c:84
+#, c-format
+msgid "can't open %s for writing\n"
 msgstr ""
 
-#: .././db/io.c:281
-msgid "no further entries\n"
+#: .././db/output.c:90
+msgid "bad log command, ignored\n"
 msgstr ""
 
-#: .././db/io.c:300
-msgid ""
-"\n"
-" The 'forward' ('f') command moves to the next location in the position\n"
-" ring, updating the current position and data type.  If the current "
-"location\n"
-" is the top entry in the ring, then the 'forward' command will have\n"
-" no effect.\n"
-"\n"
+#: .././db/attr.c:636 .././db/attr.c:671
+msgid "Unknown attribute buffer type!\n"
 msgstr ""
 
-#: .././db/io.c:321
-msgid "no previous entries\n"
+#: .././db/attr.c:683
+msgid "Writing unknown attribute buffer type!\n"
 msgstr ""
 
-#: .././db/io.c:340
-msgid ""
-"\n"
-" The 'back' ('b') command moves to the previous location in the position\n"
-" ring, updating the current position and data type.  If the current "
-"location\n"
-" is the last entry in the ring, then the 'back' command will have no "
-"effect.\n"
-"\n"
+#: .././db/debug.c:27
+msgid "[flagbits]"
 msgstr ""
 
-#: .././db/io.c:363
-#, c-format
-msgid "invalid entry: %d\n"
+#: .././db/debug.c:28
+msgid "set debug option bits"
 msgstr ""
 
-#: .././db/io.c:382
+#: .././db/debug.c:42
 #, c-format
-msgid ""
-"\n"
-" The position ring automatically keeps track of each disk location and\n"
-" structure type for each change of position you make during your xfs_db\n"
-" session.  The last %d most recent entries are kept in the ring.\n"
-"\n"
-" To display the current list of ring entries type 'ring' by itself on\n"
-" the command line.  The entry highlighted by an asterisk ('*') is the\n"
-" current entry.\n"
-"\n"
-" To move to another entry in the ring type 'ring <num>' where <num> is\n"
-" your desired entry from the ring position list.\n"
-"\n"
-" You may also use the 'forward' ('f') or 'back' ('b') commands to move\n"
-" to the previous or next entry in the ring, respectively.\n"
-"\n"
-" Note: Unlike the 'stack', 'push' and 'pop' commands, the ring tracks your\n"
-" location implicitly.  Use the 'push' and 'pop' commands if you wish to\n"
-" store a specific location explicitly for later return.\n"
-"\n"
+msgid "bad value for debug %s\n"
 msgstr ""
 
-#: .././db/io.c:435 .././db/io.c:451
+#: .././db/dir2.c:1016
 #, c-format
-msgid "write error: %s\n"
+msgid "Unknown directory buffer type! %x %x\n"
 msgstr ""
 
-#: .././db/io.c:441 .././db/io.c:457
-#, c-format
-msgid "read error: %s\n"
+#: .././db/dir2.c:1060
+msgid "Unknown directory buffer type!\n"
 msgstr ""
 
-#: .././db/io.c:480
-msgid "nothing to write\n"
+#: .././db/dir2.c:1072
+msgid "Writing unknown directory buffer type!\n"
 msgstr ""
 
-#: .././db/io.c:529
-msgid "set_cur no stack element to set\n"
+#: .././db/hash.c:30
+msgid "string"
 msgstr ""
 
-#: .././db/io.c:543
-#, c-format
-msgid "xfs_db got a bbmap for %lld\n"
+#: .././db/hash.c:31
+msgid "calculate hash value"
 msgstr ""
 
-#: .././db/io.c:619
+#: .././db/hash.c:37
 msgid ""
 "\n"
-" The stack is used to explicitly store your location and data type\n"
-" for later return.  The 'push' operation stores the current address\n"
-" and type on the stack, the 'pop' operation returns you to the\n"
-" position and datatype of the top entry on the stack.\n"
+" 'hash' prints out the calculated hash value for a string using the\n"
+"directory/attribute code hash function.\n"
 "\n"
-" The 'stack' allows explicit location saves, see 'ring' for implicit\n"
-" position tracking.\n"
+" Usage:  \"hash <string>\"\n"
 "\n"
 msgstr ""
 
-#: .././estimate/xfs_estimate.c:78
+#: .././db/help.c:31 .././libxcmd/help.c:94
+msgid "help for one or all commands"
+msgstr ""
+
+#: .././db/help.c:40 .././libxcmd/help.c:34
 #, c-format
 msgid ""
-"Usage: %s [opts] directory [directory ...]\n"
-"\t-b blocksize (fundamental filesystem blocksize)\n"
-"\t-i logsize (internal log size)\n"
-"\t-e logsize (external log size)\n"
-"\t-v prints more verbose messages\n"
-"\t-V prints version and exits\n"
-"\t-h prints this usage message\n"
 "\n"
-"Note:\tblocksize may have 'k' appended to indicate x1024\n"
-"\tlogsize may also have 'm' appended to indicate (1024 x 1024)\n"
+"Use 'help commandname' for extended help.\n"
 msgstr ""
 
-#: .././estimate/xfs_estimate.c:109
+#: .././db/help.c:89
 #, c-format
-msgid "blocksize %llu too small\n"
+msgid "(or %s) "
 msgstr ""
 
-#: .././estimate/xfs_estimate.c:114
-#, c-format
-msgid "blocksize %llu too large\n"
-msgstr ""
+#: .././db/logformat.c:89
+msgid "The log is dirty. Please mount to replay the log.\n"
+msgstr ""
 
-#: .././estimate/xfs_estimate.c:121
-#, c-format
-msgid "already have external log noted, can't have both\n"
+#: .././db/logformat.c:121
+msgid ""
+"\n"
+" The 'logformat' command reformats (clears) the log to the specified log\n"
+" cycle and log stripe unit. If the log cycle is not specified, the log is\n"
+" reformatted to the current cycle. If the log stripe unit is not specified,\n"
+" the stripe unit from the filesystem superblock is used.\n"
+"\n"
 msgstr ""
 
-#: .././estimate/xfs_estimate.c:130
-#, c-format
-msgid "already have internal log noted, can't have both\n"
+#: .././db/logformat.c:137
+msgid "[-c cycle] [-s sunit]"
 msgstr ""
 
-#: .././estimate/xfs_estimate.c:160
-#, c-format
-msgid ""
-"directory                               bsize   blocks    megabytes    "
-"logsize\n"
+#: .././db/logformat.c:138
+msgid "reformat the log"
 msgstr ""
 
-#: .././estimate/xfs_estimate.c:174
-#, c-format
-msgid "dirsize=%llu\n"
+#: .././db/fuzz.c:41
+msgid "[-c] [-d] field fuzzcmd..."
 msgstr ""
 
-#: .././estimate/xfs_estimate.c:175
-#, c-format
-msgid "fullblocks=%llu\n"
+#: .././db/fuzz.c:42
+msgid "fuzz values on disk"
 msgstr ""
 
-#: .././estimate/xfs_estimate.c:176
-#, c-format
-msgid "isize=%llu\n"
+#: .././db/fuzz.c:58
+msgid ""
+"\n"
+" The 'fuzz' command fuzzes fields in any on-disk data structure.  For\n"
+" block fuzzing, see the 'blocktrash' or 'write' commands.\n"
+" Examples:\n"
+"  Struct mode: 'fuzz core.uid zeroes'    - set an inode uid field to 0.\n"
+"               'fuzz crc ones'           - set a crc filed to all ones.\n"
+"               'fuzz bno[11] firstbit'   - set the high bit of a block "
+"array.\n"
+"               'fuzz keys[5].startblock add'    - increase a btree key "
+"value.\n"
+"               'fuzz uuid random'        - randomize the superblock uuid.\n"
+"\n"
+" Type 'fuzz' by itself for a list of specific commands.\n"
+"\n"
+" Specifying the -c option will allow writes of invalid (corrupt) data with\n"
+" an invalid CRC. Specifying the -d option will allow writes of invalid "
+"data,\n"
+" but still recalculate the CRC so we are forced to check and detect the\n"
+" invalid data appropriately.\n"
+"\n"
 msgstr ""
 
-#: .././estimate/xfs_estimate.c:178
+#: .././db/fuzz.c:92
 #, c-format
-msgid "%llu regular files\n"
+msgid "%s started in read only mode, fuzzing disabled\n"
 msgstr ""
 
-#: .././estimate/xfs_estimate.c:179
+#: .././db/fuzz.c:104
 #, c-format
-msgid "%llu symbolic links\n"
+msgid "no handler function for type %s, fuzz unsupported.\n"
 msgstr ""
 
-#: .././estimate/xfs_estimate.c:180
-#, c-format
-msgid "%llu directories\n"
+#: .././db/fuzz.c:118
+msgid "bad option for fuzz command\n"
 msgstr ""
 
-#: .././estimate/xfs_estimate.c:181
-#, c-format
-msgid "%llu special files\n"
+#: .././db/fuzz.c:158
+msgid "Allowing fuzz of corrupted data and bad CRC\n"
 msgstr ""
 
-#: .././estimate/xfs_estimate.c:194
-#, c-format
-msgid "%s will take about %.1f megabytes\n"
+#: .././db/fuzz.c:161 .././db/fuzz.c:164
+msgid "Allowing fuzz of corrupted data with good CRC\n"
 msgstr ""
 
-#: .././estimate/xfs_estimate.c:201
-#, c-format
-msgid "%-39s %5llu %8llu %10.1fMB %10llu\n"
+#: .././db/fuzz.c:387
+msgid "Usage: fuzz fieldname fuzzcmd\n"
 msgstr ""
 
-#: .././estimate/xfs_estimate.c:207
+#: .././db/fuzz.c:406
 #, c-format
-msgid "\twith the external log using %llu blocks "
+msgid "Unknown fuzz command '%s'.\n"
 msgstr ""
 
-#: .././estimate/xfs_estimate.c:209
+#: .././db/fuzz.c:452
 #, c-format
-msgid "or about %.1f megabytes\n"
+msgid "unable to fuzz field '%s'\n"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:268
-#, c-format
-msgid "%s: Stats not yet supported for XFS\n"
+#: .././db/agfl.c:37
+msgid "set address to agfl block"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:332
-#, c-format
-msgid "%s: could not stat: %s: %s\n"
+#: .././db/agfl.c:79
+msgid ""
+"\n"
+" set allocation group freelist\n"
+"\n"
+" Example:\n"
+"\n"
+" agfl 5\n"
+" Located in the fourth sector of each allocation group,\n"
+" the agfl freelist for internal btree space allocation is maintained\n"
+" for each allocation group.  This acts as a reserved pool of space\n"
+" separate from the general filesystem freespace (not used for user data).\n"
+"\n"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:351
-#, c-format
-msgid "%s: char special not supported: %s\n"
+#: .././db/attrset.c:38
+msgid "[-r|-s|-p|-u] [-n] [-R|-C] [-v n] name"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:357
-#, c-format
-msgid "%s: cannot defragment: %s: Not XFS\n"
+#: .././db/attrset.c:39
+msgid "set the named attribute on the current inode"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:367
-#, c-format
-msgid "%s: not fsys dev, dir, or reg file, ignoring\n"
+#: .././db/attrset.c:42
+msgid "[-r|-s|-p|-u] [-n] name"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:382
-#, c-format
+#: .././db/attrset.c:43
+msgid "remove the named attribute from the current inode"
+msgstr ""
+
+#: .././db/attrset.c:49
 msgid ""
-"Usage: %s [-d] [-v] [-g] [-t time] [-p passes] [-f leftf] [-m mtab]\n"
-"       %s [-d] [-v] [-g] xfsdev | dir | file ...\n"
-"       %s -V\n"
 "\n"
-"Options:\n"
-"       -g              Print to syslog (default if stdout not a tty).\n"
-"       -t time         How long to run in seconds.\n"
-"       -p passes       Number of passes before terminating global re-org.\n"
-"       -f leftoff      Use this instead of %s.\n"
-"       -m mtab         Use something other than /etc/mtab.\n"
-"       -d              Debug, print even more.\n"
-"       -v              Verbose, more -v's more verbose.\n"
-"       -V              Print version number and exit.\n"
+" The 'attr_set' and 'attr_remove' commands provide interfaces for debugging\n"
+" the extended attribute allocation and removal code.\n"
+" Both commands require an attribute name to be specified, and the attr_set\n"
+" command allows an optional value length (-v) to be provided as well.\n"
+" There are 4 namespace flags:\n"
+"  -r -- 'root'\n"
+"  -u -- 'user'\t\t(default)\n"
+"  -s -- 'secure'\n"
+"\n"
+" For attr_set, these options further define the type of set operation:\n"
+"  -C -- 'create'    - create attribute, fail if it already exists\n"
+"  -R -- 'replace'   - replace attribute, fail if it does not exist\n"
+" The backward compatibility mode 'noattr2' can be emulated (-n) also.\n"
+"\n"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:412 .././fsr/xfs_fsr.c:450
-#, c-format
-msgid "out of memory: %s\n"
+#: .././db/attrset.c:90 .././db/attrset.c:193
+msgid "current type is not inode\n"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:441
+#: .././db/attrset.c:125
 #, c-format
-msgid "Skipping %s: not mounted rw\n"
+msgid "bad attr_set valuelen %s\n"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:455
-#, c-format
-msgid "out of memory on realloc: %s\n"
+#: .././db/attrset.c:131
+msgid "bad option for attr_set command\n"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:466 .././fsr/xfs_fsr.c:470
-#, c-format
-msgid "strdup(%s) failed\n"
+#: .././db/attrset.c:137
+msgid "too few options for attr_set (no name given)\n"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:481
+#: .././db/attrset.c:146
 #, c-format
-msgid "no rw xfs file systems in mtab: %s\n"
+msgid "cannot allocate buffer (%d)\n"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:485
+#: .././db/attrset.c:155 .././db/attrset.c:230
 #, c-format
-msgid "Found %d mounted, writable, XFS filesystems\n"
+msgid "failed to iget inode %llu\n"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:515
+#: .././db/attrset.c:162
 #, c-format
-msgid "%s: open failed\n"
+msgid "failed to set attr %s on inode %llu\n"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:530
-#, c-format
-msgid "Can't use %s: mode=0%o own=%d nlink=%d\n"
+#: .././db/attrset.c:217
+msgid "bad option for attr_remove command\n"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:550
-#, c-format
-msgid "could not read %s, starting with %s\n"
+#: .././db/attrset.c:223
+msgid "too few options for attr_remove (no name given)\n"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:589
+#: .././db/attrset.c:236
 #, c-format
-msgid "START: pass=%d ino=%llu %s %s\n"
+msgid "failed to remove attr %s from inode %llu\n"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:606
+#: .././db/init.c:49
 #, c-format
-msgid "Completed all %d passes\n"
+msgid "Usage: %s [-ifFrxV] [-p prog] [-l logdev] [-c cmd]... device\n"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:616
-msgid "couldn't fork sub process:"
+#: .././db/init.c:117
+msgid ""
+"\n"
+"fatal error -- couldn't initialize XFS library\n"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:651
+#: .././db/init.c:132
 #, c-format
-msgid "%s startpass %d, endpass %d, time %d seconds\n"
+msgid "%s: %s is invalid (cannot read first 512 bytes)\n"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:658
+#: .././db/init.c:144
 #, c-format
-msgid "open(%s) failed: %s\n"
+msgid ""
+"%s: %s is not a valid XFS filesystem (unexpected SB magic number 0x%08x)\n"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:664
+#: .././db/init.c:147
 #, c-format
-msgid "write(%s) failed: %s\n"
+msgid "Use -F to force a read attempt.\n"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:688
+#: .././db/init.c:157
 #, c-format
-msgid "%s start inode=%llu\n"
+msgid "%s: device %s unusable (not an XFS filesystem?)\n"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:693
+#: .././db/init.c:176
 #, c-format
-msgid "unable to get handle: %s: %s\n"
+msgid "%s: cannot init perag data (%d). Continuing anyway.\n"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:699
-#, c-format
-msgid "unable to open: %s: %s\n"
+#: .././db/dquot.c:37
+msgid "[-g|-p|-u] id"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:706
-#, c-format
-msgid "Skipping %s: could not get XFS geometry\n"
+#: .././db/dquot.c:38
+msgid ""
+"set current address to a group, project or user quota block for given ID"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:741
-#, c-format
-msgid "could not open: inode %llu\n"
+#: .././db/dquot.c:129
+msgid "bad option for dquot command\n"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:771
-#, c-format
-msgid "%s: xfs_bulkstat: %s\n"
+#: .././db/dquot.c:133
+msgid "project"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:798
-#, c-format
-msgid "%s: Directory defragmentation not supported\n"
+#: .././db/dquot.c:133
+msgid "group"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:817
-#, c-format
-msgid "unable to construct sys handle for %s: %s\n"
+#: .././db/dquot.c:133
+msgid "user"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:828
+#: .././db/dquot.c:135
 #, c-format
-msgid "unable to open sys handle for %s: %s\n"
+msgid "dquot command requires one %s id argument\n"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:834
+#: .././db/dquot.c:145
 #, c-format
-msgid "unable to get bstat on %s: %s\n"
+msgid "no %s quota inode present\n"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:841
+#: .././db/dquot.c:150
 #, c-format
-msgid "unable to open handle %s: %s\n"
+msgid "bad %s id for dquot %s\n"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:848
+#: .././db/dquot.c:162
 #, c-format
-msgid "Unable to get geom on fs for: %s\n"
+msgid "no %s quota data for id %d\n"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:899
+#: .././estimate/xfs_estimate.c:78
 #, c-format
-msgid "sync failed: %s: %s\n"
+msgid ""
+"Usage: %s [opts] directory [directory ...]\n"
+"\t-b blocksize (fundamental filesystem blocksize)\n"
+"\t-i logsize (internal log size)\n"
+"\t-e logsize (external log size)\n"
+"\t-v prints more verbose messages\n"
+"\t-V prints version and exits\n"
+"\t-h prints this usage message\n"
+"\n"
+"Note:\tblocksize may have 'k' appended to indicate x1024\n"
+"\tlogsize may also have 'm' appended to indicate (1024 x 1024)\n"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:905
+#: .././estimate/xfs_estimate.c:109
 #, c-format
-msgid "%s: zero size, ignoring\n"
+msgid "blocksize %llu too small\n"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:924
+#: .././estimate/xfs_estimate.c:114
 #, c-format
-msgid "locking check failed: %s\n"
+msgid "blocksize %llu too large\n"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:931
+#: .././estimate/xfs_estimate.c:121
 #, c-format
-msgid "mandatory lock: %s: ignoring\n"
+msgid "already have external log noted, can't have both\n"
+msgstr ""
+
+#: .././estimate/xfs_estimate.c:130
+#, c-format
+msgid "already have internal log noted, can't have both\n"
+msgstr ""
+
+#: .././estimate/xfs_estimate.c:160
+#, c-format
+msgid ""
+"directory                               bsize   blocks    megabytes    "
+"logsize\n"
+msgstr ""
+
+#: .././estimate/xfs_estimate.c:174
+#, c-format
+msgid "dirsize=%llu\n"
+msgstr ""
+
+#: .././estimate/xfs_estimate.c:175
+#, c-format
+msgid "fullblocks=%llu\n"
+msgstr ""
+
+#: .././estimate/xfs_estimate.c:176
+#, c-format
+msgid "isize=%llu\n"
+msgstr ""
+
+#: .././estimate/xfs_estimate.c:178
+#, c-format
+msgid "%llu regular files\n"
+msgstr ""
+
+#: .././estimate/xfs_estimate.c:179
+#, c-format
+msgid "%llu symbolic links\n"
+msgstr ""
+
+#: .././estimate/xfs_estimate.c:180
+#, c-format
+msgid "%llu directories\n"
+msgstr ""
+
+#: .././estimate/xfs_estimate.c:181
+#, c-format
+msgid "%llu special files\n"
+msgstr ""
+
+#: .././estimate/xfs_estimate.c:194
+#, c-format
+msgid "%s will take about %.1f megabytes\n"
+msgstr ""
+
+#: .././estimate/xfs_estimate.c:201
+#, c-format
+msgid "%-39s %5llu %8llu %10.1fMB %10llu\n"
+msgstr ""
+
+#: .././estimate/xfs_estimate.c:207
+#, c-format
+msgid "\twith the external log using %llu blocks "
+msgstr ""
+
+#: .././estimate/xfs_estimate.c:209
+#, c-format
+msgid "or about %.1f megabytes\n"
+msgstr ""
+
+#: .././fsr/xfs_fsr.c:268
+#, c-format
+msgid "%s: Stats not yet supported for XFS\n"
+msgstr ""
+
+#: .././fsr/xfs_fsr.c:332
+#, c-format
+msgid "%s: could not stat: %s: %s\n"
+msgstr ""
+
+#: .././fsr/xfs_fsr.c:351
+#, c-format
+msgid "%s: char special not supported: %s\n"
+msgstr ""
+
+#: .././fsr/xfs_fsr.c:357
+#, c-format
+msgid "%s: cannot defragment: %s: Not XFS\n"
+msgstr ""
+
+#: .././fsr/xfs_fsr.c:367
+#, c-format
+msgid "%s: not fsys dev, dir, or reg file, ignoring\n"
+msgstr ""
+
+#: .././fsr/xfs_fsr.c:382
+#, c-format
+msgid ""
+"Usage: %s [-d] [-v] [-g] [-t time] [-p passes] [-f leftf] [-m mtab]\n"
+"       %s [-d] [-v] [-g] xfsdev | dir | file ...\n"
+"       %s -V\n"
+"\n"
+"Options:\n"
+"       -g              Print to syslog (default if stdout not a tty).\n"
+"       -t time         How long to run in seconds.\n"
+"       -p passes       Number of passes before terminating global re-org.\n"
+"       -f leftoff      Use this instead of %s.\n"
+"       -m mtab         Use something other than /etc/mtab.\n"
+"       -d              Debug, print even more.\n"
+"       -v              Verbose, more -v's more verbose.\n"
+"       -V              Print version number and exit.\n"
+msgstr ""
+
+#: .././fsr/xfs_fsr.c:412 .././fsr/xfs_fsr.c:450
+#, c-format
+msgid "out of memory: %s\n"
+msgstr ""
+
+#: .././fsr/xfs_fsr.c:441
+#, c-format
+msgid "Skipping %s: not mounted rw\n"
+msgstr ""
+
+#: .././fsr/xfs_fsr.c:455
+#, c-format
+msgid "out of memory on realloc: %s\n"
+msgstr ""
+
+#: .././fsr/xfs_fsr.c:466 .././fsr/xfs_fsr.c:470
+#, c-format
+msgid "strdup(%s) failed\n"
+msgstr ""
+
+#: .././fsr/xfs_fsr.c:481
+#, c-format
+msgid "no rw xfs file systems in mtab: %s\n"
+msgstr ""
+
+#: .././fsr/xfs_fsr.c:485
+#, c-format
+msgid "Found %d mounted, writable, XFS filesystems\n"
+msgstr ""
+
+#: .././fsr/xfs_fsr.c:515
+#, c-format
+msgid "%s: open failed\n"
+msgstr ""
+
+#: .././fsr/xfs_fsr.c:530
+#, c-format
+msgid "Can't use %s: mode=0%o own=%d nlink=%d\n"
+msgstr ""
+
+#: .././fsr/xfs_fsr.c:550
+#, c-format
+msgid "could not read %s, starting with %s\n"
+msgstr ""
+
+#: .././fsr/xfs_fsr.c:589
+#, c-format
+msgid "START: pass=%d ino=%llu %s %s\n"
+msgstr ""
+
+#: .././fsr/xfs_fsr.c:611
+msgid "couldn't fork sub process:"
+msgstr ""
+
+#: .././fsr/xfs_fsr.c:632
+#, c-format
+msgid "Completed all %d passes\n"
+msgstr ""
+
+#: .././fsr/xfs_fsr.c:652
+#, c-format
+msgid "%s startpass %d, endpass %d, time %d seconds\n"
+msgstr ""
+
+#: .././fsr/xfs_fsr.c:659
+#, c-format
+msgid "open(%s) failed: %s\n"
+msgstr ""
+
+#: .././fsr/xfs_fsr.c:665
+#, c-format
+msgid "write(%s) failed: %s\n"
+msgstr ""
+
+#: .././fsr/xfs_fsr.c:689
+#, c-format
+msgid "%s start inode=%llu\n"
+msgstr ""
+
+#: .././fsr/xfs_fsr.c:694
+#, c-format
+msgid "unable to get handle: %s: %s\n"
+msgstr ""
+
+#: .././fsr/xfs_fsr.c:700
+#, c-format
+msgid "unable to open: %s: %s\n"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:944
+#: .././fsr/xfs_fsr.c:707
+#, c-format
+msgid "Skipping %s: could not get XFS geometry\n"
+msgstr ""
+
+#: .././fsr/xfs_fsr.c:742
+#, c-format
+msgid "could not open: inode %llu\n"
+msgstr ""
+
+#: .././fsr/xfs_fsr.c:772
+#, c-format
+msgid "%s: xfs_bulkstat: %s\n"
+msgstr ""
+
+#: .././fsr/xfs_fsr.c:799
+#, c-format
+msgid "%s: Directory defragmentation not supported\n"
+msgstr ""
+
+#: .././fsr/xfs_fsr.c:818
+#, c-format
+msgid "unable to construct sys handle for %s: %s\n"
+msgstr ""
+
+#: .././fsr/xfs_fsr.c:829
+#, c-format
+msgid "unable to open sys handle for %s: %s\n"
+msgstr ""
+
+#: .././fsr/xfs_fsr.c:835
+#, c-format
+msgid "unable to get bstat on %s: %s\n"
+msgstr ""
+
+#: .././fsr/xfs_fsr.c:842
+#, c-format
+msgid "unable to open handle %s: %s\n"
+msgstr ""
+
+#: .././fsr/xfs_fsr.c:849
+#, c-format
+msgid "Unable to get geom on fs for: %s\n"
+msgstr ""
+
+#: .././fsr/xfs_fsr.c:900
+#, c-format
+msgid "sync failed: %s: %s\n"
+msgstr ""
+
+#: .././fsr/xfs_fsr.c:906
+#, c-format
+msgid "%s: zero size, ignoring\n"
+msgstr ""
+
+#: .././fsr/xfs_fsr.c:925
+#, c-format
+msgid "locking check failed: %s\n"
+msgstr ""
+
+#: .././fsr/xfs_fsr.c:932
+#, c-format
+msgid "mandatory lock: %s: ignoring\n"
+msgstr ""
+
+#: .././fsr/xfs_fsr.c:945
 #, c-format
 msgid "unable to get fs stat on %s: %s\n"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:951
+#: .././fsr/xfs_fsr.c:952
 #, c-format
 msgid "insufficient freespace for: %s: size=%lld: ignoring\n"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:958
+#: .././fsr/xfs_fsr.c:959
 #, c-format
 msgid "failed to get inode attrs: %s\n"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:963
+#: .././fsr/xfs_fsr.c:964
 #, c-format
 msgid "%s: immutable/append, ignoring\n"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:968
+#: .././fsr/xfs_fsr.c:969
 #, c-format
 msgid "%s: marked as don't defrag, ignoring\n"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:974
+#: .././fsr/xfs_fsr.c:975
 #, c-format
 msgid "cannot get realtime geometry for: %s\n"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:979
+#: .././fsr/xfs_fsr.c:980
 #, c-format
 msgid "low on realtime free space: %s: ignoring file\n"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:986
+#: .././fsr/xfs_fsr.c:987
 #, c-format
 msgid "cannot open: %s: Permission denied\n"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:1045 .././fsr/xfs_fsr.c:1095 .././fsr/xfs_fsr.c:1175
+#: .././fsr/xfs_fsr.c:1046 .././fsr/xfs_fsr.c:1096 .././fsr/xfs_fsr.c:1176
 msgid "could not set ATTR\n"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:1054
+#: .././fsr/xfs_fsr.c:1055
 #, c-format
 msgid "unable to stat temp file: %s\n"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:1072
+#: .././fsr/xfs_fsr.c:1073
 #, c-format
 msgid "unable to get bstat on temp file: %s\n"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:1077
+#: .././fsr/xfs_fsr.c:1078
 #, c-format
 msgid "orig forkoff %d, temp forkoff %d\n"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:1130
+#: .././fsr/xfs_fsr.c:1131
 msgid "big ATTR set failed\n"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:1151
+#: .././fsr/xfs_fsr.c:1152
 #, c-format
 msgid "forkoff diff %d too large!\n"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:1168
+#: .././fsr/xfs_fsr.c:1169
 #, c-format
 msgid "data fork growth unimplemented\n"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:1183
+#: .././fsr/xfs_fsr.c:1184
 msgid "set temp attr\n"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:1186
+#: .././fsr/xfs_fsr.c:1187
 msgid "failed to match fork offset\n"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:1233
+#: .././fsr/xfs_fsr.c:1234
 #, c-format
 msgid "%s already fully defragmented.\n"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:1239
+#: .././fsr/xfs_fsr.c:1240
 #, c-format
 msgid "%s extents=%d can_save=%d tmp=%s\n"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:1245
+#: .././fsr/xfs_fsr.c:1246
 #, c-format
 msgid "could not open tmp file: %s: %s\n"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:1253
+#: .././fsr/xfs_fsr.c:1254
 #, c-format
 msgid "failed to set ATTR fork on tmp: %s:\n"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:1260
+#: .././fsr/xfs_fsr.c:1261
 #, c-format
 msgid "could not set inode attrs on tmp: %s\n"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:1267
+#: .././fsr/xfs_fsr.c:1268
 #, c-format
 msgid "could not get DirectIO info on tmp: %s\n"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:1282
+#: .././fsr/xfs_fsr.c:1283
 #, c-format
 msgid "DEBUG: fsize=%lld blsz_dio=%d d_min=%d d_max=%d pgsz=%d\n"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:1289
+#: .././fsr/xfs_fsr.c:1290
 #, c-format
 msgid "could not allocate buf: %s\n"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:1299
+#: .././fsr/xfs_fsr.c:1300
 #, c-format
 msgid "could not open fragfile: %s : %s\n"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:1314
+#: .././fsr/xfs_fsr.c:1315
 #, c-format
 msgid "could not trunc tmp %s\n"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:1318 .././fsr/xfs_fsr.c:1338 .././fsr/xfs_fsr.c:1366
+#: .././fsr/xfs_fsr.c:1319 .././fsr/xfs_fsr.c:1339 .././fsr/xfs_fsr.c:1367
 #, c-format
 msgid "could not lseek in tmpfile: %s : %s\n"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:1333
+#: .././fsr/xfs_fsr.c:1334
 #, c-format
 msgid "could not pre-allocate tmp space: %s\n"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:1346
+#: .././fsr/xfs_fsr.c:1347
 msgid "Couldn't rewind on temporary file\n"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:1353
+#: .././fsr/xfs_fsr.c:1354
 #, c-format
 msgid "Temporary file has %d extents (%d in original)\n"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:1356
+#: .././fsr/xfs_fsr.c:1357
 #, c-format
 msgid "No improvement will be made (skipping): %s\n"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:1371
+#: .././fsr/xfs_fsr.c:1372
 #, c-format
 msgid "could not lseek in file: %s : %s\n"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:1407
+#: .././fsr/xfs_fsr.c:1408
 #, c-format
 msgid "bad read of %d bytes from %s: %s\n"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:1411 .././fsr/xfs_fsr.c:1443
+#: .././fsr/xfs_fsr.c:1412 .././fsr/xfs_fsr.c:1444
 #, c-format
 msgid "bad write of %d bytes to %s: %s\n"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:1428
+#: .././fsr/xfs_fsr.c:1429
 #, c-format
 msgid "bad write2 of %d bytes to %s: %s\n"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:1433
+#: .././fsr/xfs_fsr.c:1434
 #, c-format
 msgid "bad copy to %s\n"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:1451
+#: .././fsr/xfs_fsr.c:1452
 #, c-format
 msgid "could not truncate tmpfile: %s : %s\n"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:1456
+#: .././fsr/xfs_fsr.c:1457
 #, c-format
 msgid "could not fsync tmpfile: %s : %s\n"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:1471
+#: .././fsr/xfs_fsr.c:1472
 #, c-format
 msgid "failed to fchown tmpfile %s: %s\n"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:1481
+#: .././fsr/xfs_fsr.c:1482
 #, c-format
 msgid "%s: file type not supported\n"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:1485
+#: .././fsr/xfs_fsr.c:1486
 #, c-format
 msgid "%s: file modified defrag aborted\n"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:1490
+#: .././fsr/xfs_fsr.c:1491
 #, c-format
 msgid "%s: file busy\n"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:1492
+#: .././fsr/xfs_fsr.c:1493
 #, c-format
 msgid "XFS_IOC_SWAPEXT failed: %s: %s\n"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:1500
+#: .././fsr/xfs_fsr.c:1501
 #, c-format
 msgid "extents before:%d after:%d %s %s\n"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:1534
+#: .././fsr/xfs_fsr.c:1535
 #, c-format
 msgid "tmp file name too long: %s\n"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:1584
+#: .././fsr/xfs_fsr.c:1585
 #, c-format
 msgid "realloc failed: %s\n"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:1597
+#: .././fsr/xfs_fsr.c:1598
 #, c-format
 msgid "malloc failed: %s\n"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:1627
+#: .././fsr/xfs_fsr.c:1628
 #, c-format
 msgid "failed reading extents: inode %llu"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:1677
+#: .././fsr/xfs_fsr.c:1678
 msgid "failed reading extents"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:1765 .././fsr/xfs_fsr.c:1779
+#: .././fsr/xfs_fsr.c:1766 .././fsr/xfs_fsr.c:1780
 #, c-format
 msgid "tmpdir already exists: %s\n"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:1768
+#: .././fsr/xfs_fsr.c:1769
 #, c-format
 msgid "could not create tmpdir: %s: %s\n"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:1781
+#: .././fsr/xfs_fsr.c:1782
 #, c-format
 msgid "cannot create tmpdir: %s: %s\n"
 msgstr ""
 
-#: .././fsr/xfs_fsr.c:1819 .././fsr/xfs_fsr.c:1827
+#: .././fsr/xfs_fsr.c:1820 .././fsr/xfs_fsr.c:1828
 #, c-format
 msgid "could not remove tmpdir: %s: %s\n"
 msgstr ""
@@ -3529,222 +3677,202 @@ msgid ""
 "realtime =%-22s extsz=%-6u blocks=%llu, rtextents=%llu\n"
 msgstr ""
 
-#: .././growfs/xfs_growfs.c:85 .././growfs/xfs_growfs.c:466
-#: .././growfs/xfs_growfs.c:467
+#: .././growfs/xfs_growfs.c:85 .././growfs/xfs_growfs.c:474
+#: .././growfs/xfs_growfs.c:475
 msgid "internal"
 msgstr ""
 
 #: .././growfs/xfs_growfs.c:85 .././growfs/xfs_growfs.c:88
-#: .././growfs/xfs_growfs.c:466 .././growfs/xfs_growfs.c:467
+#: .././growfs/xfs_growfs.c:474 .././growfs/xfs_growfs.c:475
 msgid "external"
 msgstr ""
 
-#: .././growfs/xfs_growfs.c:207
+#: .././growfs/xfs_growfs.c:208
+#, c-format
+msgid "%s: path resolution failed for %s: %s\n"
+msgstr ""
+
+#: .././growfs/xfs_growfs.c:215
 #, c-format
 msgid "%s: %s is not a mounted XFS filesystem\n"
 msgstr ""
 
-#: .././growfs/xfs_growfs.c:224
+#: .././growfs/xfs_growfs.c:232
 #, c-format
 msgid "%s: specified file [\"%s\"] is not on an XFS filesystem\n"
 msgstr ""
 
-#: .././growfs/xfs_growfs.c:241
+#: .././growfs/xfs_growfs.c:249
 #, c-format
 msgid "%s: cannot determine geometry of filesystem mounted at %s: %s\n"
 msgstr ""
 
-#: .././growfs/xfs_growfs.c:285
+#: .././growfs/xfs_growfs.c:293
 #, c-format
 msgid "%s: failed to access data device for %s\n"
 msgstr ""
 
-#: .././growfs/xfs_growfs.c:290
+#: .././growfs/xfs_growfs.c:298
 #, c-format
 msgid "%s: failed to access external log for %s\n"
 msgstr ""
 
-#: .././growfs/xfs_growfs.c:296
+#: .././growfs/xfs_growfs.c:304
 #, c-format
 msgid "%s: failed to access realtime device for %s\n"
 msgstr ""
 
-#: .././growfs/xfs_growfs.c:336
+#: .././growfs/xfs_growfs.c:344
 #, c-format
 msgid "data size %lld too large, maximum is %lld\n"
 msgstr ""
 
-#: .././growfs/xfs_growfs.c:343
+#: .././growfs/xfs_growfs.c:351
 #, c-format
 msgid "data size %lld too small, old size is %lld\n"
 msgstr ""
 
-#: .././growfs/xfs_growfs.c:351
+#: .././growfs/xfs_growfs.c:359
 #, c-format
 msgid "data size unchanged, skipping\n"
 msgstr ""
 
-#: .././growfs/xfs_growfs.c:354
+#: .././growfs/xfs_growfs.c:362
 #, c-format
 msgid "inode max pct unchanged, skipping\n"
 msgstr ""
 
-#: .././growfs/xfs_growfs.c:361 .././growfs/xfs_growfs.c:400
-#: .././growfs/xfs_growfs.c:435
+#: .././growfs/xfs_growfs.c:369 .././growfs/xfs_growfs.c:408
+#: .././growfs/xfs_growfs.c:443
 #, c-format
 msgid "%s: growfs operation in progress already\n"
 msgstr ""
 
-#: .././growfs/xfs_growfs.c:365
+#: .././growfs/xfs_growfs.c:373
 #, c-format
 msgid "%s: XFS_IOC_FSGROWFSDATA xfsctl failed: %s\n"
 msgstr ""
 
-#: .././growfs/xfs_growfs.c:381
+#: .././growfs/xfs_growfs.c:389
 #, c-format
 msgid "realtime size %lld too large, maximum is %lld\n"
 msgstr ""
 
-#: .././growfs/xfs_growfs.c:387
+#: .././growfs/xfs_growfs.c:395
 #, c-format
 msgid "realtime size %lld too small, old size is %lld\n"
 msgstr ""
 
-#: .././growfs/xfs_growfs.c:393
+#: .././growfs/xfs_growfs.c:401
 #, c-format
 msgid "realtime size unchanged, skipping\n"
 msgstr ""
 
-#: .././growfs/xfs_growfs.c:404
+#: .././growfs/xfs_growfs.c:412
 #, c-format
 msgid "%s: realtime growth not implemented\n"
 msgstr ""
 
-#: .././growfs/xfs_growfs.c:408
+#: .././growfs/xfs_growfs.c:416
 #, c-format
 msgid "%s: XFS_IOC_FSGROWFSRT xfsctl failed: %s\n"
 msgstr ""
 
-#: .././growfs/xfs_growfs.c:429
+#: .././growfs/xfs_growfs.c:437
 #, c-format
 msgid "log size unchanged, skipping\n"
 msgstr ""
 
-#: .././growfs/xfs_growfs.c:439
+#: .././growfs/xfs_growfs.c:447
 #, c-format
 msgid "%s: log growth not supported yet\n"
 msgstr ""
 
-#: .././growfs/xfs_growfs.c:443
+#: .././growfs/xfs_growfs.c:451
 #, c-format
 msgid "%s: XFS_IOC_FSGROWFSLOG xfsctl failed: %s\n"
 msgstr ""
 
-#: .././growfs/xfs_growfs.c:451
+#: .././growfs/xfs_growfs.c:459
 #, c-format
 msgid "%s: XFS_IOC_FSGEOMETRY xfsctl failed: %s\n"
 msgstr ""
 
-#: .././growfs/xfs_growfs.c:456
+#: .././growfs/xfs_growfs.c:464
 #, c-format
 msgid "data blocks changed from %lld to %lld\n"
 msgstr ""
 
-#: .././growfs/xfs_growfs.c:459
+#: .././growfs/xfs_growfs.c:467
 #, c-format
 msgid "inode max percent changed from %d to %d\n"
 msgstr ""
 
-#: .././growfs/xfs_growfs.c:462
+#: .././growfs/xfs_growfs.c:470
 #, c-format
 msgid "log blocks changed from %d to %d\n"
 msgstr ""
 
-#: .././growfs/xfs_growfs.c:465
+#: .././growfs/xfs_growfs.c:473
 #, c-format
 msgid "log changed from %s to %s\n"
 msgstr ""
 
-#: .././growfs/xfs_growfs.c:469
+#: .././growfs/xfs_growfs.c:477
 #, c-format
 msgid "realtime blocks changed from %lld to %lld\n"
 msgstr ""
 
-#: .././growfs/xfs_growfs.c:472
+#: .././growfs/xfs_growfs.c:480
 #, c-format
 msgid "realtime extent size changed from %d to %d\n"
 msgstr ""
 
-#: .././io/fsync.c:59
-msgid "calls fsync(2) to flush all in-core file state to disk"
-msgstr ""
-
-#: .././io/fsync.c:66
-msgid "calls fdatasync(2) to flush the files in-core data to disk"
-msgstr ""
-
-#: .././io/madvise.c:31
+#: .././io/fadvise.c:30
 #, c-format
 msgid ""
 "\n"
-" advise the page cache about access patterns expected for a mapping\n"
+" advise the page cache about expected I/O patterns on the current file\n"
 "\n"
-" Modifies page cache behavior when operating on the current mapping.\n"
+" Modifies kernel page cache behaviour when operating on the current file.\n"
 " The range arguments are required by some advise commands ([*] below).\n"
-" With no arguments, the POSIX_MADV_NORMAL advice is implied.\n"
-" -d -- don't need these pages (POSIX_MADV_DONTNEED) [*]\n"
-" -r -- expect random page references (POSIX_MADV_RANDOM)\n"
-" -s -- expect sequential page references (POSIX_MADV_SEQUENTIAL)\n"
-" -w -- will need these pages (POSIX_MADV_WILLNEED) [*]\n"
-" Notes:\n"
+" With no arguments, the POSIX_FADV_NORMAL advice is implied.\n"
+" -d -- don't need these pages (POSIX_FADV_DONTNEED) [*]\n"
+" -n -- data will be accessed once (POSIX_FADV_NOREUSE) [*]\n"
+" -r -- expect random page references (POSIX_FADV_RANDOM)\n"
+" -s -- expect sequential page references (POSIX_FADV_SEQUENTIAL)\n"
+" -w -- will need these pages (POSIX_FADV_WILLNEED) [*]\n"
+" Notes: these interfaces are not supported in Linux kernels before 2.6.\n"
 "   NORMAL sets the default readahead setting on the file.\n"
 "   RANDOM sets the readahead setting on the file to zero.\n"
 "   SEQUENTIAL sets double the default readahead setting on the file.\n"
-"   WILLNEED forces the maximum readahead.\n"
+"   WILLNEED and NOREUSE are equivalent, and force the maximum readahead.\n"
 "\n"
 msgstr ""
 
-#: .././io/madvise.c:86 .././io/mincore.c:47 .././io/fadvise.c:91
-#: .././io/sync_file_range.c:74 .././io/mmap.c:213 .././io/mmap.c:320
+#: .././io/fadvise.c:91 .././io/sendfile.c:124 .././io/madvise.c:86
+#: .././io/mincore.c:47 .././io/mmap.c:213 .././io/mmap.c:320
 #: .././io/mmap.c:406 .././io/mmap.c:565 .././io/mmap.c:647
-#: .././io/prealloc.c:73 .././io/pwrite.c:346 .././io/sendfile.c:124
+#: .././io/prealloc.c:73 .././io/pwrite.c:397 .././io/sync_file_range.c:74
 #, c-format
 msgid "non-numeric offset argument -- %s\n"
 msgstr ""
 
-#: .././io/madvise.c:93 .././io/mincore.c:53 .././io/fadvise.c:98
-#: .././io/sync_file_range.c:81 .././io/mmap.c:219 .././io/mmap.c:327
-#: .././io/mmap.c:413 .././io/mmap.c:572 .././io/pread.c:454
-#: .././io/pread.c:462 .././io/prealloc.c:78 .././io/pwrite.c:352
-#: .././io/sendfile.c:131
+#: .././io/fadvise.c:98 .././io/sendfile.c:131 .././io/madvise.c:93
+#: .././io/mincore.c:53 .././io/mmap.c:219 .././io/mmap.c:327
+#: .././io/mmap.c:413 .././io/mmap.c:572 .././io/pread.c:456
+#: .././io/pread.c:464 .././io/prealloc.c:78 .././io/pwrite.c:403
+#: .././io/sync_file_range.c:81
 #, c-format
 msgid "non-numeric length argument -- %s\n"
 msgstr ""
 
-#: .././io/madvise.c:97 .././io/mincore.c:57
-#, c-format
-msgid "length argument too large -- %lld\n"
-msgstr ""
-
-#: .././io/madvise.c:126
-msgid "[-drsw] [off len]"
-msgstr ""
-
-#: .././io/madvise.c:127
-msgid "give advice about use of memory"
-msgstr ""
-
-#: .././io/mincore.c:91 .././io/mincore.c:101
-#, c-format
-msgid "0x%lx  %lu pages (%llu : %lu)\n"
-msgstr ""
-
-#: .././io/mincore.c:121
-msgid "[off len]"
+#: .././io/fadvise.c:121
+msgid "[-dnrsw] [off len]"
 msgstr ""
 
-#: .././io/mincore.c:122
-msgid "find mapping pages that are memory resident"
+#: .././io/fadvise.c:122
+msgid "advisory commands for sections of a file"
 msgstr ""
 
 #: .././io/parent.c:48
@@ -3927,394 +4055,507 @@ msgstr ""
 msgid "print or check parent inodes"
 msgstr ""
 
-#: .././io/fadvise.c:30
+#: .././io/freeze.c:36
 #, c-format
-msgid ""
-"\n"
-" advise the page cache about expected I/O patterns on the current file\n"
-"\n"
-" Modifies kernel page cache behaviour when operating on the current file.\n"
-" The range arguments are required by some advise commands ([*] below).\n"
-" With no arguments, the POSIX_FADV_NORMAL advice is implied.\n"
-" -d -- don't need these pages (POSIX_FADV_DONTNEED) [*]\n"
-" -n -- data will be accessed once (POSIX_FADV_NOREUSE) [*]\n"
-" -r -- expect random page references (POSIX_FADV_RANDOM)\n"
-" -s -- expect sequential page references (POSIX_FADV_SEQUENTIAL)\n"
-" -w -- will need these pages (POSIX_FADV_WILLNEED) [*]\n"
-" Notes: these interfaces are not supported in Linux kernels before 2.6.\n"
-"   NORMAL sets the default readahead setting on the file.\n"
-"   RANDOM sets the readahead setting on the file to zero.\n"
-"   SEQUENTIAL sets double the default readahead setting on the file.\n"
-"   WILLNEED and NOREUSE are equivalent, and force the maximum readahead.\n"
-"\n"
+msgid "%s: cannot freeze filesystem at %s: %s\n"
 msgstr ""
 
-#: .././io/fadvise.c:121
-msgid "[-dnrsw] [off len]"
+#: .././io/freeze.c:53
+#, c-format
+msgid "%s: cannot unfreeze filesystem mounted at %s: %s\n"
 msgstr ""
 
-#: .././io/fadvise.c:122
-msgid "advisory commands for sections of a file"
+#: .././io/freeze.c:69
+msgid "freeze filesystem of current file"
 msgstr ""
 
-#: .././io/sync_file_range.c:30
+#: .././io/freeze.c:76
+msgid "unfreeze filesystem of current file"
+msgstr ""
+
+#: .././io/reflink.c:32
 #, c-format
 msgid ""
 "\n"
-" Trigger specific writeback commands on a range of the current file\n"
+" Links a range of bytes (in block size increments) from a file into a range\n"
+" of bytes in the open file.  The contents of both file ranges must match.\n"
 "\n"
-" With no options, the SYNC_FILE_RANGE_WRITE is implied.\n"
-" -a -- wait for IO to finish after writing (SYNC_FILE_RANGE_WAIT_AFTER).\n"
-" -b -- wait for IO to finish before writing (SYNC_FILE_RANGE_WAIT_BEFORE).\n"
-" -w -- write dirty data in range (SYNC_FILE_RANGE_WRITE).\n"
+" Example:\n"
+" 'dedupe some_file 0 4096 32768' - links 32768 bytes from some_file at\n"
+"                                    offset 0 to into the open file at\n"
+"                                    position 4096\n"
 "\n"
+" Reflink a range of blocks from a given input file to the open file.  Both\n"
+" files share the same range of physical disk blocks; a write to the shared\n"
+" range of either file should result in the write landing in a new block and\n"
+" that range of the file being remapped (i.e. copy-on-write).  Both files\n"
+" must reside on the same filesystem, and the contents of both ranges must\n"
+" match.\n"
 msgstr ""
 
-#: .././io/sync_file_range.c:101
-msgid "[-abw] off len"
-msgstr ""
-
-#: .././io/sync_file_range.c:102
-msgid "Control writeback on a range of a file"
-msgstr ""
-
-#: .././io/mmap.c:78
-#, c-format
-msgid "offset (%lld) is before start of mapping (%lld)\n"
+#: .././io/reflink.c:87
+msgid "Extents did not match."
 msgstr ""
 
-#: .././io/mmap.c:84
+#: .././io/reflink.c:141 .././io/reflink.c:264
 #, c-format
-msgid "offset (%lld) is beyond end of mapping (%lld)\n"
+msgid "non-numeric src offset argument -- %s\n"
 msgstr ""
 
-#: .././io/mmap.c:89
+#: .././io/reflink.c:147 .././io/reflink.c:270
 #, c-format
-msgid "range (%lld:%lld) is beyond mapping (%lld:%ld)\n"
+msgid "non-numeric dest offset argument -- %s\n"
 msgstr ""
 
-#: .././io/mmap.c:95
+#: .././io/reflink.c:153 .././io/reflink.c:276
 #, c-format
-msgid "offset address (%p) is not page aligned\n"
+msgid "non-positive length argument -- %s\n"
 msgstr ""
 
-#: .././io/mmap.c:135
+#: .././io/reflink.c:178
 #, c-format
 msgid ""
 "\n"
-" maps a range within the current file into memory\n"
+" Links a range of bytes (in block size increments) from a file into a range\n"
+" of bytes in the open file.  The two extent ranges need not contain "
+"identical\n"
+" data.\n"
 "\n"
 " Example:\n"
-" 'mmap -rw 0 1m' - maps one megabyte from the start of the current file\n"
-"\n"
-" Memory maps a range of a file for subsequent use by other xfs_io commands.\n"
-" With no arguments, mmap shows the current mappings.  The current mapping\n"
-" can be set by using the single argument form (mapping number or address).\n"
-" If two arguments are specified (a range), a new mapping is created and the\n"
-" following options are available:\n"
-" -r -- map with PROT_READ protection\n"
-" -w -- map with PROT_WRITE protection\n"
-" -x -- map with PROT_EXEC protection\n"
-" -s <size> -- first do mmap(size)/munmap(size), try to reserve some free "
-"space\n"
-" If no protection mode is specified, all are used by default.\n"
+" 'reflink some_file 0 4096 32768' - links 32768 bytes from some_file at\n"
+"                                    offset 0 to into the open file at\n"
+"                                    position 4096\n"
+" 'reflink some_file' - links all bytes from some_file into the open file\n"
+"                       at position 0\n"
 "\n"
+" Reflink a range of blocks from a given input file to the open file.  Both\n"
+" files share the same range of physical disk blocks; a write to the shared\n"
+" range of either file should result in the write landing in a new block and\n"
+" that range of the file being remapped (i.e. copy-on-write).  Both files\n"
+" must reside on the same filesystem.\n"
 msgstr ""
 
-#: .././io/mmap.c:170 .././io/mmap.c:177 .././io/init.c:115
-#, c-format
-msgid "no mapped regions, try 'help mmap'\n"
+#: .././io/reflink.c:309
+msgid "infile [src_off dst_off len]"
 msgstr ""
 
-#: .././io/mmap.c:171 .././io/mmap.c:178 .././io/mmap.c:181 .././io/open.c:294
-#: .././io/init.c:111
-#, c-format
-msgid "no files are open, try 'help open'\n"
+#: .././io/reflink.c:311
+msgid "reflinks an entire file, or a number of bytes at a specified offset"
 msgstr ""
 
-#: .././io/mmap.c:273
-#, c-format
-msgid ""
-"\n"
-" flushes a range of bytes in the current memory mapping\n"
-"\n"
-" Writes all modified copies of pages over the specified range (or entire\n"
-" mapping if no range specified) to their backing storage locations.  Also,\n"
-" optionally invalidates so that subsequent references to the pages will be\n"
-" obtained from their backing storage locations (instead of cached copies).\n"
-" -a -- perform asynchronous writes (MS_ASYNC)\n"
-" -i -- invalidate mapped pages (MS_INVALIDATE)\n"
-" -s -- perform synchronous writes (MS_SYNC)\n"
-"\n"
+#: .././io/reflink.c:323
+msgid "infile src_off dst_off len"
 msgstr ""
 
-#: .././io/mmap.c:349
-#, c-format
-msgid ""
-"\n"
-" reads a range of bytes in the current memory mapping\n"
-"\n"
-" Example:\n"
-" 'mread -v 512 20' - dumps 20 bytes read from 512 bytes into the mapping\n"
-"\n"
-" Accesses a range of the current memory mapping, optionally dumping it to\n"
-" the standard output stream (with -v option) for subsequent inspection.\n"
-" -f -- verbose mode, dump bytes with offsets relative to start of file.\n"
-" -r -- reverse order; start accessing from the end of range, moving "
-"backward\n"
-" -v -- verbose mode, dump bytes with offsets relative to start of mapping.\n"
-" The accesses are performed sequentially from the start offset by default.\n"
-" Notes:\n"
-"   References to whole pages following the end of the backing file results\n"
-"   in delivery of the SIGBUS signal.  SIGBUS signals may also be delivered\n"
-"   on various filesystem conditions, including quota exceeded errors, and\n"
-"   for physical device errors (such as unreadable disk blocks).  No attempt\n"
-"   has been made to catch signals at this stage...\n"
-"\n"
+#: .././io/reflink.c:325
+msgid "dedupes a number of bytes at a specified offset"
 msgstr ""
 
-#: .././io/mmap.c:513
+#: .././io/sendfile.c:31
 #, c-format
 msgid ""
 "\n"
-" dirties a range of bytes in the current memory mapping\n"
+" transfer a range of bytes from the given offset between files\n"
 "\n"
 " Example:\n"
-" 'mwrite 512 20 - writes 20 bytes at 512 bytes into the current mapping.\n"
+" 'send -f 2 512 20' - writes 20 bytes at 512 bytes into the open file\n"
 "\n"
-" Stores a byte into memory for a range within a mapping.\n"
-" The default stored value is 'X', repeated to fill the range specified.\n"
-" -S -- use an alternate seed character\n"
-" -r -- reverse order; start storing from the end of range, moving backward\n"
-" The stores are performed sequentially from the start offset by default.\n"
+" Copies data between one file descriptor and another.  Because this copying\n"
+" is done within the kernel, sendfile does not need to transfer data to and\n"
+" from user space.\n"
+" -f -- specifies an input file from which to source data to write\n"
+" -i -- specifies an input file name from which to source data to write.\n"
+" An offset and length in the source file can be optionally specified.\n"
 "\n"
 msgstr ""
 
-#: .././io/mmap.c:549 .././io/pread.c:439 .././io/pwrite.c:305
-#: .././io/pwrite.c:332
+#: .././io/sendfile.c:101 .././io/file.c:81 .././quota/path.c:126
 #, c-format
-msgid "non-numeric seed -- %s\n"
+msgid "value %d is out of range (0-%d)\n"
 msgstr ""
 
-#: .././io/mmap.c:601
-#, c-format
-msgid ""
-"\n"
-" resizes the current memory mapping\n"
-"\n"
-" Examples:\n"
-" 'mremap 8192' - resizes the current mapping to 8192 bytes.\n"
-"\n"
-" Resizes the mappping, growing or shrinking from the current size.\n"
-" The default stored value is 'X', repeated to fill the range specified.\n"
-" -f <new_address> -- use MREMAP_FIXED flag to mremap on new_address\n"
-" -m -- use the MREMAP_MAYMOVE flag\n"
-"\n"
+#: .././io/sendfile.c:171
+msgid "-i infile | -f N [off len]"
 msgstr ""
 
-#: .././io/mmap.c:678
-msgid "[N] | [-rwx] [-s size] [off len]"
+#: .././io/sendfile.c:173
+msgid "Transfer data directly between file descriptors"
 msgstr ""
 
-#: .././io/mmap.c:680
-msgid "mmap a range in the current file, show mappings"
+#: .././io/truncate.c:37
+#, c-format
+msgid "non-numeric truncate argument -- %s\n"
 msgstr ""
 
-#: .././io/mmap.c:689
-msgid "[-r] [off len]"
+#: .././io/truncate.c:57
+msgid "off"
 msgstr ""
 
-#: .././io/mmap.c:691
-msgid "reads data from a region in the current memory mapping"
-msgstr ""
+#: .././io/truncate.c:59
+msgid "truncates the current file at the given offset"
+msgstr ""
 
-#: .././io/mmap.c:700
-msgid "[-ais] [off len]"
+#: .././io/fiemap.c:35
+#, c-format
+msgid ""
+"\n"
+" prints the block mapping for a file's data or attribute forks\n"
+" Example:\n"
+" 'fiemap -v' - tabular format verbose map\n"
+"\n"
+" fiemap prints the map of disk blocks used by the current file.\n"
+" The map lists each extent used by the file, as well as regions in the\n"
+" file that do not have any corresponding blocks (holes).\n"
+" By default, each line of the listing takes the following form:\n"
+"     extent: [startoffset..endoffset]: startblock..endblock\n"
+" Holes are marked by replacing the startblock..endblock with 'hole'.\n"
+" All the file offsets and disk blocks are in units of 512-byte blocks.\n"
+" -a -- prints the attribute fork map instead of the data fork.\n"
+" -l -- also displays the length of each extent in 512-byte blocks.\n"
+" -n -- query n extents.\n"
+" -v -- Verbose information\n"
+"\n"
 msgstr ""
 
-#: .././io/mmap.c:701
-msgid "flush a region in the current memory mapping"
+#: .././io/fiemap.c:72 .././io/fiemap.c:171
+#, c-format
+msgid " %llu blocks\n"
 msgstr ""
 
-#: .././io/mmap.c:710
-msgid "unmaps the current memory mapping"
+#: .././io/fiemap.c:80 .././io/bmap.c:250 .././io/bmap.c:385
+#, c-format
+msgid "hole"
 msgstr ""
 
-#: .././io/mmap.c:718
-msgid "[-r] [-S seed] [off len]"
+#: .././io/fiemap.c:114 .././io/fsmap.c:266 .././io/bmap.c:341
+msgid "EXT"
 msgstr ""
 
-#: .././io/mmap.c:720
-msgid "writes data into a region in the current memory mapping"
+#: .././io/fiemap.c:115 .././io/fsmap.c:270 .././io/bmap.c:342
+msgid "FILE-OFFSET"
 msgstr ""
 
-#: .././io/mmap.c:730
-msgid "[-m|-f <new_address>] newsize"
+#: .././io/fiemap.c:116 .././io/fsmap.c:268 .././io/bmap.c:343
+msgid "BLOCK-RANGE"
 msgstr ""
 
-#: .././io/mmap.c:732
-msgid "alters the size of the current memory mapping"
+#: .././io/fiemap.c:117 .././io/fsmap.c:273 .././io/bmap.c:346
+msgid "TOTAL"
 msgstr ""
 
-#: .././io/open.c:69
-msgid "socket"
+#: .././io/fiemap.c:118
+msgid "FLAGS"
 msgstr ""
 
-#: .././io/open.c:71 .././repair/da_util.c:105
-msgid "directory"
+#: .././io/fiemap.c:264 .././io/bmap.c:148
+#, c-format
+msgid "%s: malloc of %d bytes failed.\n"
 msgstr ""
 
-#: .././io/open.c:73
-msgid "char device"
+#: .././io/fiemap.c:356
+msgid "[-alv] [-n nx]"
 msgstr ""
 
-#: .././io/open.c:75
-msgid "block device"
+#: .././io/fiemap.c:357
+msgid "print block mapping for a file"
 msgstr ""
 
-#: .././io/open.c:77
-msgid "regular file"
+#: .././io/fsmap.c:34
+#, c-format
+msgid ""
+"\n"
+" Prints the block mapping for the filesystem hosting the current file\n"
+" fsmap prints the map of disk blocks used by the whole filesystem.\n"
+" When possible, owner and offset information will be included in the\n"
+" space report.\n"
+"\n"
+" By default, each line of the listing takes the following form:\n"
+"     extent: major:minor [startblock..endblock]: owner startoffset.."
+"endoffset length\n"
+" The owner field is either an inode number or a special value.\n"
+" All the file offsets and disk blocks are in units of 512-byte blocks.\n"
+" -d -- query only the data device (default).\n"
+" -l -- query only the log device.\n"
+" -r -- query only the realtime device.\n"
+" -n -- query n extents at a time.\n"
+" -m -- output machine-readable format.\n"
+" -v -- Verbose information, show AG and offsets.  Show flags legend on 2nd -"
+"v\n"
+"\n"
+"The optional start and end arguments require one of -d, -l, or -r to be "
+"set.\n"
+"\n"
 msgstr ""
 
-#: .././io/open.c:79
-msgid "symbolic link"
+#: .././io/fsmap.c:64
+msgid "free space"
 msgstr ""
 
-#: .././io/open.c:81
-msgid "fifo"
+#: .././io/fsmap.c:66
+msgid "unknown"
+msgstr ""
+
+#: .././io/fsmap.c:68
+msgid "static fs metadata"
+msgstr ""
+
+#: .././io/fsmap.c:70
+msgid "journalling log"
+msgstr ""
+
+#: .././io/fsmap.c:72
+msgid "per-AG metadata"
 msgstr ""
 
-#: .././io/open.c:96 .././io/open.c:709
+#: .././io/fsmap.c:74
+msgid "inode btree"
+msgstr ""
+
+#: .././io/fsmap.c:76 .././repair/progress.c:16
+msgid "inodes"
+msgstr ""
+
+#: .././io/fsmap.c:78
+msgid "refcount btree"
+msgstr ""
+
+#: .././io/fsmap.c:80
+msgid "cow reservation"
+msgstr ""
+
+#: .././io/fsmap.c:82
+msgid "defective"
+msgstr ""
+
+#: .././io/fsmap.c:84
 #, c-format
-msgid "fd.path = \"%s\"\n"
+msgid "special %u:%u"
 msgstr ""
 
-#: .././io/open.c:97
+#: .././io/fsmap.c:109
 #, c-format
-msgid "fd.flags = %s,%s,%s%s%s%s%s\n"
+msgid "inode %lld %s extent map"
 msgstr ""
 
-#: .././io/open.c:98 .././io/file.c:41
-msgid "sync"
+#: .././io/fsmap.c:112
+#, c-format
+msgid "inode %lld %s %lld..%lld"
 msgstr ""
 
-#: .././io/open.c:98 .././io/file.c:41
-msgid "non-sync"
+#: .././io/fsmap.c:116
+#, c-format
+msgid " %lld\n"
 msgstr ""
 
-#: .././io/open.c:99 .././io/file.c:42
-msgid "direct"
+#: .././io/fsmap.c:132
+#, c-format
+msgid "EXT,MAJOR,MINOR,PSTART,PEND,OWNER,OSTART,OEND,LENGTH\n"
 msgstr ""
 
-#: .././io/open.c:99 .././io/file.c:42
-msgid "non-direct"
+#: .././io/fsmap.c:143
+#, c-format
+msgid "inode_%lld_%s_bmbt,,,"
 msgstr ""
 
-#: .././io/open.c:100 .././io/file.c:43
-msgid "read-only"
+#: .././io/fsmap.c:146
+#, c-format
+msgid "inode_%lld_%s,%lld,%lld,"
 msgstr ""
 
-#: .././io/open.c:100 .././io/file.c:43
-msgid "read-write"
+#: .././io/fsmap.c:241
+msgid "extent_map"
 msgstr ""
 
-#: .././io/open.c:101 .././io/file.c:44
-msgid ",real-time"
+#: .././io/fsmap.c:267
+msgid "DEV"
 msgstr ""
 
-#: .././io/open.c:102 .././io/file.c:45
-msgid ",append-only"
+#: .././io/fsmap.c:269
+msgid "OWNER"
 msgstr ""
 
-#: .././io/open.c:103 .././io/file.c:46
-msgid ",non-block"
+#: .././io/fsmap.c:271 .././io/bmap.c:344
+msgid "AG"
 msgstr ""
 
-#: .././io/open.c:104 .././io/file.c:47
-msgid ",tmpfile"
+#: .././io/fsmap.c:272 .././io/bmap.c:345
+msgid "AG-OFFSET"
+msgstr ""
+
+#: .././io/fsmap.c:274 .././io/bmap.c:347
+msgid " FLAGS"
+msgstr ""
+
+#: .././io/fsmap.c:339
+msgid "extent map"
 msgstr ""
 
-#: .././io/open.c:108
+#: .././io/fsmap.c:364 .././io/bmap.c:427
 #, c-format
-msgid "stat.ino = %lld\n"
+msgid " FLAG Values:\n"
 msgstr ""
 
-#: .././io/open.c:109
+#: .././io/fsmap.c:365
 #, c-format
-msgid "stat.type = %s\n"
+msgid "    %*.*o Attribute fork\n"
 msgstr ""
 
-#: .././io/open.c:110
+#: .././io/fsmap.c:367 .././io/bmap.c:428
 #, c-format
-msgid "stat.size = %lld\n"
+msgid "    %*.*o Shared extent\n"
 msgstr ""
 
-#: .././io/open.c:111
+#: .././io/fsmap.c:369 .././io/bmap.c:430
 #, c-format
-msgid "stat.blocks = %lld\n"
+msgid "    %*.*o Unwritten preallocated extent\n"
 msgstr ""
 
-#: .././io/open.c:113
+#: .././io/fsmap.c:371 .././io/bmap.c:432
 #, c-format
-msgid "stat.atime = %s"
+msgid "    %*.*o Doesn't begin on stripe unit\n"
 msgstr ""
 
-#: .././io/open.c:114
+#: .././io/fsmap.c:373 .././io/bmap.c:434
 #, c-format
-msgid "stat.mtime = %s"
+msgid "    %*.*o Doesn't end   on stripe unit\n"
 msgstr ""
 
-#: .././io/open.c:115
+#: .././io/fsmap.c:375 .././io/bmap.c:436
 #, c-format
-msgid "stat.ctime = %s"
+msgid "    %*.*o Doesn't begin on stripe width\n"
 msgstr ""
 
-#: .././io/open.c:124
+#: .././io/fsmap.c:377 .././io/bmap.c:438
 #, c-format
-msgid "fsxattr.xflags = 0x%x "
+msgid "    %*.*o Doesn't end   on stripe width\n"
 msgstr ""
 
-#: .././io/open.c:126
+#: .././io/fsmap.c:445
 #, c-format
-msgid "fsxattr.projid = %u\n"
+msgid "Bad rmap start_bblock %s.\n"
 msgstr ""
 
-#: .././io/open.c:127
+#: .././io/fsmap.c:456
 #, c-format
-msgid "fsxattr.extsize = %u\n"
+msgid "Bad rmap end_bblock %s.\n"
 msgstr ""
 
-#: .././io/open.c:128
+#: .././io/fsmap.c:467 .././io/bmap.c:122
 #, c-format
-msgid "fsxattr.cowextsize = %u\n"
+msgid "%s: can't get geometry [\"%s\"]: %s\n"
 msgstr ""
 
-#: .././io/open.c:129
+#: .././io/fsmap.c:477
 #, c-format
-msgid "fsxattr.nextents = %u\n"
+msgid "%s: malloc of %zu bytes failed.\n"
 msgstr ""
 
-#: .././io/open.c:130
+#: .././io/fsmap.c:507 .././io/fsmap.c:546
 #, c-format
-msgid "fsxattr.naextents = %u\n"
+msgid "%s: xfsctl(XFS_IOC_GETFSMAP) iflags=0x%x [\"%s\"]: %s\n"
 msgstr ""
 
-#: .././io/open.c:135
+#: .././io/fsmap.c:521
 #, c-format
-msgid "dioattr.mem = 0x%x\n"
+msgid "%s: cannot realloc %zu bytes\n"
+msgstr ""
+
+#: .././io/fsmap.c:586
+msgid "[-d|-l|-r] [-m|-v] [-n nx] [start] [end]"
+msgstr ""
+
+#: .././io/fsmap.c:587
+msgid "print filesystem mapping for a range of blocks"
 msgstr ""
 
-#: .././io/open.c:136
+#: .././io/copy_file_range.c:32
 #, c-format
-msgid "dioattr.miniosz = %u\n"
+msgid ""
+"\n"
+" Copies a range of bytes from a file into the open file, overwriting any "
+"data\n"
+" already there.\n"
+"\n"
+" Example:\n"
+" 'copy_range -s 100 -d 200 -l 300 some_file' - copies 300 bytes from "
+"some_file\n"
+"                                               at offset 100 into the open\n"
+"\t\t\t\t\t       file at offset 200\n"
+" 'copy_range some_file' - copies all bytes from some_file into the open "
+"file\n"
+"                          at position 0\n"
 msgstr ""
 
-#: .././io/open.c:137
+#: .././io/copy_file_range.c:100
 #, c-format
-msgid "dioattr.maxiosz = %u\n"
+msgid "invalid source offset -- %s\n"
+msgstr ""
+
+#: .././io/copy_file_range.c:107
+#, c-format
+msgid "invalid destination offset -- %s\n"
+msgstr ""
+
+#: .././io/copy_file_range.c:114
+#, c-format
+msgid "invalid length -- %s\n"
+msgstr ""
+
+#: .././io/copy_file_range.c:146
+msgid "[-s src_off] [-d dst_off] [-l len] src_file"
+msgstr ""
+
+#: .././io/copy_file_range.c:147
+msgid "Copy a range of data between two files"
+msgstr ""
+
+#: .././io/readdir.c:198
+#, c-format
+msgid "read %llu bytes from offset %lld\n"
+msgstr ""
+
+#: .././io/readdir.c:199
+#, c-format
+msgid "%s, %d ops, %s (%s/sec and %.4f ops/sec)\n"
+msgstr ""
+
+#: .././io/readdir.c:212
+msgid "[-v][-o offset][-l length]"
+msgstr ""
+
+#: .././io/readdir.c:213
+msgid "read directory entries"
+msgstr ""
+
+#: .././io/utimes.c:30
+#, c-format
+msgid ""
+"\n"
+" Update file atime and mtime of the current file with nansecond precision.\n"
+"\n"
+" Usage: utimes atime_sec atime_nsec mtime_sec mtime_nsec.\n"
+" *_sec: Seconds elapsed since 1970-01-01 00:00:00 UTC.\n"
+" *_nsec: Nanoseconds since the corresponding *_sec.\n"
+"\n"
+msgstr ""
+
+#: .././io/utimes.c:76
+msgid "atime_sec atime_nsec mtime_sec mtime_nsec"
+msgstr ""
+
+#: .././io/utimes.c:77
+msgid "Update file times of the current file"
+msgstr ""
+
+#: .././io/fsync.c:59
+msgid "calls fsync(2) to flush all in-core file state to disk"
+msgstr ""
+
+#: .././io/fsync.c:66
+msgid "calls fdatasync(2) to flush the files in-core data to disk"
 msgstr ""
 
-#: .././io/open.c:256
+#: .././io/open.c:176
 #, c-format
 msgid ""
 "\n"
@@ -4342,17 +4583,23 @@ msgid ""
 "\n"
 msgstr ""
 
-#: .././io/open.c:316 .././io/init.c:169
+#: .././io/open.c:215 .././io/mmap.c:171 .././io/mmap.c:178 .././io/mmap.c:181
+#: .././io/init.c:117
+#, c-format
+msgid "no files are open, try 'help open'\n"
+msgstr ""
+
+#: .././io/open.c:237 .././io/init.c:180
 #, c-format
 msgid "non-numeric mode -- %s\n"
 msgstr ""
 
-#: .././io/open.c:348
+#: .././io/open.c:269
 #, c-format
 msgid "-T and -r options are incompatible\n"
 msgstr ""
 
-#: .././io/open.c:403
+#: .././io/open.c:324
 #, c-format
 msgid ""
 "\n"
@@ -4364,7 +4611,7 @@ msgid ""
 "\n"
 msgstr ""
 
-#: .././io/open.c:426 .././io/open.c:498 .././io/open.c:622 .././io/open.c:644
+#: .././io/open.c:347 .././io/open.c:419 .././io/open.c:543 .././io/open.c:565
 #: .././io/attr.c:176 .././io/attr.c:252 .././io/cowextsize.c:109
 #: .././io/cowextsize.c:132 .././libxfs/init.c:127 .././mkfs/proto.c:302
 #: .././quota/project.c:118 .././quota/project.c:163 .././quota/project.c:210
@@ -4372,12 +4619,12 @@ msgstr ""
 msgid "%s: cannot open %s: %s\n"
 msgstr ""
 
-#: .././io/open.c:469
+#: .././io/open.c:390
 #, c-format
 msgid "projid = %u\n"
 msgstr ""
 
-#: .././io/open.c:477
+#: .././io/open.c:398
 #, c-format
 msgid ""
 "\n"
@@ -4388,12 +4635,12 @@ msgid ""
 "\n"
 msgstr ""
 
-#: .././io/open.c:536
+#: .././io/open.c:457
 #, c-format
 msgid "invalid project ID -- %s\n"
 msgstr ""
 
-#: .././io/open.c:552
+#: .././io/open.c:473
 #, c-format
 msgid ""
 "\n"
@@ -4404,343 +4651,298 @@ msgid ""
 "\n"
 msgstr ""
 
-#: .././io/open.c:595 .././io/cowextsize.c:81
+#: .././io/open.c:516 .././io/cowextsize.c:81
 #, c-format
 msgid "invalid target file type - file %s\n"
 msgstr ""
 
-#: .././io/open.c:681
+#: .././io/open.c:602
 #, c-format
 msgid "non-numeric extsize argument -- %s\n"
 msgstr ""
 
-#: .././io/open.c:713
-#, c-format
-msgid "statfs.f_bsize = %lld\n"
-msgstr ""
-
-#: .././io/open.c:714
-#, c-format
-msgid "statfs.f_blocks = %lld\n"
-msgstr ""
-
-#: .././io/open.c:716
-#, c-format
-msgid "statfs.f_frsize = %lld\n"
-msgstr ""
-
-#: .././io/open.c:718
-#, c-format
-msgid "statfs.f_bavail = %lld\n"
-msgstr ""
-
-#: .././io/open.c:720
+#: .././io/open.c:625
 #, c-format
-msgid "statfs.f_files = %lld\n"
+msgid ""
+"\n"
+"Query physical information about an inode\n"
+" Default:\t-- Return 1 if any inode number greater than 32 bits exists in\n"
+"\t\t   the filesystem, or 0 if none exist\n"
+" num\t\t-- Return inode number [num] if in use, or 0 if not in use\n"
+" -n num\t-- Return the next used inode after [num]\n"
+" -v\t\t-- Verbose mode - display returned inode number's size in bits\n"
+"\n"
 msgstr ""
 
-#: .././io/open.c:721
+#: .././io/open.c:708
 #, c-format
-msgid "statfs.f_ffree = %lld\n"
+msgid "%s is not a numeric inode value\n"
 msgstr ""
 
-#: .././io/open.c:728
-#, c-format
-msgid "geom.bsize = %u\n"
+#: .././io/open.c:788
+msgid "[-acdrstxT] [-m mode] [path]"
 msgstr ""
 
-#: .././io/open.c:729
-#, c-format
-msgid "geom.agcount = %u\n"
+#: .././io/open.c:789
+msgid "open the file specified by path"
 msgstr ""
 
-#: .././io/open.c:730
-#, c-format
-msgid "geom.agblocks = %u\n"
+#: .././io/open.c:798
+msgid "close the current open file"
 msgstr ""
 
-#: .././io/open.c:731
-#, c-format
-msgid "geom.datablocks = %llu\n"
+#: .././io/open.c:802
+msgid "[-D | -R] projid"
 msgstr ""
 
-#: .././io/open.c:733
-#, c-format
-msgid "geom.rtblocks = %llu\n"
+#: .././io/open.c:807
+msgid "change project identifier on the currently open file"
 msgstr ""
 
-#: .././io/open.c:735
-#, c-format
-msgid "geom.rtextents = %llu\n"
+#: .././io/open.c:812
+msgid "[-D | -R]"
 msgstr ""
 
-#: .././io/open.c:737
-#, c-format
-msgid "geom.rtextsize = %u\n"
+#: .././io/open.c:817
+msgid "list project identifier set on the currently open file"
 msgstr ""
 
-#: .././io/open.c:738
-#, c-format
-msgid "geom.sunit = %u\n"
+#: .././io/open.c:822
+msgid "[-D | -R] [extsize]"
 msgstr ""
 
-#: .././io/open.c:739
-#, c-format
-msgid "geom.swidth = %u\n"
+#: .././io/open.c:827
+msgid "get/set preferred extent size (in bytes) for the open file"
 msgstr ""
 
-#: .././io/open.c:744
-#, c-format
-msgid "counts.freedata = %llu\n"
+#: .././io/open.c:832
+msgid "[-nv] [num]"
 msgstr ""
 
-#: .././io/open.c:746
-#, c-format
-msgid "counts.freertx = %llu\n"
+#: .././io/open.c:837
+msgid "Query inode number usage in the filesystem"
 msgstr ""
 
-#: .././io/open.c:748
-#, c-format
-msgid "counts.freeino = %llu\n"
-msgstr ""
-
-#: .././io/open.c:750
-#, c-format
-msgid "counts.allocino = %llu\n"
-msgstr ""
-
-#: .././io/open.c:760
+#: .././io/madvise.c:31
 #, c-format
 msgid ""
 "\n"
-"Query physical information about an inode\n"
-" Default:\t-- Return 1 if any inode number greater than 32 bits exists in\n"
-"\t\t   the filesystem, or 0 if none exist\n"
-" num\t\t-- Return inode number [num] if in use, or 0 if not in use\n"
-" -n num\t-- Return the next used inode after [num]\n"
-" -v\t\t-- Verbose mode - display returned inode number's size in bits\n"
+" advise the page cache about access patterns expected for a mapping\n"
+"\n"
+" Modifies page cache behavior when operating on the current mapping.\n"
+" The range arguments are required by some advise commands ([*] below).\n"
+" With no arguments, the POSIX_MADV_NORMAL advice is implied.\n"
+" -d -- don't need these pages (POSIX_MADV_DONTNEED) [*]\n"
+" -r -- expect random page references (POSIX_MADV_RANDOM)\n"
+" -s -- expect sequential page references (POSIX_MADV_SEQUENTIAL)\n"
+" -w -- will need these pages (POSIX_MADV_WILLNEED) [*]\n"
+" Notes:\n"
+"   NORMAL sets the default readahead setting on the file.\n"
+"   RANDOM sets the readahead setting on the file to zero.\n"
+"   SEQUENTIAL sets double the default readahead setting on the file.\n"
+"   WILLNEED forces the maximum readahead.\n"
 "\n"
 msgstr ""
 
-#: .././io/open.c:843
+#: .././io/madvise.c:97 .././io/mincore.c:57
 #, c-format
-msgid "%s is not a numeric inode value\n"
-msgstr ""
-
-#: .././io/open.c:922
-msgid "[-acdrstxT] [-m mode] [path]"
-msgstr ""
-
-#: .././io/open.c:923
-msgid "open the file specified by path"
-msgstr ""
-
-#: .././io/open.c:931
-msgid "[-v]"
-msgstr ""
-
-#: .././io/open.c:932
-msgid "statistics on the currently open file"
-msgstr ""
-
-#: .././io/open.c:940
-msgid "close the current open file"
-msgstr ""
-
-#: .././io/open.c:946
-msgid "statistics on the filesystem of the currently open file"
-msgstr ""
-
-#: .././io/open.c:950
-msgid "[-D | -R] projid"
-msgstr ""
-
-#: .././io/open.c:955
-msgid "change project identifier on the currently open file"
-msgstr ""
-
-#: .././io/open.c:960
-msgid "[-D | -R]"
-msgstr ""
-
-#: .././io/open.c:965
-msgid "list project identifier set on the currently open file"
+msgid "length argument too large -- %lld\n"
 msgstr ""
 
-#: .././io/open.c:970
-msgid "[-D | -R] [extsize]"
+#: .././io/madvise.c:126
+msgid "[-drsw] [off len]"
 msgstr ""
 
-#: .././io/open.c:975
-msgid "get/set preferred extent size (in bytes) for the open file"
+#: .././io/madvise.c:127
+msgid "give advice about use of memory"
 msgstr ""
 
-#: .././io/open.c:980
-msgid "[-nv] [num]"
+#: .././io/mincore.c:91 .././io/mincore.c:101
+#, c-format
+msgid "0x%lx  %lu pages (%llu : %lu)\n"
 msgstr ""
 
-#: .././io/open.c:985
-msgid "Query inode number usage in the filesystem"
+#: .././io/mincore.c:121
+msgid "[off len]"
 msgstr ""
 
-#: .././io/resblks.c:38
-#, c-format
-msgid "non-numeric argument -- %s\n"
+#: .././io/mincore.c:122
+msgid "find mapping pages that are memory resident"
 msgstr ""
 
-#: .././io/resblks.c:50
+#: .././io/mmap.c:78
 #, c-format
-msgid "reserved blocks = %llu\n"
+msgid "offset (%lld) is before start of mapping (%lld)\n"
 msgstr ""
 
-#: .././io/resblks.c:52
+#: .././io/mmap.c:84
 #, c-format
-msgid "available reserved blocks = %llu\n"
-msgstr ""
-
-#: .././io/resblks.c:65
-msgid "[blocks]"
-msgstr ""
-
-#: .././io/resblks.c:67
-msgid "get and/or set count of reserved filesystem blocks"
+msgid "offset (%lld) is beyond end of mapping (%lld)\n"
 msgstr ""
 
-#: .././io/readdir.c:193
+#: .././io/mmap.c:89
 #, c-format
-msgid "read %llu bytes from offset %lld\n"
+msgid "range (%lld:%lld) is beyond mapping (%lld:%ld)\n"
 msgstr ""
 
-#: .././io/readdir.c:194
+#: .././io/mmap.c:95
 #, c-format
-msgid "%s, %d ops, %s (%s/sec and %.4f ops/sec)\n"
-msgstr ""
-
-#: .././io/readdir.c:207
-msgid "[-v][-o offset][-l length]"
-msgstr ""
-
-#: .././io/readdir.c:208
-msgid "read directory entries"
+msgid "offset address (%p) is not page aligned\n"
 msgstr ""
 
-#: .././io/reflink.c:32
+#: .././io/mmap.c:135
 #, c-format
 msgid ""
 "\n"
-" Links a range of bytes (in block size increments) from a file into a range\n"
-" of bytes in the open file.  The contents of both file ranges must match.\n"
+" maps a range within the current file into memory\n"
 "\n"
 " Example:\n"
-" 'dedupe some_file 0 4096 32768' - links 32768 bytes from some_file at\n"
-"                                    offset 0 to into the open file at\n"
-"                                    position 4096\n"
+" 'mmap -rw 0 1m' - maps one megabyte from the start of the current file\n"
+"\n"
+" Memory maps a range of a file for subsequent use by other xfs_io commands.\n"
+" With no arguments, mmap shows the current mappings.  The current mapping\n"
+" can be set by using the single argument form (mapping number or address).\n"
+" If two arguments are specified (a range), a new mapping is created and the\n"
+" following options are available:\n"
+" -r -- map with PROT_READ protection\n"
+" -w -- map with PROT_WRITE protection\n"
+" -x -- map with PROT_EXEC protection\n"
+" -s <size> -- first do mmap(size)/munmap(size), try to reserve some free "
+"space\n"
+" If no protection mode is specified, all are used by default.\n"
 "\n"
-" Reflink a range of blocks from a given input file to the open file.  Both\n"
-" files share the same range of physical disk blocks; a write to the shared\n"
-" range of either file should result in the write landing in a new block and\n"
-" that range of the file being remapped (i.e. copy-on-write).  Both files\n"
-" must reside on the same filesystem, and the contents of both ranges must\n"
-" match.\n"
-msgstr ""
-
-#: .././io/reflink.c:87
-msgid "Extents did not match."
 msgstr ""
 
-#: .././io/reflink.c:141 .././io/reflink.c:264
+#: .././io/mmap.c:170 .././io/mmap.c:177 .././io/init.c:121
 #, c-format
-msgid "non-numeric src offset argument -- %s\n"
+msgid "no mapped regions, try 'help mmap'\n"
 msgstr ""
 
-#: .././io/reflink.c:147 .././io/reflink.c:270
+#: .././io/mmap.c:273
 #, c-format
-msgid "non-numeric dest offset argument -- %s\n"
+msgid ""
+"\n"
+" flushes a range of bytes in the current memory mapping\n"
+"\n"
+" Writes all modified copies of pages over the specified range (or entire\n"
+" mapping if no range specified) to their backing storage locations.  Also,\n"
+" optionally invalidates so that subsequent references to the pages will be\n"
+" obtained from their backing storage locations (instead of cached copies).\n"
+" -a -- perform asynchronous writes (MS_ASYNC)\n"
+" -i -- invalidate mapped pages (MS_INVALIDATE)\n"
+" -s -- perform synchronous writes (MS_SYNC)\n"
+"\n"
 msgstr ""
 
-#: .././io/reflink.c:153 .././io/reflink.c:276
+#: .././io/mmap.c:349
 #, c-format
-msgid "non-positive length argument -- %s\n"
+msgid ""
+"\n"
+" reads a range of bytes in the current memory mapping\n"
+"\n"
+" Example:\n"
+" 'mread -v 512 20' - dumps 20 bytes read from 512 bytes into the mapping\n"
+"\n"
+" Accesses a range of the current memory mapping, optionally dumping it to\n"
+" the standard output stream (with -v option) for subsequent inspection.\n"
+" -f -- verbose mode, dump bytes with offsets relative to start of file.\n"
+" -r -- reverse order; start accessing from the end of range, moving "
+"backward\n"
+" -v -- verbose mode, dump bytes with offsets relative to start of mapping.\n"
+" The accesses are performed sequentially from the start offset by default.\n"
+" Notes:\n"
+"   References to whole pages following the end of the backing file results\n"
+"   in delivery of the SIGBUS signal.  SIGBUS signals may also be delivered\n"
+"   on various filesystem conditions, including quota exceeded errors, and\n"
+"   for physical device errors (such as unreadable disk blocks).  No attempt\n"
+"   has been made to catch signals at this stage...\n"
+"\n"
 msgstr ""
 
-#: .././io/reflink.c:178
+#: .././io/mmap.c:513
 #, c-format
 msgid ""
 "\n"
-" Links a range of bytes (in block size increments) from a file into a range\n"
-" of bytes in the open file.  The two extent ranges need not contain "
-"identical\n"
-" data.\n"
+" dirties a range of bytes in the current memory mapping\n"
 "\n"
 " Example:\n"
-" 'reflink some_file 0 4096 32768' - links 32768 bytes from some_file at\n"
-"                                    offset 0 to into the open file at\n"
-"                                    position 4096\n"
-" 'reflink some_file' - links all bytes from some_file into the open file\n"
-"                       at position 0\n"
+" 'mwrite 512 20 - writes 20 bytes at 512 bytes into the current mapping.\n"
+"\n"
+" Stores a byte into memory for a range within a mapping.\n"
+" The default stored value is 'X', repeated to fill the range specified.\n"
+" -S -- use an alternate seed character\n"
+" -r -- reverse order; start storing from the end of range, moving backward\n"
+" The stores are performed sequentially from the start offset by default.\n"
 "\n"
-" Reflink a range of blocks from a given input file to the open file.  Both\n"
-" files share the same range of physical disk blocks; a write to the shared\n"
-" range of either file should result in the write landing in a new block and\n"
-" that range of the file being remapped (i.e. copy-on-write).  Both files\n"
-" must reside on the same filesystem.\n"
 msgstr ""
 
-#: .././io/reflink.c:309 .././io/reflink.c:323
-msgid "infile src_off dst_off len"
+#: .././io/mmap.c:549 .././io/pread.c:441 .././io/pwrite.c:349
+#: .././io/pwrite.c:378
+#, c-format
+msgid "non-numeric seed -- %s\n"
 msgstr ""
 
-#: .././io/reflink.c:311
-msgid "reflinks a number of bytes at a specified offset"
+#: .././io/mmap.c:601
+#, c-format
+msgid ""
+"\n"
+" resizes the current memory mapping\n"
+"\n"
+" Examples:\n"
+" 'mremap 8192' - resizes the current mapping to 8192 bytes.\n"
+"\n"
+" Resizes the mappping, growing or shrinking from the current size.\n"
+" The default stored value is 'X', repeated to fill the range specified.\n"
+" -f <new_address> -- use MREMAP_FIXED flag to mremap on new_address\n"
+" -m -- use the MREMAP_MAYMOVE flag\n"
+"\n"
 msgstr ""
 
-#: .././io/reflink.c:325
-msgid "dedupes a number of bytes at a specified offset"
+#: .././io/mmap.c:679
+msgid "[N] | [-rwx] [-s size] [off len]"
 msgstr ""
 
-#: .././io/sync.c:57
-msgid "calls sync(2) to flush all in-core filesystem state to disk"
+#: .././io/mmap.c:681
+msgid "mmap a range in the current file, show mappings"
 msgstr ""
 
-#: .././io/sync.c:66
-msgid "calls syncfs(2) to flush all in-core filesystem state to disk"
+#: .././io/mmap.c:690
+msgid "[-r] [off len]"
 msgstr ""
 
-#: .././io/getrusage.c:117
-msgid "report process resource usage"
+#: .././io/mmap.c:692
+msgid "reads data from a region in the current memory mapping"
 msgstr ""
 
-#: .././io/file.c:38
-#, c-format
-msgid "%c%03d%c %-14s (%s,%s,%s,%s%s%s%s%s)\n"
+#: .././io/mmap.c:701
+msgid "[-ais] [off len]"
 msgstr ""
 
-#: .././io/file.c:40
-msgid "foreign"
+#: .././io/mmap.c:702
+msgid "flush a region in the current memory mapping"
 msgstr ""
 
-#: .././io/file.c:40
-msgid "xfs"
+#: .././io/mmap.c:711
+msgid "unmaps the current memory mapping"
 msgstr ""
 
-#: .././io/file.c:81 .././io/sendfile.c:101 .././quota/path.c:126
-#, c-format
-msgid "value %d is out of range (0-%d)\n"
+#: .././io/mmap.c:719
+msgid "[-r] [-S seed] [off len]"
 msgstr ""
 
-#: .././io/file.c:94 .././quota/path.c:140
-msgid "[N]"
+#: .././io/mmap.c:721
+msgid "writes data into a region in the current memory mapping"
 msgstr ""
 
-#: .././io/file.c:99
-msgid "set the current file"
+#: .././io/mmap.c:731
+msgid "[-m|-f <new_address>] newsize"
 msgstr ""
 
-#: .././io/file.c:108
-msgid "list current open files and memory mappings"
+#: .././io/mmap.c:733
+msgid "alters the size of the current memory mapping"
 msgstr ""
 
-#: .././io/pread.c:32
+#: .././io/pread.c:34
 #, c-format
 msgid ""
 "\n"
@@ -4769,143 +4971,25 @@ msgid ""
 "\n"
 msgstr ""
 
-#: .././io/pread.c:400 .././io/pwrite.c:271
+#: .././io/pread.c:402 .././io/pwrite.c:307
 #, c-format
 msgid "non-numeric bsize -- %s\n"
 msgstr ""
 
-#: .././io/pread.c:430 .././io/pwrite.c:318
+#: .././io/pread.c:432 .././io/pwrite.c:363
 #, c-format
 msgid "non-numeric vector count == %s\n"
 msgstr ""
 
-#: .././io/pread.c:507
+#: .././io/pread.c:509
 msgid "[-b bs] [-v] [-i N] [-FBR [-Z N]] off len"
 msgstr ""
 
-#: .././io/pread.c:508
+#: .././io/pread.c:510
 msgid "reads a number of bytes at a specified offset"
 msgstr ""
 
-#: .././io/imap.c:54
-#, c-format
-msgid "ino %10llu count %2d mask %016llx\n"
-msgstr ""
-
-#: .././io/imap.c:74
-msgid "[nentries]"
-msgstr ""
-
-#: .././io/imap.c:76
-msgid "inode map for filesystem of current file"
-msgstr ""
-
-#: .././io/attr.c:60
-#, c-format
-msgid ""
-"\n"
-" displays the set of extended inode flags associated with the current file\n"
-"\n"
-" Each individual flag is displayed as a single character, in this order:\n"
-" r -- file data is stored in the realtime section\n"
-" p -- file has preallocated extents (cannot be changed using chattr)\n"
-" i -- immutable, file cannot be modified\n"
-" a -- append-only, file can only be appended to\n"
-" s -- all updates are synchronous\n"
-" A -- the access time is not updated for this inode\n"
-" d -- do not include this file in a dump of the filesystem\n"
-" t -- child created in this directory has realtime bit set by default\n"
-" P -- child created in this directory has parents project ID by default\n"
-" n -- symbolic links cannot be created in this directory\n"
-" e -- for non-realtime files, observe the inode extent size value\n"
-" E -- children created in this directory inherit the extent size value\n"
-" f -- do not include this file when defragmenting the filesystem\n"
-" S -- enable filestreams allocator for this directory\n"
-" x -- Use direct access (DAX) for data in this file\n"
-" C -- for files with shared blocks, observe the inode CoW extent size value\n"
-"\n"
-" Options:\n"
-" -R -- recursively descend (useful when current file is a directory)\n"
-" -D -- recursively descend, but only list attributes on directories\n"
-" -a -- show all flags which can be set alongside those which are set\n"
-" -v -- verbose mode; show long names of flags, not single characters\n"
-"\n"
-msgstr ""
-
-#: .././io/attr.c:93
-#, c-format
-msgid ""
-"\n"
-" modifies the set of extended inode flags associated with the current file\n"
-"\n"
-" Examples:\n"
-" 'chattr +a' - sets the append-only flag\n"
-" 'chattr -a' - clears the append-only flag\n"
-"\n"
-" -R -- recursively descend (useful when current file is a directory)\n"
-" -D -- recursively descend, only modifying attributes on directories\n"
-" +/-r -- set/clear the realtime flag\n"
-" +/-i -- set/clear the immutable flag\n"
-" +/-a -- set/clear the append-only flag\n"
-" +/-s -- set/clear the sync flag\n"
-" +/-A -- set/clear the no-atime flag\n"
-" +/-d -- set/clear the no-dump flag\n"
-" +/-t -- set/clear the realtime inheritance flag\n"
-" +/-P -- set/clear the project ID inheritance flag\n"
-" +/-n -- set/clear the no-symbolic-links flag\n"
-" +/-e -- set/clear the extent-size flag\n"
-" +/-E -- set/clear the extent-size inheritance flag\n"
-" +/-f -- set/clear the no-defrag flag\n"
-" +/-S -- set/clear the filestreams allocator flag\n"
-" +/-x -- set/clear the direct access (DAX) flag\n"
-" +/-C -- set/clear the CoW extent-size flag\n"
-" Note1: user must have certain capabilities to modify immutable/append-"
-"only.\n"
-" Note2: immutable/append-only files cannot be deleted; removing these files\n"
-"        requires the immutable/append-only flag to be cleared first.\n"
-" Note3: the realtime flag can only be set if the filesystem has a realtime\n"
-"        section, and the (regular) file must be empty when the flag is set.\n"
-"\n"
-msgstr ""
-
-#: .././io/attr.c:179 .././io/attr.c:226 .././io/attr.c:255 .././io/attr.c:326
-#: .././quota/project.c:122 .././quota/project.c:168 .././quota/project.c:215
-#, c-format
-msgid "%s: cannot get flags on %s: %s\n"
-msgstr ""
-
-#: .././io/attr.c:261 .././io/attr.c:332
-#, c-format
-msgid "%s: cannot set flags on %s: %s\n"
-msgstr ""
-
-#: .././io/attr.c:296 .././io/attr.c:310
-#, c-format
-msgid "%s: unknown flag\n"
-msgstr ""
-
-#: .././io/attr.c:316
-#, c-format
-msgid "%s: bad chattr command, not +/-X\n"
-msgstr ""
-
-#: .././io/attr.c:343
-msgid "[-R|-D] [+/-"
-msgstr ""
-
-#: .././io/attr.c:348
-msgid "change extended inode flags on the currently open file"
-msgstr ""
-
-#: .././io/attr.c:353
-msgid "[-R|-D|-a|-v]"
-msgstr ""
-
-#: .././io/attr.c:358
-msgid "list extended inode flags set on the currently open file"
-msgstr ""
-
-#: .././io/bmap.c:30
+#: .././io/bmap.c:31
 #, c-format
 msgid ""
 "\n"
@@ -4934,223 +5018,227 @@ msgid ""
 "\n"
 msgstr ""
 
-#: .././io/bmap.c:133
-#, c-format
-msgid "%s: can't get geometry [\"%s\"]: %s\n"
-msgstr ""
-
-#: .././io/bmap.c:141
+#: .././io/bmap.c:130
 #, c-format
 msgid "%s: cannot read attrs on \"%s\": %s\n"
 msgstr ""
 
-#: .././io/bmap.c:159 .././io/fiemap.c:258
-#, c-format
-msgid "%s: malloc of %d bytes failed.\n"
-msgstr ""
-
-#: .././io/bmap.c:207
+#: .././io/bmap.c:196
 #, c-format
 msgid "%s: xfsctl(XFS_IOC_GETBMAPX) iflags=0x%x [\"%s\"]: %s\n"
 msgstr ""
 
-#: .././io/bmap.c:238
+#: .././io/bmap.c:227
 #, c-format
 msgid "%s: cannot realloc %d bytes\n"
 msgstr ""
 
-#: .././io/bmap.c:247
+#: .././io/bmap.c:236
 #, c-format
 msgid "%s: no extents\n"
 msgstr ""
 
-#: .././io/bmap.c:261 .././io/bmap.c:396 .././io/fiemap.c:104
-#: .././io/fiemap.c:339 .././io/fiemap.c:343
-#, c-format
-msgid "hole"
-msgstr ""
-
-#: .././io/bmap.c:263 .././io/bmap.c:404
+#: .././io/bmap.c:252 .././io/bmap.c:393
 #, c-format
 msgid "delalloc"
 msgstr ""
 
-#: .././io/bmap.c:272
+#: .././io/bmap.c:261
 #, c-format
 msgid " %lld blocks\n"
 msgstr ""
 
-#: .././io/bmap.c:352 .././io/fiemap.c:93
-msgid "EXT"
+#: .././io/bmap.c:343
+msgid "RT-BLOCK-RANGE"
 msgstr ""
 
-#: .././io/bmap.c:353 .././io/fiemap.c:94
-msgid "FILE-OFFSET"
+#: .././io/bmap.c:454
+msgid "[-adlpv] [-n nx]"
 msgstr ""
 
-#: .././io/bmap.c:354
-msgid "RT-BLOCK-RANGE"
+#: .././io/bmap.c:455
+msgid "print block mapping for an XFS file"
 msgstr ""
 
-#: .././io/bmap.c:354 .././io/fiemap.c:95
-msgid "BLOCK-RANGE"
+#: .././io/encrypt.c:77
+#, c-format
+msgid ""
+"\n"
+" assign an encryption policy to the currently open file\n"
+"\n"
+" Examples:\n"
+" 'set_encpolicy' - assign policy with default key [0000000000000000]\n"
+" 'set_encpolicy 0000111122223333' - assign policy with specified key\n"
+"\n"
+" -c MODE -- contents encryption mode\n"
+" -n MODE -- filenames encryption mode\n"
+" -f FLAGS -- policy flags\n"
+" -v VERSION -- version of policy structure\n"
+"\n"
+" MODE can be numeric or one of the following predefined values:\n"
+"    AES-256-XTS, AES-256-CTS, AES-256-GCM, AES-256-CBC\n"
+" FLAGS and VERSION must be numeric.\n"
+"\n"
+" Note that it's only possible to set an encryption policy on an empty\n"
+" directory.  It's then inherited by new files and subdirectories.\n"
+"\n"
 msgstr ""
 
-#: .././io/bmap.c:355
-msgid "AG"
+#: .././io/encrypt.c:288
+msgid "display the encryption policy of the current file"
 msgstr ""
 
-#: .././io/bmap.c:356
-msgid "AG-OFFSET"
+#: .././io/encrypt.c:293
+msgid "[-c mode] [-n mode] [-f flags] [-v version] [keydesc]"
 msgstr ""
 
-#: .././io/bmap.c:357 .././io/fiemap.c:96
-msgid "TOTAL"
+#: .././io/encrypt.c:298
+msgid "assign an encryption policy to the current file"
 msgstr ""
 
-#: .././io/bmap.c:358
-msgid " FLAGS"
+#: .././io/file.c:38
+#, c-format
+msgid "%c%03d%c %-14s (%s,%s,%s,%s%s%s%s%s)\n"
 msgstr ""
 
-#: .././io/bmap.c:438
-#, c-format
-msgid " FLAG Values:\n"
+#: .././io/file.c:40
+msgid "foreign"
 msgstr ""
 
-#: .././io/bmap.c:439
-#, c-format
-msgid "    %*.*o Shared extent\n"
+#: .././io/file.c:40
+msgid "xfs"
 msgstr ""
 
-#: .././io/bmap.c:441
-#, c-format
-msgid "    %*.*o Unwritten preallocated extent\n"
+#: .././io/file.c:41 .././io/stat.c:97
+msgid "sync"
 msgstr ""
 
-#: .././io/bmap.c:443
-#, c-format
-msgid "    %*.*o Doesn't begin on stripe unit\n"
+#: .././io/file.c:41 .././io/stat.c:97
+msgid "non-sync"
 msgstr ""
 
-#: .././io/bmap.c:445
-#, c-format
-msgid "    %*.*o Doesn't end   on stripe unit\n"
+#: .././io/file.c:42 .././io/stat.c:98
+msgid "direct"
 msgstr ""
 
-#: .././io/bmap.c:447
-#, c-format
-msgid "    %*.*o Doesn't begin on stripe width\n"
+#: .././io/file.c:42 .././io/stat.c:98
+msgid "non-direct"
 msgstr ""
 
-#: .././io/bmap.c:449
-#, c-format
-msgid "    %*.*o Doesn't end   on stripe width\n"
+#: .././io/file.c:43 .././io/stat.c:99
+msgid "read-only"
 msgstr ""
 
-#: .././io/bmap.c:465
-msgid "[-adlpv] [-n nx]"
+#: .././io/file.c:43 .././io/stat.c:99
+msgid "read-write"
 msgstr ""
 
-#: .././io/bmap.c:466
-msgid "print block mapping for an XFS file"
+#: .././io/file.c:44 .././io/stat.c:100
+msgid ",real-time"
 msgstr ""
 
-#: .././io/cowextsize.c:40
-#, c-format
-msgid ""
-"\n"
-" report or modify preferred CoW extent size (in bytes) for the current path\n"
-"\n"
-" -R -- recursively descend (useful when current path is a directory)\n"
-" -D -- recursively descend, only modifying cowextsize on directories\n"
-"\n"
+#: .././io/file.c:45 .././io/stat.c:101
+msgid ",append-only"
 msgstr ""
 
-#: .././io/cowextsize.c:169
-#, c-format
-msgid "non-numeric cowextsize argument -- %s\n"
+#: .././io/file.c:46 .././io/stat.c:102
+msgid ",non-block"
 msgstr ""
 
-#: .././io/cowextsize.c:193
-msgid "[-D | -R] [cowextsize]"
+#: .././io/file.c:47 .././io/stat.c:103
+msgid ",tmpfile"
 msgstr ""
 
-#: .././io/cowextsize.c:198
-msgid "get/set preferred CoW extent size (in bytes) for the open file"
+#: .././io/file.c:94 .././quota/path.c:140
+msgid "[N]"
 msgstr ""
 
-#: .././io/fiemap.c:31
-#, c-format
-msgid ""
-"\n"
-" prints the block mapping for a file's data or attribute forks\n"
-" Example:\n"
-" 'fiemap -v' - tabular format verbose map\n"
-"\n"
-" fiemap prints the map of disk blocks used by the current file.\n"
-" The map lists each extent used by the file, as well as regions in the\n"
-" file that do not have any corresponding blocks (holes).\n"
-" By default, each line of the listing takes the following form:\n"
-"     extent: [startoffset..endoffset]: startblock..endblock\n"
-" Holes are marked by replacing the startblock..endblock with 'hole'.\n"
-" All the file offsets and disk blocks are in units of 512-byte blocks.\n"
-" -a -- prints the attribute fork map instead of the data fork.\n"
-" -l -- also displays the length of each extent in 512-byte blocks.\n"
-" -n -- query n extents.\n"
-" -v -- Verbose information\n"
-"\n"
+#: .././io/file.c:99
+msgid "set the current file"
 msgstr ""
 
-#: .././io/fiemap.c:97
-msgid "FLAGS"
+#: .././io/file.c:108
+msgid "list current open files and memory mappings"
+msgstr ""
+
+#: .././io/getrusage.c:118
+msgid "report process resource usage"
 msgstr ""
 
-#: .././io/fiemap.c:146 .././io/fiemap.c:160 .././io/fiemap.c:345
+#: .././io/imap.c:54
 #, c-format
-msgid " %llu blocks\n"
+msgid "ino %10llu count %2d mask %016llx\n"
 msgstr ""
 
-#: .././io/fiemap.c:365
-msgid "[-alv] [-n nx]"
+#: .././io/imap.c:74
+msgid "[nentries]"
 msgstr ""
 
-#: .././io/fiemap.c:366
-msgid "print block mapping for a file"
+#: .././io/imap.c:76
+msgid "inode map for filesystem of current file"
 msgstr ""
 
 #: .././io/init.c:37
 #, c-format
-msgid "Usage: %s [-adfinrRstVx] [-m mode] [-p prog] [-c cmd]... file\n"
+msgid "Usage: %s [-adfinrRstVx] [-m mode] [-p prog] [[-c|-C] cmd]... file\n"
 msgstr ""
 
-#: .././io/init.c:121
+#: .././io/init.c:127
 #, c-format
 msgid "foreign file active, %s command is for XFS filesystems only\n"
 msgstr ""
 
-#: .././io/prealloc.c:175
+#: .././io/inject.c:126
 #, c-format
 msgid ""
 "\n"
-" modifies space associated with part of a file via fallocate\n"
+" inject errors into the filesystem of the currently open file\n"
+"\n"
 " Example:\n"
-" 'falloc 0 1m' - fills all holes within the first megabyte\n"
+" 'inject readagf' - cause errors on allocation group freespace reads\n"
 "\n"
-" falloc uses the fallocate system call to alter space allocations in the\n"
-" open file.  The following operations are supported:\n"
-" All the file offsets are in units of bytes.\n"
-" -c -- collapses the given range.\n"
-" -i -- inserts a hole into the given range of the file.\n"
-" -k -- do not change file size.\n"
-" -p -- unmap the given range from the file.\n"
-" -u -- unshare shared extents in the given range.\n"
+" Causes the kernel to generate and react to errors within XFS, provided\n"
+" the XFS kernel code has been built with debugging features enabled.\n"
+" With no arguments, displays the list of error injection tags.\n"
 "\n"
 msgstr ""
 
-#: .././io/prealloc.c:347 .././io/prealloc.c:355 .././io/prealloc.c:363
-#: .././io/prealloc.c:371 .././io/prealloc.c:381 .././io/prealloc.c:408
-#: .././io/prealloc.c:418 .././io/prealloc.c:428 .././io/prealloc.c:448
-msgid "off len"
+#: .././io/inject.c:152
+#, c-format
+msgid "no such tag -- %s\n"
+msgstr ""
+
+#: .././io/inject.c:173
+msgid "[tag ...]"
+msgstr ""
+
+#: .././io/inject.c:174
+msgid "inject errors into a filesystem"
+msgstr ""
+
+#: .././io/prealloc.c:175
+#, c-format
+msgid ""
+"\n"
+" modifies space associated with part of a file via fallocate\n"
+" Example:\n"
+" 'falloc 0 1m' - fills all holes within the first megabyte\n"
+"\n"
+" falloc uses the fallocate system call to alter space allocations in the\n"
+" open file.  The following operations are supported:\n"
+" All the file offsets are in units of bytes.\n"
+" -c -- collapses the given range.\n"
+" -i -- inserts a hole into the given range of the file.\n"
+" -k -- do not change file size.\n"
+" -p -- unmap the given range from the file.\n"
+" -u -- unshare shared extents in the given range.\n"
+"\n"
+msgstr ""
+
+#: .././io/prealloc.c:347 .././io/prealloc.c:355 .././io/prealloc.c:363
+#: .././io/prealloc.c:371 .././io/prealloc.c:381 .././io/prealloc.c:408
+#: .././io/prealloc.c:418 .././io/prealloc.c:428 .././io/prealloc.c:448
+msgid "off len"
 msgstr ""
 
 #: .././io/prealloc.c:348
@@ -5205,62 +5293,56 @@ msgstr ""
 msgid "unshares shared blocks within the range"
 msgstr ""
 
-#: .././io/copy_file_range.c:32
-#, c-format
-msgid ""
-"\n"
-" Copies a range of bytes from a file into the open file, overwriting any "
-"data\n"
-" already there.\n"
-"\n"
-" Example:\n"
-" 'copy_range -s 100 -d 200 -l 300 some_file' - copies 300 bytes from "
-"some_file\n"
-"                                               at offset 100 into the open\n"
-"\t\t\t\t\t       file at offset 200\n"
-" 'copy_range some_file' - copies all bytes from some_file into the open "
-"file\n"
-"                          at position 0\n"
-msgstr ""
-
-#: .././io/copy_file_range.c:97
+#: .././io/resblks.c:38
 #, c-format
-msgid "invalid source offset -- %s\n"
+msgid "non-numeric argument -- %s\n"
 msgstr ""
 
-#: .././io/copy_file_range.c:104
+#: .././io/resblks.c:50
 #, c-format
-msgid "invalid destination offset -- %s\n"
+msgid "reserved blocks = %llu\n"
 msgstr ""
 
-#: .././io/copy_file_range.c:111
+#: .././io/resblks.c:52
 #, c-format
-msgid "invalid length -- %s\n"
+msgid "available reserved blocks = %llu\n"
 msgstr ""
 
-#: .././io/copy_file_range.c:143
-msgid "[-s src_off] [-d dst_off] [-l len] src_file"
+#: .././io/resblks.c:65
+msgid "[blocks]"
 msgstr ""
 
-#: .././io/copy_file_range.c:144
-msgid "Copy a range of data between two files"
+#: .././io/resblks.c:67
+msgid "get and/or set count of reserved filesystem blocks"
 msgstr ""
 
-#: .././io/link.c:34
+#: .././io/seek.c:32
 #, c-format
 msgid ""
 "\n"
-"link the open file descriptor to the supplied filename\n"
+" returns the next hole and/or data offset at or after the requested offset\n"
 "\n"
+" Example:\n"
+" 'seek -d 512'\t\t- offset of data at or following offset 512\n"
+" 'seek -a -r 0'\t- offsets of all data and hole in entire file\n"
+"\n"
+" Returns the offset of the next data and/or hole. There is an implied hole\n"
+" at the end of file. If the specified offset is past end of file, or there\n"
+" is no data past the specified offset, EOF is returned.\n"
+" -a\t-- return the next data and hole starting at the specified offset.\n"
+" -d\t-- return the next data starting at the specified offset.\n"
+" -h\t-- return the next hole starting at the specified offset.\n"
+" -r\t-- return all remaining type(s) starting at the specified offset.\n"
+" -s\t-- also print the starting offset.\n"
 "\n"
 msgstr ""
 
-#: .././io/link.c:63
-msgid "filename"
+#: .././io/seek.c:229
+msgid "-a | -d | -h [-r] off"
 msgstr ""
 
-#: .././io/link.c:65
-msgid "link the open file descriptor to the supplied filename"
+#: .././io/seek.c:230
+msgid "locate the next data and/or hole"
 msgstr ""
 
 #: .././io/shutdown.c:58
@@ -5271,50 +5353,12 @@ msgstr ""
 msgid "shuts down the filesystem where the current file resides"
 msgstr ""
 
-#: .././io/freeze.c:36
-#, c-format
-msgid "%s: cannot freeze filesystem at %s: %s\n"
-msgstr ""
-
-#: .././io/freeze.c:53
-#, c-format
-msgid "%s: cannot unfreeze filesystem mounted at %s: %s\n"
-msgstr ""
-
-#: .././io/freeze.c:69
-msgid "freeze filesystem of current file"
-msgstr ""
-
-#: .././io/freeze.c:76
-msgid "unfreeze filesystem of current file"
-msgstr ""
-
-#: .././io/inject.c:120
-#, c-format
-msgid ""
-"\n"
-" inject errors into the filesystem of the currently open file\n"
-"\n"
-" Example:\n"
-" 'inject readagf' - cause errors on allocation group freespace reads\n"
-"\n"
-" Causes the kernel to generate and react to errors within XFS, provided\n"
-" the XFS kernel code has been built with debugging features enabled.\n"
-" With no arguments, displays the list of error injection tags.\n"
-"\n"
-msgstr ""
-
-#: .././io/inject.c:146
-#, c-format
-msgid "no such tag -- %s\n"
-msgstr ""
-
-#: .././io/inject.c:167
-msgid "[tag ...]"
+#: .././io/sync.c:58
+msgid "calls sync(2) to flush all in-core filesystem state to disk"
 msgstr ""
 
-#: .././io/inject.c:168
-msgid "inject errors into a filesystem"
+#: .././io/sync.c:67
+msgid "calls syncfs(2) to flush all in-core filesystem state to disk"
 msgstr ""
 
 #: .././io/pwrite.c:31
@@ -5339,208 +5383,577 @@ msgid ""
 " -W   -- call fsync(2) at the end (included in timing results)\n"
 " -B   -- write backwards through the range from offset (backwards N bytes)\n"
 " -F   -- write forwards through the range of bytes from offset (default)\n"
+" -O   -- perform pwrite call once and return (maybe partial) bytes written\n"
 " -R   -- write at random offsets in the specified range of bytes\n"
 " -Z N -- zeed the random number generator (used when writing randomly)\n"
 "         (heh, zorry, the -s/-S arguments were already in use in pwrite)\n"
 " -V N -- use vectored IO with N iovecs of blocksize each (pwritev)\n"
+" -N   -- Perform the pwritev2() with RWF_NOWAIT\n"
 "\n"
 msgstr ""
 
-#: .././io/pwrite.c:298
+#: .././io/pwrite.c:342
 #, c-format
 msgid "non-numeric skip -- %s\n"
 msgstr ""
 
-#: .././io/pwrite.c:409
+#: .././io/pwrite.c:385
+#, c-format
+msgid "%s: command -%c not supported\n"
+msgstr ""
+
+#: .././io/pwrite.c:472
 msgid ""
-"[-i infile [-d] [-s skip]] [-b bs] [-S seed] [-wW] [-FBR [-Z N]] [-V N] off "
-"len"
+"[-i infile [-dwNOW] [-s skip]] [-b bs] [-S seed] [-FBR [-Z N]] [-V N] off len"
 msgstr ""
 
-#: .././io/pwrite.c:411
+#: .././io/pwrite.c:474
 msgid "writes a number of bytes at a specified offset"
 msgstr ""
 
-#: .././io/seek.c:32
+#: .././io/sync_file_range.c:30
 #, c-format
 msgid ""
 "\n"
-" returns the next hole and/or data offset at or after the requested offset\n"
+" Trigger specific writeback commands on a range of the current file\n"
 "\n"
-" Example:\n"
-" 'seek -d 512'\t\t- offset of data at or following offset 512\n"
-" 'seek -a -r 0'\t- offsets of all data and hole in entire file\n"
+" With no options, the SYNC_FILE_RANGE_WRITE is implied.\n"
+" -a -- wait for IO to finish after writing (SYNC_FILE_RANGE_WAIT_AFTER).\n"
+" -b -- wait for IO to finish before writing (SYNC_FILE_RANGE_WAIT_BEFORE).\n"
+" -w -- write dirty data in range (SYNC_FILE_RANGE_WRITE).\n"
 "\n"
-" Returns the offset of the next data and/or hole. There is an implied hole\n"
-" at the end of file. If the specified offset is past end of file, or there\n"
-" is no data past the specified offset, EOF is returned.\n"
-" -a\t-- return the next data and hole starting at the specified offset.\n"
-" -d\t-- return the next data starting at the specified offset.\n"
-" -h\t-- return the next hole starting at the specified offset.\n"
-" -r\t-- return all remaining type(s) starting at the specified offset.\n"
-" -s\t-- also print the starting offset.\n"
+msgstr ""
+
+#: .././io/sync_file_range.c:101
+msgid "[-abw] off len"
+msgstr ""
+
+#: .././io/sync_file_range.c:102
+msgid "Control writeback on a range of a file"
+msgstr ""
+
+#: .././io/stat.c:52
+msgid "socket"
+msgstr ""
+
+#: .././io/stat.c:54 .././repair/da_util.c:105
+msgid "directory"
+msgstr ""
+
+#: .././io/stat.c:56
+msgid "char device"
+msgstr ""
+
+#: .././io/stat.c:58
+msgid "block device"
+msgstr ""
+
+#: .././io/stat.c:60
+msgid "regular file"
+msgstr ""
+
+#: .././io/stat.c:62
+msgid "symbolic link"
+msgstr ""
+
+#: .././io/stat.c:64
+msgid "fifo"
+msgstr ""
+
+#: .././io/stat.c:95 .././io/stat.c:193
+#, c-format
+msgid "fd.path = \"%s\"\n"
+msgstr ""
+
+#: .././io/stat.c:96
+#, c-format
+msgid "fd.flags = %s,%s,%s%s%s%s%s\n"
+msgstr ""
+
+#: .././io/stat.c:115
+#, c-format
+msgid "fsxattr.xflags = 0x%x "
+msgstr ""
+
+#: .././io/stat.c:117
+#, c-format
+msgid "fsxattr.projid = %u\n"
+msgstr ""
+
+#: .././io/stat.c:118
+#, c-format
+msgid "fsxattr.extsize = %u\n"
+msgstr ""
+
+#: .././io/stat.c:119
+#, c-format
+msgid "fsxattr.cowextsize = %u\n"
+msgstr ""
+
+#: .././io/stat.c:120
+#, c-format
+msgid "fsxattr.nextents = %u\n"
+msgstr ""
+
+#: .././io/stat.c:121
+#, c-format
+msgid "fsxattr.naextents = %u\n"
+msgstr ""
+
+#: .././io/stat.c:126
+#, c-format
+msgid "dioattr.mem = 0x%x\n"
+msgstr ""
+
+#: .././io/stat.c:127
+#, c-format
+msgid "dioattr.miniosz = %u\n"
+msgstr ""
+
+#: .././io/stat.c:128
+#, c-format
+msgid "dioattr.maxiosz = %u\n"
+msgstr ""
+
+#: .././io/stat.c:166 .././io/stat.c:367
+#, c-format
+msgid "stat.ino = %lld\n"
+msgstr ""
+
+#: .././io/stat.c:167 .././io/stat.c:368
+#, c-format
+msgid "stat.type = %s\n"
+msgstr ""
+
+#: .././io/stat.c:168 .././io/stat.c:369
+#, c-format
+msgid "stat.size = %lld\n"
+msgstr ""
+
+#: .././io/stat.c:169 .././io/stat.c:370
+#, c-format
+msgid "stat.blocks = %lld\n"
+msgstr ""
+
+#: .././io/stat.c:171 .././io/stat.c:372
+#, c-format
+msgid "stat.atime = %s"
+msgstr ""
+
+#: .././io/stat.c:172 .././io/stat.c:373
+#, c-format
+msgid "stat.mtime = %s"
+msgstr ""
+
+#: .././io/stat.c:173 .././io/stat.c:374
+#, c-format
+msgid "stat.ctime = %s"
+msgstr ""
+
+#: .././io/stat.c:197
+#, c-format
+msgid "statfs.f_bsize = %lld\n"
+msgstr ""
+
+#: .././io/stat.c:198
+#, c-format
+msgid "statfs.f_blocks = %lld\n"
+msgstr ""
+
+#: .././io/stat.c:199
+#, c-format
+msgid "statfs.f_bavail = %lld\n"
+msgstr ""
+
+#: .././io/stat.c:200
+#, c-format
+msgid "statfs.f_files = %lld\n"
+msgstr ""
+
+#: .././io/stat.c:201
+#, c-format
+msgid "statfs.f_ffree = %lld\n"
+msgstr ""
+
+#: .././io/stat.c:203
+#, c-format
+msgid "statfs.f_flags = 0x%llx\n"
+msgstr ""
+
+#: .././io/stat.c:211
+#, c-format
+msgid "geom.bsize = %u\n"
+msgstr ""
+
+#: .././io/stat.c:212
+#, c-format
+msgid "geom.agcount = %u\n"
+msgstr ""
+
+#: .././io/stat.c:213
+#, c-format
+msgid "geom.agblocks = %u\n"
+msgstr ""
+
+#: .././io/stat.c:214
+#, c-format
+msgid "geom.datablocks = %llu\n"
+msgstr ""
+
+#: .././io/stat.c:216
+#, c-format
+msgid "geom.rtblocks = %llu\n"
+msgstr ""
+
+#: .././io/stat.c:218
+#, c-format
+msgid "geom.rtextents = %llu\n"
+msgstr ""
+
+#: .././io/stat.c:220
+#, c-format
+msgid "geom.rtextsize = %u\n"
+msgstr ""
+
+#: .././io/stat.c:221
+#, c-format
+msgid "geom.sunit = %u\n"
+msgstr ""
+
+#: .././io/stat.c:222
+#, c-format
+msgid "geom.swidth = %u\n"
+msgstr ""
+
+#: .././io/stat.c:227
+#, c-format
+msgid "counts.freedata = %llu\n"
+msgstr ""
+
+#: .././io/stat.c:229
+#, c-format
+msgid "counts.freertx = %llu\n"
+msgstr ""
+
+#: .././io/stat.c:231
+#, c-format
+msgid "counts.freeino = %llu\n"
+msgstr ""
+
+#: .././io/stat.c:233
+#, c-format
+msgid "counts.allocino = %llu\n"
+msgstr ""
+
+#: .././io/stat.c:259
+#, c-format
+msgid ""
+"\n"
+" Display extended file status.\n"
+"\n"
+" Options:\n"
+" -v -- More verbose output\n"
+" -r -- Print raw statx structure fields\n"
+" -m mask -- Specify the field mask for the statx call\n"
+"            (can also be 'basic' or 'all'; default STATX_ALL)\n"
+" -D -- Don't sync attributes with the server\n"
+" -F -- Force the attributes to be sync'd with the server\n"
 "\n"
 msgstr ""
 
-#: .././io/seek.c:218
-msgid "-a | -d | -h [-r] off"
+#: .././io/stat.c:329
+#, c-format
+msgid "non-numeric mask -- %s\n"
 msgstr ""
 
-#: .././io/seek.c:219
-msgid "locate the next data and/or hole"
+#: .././io/stat.c:376
+#, c-format
+msgid "stat.btime = %s"
 msgstr ""
 
-#: .././io/sendfile.c:31
+#: .././io/stat.c:396
+msgid "[-v|-r]"
+msgstr ""
+
+#: .././io/stat.c:397
+msgid "statistics on the currently open file"
+msgstr ""
+
+#: .././io/stat.c:404
+msgid "[-v|-r][-m basic | -m all | -m <mask>][-FD]"
+msgstr ""
+
+#: .././io/stat.c:405
+msgid "extended statistics on the currently open file"
+msgstr ""
+
+#: .././io/stat.c:412
+msgid "statistics on the filesystem of the currently open file"
+msgstr ""
+
+#: .././io/attr.c:60
 #, c-format
 msgid ""
 "\n"
-" transfer a range of bytes from the given offset between files\n"
+" displays the set of extended inode flags associated with the current file\n"
 "\n"
-" Example:\n"
-" 'send -f 2 512 20' - writes 20 bytes at 512 bytes into the open file\n"
+" Each individual flag is displayed as a single character, in this order:\n"
+" r -- file data is stored in the realtime section\n"
+" p -- file has preallocated extents (cannot be changed using chattr)\n"
+" i -- immutable, file cannot be modified\n"
+" a -- append-only, file can only be appended to\n"
+" s -- all updates are synchronous\n"
+" A -- the access time is not updated for this inode\n"
+" d -- do not include this file in a dump of the filesystem\n"
+" t -- child created in this directory has realtime bit set by default\n"
+" P -- child created in this directory has parents project ID by default\n"
+" n -- symbolic links cannot be created in this directory\n"
+" e -- for non-realtime files, observe the inode extent size value\n"
+" E -- children created in this directory inherit the extent size value\n"
+" f -- do not include this file when defragmenting the filesystem\n"
+" S -- enable filestreams allocator for this directory\n"
+" x -- Use direct access (DAX) for data in this file\n"
+" C -- for files with shared blocks, observe the inode CoW extent size value\n"
 "\n"
-" Copies data between one file descriptor and another.  Because this copying\n"
-" is done within the kernel, sendfile does not need to transfer data to and\n"
-" from user space.\n"
-" -f -- specifies an input file from which to source data to write\n"
-" -i -- specifies an input file name from which to source data to write.\n"
-" An offset and length in the source file can be optionally specified.\n"
+" Options:\n"
+" -R -- recursively descend (useful when current file is a directory)\n"
+" -D -- recursively descend, but only list attributes on directories\n"
+" -a -- show all flags which can be set alongside those which are set\n"
+" -v -- verbose mode; show long names of flags, not single characters\n"
+"\n"
+msgstr ""
+
+#: .././io/attr.c:93
+#, c-format
+msgid ""
+"\n"
+" modifies the set of extended inode flags associated with the current file\n"
+"\n"
+" Examples:\n"
+" 'chattr +a' - sets the append-only flag\n"
+" 'chattr -a' - clears the append-only flag\n"
+"\n"
+" -R -- recursively descend (useful when current file is a directory)\n"
+" -D -- recursively descend, only modifying attributes on directories\n"
+" +/-r -- set/clear the realtime flag\n"
+" +/-i -- set/clear the immutable flag\n"
+" +/-a -- set/clear the append-only flag\n"
+" +/-s -- set/clear the sync flag\n"
+" +/-A -- set/clear the no-atime flag\n"
+" +/-d -- set/clear the no-dump flag\n"
+" +/-t -- set/clear the realtime inheritance flag\n"
+" +/-P -- set/clear the project ID inheritance flag\n"
+" +/-n -- set/clear the no-symbolic-links flag\n"
+" +/-e -- set/clear the extent-size flag\n"
+" +/-E -- set/clear the extent-size inheritance flag\n"
+" +/-f -- set/clear the no-defrag flag\n"
+" +/-S -- set/clear the filestreams allocator flag\n"
+" +/-x -- set/clear the direct access (DAX) flag\n"
+" +/-C -- set/clear the CoW extent-size flag\n"
+" Note1: user must have certain capabilities to modify immutable/append-"
+"only.\n"
+" Note2: immutable/append-only files cannot be deleted; removing these files\n"
+"        requires the immutable/append-only flag to be cleared first.\n"
+" Note3: the realtime flag can only be set if the filesystem has a realtime\n"
+"        section, and the (regular) file must be empty when the flag is set.\n"
+"\n"
+msgstr ""
+
+#: .././io/attr.c:179 .././io/attr.c:226 .././io/attr.c:255 .././io/attr.c:326
+#: .././quota/project.c:122 .././quota/project.c:168 .././quota/project.c:215
+#, c-format
+msgid "%s: cannot get flags on %s: %s\n"
+msgstr ""
+
+#: .././io/attr.c:261 .././io/attr.c:332
+#, c-format
+msgid "%s: cannot set flags on %s: %s\n"
+msgstr ""
+
+#: .././io/attr.c:296 .././io/attr.c:310
+#, c-format
+msgid "%s: unknown flag\n"
+msgstr ""
+
+#: .././io/attr.c:316
+#, c-format
+msgid "%s: bad chattr command, not +/-X\n"
+msgstr ""
+
+#: .././io/attr.c:343
+msgid "[-R|-D] [+/-"
+msgstr ""
+
+#: .././io/attr.c:348
+msgid "change extended inode flags on the currently open file"
+msgstr ""
+
+#: .././io/attr.c:353
+msgid "[-R|-D|-a|-v]"
+msgstr ""
+
+#: .././io/attr.c:358
+msgid "list extended inode flags set on the currently open file"
+msgstr ""
+
+#: .././io/cowextsize.c:40
+#, c-format
+msgid ""
 "\n"
+" report or modify preferred CoW extent size (in bytes) for the current path\n"
+"\n"
+" -R -- recursively descend (useful when current path is a directory)\n"
+" -D -- recursively descend, only modifying cowextsize on directories\n"
+"\n"
+msgstr ""
+
+#: .././io/cowextsize.c:169
+#, c-format
+msgid "non-numeric cowextsize argument -- %s\n"
 msgstr ""
 
-#: .././io/sendfile.c:171
-msgid "-i infile | -f N [off len]"
+#: .././io/cowextsize.c:193
+msgid "[-D | -R] [cowextsize]"
 msgstr ""
 
-#: .././io/sendfile.c:173
-msgid "Transfer data directly between file descriptors"
+#: .././io/cowextsize.c:198
+msgid "get/set preferred CoW extent size (in bytes) for the open file"
 msgstr ""
 
-#: .././io/truncate.c:37
+#: .././io/link.c:34
 #, c-format
-msgid "non-numeric truncate argument -- %s\n"
+msgid ""
+"\n"
+"link the open file descriptor to the supplied filename\n"
+"\n"
+"\n"
 msgstr ""
 
-#: .././io/truncate.c:57
-msgid "off"
+#: .././io/link.c:63
+msgid "filename"
 msgstr ""
 
-#: .././io/truncate.c:59
-msgid "truncates the current file at the given offset"
+#: .././io/link.c:65
+msgid "link the open file descriptor to the supplied filename"
 msgstr ""
 
-#: .././libxcmd/topology.c:165
+#: .././libxcmd/paths.c:316
 #, c-format
-msgid "%s: %s appears to contain an existing filesystem (%s).\n"
+msgid "%s: unable to extract mount options for \"%s\"\n"
 msgstr ""
 
-#: .././libxcmd/topology.c:169
+#: .././libxcmd/paths.c:402
 #, c-format
-msgid "%s: %s appears to contain a partition table (%s).\n"
+msgid "%s: getmntinfo() failed: %s\n"
 msgstr ""
 
-#: .././libxcmd/topology.c:173
+#: .././libxcmd/paths.c:471
 #, c-format
-msgid "%s: %s appears to contain something weird according to blkid\n"
+msgid "%s: cannot setup path for mount %s: %s\n"
 msgstr ""
 
-#: .././libxcmd/topology.c:182
+#: .././libxcmd/paths.c:493
 #, c-format
-msgid "%s: probe of %s failed, cannot detect existing filesystem.\n"
+msgid "%s: cannot find mount point for path `%s': %s\n"
 msgstr ""
 
-#: .././libxcmd/topology.c:204
+#: .././libxcmd/paths.c:521
 #, c-format
-msgid "%s: Warning: trying to probe topology of a file %s!\n"
+msgid "%s: cannot setup path for project %s: %s\n"
 msgstr ""
 
-#: .././libxcmd/topology.c:245
+#: .././libxcmd/paths.c:562
 #, c-format
-msgid "warning: device is not properly aligned %s\n"
+msgid "%s: cannot initialise path table: %s\n"
 msgstr ""
 
-#: .././libxcmd/topology.c:250
+#: .././libxcmd/paths.c:582
 #, c-format
-msgid "Use -f to force usage of a misaligned device\n"
+msgid "%s: cannot setup path for project dir %s: %s\n"
 msgstr ""
 
-#: .././libxcmd/topology.c:264
+#: .././libxcmd/command.c:95
 #, c-format
-msgid "warning: unable to probe device topology for device %s\n"
+msgid "bad argument count %d to %s, expected at least %d arguments\n"
 msgstr ""
 
-#: .././libxcmd/paths.c:285
+#: .././libxcmd/command.c:99
 #, c-format
-msgid "%s: unable to extract mount options for \"%s\"\n"
+msgid "bad argument count %d to %s, expected %d arguments\n"
 msgstr ""
 
-#: .././libxcmd/paths.c:371
+#: .././libxcmd/command.c:103
 #, c-format
-msgid "%s: getmntinfo() failed: %s\n"
+msgid "bad argument count %d to %s, expected between %d and %d arguments\n"
 msgstr ""
 
-#: .././libxcmd/paths.c:440
+#: .././libxcmd/command.c:202
 #, c-format
-msgid "%s: cannot setup path for mount %s: %s\n"
+msgid "command \"%s\" not found\n"
 msgstr ""
 
-#: .././libxcmd/paths.c:462
+#: .././libxcmd/command.c:239
 #, c-format
-msgid "%s: cannot find mount point for path `%s': %s\n"
+msgid "cannot strdup command '%s': %s\n"
 msgstr ""
 
-#: .././libxcmd/paths.c:490
+#: .././libxcmd/command.c:265
 #, c-format
-msgid "%s: cannot setup path for project %s: %s\n"
+msgid "%s %lld/%lld bytes at offset %lld\n"
 msgstr ""
 
-#: .././libxcmd/paths.c:531
+#: .././libxcmd/command.c:267
 #, c-format
-msgid "%s: cannot initialise path table: %s\n"
+msgid "%s, %d ops; %s (%s/sec and %.4f ops/sec)\n"
+msgstr ""
+
+#: .././libxcmd/quit.c:43
+msgid "exit the program"
 msgstr ""
 
-#: .././libxcmd/paths.c:551
+#: .././libxcmd/topology.c:165
 #, c-format
-msgid "%s: cannot setup path for project dir %s: %s\n"
+msgid "%s: %s appears to contain an existing filesystem (%s).\n"
 msgstr ""
 
-#: .././libxcmd/command.c:85
+#: .././libxcmd/topology.c:169
 #, c-format
-msgid "bad argument count %d to %s, expected at least %d arguments\n"
+msgid "%s: %s appears to contain a partition table (%s).\n"
 msgstr ""
 
-#: .././libxcmd/command.c:89
+#: .././libxcmd/topology.c:173
 #, c-format
-msgid "bad argument count %d to %s, expected %d arguments\n"
+msgid "%s: %s appears to contain something weird according to blkid\n"
 msgstr ""
 
-#: .././libxcmd/command.c:93
+#: .././libxcmd/topology.c:182
 #, c-format
-msgid "bad argument count %d to %s, expected between %d and %d arguments\n"
+msgid "%s: probe of %s failed, cannot detect existing filesystem.\n"
 msgstr ""
 
-#: .././libxcmd/command.c:155
+#: .././libxcmd/topology.c:204
 #, c-format
-msgid "cannot strdup command '%s': %s\n"
+msgid "%s: Warning: trying to probe topology of a file %s!\n"
 msgstr ""
 
-#: .././libxcmd/command.c:171 .././libxcmd/command.c:189
+#: .././libxcmd/topology.c:245
 #, c-format
-msgid "command \"%s\" not found\n"
+msgid "warning: device is not properly aligned %s\n"
 msgstr ""
 
-#: .././libxcmd/command.c:212
+#: .././libxcmd/topology.c:250
 #, c-format
-msgid "%s %lld/%lld bytes at offset %lld\n"
+msgid "Use -f to force usage of a misaligned device\n"
 msgstr ""
 
-#: .././libxcmd/command.c:214
+#: .././libxcmd/topology.c:264
 #, c-format
-msgid "%s, %d ops; %s (%s/sec and %.4f ops/sec)\n"
+msgid "warning: unable to probe device topology for device %s\n"
 msgstr ""
 
-#: .././libxcmd/quit.c:43
-msgid "exit the program"
+#: .././libxfs/util.c:688
+#, c-format
+msgid "%s: cannot duplicate transaction: %s\n"
 msgstr ""
 
 #: .././libxfs/irix.c:58 .././libxfs/linux.c:170 .././libxfs/freebsd.c:116
@@ -5585,6 +5998,26 @@ msgstr ""
 msgid "%s: warning - cannot get sector size from block device %s: %s\n"
 msgstr ""
 
+#: .././libxfs/kmem.c:15
+#, c-format
+msgid "%s: zone init failed (%s, %d bytes): %s\n"
+msgstr ""
+
+#: .././libxfs/kmem.c:32
+#, c-format
+msgid "%s: zone alloc failed (%s, %d bytes): %s\n"
+msgstr ""
+
+#: .././libxfs/kmem.c:56
+#, c-format
+msgid "%s: malloc failed (%d bytes): %s\n"
+msgstr ""
+
+#: .././libxfs/kmem.c:77
+#, c-format
+msgid "%s: realloc failed (%d bytes): %s\n"
+msgstr ""
+
 #: .././libxfs/rdwr.c:82
 #, c-format
 msgid "%s: %s can't memalign %d bytes: %s\n"
@@ -5610,47 +6043,47 @@ msgstr ""
 msgid "%s: %s can't memalign %u bytes: %s\n"
 msgstr ""
 
-#: .././libxfs/rdwr.c:614
+#: .././libxfs/rdwr.c:621
 #, c-format
 msgid "%s: %s can't malloc %u bytes: %s\n"
 msgstr ""
 
-#: .././libxfs/rdwr.c:697
+#: .././libxfs/rdwr.c:705
 #, c-format
 msgid "%s: %s invalid map %p or nmaps %d\n"
 msgstr ""
 
-#: .././libxfs/rdwr.c:704
+#: .././libxfs/rdwr.c:712
 #, c-format
 msgid "%s: %s map blkno 0x%llx doesn't match key 0x%llx\n"
 msgstr ""
 
-#: .././libxfs/rdwr.c:749
+#: .././libxfs/rdwr.c:757
 #, c-format
 msgid "Warning: recursive buffer locking at block %<PRIu64> detected\n"
 msgstr ""
 
-#: .././libxfs/rdwr.c:921
+#: .././libxfs/rdwr.c:929
 #, c-format
 msgid "%s: read failed: %s\n"
 msgstr ""
 
-#: .././libxfs/rdwr.c:927
+#: .././libxfs/rdwr.c:935
 #, c-format
 msgid "%s: error - read only %d of %d bytes\n"
 msgstr ""
 
-#: .././libxfs/rdwr.c:1089
+#: .././libxfs/rdwr.c:1097
 #, c-format
 msgid "%s: pwrite failed: %s\n"
 msgstr ""
 
-#: .././libxfs/rdwr.c:1095
+#: .././libxfs/rdwr.c:1103
 #, c-format
 msgid "%s: error - pwrite only %d of %d bytes\n"
 msgstr ""
 
-#: .././libxfs/rdwr.c:1130
+#: .././libxfs/rdwr.c:1138
 #, c-format
 msgid "%s: write verifer failed on %s bno 0x%llx/0x%x\n"
 msgstr ""
@@ -5675,24 +6108,44 @@ msgstr ""
 msgid "%s: DIOCGSECTORSIZE failed on \"%s\": %s\n"
 msgstr ""
 
-#: .././libxfs/kmem.c:15
+#: .././libxfs/darwin.c:41
 #, c-format
-msgid "%s: zone init failed (%s, %d bytes): %s\n"
+msgid "%s: error opening the device special file \"%s\": %s\n"
 msgstr ""
 
-#: .././libxfs/kmem.c:32
+#: .././libxfs/darwin.c:48
 #, c-format
-msgid "%s: zone alloc failed (%s, %d bytes): %s\n"
+msgid "%s: can't tell if \"%s\" is writable: %s\n"
 msgstr ""
 
-#: .././libxfs/kmem.c:56
+#: .././libxfs/darwin.c:86
 #, c-format
-msgid "%s: malloc failed (%d bytes): %s\n"
+msgid "%s: can't determine device size: %s\n"
 msgstr ""
 
-#: .././libxfs/kmem.c:77
+#: .././libxfs/trans.c:69
 #, c-format
-msgid "%s: realloc failed (%d bytes): %s\n"
+msgid "%s: lidp calloc failed (%d bytes): %s\n"
+msgstr ""
+
+#: .././libxfs/trans.c:170
+#, c-format
+msgid "%s: xact calloc failed (%d bytes): %s\n"
+msgstr ""
+
+#: .././libxfs/trans.c:715
+#, c-format
+msgid "%s: warning - imap_to_bp failed (%d)\n"
+msgstr ""
+
+#: .././libxfs/trans.c:723
+#, c-format
+msgid "%s: warning - iflush_int failed (%d)\n"
+msgstr ""
+
+#: .././libxfs/trans.c:783 .././libxfs/trans.c:837
+#, c-format
+msgid "%s: unrecognised log item type\n"
 msgstr ""
 
 #: .././libxfs/init.c:97 .././libxfs/init.c:196
@@ -5725,144 +6178,109 @@ msgstr ""
 msgid "%s: can't find a block device matching %s\n"
 msgstr ""
 
-#: .././libxfs/init.c:348
+#: .././libxfs/init.c:334
 #, c-format
 msgid "%s: can't get size for data subvolume\n"
 msgstr ""
 
-#: .././libxfs/init.c:353
+#: .././libxfs/init.c:339
 #, c-format
 msgid "%s: can't get size for log subvolume\n"
 msgstr ""
 
-#: .././libxfs/init.c:358
+#: .././libxfs/init.c:344
 #, c-format
 msgid "%s: can't get size for realtime subvolume\n"
 msgstr ""
 
-#: .././libxfs/init.c:453
+#: .././libxfs/init.c:437
 #, c-format
 msgid "%s: filesystem has a realtime subvolume\n"
 msgstr ""
 
-#: .././libxfs/init.c:475
+#: .././libxfs/init.c:459
 #, c-format
 msgid "%s: realtime init - %llu != %llu\n"
 msgstr ""
 
-#: .././libxfs/init.c:483
+#: .././libxfs/init.c:467
 #, c-format
 msgid "%s: realtime size check failed\n"
 msgstr ""
 
-#: .././libxfs/init.c:605
+#: .././libxfs/init.c:589
 #, c-format
 msgid "%s: buftarg init failed\n"
 msgstr ""
 
-#: .././libxfs/init.c:626
+#: .././libxfs/init.c:610
 #, c-format
 msgid "%s: bad buftarg reinit, ddev\n"
 msgstr ""
 
-#: .././libxfs/init.c:633
+#: .././libxfs/init.c:617
 #, c-format
 msgid "%s: bad buftarg reinit, ldev mismatch\n"
 msgstr ""
 
-#: .././libxfs/init.c:640
+#: .././libxfs/init.c:624
 #, c-format
 msgid "%s: bad buftarg reinit, logdev\n"
 msgstr ""
 
-#: .././libxfs/init.c:647
+#: .././libxfs/init.c:631
 #, c-format
 msgid "%s: bad buftarg reinit, rtdev\n"
 msgstr ""
 
-#: .././libxfs/init.c:741
+#: .././libxfs/init.c:732
 #, c-format
 msgid "%s: size check failed\n"
 msgstr ""
 
-#: .././libxfs/init.c:753
+#: .././libxfs/init.c:744
 #, c-format
 msgid "%s: V1 inodes unsupported. Please try an older xfsprogs.\n"
 msgstr ""
 
-#: .././libxfs/init.c:762
+#: .././libxfs/init.c:753
 #, c-format
 msgid "%s: V1 directories unsupported. Please try an older xfsprogs.\n"
 msgstr ""
 
-#: .././libxfs/init.c:770
+#: .././libxfs/init.c:761
 #, c-format
 msgid "%s: Unsupported features detected. Please try a newer xfsprogs.\n"
 msgstr ""
 
-#: .././libxfs/init.c:790
+#: .././libxfs/init.c:781
 #, c-format
 msgid "%s: data size check failed\n"
 msgstr ""
 
-#: .././libxfs/init.c:804
+#: .././libxfs/init.c:795
 #, c-format
 msgid "%s: log size checks failed\n"
 msgstr ""
 
-#: .././libxfs/init.c:815
+#: .././libxfs/init.c:806
 #, c-format
 msgid "%s: realtime device init failed\n"
 msgstr ""
 
-#: .././libxfs/init.c:822
-#, c-format
-msgid "%s: perag init failed\n"
-msgstr ""
-
-#: .././libxfs/trans.c:69
-#, c-format
-msgid "%s: lidp calloc failed (%d bytes): %s\n"
-msgstr ""
-
-#: .././libxfs/trans.c:183
-#, c-format
-msgid "%s: xact calloc failed (%d bytes): %s\n"
-msgstr ""
-
-#: .././libxfs/trans.c:670
-#, c-format
-msgid "%s: warning - imap_to_bp failed (%d)\n"
-msgstr ""
-
-#: .././libxfs/trans.c:678
-#, c-format
-msgid "%s: warning - iflush_int failed (%d)\n"
-msgstr ""
-
-#: .././libxfs/trans.c:738 .././libxfs/trans.c:792
-#, c-format
-msgid "%s: unrecognised log item type\n"
-msgstr ""
-
-#: .././libxfs/util.c:617
-#, c-format
-msgid "%s: cannot duplicate transaction: %s\n"
-msgstr ""
-
-#: .././libxfs/darwin.c:41
+#: .././libxfs/init.c:823
 #, c-format
-msgid "%s: error opening the device special file \"%s\": %s\n"
+msgid "%s: read of AG %u failed\n"
 msgstr ""
 
-#: .././libxfs/darwin.c:48
+#: .././libxfs/init.c:827
 #, c-format
-msgid "%s: can't tell if \"%s\" is writable: %s\n"
+msgid "%s: limiting reads to AG 0\n"
 msgstr ""
 
-#: .././libxfs/darwin.c:86
+#: .././libxfs/init.c:836
 #, c-format
-msgid "%s: can't determine device size: %s\n"
+msgid "%s: perag init failed\n"
 msgstr ""
 
 #: .././libxlog/util.c:67
@@ -6114,9 +6532,82 @@ msgstr ""
 msgid "BUD:  #regs: %d\t                 id: 0x%llx\n"
 msgstr ""
 
-#: .././logprint/log_redo.c:654
+#: .././logprint/log_redo.c:654
+#, c-format
+msgid "BUD: Not enough data to decode further\n"
+msgstr ""
+
+#: .././logprint/logprint.c:45
+#, c-format
+msgid ""
+"Usage: %s [options...] <device>\n"
+"\n"
+"Options:\n"
+"    -c\t            try to continue if error found in log\n"
+"    -C <filename>   copy the log from the filesystem to filename\n"
+"    -d\t            dump the log in log-record format\n"
+"    -e\t            exit when an error is found in the log\n"
+"    -f\t            specified device is actually a file\n"
+"    -l <device>     filename of external log\n"
+"    -n\t            don't try and interpret log data\n"
+"    -o\t            print buffer data in hex\n"
+"    -s <start blk>  block # to start printing\n"
+"    -v              print \"overwrite\" data\n"
+"    -t\t            print out transactional view\n"
+"\t-b          in transactional view, extract buffer info\n"
+"\t-i          in transactional view, extract inode info\n"
+"\t-q          in transactional view, extract quota info\n"
+"    -D              print only data; no decoding\n"
+"    -V              print version information\n"
+msgstr ""
+
+#: .././logprint/logprint.c:79
+#, c-format
+msgid "    Can't open device %s: %s\n"
+msgstr ""
+
+#: .././logprint/logprint.c:85
+#, c-format
+msgid "    read of XFS superblock failed\n"
+msgstr ""
+
+#: .././logprint/logprint.c:105
+#, c-format
+msgid ""
+"    external log device not specified\n"
+"\n"
+msgstr ""
+
+#: .././logprint/logprint.c:121
+#, c-format
+msgid "Can't open file %s: %s\n"
+msgstr ""
+
+#: .././logprint/logprint.c:222
+#, c-format
+msgid "xfs_logprint:\n"
+msgstr ""
+
+#: .././logprint/logprint.c:231
+#, c-format
+msgid "    data device: 0x%llx\n"
+msgstr ""
+
+#: .././logprint/logprint.c:234
+#, c-format
+msgid "    log file: \"%s\" "
+msgstr ""
+
+#: .././logprint/logprint.c:236
+#, c-format
+msgid "    log device: 0x%llx "
+msgstr ""
+
+#: .././logprint/logprint.c:239
 #, c-format
-msgid "BUD: Not enough data to decode further\n"
+msgid ""
+"daddr: %lld length: %lld\n"
+"\n"
 msgstr ""
 
 #: .././logprint/log_misc.c:87
@@ -6341,1257 +6832,1567 @@ msgstr ""
 msgid "%s ino 0x%llx namelen %d\n"
 msgstr ""
 
-#: .././logprint/log_misc.c:544
+#: .././logprint/log_misc.c:545
 #, c-format
 msgid "INODE: "
 msgstr ""
 
-#: .././logprint/log_misc.c:545
+#: .././logprint/log_misc.c:546
 #, c-format
 msgid "#regs: %d   ino: 0x%llx  flags: 0x%x   dsize: %d\n"
 msgstr ""
 
-#: .././logprint/log_misc.c:548
+#: .././logprint/log_misc.c:549
 #, c-format
 msgid "        blkno: %lld  len: %d  boff: %d\n"
 msgstr ""
 
-#: .././logprint/log_misc.c:553
+#: .././logprint/log_misc.c:554
 #, c-format
 msgid "INODE: #regs: %d   Not printing rest of data\n"
 msgstr ""
 
-#: .././logprint/log_misc.c:584
+#: .././logprint/log_misc.c:581
 #, c-format
 msgid "DEV inode: no extra region\n"
 msgstr ""
 
-#: .././logprint/log_misc.c:587
+#: .././logprint/log_misc.c:584
 #, c-format
 msgid "UUID inode: no extra region\n"
 msgstr ""
 
-#: .././logprint/log_misc.c:604
+#: .././logprint/log_misc.c:606
 #, c-format
 msgid "EXTENTS inode data\n"
 msgstr ""
 
-#: .././logprint/log_misc.c:607
+#: .././logprint/log_misc.c:609
 #, c-format
 msgid "BTREE inode data\n"
 msgstr ""
 
-#: .././logprint/log_misc.c:610
+#: .././logprint/log_misc.c:612
 #, c-format
 msgid "LOCAL inode data\n"
 msgstr ""
 
-#: .././logprint/log_misc.c:631
+#: .././logprint/log_misc.c:636
 #, c-format
 msgid "EXTENTS attr data\n"
 msgstr ""
 
-#: .././logprint/log_misc.c:634
+#: .././logprint/log_misc.c:639
 #, c-format
 msgid "BTREE attr data\n"
 msgstr ""
 
-#: .././logprint/log_misc.c:637
+#: .././logprint/log_misc.c:642
 #, c-format
 msgid "LOCAL attr data\n"
 msgstr ""
 
-#: .././logprint/log_misc.c:675
+#: .././logprint/log_misc.c:683
 #, c-format
 msgid "#regs: %d   id: 0x%x"
 msgstr ""
 
-#: .././logprint/log_misc.c:676
+#: .././logprint/log_misc.c:684
 #, c-format
 msgid "  blkno: %lld  len: %d  boff: %d\n"
 msgstr ""
 
-#: .././logprint/log_misc.c:680
+#: .././logprint/log_misc.c:688
 #, c-format
 msgid "DQUOT: #regs: %d   Not printing rest of data\n"
 msgstr ""
 
-#: .././logprint/log_misc.c:699
+#: .././logprint/log_misc.c:707
 #, c-format
 msgid "DQUOT: magic 0x%hx flags 0%ho\n"
 msgstr ""
 
-#: .././logprint/log_misc.c:725
+#: .././logprint/log_misc.c:733
 #, c-format
 msgid "ICR: split header, not printing\n"
 msgstr ""
 
-#: .././logprint/log_misc.c:729
+#: .././logprint/log_misc.c:737
 #, c-format
 msgid ""
 "ICR:  #ag: %d  agbno: 0x%x  len: %d\n"
 "      cnt: %d  isize: %d    gen: 0x%x\n"
 msgstr ""
 
-#: .././logprint/log_misc.c:755
+#: .././logprint/log_misc.c:763
 #, c-format
 msgid "%s: lseek to %lld failed: %s\n"
 msgstr ""
 
-#: .././logprint/log_misc.c:801
+#: .././logprint/log_misc.c:809
 #, c-format
 msgid "%s: xlog_print_record: malloc failed\n"
 msgstr ""
 
-#: .././logprint/log_misc.c:810
+#: .././logprint/log_misc.c:818
 #, c-format
 msgid "%s: xlog_print_record: read error\n"
 msgstr ""
 
-#: .././logprint/log_misc.c:905 .././logprint/log_misc.c:1008
+#: .././logprint/log_misc.c:913 .././logprint/log_misc.c:1016
 #, c-format
 msgid "Left over region from split log item\n"
 msgstr ""
 
-#: .././logprint/log_misc.c:993
+#: .././logprint/log_misc.c:1001
 #, c-format
 msgid "Unmount filesystem\n"
 msgstr ""
 
-#: .././logprint/log_misc.c:1000
+#: .././logprint/log_misc.c:1008
 #, c-format
 msgid "%s: unknown log operation type (%x)\n"
 msgstr ""
 
-#: .././logprint/log_misc.c:1041
+#: .././logprint/log_misc.c:1049
 #, c-format
 msgid "Header 0x%x wanted 0x%x\n"
 msgstr ""
 
-#: .././logprint/log_misc.c:1055
+#: .././logprint/log_misc.c:1063
 #, c-format
 msgid "cycle: %d\tversion: %d\t"
 msgstr ""
 
-#: .././logprint/log_misc.c:1061
+#: .././logprint/log_misc.c:1069
 #, c-format
 msgid "length of Log Record: %d\tprev offset: %d\t\tnum ops: %d\n"
 msgstr ""
 
-#: .././logprint/log_misc.c:1067 .././logprint/log_misc.c:1109
+#: .././logprint/log_misc.c:1075 .././logprint/log_misc.c:1117
 #, c-format
 msgid "cycle num overwrites: "
 msgstr ""
 
-#: .././logprint/log_misc.c:1076
+#: .././logprint/log_misc.c:1084
 #, c-format
 msgid "uuid: %s   format: "
 msgstr ""
 
-#: .././logprint/log_misc.c:1079
+#: .././logprint/log_misc.c:1087
 #, c-format
 msgid "unknown\n"
 msgstr ""
 
-#: .././logprint/log_misc.c:1082
+#: .././logprint/log_misc.c:1090
 #, c-format
 msgid "little endian linux\n"
 msgstr ""
 
-#: .././logprint/log_misc.c:1085
+#: .././logprint/log_misc.c:1093
 #, c-format
 msgid "big endian linux\n"
 msgstr ""
 
-#: .././logprint/log_misc.c:1088
+#: .././logprint/log_misc.c:1096
 #, c-format
 msgid "big endian irix\n"
 msgstr ""
 
-#: .././logprint/log_misc.c:1094
+#: .././logprint/log_misc.c:1102
 #, c-format
 msgid "h_size: %d\n"
 msgstr ""
 
-#: .././logprint/log_misc.c:1106
+#: .././logprint/log_misc.c:1114
 #, c-format
 msgid "extended-header: cycle: %d\n"
 msgstr ""
 
-#: .././logprint/log_misc.c:1122
+#: .././logprint/log_misc.c:1130
 #, c-format
 msgid "* ERROR: found data after zeroed blocks block=%-21lld  *\n"
 msgstr ""
 
-#: .././logprint/log_misc.c:1133
+#: .././logprint/log_misc.c:1141
 #, c-format
 msgid "* ERROR: header cycle=%-11d block=%-21lld        *\n"
 msgstr ""
 
-#: .././logprint/log_misc.c:1144
+#: .././logprint/log_misc.c:1152
 #, c-format
 msgid "* ERROR: data block=%-21lld                             *\n"
 msgstr ""
 
-#: .././logprint/log_misc.c:1155
+#: .././logprint/log_misc.c:1163
 #, c-format
 msgid ""
 "* ERROR: for header block=%lld\n"
 "*        not enough hdrs for data length, required num = %d, hdr num = %d\n"
 msgstr ""
 
-#: .././logprint/log_misc.c:1161
+#: .././logprint/log_misc.c:1169
 msgid "Not enough headers for data length."
 msgstr ""
 
-#: .././logprint/log_misc.c:1171
+#: .././logprint/log_misc.c:1179
 #, c-format
 msgid "%s: xlog_print: malloc failed for ext hdrs\n"
 msgstr ""
 
-#: .././logprint/log_misc.c:1219 .././logprint/log_misc.c:1295
-#: .././logprint/log_misc.c:1366 .././logprint/log_misc.c:1403
+#: .././logprint/log_misc.c:1227 .././logprint/log_misc.c:1303
+#: .././logprint/log_misc.c:1374 .././logprint/log_misc.c:1411
 #, c-format
 msgid "%s: physical end of log\n"
 msgstr ""
 
-#: .././logprint/log_misc.c:1225 .././logprint/log_misc.c:1300
-#: .././logprint/log_misc.c:1418
+#: .././logprint/log_misc.c:1233 .././logprint/log_misc.c:1308
+#: .././logprint/log_misc.c:1426
 #, c-format
 msgid "BLKNO: %lld\n"
 msgstr ""
 
-#: .././logprint/log_misc.c:1283
+#: .././logprint/log_misc.c:1291
 #, c-format
 msgid "%s: problem finding oldest LR\n"
 msgstr ""
 
-#: .././logprint/log_misc.c:1309
+#: .././logprint/log_misc.c:1317
 #, c-format
 msgid "%s: after %d zeroed blocks\n"
 msgstr ""
 
-#: .././logprint/log_misc.c:1378
+#: .././logprint/log_misc.c:1386
 msgid "illegal value"
 msgstr ""
 
-#: .././logprint/log_misc.c:1384
+#: .././logprint/log_misc.c:1392
 #, c-format
 msgid "%s: skipped %d cleared blocks in range: %lld - %lld\n"
 msgstr ""
 
-#: .././logprint/log_misc.c:1389
+#: .././logprint/log_misc.c:1397
 #, c-format
 msgid "%s: totally cleared log\n"
 msgstr ""
 
-#: .././logprint/log_misc.c:1394
+#: .././logprint/log_misc.c:1402
 #, c-format
 msgid "%s: skipped %d zeroed blocks in range: %lld - %lld\n"
 msgstr ""
 
-#: .././logprint/log_misc.c:1399
+#: .././logprint/log_misc.c:1407
 #, c-format
 msgid "%s: totally zeroed log\n"
 msgstr ""
 
-#: .././logprint/log_misc.c:1415
+#: .././logprint/log_misc.c:1423
 msgid "xlog_find_head: bad read"
 msgstr ""
 
-#: .././logprint/log_misc.c:1467
+#: .././logprint/log_misc.c:1475
 #, c-format
 msgid "%s: logical end of log\n"
 msgstr ""
 
-#: .././logprint/logprint.c:45
+#: .././logprint/log_print_all.c:96
 #, c-format
 msgid ""
-"Usage: %s [options...] <device>\n"
-"\n"
-"Options:\n"
-"    -c\t            try to continue if error found in log\n"
-"    -C <filename>   copy the log from the filesystem to filename\n"
-"    -d\t            dump the log in log-record format\n"
-"    -e\t            exit when an error is found in the log\n"
-"    -f\t            specified device is actually a file\n"
-"    -l <device>     filename of external log\n"
-"    -n\t            don't try and interpret log data\n"
-"    -o\t            print buffer data in hex\n"
-"    -s <start blk>  block # to start printing\n"
-"    -v              print \"overwrite\" data\n"
-"    -t\t            print out transactional view\n"
-"\t-b          in transactional view, extract buffer info\n"
-"\t-i          in transactional view, extract inode info\n"
-"\t-q          in transactional view, extract quota info\n"
-"    -D              print only data; no decoding\n"
-"    -V              print version information\n"
+"BUF:  #regs:%d   start blkno:0x%llx   len:%d   bmap size:%d   flags:0x%x\n"
 msgstr ""
 
-#: .././logprint/logprint.c:79
+#: .././logprint/log_print_all.c:106
 #, c-format
-msgid "    Can't open device %s: %s\n"
+msgid "\tSUPER Block Buffer:\n"
 msgstr ""
 
-#: .././logprint/logprint.c:85
+#: .././logprint/log_print_all.c:109
+#, c-format
+msgid "              icount:%llu ifree:%llu  "
+msgstr ""
+
+#: .././logprint/log_print_all.c:114
+#, c-format
+msgid "fdblks:%llu  frext:%llu\n"
+msgstr ""
+
+#: .././logprint/log_print_all.c:119
+#, c-format
+msgid "\t\tsunit:%u  swidth:%u\n"
+msgstr ""
+
+#: .././logprint/log_print_all.c:125
+#, c-format
+msgid "\tAGI Buffer: (XAGI)\n"
+msgstr ""
+
+#: .././logprint/log_print_all.c:128
+#, c-format
+msgid "\t\tver:%d  "
+msgstr ""
+
+#: .././logprint/log_print_all.c:130
+#, c-format
+msgid "seq#:%d  len:%d  cnt:%d  root:%d\n"
+msgstr ""
+
+#: .././logprint/log_print_all.c:135
+#, c-format
+msgid "\t\tlevel:%d  free#:0x%x  newino:0x%x\n"
+msgstr ""
+
+#: .././logprint/log_print_all.c:159
+#, c-format
+msgid "\tAGF Buffer: (XAGF)\n"
+msgstr ""
+
+#: .././logprint/log_print_all.c:162
+#, c-format
+msgid "\t\tver:%d  seq#:%d  len:%d  \n"
+msgstr ""
+
+#: .././logprint/log_print_all.c:166
+#, c-format
+msgid "\t\troot BNO:%d  CNT:%d\n"
+msgstr ""
+
+#: .././logprint/log_print_all.c:169
+#, c-format
+msgid "\t\tlevel BNO:%d  CNT:%d\n"
+msgstr ""
+
+#: .././logprint/log_print_all.c:172
+#, c-format
+msgid "\t\t1st:%d  last:%d  cnt:%d  freeblks:%d  longest:%d\n"
+msgstr ""
+
+#: .././logprint/log_print_all.c:181
+#, c-format
+msgid "\tDQUOT Buffer:\n"
+msgstr ""
+
+#: .././logprint/log_print_all.c:184
+#, c-format
+msgid "\t\tUIDs 0x%lx-0x%lx\n"
+msgstr ""
+
+#: .././logprint/log_print_all.c:189
+#, c-format
+msgid "\tBUF DATA\n"
+msgstr ""
+
+#: .././logprint/log_print_all.c:211
+#, c-format
+msgid "\tQUOTAOFF: #regs:%d   type:%s\n"
+msgstr ""
+
+#: .././logprint/log_print_all.c:226
+#, c-format
+msgid "\tDQUOT: #regs:%d  blkno:%lld  boffset:%u id: %d\n"
+msgstr ""
+
+#: .././logprint/log_print_all.c:230
+#, c-format
+msgid "\t\tmagic 0x%x\tversion 0x%x\tID 0x%x (%d)\t\n"
+msgstr ""
+
+#: .././logprint/log_print_all.c:235
+#, c-format
+msgid "\t\tblk_hard 0x%x\tblk_soft 0x%x\tino_hard 0x%x\tino_soft 0x%x\n"
+msgstr ""
+
+#: .././logprint/log_print_all.c:241
+#, c-format
+msgid "\t\tbcount 0x%x (%d) icount 0x%x (%d)\n"
+msgstr ""
+
+#: .././logprint/log_print_all.c:246
+#, c-format
+msgid "\t\tbtimer 0x%x itimer 0x%x \n"
+msgstr ""
+
+#: .././logprint/log_print_all.c:255
+#, c-format
+msgid "\tCORE inode:\n"
+msgstr ""
+
+#: .././logprint/log_print_all.c:258
+#, c-format
+msgid "\t\tmagic:%c%c  mode:0x%x  ver:%d  format:%d\n"
+msgstr ""
+
+#: .././logprint/log_print_all.c:261
+#, c-format
+msgid "\t\tuid:%d  gid:%d  nlink:%d projid:0x%04x%04x\n"
+msgstr ""
+
+#: .././logprint/log_print_all.c:264
+#, c-format
+msgid "\t\tatime:%d  mtime:%d  ctime:%d\n"
+msgstr ""
+
+#: .././logprint/log_print_all.c:266
+#, c-format
+msgid "\t\tflushiter:%d\n"
+msgstr ""
+
+#: .././logprint/log_print_all.c:267
+#, c-format
+msgid "\t\tsize:0x%llx  nblks:0x%llx  exsize:%d  nextents:%d  anextents:%d\n"
+msgstr ""
+
+#: .././logprint/log_print_all.c:271
+#, c-format
+msgid "\t\tforkoff:%d  dmevmask:0x%x  dmstate:%d  flags:0x%x  gen:%u\n"
+msgstr ""
+
+#: .././logprint/log_print_all.c:295
+#, c-format
+msgid "\tINODE: #regs:%d   ino:0x%llx  flags:0x%x   dsize:%d\n"
+msgstr ""
+
+#: .././logprint/log_print_all.c:311
+#, c-format
+msgid "\t\tDATA FORK EXTENTS inode data:\n"
+msgstr ""
+
+#: .././logprint/log_print_all.c:318
+#, c-format
+msgid "\t\tDATA FORK BTREE inode data:\n"
+msgstr ""
+
+#: .././logprint/log_print_all.c:325
+#, c-format
+msgid "\t\tDATA FORK LOCAL inode data:\n"
+msgstr ""
+
+#: .././logprint/log_print_all.c:332
+#, c-format
+msgid "\t\tDEV inode: no extra region\n"
+msgstr ""
+
+#: .././logprint/log_print_all.c:336
+#, c-format
+msgid "\t\tUUID inode: no extra region\n"
+msgstr ""
+
+#: .././logprint/log_print_all.c:351
+#, c-format
+msgid "\t\tATTR FORK EXTENTS inode data:\n"
+msgstr ""
+
+#: .././logprint/log_print_all.c:359
+#, c-format
+msgid "\t\tATTR FORK BTREE inode data:\n"
+msgstr ""
+
+#: .././logprint/log_print_all.c:367
+#, c-format
+msgid "\t\tATTR FORK LOCAL inode data:\n"
+msgstr ""
+
+#: .././logprint/log_print_all.c:388
+#, c-format
+msgid ""
+"\tICR:  #ag: %d  agbno: 0x%x  len: %d\n"
+"\t      cnt: %d  isize: %d    gen: 0x%x\n"
+msgstr ""
+
+#: .././logprint/log_print_all.c:440
+#, c-format
+msgid "xlog_recover_print_logitem: illegal type\n"
+msgstr ""
+
+#: .././logprint/log_print_all.c:492
+#, c-format
+msgid "%s: illegal type"
+msgstr ""
+
+#: .././logprint/log_print_all.c:500
+#, c-format
+msgid ": cnt:%d total:%d "
+msgstr ""
+
+#: .././logprint/log_print_all.c:502
+#, c-format
+msgid "a:0x%lx len:%d "
+msgstr ""
+
+#: .././mkfs/xfs_mkfs.c:757
+#, c-format
+msgid "both data sunit and data swidth options must be specified\n"
+msgstr ""
+
+#: .././mkfs/xfs_mkfs.c:765
+#, c-format
+msgid "both data su and data sw options must be specified\n"
+msgstr ""
+
+#: .././mkfs/xfs_mkfs.c:772
 #, c-format
-msgid "    read of XFS superblock failed\n"
+msgid "data su must be a multiple of the sector size (%d)\n"
 msgstr ""
 
-#: .././logprint/logprint.c:105
+#: .././mkfs/xfs_mkfs.c:783
 #, c-format
 msgid ""
-"    external log device not specified\n"
-"\n"
+"data stripe width (%d) must be a multiple of the data stripe unit (%d)\n"
 msgstr ""
 
-#: .././logprint/logprint.c:121
+#: .././mkfs/xfs_mkfs.c:796 .././mkfs/xfs_mkfs.c:802
 #, c-format
-msgid "Can't open file %s: %s\n"
+msgid "log stripe unit (%d) must be a multiple of the block size (%d)\n"
 msgstr ""
 
-#: .././logprint/logprint.c:222
+#: .././mkfs/xfs_mkfs.c:822
 #, c-format
-msgid "xfs_logprint:\n"
+msgid "if -%s file then -%s name and -%s size are required\n"
 msgstr ""
 
-#: .././logprint/logprint.c:231
+#: .././mkfs/xfs_mkfs.c:828
 #, c-format
-msgid "    data device: 0x%llx\n"
+msgid "No device name specified\n"
 msgstr ""
 
-#: .././logprint/logprint.c:234
+#: .././mkfs/xfs_mkfs.c:840
 #, c-format
-msgid "    log file: \"%s\" "
+msgid "Error accessing specified device %s: %s\n"
 msgstr ""
 
-#: .././logprint/logprint.c:236
+#: .././mkfs/xfs_mkfs.c:848
 #, c-format
-msgid "    log device: 0x%llx "
+msgid "%s: Use the -f option to force overwrite.\n"
 msgstr ""
 
-#: .././logprint/logprint.c:239
+#: .././mkfs/xfs_mkfs.c:869
 #, c-format
-msgid ""
-"daddr: %lld length: %lld\n"
-"\n"
+msgid "specified \"-%s file\" on a block device %s\n"
 msgstr ""
 
-#: .././logprint/log_print_all.c:96
+#: .././mkfs/xfs_mkfs.c:877
 #, c-format
-msgid ""
-"BUF:  #regs:%d   start blkno:0x%llx   len:%d   bmap size:%d   flags:0x%x\n"
+msgid "specified device %s not a file or block device\n"
 msgstr ""
 
-#: .././logprint/log_print_all.c:106
+#: .././mkfs/xfs_mkfs.c:908
 #, c-format
-msgid "\tSUPER Block Buffer:\n"
+msgid "log size %lld is not a multiple of the log stripe unit %d\n"
 msgstr ""
 
-#: .././logprint/log_print_all.c:109
+#: .././mkfs/xfs_mkfs.c:936
 #, c-format
-msgid "              icount:%llu ifree:%llu  "
+msgid "Due to stripe alignment, the internal log size (%lld) is too large.\n"
 msgstr ""
 
-#: .././logprint/log_print_all.c:114
+#: .././mkfs/xfs_mkfs.c:938
 #, c-format
-msgid "fdblks:%llu  frext:%llu\n"
+msgid "Must fit within an allocation group.\n"
 msgstr ""
 
-#: .././logprint/log_print_all.c:119
+#: .././mkfs/xfs_mkfs.c:949
 #, c-format
-msgid "\t\tsunit:%u  swidth:%u\n"
+msgid "log size %lld blocks too small, minimum size is %d blocks\n"
 msgstr ""
 
-#: .././logprint/log_print_all.c:125
+#: .././mkfs/xfs_mkfs.c:955
 #, c-format
-msgid "\tAGI Buffer: (XAGI)\n"
+msgid "log size %lld blocks too large, maximum size is %lld blocks\n"
 msgstr ""
 
-#: .././logprint/log_print_all.c:128
+#: .././mkfs/xfs_mkfs.c:961
 #, c-format
-msgid "\t\tver:%d  "
+msgid "log size %lld bytes too large, maximum size is %lld bytes\n"
 msgstr ""
 
-#: .././logprint/log_print_all.c:130
+#: .././mkfs/xfs_mkfs.c:998
 #, c-format
-msgid "seq#:%d  len:%d  cnt:%d  root:%d\n"
+msgid "agsize (%lld blocks) too small, need at least %lld blocks\n"
 msgstr ""
 
-#: .././logprint/log_print_all.c:135
+#: .././mkfs/xfs_mkfs.c:1006
 #, c-format
-msgid "\t\tlevel:%d  free#:0x%x  newino:0x%x\n"
+msgid "agsize (%lld blocks) too big, maximum is %lld blocks\n"
 msgstr ""
 
-#: .././logprint/log_print_all.c:159
+#: .././mkfs/xfs_mkfs.c:1014
 #, c-format
-msgid "\tAGF Buffer: (XAGF)\n"
+msgid "agsize (%lld blocks) too big, data area is %lld blocks\n"
 msgstr ""
 
-#: .././logprint/log_print_all.c:162
+#: .././mkfs/xfs_mkfs.c:1021
 #, c-format
-msgid "\t\tver:%d  seq#:%d  len:%d  \n"
+msgid "too many allocation groups for size = %lld\n"
 msgstr ""
 
-#: .././logprint/log_print_all.c:166
+#: .././mkfs/xfs_mkfs.c:1023
 #, c-format
-msgid "\t\troot BNO:%d  CNT:%d\n"
+msgid "need at most %lld allocation groups\n"
 msgstr ""
 
-#: .././logprint/log_print_all.c:169
+#: .././mkfs/xfs_mkfs.c:1031
 #, c-format
-msgid "\t\tlevel BNO:%d  CNT:%d\n"
+msgid "too few allocation groups for size = %lld\n"
 msgstr ""
 
-#: .././logprint/log_print_all.c:172
+#: .././mkfs/xfs_mkfs.c:1033
 #, c-format
-msgid "\t\t1st:%d  last:%d  cnt:%d  freeblks:%d  longest:%d\n"
+msgid "need at least %lld allocation groups\n"
 msgstr ""
 
-#: .././logprint/log_print_all.c:181
+#: .././mkfs/xfs_mkfs.c:1046
 #, c-format
-msgid "\tDQUOT Buffer:\n"
+msgid "last AG size %lld blocks too small, minimum size is %lld blocks\n"
 msgstr ""
 
-#: .././logprint/log_print_all.c:184
+#: .././mkfs/xfs_mkfs.c:1057
 #, c-format
-msgid "\t\tUIDs 0x%lx-0x%lx\n"
+msgid "%lld allocation groups is too many, maximum is %lld\n"
 msgstr ""
 
-#: .././logprint/log_print_all.c:189
+#: .././mkfs/xfs_mkfs.c:1087
 #, c-format
-msgid "\tBUF DATA\n"
+msgid "error reading existing superblock -- failed to memalign buffer\n"
 msgstr ""
 
-#: .././logprint/log_print_all.c:211
+#: .././mkfs/xfs_mkfs.c:1102
 #, c-format
-msgid "\tQUOTAOFF: #regs:%d   type:%s\n"
+msgid "error reading existing superblock: %s\n"
 msgstr ""
 
-#: .././logprint/log_print_all.c:226
+#: .././mkfs/xfs_mkfs.c:1272
 #, c-format
-msgid "\tDQUOT: #regs:%d  blkno:%lld  boffset:%u id: %d\n"
+msgid "Illegal value %s for -%c %s option. %s\n"
 msgstr ""
 
-#: .././logprint/log_print_all.c:230
+#: .././mkfs/xfs_mkfs.c:1292
 #, c-format
-msgid "\t\tmagic 0x%x\tversion 0x%x\tID 0x%x (%d)\t\n"
+msgid "Developer screwed up option parsing (%d/%d)! Please report!\n"
 msgstr ""
 
-#: .././logprint/log_print_all.c:235
+#: .././mkfs/xfs_mkfs.c:1347
 #, c-format
-msgid "\t\tblk_hard 0x%x\tblk_soft 0x%x\tino_hard 0x%x\tino_soft 0x%x\n"
+msgid ""
+"Option -%c %s has undefined minval/maxval.Can't verify value range. This is "
+"a bug.\n"
 msgstr ""
 
-#: .././logprint/log_print_all.c:241
-#, c-format
-msgid "\t\tbcount 0x%x (%d) icount 0x%x (%d)\n"
+#: .././mkfs/xfs_mkfs.c:1373
+msgid "value is too small"
 msgstr ""
 
-#: .././logprint/log_print_all.c:246
-#, c-format
-msgid "\t\tbtimer 0x%x itimer 0x%x \n"
+#: .././mkfs/xfs_mkfs.c:1375
+msgid "value is too large"
 msgstr ""
 
-#: .././logprint/log_print_all.c:255
+#: .././mkfs/xfs_mkfs.c:1377
+msgid "value must be a power of 2"
+msgstr ""
+
+#: .././mkfs/xfs_mkfs.c:1949
 #, c-format
-msgid "\tCORE inode:\n"
+msgid "extra arguments\n"
 msgstr ""
 
-#: .././logprint/log_print_all.c:258
+#: .././mkfs/xfs_mkfs.c:1966
 #, c-format
-msgid "\t\tmagic:%c%c  mode:0x%x  ver:%d  format:%d\n"
+msgid "illegal block size %d\n"
 msgstr ""
 
-#: .././logprint/log_print_all.c:261
+#: .././mkfs/xfs_mkfs.c:1971
 #, c-format
-msgid "\t\tuid:%d  gid:%d  nlink:%d projid:0x%04x%04x\n"
+msgid "Minimum block size for CRC enabled filesystems is %d bytes.\n"
 msgstr ""
 
-#: .././logprint/log_print_all.c:264
+#: .././mkfs/xfs_mkfs.c:1976
 #, c-format
-msgid "\t\tatime:%d  mtime:%d  ctime:%d\n"
+msgid "cannot disable ftype with crcs enabled\n"
 msgstr ""
 
-#: .././logprint/log_print_all.c:266
+#: .././mkfs/xfs_mkfs.c:2030
 #, c-format
-msgid "\t\tflushiter:%d\n"
+msgid "specified blocksize %d is less than device physical sector size %d\n"
 msgstr ""
 
-#: .././logprint/log_print_all.c:267
+#: .././mkfs/xfs_mkfs.c:2033
 #, c-format
-msgid "\t\tsize:0x%llx  nblks:0x%llx  exsize:%d  nextents:%d  anextents:%d\n"
+msgid "switching to logical sector size %d\n"
 msgstr ""
 
-#: .././logprint/log_print_all.c:271
+#: .././mkfs/xfs_mkfs.c:2051
 #, c-format
-msgid "\t\tforkoff:%d  dmevmask:0x%x  dmstate:%d  flags:0x%x  gen:%d\n"
+msgid "illegal sector size %d\n"
 msgstr ""
 
-#: .././logprint/log_print_all.c:295
+#: .././mkfs/xfs_mkfs.c:2054
 #, c-format
-msgid "\tINODE: #regs:%d   ino:0x%llx  flags:0x%x   dsize:%d\n"
+msgid "block size %d cannot be smaller than logical sector size %d\n"
 msgstr ""
 
-#: .././logprint/log_print_all.c:311
+#: .././mkfs/xfs_mkfs.c:2059
 #, c-format
-msgid "\t\tDATA FORK EXTENTS inode data:\n"
+msgid "illegal sector size %d; hw sector is %d\n"
 msgstr ""
 
-#: .././logprint/log_print_all.c:318
+#: .././mkfs/xfs_mkfs.c:2065
 #, c-format
-msgid "\t\tDATA FORK BTREE inode data:\n"
+msgid "illegal log sector size %d\n"
 msgstr ""
 
-#: .././logprint/log_print_all.c:325
+#: .././mkfs/xfs_mkfs.c:2081 .././mkfs/xfs_mkfs.c:2216
 #, c-format
-msgid "\t\tDATA FORK LOCAL inode data:\n"
+msgid "Minimum inode size for CRCs is %d bytes\n"
 msgstr ""
 
-#: .././logprint/log_print_all.c:332
+#: .././mkfs/xfs_mkfs.c:2089
 #, c-format
-msgid "\t\tDEV inode: no extra region\n"
+msgid "Inodes always aligned for CRC enabled filesytems\n"
 msgstr ""
 
-#: .././logprint/log_print_all.c:336
+#: .././mkfs/xfs_mkfs.c:2096
 #, c-format
-msgid "\t\tUUID inode: no extra region\n"
+msgid "Lazy superblock counted always enabled for CRC enabled filesytems\n"
 msgstr ""
 
-#: .././logprint/log_print_all.c:351
+#: .././mkfs/xfs_mkfs.c:2103
 #, c-format
-msgid "\t\tATTR FORK EXTENTS inode data:\n"
+msgid "V2 logs always enabled for CRC enabled filesytems\n"
 msgstr ""
 
-#: .././logprint/log_print_all.c:359
+#: .././mkfs/xfs_mkfs.c:2110
 #, c-format
-msgid "\t\tATTR FORK BTREE inode data:\n"
+msgid "V2 attribute format always enabled on CRC enabled filesytems\n"
 msgstr ""
 
-#: .././logprint/log_print_all.c:367
+#: .././mkfs/xfs_mkfs.c:2118
 #, c-format
-msgid "\t\tATTR FORK LOCAL inode data:\n"
+msgid "32 bit Project IDs always enabled on CRC enabled filesytems\n"
 msgstr ""
 
-#: .././logprint/log_print_all.c:388
+#: .././mkfs/xfs_mkfs.c:2133
 #, c-format
-msgid ""
-"\tICR:  #ag: %d  agbno: 0x%x  len: %d\n"
-"\t      cnt: %d  isize: %d    gen: 0x%x\n"
+msgid "finobt not supported without CRC support\n"
 msgstr ""
 
-#: .././logprint/log_print_all.c:440
+#: .././mkfs/xfs_mkfs.c:2140
 #, c-format
-msgid "xlog_recover_print_logitem: illegal type\n"
+msgid "sparse inodes not supported without CRC support\n"
 msgstr ""
 
-#: .././logprint/log_print_all.c:492
+#: .././mkfs/xfs_mkfs.c:2147
 #, c-format
-msgid "%s: illegal type"
+msgid "rmapbt not supported without CRC support\n"
 msgstr ""
 
-#: .././logprint/log_print_all.c:500
+#: .././mkfs/xfs_mkfs.c:2154
 #, c-format
-msgid ": cnt:%d total:%d "
+msgid "reflink not supported without CRC support\n"
 msgstr ""
 
-#: .././logprint/log_print_all.c:502
+#: .././mkfs/xfs_mkfs.c:2162
 #, c-format
-msgid "a:0x%lx len:%d "
+msgid "cowextsize not supported without reflink support\n"
 msgstr ""
 
-#: .././mkfs/proto.c:79
+#: .././mkfs/xfs_mkfs.c:2168
 #, c-format
-msgid "%s: failed to open %s: %s\n"
+msgid "rmapbt not supported with realtime devices\n"
 msgstr ""
 
-#: .././mkfs/proto.c:86 .././mkfs/proto.c:309
+#: .././mkfs/xfs_mkfs.c:2176
 #, c-format
-msgid "%s: read failed on %s: %s\n"
+msgid "illegal directory block size %d\n"
 msgstr ""
 
-#: .././mkfs/proto.c:91
+#: .././mkfs/xfs_mkfs.c:2195
 #, c-format
-msgid "%s: proto file %s premature EOF\n"
+msgid "illegal data length %lld, not a multiple of %d\n"
 msgstr ""
 
-#: .././mkfs/proto.c:125
-msgid "cannot reserve space"
+#: .././mkfs/xfs_mkfs.c:2201
+#, c-format
+msgid "warning: data length %lld not a multiple of %d, truncated to %lld\n"
 msgstr ""
 
-#: .././mkfs/proto.c:180
+#: .././mkfs/xfs_mkfs.c:2227
 #, c-format
-msgid "%s: premature EOF in prototype file\n"
+msgid "illegal log length %lld, not a multiple of %d\n"
 msgstr ""
 
-#: .././mkfs/proto.c:200
-msgid "error reserving space for a file"
+#: .././mkfs/xfs_mkfs.c:2234
+#, c-format
+msgid "warning: log length %lld not a multiple of %d, truncated to %lld\n"
 msgstr ""
 
-#: .././mkfs/proto.c:267
-msgid "error allocating space for a file"
+#: .././mkfs/xfs_mkfs.c:2244
+#, c-format
+msgid "illegal rt length %lld, not a multiple of %d\n"
 msgstr ""
 
-#: .././mkfs/proto.c:271
+#: .././mkfs/xfs_mkfs.c:2251
 #, c-format
-msgid "%s: cannot allocate space for file\n"
+msgid "warning: rt length %lld not a multiple of %d, truncated to %lld\n"
 msgstr ""
 
-#: .././mkfs/proto.c:336
-msgid "directory createname error"
+#: .././mkfs/xfs_mkfs.c:2264
+#, c-format
+msgid "illegal rt extent size %lld, not a multiple of %d\n"
 msgstr ""
 
-#: .././mkfs/proto.c:350
-msgid "directory create error"
+#: .././mkfs/xfs_mkfs.c:2307
+#, c-format
+msgid "illegal inode size %d\n"
 msgstr ""
 
-#: .././mkfs/proto.c:415 .././mkfs/proto.c:427 .././mkfs/proto.c:438
-#: .././mkfs/proto.c:445
+#: .././mkfs/xfs_mkfs.c:2312
 #, c-format
-msgid "%s: bad format string %s\n"
+msgid "allowable inode size with %d byte blocks is %d\n"
 msgstr ""
 
-#: .././mkfs/proto.c:466 .././mkfs/proto.c:513 .././mkfs/proto.c:528
-#: .././mkfs/proto.c:540 .././mkfs/proto.c:552 .././mkfs/proto.c:563
-msgid "Inode allocation failed"
+#: .././mkfs/xfs_mkfs.c:2316
+#, c-format
+msgid "allowable inode size with %d byte blocks is between %d and %d\n"
 msgstr ""
 
-#: .././mkfs/proto.c:481
+#: .././mkfs/xfs_mkfs.c:2324
 #, c-format
-msgid "%s: Bad value %s for proto file %s\n"
+msgid "log stripe unit specified, using v2 logs\n"
 msgstr ""
 
-#: .././mkfs/proto.c:490
-msgid "Inode pre-allocation failed"
+#: .././mkfs/xfs_mkfs.c:2343
+#, c-format
+msgid "no device name given in argument list\n"
 msgstr ""
 
-#: .././mkfs/proto.c:500
-msgid "Pre-allocated file creation failed"
+#: .././mkfs/xfs_mkfs.c:2379
+msgid "internal log"
 msgstr ""
 
-#: .././mkfs/proto.c:582
-msgid "Directory creation failed"
+#: .././mkfs/xfs_mkfs.c:2381
+msgid "volume log"
 msgstr ""
 
-#: .././mkfs/proto.c:603
-msgid "Unknown format"
+#: .././mkfs/xfs_mkfs.c:2383
+#, c-format
+msgid "no log subvolume or internal log\n"
 msgstr ""
 
-#: .././mkfs/proto.c:608
-msgid "Error encountered creating file from prototype file"
+#: .././mkfs/xfs_mkfs.c:2390
+msgid "volume rt"
 msgstr ""
 
-#: .././mkfs/proto.c:660
-msgid "Realtime bitmap inode allocation failed"
+#: .././mkfs/xfs_mkfs.c:2395
+#, c-format
+msgid ""
+"size %s specified for data subvolume is too large, maximum is %lld blocks\n"
 msgstr ""
 
-#: .././mkfs/proto.c:677
-msgid "Realtime summary inode allocation failed"
+#: .././mkfs/xfs_mkfs.c:2402
+#, c-format
+msgid "can't get size of data subvolume\n"
 msgstr ""
 
-#: .././mkfs/proto.c:704
-msgid "Allocation of the realtime bitmap failed"
+#: .././mkfs/xfs_mkfs.c:2407
+#, c-format
+msgid "size %lld of data subvolume is too small, minimum %d blocks\n"
 msgstr ""
 
-#: .././mkfs/proto.c:717
-msgid "Completion of the realtime bitmap failed"
+#: .././mkfs/xfs_mkfs.c:2414
+#, c-format
+msgid "can't have both external and internal logs\n"
 msgstr ""
 
-#: .././mkfs/proto.c:740
-msgid "Allocation of the realtime summary failed"
+#: .././mkfs/xfs_mkfs.c:2418
+#, c-format
+msgid "data and log sector sizes must be equal for internal logs\n"
 msgstr ""
 
-#: .././mkfs/proto.c:752
-msgid "Completion of the realtime summary failed"
+#: .././mkfs/xfs_mkfs.c:2424
+#, c-format
+msgid ""
+"Warning: the data subvolume sector size %u is less than the sector size \n"
+"reported by the device (%u).\n"
 msgstr ""
 
-#: .././mkfs/proto.c:770
-msgid "Error initializing the realtime space"
+#: .././mkfs/xfs_mkfs.c:2430
+#, c-format
+msgid ""
+"Warning: the log subvolume sector size %u is less than the sector size\n"
+"reported by the device (%u).\n"
 msgstr ""
 
-#: .././mkfs/proto.c:775
-msgid "Error completing the realtime space"
+#: .././mkfs/xfs_mkfs.c:2436
+#, c-format
+msgid ""
+"Warning: the realtime subvolume sector size %u is less than the sector size\n"
+"reported by the device (%u).\n"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:752
+#: .././mkfs/xfs_mkfs.c:2443
 #, c-format
-msgid "both data sunit and data swidth options must be specified\n"
+msgid ""
+"size %s specified for rt subvolume is too large, maximum is %lld blocks\n"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:760
+#: .././mkfs/xfs_mkfs.c:2451
 #, c-format
-msgid "both data su and data sw options must be specified\n"
+msgid "size specified for non-existent rt subvolume\n"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:767
+#: .././mkfs/xfs_mkfs.c:2466
 #, c-format
-msgid "data su must be a multiple of the sector size (%d)\n"
+msgid ""
+"%s: Specified data stripe unit %d is not the same as the volume stripe unit "
+"%d\n"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:778
+#: .././mkfs/xfs_mkfs.c:2473
 #, c-format
 msgid ""
-"data stripe width (%d) must be a multiple of the data stripe unit (%d)\n"
+"%s: Specified data stripe width %d is not the same as the volume stripe "
+"width %d\n"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:791 .././mkfs/xfs_mkfs.c:797
+#: .././mkfs/xfs_mkfs.c:2491
 #, c-format
-msgid "log stripe unit (%d) must be a multiple of the block size (%d)\n"
+msgid "agsize (%lld) not a multiple of fs blk size (%d)\n"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:817
+#: .././mkfs/xfs_mkfs.c:2541
 #, c-format
-msgid "if -%s file then -%s name and -%s size are required\n"
+msgid "agsize rounded to %lld, swidth = %d\n"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:823
+#: .././mkfs/xfs_mkfs.c:2575
 #, c-format
-msgid "No device name specified\n"
+msgid ""
+"Warning: AG size is a multiple of stripe width.  This can cause performance\n"
+"problems by aligning all AGs on the same disk.  To avoid this, run mkfs "
+"with\n"
+"an AG size that is one stripe unit smaller, for example %llu.\n"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:835
+#: .././mkfs/xfs_mkfs.c:2600
 #, c-format
-msgid "Error accessing specified device %s: %s\n"
+msgid ""
+"%s: Stripe unit(%d) or stripe width(%d) is not a multiple of the block "
+"size(%d)\n"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:843
+#: .././mkfs/xfs_mkfs.c:2641
 #, c-format
-msgid "%s: Use the -f option to force overwrite.\n"
+msgid "log stripe unit (%d bytes) is too large (maximum is 256KiB)\n"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:864
+#: .././mkfs/xfs_mkfs.c:2644
 #, c-format
-msgid "specified \"-%s file\" on a block device %s\n"
+msgid "log stripe unit adjusted to 32KiB\n"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:872
+#: .././mkfs/xfs_mkfs.c:2661
 #, c-format
-msgid "specified device %s not a file or block device\n"
+msgid ""
+"size %s specified for log subvolume is too large, maximum is %lld blocks\n"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:903
+#: .././mkfs/xfs_mkfs.c:2668
 #, c-format
-msgid "log size %lld is not a multiple of the log stripe unit %d\n"
+msgid "size specified for non-existent log subvolume\n"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:931
+#: .././mkfs/xfs_mkfs.c:2671
 #, c-format
-msgid "Due to stripe alignment, the internal log size (%lld) is too large.\n"
+msgid "size %lld too large for internal log\n"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:933
+#: .././mkfs/xfs_mkfs.c:2749
 #, c-format
-msgid "Must fit within an allocation group.\n"
+msgid "internal log size %lld too large, must fit in allocation group\n"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:944
+#: .././mkfs/xfs_mkfs.c:2757
 #, c-format
-msgid "log size %lld blocks too small, minimum size is %d blocks\n"
+msgid "log ag number %d too large, must be less than %lld\n"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:950
+#: .././mkfs/xfs_mkfs.c:2787
 #, c-format
-msgid "log size %lld blocks too large, maximum size is %lld blocks\n"
+msgid ""
+"meta-data=%-22s isize=%-6d agcount=%lld, agsize=%lld blks\n"
+"         =%-22s sectsz=%-5u attr=%u, projid32bit=%u\n"
+"         =%-22s crc=%-8u finobt=%u, sparse=%u, rmapbt=%u, reflink=%u\n"
+"data     =%-22s bsize=%-6u blocks=%llu, imaxpct=%u\n"
+"         =%-22s sunit=%-6u swidth=%u blks\n"
+"naming   =version %-14u bsize=%-6u ascii-ci=%d ftype=%d\n"
+"log      =%-22s bsize=%-6d blocks=%lld, version=%d\n"
+"         =%-22s sectsz=%-5u sunit=%d blks, lazy-count=%d\n"
+"realtime =%-22s extsz=%-6d blocks=%lld, rtextents=%lld\n"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:956
+#: .././mkfs/xfs_mkfs.c:2905
 #, c-format
-msgid "log size %lld bytes too large, maximum size is %lld bytes\n"
+msgid "%s: Growing the data section failed\n"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:993
+#: .././mkfs/xfs_mkfs.c:2935
 #, c-format
-msgid "agsize (%lld blocks) too small, need at least %lld blocks\n"
+msgid "%s: filesystem failed to initialize\n"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:1001
+#: .././mkfs/xfs_mkfs.c:3327
 #, c-format
-msgid "agsize (%lld blocks) too big, maximum is %lld blocks\n"
+msgid "%s: root inode created in AG %u, not AG 0\n"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:1009
+#: .././mkfs/xfs_mkfs.c:3393
 #, c-format
-msgid "agsize (%lld blocks) too big, data area is %lld blocks\n"
+msgid "Cannot specify both -%c %s and -%c %s\n"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:1016
+#: .././mkfs/xfs_mkfs.c:3404
 #, c-format
-msgid "too many allocation groups for size = %lld\n"
+msgid "Illegal value %s for -%s option\n"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:1018
+#: .././mkfs/xfs_mkfs.c:3421
 #, c-format
-msgid "need at most %lld allocation groups\n"
+msgid "-%c %s option requires a value\n"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:1026
+#: .././mkfs/xfs_mkfs.c:3434 .././repair/xfs_repair.c:170
 #, c-format
-msgid "too few allocation groups for size = %lld\n"
+msgid "option respecified\n"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:1028
+#: .././mkfs/xfs_mkfs.c:3443 .././repair/xfs_repair.c:177
 #, c-format
-msgid "need at least %lld allocation groups\n"
+msgid "unknown option -%c %s\n"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:1041
+#: .././mkfs/xfs_mkfs.c:3469
 #, c-format
-msgid "last AG size %lld blocks too small, minimum size is %lld blocks\n"
+msgid "Blocksize must be provided prior to using 'b' suffix.\n"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:1052
+#: .././mkfs/xfs_mkfs.c:3478
 #, c-format
-msgid "%lld allocation groups is too many, maximum is %lld\n"
+msgid "Sectorsize must be specified prior to using 's' suffix.\n"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:1082
+#: .././mkfs/xfs_mkfs.c:3513
 #, c-format
-msgid "error reading existing superblock -- failed to memalign buffer\n"
+msgid ""
+"Usage: %s\n"
+"/* blocksize */\t\t[-b log=n|size=num]\n"
+"/* metadata */\t\t[-m crc=0|1,finobt=0|1,uuid=xxx,rmapbt=0|1,reflink=0|1]\n"
+"/* data subvol */\t[-d agcount=n,agsize=n,file,name=xxx,size=num,\n"
+"\t\t\t    (sunit=value,swidth=value|su=num,sw=num|noalign),\n"
+"\t\t\t    sectlog=n|sectsize=num\n"
+"/* force overwrite */\t[-f]\n"
+"/* inode size */\t[-i log=n|perblock=n|size=num,maxpct=n,attr=0|1|2,\n"
+"\t\t\t    projid32bit=0|1,sparse=0|1]\n"
+"/* no discard */\t[-K]\n"
+"/* log subvol */\t[-l agnum=n,internal,size=num,logdev=xxx,version=n\n"
+"\t\t\t    sunit=value|su=num,sectlog=n|sectsize=num,\n"
+"\t\t\t    lazy-count=0|1]\n"
+"/* label */\t\t[-L label (maximum 12 characters)]\n"
+"/* naming */\t\t[-n log=n|size=num,version=2|ci,ftype=0|1]\n"
+"/* no-op info only */\t[-N]\n"
+"/* prototype file */\t[-p fname]\n"
+"/* quiet */\t\t[-q]\n"
+"/* realtime subvol */\t[-r extsize=num,size=num,rtdev=xxx]\n"
+"/* sectorsize */\t[-s log=n|size=num]\n"
+"/* version */\t\t[-V]\n"
+"\t\t\tdevicename\n"
+"<devicename> is required unless -d name=xxx is given.\n"
+"<num> is xxx (bytes), xxxs (sectors), xxxb (fs blocks), xxxk (xxx KiB),\n"
+"      xxxm (xxx MiB), xxxg (xxx GiB), xxxt (xxx TiB) or xxxp (xxx PiB).\n"
+"<value> is xxx (512 byte blocks).\n"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:1097
+#: .././mkfs/proto.c:79
 #, c-format
-msgid "error reading existing superblock: %s\n"
+msgid "%s: failed to open %s: %s\n"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:1267
+#: .././mkfs/proto.c:86 .././mkfs/proto.c:309
 #, c-format
-msgid "Illegal value %s for -%c %s option. %s\n"
+msgid "%s: read failed on %s: %s\n"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:1342
+#: .././mkfs/proto.c:91
 #, c-format
-msgid ""
-"Option -%c %s has undefined minval/maxval.Can't verify value range. This is "
-"a bug.\n"
+msgid "%s: proto file %s premature EOF\n"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:1368
-msgid "value is too small"
+#: .././mkfs/proto.c:125
+msgid "cannot reserve space"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:1370
-msgid "value is too large"
+#: .././mkfs/proto.c:180
+#, c-format
+msgid "%s: premature EOF in prototype file\n"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:1372
-msgid "value must be a power of 2"
+#: .././mkfs/proto.c:200
+msgid "error reserving space for a file"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:1932
-#, c-format
-msgid "extra arguments\n"
+#: .././mkfs/proto.c:267
+msgid "error allocating space for a file"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:1949
+#: .././mkfs/proto.c:271
 #, c-format
-msgid "illegal block size %d\n"
+msgid "%s: cannot allocate space for file\n"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:1954
-#, c-format
-msgid "Minimum block size for CRC enabled filesystems is %d bytes.\n"
+#: .././mkfs/proto.c:336
+msgid "directory createname error"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:1959
-#, c-format
-msgid "cannot disable ftype with crcs enabled\n"
+#: .././mkfs/proto.c:350
+msgid "directory create error"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:2013
+#: .././mkfs/proto.c:415 .././mkfs/proto.c:427 .././mkfs/proto.c:438
+#: .././mkfs/proto.c:445
 #, c-format
-msgid "specified blocksize %d is less than device physical sector size %d\n"
+msgid "%s: bad format string %s\n"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:2016
-#, c-format
-msgid "switching to logical sector size %d\n"
+#: .././mkfs/proto.c:466 .././mkfs/proto.c:514 .././mkfs/proto.c:529
+#: .././mkfs/proto.c:541 .././mkfs/proto.c:553 .././mkfs/proto.c:564
+msgid "Inode allocation failed"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:2034
+#: .././mkfs/proto.c:481
 #, c-format
-msgid "illegal sector size %d\n"
+msgid "%s: Bad value %s for proto file %s\n"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:2037
-#, c-format
-msgid "block size %d cannot be smaller than logical sector size %d\n"
+#: .././mkfs/proto.c:490
+msgid "Inode pre-allocation failed"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:2042
-#, c-format
-msgid "illegal sector size %d; hw sector is %d\n"
+#: .././mkfs/proto.c:501
+msgid "Pre-allocated file creation failed"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:2048
-#, c-format
-msgid "illegal log sector size %d\n"
+#: .././mkfs/proto.c:584
+msgid "Directory creation failed"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:2064 .././mkfs/xfs_mkfs.c:2194
-#, c-format
-msgid "Minimum inode size for CRCs is %d bytes\n"
+#: .././mkfs/proto.c:605
+msgid "Unknown format"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:2072
-#, c-format
-msgid "Inodes always aligned for CRC enabled filesytems\n"
+#: .././mkfs/proto.c:611
+msgid "Error encountered creating file from prototype file"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:2079
-#, c-format
-msgid "Lazy superblock counted always enabled for CRC enabled filesytems\n"
+#: .././mkfs/proto.c:663
+msgid "Realtime bitmap inode allocation failed"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:2086
-#, c-format
-msgid "V2 logs always enabled for CRC enabled filesytems\n"
+#: .././mkfs/proto.c:680
+msgid "Realtime summary inode allocation failed"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:2093
-#, c-format
-msgid "V2 attribute format always enabled on CRC enabled filesytems\n"
+#: .././mkfs/proto.c:707
+msgid "Allocation of the realtime bitmap failed"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:2101
-#, c-format
-msgid "32 bit Project IDs always enabled on CRC enabled filesytems\n"
+#: .././mkfs/proto.c:721
+msgid "Completion of the realtime bitmap failed"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:2116
-#, c-format
-msgid "finobt not supported without CRC support\n"
+#: .././mkfs/proto.c:744
+msgid "Allocation of the realtime summary failed"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:2123
-#, c-format
-msgid "sparse inodes not supported without CRC support\n"
+#: .././mkfs/proto.c:757
+msgid "Completion of the realtime summary failed"
+msgstr ""
+
+#: .././mkfs/proto.c:775
+msgid "Error initializing the realtime space"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:2130
+#: .././mkfs/proto.c:781
+msgid "Error completing the realtime space"
+msgstr ""
+
+#: .././quota/project.c:45
 #, c-format
-msgid "rmapbt not supported without CRC support\n"
+msgid ""
+"\n"
+" list projects or setup a project tree for tree quota management\n"
+"\n"
+" Example:\n"
+" 'project -c logfiles'\n"
+" (match project 'logfiles' to a directory, and setup the directory tree)\n"
+"\n"
+" Without arguments, report all projects found in the /etc/projects file.\n"
+" The project quota mechanism in XFS can be used to implement a form of\n"
+" directory tree quota, where a specified directory and all of the files\n"
+" and subdirectories below it (i.e. a tree) can be restricted to using a\n"
+" subset of the available space in the filesystem.\n"
+"\n"
+" A managed tree must be setup initially using the -c option with a project.\n"
+" The specified project name or identifier is matched to one or more trees\n"
+" defined in /etc/projects, and these trees are then recursively descended\n"
+" to mark the affected inodes as being part of that tree - which sets inode\n"
+" flags and the project identifier on every file.\n"
+" Once this has been done, new files created in the tree will automatically\n"
+" be accounted to the tree based on their project identifier.  An attempt to\n"
+" create a hard link to a file in the tree will only succeed if the project\n"
+" identifier matches the project identifier for the tree.  The xfs_io "
+"utility\n"
+" can be used to set the project ID for an arbitrary file, but this can only\n"
+" be done by a privileged user.\n"
+"\n"
+" A previously setup tree can be cleared from project quota control through\n"
+" use of the -C option, which will recursively descend the tree, clearing\n"
+" the affected inodes from project quota control.\n"
+"\n"
+" The -c option can be used to check whether a tree is setup, it reports\n"
+" nothing if the tree is correct, otherwise it reports the paths of inodes\n"
+" which do not have the project ID of the rest of the tree, or if the inode\n"
+" flag is not set.\n"
+"\n"
+" The -p <path> option can be used to manually specify project path without\n"
+" need to create /etc/projects file. This option can be used multiple times\n"
+" to specify multiple paths. When using this option only one projid/name can\n"
+" be specified at command line. Note that /etc/projects is also used if "
+"exists.\n"
+"\n"
+" The -d <depth> option allows to descend at most <depth> levels of "
+"directories\n"
+" below the command line arguments. -d 0 means only apply the actions\n"
+" to the top level of the projects. -d -1 means no recursion limit "
+"(default).\n"
+"\n"
+" The /etc/projid and /etc/projects file formats are simple, and described\n"
+" on the xfs_quota man page.\n"
+"\n"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:2137
+#: .././quota/project.c:108 .././quota/project.c:153 .././quota/project.c:200
 #, c-format
-msgid "reflink not supported without CRC support\n"
+msgid "%s: cannot stat file %s\n"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:2146
+#: .././quota/project.c:112 .././quota/project.c:157 .././quota/project.c:204
 #, c-format
-msgid "rmapbt not supported with realtime devices\n"
+msgid "%s: skipping special file %s\n"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:2154
+#: .././quota/project.c:126
 #, c-format
-msgid "illegal directory block size %d\n"
+msgid "%s - project identifier is not set (inode=%u, tree=%u)\n"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:2173
+#: .././quota/project.c:130
 #, c-format
-msgid "illegal data length %lld, not a multiple of %d\n"
+msgid "%s - project inheritance flag is not set\n"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:2179
+#: .././quota/project.c:178
 #, c-format
-msgid "warning: data length %lld not a multiple of %d, truncated to %lld\n"
+msgid "%s: cannot clear project on %s: %s\n"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:2205
+#: .././quota/project.c:225
 #, c-format
-msgid "illegal log length %lld, not a multiple of %d\n"
+msgid "%s: cannot set project on %s: %s\n"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:2212
+#: .././quota/project.c:240
 #, c-format
-msgid "warning: log length %lld not a multiple of %d, truncated to %lld\n"
+msgid "Checking project %s (path %s)...\n"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:2222
+#: .././quota/project.c:244
 #, c-format
-msgid "illegal rt length %lld, not a multiple of %d\n"
+msgid "Setting up project %s (path %s)...\n"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:2229
+#: .././quota/project.c:248
 #, c-format
-msgid "warning: rt length %lld not a multiple of %d, truncated to %lld\n"
+msgid "Clearing project %s (path %s)...\n"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:2242
+#: .././quota/project.c:271
 #, c-format
-msgid "illegal rt extent size %lld, not a multiple of %d\n"
+msgid ""
+"Processed %d (%s and cmdline) paths for project %s with recursion depth %s "
+"(%d).\n"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:2285
-#, c-format
-msgid "illegal inode size %d\n"
+#: .././quota/project.c:274
+msgid "infinite"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:2290
-#, c-format
-msgid "allowable inode size with %d byte blocks is %d\n"
+#: .././quota/project.c:274
+msgid "limited"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:2294
+#: .././quota/project.c:319
 #, c-format
-msgid "allowable inode size with %d byte blocks is between %d and %d\n"
+msgid "projects file \"%s\" doesn't exist\n"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:2302
+#: .././quota/project.c:326
 #, c-format
-msgid "log stripe unit specified, using v2 logs\n"
+msgid ""
+"%s: only one projid/name can be specified when using -p <path>, %d found.\n"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:2317
+#: .././quota/project.c:336
 #, c-format
-msgid "no device name given in argument list\n"
+msgid "%s - no such project in %s or invalid project number\n"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:2353
-msgid "internal log"
+#: .././quota/project.c:353
+msgid "[-c|-s|-C|-d <depth>|-p <path>] project ..."
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:2355
-msgid "volume log"
+#: .././quota/project.c:356
+msgid "check, setup or clear project quota trees"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:2357
+#: .././quota/quota.c:33
 #, c-format
-msgid "no log subvolume or internal log\n"
-msgstr ""
-
-#: .././mkfs/xfs_mkfs.c:2364
-msgid "volume rt"
+msgid ""
+"\n"
+" display usage and quota information\n"
+"\n"
+" -g -- display group quota information\n"
+" -p -- display project quota information\n"
+" -u -- display user quota information\n"
+" -b -- display number of blocks used\n"
+" -i -- display number of inodes used\n"
+" -r -- display number of realtime blocks used\n"
+" -h -- report in a human-readable format\n"
+" -n -- skip identifier-to-name translations, just report IDs\n"
+" -N -- suppress the initial header\n"
+" -v -- increase verbosity in reporting (also dumps zero values)\n"
+" -f -- send output to a file\n"
+" The (optional) user/group/project can be specified either by name or by\n"
+" number (i.e. uid/gid/projid).\n"
+"\n"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:2369
+#: .././quota/quota.c:86
 #, c-format
 msgid ""
-"size %s specified for data subvolume is too large, maximum is %lld blocks\n"
+"Disk quotas for %s %s (%u)\n"
+"Filesystem%s"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:2376
+#: .././quota/quota.c:91
 #, c-format
-msgid "can't get size of data subvolume\n"
+msgid " Blocks  Quota  Limit Warn/Time    "
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:2381
+#: .././quota/quota.c:92
 #, c-format
-msgid "size %lld of data subvolume is too small, minimum %d blocks\n"
+msgid "     Blocks      Quota      Limit  Warn/Time      "
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:2388
+#: .././quota/quota.c:95
 #, c-format
-msgid "can't have both external and internal logs\n"
+msgid "  Files  Quota  Limit Warn/Time    "
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:2392
+#: .././quota/quota.c:96
 #, c-format
-msgid "data and log sector sizes must be equal for internal logs\n"
+msgid "      Files      Quota      Limit  Warn/Time      "
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:2398
+#: .././quota/quota.c:99
 #, c-format
-msgid ""
-"Warning: the data subvolume sector size %u is less than the sector size \n"
-"reported by the device (%u).\n"
+msgid "Realtime Quota  Limit Warn/Time    "
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:2404
+#: .././quota/quota.c:100
 #, c-format
-msgid ""
-"Warning: the log subvolume sector size %u is less than the sector size\n"
-"reported by the device (%u).\n"
+msgid "   Realtime      Quota      Limit  Warn/Time      "
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:2410
+#: .././quota/quota.c:236
 #, c-format
-msgid ""
-"Warning: the realtime subvolume sector size %u is less than the sector size\n"
-"reported by the device (%u).\n"
+msgid "%s: cannot find user %s\n"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:2417
+#: .././quota/quota.c:286
 #, c-format
-msgid ""
-"size %s specified for rt subvolume is too large, maximum is %lld blocks\n"
+msgid "%s: cannot find group %s\n"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:2425
+#: .././quota/quota.c:347
 #, c-format
-msgid "size specified for non-existent rt subvolume\n"
+msgid "%s: must specify a project name/ID\n"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:2440
+#: .././quota/quota.c:360
 #, c-format
-msgid ""
-"%s: Specified data stripe unit %d is not the same as the volume stripe unit %"
-"d\n"
+msgid "%s: cannot find project %s\n"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:2447
-#, c-format
-msgid ""
-"%s: Specified data stripe width %d is not the same as the volume stripe "
-"width %d\n"
+#: .././quota/quota.c:470
+msgid "[-bir] [-g|-p|-u] [-hnNv] [-f file] [id|name]..."
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:2465
-#, c-format
-msgid "agsize (%lld) not a multiple of fs blk size (%d)\n"
+#: .././quota/quota.c:471
+msgid "show usage and limits"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:2515
-#, c-format
-msgid "agsize rounded to %lld, swidth = %d\n"
+#: .././quota/report.c:33 .././quota/report.c:768 .././quota/edit.c:718
+msgid "[-g|-p|-u] [-f file]"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:2547
-#, c-format
-msgid ""
-"Warning: AG size is a multiple of stripe width.  This can cause performance\n"
-"problems by aligning all AGs on the same disk.  To avoid this, run mkfs "
-"with\n"
-"an AG size that is one stripe unit smaller, for example %llu.\n"
+#: .././quota/report.c:34 .././quota/report.c:769
+msgid "dump quota information for backup utilities"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:2572
+#: .././quota/report.c:36
 #, c-format
 msgid ""
-"%s: Stripe unit(%d) or stripe width(%d) is not a multiple of the block size(%"
-"d)\n"
+"\n"
+" create a backup file which contains quota limits information\n"
+" -g -- dump out group quota limits\n"
+" -p -- dump out project quota limits\n"
+" -u -- dump out user quota limits (default)\n"
+" -f -- write the dump out to the specified file\n"
+"\n"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:2613
-#, c-format
-msgid "log stripe unit (%d bytes) is too large (maximum is 256KiB)\n"
+#: .././quota/report.c:48
+msgid "[-bir] [-gpu] [-ahntlLNU] [-f file]"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:2616
-#, c-format
-msgid "log stripe unit adjusted to 32KiB\n"
+#: .././quota/report.c:49 .././quota/report.c:779
+msgid "report filesystem quota information"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:2632
+#: .././quota/report.c:51
 #, c-format
 msgid ""
-"size %s specified for log subvolume is too large, maximum is %lld blocks\n"
+"\n"
+" report used space and inodes, and quota limits, for a filesystem\n"
+" Example:\n"
+" 'report -igh'\n"
+" (reports inode usage for all groups, in an easy-to-read format)\n"
+" This command is the equivalent of the traditional repquota command, which\n"
+" prints a summary of the disk usage and quotas for the current filesystem,\n"
+" or all filesystems.\n"
+" -a -- report for all mounted filesystems with quota enabled\n"
+" -h -- report in a human-readable format\n"
+" -n -- skip identifier-to-name translations, just report IDs\n"
+" -N -- suppress the header from the output\n"
+" -t -- terse output format, hides rows which are all zero\n"
+" -L -- lower ID bound to report on\n"
+" -U -- upper ID bound to report on\n"
+" -l -- look up names for IDs in lower-upper range\n"
+" -g -- report group usage and quota information\n"
+" -p -- report project usage and quota information\n"
+" -u -- report user usage and quota information\n"
+" -b -- report blocks-used information only\n"
+" -i -- report inodes-used information only\n"
+" -r -- report realtime-blocks-used information only\n"
+"\n"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:2639
+#: .././quota/report.c:273
 #, c-format
-msgid "size specified for non-existent log subvolume\n"
+msgid "%s quota on %s (%s)\n"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:2642
+#: .././quota/report.c:298 .././quota/report.c:306
 #, c-format
-msgid "size %lld too large for internal log\n"
+msgid "  Used   Soft   Hard Warn/Grace   "
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:2720
+#: .././quota/report.c:299 .././quota/report.c:307
 #, c-format
-msgid "internal log size %lld too large, must fit in allocation group\n"
+msgid "      Used       Soft       Hard    Warn/Grace     "
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:2728
+#: .././quota/report.c:302
 #, c-format
-msgid "log ag number %d too large, must be less than %lld\n"
+msgid "  Used   Soft   Hard Warn/Grace  "
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:2758
+#: .././quota/report.c:303
 #, c-format
-msgid ""
-"meta-data=%-22s isize=%-6d agcount=%lld, agsize=%lld blks\n"
-"         =%-22s sectsz=%-5u attr=%u, projid32bit=%u\n"
-"         =%-22s crc=%-8u finobt=%u, sparse=%u, rmapbt=%u, reflink=%u\n"
-"data     =%-22s bsize=%-6u blocks=%llu, imaxpct=%u\n"
-"         =%-22s sunit=%-6u swidth=%u blks\n"
-"naming   =version %-14u bsize=%-6u ascii-ci=%d ftype=%d\n"
-"log      =%-22s bsize=%-6d blocks=%lld, version=%d\n"
-"         =%-22s sectsz=%-5u sunit=%d blks, lazy-count=%d\n"
-"realtime =%-22s extsz=%-6d blocks=%lld, rtextents=%lld\n"
+msgid "      Used       Soft       Hard    Warn/ Grace     "
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:2876
-#, c-format
-msgid "%s: Growing the data section failed\n"
+#: .././quota/report.c:778
+msgid "[-bir] [-gpu] [-ahnt] [-f file]"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:2906
+#: .././quota/util.c:70
 #, c-format
-msgid "%s: filesystem failed to initialize\n"
+msgid "[-none-]"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:3319
+#: .././quota/util.c:70
 #, c-format
-msgid "%s: root inode created in AG %u, not AG 0\n"
+msgid "[--none--]"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:3385
+#: .././quota/util.c:73
 #, c-format
-msgid "Cannot specify both -%c %s and -%c %s\n"
+msgid "[------]"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:3396
+#: .././quota/util.c:73
 #, c-format
-msgid "Illegal value %s for -%s option\n"
+msgid "[--------]"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:3413
-#, c-format
-msgid "-%c %s option requires a value\n"
+#: .././quota/util.c:77 .././quota/util.c:80
+msgid "day"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:3426 .././repair/xfs_repair.c:168
-#, c-format
-msgid "option respecified\n"
+#: .././quota/util.c:77 .././quota/util.c:80
+msgid "days"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:3435 .././repair/xfs_repair.c:175
-#, c-format
-msgid "unknown option -%c %s\n"
+#: .././quota/util.c:205
+msgid "Blocks"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:3461
-#, c-format
-msgid "Blocksize must be provided prior to using 'b' suffix.\n"
+#: .././quota/util.c:205
+msgid "Inodes"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:3470
-#, c-format
-msgid "Sectorsize must be specified prior to using 's' suffix.\n"
+#: .././quota/util.c:205
+msgid "Realtime Blocks"
 msgstr ""
 
-#: .././mkfs/xfs_mkfs.c:3505
-#, c-format
-msgid ""
-"Usage: %s\n"
-"/* blocksize */\t\t[-b log=n|size=num]\n"
-"/* metadata */\t\t[-m crc=0|1,finobt=0|1,uuid=xxx,rmapbt=0|1,reflink=0|1]\n"
-"/* data subvol */\t[-d agcount=n,agsize=n,file,name=xxx,size=num,\n"
-"\t\t\t    (sunit=value,swidth=value|su=num,sw=num|noalign),\n"
-"\t\t\t    sectlog=n|sectsize=num\n"
-"/* force overwrite */\t[-f]\n"
-"/* inode size */\t[-i log=n|perblock=n|size=num,maxpct=n,attr=0|1|2,\n"
-"\t\t\t    projid32bit=0|1,sparse=0|1]\n"
-"/* no discard */\t[-K]\n"
-"/* log subvol */\t[-l agnum=n,internal,size=num,logdev=xxx,version=n\n"
-"\t\t\t    sunit=value|su=num,sectlog=n|sectsize=num,\n"
-"\t\t\t    lazy-count=0|1]\n"
-"/* label */\t\t[-L label (maximum 12 characters)]\n"
-"/* naming */\t\t[-n log=n|size=num,version=2|ci,ftype=0|1]\n"
-"/* no-op info only */\t[-N]\n"
-"/* prototype file */\t[-p fname]\n"
-"/* quiet */\t\t[-q]\n"
-"/* realtime subvol */\t[-r extsize=num,size=num,rtdev=xxx]\n"
-"/* sectorsize */\t[-s log=n|size=num]\n"
-"/* version */\t\t[-V]\n"
-"\t\t\tdevicename\n"
-"<devicename> is required unless -d name=xxx is given.\n"
-"<num> is xxx (bytes), xxxs (sectors), xxxb (fs blocks), xxxk (xxx KiB),\n"
-"      xxxm (xxx MiB), xxxg (xxx GiB), xxxt (xxx TiB) or xxxp (xxx PiB).\n"
-"<value> is xxx (512 byte blocks).\n"
+#: .././quota/util.c:220
+msgid "User"
+msgstr ""
+
+#: .././quota/util.c:220
+msgid "Group"
+msgstr ""
+
+#: .././quota/util.c:220
+msgid "Project"
+msgstr ""
+
+#: .././quota/util.c:428
+#, c-format
+msgid "%s: open on %s failed: %s\n"
+msgstr ""
+
+#: .././quota/util.c:434
+#, c-format
+msgid "%s: fdopen on %s failed: %s\n"
 msgstr ""
 
 #: .././quota/edit.c:36
@@ -7739,10 +8540,6 @@ msgstr ""
 msgid "modify quota limits"
 msgstr ""
 
-#: .././quota/edit.c:718 .././quota/report.c:33 .././quota/report.c:768
-msgid "[-g|-p|-u] [-f file]"
-msgstr ""
-
 #: .././quota/edit.c:719
 msgid "restore quota limits from a backup file"
 msgstr ""
@@ -7834,280 +8631,115 @@ msgstr ""
 msgid "show free and used counts for blocks and inodes"
 msgstr ""
 
-#: .././quota/project.c:45
-#, c-format
-msgid ""
-"\n"
-" list projects or setup a project tree for tree quota management\n"
-"\n"
-" Example:\n"
-" 'project -c logfiles'\n"
-" (match project 'logfiles' to a directory, and setup the directory tree)\n"
-"\n"
-" Without arguments, report all projects found in the /etc/projects file.\n"
-" The project quota mechanism in XFS can be used to implement a form of\n"
-" directory tree quota, where a specified directory and all of the files\n"
-" and subdirectories below it (i.e. a tree) can be restricted to using a\n"
-" subset of the available space in the filesystem.\n"
-"\n"
-" A managed tree must be setup initially using the -c option with a project.\n"
-" The specified project name or identifier is matched to one or more trees\n"
-" defined in /etc/projects, and these trees are then recursively descended\n"
-" to mark the affected inodes as being part of that tree - which sets inode\n"
-" flags and the project identifier on every file.\n"
-" Once this has been done, new files created in the tree will automatically\n"
-" be accounted to the tree based on their project identifier.  An attempt to\n"
-" create a hard link to a file in the tree will only succeed if the project\n"
-" identifier matches the project identifier for the tree.  The xfs_io "
-"utility\n"
-" can be used to set the project ID for an arbitrary file, but this can only\n"
-" be done by a privileged user.\n"
-"\n"
-" A previously setup tree can be cleared from project quota control through\n"
-" use of the -C option, which will recursively descend the tree, clearing\n"
-" the affected inodes from project quota control.\n"
-"\n"
-" The -c option can be used to check whether a tree is setup, it reports\n"
-" nothing if the tree is correct, otherwise it reports the paths of inodes\n"
-" which do not have the project ID of the rest of the tree, or if the inode\n"
-" flag is not set.\n"
-"\n"
-" The -p <path> option can be used to manually specify project path without\n"
-" need to create /etc/projects file. This option can be used multiple times\n"
-" to specify multiple paths. When using this option only one projid/name can\n"
-" be specified at command line. Note that /etc/projects is also used if "
-"exists.\n"
-"\n"
-" The -d <depth> option allows to descend at most <depth> levels of "
-"directories\n"
-" below the command line arguments. -d 0 means only apply the actions\n"
-" to the top level of the projects. -d -1 means no recursion limit "
-"(default).\n"
-"\n"
-" The /etc/projid and /etc/projects file formats are simple, and described\n"
-" on the xfs_quota man page.\n"
-"\n"
-msgstr ""
-
-#: .././quota/project.c:108 .././quota/project.c:153 .././quota/project.c:200
-#, c-format
-msgid "%s: cannot stat file %s\n"
-msgstr ""
-
-#: .././quota/project.c:112 .././quota/project.c:157 .././quota/project.c:204
-#, c-format
-msgid "%s: skipping special file %s\n"
-msgstr ""
-
-#: .././quota/project.c:126
-#, c-format
-msgid "%s - project identifier is not set (inode=%u, tree=%u)\n"
-msgstr ""
-
-#: .././quota/project.c:130
-#, c-format
-msgid "%s - project inheritance flag is not set\n"
-msgstr ""
-
-#: .././quota/project.c:178
-#, c-format
-msgid "%s: cannot clear project on %s: %s\n"
-msgstr ""
-
-#: .././quota/project.c:225
-#, c-format
-msgid "%s: cannot set project on %s: %s\n"
-msgstr ""
-
-#: .././quota/project.c:240
-#, c-format
-msgid "Checking project %s (path %s)...\n"
-msgstr ""
-
-#: .././quota/project.c:244
-#, c-format
-msgid "Setting up project %s (path %s)...\n"
-msgstr ""
-
-#: .././quota/project.c:248
-#, c-format
-msgid "Clearing project %s (path %s)...\n"
-msgstr ""
-
-#: .././quota/project.c:271
-#, c-format
-msgid ""
-"Processed %d (%s and cmdline) paths for project %s with recursion depth %s (%"
-"d).\n"
-msgstr ""
-
-#: .././quota/project.c:274
-msgid "infinite"
-msgstr ""
-
-#: .././quota/project.c:274
-msgid "limited"
-msgstr ""
-
-#: .././quota/project.c:319
-#, c-format
-msgid "projects file \"%s\" doesn't exist\n"
-msgstr ""
-
-#: .././quota/project.c:326
-#, c-format
-msgid ""
-"%s: only one projid/name can be specified when using -p <path>, %d found.\n"
-msgstr ""
-
-#: .././quota/project.c:336
-#, c-format
-msgid "%s - no such project in %s or invalid project number\n"
-msgstr ""
-
-#: .././quota/project.c:353
-msgid "[-c|-s|-C|-d <depth>|-p <path>] project ..."
-msgstr ""
-
-#: .././quota/project.c:356
-msgid "check, setup or clear project quota trees"
-msgstr ""
-
-#: .././quota/quot.c:56
+#: .././quota/init.c:49
 #, c-format
-msgid ""
-"\n"
-" display a summary of filesystem ownership\n"
-"\n"
-" -a -- summarise for all local XFS filesystem mount points\n"
-" -c -- display three columns giving file size in kilobytes, number of files\n"
-"       of that size, and cumulative total of kilobytes in that size or\n"
-"       smaller file.  The last row is used as an overflow bucket and is the\n"
-"       total of all files greater than 500 kilobytes.\n"
-" -v -- display three columns containing the number of kilobytes not\n"
-"       accessed in the last 30, 60, and 90 days.\n"
-" -g -- display group summary\n"
-" -p -- display project summary\n"
-" -u -- display user summary\n"
-" -b -- display number of blocks used\n"
-" -i -- display number of inodes used\n"
-" -r -- display number of realtime blocks used\n"
-" -n -- skip identifier-to-name translations, just report IDs\n"
-" -N -- suppress the initial header\n"
-" -f -- send output to a file\n"
-" The (optional) user/group/project can be specified either by name or by\n"
-" number (i.e. uid/gid/projid).\n"
-"\n"
+msgid "Usage: %s [-V] [-x] [-f] [-p prog] [-c cmd]... [-d project]... [path]\n"
 msgstr ""
 
-#: .././quota/quot.c:221
+#: .././quota/init.c:131
 #, c-format
-msgid "%s (%s) %s:\n"
+msgid "%s: command is for XFS filesystems only\n"
 msgstr ""
 
-#: .././quota/quot.c:297
+#: .././quota/init.c:138
 #, c-format
-msgid "%s (%s):\n"
+msgid "%s: foreign filesystem. Invoke xfs_quota with -f to enable.\n"
 msgstr ""
 
-#: .././quota/quot.c:302 .././quota/quot.c:306
+#: .././quota/path.c:39
 #, c-format
-msgid "%d\t%llu\t%llu\n"
-msgstr ""
-
-#: .././quota/quot.c:425
-msgid "[-bir] [-g|-p|-u] [-acv] [-f file]"
+msgid "%s%sFilesystem          Pathname\n"
 msgstr ""
 
-#: .././quota/quot.c:426
-msgid "summarize filesystem ownership"
+#: .././quota/path.c:40
+msgid "      "
 msgstr ""
 
-#: .././quota/quota.c:33
-#, c-format
-msgid ""
-"\n"
-" display usage and quota information\n"
-"\n"
-" -g -- display group quota information\n"
-" -p -- display project quota information\n"
-" -u -- display user quota information\n"
-" -b -- display number of blocks used\n"
-" -i -- display number of inodes used\n"
-" -r -- display number of realtime blocks used\n"
-" -h -- report in a human-readable format\n"
-" -n -- skip identifier-to-name translations, just report IDs\n"
-" -N -- suppress the initial header\n"
-" -v -- increase verbosity in reporting (also dumps zero values)\n"
-" -f -- send output to a file\n"
-" The (optional) user/group/project can be specified either by name or by\n"
-" number (i.e. uid/gid/projid).\n"
-"\n"
+#: .././quota/path.c:41
+msgid "    "
 msgstr ""
 
-#: .././quota/quota.c:86
+#: .././quota/path.c:44
 #, c-format
-msgid ""
-"Disk quotas for %s %s (%u)\n"
-"Filesystem%s"
+msgid "%c%03d%c "
 msgstr ""
 
-#: .././quota/quota.c:91
+#: .././quota/path.c:47
 #, c-format
-msgid " Blocks  Quota  Limit Warn/Time    "
+msgid "%-19s %s"
 msgstr ""
 
-#: .././quota/quota.c:92
+#: .././quota/path.c:50
 #, c-format
-msgid "     Blocks      Quota      Limit  Warn/Time      "
+msgid " (project %u"
 msgstr ""
 
-#: .././quota/quota.c:95
+#: .././quota/path.c:52
 #, c-format
-msgid "  Files  Quota  Limit Warn/Time    "
+msgid ", %s"
 msgstr ""
 
-#: .././quota/quota.c:96
+#: .././quota/path.c:117
 #, c-format
-msgid "      Files      Quota      Limit  Warn/Time      "
+msgid "No paths are available\n"
 msgstr ""
 
-#: .././quota/quota.c:99
-#, c-format
-msgid "Realtime Quota  Limit Warn/Time    "
+#: .././quota/path.c:145
+msgid "set current path, or show the list of paths"
 msgstr ""
-
-#: .././quota/quota.c:100
-#, c-format
-msgid "   Realtime      Quota      Limit  Warn/Time      "
+
+#: .././quota/path.c:153
+msgid "list known mount points and projects"
 msgstr ""
 
-#: .././quota/quota.c:236
+#: .././quota/quot.c:56
 #, c-format
-msgid "%s: cannot find user %s\n"
+msgid ""
+"\n"
+" display a summary of filesystem ownership\n"
+"\n"
+" -a -- summarise for all local XFS filesystem mount points\n"
+" -c -- display three columns giving file size in kilobytes, number of files\n"
+"       of that size, and cumulative total of kilobytes in that size or\n"
+"       smaller file.  The last row is used as an overflow bucket and is the\n"
+"       total of all files greater than 500 kilobytes.\n"
+" -v -- display three columns containing the number of kilobytes not\n"
+"       accessed in the last 30, 60, and 90 days.\n"
+" -g -- display group summary\n"
+" -p -- display project summary\n"
+" -u -- display user summary\n"
+" -b -- display number of blocks used\n"
+" -i -- display number of inodes used\n"
+" -r -- display number of realtime blocks used\n"
+" -n -- skip identifier-to-name translations, just report IDs\n"
+" -N -- suppress the initial header\n"
+" -f -- send output to a file\n"
+" The (optional) user/group/project can be specified either by name or by\n"
+" number (i.e. uid/gid/projid).\n"
+"\n"
 msgstr ""
 
-#: .././quota/quota.c:286
+#: .././quota/quot.c:221
 #, c-format
-msgid "%s: cannot find group %s\n"
+msgid "%s (%s) %s:\n"
 msgstr ""
 
-#: .././quota/quota.c:347
+#: .././quota/quot.c:297
 #, c-format
-msgid "%s: must specify a project name/ID\n"
+msgid "%s (%s):\n"
 msgstr ""
 
-#: .././quota/quota.c:360
+#: .././quota/quot.c:302 .././quota/quot.c:306
 #, c-format
-msgid "%s: cannot find project %s\n"
+msgid "%d\t%llu\t%llu\n"
 msgstr ""
 
-#: .././quota/quota.c:470
-msgid "[-bir] [-g|-p|-u] [-hnNv] [-f file] [id|name]..."
+#: .././quota/quot.c:425
+msgid "[-bir] [-g|-p|-u] [-acv] [-f file]"
 msgstr ""
 
-#: .././quota/quota.c:471
-msgid "show usage and limits"
+#: .././quota/quot.c:426
+msgid "summarize filesystem ownership"
 msgstr ""
 
 #: .././quota/state.c:33
@@ -8260,4692 +8892,4532 @@ msgstr ""
 msgid "remove quota extents from a filesystem"
 msgstr ""
 
-#: .././quota/util.c:70
-#, c-format
-msgid "[-none-]"
-msgstr ""
-
-#: .././quota/util.c:70
-#, c-format
-msgid "[--none--]"
-msgstr ""
-
-#: .././quota/util.c:73
-#, c-format
-msgid "[------]"
-msgstr ""
-
-#: .././quota/util.c:73
-#, c-format
-msgid "[--------]"
-msgstr ""
-
-#: .././quota/util.c:77 .././quota/util.c:80
-msgid "day"
-msgstr ""
-
-#: .././quota/util.c:77 .././quota/util.c:80
-msgid "days"
-msgstr ""
-
-#: .././quota/util.c:205
-msgid "Blocks"
-msgstr ""
-
-#: .././quota/util.c:205
-msgid "Inodes"
-msgstr ""
-
-#: .././quota/util.c:205
-msgid "Realtime Blocks"
-msgstr ""
-
-#: .././quota/util.c:220
-msgid "User"
-msgstr ""
-
-#: .././quota/util.c:220
-msgid "Group"
-msgstr ""
-
-#: .././quota/util.c:220
-msgid "Project"
-msgstr ""
-
-#: .././quota/util.c:428
-#, c-format
-msgid "%s: open on %s failed: %s\n"
-msgstr ""
-
-#: .././quota/util.c:434
-#, c-format
-msgid "%s: fdopen on %s failed: %s\n"
-msgstr ""
-
-#: .././quota/init.c:49
-#, c-format
-msgid "Usage: %s [-V] [-x] [-f] [-p prog] [-c cmd]... [-d project]... [path]\n"
-msgstr ""
-
-#: .././quota/init.c:130
-#, c-format
-msgid "%s: command is for XFS filesystems only\n"
-msgstr ""
-
-#: .././quota/init.c:137
-#, c-format
-msgid "%s: foreign filesystem. Invoke xfs_quota with -f to enable.\n"
-msgstr ""
-
-#: .././quota/path.c:39
-#, c-format
-msgid "%s%sFilesystem          Pathname\n"
-msgstr ""
-
-#: .././quota/path.c:40
-msgid "      "
-msgstr ""
-
-#: .././quota/path.c:41
-msgid "    "
-msgstr ""
-
-#: .././quota/path.c:44
-#, c-format
-msgid "%c%03d%c "
-msgstr ""
-
-#: .././quota/path.c:47
-#, c-format
-msgid "%-19s %s"
-msgstr ""
-
-#: .././quota/path.c:50
-#, c-format
-msgid " (project %u"
-msgstr ""
-
-#: .././quota/path.c:52
-#, c-format
-msgid ", %s"
-msgstr ""
-
-#: .././quota/path.c:117
-#, c-format
-msgid "No paths are available\n"
-msgstr ""
-
-#: .././quota/path.c:145
-msgid "set current path, or show the list of paths"
-msgstr ""
-
-#: .././quota/path.c:153
-msgid "list known mount points and projects"
-msgstr ""
-
-#: .././quota/report.c:34 .././quota/report.c:769
-msgid "dump quota information for backup utilities"
-msgstr ""
-
-#: .././quota/report.c:36
-#, c-format
-msgid ""
-"\n"
-" create a backup file which contains quota limits information\n"
-" -g -- dump out group quota limits\n"
-" -p -- dump out project quota limits\n"
-" -u -- dump out user quota limits (default)\n"
-" -f -- write the dump out to the specified file\n"
-"\n"
-msgstr ""
-
-#: .././quota/report.c:48
-msgid "[-bir] [-gpu] [-ahntlLNU] [-f file]"
-msgstr ""
-
-#: .././quota/report.c:49 .././quota/report.c:779
-msgid "report filesystem quota information"
-msgstr ""
-
-#: .././quota/report.c:51
+#: .././repair/threads.c:90
 #, c-format
-msgid ""
-"\n"
-" report used space and inodes, and quota limits, for a filesystem\n"
-" Example:\n"
-" 'report -igh'\n"
-" (reports inode usage for all groups, in an easy-to-read format)\n"
-" This command is the equivalent of the traditional repquota command, which\n"
-" prints a summary of the disk usage and quotas for the current filesystem,\n"
-" or all filesystems.\n"
-" -a -- report for all mounted filesystems with quota enabled\n"
-" -h -- report in a human-readable format\n"
-" -n -- skip identifier-to-name translations, just report IDs\n"
-" -N -- suppress the header from the output\n"
-" -t -- terse output format, hides rows which are all zero\n"
-" -L -- lower ID bound to report on\n"
-" -U -- upper ID bound to report on\n"
-" -l -- look up names for IDs in lower-upper range\n"
-" -g -- report group usage and quota information\n"
-" -p -- report project usage and quota information\n"
-" -u -- report user usage and quota information\n"
-" -b -- report blocks-used information only\n"
-" -i -- report inodes-used information only\n"
-" -r -- report realtime-blocks-used information only\n"
-"\n"
+msgid "cannot create worker threads, error = [%d] %s\n"
 msgstr ""
 
-#: .././quota/report.c:273
+#: .././repair/threads.c:108
 #, c-format
-msgid "%s quota on %s (%s)\n"
+msgid "cannot allocate worker item, error = [%d] %s\n"
 msgstr ""
 
-#: .././quota/report.c:298 .././quota/report.c:306
+#: .././repair/avl.c:1011 .././repair/avl64.c:1032
 #, c-format
-msgid "  Used   Soft   Hard Warn/Grace   "
+msgid "avl_insert: Warning! duplicate range [%llu,%llu]\n"
 msgstr ""
 
-#: .././quota/report.c:299 .././quota/report.c:307
+#: .././repair/avl.c:1206 .././repair/avl64.c:1227
 #, c-format
-msgid "      Used       Soft       Hard    Warn/Grace     "
+msgid "Command [fpdir] : "
 msgstr ""
 
-#: .././quota/report.c:302
+#: .././repair/avl.c:1215 .././repair/avl64.c:1236
 #, c-format
-msgid "  Used   Soft   Hard Warn/Grace  "
+msgid "end of range ? "
 msgstr ""
 
-#: .././quota/report.c:303
+#: .././repair/avl.c:1226 .././repair/avl64.c:1247
 #, c-format
-msgid "      Used       Soft       Hard    Warn/ Grace     "
-msgstr ""
-
-#: .././quota/report.c:778
-msgid "[-bir] [-gpu] [-ahnt] [-f file]"
+msgid "Cannot find %d\n"
 msgstr ""
 
-#: .././repair/agheader.c:40
+#: .././repair/avl.c:1239 .././repair/avl64.c:1260
 #, c-format
-msgid "bad magic # 0x%x for agf %d\n"
+msgid "size of range ? "
 msgstr ""
 
-#: .././repair/agheader.c:49
+#: .././repair/avl.c:1250 .././repair/avl64.c:1271
 #, c-format
-msgid "bad version # %d for agf %d\n"
+msgid "End of range ? "
 msgstr ""
 
-#: .././repair/agheader.c:58
+#: .././repair/avl.c:1254 .././repair/avl64.c:1275
 #, c-format
-msgid "bad sequence # %d for agf %d\n"
+msgid "checklen 0/1 ? "
 msgstr ""
 
-#: .././repair/agheader.c:68
+#: .././repair/avl.c:1261 .././repair/avl64.c:1282
 #, c-format
-msgid "bad length %d for agf %d, should be %d\n"
+msgid "Found something\n"
 msgstr ""
 
-#: .././repair/agheader.c:81
+#: .././repair/phase6.c:64
 #, c-format
-msgid "bad length %d for agf %d, should be %<PRIu64>\n"
+msgid "malloc failed add_dotdot_update (%zu bytes)\n"
 msgstr ""
 
-#: .././repair/agheader.c:95
+#: .././repair/phase6.c:216
 #, c-format
-msgid "flfirst %d in agf %d too large (max = %zu)\n"
+msgid "malloc failed in dir_hash_add (%zu bytes)\n"
 msgstr ""
 
-#: .././repair/agheader.c:103
-#, c-format
-msgid "fllast %d in agf %d too large (max = %zu)\n"
+#: .././repair/phase6.c:270
+msgid "ok"
 msgstr ""
 
-#: .././repair/agheader.c:120
-#, c-format
-msgid "bad uuid %s for agf %d\n"
+#: .././repair/phase6.c:271
+msgid "duplicate leaf"
 msgstr ""
 
-#: .././repair/agheader.c:139
-#, c-format
-msgid "bad magic # 0x%x for agi %d\n"
+#: .././repair/phase6.c:272
+msgid "hash value mismatch"
 msgstr ""
 
-#: .././repair/agheader.c:148
-#, c-format
-msgid "bad version # %d for agi %d\n"
+#: .././repair/phase6.c:273
+msgid "no data entry"
 msgstr ""
 
-#: .././repair/agheader.c:157
-#, c-format
-msgid "bad sequence # %d for agi %d\n"
+#: .././repair/phase6.c:274
+msgid "no leaf entry"
 msgstr ""
 
-#: .././repair/agheader.c:167
-#, c-format
-msgid "bad length # %d for agi %d, should be %d\n"
+#: .././repair/phase6.c:275
+msgid "bad stale count"
 msgstr ""
 
-#: .././repair/agheader.c:180
+#: .././repair/phase6.c:283
 #, c-format
-msgid "bad length # %d for agi %d, should be %<PRIu64>\n"
+msgid "bad hash table for directory inode %<PRIu64> (%s): "
 msgstr ""
 
-#: .././repair/agheader.c:199
-#, c-format
-msgid "bad uuid %s for agi %d\n"
+#: .././repair/phase6.c:286
+msgid "rebuilding\n"
 msgstr ""
 
-#: .././repair/agheader.c:305
-#, c-format
-msgid "zeroing unused portion of %s superblock (AG #%u)\n"
+#: .././repair/phase6.c:288
+msgid "would rebuild\n"
 msgstr ""
 
-#: .././repair/agheader.c:306 .././repair/agheader.c:324
-msgid "primary"
+#: .././repair/phase6.c:324
+msgid "calloc failed in dir_hash_init\n"
 msgstr ""
 
-#: .././repair/agheader.c:306 .././repair/agheader.c:324
-msgid "secondary"
+#: .././repair/phase6.c:468
+msgid "ran out of disk space!\n"
 msgstr ""
 
-#: .././repair/agheader.c:323
+#: .././repair/phase6.c:470
 #, c-format
-msgid "would zero unused portion of %s superblock (AG #%u)\n"
+msgid "xfs_trans_reserve returned %d\n"
 msgstr ""
 
-#: .././repair/agheader.c:341
+#: .././repair/phase6.c:500 .././repair/phase6.c:603
 #, c-format
-msgid "bad flags field in superblock %d\n"
+msgid "couldn't iget realtime bitmap inode -- error - %d\n"
 msgstr ""
 
-#: .././repair/agheader.c:364
+#: .././repair/phase6.c:558
 #, c-format
-msgid "non-null user quota inode field in superblock %d\n"
+msgid "couldn't allocate realtime bitmap, error = %d\n"
 msgstr ""
 
-#: .././repair/agheader.c:379
+#: .././repair/phase6.c:572
 #, c-format
-msgid "non-null group quota inode field in superblock %d\n"
+msgid "allocation of the realtime bitmap failed, error = %d\n"
 msgstr ""
 
-#: .././repair/agheader.c:400
+#: .././repair/phase6.c:617
 #, c-format
-msgid "non-null project quota inode field in superblock %d\n"
+msgid "couldn't map realtime bitmap block %<PRIu64>, error = %d\n"
 msgstr ""
 
-#: .././repair/agheader.c:412
+#: .././repair/phase6.c:630
 #, c-format
-msgid "non-null quota flags in superblock %d\n"
+msgid ""
+"can't access block %<PRIu64> (fsbno %<PRIu64>) of realtime bitmap inode "
+"%<PRIu64>\n"
 msgstr ""
 
-#: .././repair/agheader.c:430
+#: .././repair/phase6.c:674 .././repair/phase6.c:748
 #, c-format
-msgid "bad inode alignment field in superblock %d\n"
+msgid "couldn't iget realtime summary inode -- error - %d\n"
 msgstr ""
 
-#: .././repair/agheader.c:443
+#: .././repair/phase6.c:688
 #, c-format
-msgid "bad stripe unit/width fields in superblock %d\n"
+msgid "couldn't map realtime summary inode block %<PRIu64>, error = %d\n"
 msgstr ""
 
-#: .././repair/agheader.c:461
+#: .././repair/phase6.c:701
 #, c-format
-msgid "bad log/data device sector size fields in superblock %d\n"
+msgid ""
+"can't access block %<PRIu64> (fsbno %<PRIu64>) of realtime summary inode "
+"%<PRIu64>\n"
 msgstr ""
 
-#: .././repair/agheader.c:492
+#: .././repair/phase6.c:811
 #, c-format
-msgid "bad on-disk superblock %d - %s\n"
+msgid "couldn't allocate realtime summary inode, error = %d\n"
 msgstr ""
 
-#: .././repair/agheader.c:499
+#: .././repair/phase6.c:825
 #, c-format
-msgid "primary/secondary superblock %d conflict - %s\n"
+msgid "allocation of the realtime summary ino failed, error = %d\n"
 msgstr ""
 
-#: .././repair/avl.c:1011 .././repair/avl64.c:1032
+#: .././repair/phase6.c:854
 #, c-format
-msgid "avl_insert: Warning! duplicate range [%llu,%llu]\n"
+msgid "could not iget root inode -- error - %d\n"
 msgstr ""
 
-#: .././repair/avl.c:1206 .././repair/avl64.c:1227
+#: .././repair/phase6.c:931
 #, c-format
-msgid "Command [fpdir] : "
+msgid "%d - couldn't iget root inode to obtain %s\n"
 msgstr ""
 
-#: .././repair/avl.c:1215 .././repair/avl64.c:1236
+#: .././repair/phase6.c:961
 #, c-format
-msgid "end of range ? "
+msgid "%s inode allocation failed %d\n"
 msgstr ""
 
-#: .././repair/avl.c:1226 .././repair/avl64.c:1247
+#: .././repair/phase6.c:1008
 #, c-format
-msgid "Cannot find %d\n"
+msgid "can't make %s, createname error %d\n"
 msgstr ""
 
-#: .././repair/avl.c:1239 .././repair/avl64.c:1260
+#: .././repair/phase6.c:1029
 #, c-format
-msgid "size of range ? "
+msgid "%s directory creation failed -- bmapf error %d\n"
 msgstr ""
 
-#: .././repair/avl.c:1250 .././repair/avl64.c:1271
+#: .././repair/phase6.c:1071
 #, c-format
-msgid "End of range ? "
+msgid "%d - couldn't iget orphanage inode\n"
 msgstr ""
 
-#: .././repair/avl.c:1254 .././repair/avl64.c:1275
+#: .././repair/phase6.c:1082
 #, c-format
-msgid "checklen 0/1 ? "
+msgid "%d - couldn't iget disconnected inode\n"
 msgstr ""
 
-#: .././repair/avl.c:1261 .././repair/avl64.c:1282
+#: .././repair/phase6.c:1103 .././repair/phase6.c:1146
+#: .././repair/phase6.c:1203
 #, c-format
-msgid "Found something\n"
+msgid "space reservation failed (%d), filesystem may be out of space\n"
 msgstr ""
 
-#: .././repair/bmap.c:53
+#: .././repair/phase6.c:1114 .././repair/phase6.c:1158
+#: .././repair/phase6.c:1214
 #, c-format
-msgid ""
-"Number of extents requested in blkmap_alloc (%d) overflows 32 bits.\n"
-"If this is not a corruption, then you will need a 64 bit system\n"
-"to repair this filesystem.\n"
+msgid "name create failed in %s (%d), filesystem may be out of space\n"
 msgstr ""
 
-#: .././repair/bmap.c:66
+#: .././repair/phase6.c:1127
 #, c-format
-msgid "malloc failed in blkmap_alloc (%zu bytes)\n"
+msgid "creation of .. entry failed (%d), filesystem may be out of space\n"
 msgstr ""
 
-#: .././repair/bmap.c:189
+#: .././repair/phase6.c:1137
 #, c-format
-msgid "blkmap_getn malloc failed (%<PRIu64> bytes)\n"
+msgid "bmap finish failed (err - %d), filesystem may be out of space\n"
 msgstr ""
 
-#: .././repair/bmap.c:296
+#: .././repair/phase6.c:1177
 #, c-format
-msgid ""
-"Number of extents requested in blkmap_grow (%d) overflows 32 bits.\n"
-"You need a 64 bit system to repair this filesystem.\n"
+msgid "name replace op failed (%d), filesystem may be out of space\n"
 msgstr ""
 
-#: .././repair/bmap.c:304
+#: .././repair/phase6.c:1185 .././repair/phase6.c:1225
+#: .././repair/phase6.c:1361
 #, c-format
-msgid ""
-"Number of extents requested in blkmap_grow (%d) overflowed the\n"
-"maximum number of supported extents (%d).\n"
+msgid "bmap finish failed (%d), filesystem may be out of space\n"
 msgstr ""
 
-#: .././repair/bmap.c:312
-msgid "realloc failed in blkmap_grow\n"
+#: .././repair/phase6.c:1244
+msgid ", marking entry to be junked\n"
 msgstr ""
 
-#: .././repair/da_util.c:88 .././repair/prefetch.c:238
-msgid "couldn't malloc dir2 buffer list\n"
+#: .././repair/phase6.c:1248
+msgid ", would junk entry\n"
 msgstr ""
 
-#: .././repair/da_util.c:105
-msgid "attribute"
+#: .././repair/phase6.c:1281
+#, c-format
+msgid "rebuilding directory inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/da_util.c:164 .././repair/da_util.c:585
+#: .././repair/phase6.c:1303
 #, c-format
-msgid "can't read %s block %u for inode %<PRIu64>\n"
+msgid "xfs_bmap_last_offset failed -- error - %d\n"
 msgstr ""
 
-#: .././repair/da_util.c:177
+#: .././repair/phase6.c:1310
 #, c-format
-msgid "found non-root LEAFN node in inode %<PRIu64> bno = %u\n"
+msgid "xfs_bunmapi failed -- error - %d\n"
 msgstr ""
 
-#: .././repair/da_util.c:188
+#: .././repair/phase6.c:1318
 #, c-format
-msgid "bad %s magic number 0x%x in inode %<PRIu64> bno = %u\n"
+msgid "xfs_dir_init failed -- error - %d\n"
 msgstr ""
 
-#: .././repair/da_util.c:199
+#: .././repair/phase6.c:1352
 #, c-format
-msgid "corrupt %s tree block %u for inode %<PRIu64>\n"
+msgid ""
+"name create failed in ino %<PRIu64> (%d), filesystem may be out of space\n"
 msgstr ""
 
-#: .././repair/da_util.c:207
+#: .././repair/phase6.c:1416
 #, c-format
-msgid "bad %s record count in inode %<PRIu64>, count = %d, max = %d\n"
+msgid "shrink_inode failed inode %<PRIu64> block %u\n"
 msgstr ""
 
-#: .././repair/da_util.c:221
+#: .././repair/phase6.c:1508 .././repair/phase6.c:2307
 #, c-format
-msgid "bad header depth for directory inode %<PRIu64>\n"
+msgid "realloc failed in %s (%zu bytes)\n"
 msgstr ""
 
-#: .././repair/da_util.c:232
+#: .././repair/phase6.c:1565
 #, c-format
-msgid "bad %s btree for inode %<PRIu64>\n"
+msgid "empty data block %u in directory inode %<PRIu64>: "
 msgstr ""
 
-#: .././repair/da_util.c:282
+#: .././repair/phase6.c:1569
 #, c-format
-msgid "release_da_cursor_int got unexpected non-null bp, dabno = %u\n"
+msgid "corrupt block %u in directory inode %<PRIu64>: "
 msgstr ""
 
-#: .././repair/da_util.c:360
-#, c-format
-msgid "%s block used/count inconsistency - %d/%hu\n"
+#: .././repair/phase6.c:1573
+msgid "junking block\n"
 msgstr ""
 
-#: .././repair/da_util.c:370
-#, c-format
-msgid "%s block hashvalue inconsistency, expected > %u / saw %u\n"
+#: .././repair/phase6.c:1576
+msgid "would junk block\n"
 msgstr ""
 
-#: .././repair/da_util.c:378
+#: .././repair/phase6.c:1598
 #, c-format
-msgid "bad %s forward block pointer, expected 0, saw %u\n"
+msgid ""
+"bad directory block magic # %#x for directory inode %<PRIu64> block %d: "
 msgstr ""
 
-#: .././repair/da_util.c:383
+#: .././repair/phase6.c:1601
 #, c-format
-msgid "bad %s block in inode %<PRIu64>\n"
+msgid "fixing magic # to %#x\n"
 msgstr ""
 
-#: .././repair/da_util.c:413
+#: .././repair/phase6.c:1605
 #, c-format
-msgid ""
-"correcting bad hashval in non-leaf %s block\n"
-"\tin (level %d) in inode %<PRIu64>.\n"
+msgid "would fix magic # to %#x\n"
 msgstr ""
 
-#: .././repair/da_util.c:421
+#: .././repair/phase6.c:1626
 #, c-format
-msgid ""
-"would correct bad hashval in non-leaf %s block\n"
-"\tin (level %d) in inode %<PRIu64>.\n"
+msgid "directory inode %<PRIu64> block %u has consecutive free entries: "
 msgstr ""
 
-#: .././repair/da_util.c:574
-#, c-format
-msgid "can't get map info for %s block %u of inode %<PRIu64>\n"
+#: .././repair/phase6.c:1630
+msgid "joining together\n"
 msgstr ""
 
-#: .././repair/da_util.c:602
+#: .././repair/phase6.c:1639
+msgid "would join together\n"
+msgstr ""
+
+#: .././repair/phase6.c:1672
 #, c-format
-msgid "bad magic number %x in %s block %u for inode %<PRIu64>\n"
+msgid ""
+"entry \"%s\" in directory inode %<PRIu64> points to non-existent inode "
+"%<PRIu64>"
 msgstr ""
 
-#: .././repair/da_util.c:609
+#: .././repair/phase6.c:1689
 #, c-format
-msgid "bad back pointer in %s block %u for inode %<PRIu64>\n"
+msgid ""
+"entry \"%s\" in directory inode %<PRIu64> points to free inode %<PRIu64>"
 msgstr ""
 
-#: .././repair/da_util.c:615
+#: .././repair/phase6.c:1707 .././repair/phase6.c:2634
 #, c-format
-msgid "entry count %d too large in %s block %u for inode %<PRIu64>\n"
+msgid "%s (ino %<PRIu64>) in root (%<PRIu64>) is not a directory"
 msgstr ""
 
-#: .././repair/da_util.c:622
+#: .././repair/phase6.c:1729 .././repair/phase6.c:2656
 #, c-format
-msgid "bad level %d in %s block %u for inode %<PRIu64>\n"
+msgid "entry \"%s\" (ino %<PRIu64>) in dir %<PRIu64> is a duplicate name"
 msgstr ""
 
-#: .././repair/da_util.c:686
+#: .././repair/phase6.c:1760
 #, c-format
 msgid ""
-"correcting bad hashval in interior %s block\n"
-"\tin (level %d) in inode %<PRIu64>.\n"
+"entry \"%s\" (ino %<PRIu64>) in dir %<PRIu64> is not in the the first block"
 msgstr ""
 
-#: .././repair/da_util.c:694
+#: .././repair/phase6.c:1786
+#, c-format
+msgid "entry \"%s\" in dir %<PRIu64> is not the first entry"
+msgstr ""
+
+#: .././repair/phase6.c:1812 .././repair/phase6.c:2725
 #, c-format
 msgid ""
-"would correct bad hashval in interior %s block\n"
-"\tin (level %d) in inode %<PRIu64>.\n"
+"would fix ftype mismatch (%d/%d) in directory/child inode %<PRIu64>/"
+"%<PRIu64>\n"
 msgstr ""
 
-#: .././repair/scan.c:85 .././repair/scan.c:140
+#: .././repair/phase6.c:1817 .././repair/phase6.c:2730
 #, c-format
-msgid "can't read btree block %d/%d\n"
+msgid ""
+"fixing ftype mismatch (%d/%d) in directory/child inode %<PRIu64>/%<PRIu64>\n"
 msgstr ""
 
-#: .././repair/scan.c:89 .././repair/scan.c:152
+#: .././repair/phase6.c:1850
 #, c-format
-msgid "btree block %d/%d is suspect, error %d\n"
+msgid ""
+"entry \"%s\" in dir %<PRIu64> points to an already connected directory inode "
+"%<PRIu64>\n"
 msgstr ""
 
-#: .././repair/scan.c:213
+#: .././repair/phase6.c:1859 .././repair/phase6.c:2694
 #, c-format
-msgid "bad magic # %#x in inode %<PRIu64> (%s fork) bmbt block %<PRIu64>\n"
+msgid ""
+"entry \"%s\" in dir ino %<PRIu64> doesn't have a .. entry, will set it in "
+"ino %<PRIu64>.\n"
 msgstr ""
 
-#: .././repair/scan.c:219
+#: .././repair/phase6.c:1869
 #, c-format
 msgid ""
-"expected level %d got %d in inode %<PRIu64>, (%s fork) bmbt block %<PRIu64>\n"
+"entry \"%s\" in dir inode %<PRIu64> inconsistent with .. value (%<PRIu64>) "
+"in ino %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/scan.c:229
+#: .././repair/phase6.c:1881
 #, c-format
-msgid "expected owner inode %<PRIu64>, got %llu, bmbt block %<PRIu64>\n"
+msgid "\twill clear entry \"%s\"\n"
 msgstr ""
 
-#: .././repair/scan.c:237
+#: .././repair/phase6.c:1884
 #, c-format
-msgid "expected block %<PRIu64>, got %llu, bmbt block %<PRIu64>\n"
+msgid "\twould clear entry \"%s\"\n"
 msgstr ""
 
-#: .././repair/scan.c:246
+#: .././repair/phase6.c:1919
 #, c-format
-msgid "wrong FS UUID, bmbt block %<PRIu64>\n"
+msgid "expected owner inode %<PRIu64>, got %llu, directory block %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/scan.c:266
+#: .././repair/phase6.c:1926
 #, c-format
-msgid ""
-"bad fwd (right) sibling pointer (saw %<PRIu64> parent block says %<PRIu64>)\n"
-"\tin inode %<PRIu64> (%s fork) bmap btree block %<PRIu64>\n"
+msgid "expected block %<PRIu64>, got %llu, directory inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/scan.c:276
+#: .././repair/phase6.c:1933
 #, c-format
-msgid ""
-"bad back (left) sibling pointer (saw %llu parent block says %<PRIu64>)\n"
-"\tin inode %<PRIu64> (%s fork) bmap btree block %<PRIu64>\n"
+msgid "wrong FS UUID, directory inode %<PRIu64> block %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/scan.c:291
+#: .././repair/phase6.c:1993
 #, c-format
-msgid ""
-"bad back (left) sibling pointer (saw %llu should be NULL (0))\n"
-"\tin inode %<PRIu64> (%s fork) bmap btree block %<PRIu64>\n"
+msgid "leaf block %u for directory inode %<PRIu64> bad CRC\n"
 msgstr ""
 
-#: .././repair/scan.c:339
+#: .././repair/phase6.c:1998
 #, c-format
-msgid "inode 0x%<PRIx64>bmap block 0x%<PRIx64> claimed, state is %d\n"
+msgid "can't read block %u for directory inode %<PRIu64>, error %d\n"
 msgstr ""
 
-#: .././repair/scan.c:346
+#: .././repair/phase6.c:2016 .././repair/phase6.c:2139
 #, c-format
-msgid "inode 0x%<PRIx64> bmap block 0x%<PRIx64> claimed, state is %d\n"
+msgid "leaf block %u for directory inode %<PRIu64> bad header\n"
 msgstr ""
 
-#: .././repair/scan.c:361
+#: .././repair/phase6.c:2042
 #, c-format
-msgid "bad state %d, inode %<PRIu64> bmap block 0x%<PRIx64>\n"
+msgid "leaf block %u for directory inode %<PRIu64> bad tail\n"
 msgstr ""
 
-#: .././repair/scan.c:389
+#: .././repair/phase6.c:2096
 #, c-format
-msgid "couldn't add inode %<PRIu64> bmbt block %<PRIu64> reverse-mapping data."
+msgid "can't read leaf block %u for directory inode %<PRIu64>, error %d\n"
 msgstr ""
 
-#: .././repair/scan.c:397 .././repair/scan.c:448
+#: .././repair/phase6.c:2108
 #, c-format
-msgid "inode %<PRIu64> bad # of bmap records (%u, min - %u, max - %u)\n"
+msgid "unknown magic number %#x for block %u in directory inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/scan.c:427
+#: .././repair/phase6.c:2164
 #, c-format
-msgid ""
-"out-of-order bmap key (file offset) in inode %<PRIu64>, %s fork, fsbno %"
-"<PRIu64>\n"
+msgid "can't read freespace block %u for directory inode %<PRIu64>, error %d\n"
 msgstr ""
 
-#: .././repair/scan.c:465
+#: .././repair/phase6.c:2179
 #, c-format
-msgid "bad bmap btree ptr 0x%llx in ino %<PRIu64>\n"
+msgid "free block %u for directory inode %<PRIu64> bad header\n"
 msgstr ""
 
-#: .././repair/scan.c:493
+#: .././repair/phase6.c:2197
 #, c-format
-msgid ""
-"correcting bt key (was %llu, now %<PRIu64>) in inode %<PRIu64>\n"
-"\t\t%s fork, btree block %<PRIu64>\n"
+msgid "free block %u entry %i for directory ino %<PRIu64> bad\n"
 msgstr ""
 
-#: .././repair/scan.c:505
+#: .././repair/phase6.c:2207
 #, c-format
-msgid ""
-"bad btree key (is %llu, should be %<PRIu64>) in inode %<PRIu64>\n"
-"\t\t%s fork, btree block %<PRIu64>\n"
+msgid "free block %u for directory inode %<PRIu64> bad nused\n"
 msgstr ""
 
-#: .././repair/scan.c:523
+#: .././repair/phase6.c:2218
 #, c-format
-msgid ""
-"bad fwd (right) sibling pointer (saw %<PRIu64> should be NULLFSBLOCK)\n"
-"\tin inode %<PRIu64> (%s fork) bmap btree block %<PRIu64>\n"
+msgid "missing freetab entry %u for directory inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/scan.c:581 .././repair/scan.c:958
+#: .././repair/phase6.c:2257
 #, c-format
-msgid "bad magic # %#x in bt%s block %d/%d\n"
+msgid "malloc failed in %s (%<PRId64> bytes)\n"
 msgstr ""
 
-#: .././repair/scan.c:599 .././repair/scan.c:977
+#: .././repair/phase6.c:2271
 #, c-format
-msgid "expected level %d got %d in bt%s block %d/%d\n"
+msgid "calloc failed in %s (%zu bytes)\n"
 msgstr ""
 
-#: .././repair/scan.c:613
+#: .././repair/phase6.c:2320
 #, c-format
-msgid ""
-"%s freespace btree block claimed (state %d), agno %d, bno %d, suspect %d\n"
+msgid "can't read data block %u for directory inode %<PRIu64> error %d\n"
 msgstr ""
 
-#: .././repair/scan.c:633 .././repair/scan.c:734 .././repair/scan.c:1008
-#: .././repair/scan.c:1152
-#, c-format
-msgid "bad btree nrecs (%u, min=%u, max=%u) in bt%s block %u/%u\n"
+#: .././repair/phase6.c:2427
+msgid "would junk entry\n"
 msgstr ""
 
-#: .././repair/scan.c:651 .././repair/scan.c:1043 .././repair/scan.c:1329
-#, c-format
-msgid "invalid start block %u in record %u of %s btree block %u/%u\n"
+#: .././repair/phase6.c:2451
+msgid "junking entry\n"
 msgstr ""
 
-#: .././repair/scan.c:657 .././repair/scan.c:1049 .././repair/scan.c:1335
+#: .././repair/phase6.c:2497
 #, c-format
-msgid "invalid length %u in record %u of %s btree block %u/%u\n"
+msgid "would set .. in sf dir inode %<PRIu64> to %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/scan.c:704
+#: .././repair/phase6.c:2501
 #, c-format
-msgid "block (%d,%d-%d) multiply claimed by %s space tree, state - %d\n"
+msgid "setting .. in sf dir inode %<PRIu64> to %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/scan.c:833
+#: .././repair/phase6.c:2601
 #, c-format
 msgid ""
-"Static meta block (%d,%d-%d) mismatch in %s tree, state - %d,%<PRIx64>\n"
+"entry \"%s\" in shortform directory %<PRIu64> references non-existent inode "
+"%<PRIu64>\n"
 msgstr ""
 
-#: .././repair/scan.c:842
+#: .././repair/phase6.c:2618
 #, c-format
-msgid "AG meta block (%d,%d-%d) mismatch in %s tree, state - %d,%<PRIx64>\n"
+msgid ""
+"entry \"%s\" in shortform directory inode %<PRIu64> points to free inode "
+"%<PRIu64>\n"
 msgstr ""
 
-#: .././repair/scan.c:850
+#: .././repair/phase6.c:2680
 #, c-format
-msgid "inode block (%d,%d-%d) mismatch in %s tree, state - %d,%<PRIx64>\n"
+msgid ""
+"entry \"%s\" in directory inode %<PRIu64> references already connected inode "
+"%<PRIu64>.\n"
 msgstr ""
 
-#: .././repair/scan.c:858
+#: .././repair/phase6.c:2703
 #, c-format
 msgid ""
-"AG refcount block (%d,%d-%d) mismatch in %s tree, state - %d,%<PRIx64>\n"
+"entry \"%s\" in directory inode %<PRIu64> not consistent with .. value "
+"(%<PRIu64>) in inode %<PRIu64>,\n"
 msgstr ""
 
-#: .././repair/scan.c:867
+#: .././repair/phase6.c:2760
 #, c-format
-msgid "in use block (%d,%d-%d) mismatch in %s tree, state - %d,%<PRIx64>\n"
+msgid "would fix i8count in inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/scan.c:889
+#: .././repair/phase6.c:2775
 #, c-format
-msgid "unknown block (%d,%d-%d) mismatch on %s tree, state - %d,%<PRIx64>\n"
+msgid "fixing i8count in inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/scan.c:989
+#: .././repair/phase6.c:2795
 #, c-format
-msgid "%s rmap btree block claimed (state %d), agno %d, bno %d, suspect %d\n"
+msgid "setting size to %<PRId64> bytes to reflect junked entries\n"
 msgstr ""
 
-#: .././repair/scan.c:1033
+#: .././repair/phase6.c:2834 .././repair/phase6.c:2838 .././repair/phase7.c:52
 #, c-format
-msgid "invalid flags in record %u of %s btree block %u/%u\n"
+msgid "couldn't map inode %<PRIu64>, err = %d\n"
 msgstr ""
 
-#: .././repair/scan.c:1062
-#, c-format
-msgid "invalid owner in rmap btree record %d (%<PRId64> %u) block %u/%u\n"
+#: .././repair/phase6.c:2939
+msgid "recreating root directory .. entry\n"
 msgstr ""
 
-#: .././repair/scan.c:1069
+#: .././repair/phase6.c:2955
 #, c-format
-msgid ""
-"record %d of block (%u/%u) in %s btree cannot have non-inode owner with "
-"flags\n"
+msgid "can't make \"..\" entry in root inode %<PRIu64>, createname error %d\n"
 msgstr ""
 
-#: .././repair/scan.c:1073
-#, c-format
-msgid ""
-"record %d of block (%u/%u) in %s btree cannot have non-inode owner with "
-"offset\n"
+#: .././repair/phase6.c:2966
+msgid "would recreate root directory .. entry\n"
 msgstr ""
 
-#: .././repair/scan.c:1094
+#: .././repair/phase6.c:2990
 #, c-format
-msgid ""
-"out-of-order rmap btree record %d (%u %<PRId64> %<PRIx64> %u) block %u/%u\n"
+msgid "would create missing \".\" entry in dir ino %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/scan.c:1103 .././repair/scan.c:1381
+#: .././repair/phase6.c:2997
 #, c-format
-msgid ""
-"record %d in block (%u/%u) of %s tree should be merged with previous record\n"
+msgid "creating missing \".\" entry in dir ino %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/scan.c:1118
+#: .././repair/phase6.c:3013
 #, c-format
-msgid "record %d greater than high key of block (%u/%u) in %s tree\n"
+msgid "can't make \".\" entry in dir ino %<PRIu64>, createname error %d\n"
 msgstr ""
 
-#: .././repair/scan.c:1174
+#: .././repair/phase6.c:3106
 #, c-format
-msgid "invalid flags in key %u of %s btree block %u/%u\n"
+msgid "disconnected dir inode %<PRIu64>, "
 msgstr ""
 
-#: .././repair/scan.c:1180
+#: .././repair/phase6.c:3108
 #, c-format
-msgid "key %d greater than high key of block (%u/%u) in %s tree\n"
+msgid "disconnected inode %<PRIu64>, "
 msgstr ""
 
-#: .././repair/scan.c:1206
+#: .././repair/phase6.c:3112
 #, c-format
-msgid "invalid flags in high key %u of %s btree block %u/%u\n"
+msgid "moving to %s\n"
 msgstr ""
 
-#: .././repair/scan.c:1257
+#: .././repair/phase6.c:3115
 #, c-format
-msgid "bad magic # %#x in %s btree block %d/%d\n"
+msgid "would move to %s\n"
 msgstr ""
 
-#: .././repair/scan.c:1265
+#: .././repair/phase6.c:3139 .././repair/phase3.c:78 .././repair/phase4.c:142
+#: .././repair/phase5.c:2217
 #, c-format
-msgid "expected level %d got %d in %s btree block %d/%d\n"
+msgid "        - agno = %d\n"
 msgstr ""
 
-#: .././repair/scan.c:1279
-#, c-format
-msgid "%s btree block claimed (state %d), agno %d, bno %d, suspect %d\n"
+#: .././repair/phase6.c:3200
+msgid "Phase 6 - check inode connectivity...\n"
 msgstr ""
 
-#: .././repair/scan.c:1298 .././repair/scan.c:1415
-#, c-format
-msgid "bad btree nrecs (%u, min=%u, max=%u) in %s btree block %u/%u\n"
+#: .././repair/phase6.c:3214
+msgid "reinitializing root directory\n"
 msgstr ""
 
-#: .././repair/scan.c:1316
-#, c-format
-msgid ""
-"leftover CoW extent has incorrect refcount in record %u of %s btree block %u/"
-"%u\n"
+#: .././repair/phase6.c:3219
+msgid "would reinitialize root directory\n"
 msgstr ""
 
-#: .././repair/scan.c:1321
-#, c-format
-msgid ""
-"leftover CoW extent has invalid startblock in record %u of %s btree block %u/"
-"%u\n"
+#: .././repair/phase6.c:3225
+msgid "reinitializing realtime bitmap inode\n"
 msgstr ""
 
-#: .././repair/scan.c:1356
-#, c-format
-msgid "extent (%u/%u) len %u claimed, state is %d\n"
+#: .././repair/phase6.c:3229
+msgid "would reinitialize realtime bitmap inode\n"
 msgstr ""
 
-#: .././repair/scan.c:1363
-#, c-format
-msgid "invalid reference count %u in record %u of %s btree block %u/%u\n"
+#: .././repair/phase6.c:3235
+msgid "reinitializing realtime summary inode\n"
 msgstr ""
 
-#: .././repair/scan.c:1370
-#, c-format
-msgid "out-of-order %s btree record %d (%u %u) block %u/%u\n"
+#: .././repair/phase6.c:3239
+msgid "would reinitialize realtime summary inode\n"
 msgstr ""
 
-#: .././repair/scan.c:1496
-#, c-format
-msgid "badly aligned %s rec (starting inode = %<PRIu64>)\n"
+#: .././repair/phase6.c:3245
+msgid "        - resetting contents of realtime bitmap and summary inodes\n"
 msgstr ""
 
-#: .././repair/scan.c:1510
-#, c-format
-msgid "bad starting inode # (%<PRIu64> (0x%x 0x%x)) in %s rec, skipping rec\n"
+#: .././repair/phase6.c:3248 .././repair/phase6.c:3253
+msgid "Warning:  realtime bitmap may be inconsistent\n"
 msgstr ""
 
-#: .././repair/scan.c:1519
-#, c-format
-msgid "bad ending inode # (%<PRIu64> (0x%x 0x%zx)) in %s rec, skipping rec\n"
+#: .././repair/phase6.c:3259
+msgid "        - traversing filesystem ...\n"
 msgstr ""
 
-#: .././repair/scan.c:1584
-#, c-format
-msgid ""
-"ir_holemask/ir_free mismatch, %s chunk %d/%u, holemask 0x%x free 0x%llx\n"
+#: .././repair/phase6.c:3282
+msgid "        - traversal finished ...\n"
 msgstr ""
 
-#: .././repair/scan.c:1671
+#: .././repair/phase6.c:3283
 #, c-format
-msgid ""
-"inode chunk claims used block, inobt block - agno %d, bno %d, inopb %d\n"
+msgid "        - moving disconnected inodes to %s ...\n"
 msgstr ""
 
-#: .././repair/scan.c:1689
-#, c-format
-msgid ""
-"inode rec for ino %<PRIu64> (%d/%d) overlaps existing rec (start %d/%d)\n"
+#: .././repair/dinode.c:54
+msgid "real-time"
+msgstr ""
+
+#: .././repair/dinode.c:55
+msgid "regular"
 msgstr ""
 
-#: .././repair/scan.c:1713
+#: .././repair/dinode.c:78
 #, c-format
-msgid "ir_freecount/free mismatch, inode chunk %d/%u, freecount %d nfree %d\n"
+msgid "clearing inode %<PRIu64> attributes\n"
 msgstr ""
 
-#: .././repair/scan.c:1721 .././repair/scan.c:1911
+#: .././repair/dinode.c:81
 #, c-format
-msgid "invalid inode count, inode chunk %d/%u, count %d ninodes %d\n"
+msgid "would have cleared inode %<PRIu64> attributes\n"
 msgstr ""
 
-#: .././repair/scan.c:1775
+#: .././repair/dinode.c:444
 #, c-format
 msgid ""
-"sparse inode chunk claims inode block, finobt block - agno %d, bno %d, inopb "
-"%d\n"
+"inode %<PRIu64> - bad rt extent start block number %<PRIu64>, offset "
+"%<PRIu64>\n"
 msgstr ""
 
-#: .././repair/scan.c:1790 .././repair/scan.c:1802
+#: .././repair/dinode.c:452
 #, c-format
 msgid ""
-"inode chunk claims untracked block, finobt block - agno %d, bno %d, inopb %"
-"d\n"
+"inode %<PRIu64> - bad rt extent last block number %<PRIu64>, offset "
+"%<PRIu64>\n"
 msgstr ""
 
-#: .././repair/scan.c:1812
+#: .././repair/dinode.c:460
 #, c-format
 msgid ""
-"inode chunk claims used block, finobt block - agno %d, bno %d, inopb %d\n"
+"inode %<PRIu64> - bad rt extent overflows - start %<PRIu64>, end %<PRIu64>, "
+"offset %<PRIu64>\n"
+msgstr ""
+
+#: .././repair/dinode.c:477
+#, c-format
+msgid "malformed rt inode extent [%<PRIu64> %<PRIu64>] (fs rtext size = %u)\n"
 msgstr ""
 
-#: .././repair/scan.c:1834
+#: .././repair/dinode.c:498
 #, c-format
 msgid ""
-"finobt rec for ino %<PRIu64> (%d/%u) does not match existing rec (%d/%d)\n"
+"data fork in rt ino %<PRIu64> claims dup rt extent,off - %<PRIu64>, start - "
+"%<PRIu64>, count %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/scan.c:1876
+#: .././repair/dinode.c:517
 #, c-format
-msgid "undiscovered finobt record, ino %<PRIu64> (%d/%u)\n"
+msgid "bad state in rt block map %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/scan.c:1898
+#: .././repair/dinode.c:523
 #, c-format
 msgid ""
-"finobt ir_freecount/free mismatch, inode chunk %d/%u, freecount %d nfree %d\n"
+"data fork in rt inode %<PRIu64> found metadata block %<PRIu64> in rt bmap\n"
 msgstr ""
 
-#: .././repair/scan.c:1904
+#: .././repair/dinode.c:531
 #, c-format
-msgid "finobt record with no free inodes, inode chunk %d/%u\n"
+msgid "data fork in rt inode %<PRIu64> claims used rt block %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/scan.c:1957
+#: .././repair/dinode.c:537
 #, c-format
-msgid "bad magic # %#x in inobt block %d/%d\n"
+msgid "illegal state %d in rt block map %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/scan.c:1965
+#: .././repair/dinode.c:600
 #, c-format
-msgid "expected level %d got %d in inobt block %d/%d\n"
+msgid ""
+"bmap rec out of order, inode %<PRIu64> entry %d [o s c] [%<PRIu64> %<PRIu64> "
+"%<PRIu64>], %d [%<PRIu64> %<PRIu64> %<PRIu64>]\n"
 msgstr ""
 
-#: .././repair/scan.c:1988
+#: .././repair/dinode.c:616
 #, c-format
-msgid "inode btree block claimed (state %d), agno %d, bno %d, suspect %d\n"
+msgid ""
+"zero length extent (off = %<PRIu64>, fsbno = %<PRIu64>) in ino %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/scan.c:2011
+#: .././repair/dinode.c:647
 #, c-format
-msgid "dubious inode btree block header %d/%d\n"
+msgid ""
+"inode %<PRIu64> - bad extent starting block number %<PRIu64>, offset "
+"%<PRIu64>\n"
 msgstr ""
 
-#: .././repair/scan.c:2129
+#: .././repair/dinode.c:655
 #, c-format
-msgid "can't read agfl block for ag %d\n"
+msgid ""
+"inode %<PRIu64> - bad extent last block number %<PRIu64>, offset %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/scan.c:2133
+#: .././repair/dinode.c:663
 #, c-format
-msgid "agfl has bad CRC for ag %d\n"
+msgid ""
+"inode %<PRIu64> - bad extent overflows - start %<PRIu64>, end %<PRIu64>, "
+"offset %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/scan.c:2154
+#: .././repair/dinode.c:675
 #, c-format
-msgid "bad agbno %u in agfl, agno %d\n"
+msgid ""
+"inode %<PRIu64> - extent exceeds max offset - start %<PRIu64>, count "
+"%<PRIu64>, physical block %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/scan.c:2163
+#: .././repair/dinode.c:696
 #, c-format
-msgid "freeblk count %d != flcount %d in ag %d\n"
+msgid ""
+"Fatal error: inode %<PRIu64> - blkmap_set_ext(): %s\n"
+"\t%s fork, off - %<PRIu64>, start - %<PRIu64>, cnt %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/scan.c:2189
+#: .././repair/dinode.c:729
 #, c-format
-msgid "bad agbno %u for btbno root, agno %d\n"
+msgid ""
+"%s fork in ino %<PRIu64> claims dup extent, off - %<PRIu64>, start - "
+"%<PRIu64>, cnt %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/scan.c:2201
+#: .././repair/dinode.c:748
 #, c-format
-msgid "bad agbno %u for btbcnt root, agno %d\n"
+msgid "%s fork in ino %<PRIu64> claims free block %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/scan.c:2220
+#: .././repair/dinode.c:757
 #, c-format
-msgid "bad rmapbt block count %u, saw %u\n"
+msgid "bad state in block map %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/scan.c:2224
+#: .././repair/dinode.c:762
+msgid "rmap claims metadata use!\n"
+msgstr ""
+
+#: .././repair/dinode.c:769
 #, c-format
-msgid "bad agbno %u for rmapbt root, agno %d\n"
+msgid "%s fork in inode %<PRIu64> claims metadata block %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/scan.c:2241
+#: .././repair/dinode.c:780
 #, c-format
-msgid "bad refcountbt block count %u, saw %u\n"
+msgid "%s fork in %s inode %<PRIu64> claims used block %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/scan.c:2245
+#: .././repair/dinode.c:786
 #, c-format
-msgid "bad agbno %u for refcntbt root, agno %d\n"
+msgid "%s fork in %s inode %<PRIu64> claims CoW block %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/scan.c:2263
+#: .././repair/dinode.c:792
 #, c-format
-msgid "agf_btreeblks %u, counted %<PRIu64> in ag %u\n"
+msgid "illegal state %d in block map %<PRIu64>\n"
+msgstr ""
+
+#: .././repair/dinode.c:800
+msgid "couldn't add reverse mapping\n"
 msgstr ""
 
-#: .././repair/scan.c:2287
+#: .././repair/dinode.c:812
 #, c-format
-msgid "bad agbno %u for inobt root, agno %d\n"
+msgid "correcting nextents for inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/scan.c:2300
+#: .././repair/dinode.c:904
 #, c-format
-msgid "bad agbno %u for finobt root, agno %d\n"
+msgid "cannot read inode (%u/%u), disk block %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/scan.c:2317
+#: .././repair/dinode.c:972
 #, c-format
-msgid "agi_freecount %u, counted %u in ag %u finobt\n"
+msgid "bad level %d in inode %<PRIu64> bmap btree root block\n"
 msgstr ""
 
-#: .././repair/scan.c:2327
+#: .././repair/dinode.c:978
 #, c-format
-msgid "agi unlinked bucket %d is %u in ag %u (inode=%<PRIu64>)\n"
+msgid "bad numrecs 0 in inode %<PRIu64> bmap btree root block\n"
 msgstr ""
 
-#: .././repair/scan.c:2358
-msgid "can't allocate memory for superblock\n"
+#: .././repair/dinode.c:987
+#, c-format
+msgid ""
+"indicated size of %s btree root (%d bytes) greater than space in inode "
+"%<PRIu64> %s fork\n"
 msgstr ""
 
-#: .././repair/scan.c:2365
-msgid "root superblock"
+#: .././repair/dinode.c:1008
+#, c-format
+msgid "bad bmap btree ptr 0x%<PRIx64> in ino %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/scan.c:2374
-msgid "agf block"
+#: .././repair/dinode.c:1028
+#, c-format
+msgid ""
+"correcting key in bmbt root (was %<PRIu64>, now %<PRIu64>) in inode "
+"%<PRIu64> %s fork\n"
 msgstr ""
 
-#: .././repair/scan.c:2383
-msgid "agi block"
+#: .././repair/dinode.c:1040
+#, c-format
+msgid ""
+"bad key in bmbt root (is %<PRIu64>, would reset to %<PRIu64>) in inode "
+"%<PRIu64> %s fork\n"
 msgstr ""
 
-#: .././repair/scan.c:2404
+#: .././repair/dinode.c:1056
 #, c-format
-msgid "reset bad sb for ag %d\n"
+msgid "out of order bmbt root key %<PRIu64> in inode %<PRIu64> %s fork\n"
 msgstr ""
 
-#: .././repair/scan.c:2407
+#: .././repair/dinode.c:1073
 #, c-format
-msgid "would reset bad sb for ag %d\n"
+msgid ""
+"extent count for ino %<PRIu64> %s fork too low (%<PRIu64>) for file format\n"
 msgstr ""
 
-#: .././repair/scan.c:2412
+#: .././repair/dinode.c:1084
 #, c-format
-msgid "reset bad agf for ag %d\n"
+msgid "bad fwd (right) sibling pointer (saw %<PRIu64> should be NULLFSBLOCK)\n"
 msgstr ""
 
-#: .././repair/scan.c:2415
+#: .././repair/dinode.c:1087
 #, c-format
-msgid "would reset bad agf for ag %d\n"
+msgid "\tin inode %<PRIu64> (%s fork) bmap btree block %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/scan.c:2420
+#: .././repair/dinode.c:1169
 #, c-format
-msgid "reset bad agi for ag %d\n"
+msgid "local inode %<PRIu64> data fork is too large (size = %lld, max = %d)\n"
 msgstr ""
 
-#: .././repair/scan.c:2423
+#: .././repair/dinode.c:1177
 #, c-format
-msgid "would reset bad agi for ag %d\n"
+msgid "local inode %<PRIu64> attr fork too large (size %d, max = %d)\n"
 msgstr ""
 
-#: .././repair/scan.c:2428
+#: .././repair/dinode.c:1184
 #, c-format
-msgid "bad uncorrected agheader %d, skipping ag...\n"
+msgid "local inode %<PRIu64> attr too small (size = %d, min size = %zd)\n"
 msgstr ""
 
-#: .././repair/scan.c:2491
+#: .././repair/dinode.c:1208
 #, c-format
-msgid "can't get %s for ag %d\n"
+msgid ""
+"mismatch between format (%d) and size (%<PRId64>) in symlink ino %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/scan.c:2511
-msgid "no memory for ag header counts\n"
+#: .././repair/dinode.c:1215
+#, c-format
+msgid ""
+"mismatch between format (%d) and size (%<PRId64>) in symlink inode "
+"%<PRIu64>\n"
 msgstr ""
 
-#: .././repair/scan.c:2537
+#: .././repair/dinode.c:1230
 #, c-format
-msgid "sb_icount %<PRIu64>, counted %<PRIu64>\n"
+msgid "bad number of extents (%d) in symlink %<PRIu64> data fork\n"
 msgstr ""
 
-#: .././repair/scan.c:2542
+#: .././repair/dinode.c:1242
 #, c-format
-msgid "sb_ifree %<PRIu64>, counted %<PRIu64>\n"
+msgid "bad extent #%d offset (%<PRIu64>) in symlink %<PRIu64> data fork\n"
 msgstr ""
 
-#: .././repair/scan.c:2547
+#: .././repair/dinode.c:1248
 #, c-format
-msgid "sb_fdblocks %<PRIu64>, counted %<PRIu64>\n"
+msgid "bad extent #%d count (%<PRIu64>) in symlink %<PRIu64> data fork\n"
 msgstr ""
 
-#: .././repair/scan.c:2553
+#: .././repair/dinode.c:1306
 #, c-format
-msgid "used blocks %<PRIu64>, counted %<PRIu64>\n"
+msgid "cannot read inode %<PRIu64>, file block %d, NULL disk block\n"
 msgstr ""
 
-#: .././repair/incore.c:230
+#: .././repair/dinode.c:1328
 #, c-format
-msgid "couldn't allocate realtime block map, size = %<PRIu64>\n"
+msgid "cannot read inode %<PRIu64>, file block %d, disk block %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/incore.c:295
-msgid "couldn't allocate block map btree roots\n"
+#: .././repair/dinode.c:1334
+#, c-format
+msgid ""
+"Bad symlink buffer CRC, block %<PRIu64>, inode %<PRIu64>.\n"
+"Correcting CRC, but symlink may be bad.\n"
 msgstr ""
 
-#: .././repair/incore.c:299
-msgid "couldn't allocate block map locks\n"
+#: .././repair/dinode.c:1347
+#, c-format
+msgid "bad symlink header ino %<PRIu64>, file block %d, disk block %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/incore_ext.c:135 .././repair/incore_ext.c:562
-msgid "couldn't allocate new extent descriptor.\n"
+#: .././repair/dinode.c:1390
+#, c-format
+msgid "symlink in inode %<PRIu64> too long (%llu chars)\n"
 msgstr ""
 
-#: .././repair/incore_ext.c:232
-msgid "duplicate bno extent range\n"
+#: .././repair/dinode.c:1396
+#, c-format
+msgid "zero size symlink in inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/incore_ext.c:369
-msgid ":  duplicate bno extent range\n"
+#: .././repair/dinode.c:1427
+#, c-format
+msgid "found illegal null character in symlink inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/incore_ext.c:644 .././repair/incore_ext.c:699
-msgid "duplicate extent range\n"
+#: .././repair/dinode.c:1452
+#, c-format
+msgid "inode %<PRIu64> has bad inode type (IFMNT)\n"
 msgstr ""
 
-#: .././repair/incore_ext.c:752 .././repair/incore_ext.c:756
-msgid "couldn't malloc dup extent tree descriptor table\n"
+#: .././repair/dinode.c:1463
+#, c-format
+msgid "size of character device inode %<PRIu64> != 0 (%<PRId64> bytes)\n"
 msgstr ""
 
-#: .././repair/incore_ext.c:761
-msgid "couldn't malloc free by-bno extent tree descriptor table\n"
+#: .././repair/dinode.c:1468
+#, c-format
+msgid "size of block device inode %<PRIu64> != 0 (%<PRId64> bytes)\n"
 msgstr ""
 
-#: .././repair/incore_ext.c:766
-msgid "couldn't malloc free by-bcnt extent tree descriptor table\n"
+#: .././repair/dinode.c:1473
+#, c-format
+msgid "size of socket inode %<PRIu64> != 0 (%<PRId64> bytes)\n"
 msgstr ""
 
-#: .././repair/incore_ext.c:772
-msgid "couldn't malloc bno extent tree descriptor\n"
+#: .././repair/dinode.c:1478
+#, c-format
+msgid "size of fifo inode %<PRIu64> != 0 (%<PRId64> bytes)\n"
 msgstr ""
 
-#: .././repair/incore_ext.c:776
-msgid "couldn't malloc bcnt extent tree descriptor\n"
+#: .././repair/dinode.c:1482
+#, c-format
+msgid "Internal error - process_misc_ino_types, illegal type %d\n"
 msgstr ""
 
-#: .././repair/incore_ext.c:787
-msgid "couldn't malloc dup rt extent tree descriptor\n"
+#: .././repair/dinode.c:1509
+#, c-format
+msgid "size of character device inode %<PRIu64> != 0 (%<PRIu64> blocks)\n"
 msgstr ""
 
-#: .././repair/init.c:46
+#: .././repair/dinode.c:1514
 #, c-format
-msgid "getrlimit(RLIMIT_FSIZE) failed!\n"
+msgid "size of block device inode %<PRIu64> != 0 (%<PRIu64> blocks)\n"
 msgstr ""
 
-#: .././repair/init.c:54
+#: .././repair/dinode.c:1519
 #, c-format
-msgid "setrlimit failed - current: %lld, max: %lld\n"
+msgid "size of socket inode %<PRIu64> != 0 (%<PRIu64> blocks)\n"
 msgstr ""
 
-#: .././repair/init.c:107
+#: .././repair/dinode.c:1524
 #, c-format
-msgid ""
-"Unmount or use the dangerous (-d) option to repair a read-only mounted "
-"filesystem\n"
+msgid "size of fifo inode %<PRIu64> != 0 (%<PRIu64> blocks)\n"
 msgstr ""
 
-#: .././repair/init.c:109
-msgid "couldn't initialize XFS library\n"
+#: .././repair/dinode.c:1602
+#, c-format
+msgid "root inode %<PRIu64> has bad type 0x%x\n"
 msgstr ""
 
-#: .././repair/phase1.c:28
-msgid "Sorry, could not find valid secondary superblock\n"
+#: .././repair/dinode.c:1606
+msgid "resetting to directory\n"
 msgstr ""
 
-#: .././repair/phase1.c:29
-msgid "Exiting now.\n"
+#: .././repair/dinode.c:1610
+msgid "would reset to directory\n"
 msgstr ""
 
-#: .././repair/phase1.c:40
+#: .././repair/dinode.c:1616
 #, c-format
-msgid "could not allocate ag header buffer (%d bytes)\n"
-msgstr ""
-
-#: .././repair/phase1.c:58
-msgid "Phase 1 - find and verify superblock...\n"
+msgid "user quota inode %<PRIu64> has bad type 0x%x\n"
 msgstr ""
 
-#: .././repair/phase1.c:75
-msgid "error reading primary superblock\n"
+#: .././repair/dinode.c:1625
+#, c-format
+msgid "group quota inode %<PRIu64> has bad type 0x%x\n"
 msgstr ""
 
-#: .././repair/phase1.c:81
+#: .././repair/dinode.c:1634
 #, c-format
-msgid "bad primary superblock - %s !!!\n"
+msgid "project quota inode %<PRIu64> has bad type 0x%x\n"
 msgstr ""
 
-#: .././repair/phase1.c:88
+#: .././repair/dinode.c:1644
 #, c-format
-msgid "couldn't verify primary superblock - %s !!!\n"
+msgid "realtime summary inode %<PRIu64> has bad type 0x%x, "
 msgstr ""
 
-#: .././repair/phase1.c:106
-msgid "superblock has a features2 mismatch, correcting\n"
+#: .././repair/dinode.c:1647 .././repair/dinode.c:1668
+msgid "resetting to regular file\n"
 msgstr ""
 
-#: .././repair/phase1.c:123
-#, c-format
-msgid "Enabling lazy-counters\n"
+#: .././repair/dinode.c:1651 .././repair/dinode.c:1672
+msgid "would reset to regular file\n"
 msgstr ""
 
-#: .././repair/phase1.c:127
+#: .././repair/dinode.c:1656
 #, c-format
-msgid "Cannot disable lazy-counters on V5 fs\n"
+msgid "bad # of extents (%u) for realtime summary inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/phase1.c:132
+#: .././repair/dinode.c:1665
 #, c-format
-msgid "Disabling lazy-counters\n"
+msgid "realtime bitmap inode %<PRIu64> has bad type 0x%x, "
 msgstr ""
 
-#: .././repair/phase1.c:135
+#: .././repair/dinode.c:1677
 #, c-format
-msgid "Lazy-counters are already %s\n"
+msgid "bad # of extents (%u) for realtime bitmap inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/phase1.c:136
-msgid "enabled"
+#: .././repair/dinode.c:1712
+#, c-format
+msgid ""
+"mismatch between format (%d) and size (%<PRId64>) in directory ino "
+"%<PRIu64>\n"
 msgstr ""
 
-#: .././repair/phase1.c:136
-msgid "disabled"
+#: .././repair/dinode.c:1718
+#, c-format
+msgid "directory inode %<PRIu64> has bad size %<PRId64>\n"
 msgstr ""
 
-#: .././repair/phase1.c:143
-msgid "writing modified primary superblock\n"
+#: .././repair/dinode.c:1726
+#, c-format
+msgid "bad data fork in symlink %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/phase1.c:146
-msgid "would write modified primary superblock\n"
+#: .././repair/dinode.c:1747
+#, c-format
+msgid "found inode %<PRIu64> claiming to be a real-time file\n"
 msgstr ""
 
-#: .././repair/phase2.c:79
+#: .././repair/dinode.c:1756
 #, c-format
-msgid "zero_log: cannot find log head/tail (xlog_find_tail=%d)\n"
+msgid ""
+"realtime bitmap inode %<PRIu64> has bad size %<PRId64> (should be "
+"%<PRIu64>)\n"
 msgstr ""
 
-#: .././repair/phase2.c:83
+#: .././repair/dinode.c:1767
+#, c-format
 msgid ""
-"ERROR: The log head and/or tail cannot be discovered. Attempt to mount the\n"
-"filesystem to replay the log or use the -L option to destroy the log and\n"
-"attempt a repair.\n"
+"realtime summary inode %<PRIu64> has bad size %<PRId64> (should be %d)\n"
 msgstr ""
 
-#: .././repair/phase2.c:90
+#: .././repair/dinode.c:1795
 #, c-format
-msgid "zero_log: head block %<PRId64> tail block %<PRId64>\n"
+msgid "bad attr fork offset %d in dev inode %<PRIu64>, should be %d\n"
 msgstr ""
 
-#: .././repair/phase2.c:96
-msgid ""
-"ALERT: The filesystem has valuable metadata changes in a log which is being\n"
-"destroyed because the -L option was used.\n"
+#: .././repair/dinode.c:1807
+#, c-format
+msgid "bad attr fork offset %d in inode %<PRIu64>, max=%d\n"
 msgstr ""
 
-#: .././repair/phase2.c:100
-msgid ""
-"ERROR: The filesystem has valuable metadata changes in a log which needs to\n"
-"be replayed.  Mount the filesystem to replay the log, and unmount it before\n"
-"re-running xfs_repair.  If you are unable to mount the filesystem, then use\n"
-"the -L option to destroy the log and attempt a repair.\n"
-"Note that destroying the log may cause corruption -- please attempt a mount\n"
-"of the filesystem before doing this.\n"
+#: .././repair/dinode.c:1814
+#, c-format
+msgid "unexpected inode format %d\n"
 msgstr ""
 
-#: .././repair/phase2.c:128
-msgid "failed to clear log"
+#: .././repair/dinode.c:1835
+#, c-format
+msgid "correcting nblocks for inode %<PRIu64>, was %llu - counted %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/phase2.c:162
-msgid ""
-"This filesystem has an external log.  Specify log device with the -l "
-"option.\n"
+#: .././repair/dinode.c:1842
+#, c-format
+msgid "bad nblocks %llu for inode %<PRIu64>, would reset to %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/phase2.c:165
+#: .././repair/dinode.c:1850
 #, c-format
-msgid "Phase 2 - using external log on %s\n"
+msgid "too many data fork extents (%<PRIu64>) in inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/phase2.c:167
-msgid "Phase 2 - using internal log\n"
+#: .././repair/dinode.c:1857
+#, c-format
+msgid "correcting nextents for inode %<PRIu64>, was %d - counted %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/phase2.c:170
-msgid "        - zero log...\n"
+#: .././repair/dinode.c:1865
+#, c-format
+msgid "bad nextents %d for inode %<PRIu64>, would reset to %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/phase2.c:173
-msgid "        - scan filesystem freespace and inode maps...\n"
+#: .././repair/dinode.c:1873
+#, c-format
+msgid "too many attr fork extents (%<PRIu64>) in inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/phase2.c:189
-msgid "root inode chunk not found\n"
+#: .././repair/dinode.c:1880
+#, c-format
+msgid "correcting anextents for inode %<PRIu64>, was %d - counted %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/phase2.c:208
-msgid "        - found root inode chunk\n"
+#: .././repair/dinode.c:1887
+#, c-format
+msgid "bad anextents %d for inode %<PRIu64>, would reset to %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/phase2.c:214
-msgid "root inode marked free, "
+#: .././repair/dinode.c:1899
+#, c-format
+msgid "nblocks (%<PRIu64>) smaller than nextents for inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/phase2.c:217 .././repair/phase2.c:226 .././repair/phase2.c:235
-#: .././repair/dir2.c:842 .././repair/dir2.c:875
-msgid "correcting\n"
+#: .././repair/dinode.c:1964 .././repair/dinode.c:2002
+#, c-format
+msgid "unknown format %d, ino %<PRIu64> (mode = %d)\n"
 msgstr ""
 
-#: .././repair/phase2.c:219 .././repair/phase2.c:228 .././repair/phase2.c:237
-#: .././repair/dir2.c:846 .././repair/dir2.c:879
-msgid "would correct\n"
+#: .././repair/dinode.c:1969
+#, c-format
+msgid "bad data fork in inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/phase2.c:223
-msgid "realtime bitmap inode marked free, "
+#: .././repair/dinode.c:2040
+#, c-format
+msgid "bad attribute format %d in inode %<PRIu64>, "
 msgstr ""
 
-#: .././repair/phase2.c:232
-msgid "realtime summary inode marked free, "
+#: .././repair/dinode.c:2043
+msgid "resetting value\n"
 msgstr ""
 
-#: .././repair/phase3.c:47
-#, c-format
-msgid "cannot read agi block %<PRId64> for ag %u\n"
+#: .././repair/dinode.c:2047
+msgid "would reset value\n"
 msgstr ""
 
-#: .././repair/phase3.c:78 .././repair/phase6.c:3134 .././repair/phase5.c:2260
-#: .././repair/phase4.c:142
+#: .././repair/dinode.c:2077 .././repair/attr_repair.c:1177
 #, c-format
-msgid "        - agno = %d\n"
-msgstr ""
-
-#: .././repair/phase3.c:119
-msgid "Phase 3 - for each AG...\n"
+msgid "illegal attribute format %d, ino %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/phase3.c:121
-msgid "        - scan and clear agi unlinked lists...\n"
+#: .././repair/dinode.c:2092
+#, c-format
+msgid "bad attribute fork in inode %<PRIu64>"
 msgstr ""
 
-#: .././repair/phase3.c:123
-msgid "        - scan (but don't clear) agi unlinked lists...\n"
+#: .././repair/dinode.c:2096
+msgid ", clearing attr fork\n"
 msgstr ""
 
-#: .././repair/phase3.c:143
-msgid "        - process known inodes and perform inode discovery...\n"
+#: .././repair/dinode.c:2105
+msgid ", would clear attr fork\n"
 msgstr ""
 
-#: .././repair/phase3.c:154
-msgid "        - process newly discovered inodes...\n"
+#: .././repair/dinode.c:2133
+#, c-format
+msgid "illegal attribute fmt %d, ino %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/phase3.c:159
-msgid "no memory for uncertain inode counts\n"
+#: .././repair/dinode.c:2153
+#, c-format
+msgid "problem with attribute contents in inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/phase7.c:52 .././repair/phase6.c:2827 .././repair/phase6.c:2831
-#, c-format
-msgid "couldn't map inode %<PRIu64>, err = %d\n"
+#: .././repair/dinode.c:2161
+msgid "would clear attr fork\n"
 msgstr ""
 
-#: .././repair/phase7.c:56
+#: .././repair/dinode.c:2194
 #, c-format
-msgid "couldn't map inode %<PRIu64>, err = %d, can't compare link counts\n"
+msgid ""
+"clearing obsolete nlink field in version 2 inode %<PRIu64>, was %d, now 0\n"
 msgstr ""
 
-#: .././repair/phase7.c:68
+#: .././repair/dinode.c:2200
 #, c-format
-msgid "resetting inode %<PRIu64> nlinks from %u to %u\n"
+msgid ""
+"would clear obsolete nlink field in version 2 inode %<PRIu64>, currently %d\n"
 msgstr ""
 
-#: .././repair/phase7.c:74
+#: .././repair/dinode.c:2279
 #, c-format
-msgid "would have reset inode %<PRIu64> nlinks from %u to %u\n"
+msgid "bad CRC for inode %<PRIu64>%c"
 msgstr ""
 
-#: .././repair/phase7.c:142
-msgid "Phase 7 - verify and correct link counts...\n"
+#: .././repair/dinode.c:2283
+msgid " will rewrite\n"
 msgstr ""
 
-#: .././repair/phase7.c:144
-msgid "Phase 7 - verify link counts...\n"
+#: .././repair/dinode.c:2286
+msgid " would rewrite\n"
 msgstr ""
 
-#: .././repair/progress.c:16
-msgid "inodes"
+#: .././repair/dinode.c:2293
+#, c-format
+msgid "bad magic number 0x%x on inode %<PRIu64>%c"
 msgstr ""
 
-#: .././repair/progress.c:20
-msgid "directories"
+#: .././repair/dinode.c:2298
+msgid " resetting magic number\n"
 msgstr ""
 
-#: .././repair/progress.c:22
-msgid "allocation groups"
+#: .././repair/dinode.c:2302
+msgid " would reset magic number\n"
 msgstr ""
 
-#: .././repair/progress.c:24
-msgid "AGI unlinked buckets"
+#: .././repair/dinode.c:2309
+#, c-format
+msgid "bad version number 0x%x on inode %<PRIu64>%c"
 msgstr ""
 
-#: .././repair/progress.c:28
-msgid "realtime extents"
+#: .././repair/dinode.c:2314
+msgid " resetting version number\n"
 msgstr ""
 
-#: .././repair/progress.c:30
-msgid "unlinked lists"
+#: .././repair/dinode.c:2319
+msgid " would reset version number\n"
 msgstr ""
 
-#: .././repair/progress.c:37
+#: .././repair/dinode.c:2332
 #, c-format
-msgid "        - %02d:%02d:%02d: %s - %llu of %llu %s done\n"
+msgid "inode identifier %llu mismatch on inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/progress.c:39
+#: .././repair/dinode.c:2343
 #, c-format
-msgid "        - %02d:%02d:%02d: %s - %llu %s done\n"
+msgid "UUID mismatch on inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/progress.c:51
-msgid "scanning filesystem freespace"
+#: .././repair/dinode.c:2356
+#, c-format
+msgid "bad (negative) size %<PRId64> on inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/progress.c:53
-msgid "scanning agi unlinked lists"
+#: .././repair/dinode.c:2389
+#, c-format
+msgid "imap claims a free inode %<PRIu64> is in use, "
 msgstr ""
 
-#: .././repair/progress.c:55
-msgid "check uncertain AG inodes"
+#: .././repair/dinode.c:2391
+msgid "correcting imap and clearing inode\n"
 msgstr ""
 
-#: .././repair/progress.c:57
-msgid "process known inodes and inode discovery"
+#: .././repair/dinode.c:2395
+msgid "would correct imap and clear inode\n"
 msgstr ""
 
-#: .././repair/progress.c:59
-msgid "process newly discovered inodes"
+#: .././repair/dinode.c:2412
+#, c-format
+msgid "bad inode format in inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/progress.c:61
-msgid "setting up duplicate extent list"
+#: .././repair/dinode.c:2428
+#, c-format
+msgid "Bad flags set in inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/progress.c:63
-msgid "initialize realtime bitmap"
+#: .././repair/dinode.c:2439
+#, c-format
+msgid "inode %<PRIu64> has RT flag set but there is no RT device\n"
 msgstr ""
 
-#: .././repair/progress.c:65
-msgid "reset realtime bitmaps"
+#: .././repair/dinode.c:2451
+#, c-format
+msgid "inode %<PRIu64> not rt bitmap\n"
 msgstr ""
 
-#: .././repair/progress.c:67
-msgid "check for inodes claiming duplicate blocks"
+#: .././repair/dinode.c:2465
+#, c-format
+msgid "directory flags set on non-directory inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/progress.c:69
-msgid "rebuild AG headers and trees"
+#: .././repair/dinode.c:2479
+#, c-format
+msgid "file flags set on non-file inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/progress.c:71
-msgid "traversing filesystem"
+#: .././repair/dinode.c:2488
+msgid "fixing bad flags.\n"
 msgstr ""
 
-#: .././repair/progress.c:73
-msgid "traversing all unattached subtrees"
+#: .././repair/dinode.c:2492
+msgid "would fix bad flags.\n"
 msgstr ""
 
-#: .././repair/progress.c:75
-msgid "moving disconnected inodes to lost+found"
+#: .././repair/dinode.c:2507
+#, c-format
+msgid "Bad flags2 set in inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/progress.c:77
-msgid "verify and correct link counts"
+#: .././repair/dinode.c:2518
+#, c-format
+msgid "DAX flag set on special inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/progress.c:79
-msgid "verify link counts"
+#: .././repair/dinode.c:2529
+#, c-format
+msgid ""
+"inode %<PRIu64> is marked reflinked but file system does not support "
+"reflink\n"
 msgstr ""
 
-#: .././repair/progress.c:118
-msgid "cannot malloc pointer to done vector\n"
+#: .././repair/dinode.c:2540
+#, c-format
+msgid "reflink flag set on non-file inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/progress.c:135
-msgid "unable to create progress report thread\n"
+#: .././repair/dinode.c:2551
+#, c-format
+msgid "Cannot have a reflinked realtime inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/progress.c:178
-msgid "progress_rpt: cannot malloc progress msg buffer\n"
+#: .././repair/dinode.c:2561
+#, c-format
+msgid ""
+"inode %<PRIu64> has CoW extent size hint but file system does not support "
+"reflink\n"
 msgstr ""
 
-#: .././repair/progress.c:191
-msgid "progress_rpt: cannot create timer\n"
+#: .././repair/dinode.c:2572
+#, c-format
+msgid "CoW extent size flag set on non-file, non-directory inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/progress.c:194
-msgid "progress_rpt: cannot set timer\n"
+#: .././repair/dinode.c:2583
+#, c-format
+msgid "Cannot have CoW extent size hint on a realtime inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/progress.c:218
-msgid "progress_rpt: cannot lock progress mutex\n"
+#: .././repair/dinode.c:2591
+msgid "fixing bad flags2.\n"
 msgstr ""
 
-#: .././repair/progress.c:255 .././repair/progress.c:358
-#, c-format
-msgid "%s"
+#: .././repair/dinode.c:2595
+msgid "would fix bad flags2.\n"
 msgstr ""
 
-#: .././repair/progress.c:263
+#: .././repair/dinode.c:2646
 #, c-format
-msgid ""
-"\t- %02d:%02d:%02d: Phase %d: elapsed time %s - processed %d %s per minute\n"
+msgid "bad inode type %#o inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/progress.c:268
+#: .././repair/dinode.c:2670
 #, c-format
-msgid ""
-"\t- %02d:%02d:%02d: Phase %d: %<PRIu64>%% done - estimated remaining time %"
-"s\n"
+msgid "bad non-zero extent size %u for non-realtime/extsize inode %<PRIu64>, "
 msgstr ""
 
-#: .././repair/progress.c:276
-msgid "progress_rpt: error unlock msg mutex\n"
+#: .././repair/dinode.c:2673 .././repair/dinode.c:2696
+msgid "resetting to zero\n"
 msgstr ""
 
-#: .././repair/progress.c:282
-msgid "cannot delete timer\n"
+#: .././repair/dinode.c:2677 .././repair/dinode.c:2701
+msgid "would reset to zero\n"
 msgstr ""
 
-#: .././repair/progress.c:296
-msgid "set_progress_msg: cannot lock progress mutex\n"
+#: .././repair/dinode.c:2693
+#, c-format
+msgid ""
+"Cannot have non-zero CoW extent size %u on non-cowextsize inode %<PRIu64>, "
 msgstr ""
 
-#: .././repair/progress.c:306
-msgid "set_progress_msg: cannot unlock progress mutex\n"
+#: .././repair/dinode.c:2712
+#, c-format
+msgid "Cannot have CoW extent size of zero on cowextsize inode %<PRIu64>, "
 msgstr ""
 
-#: .././repair/progress.c:326
-msgid "print_final_rpt: cannot lock progress mutex\n"
+#: .././repair/dinode.c:2715
+msgid "clearing cowextsize flag\n"
 msgstr ""
 
-#: .././repair/progress.c:362
-msgid "print_final_rpt: cannot unlock progress mutex\n"
+#: .././repair/dinode.c:2719
+msgid "would clear cowextsize flag\n"
 msgstr ""
 
-#: .././repair/progress.c:411
+#: .././repair/dinode.c:2778
 #, c-format
-msgid "%02d:%02d:%02d"
+msgid "problem with directory contents in inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/progress.c:433
+#: .././repair/dinode.c:2786
 #, c-format
-msgid "%d week"
+msgid "problem with symbolic link in inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/progress.c:434 .././repair/progress.c:444
-#: .././repair/progress.c:460 .././repair/progress.c:478
-#: .././repair/progress.c:493
-msgid "s"
+#: .././repair/dinode.c:2881
+#, c-format
+msgid "processing inode %d/%d\n"
 msgstr ""
 
-#: .././repair/progress.c:443
+#: .././repair/phase7.c:56
 #, c-format
-msgid "%d day"
+msgid "couldn't map inode %<PRIu64>, err = %d, can't compare link counts\n"
 msgstr ""
 
-#: .././repair/progress.c:450 .././repair/progress.c:467
-#: .././repair/progress.c:485 .././repair/progress.c:495
-msgid ", "
+#: .././repair/phase7.c:68
+#, c-format
+msgid "resetting inode %<PRIu64> nlinks from %u to %u\n"
 msgstr ""
 
-#: .././repair/progress.c:459
+#: .././repair/phase7.c:74
 #, c-format
-msgid "%d hour"
+msgid "would have reset inode %<PRIu64> nlinks from %u to %u\n"
 msgstr ""
 
-#: .././repair/progress.c:477
-#, c-format
-msgid "%d minute"
+#: .././repair/phase7.c:142
+msgid "Phase 7 - verify and correct link counts...\n"
 msgstr ""
 
-#: .././repair/progress.c:492
+#: .././repair/phase7.c:144
+msgid "Phase 7 - verify link counts...\n"
+msgstr ""
+
+#: .././repair/agheader.c:40
 #, c-format
-msgid "%d second"
+msgid "bad magic # 0x%x for agf %d\n"
 msgstr ""
 
-#: .././repair/progress.c:513
+#: .././repair/agheader.c:49
 #, c-format
-msgid ""
-"\n"
-"        XFS_REPAIR Summary    %s\n"
+msgid "bad version # %d for agf %d\n"
 msgstr ""
 
-#: .././repair/progress.c:515
-msgid "Phase\t\tStart\t\tEnd\t\tDuration\n"
+#: .././repair/agheader.c:58
+#, c-format
+msgid "bad sequence # %d for agf %d\n"
 msgstr ""
 
-#: .././repair/progress.c:520 .././repair/progress.c:523
+#: .././repair/agheader.c:68
 #, c-format
-msgid "Phase %d:\tSkipped\n"
+msgid "bad length %d for agf %d, should be %d\n"
 msgstr ""
 
-#: .././repair/progress.c:527
+#: .././repair/agheader.c:81
 #, c-format
-msgid "Phase %d:\t%02d/%02d %02d:%02d:%02d\t%02d/%02d %02d:%02d:%02d\t%s\n"
+msgid "bad length %d for agf %d, should be %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/progress.c:533
+#: .././repair/agheader.c:95
 #, c-format
-msgid ""
-"\n"
-"Total run time: %s\n"
+msgid "flfirst %d in agf %d too large (max = %zu)\n"
 msgstr ""
 
-#: .././repair/rt.c:47
-msgid "couldn't allocate memory for incore realtime bitmap.\n"
+#: .././repair/agheader.c:103
+#, c-format
+msgid "fllast %d in agf %d too large (max = %zu)\n"
 msgstr ""
 
-#: .././repair/rt.c:51
-msgid "couldn't allocate memory for incore realtime summary info.\n"
+#: .././repair/agheader.c:120
+#, c-format
+msgid "bad uuid %s for agf %d\n"
 msgstr ""
 
-#: .././repair/rt.c:203
+#: .././repair/agheader.c:139
 #, c-format
-msgid "can't find block %d for rtbitmap inode\n"
+msgid "bad magic # 0x%x for agi %d\n"
 msgstr ""
 
-#: .././repair/rt.c:211
+#: .././repair/agheader.c:148
 #, c-format
-msgid "can't read block %d for rtbitmap inode\n"
+msgid "bad version # %d for agi %d\n"
 msgstr ""
 
-#: .././repair/rt.c:265
+#: .././repair/agheader.c:157
 #, c-format
-msgid "block %d for rtsummary inode is missing\n"
+msgid "bad sequence # %d for agi %d\n"
 msgstr ""
 
-#: .././repair/rt.c:273
+#: .././repair/agheader.c:167
 #, c-format
-msgid "can't read block %d for rtsummary inode\n"
+msgid "bad length # %d for agi %d, should be %d\n"
 msgstr ""
 
-#: .././repair/threads.c:90
+#: .././repair/agheader.c:180
 #, c-format
-msgid "cannot create worker threads, error = [%d] %s\n"
+msgid "bad length # %d for agi %d, should be %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/threads.c:108
+#: .././repair/agheader.c:199
 #, c-format
-msgid "cannot allocate worker item, error = [%d] %s\n"
+msgid "bad uuid %s for agi %d\n"
 msgstr ""
 
-#: .././repair/versions.c:68
+#: .././repair/agheader.c:305
 #, c-format
-msgid "bogus quota flags 0x%x set in superblock"
+msgid "zeroing unused portion of %s superblock (AG #%u)\n"
 msgstr ""
 
-#: .././repair/versions.c:74
-msgid ", bogus flags will be cleared\n"
+#: .././repair/agheader.c:306 .././repair/agheader.c:324
+msgid "primary"
 msgstr ""
 
-#: .././repair/versions.c:76
-msgid ", bogus flags would be cleared\n"
+#: .././repair/agheader.c:306 .././repair/agheader.c:324
+msgid "secondary"
 msgstr ""
 
-#: .././repair/versions.c:115 .././repair/versions.c:120
-#: .././repair/versions.c:125
-msgid "Shared Version bit set. Not supported. Ever.\n"
+#: .././repair/agheader.c:323
+#, c-format
+msgid "would zero unused portion of %s superblock (AG #%u)\n"
 msgstr ""
 
-#: .././repair/versions.c:138
-msgid "This filesystem has uninitialized extent flags.\n"
+#: .././repair/agheader.c:341
+#, c-format
+msgid "bad flags field in superblock %d\n"
 msgstr ""
 
-#: .././repair/versions.c:144
-msgid ""
-"This filesystem uses feature(s) not yet supported in this release.\n"
-"Please run a more recent version of xfs_repair.\n"
+#: .././repair/agheader.c:364
+#, c-format
+msgid "non-null user quota inode field in superblock %d\n"
 msgstr ""
 
-#: .././repair/versions.c:150
+#: .././repair/agheader.c:379
 #, c-format
-msgid "WARNING:  unknown superblock version %d\n"
+msgid "non-null group quota inode field in superblock %d\n"
 msgstr ""
 
-#: .././repair/versions.c:153
-msgid "This filesystem contains features not understood by this program.\n"
+#: .././repair/agheader.c:400
+#, c-format
+msgid "non-null project quota inode field in superblock %d\n"
 msgstr ""
 
-#: .././repair/versions.c:161
-msgid ""
-"WARNING:  you have disallowed superblock-feature-bits-allowed\n"
-"\tbut this superblock has feature bits.  The superblock\n"
-"\twill be downgraded.  This may cause loss of filesystem meta-data\n"
+#: .././repair/agheader.c:412
+#, c-format
+msgid "non-null quota flags in superblock %d\n"
 msgstr ""
 
-#: .././repair/versions.c:166
-msgid ""
-"WARNING:  you have disallowed superblock-feature-bits-allowed\n"
-"\tbut this superblock has feature bits.  The superblock\n"
-"\twould be downgraded.  This might cause loss of filesystem\n"
-"\tmeta-data.\n"
+#: .././repair/agheader.c:430
+#, c-format
+msgid "bad inode alignment field in superblock %d\n"
 msgstr ""
 
-#: .././repair/versions.c:182
+#: .././repair/agheader.c:443
 #, c-format
-msgid ""
-"Superblock has unknown compat/rocompat/incompat features (0x%x/0x%x/0x%x).\n"
-"Using a more recent xfs_repair is recommended.\n"
+msgid "bad stripe unit/width fields in superblock %d\n"
 msgstr ""
 
-#: .././repair/versions.c:194
-msgid ""
-"WARNING:  you have disallowed attributes but this filesystem\n"
-"\thas attributes.  The filesystem will be downgraded and\n"
-"\tall attributes will be removed.\n"
+#: .././repair/agheader.c:461
+#, c-format
+msgid "bad log/data device sector size fields in superblock %d\n"
 msgstr ""
 
-#: .././repair/versions.c:199
-msgid ""
-"WARNING:  you have disallowed attributes but this filesystem\n"
-"\thas attributes.  The filesystem would be downgraded and\n"
-"\tall attributes would be removed.\n"
+#: .././repair/agheader.c:492
+#, c-format
+msgid "bad on-disk superblock %d - %s\n"
 msgstr ""
 
-#: .././repair/versions.c:212
-msgid ""
-"WARNING:  you have disallowed attr2 attributes but this filesystem\n"
-"\thas attributes.  The filesystem will be downgraded and\n"
-"\tall attr2 attributes will be removed.\n"
+#: .././repair/agheader.c:499
+#, c-format
+msgid "primary/secondary superblock %d conflict - %s\n"
 msgstr ""
 
-#: .././repair/versions.c:217
-msgid ""
-"WARNING:  you have disallowed attr2 attributes but this filesystem\n"
-"\thas attributes.  The filesystem would be downgraded and\n"
-"\tall attr2 attributes would be removed.\n"
+#: .././repair/dir2.c:50
+#, c-format
+msgid "malloc failed (%zu bytes) dir2_add_badlist:ino %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/versions.c:229
-msgid ""
-"WARNING: you have a V1 inode filesystem. It will be converted to a\n"
-"\tversion 2 inode filesystem. If you do not want this, run an older\n"
-"\tversion of xfs_repair.\n"
+#: .././repair/dir2.c:93
+msgid "couldn't malloc dir2 shortform copy\n"
 msgstr ""
 
-#: .././repair/versions.c:234
-msgid ""
-"WARNING: you have a V1 inode filesystem. It would be converted to a\n"
-"\tversion 2 inode filesystem. If you do not want this, run an older\n"
-"\tversion of xfs_repair.\n"
+#: .././repair/dir2.c:229
+msgid "current"
 msgstr ""
 
-#: .././repair/versions.c:244
-msgid ""
-"WARNING:  you have disallowed quotas but this filesystem\n"
-"\thas quotas.  The filesystem will be downgraded and\n"
-"\tall quota information will be removed.\n"
+#: .././repair/dir2.c:232 .././repair/dir2.c:693
+msgid "invalid"
 msgstr ""
 
-#: .././repair/versions.c:249
-msgid ""
-"WARNING:  you have disallowed quotas but this filesystem\n"
-"\thas quotas.  The filesystem would be downgraded and\n"
-"\tall quota information would be removed.\n"
+#: .././repair/dir2.c:235 .././repair/dir2.c:695
+msgid "realtime bitmap"
 msgstr ""
 
-#: .././repair/versions.c:277
-msgid ""
-"WARNING:  you have disallowed aligned inodes but this filesystem\n"
-"\thas aligned inodes.  The filesystem will be downgraded.\n"
-"\tThis will permanently degrade the performance of this filesystem.\n"
+#: .././repair/dir2.c:238 .././repair/dir2.c:697
+msgid "realtime summary"
 msgstr ""
 
-#: .././repair/versions.c:282
-msgid ""
-"WARNING:  you have disallowed aligned inodes but this filesystem\n"
-"\thas aligned inodes.  The filesystem would be downgraded.\n"
-"\tThis would permanently degrade the performance of this filesystem.\n"
+#: .././repair/dir2.c:241 .././repair/dir2.c:699
+msgid "user quota"
 msgstr ""
 
-#: .././repair/phase6.c:64
-#, c-format
-msgid "malloc failed add_dotdot_update (%zu bytes)\n"
+#: .././repair/dir2.c:244 .././repair/dir2.c:701
+msgid "group quota"
 msgstr ""
 
-#: .././repair/phase6.c:216
-#, c-format
-msgid "malloc failed in dir_hash_add (%zu bytes)\n"
+#: .././repair/dir2.c:247 .././repair/dir2.c:703
+msgid "project quota"
 msgstr ""
 
-#: .././repair/phase6.c:270
-msgid "ok"
+#: .././repair/dir2.c:265 .././repair/dir2.c:733
+msgid "free"
 msgstr ""
 
-#: .././repair/phase6.c:271
-msgid "duplicate leaf"
+#: .././repair/dir2.c:282 .././repair/dir2.c:713
+msgid "non-existent"
 msgstr ""
 
-#: .././repair/phase6.c:272
-msgid "hash value mismatch"
+#: .././repair/dir2.c:287
+#, c-format
+msgid ""
+"entry \"%*.*s\" in shortform directory %<PRIu64> references %s inode "
+"%<PRIu64>\n"
 msgstr ""
 
-#: .././repair/phase6.c:273
-msgid "no data entry"
+#: .././repair/dir2.c:293
+msgid "is zero length"
 msgstr ""
 
-#: .././repair/phase6.c:274
-msgid "no leaf entry"
+#: .././repair/dir2.c:298
+msgid "extends past end of dir"
 msgstr ""
 
-#: .././repair/phase6.c:275
-msgid "bad stale count"
+#: .././repair/dir2.c:304
+#, c-format
+msgid "entry #%d %s in shortform dir %<PRIu64>"
 msgstr ""
 
-#: .././repair/phase6.c:283
+#: .././repair/dir2.c:307
 #, c-format
-msgid "bad hash table for directory inode %<PRIu64> (%s): "
+msgid ", junking %d entries\n"
 msgstr ""
 
-#: .././repair/phase6.c:286
-msgid "rebuilding\n"
+#: .././repair/dir2.c:310
+#, c-format
+msgid ", would junk %d entries\n"
 msgstr ""
 
-#: .././repair/phase6.c:288
-msgid "would rebuild\n"
+#: .././repair/dir2.c:330
+#, c-format
+msgid "entry contains illegal character in shortform dir %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/phase6.c:324
-msgid "calloc failed in dir_hash_init\n"
+#: .././repair/dir2.c:337
+#, c-format
+msgid "entry contains offset out of order in shortform dir %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/phase6.c:472
-msgid "ran out of disk space!\n"
+#: .././repair/dir2.c:394
+#, c-format
+msgid "junking entry \"%s\" in directory inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/phase6.c:474
+#: .././repair/dir2.c:398
 #, c-format
-msgid "xfs_trans_reserve returned %d\n"
+msgid "would have junked entry \"%s\" in directory inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/phase6.c:504 .././repair/phase6.c:606
+#: .././repair/dir2.c:423
 #, c-format
-msgid "couldn't iget realtime bitmap inode -- error - %d\n"
+msgid "would have corrected entry count in directory %<PRIu64> from %d to %d\n"
 msgstr ""
 
-#: .././repair/phase6.c:562
+#: .././repair/dir2.c:427
 #, c-format
-msgid "couldn't allocate realtime bitmap, error = %d\n"
+msgid "corrected entry count in directory %<PRIu64>, was %d, now %d\n"
 msgstr ""
 
-#: .././repair/phase6.c:575
+#: .././repair/dir2.c:438
 #, c-format
-msgid "allocation of the realtime bitmap failed, error = %d\n"
+msgid "would have corrected i8 count in directory %<PRIu64> from %d to %d\n"
 msgstr ""
 
-#: .././repair/phase6.c:620
+#: .././repair/dir2.c:442
 #, c-format
-msgid "couldn't map realtime bitmap block %<PRIu64>, error = %d\n"
+msgid "corrected i8 count in directory %<PRIu64>, was %d, now %d\n"
 msgstr ""
 
-#: .././repair/phase6.c:633
+#: .././repair/dir2.c:456
 #, c-format
 msgid ""
-"can't access block %<PRIu64> (fsbno %<PRIu64>) of realtime bitmap inode %"
-"<PRIu64>\n"
+"would have corrected directory %<PRIu64> size from %<PRId64> to %<PRIdPTR>\n"
 msgstr ""
 
-#: .././repair/phase6.c:677 .././repair/phase6.c:751
+#: .././repair/dir2.c:461
 #, c-format
-msgid "couldn't iget realtime summary inode -- error - %d\n"
+msgid "corrected directory %<PRIu64> size, was %<PRId64>, now %<PRIdPTR>\n"
 msgstr ""
 
-#: .././repair/phase6.c:691
+#: .././repair/dir2.c:473
 #, c-format
-msgid "couldn't map realtime summary inode block %<PRIu64>, error = %d\n"
+msgid "directory %<PRIu64> offsets too high\n"
 msgstr ""
 
-#: .././repair/phase6.c:704
+#: .././repair/dir2.c:479
 #, c-format
-msgid ""
-"can't access block %<PRIu64> (fsbno %<PRIu64>) of realtime summary inode %"
-"<PRIu64>\n"
+msgid "would have corrected entry offsets in directory %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/phase6.c:814
+#: .././repair/dir2.c:483
 #, c-format
-msgid "couldn't allocate realtime summary inode, error = %d\n"
+msgid "corrected entry offsets in directory %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/phase6.c:827
+#: .././repair/dir2.c:502
 #, c-format
-msgid "allocation of the realtime summary ino failed, error = %d\n"
+msgid "bogus .. inode number (%<PRIu64>) in directory inode %<PRIu64>, "
 msgstr ""
 
-#: .././repair/phase6.c:856
-#, c-format
-msgid "could not iget root inode -- error - %d\n"
+#: .././repair/dir2.c:506 .././repair/dir2.c:541
+msgid "clearing inode number\n"
 msgstr ""
 
-#: .././repair/phase6.c:933
-#, c-format
-msgid "%d - couldn't iget root inode to obtain %s\n"
+#: .././repair/dir2.c:512 .././repair/dir2.c:547
+msgid "would clear inode number\n"
 msgstr ""
 
-#: .././repair/phase6.c:963
+#: .././repair/dir2.c:520
 #, c-format
-msgid "%s inode allocation failed %d\n"
+msgid ""
+"corrected root directory %<PRIu64> .. entry, was %<PRIu64>, now %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/phase6.c:1010
+#: .././repair/dir2.c:528
 #, c-format
-msgid "can't make %s, createname error %d\n"
+msgid ""
+"would have corrected root directory %<PRIu64> .. entry from %<PRIu64> to "
+"%<PRIu64>\n"
 msgstr ""
 
-#: .././repair/phase6.c:1030
+#: .././repair/dir2.c:538
 #, c-format
-msgid "%s directory creation failed -- bmapf error %d\n"
+msgid "bad .. entry in directory inode %<PRIu64>, points to self, "
 msgstr ""
 
-#: .././repair/phase6.c:1072
+#: .././repair/dir2.c:651
 #, c-format
-msgid "%d - couldn't iget orphanage inode\n"
+msgid "corrupt block %u in directory inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/phase6.c:1083
-#, c-format
-msgid "%d - couldn't iget disconnected inode\n"
+#: .././repair/dir2.c:654
+msgid "\twill junk block\n"
 msgstr ""
 
-#: .././repair/phase6.c:1104 .././repair/phase6.c:1146
-#: .././repair/phase6.c:1202
-#, c-format
-msgid "space reservation failed (%d), filesystem may be out of space\n"
+#: .././repair/dir2.c:656
+msgid "\twould junk block\n"
 msgstr ""
 
-#: .././repair/phase6.c:1115 .././repair/phase6.c:1158
-#: .././repair/phase6.c:1213
+#: .././repair/dir2.c:742
 #, c-format
-msgid "name create failed in %s (%d), filesystem may be out of space\n"
+msgid ""
+"entry \"%*.*s\" at block %d offset %<PRIdPTR> in directory inode %<PRIu64> "
+"references %s inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/phase6.c:1128
+#: .././repair/dir2.c:765
 #, c-format
-msgid "creation of .. entry failed (%d), filesystem may be out of space\n"
+msgid ""
+"entry at block %u offset %<PRIdPTR> in directory inode %<PRIu64>has 0 "
+"namelength\n"
 msgstr ""
 
-#: .././repair/phase6.c:1137
+#: .././repair/dir2.c:778
 #, c-format
-msgid "bmap finish failed (err - %d), filesystem may be out of space\n"
+msgid "\tclearing inode number in entry at offset %<PRIdPTR>...\n"
 msgstr ""
 
-#: .././repair/phase6.c:1177
+#: .././repair/dir2.c:784
 #, c-format
-msgid "name replace op failed (%d), filesystem may be out of space\n"
+msgid "\twould clear inode number in entry at offset %<PRIdPTR>...\n"
 msgstr ""
 
-#: .././repair/phase6.c:1184 .././repair/phase6.c:1223
-#: .././repair/phase6.c:1357
+#: .././repair/dir2.c:797
 #, c-format
-msgid "bmap finish failed (%d), filesystem may be out of space\n"
+msgid ""
+"entry at block %u offset %<PRIdPTR> in directory inode %<PRIu64> has illegal "
+"name \"%*.*s\": "
 msgstr ""
 
-#: .././repair/phase6.c:1242
-msgid ", marking entry to be junked\n"
+#: .././repair/dir2.c:828
+#, c-format
+msgid "bad .. entry in directory inode %<PRIu64>, points to self: "
 msgstr ""
 
-#: .././repair/phase6.c:1246
-msgid ", would junk entry\n"
+#: .././repair/dir2.c:839
+#, c-format
+msgid "bad .. entry in root directory inode %<PRIu64>, was %<PRIu64>: "
 msgstr ""
 
-#: .././repair/phase6.c:1279
-#, c-format
-msgid "rebuilding directory inode %<PRIu64>\n"
+#: .././repair/dir2.c:842 .././repair/dir2.c:875 .././repair/phase2.c:222
+#: .././repair/phase2.c:231 .././repair/phase2.c:240
+msgid "correcting\n"
 msgstr ""
 
-#: .././repair/phase6.c:1301
-#, c-format
-msgid "xfs_bmap_last_offset failed -- error - %d\n"
+#: .././repair/dir2.c:846 .././repair/dir2.c:879 .././repair/phase2.c:224
+#: .././repair/phase2.c:233 .././repair/phase2.c:242
+msgid "would correct\n"
 msgstr ""
 
-#: .././repair/phase6.c:1308
+#: .././repair/dir2.c:859
 #, c-format
-msgid "xfs_bunmapi failed -- error - %d\n"
+msgid "multiple .. entries in directory inode %<PRIu64>: "
 msgstr ""
 
-#: .././repair/phase6.c:1316
+#: .././repair/dir2.c:872
 #, c-format
-msgid "xfs_dir_init failed -- error - %d\n"
+msgid "bad . entry in directory inode %<PRIu64>, was %<PRIu64>: "
 msgstr ""
 
-#: .././repair/phase6.c:1349
+#: .././repair/dir2.c:884
 #, c-format
-msgid ""
-"name create failed in ino %<PRIu64> (%d), filesystem may be out of space\n"
+msgid "multiple . entries in directory inode %<PRIu64>: "
 msgstr ""
 
-#: .././repair/phase6.c:1412
+#: .././repair/dir2.c:894
 #, c-format
-msgid "shrink_inode failed inode %<PRIu64> block %u\n"
+msgid "entry \"%*.*s\" in directory inode %<PRIu64> points to self: "
 msgstr ""
 
-#: .././repair/phase6.c:1503 .././repair/phase6.c:2300
-#, c-format
-msgid "realloc failed in %s (%zu bytes)\n"
+#: .././repair/dir2.c:905
+msgid "clearing entry\n"
 msgstr ""
 
-#: .././repair/phase6.c:1560
-#, c-format
-msgid "empty data block %u in directory inode %<PRIu64>: "
+#: .././repair/dir2.c:907
+msgid "would clear entry\n"
 msgstr ""
 
-#: .././repair/phase6.c:1564
+#: .././repair/dir2.c:920
 #, c-format
-msgid "corrupt block %u in directory inode %<PRIu64>: "
+msgid "bad bestfree table in block %u in directory inode %<PRIu64>: "
 msgstr ""
 
-#: .././repair/phase6.c:1568
-msgid "junking block\n"
+#: .././repair/dir2.c:923
+msgid "repairing table\n"
 msgstr ""
 
-#: .././repair/phase6.c:1571
-msgid "would junk block\n"
+#: .././repair/dir2.c:928
+msgid "would repair table\n"
 msgstr ""
 
-#: .././repair/phase6.c:1593
+#: .././repair/dir2.c:968
 #, c-format
-msgid ""
-"bad directory block magic # %#x for directory inode %<PRIu64> block %d: "
+msgid "block %u for directory inode %<PRIu64> is missing\n"
 msgstr ""
 
-#: .././repair/phase6.c:1596
+#: .././repair/dir2.c:977
 #, c-format
-msgid "fixing magic # to %#x\n"
+msgid "can't read block %u for directory inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/phase6.c:1600
+#: .././repair/dir2.c:988
 #, c-format
-msgid "would fix magic # to %#x\n"
+msgid ""
+"bad directory block magic # %#x in block %u for directory inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/phase6.c:1621
+#: .././repair/dir2.c:1040
 #, c-format
-msgid "directory inode %<PRIu64> block %u has consecutive free entries: "
-msgstr ""
-
-#: .././repair/phase6.c:1625
-msgid "joining together\n"
+msgid "bad entry count in block %u of directory inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/phase6.c:1634
-msgid "would join together\n"
+#: .././repair/dir2.c:1048
+#, c-format
+msgid "bad hash ordering in block %u of directory inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/phase6.c:1667
+#: .././repair/dir2.c:1056
 #, c-format
-msgid ""
-"entry \"%s\" in directory inode %<PRIu64> points to non-existent inode %"
-"<PRIu64>"
+msgid "bad stale count in block %u of directory inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/phase6.c:1684
+#: .././repair/dir2.c:1105
 #, c-format
-msgid ""
-"entry \"%s\" in directory inode %<PRIu64> points to free inode %<PRIu64>"
+msgid "can't map block %u for directory inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/phase6.c:1702 .././repair/phase6.c:2627
+#: .././repair/dir2.c:1115
 #, c-format
-msgid "%s (ino %<PRIu64>) in root (%<PRIu64>) is not a directory"
+msgid "can't read file block %u for directory inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/phase6.c:1724 .././repair/phase6.c:2649
+#: .././repair/dir2.c:1127
 #, c-format
-msgid "entry \"%s\" (ino %<PRIu64>) in dir %<PRIu64> is a duplicate name"
+msgid "bad directory leaf magic # %#x for directory inode %<PRIu64> block %u\n"
 msgstr ""
 
-#: .././repair/phase6.c:1755
+#: .././repair/dir2.c:1155
 #, c-format
-msgid ""
-"entry \"%s\" (ino %<PRIu64>) in dir %<PRIu64> is not in the the first block"
+msgid "bad sibling back pointer for block %u in directory inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/phase6.c:1781
+#: .././repair/dir2.c:1186
 #, c-format
-msgid "entry \"%s\" in dir %<PRIu64> is not the first entry"
+msgid "bad hash path in directory %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/phase6.c:1807 .././repair/phase6.c:2718
+#: .././repair/dir2.c:1296
 #, c-format
-msgid ""
-"would fix ftype mismatch (%d/%d) in directory/child inode %<PRIu64>/%"
-"<PRIu64>\n"
+msgid "block %<PRIu64> for directory inode %<PRIu64> is missing\n"
 msgstr ""
 
-#: .././repair/phase6.c:1812 .././repair/phase6.c:2723
+#: .././repair/dir2.c:1305
 #, c-format
-msgid ""
-"fixing ftype mismatch (%d/%d) in directory/child inode %<PRIu64>/%<PRIu64>\n"
+msgid "can't read block %<PRIu64> for directory inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/phase6.c:1845
+#: .././repair/dir2.c:1313
 #, c-format
 msgid ""
-"entry \"%s\" in dir %<PRIu64> points to an already connected directory inode "
+"bad directory block magic # %#x in block %<PRIu64> for directory inode "
 "%<PRIu64>\n"
 msgstr ""
 
-#: .././repair/phase6.c:1854 .././repair/phase6.c:2687
+#: .././repair/dir2.c:1394
 #, c-format
-msgid ""
-"entry \"%s\" in dir ino %<PRIu64> doesn't have a .. entry, will set it in "
-"ino %<PRIu64>.\n"
+msgid "bad size/format for directory %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/phase6.c:1864
+#: .././repair/dir2.c:1401
 #, c-format
-msgid ""
-"entry \"%s\" in dir inode %<PRIu64> inconsistent with .. value (%<PRIu64>) "
-"in ino %<PRIu64>\n"
+msgid "no . entry for directory %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/phase6.c:1876
+#: .././repair/dir2.c:1411
 #, c-format
-msgid "\twill clear entry \"%s\"\n"
+msgid "no .. entry for directory %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/phase6.c:1879
+#: .././repair/dir2.c:1413
 #, c-format
-msgid "\twould clear entry \"%s\"\n"
+msgid "no .. entry for root directory %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/phase6.c:1912
+#: .././repair/phase3.c:47
 #, c-format
-msgid "expected owner inode %<PRIu64>, got %llu, directory block %<PRIu64>\n"
+msgid "cannot read agi block %<PRId64> for ag %u\n"
 msgstr ""
 
-#: .././repair/phase6.c:1919
-#, c-format
-msgid "expected block %<PRIu64>, got %llu, directory inode %<PRIu64>\n"
+#: .././repair/phase3.c:119
+msgid "Phase 3 - for each AG...\n"
 msgstr ""
 
-#: .././repair/phase6.c:1926
-#, c-format
-msgid "wrong FS UUID, directory inode %<PRIu64> block %<PRIu64>\n"
+#: .././repair/phase3.c:121
+msgid "        - scan and clear agi unlinked lists...\n"
 msgstr ""
 
-#: .././repair/phase6.c:1986
-#, c-format
-msgid "leaf block %u for directory inode %<PRIu64> bad CRC\n"
+#: .././repair/phase3.c:123
+msgid "        - scan (but don't clear) agi unlinked lists...\n"
 msgstr ""
 
-#: .././repair/phase6.c:1991
-#, c-format
-msgid "can't read block %u for directory inode %<PRIu64>, error %d\n"
+#: .././repair/phase3.c:143
+msgid "        - process known inodes and perform inode discovery...\n"
 msgstr ""
 
-#: .././repair/phase6.c:2009 .././repair/phase6.c:2132
-#, c-format
-msgid "leaf block %u for directory inode %<PRIu64> bad header\n"
+#: .././repair/phase3.c:154
+msgid "        - process newly discovered inodes...\n"
 msgstr ""
 
-#: .././repair/phase6.c:2035
-#, c-format
-msgid "leaf block %u for directory inode %<PRIu64> bad tail\n"
+#: .././repair/phase3.c:159
+msgid "no memory for uncertain inode counts\n"
 msgstr ""
 
-#: .././repair/phase6.c:2089
+#: .././repair/incore.c:230
 #, c-format
-msgid "can't read leaf block %u for directory inode %<PRIu64>, error %d\n"
+msgid "couldn't allocate realtime block map, size = %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/phase6.c:2101
-#, c-format
-msgid "unknown magic number %#x for block %u in directory inode %<PRIu64>\n"
+#: .././repair/incore.c:295
+msgid "couldn't allocate block map btree roots\n"
 msgstr ""
 
-#: .././repair/phase6.c:2157
-#, c-format
-msgid "can't read freespace block %u for directory inode %<PRIu64>, error %d\n"
+#: .././repair/incore.c:299
+msgid "couldn't allocate block map locks\n"
 msgstr ""
 
-#: .././repair/phase6.c:2172
-#, c-format
-msgid "free block %u for directory inode %<PRIu64> bad header\n"
+#: .././repair/rt.c:47
+msgid "couldn't allocate memory for incore realtime bitmap.\n"
 msgstr ""
 
-#: .././repair/phase6.c:2190
-#, c-format
-msgid "free block %u entry %i for directory ino %<PRIu64> bad\n"
+#: .././repair/rt.c:51
+msgid "couldn't allocate memory for incore realtime summary info.\n"
 msgstr ""
 
-#: .././repair/phase6.c:2200
+#: .././repair/rt.c:203
 #, c-format
-msgid "free block %u for directory inode %<PRIu64> bad nused\n"
+msgid "can't find block %d for rtbitmap inode\n"
 msgstr ""
 
-#: .././repair/phase6.c:2211
+#: .././repair/rt.c:211
 #, c-format
-msgid "missing freetab entry %u for directory inode %<PRIu64>\n"
+msgid "can't read block %d for rtbitmap inode\n"
 msgstr ""
 
-#: .././repair/phase6.c:2250
+#: .././repair/rt.c:265
 #, c-format
-msgid "malloc failed in %s (%<PRId64> bytes)\n"
+msgid "block %d for rtsummary inode is missing\n"
 msgstr ""
 
-#: .././repair/phase6.c:2264
+#: .././repair/rt.c:273
 #, c-format
-msgid "calloc failed in %s (%zu bytes)\n"
+msgid "can't read block %d for rtsummary inode\n"
 msgstr ""
 
-#: .././repair/phase6.c:2313
-#, c-format
-msgid "can't read data block %u for directory inode %<PRIu64> error %d\n"
+#: .././repair/incore_ext.c:135 .././repair/incore_ext.c:562
+msgid "couldn't allocate new extent descriptor.\n"
 msgstr ""
 
-#: .././repair/phase6.c:2420
-msgid "would junk entry\n"
+#: .././repair/incore_ext.c:232
+msgid "duplicate bno extent range\n"
 msgstr ""
 
-#: .././repair/phase6.c:2444
-msgid "junking entry\n"
+#: .././repair/incore_ext.c:369
+msgid ":  duplicate bno extent range\n"
 msgstr ""
 
-#: .././repair/phase6.c:2490
-#, c-format
-msgid "would set .. in sf dir inode %<PRIu64> to %<PRIu64>\n"
+#: .././repair/incore_ext.c:644 .././repair/incore_ext.c:699
+msgid "duplicate extent range\n"
 msgstr ""
 
-#: .././repair/phase6.c:2494
-#, c-format
-msgid "setting .. in sf dir inode %<PRIu64> to %<PRIu64>\n"
+#: .././repair/incore_ext.c:752 .././repair/incore_ext.c:756
+msgid "couldn't malloc dup extent tree descriptor table\n"
 msgstr ""
 
-#: .././repair/phase6.c:2594
-#, c-format
-msgid ""
-"entry \"%s\" in shortform directory %<PRIu64> references non-existent inode %"
-"<PRIu64>\n"
+#: .././repair/incore_ext.c:761
+msgid "couldn't malloc free by-bno extent tree descriptor table\n"
 msgstr ""
 
-#: .././repair/phase6.c:2611
-#, c-format
-msgid ""
-"entry \"%s\" in shortform directory inode %<PRIu64> points to free inode %"
-"<PRIu64>\n"
+#: .././repair/incore_ext.c:766
+msgid "couldn't malloc free by-bcnt extent tree descriptor table\n"
 msgstr ""
 
-#: .././repair/phase6.c:2673
-#, c-format
-msgid ""
-"entry \"%s\" in directory inode %<PRIu64> references already connected inode "
-"%<PRIu64>.\n"
+#: .././repair/incore_ext.c:772
+msgid "couldn't malloc bno extent tree descriptor\n"
 msgstr ""
 
-#: .././repair/phase6.c:2696
-#, c-format
-msgid ""
-"entry \"%s\" in directory inode %<PRIu64> not consistent with .. value (%"
-"<PRIu64>) in inode %<PRIu64>,\n"
+#: .././repair/incore_ext.c:776
+msgid "couldn't malloc bcnt extent tree descriptor\n"
 msgstr ""
 
-#: .././repair/phase6.c:2753
-#, c-format
-msgid "would fix i8count in inode %<PRIu64>\n"
+#: .././repair/incore_ext.c:787
+msgid "couldn't malloc dup rt extent tree descriptor\n"
+msgstr ""
+
+#: .././repair/prefetch.c:238 .././repair/da_util.c:88
+msgid "couldn't malloc dir2 buffer list\n"
 msgstr ""
 
-#: .././repair/phase6.c:2768
-#, c-format
-msgid "fixing i8count in inode %<PRIu64>\n"
+#: .././repair/prefetch.c:543
+msgid "prefetch corruption\n"
 msgstr ""
 
-#: .././repair/phase6.c:2788
+#: .././repair/prefetch.c:725 .././repair/prefetch.c:843
 #, c-format
-msgid "setting size to %<PRId64> bytes to reflect junked entries\n"
+msgid "failed to create prefetch thread: %s\n"
 msgstr ""
 
-#: .././repair/phase6.c:2932
-msgid "recreating root directory .. entry\n"
+#: .././repair/prefetch.c:883
+msgid "failed to initialize prefetch mutex\n"
 msgstr ""
 
-#: .././repair/phase6.c:2948
-#, c-format
-msgid "can't make \"..\" entry in root inode %<PRIu64>, createname error %d\n"
+#: .././repair/prefetch.c:885 .././repair/prefetch.c:887
+msgid "failed to initialize prefetch cond var\n"
 msgstr ""
 
-#: .././repair/phase6.c:2958
-msgid "would recreate root directory .. entry\n"
+#: .././repair/progress.c:20
+msgid "directories"
 msgstr ""
 
-#: .././repair/phase6.c:2982
-#, c-format
-msgid "would create missing \".\" entry in dir ino %<PRIu64>\n"
+#: .././repair/progress.c:22
+msgid "allocation groups"
 msgstr ""
 
-#: .././repair/phase6.c:2989
-#, c-format
-msgid "creating missing \".\" entry in dir ino %<PRIu64>\n"
+#: .././repair/progress.c:24
+msgid "AGI unlinked buckets"
 msgstr ""
 
-#: .././repair/phase6.c:3005
-#, c-format
-msgid "can't make \".\" entry in dir ino %<PRIu64>, createname error %d\n"
+#: .././repair/progress.c:28
+msgid "realtime extents"
 msgstr ""
 
-#: .././repair/phase6.c:3101
-#, c-format
-msgid "disconnected dir inode %<PRIu64>, "
+#: .././repair/progress.c:30
+msgid "unlinked lists"
 msgstr ""
 
-#: .././repair/phase6.c:3103
+#: .././repair/progress.c:37
 #, c-format
-msgid "disconnected inode %<PRIu64>, "
+msgid "        - %02d:%02d:%02d: %s - %llu of %llu %s done\n"
 msgstr ""
 
-#: .././repair/phase6.c:3107
+#: .././repair/progress.c:39
 #, c-format
-msgid "moving to %s\n"
+msgid "        - %02d:%02d:%02d: %s - %llu %s done\n"
 msgstr ""
 
-#: .././repair/phase6.c:3110
-#, c-format
-msgid "would move to %s\n"
+#: .././repair/progress.c:51
+msgid "scanning filesystem freespace"
 msgstr ""
 
-#: .././repair/phase6.c:3195
-msgid "Phase 6 - check inode connectivity...\n"
+#: .././repair/progress.c:53
+msgid "scanning agi unlinked lists"
 msgstr ""
 
-#: .././repair/phase6.c:3209
-msgid "reinitializing root directory\n"
+#: .././repair/progress.c:55
+msgid "check uncertain AG inodes"
 msgstr ""
 
-#: .././repair/phase6.c:3214
-msgid "would reinitialize root directory\n"
+#: .././repair/progress.c:57
+msgid "process known inodes and inode discovery"
 msgstr ""
 
-#: .././repair/phase6.c:3220
-msgid "reinitializing realtime bitmap inode\n"
+#: .././repair/progress.c:59
+msgid "process newly discovered inodes"
 msgstr ""
 
-#: .././repair/phase6.c:3224
-msgid "would reinitialize realtime bitmap inode\n"
+#: .././repair/progress.c:61
+msgid "setting up duplicate extent list"
 msgstr ""
 
-#: .././repair/phase6.c:3230
-msgid "reinitializing realtime summary inode\n"
+#: .././repair/progress.c:63
+msgid "initialize realtime bitmap"
 msgstr ""
 
-#: .././repair/phase6.c:3234
-msgid "would reinitialize realtime summary inode\n"
+#: .././repair/progress.c:65
+msgid "reset realtime bitmaps"
 msgstr ""
 
-#: .././repair/phase6.c:3240
-msgid "        - resetting contents of realtime bitmap and summary inodes\n"
+#: .././repair/progress.c:67
+msgid "check for inodes claiming duplicate blocks"
 msgstr ""
 
-#: .././repair/phase6.c:3243 .././repair/phase6.c:3248
-msgid "Warning:  realtime bitmap may be inconsistent\n"
+#: .././repair/progress.c:69
+msgid "rebuild AG headers and trees"
 msgstr ""
 
-#: .././repair/phase6.c:3254
-msgid "        - traversing filesystem ...\n"
+#: .././repair/progress.c:71
+msgid "traversing filesystem"
 msgstr ""
 
-#: .././repair/phase6.c:3277
-msgid "        - traversal finished ...\n"
+#: .././repair/progress.c:73
+msgid "traversing all unattached subtrees"
 msgstr ""
 
-#: .././repair/phase6.c:3278
-#, c-format
-msgid "        - moving disconnected inodes to %s ...\n"
+#: .././repair/progress.c:75
+msgid "moving disconnected inodes to lost+found"
 msgstr ""
 
-#: .././repair/sb.c:125
-msgid "error finding secondary superblock -- failed to memalign buffer\n"
+#: .././repair/progress.c:77
+msgid "verify and correct link counts"
 msgstr ""
 
-#: .././repair/sb.c:162
-msgid "found candidate secondary superblock...\n"
+#: .././repair/progress.c:79
+msgid "verify link counts"
 msgstr ""
 
-#: .././repair/sb.c:174
-msgid "verified secondary superblock...\n"
+#: .././repair/progress.c:118
+msgid "cannot malloc pointer to done vector\n"
 msgstr ""
 
-#: .././repair/sb.c:179
-msgid "unable to verify superblock, continuing...\n"
+#: .././repair/progress.c:135
+msgid "unable to create progress report thread\n"
 msgstr ""
 
-#: .././repair/sb.c:229
-msgid ""
-"\n"
-"attempting to find secondary superblock...\n"
+#: .././repair/progress.c:178
+msgid "progress_rpt: cannot malloc progress msg buffer\n"
 msgstr ""
 
-#: .././repair/sb.c:510
-msgid "failed to memalign superblock buffer\n"
+#: .././repair/progress.c:191
+msgid "progress_rpt: cannot create timer\n"
 msgstr ""
 
-#: .././repair/sb.c:517
-msgid "couldn't seek to offset 0 in filesystem\n"
+#: .././repair/progress.c:194
+msgid "progress_rpt: cannot set timer\n"
 msgstr ""
 
-#: .././repair/sb.c:527
-msgid "primary superblock write failed!\n"
+#: .././repair/progress.c:218
+msgid "progress_rpt: cannot lock progress mutex\n"
 msgstr ""
 
-#: .././repair/sb.c:545
+#: .././repair/progress.c:255 .././repair/progress.c:358
 #, c-format
-msgid "error reading superblock %u -- failed to memalign buffer\n"
+msgid "%s"
 msgstr ""
 
-#: .././repair/sb.c:556
+#: .././repair/progress.c:263
 #, c-format
-msgid "error reading superblock %u -- seek to offset %<PRId64> failed\n"
+msgid ""
+"\t- %02d:%02d:%02d: Phase %d: elapsed time %s - processed %d %s per minute\n"
 msgstr ""
 
-#: .././repair/sb.c:565
+#: .././repair/progress.c:268
 #, c-format
-msgid "superblock read failed, offset %<PRId64>, size %d, ag %u, rval %d\n"
-msgstr ""
-
-#: .././repair/sb.c:612
-msgid "couldn't malloc geometry structure\n"
-msgstr ""
-
-#: .././repair/sb.c:766
 msgid ""
-"Only two AGs detected and they do not match - cannot validate filesystem "
-"geometry.\n"
-"Use the -o force_geometry option to proceed.\n"
+"\t- %02d:%02d:%02d: Phase %d: %<PRIu64>%% done - estimated remaining time "
+"%s\n"
 msgstr ""
 
-#: .././repair/sb.c:782
-msgid ""
-"Only one AG detected - cannot validate filesystem geometry.\n"
-"Use the -o force_geometry option to proceed.\n"
+#: .././repair/progress.c:276
+msgid "progress_rpt: error unlock msg mutex\n"
 msgstr ""
 
-#: .././repair/sb.c:797
-msgid "Not enough matching superblocks - cannot proceed.\n"
+#: .././repair/progress.c:282
+msgid "cannot delete timer\n"
 msgstr ""
 
-#: .././repair/sb.c:812
-msgid "could not read superblock\n"
+#: .././repair/progress.c:296
+msgid "set_progress_msg: cannot lock progress mutex\n"
 msgstr ""
 
-#: .././repair/dir2.c:50
-#, c-format
-msgid "malloc failed (%zu bytes) dir2_add_badlist:ino %<PRIu64>\n"
+#: .././repair/progress.c:306
+msgid "set_progress_msg: cannot unlock progress mutex\n"
 msgstr ""
 
-#: .././repair/dir2.c:93
-msgid "couldn't malloc dir2 shortform copy\n"
+#: .././repair/progress.c:326
+msgid "print_final_rpt: cannot lock progress mutex\n"
 msgstr ""
 
-#: .././repair/dir2.c:229
-msgid "current"
+#: .././repair/progress.c:362
+msgid "print_final_rpt: cannot unlock progress mutex\n"
 msgstr ""
 
-#: .././repair/dir2.c:232 .././repair/dir2.c:693
-msgid "invalid"
+#: .././repair/progress.c:411
+#, c-format
+msgid "%02d:%02d:%02d"
 msgstr ""
 
-#: .././repair/dir2.c:235 .././repair/dir2.c:695
-msgid "realtime bitmap"
+#: .././repair/progress.c:433
+#, c-format
+msgid "%d week"
 msgstr ""
 
-#: .././repair/dir2.c:238 .././repair/dir2.c:697
-msgid "realtime summary"
+#: .././repair/progress.c:434 .././repair/progress.c:444
+#: .././repair/progress.c:460 .././repair/progress.c:478
+#: .././repair/progress.c:493
+msgid "s"
 msgstr ""
 
-#: .././repair/dir2.c:241 .././repair/dir2.c:699
-msgid "user quota"
+#: .././repair/progress.c:443
+#, c-format
+msgid "%d day"
 msgstr ""
 
-#: .././repair/dir2.c:244 .././repair/dir2.c:701
-msgid "group quota"
+#: .././repair/progress.c:450 .././repair/progress.c:467
+#: .././repair/progress.c:485 .././repair/progress.c:495
+msgid ", "
 msgstr ""
 
-#: .././repair/dir2.c:247 .././repair/dir2.c:703
-msgid "project quota"
+#: .././repair/progress.c:459
+#, c-format
+msgid "%d hour"
 msgstr ""
 
-#: .././repair/dir2.c:265 .././repair/dir2.c:733
-msgid "free"
+#: .././repair/progress.c:477
+#, c-format
+msgid "%d minute"
 msgstr ""
 
-#: .././repair/dir2.c:282 .././repair/dir2.c:713
-msgid "non-existent"
+#: .././repair/progress.c:492
+#, c-format
+msgid "%d second"
 msgstr ""
 
-#: .././repair/dir2.c:287
+#: .././repair/progress.c:513
 #, c-format
 msgid ""
-"entry \"%*.*s\" in shortform directory %<PRIu64> references %s inode %"
-"<PRIu64>\n"
+"\n"
+"        XFS_REPAIR Summary    %s\n"
 msgstr ""
 
-#: .././repair/dir2.c:293
-msgid "is zero length"
+#: .././repair/progress.c:515
+msgid "Phase\t\tStart\t\tEnd\t\tDuration\n"
 msgstr ""
 
-#: .././repair/dir2.c:298
-msgid "extends past end of dir"
+#: .././repair/progress.c:520 .././repair/progress.c:523
+#, c-format
+msgid "Phase %d:\tSkipped\n"
 msgstr ""
 
-#: .././repair/dir2.c:304
+#: .././repair/progress.c:527
 #, c-format
-msgid "entry #%d %s in shortform dir %<PRIu64>"
+msgid "Phase %d:\t%02d/%02d %02d:%02d:%02d\t%02d/%02d %02d:%02d:%02d\t%s\n"
 msgstr ""
 
-#: .././repair/dir2.c:307
+#: .././repair/progress.c:533
 #, c-format
-msgid ", junking %d entries\n"
+msgid ""
+"\n"
+"Total run time: %s\n"
 msgstr ""
 
-#: .././repair/dir2.c:310
-#, c-format
-msgid ", would junk %d entries\n"
+#: .././repair/phase1.c:28
+msgid "Sorry, could not find valid secondary superblock\n"
 msgstr ""
 
-#: .././repair/dir2.c:330
-#, c-format
-msgid "entry contains illegal character in shortform dir %<PRIu64>\n"
+#: .././repair/phase1.c:29
+msgid "Exiting now.\n"
 msgstr ""
 
-#: .././repair/dir2.c:337
+#: .././repair/phase1.c:40
 #, c-format
-msgid "entry contains offset out of order in shortform dir %<PRIu64>\n"
+msgid "could not allocate ag header buffer (%d bytes)\n"
 msgstr ""
 
-#: .././repair/dir2.c:394
-#, c-format
-msgid "junking entry \"%s\" in directory inode %<PRIu64>\n"
+#: .././repair/phase1.c:58
+msgid "Phase 1 - find and verify superblock...\n"
 msgstr ""
 
-#: .././repair/dir2.c:398
-#, c-format
-msgid "would have junked entry \"%s\" in directory inode %<PRIu64>\n"
+#: .././repair/phase1.c:75
+msgid "error reading primary superblock\n"
 msgstr ""
 
-#: .././repair/dir2.c:423
+#: .././repair/phase1.c:81
 #, c-format
-msgid "would have corrected entry count in directory %<PRIu64> from %d to %d\n"
+msgid "bad primary superblock - %s !!!\n"
 msgstr ""
 
-#: .././repair/dir2.c:427
+#: .././repair/phase1.c:88
 #, c-format
-msgid "corrected entry count in directory %<PRIu64>, was %d, now %d\n"
+msgid "couldn't verify primary superblock - %s !!!\n"
 msgstr ""
 
-#: .././repair/dir2.c:438
-#, c-format
-msgid "would have corrected i8 count in directory %<PRIu64> from %d to %d\n"
+#: .././repair/phase1.c:106
+msgid "superblock has a features2 mismatch, correcting\n"
 msgstr ""
 
-#: .././repair/dir2.c:442
+#: .././repair/phase1.c:123
 #, c-format
-msgid "corrected i8 count in directory %<PRIu64>, was %d, now %d\n"
+msgid "Enabling lazy-counters\n"
 msgstr ""
 
-#: .././repair/dir2.c:456
+#: .././repair/phase1.c:127
 #, c-format
-msgid ""
-"would have corrected directory %<PRIu64> size from %<PRId64> to %<PRIdPTR>\n"
+msgid "Cannot disable lazy-counters on V5 fs\n"
 msgstr ""
 
-#: .././repair/dir2.c:461
+#: .././repair/phase1.c:132
 #, c-format
-msgid "corrected directory %<PRIu64> size, was %<PRId64>, now %<PRIdPTR>\n"
+msgid "Disabling lazy-counters\n"
 msgstr ""
 
-#: .././repair/dir2.c:473
+#: .././repair/phase1.c:135
 #, c-format
-msgid "directory %<PRIu64> offsets too high\n"
+msgid "Lazy-counters are already %s\n"
 msgstr ""
 
-#: .././repair/dir2.c:479
-#, c-format
-msgid "would have corrected entry offsets in directory %<PRIu64>\n"
+#: .././repair/phase1.c:136
+msgid "enabled"
 msgstr ""
 
-#: .././repair/dir2.c:483
-#, c-format
-msgid "corrected entry offsets in directory %<PRIu64>\n"
+#: .././repair/phase1.c:136
+msgid "disabled"
 msgstr ""
 
-#: .././repair/dir2.c:502
-#, c-format
-msgid "bogus .. inode number (%<PRIu64>) in directory inode %<PRIu64>, "
+#: .././repair/phase1.c:143
+msgid "resetting shared_vn to zero\n"
 msgstr ""
 
-#: .././repair/dir2.c:506 .././repair/dir2.c:541
-msgid "clearing inode number\n"
+#: .././repair/phase1.c:150
+msgid "writing modified primary superblock\n"
 msgstr ""
 
-#: .././repair/dir2.c:512 .././repair/dir2.c:547
-msgid "would clear inode number\n"
+#: .././repair/phase1.c:153
+msgid "would write modified primary superblock\n"
 msgstr ""
 
-#: .././repair/dir2.c:520
+#: .././repair/attr_repair.c:70
 #, c-format
-msgid ""
-"corrected root directory %<PRIu64> .. entry, was %<PRIu64>, now %<PRIu64>\n"
+msgid "bad range claimed [%d, %d) in da block\n"
 msgstr ""
 
-#: .././repair/dir2.c:528
+#: .././repair/attr_repair.c:77
 #, c-format
-msgid ""
-"would have corrected root directory %<PRIu64> .. entry from %<PRIu64> to %"
-"<PRIu64>\n"
+msgid "byte range end [%d %d) in da block larger than blocksize %d\n"
 msgstr ""
 
-#: .././repair/dir2.c:538
+#: .././repair/attr_repair.c:84
 #, c-format
-msgid "bad .. entry in directory inode %<PRIu64>, points to self, "
+msgid "multiply claimed byte %d in da block\n"
 msgstr ""
 
-#: .././repair/dir2.c:651
-#, c-format
-msgid "corrupt block %u in directory inode %<PRIu64>\n"
+#: .././repair/attr_repair.c:164
+msgid "No memory for ACL check!\n"
 msgstr ""
 
-#: .././repair/dir2.c:654
-msgid "\twill junk block\n"
+#: .././repair/attr_repair.c:172
+msgid ""
+"entry contains illegal value in attribute named SGI_ACL_FILE or "
+"SGI_ACL_DEFAULT\n"
 msgstr ""
 
-#: .././repair/dir2.c:656
-msgid "\twould junk block\n"
+#: .././repair/attr_repair.c:198
+msgid "entry contains illegal value in attribute named SGI_MAC_LABEL\n"
 msgstr ""
 
-#: .././repair/dir2.c:742
-#, c-format
-msgid ""
-"entry \"%*.*s\" at block %d offset %<PRIdPTR> in directory inode %<PRIu64> "
-"references %s inode %<PRIu64>\n"
+#: .././repair/attr_repair.c:204
+msgid "entry contains illegal value in attribute named SGI_CAP_FILE\n"
 msgstr ""
 
-#: .././repair/dir2.c:765
+#: .././repair/attr_repair.c:244
 #, c-format
-msgid ""
-"entry at block %u offset %<PRIdPTR> in directory inode %<PRIu64>has 0 "
-"namelength\n"
+msgid "there are no attributes in the fork for inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/dir2.c:778
+#: .././repair/attr_repair.c:252
 #, c-format
-msgid "\tclearing inode number in entry at offset %<PRIdPTR>...\n"
+msgid "would junk the attribute fork since count is 0 for inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/dir2.c:784
-#, c-format
-msgid "\twould clear inode number in entry at offset %<PRIdPTR>...\n"
+#: .././repair/attr_repair.c:272
+msgid "zero length name entry in attribute fork,"
 msgstr ""
 
-#: .././repair/dir2.c:797
+#: .././repair/attr_repair.c:275 .././repair/attr_repair.c:295
 #, c-format
-msgid ""
-"entry at block %u offset %<PRIdPTR> in directory inode %<PRIu64> has illegal "
-"name \"%*.*s\": "
+msgid " truncating attributes for inode %<PRIu64> to %d\n"
 msgstr ""
 
-#: .././repair/dir2.c:828
+#: .././repair/attr_repair.c:280 .././repair/attr_repair.c:301
 #, c-format
-msgid "bad .. entry in directory inode %<PRIu64>, points to self: "
+msgid " would truncate attributes for inode %<PRIu64> to %d\n"
 msgstr ""
 
-#: .././repair/dir2.c:839
-#, c-format
-msgid "bad .. entry in root directory inode %<PRIu64>, was %<PRIu64>: "
+#: .././repair/attr_repair.c:292
+msgid "name or value attribute lengths are too large,\n"
 msgstr ""
 
-#: .././repair/dir2.c:859
+#: .././repair/attr_repair.c:314
+msgid "entry contains illegal character in shortform attribute name\n"
+msgstr ""
+
+#: .././repair/attr_repair.c:320
+msgid "entry has INCOMPLETE flag on in shortform attribute\n"
+msgstr ""
+
+#: .././repair/attr_repair.c:338
 #, c-format
-msgid "multiple .. entries in directory inode %<PRIu64>: "
+msgid "removing attribute entry %d for inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/dir2.c:872
+#: .././repair/attr_repair.c:350
 #, c-format
-msgid "bad . entry in directory inode %<PRIu64>, was %<PRIu64>: "
+msgid "would remove attribute entry %d for inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/dir2.c:884
+#: .././repair/attr_repair.c:365
 #, c-format
-msgid "multiple . entries in directory inode %<PRIu64>: "
+msgid ""
+"would have corrected attribute entry count in inode %<PRIu64> from %d to %d\n"
 msgstr ""
 
-#: .././repair/dir2.c:894
+#: .././repair/attr_repair.c:369
 #, c-format
-msgid "entry \"%*.*s\" in directory inode %<PRIu64> points to self: "
+msgid "corrected attribute entry count in inode %<PRIu64>, was %d, now %d\n"
 msgstr ""
 
-#: .././repair/dir2.c:905
-msgid "clearing entry\n"
+#: .././repair/attr_repair.c:380
+#, c-format
+msgid ""
+"would have corrected attribute totsize in inode %<PRIu64> from %d to %d\n"
 msgstr ""
 
-#: .././repair/dir2.c:907
-msgid "would clear entry\n"
+#: .././repair/attr_repair.c:385
+#, c-format
+msgid "corrected attribute entry totsize in inode %<PRIu64>, was %d, now %d\n"
 msgstr ""
 
-#: .././repair/dir2.c:920
+#: .././repair/attr_repair.c:419
 #, c-format
-msgid "bad bestfree table in block %u in directory inode %<PRIu64>: "
+msgid "remote block for attributes of inode %<PRIu64> is missing\n"
 msgstr ""
 
-#: .././repair/dir2.c:923
-msgid "repairing table\n"
+#: .././repair/attr_repair.c:428
+#, c-format
+msgid "can't read remote block for attributes of inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/dir2.c:928
-msgid "would repair table\n"
+#: .././repair/attr_repair.c:435
+#, c-format
+msgid "Corrupt remote block for attributes of inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/dir2.c:968
+#: .././repair/attr_repair.c:476
 #, c-format
-msgid "block %u for directory inode %<PRIu64> is missing\n"
+msgid ""
+"attribute entry %d in attr block %u, inode %<PRIu64> has bad name (namelen = "
+"%d)\n"
 msgstr ""
 
-#: .././repair/dir2.c:977
+#: .././repair/attr_repair.c:493
 #, c-format
-msgid "can't read block %u for directory inode %<PRIu64>\n"
+msgid ""
+"bad hashvalue for attribute entry %d in attr block %u, inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/dir2.c:988
+#: .././repair/attr_repair.c:503
 #, c-format
 msgid ""
-"bad directory block magic # %#x in block %u for directory inode %<PRIu64>\n"
+"bad security value for attribute entry %d in attr block %u, inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/dir2.c:1040
+#: .././repair/attr_repair.c:536
 #, c-format
-msgid "bad entry count in block %u of directory inode %<PRIu64>\n"
+msgid ""
+"inconsistent remote attribute entry %d in attr block %u, ino %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/dir2.c:1048
+#: .././repair/attr_repair.c:546
 #, c-format
-msgid "bad hash ordering in block %u of directory inode %<PRIu64>\n"
+msgid "cannot malloc enough for remotevalue attribute for inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/dir2.c:1056
+#: .././repair/attr_repair.c:548
+msgid "SKIPPING this remote attribute\n"
+msgstr ""
+
+#: .././repair/attr_repair.c:554
 #, c-format
-msgid "bad stale count in block %u of directory inode %<PRIu64>\n"
+msgid "remote attribute get failed for entry %d, inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/dir2.c:1105
+#: .././repair/attr_repair.c:561
 #, c-format
-msgid "can't map block %u for directory inode %<PRIu64>\n"
+msgid "remote attribute value check failed for entry %d, inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/dir2.c:1115
+#: .././repair/attr_repair.c:600
 #, c-format
-msgid "can't read file block %u for directory inode %<PRIu64>\n"
+msgid "bad attribute count %d in attr block %u, inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/dir2.c:1127
+#: .././repair/attr_repair.c:615
 #, c-format
-msgid "bad directory leaf magic # %#x for directory inode %<PRIu64> block %u\n"
+msgid "bad attribute nameidx %d in attr block %u, inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/dir2.c:1155
+#: .././repair/attr_repair.c:624
 #, c-format
-msgid "bad sibling back pointer for block %u in directory inode %<PRIu64>\n"
+msgid "attribute entry #%d in attr block %u, inode %<PRIu64> is INCOMPLETE\n"
 msgstr ""
 
-#: .././repair/dir2.c:1186
+#: .././repair/attr_repair.c:635
 #, c-format
-msgid "bad hash path in directory %<PRIu64>\n"
+msgid ""
+"attribute entry %d in attr block %u, inode %<PRIu64> claims already used "
+"space\n"
 msgstr ""
 
-#: .././repair/dir2.c:1296
+#: .././repair/attr_repair.c:658
 #, c-format
-msgid "block %<PRIu64> for directory inode %<PRIu64> is missing\n"
+msgid ""
+"attribute entry %d in attr block %u, inode %<PRIu64> claims used space\n"
 msgstr ""
 
-#: .././repair/dir2.c:1305
+#: .././repair/attr_repair.c:682
 #, c-format
-msgid "can't read block %<PRIu64> for directory inode %<PRIu64>\n"
+msgid ""
+"- resetting first used heap value from %d to %d in block %u of attribute "
+"fork of inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/dir2.c:1313
+#: .././repair/attr_repair.c:690
 #, c-format
 msgid ""
-"bad directory block magic # %#x in block %<PRIu64> for directory inode %"
-"<PRIu64>\n"
+"- would reset first used value from %d to %d in block %u of attribute fork "
+"of inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/dir2.c:1394
+#: .././repair/attr_repair.c:700
 #, c-format
-msgid "bad size/format for directory %<PRIu64>\n"
+msgid ""
+"- resetting usedbytes cnt from %d to %d in block %u of attribute fork of "
+"inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/dir2.c:1401
+#: .././repair/attr_repair.c:708
 #, c-format
-msgid "no . entry for directory %<PRIu64>\n"
+msgid ""
+"- would reset usedbytes cnt from %d to %d in block %u of attribute fork of "
+"%<PRIu64>\n"
 msgstr ""
 
-#: .././repair/dir2.c:1411
+#: .././repair/attr_repair.c:763
 #, c-format
-msgid "no .. entry for directory %<PRIu64>\n"
+msgid "btree cycle detected in attribute fork for inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/dir2.c:1413
+#: .././repair/attr_repair.c:775
 #, c-format
-msgid "no .. entry for root directory %<PRIu64>\n"
+msgid "can't map block %u for attribute fork for inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/phase5.c:223
-msgid "could not set up btree block array\n"
+#: .././repair/attr_repair.c:785
+#, c-format
+msgid ""
+"can't read file block %u (fsbno %<PRIu64>) for attribute fork of inode "
+"%<PRIu64>\n"
 msgstr ""
 
-#: .././repair/phase5.c:244
-msgid "error - not enough free space in filesystem\n"
+#: .././repair/attr_repair.c:797
+#, c-format
+msgid "bad attribute leaf magic %#x for inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/phase5.c:259
+#: .././repair/attr_repair.c:828
 #, c-format
-msgid "could not set up btree rmaps: %s\n"
+msgid ""
+"bad sibling back pointer for block %u in attribute fork for inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/phase5.c:475
+#: .././repair/attr_repair.c:863
 #, c-format
-msgid "can't rebuild fs trees -- not enough free space on ag %u\n"
+msgid "bad hash path in attribute fork for inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/phase5.c:498
+#: .././repair/attr_repair.c:945
 #, c-format
-msgid "ag %u - not enough free space to build freespace btrees\n"
+msgid "expected owner inode %<PRIu64>, got %llu, attr block %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/phase5.c:533
+#: .././repair/attr_repair.c:953
 #, c-format
-msgid "not enough free blocks left to describe all free blocks in AG %u\n"
+msgid "expected block %<PRIu64>, got %llu, inode %<PRIu64>attr block\n"
 msgstr ""
 
-#: .././repair/phase5.c:1622
-msgid "Insufficient memory to construct reverse-map cursor."
+#: .././repair/attr_repair.c:961
+#, c-format
+msgid "wrong FS UUID, inode %<PRIu64> attr block %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/phase5.c:1928
-msgid "Insufficient memory to construct refcount cursor."
+#: .././repair/attr_repair.c:1003
+#, c-format
+msgid "block 0 of inode %<PRIu64> attribute fork is missing\n"
 msgstr ""
 
-#: .././repair/phase5.c:2139 .././repair/phase5.c:2147
-msgid "Insufficient memory saving lost blocks.\n"
+#: .././repair/attr_repair.c:1010
+#, c-format
+msgid "agno of attribute fork of inode %<PRIu64> out of regular partition\n"
 msgstr ""
 
-#: .././repair/phase5.c:2202 .././repair/xfs_repair.c:1032
-msgid "couldn't get superblock\n"
+#: .././repair/attr_repair.c:1018
+#, c-format
+msgid "can't read block 0 of inode %<PRIu64> attribute fork\n"
 msgstr ""
 
-#: .././repair/phase5.c:2283
+#: .././repair/attr_repair.c:1042
 #, c-format
-msgid "unable to rebuild AG %u.  Not enough free space in on-disk AG.\n"
+msgid ""
+"clearing forw/back pointers in block 0 for attributes in inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/phase5.c:2335
+#: .././repair/attr_repair.c:1051
 #, c-format
-msgid "unable to rebuild AG %u.  No free space.\n"
+msgid ""
+"would clear forw/back pointers in block 0 for attributes in inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/phase5.c:2459
+#: .././repair/attr_repair.c:1087
 #, c-format
-msgid "unable to add AG %u reverse-mapping data to btree.\n"
+msgid "bad attribute leaf magic # %#x for dir ino %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/phase5.c:2519
-msgid "Phase 5 - rebuild AG headers and trees...\n"
+#: .././repair/attr_repair.c:1117
+#, c-format
+msgid "Too many ACL entries, count %d\n"
 msgstr ""
 
-#: .././repair/phase5.c:2548
-msgid "cannot alloc sb_icount_ag buffers\n"
+#: .././repair/attr_repair.c:1126
+msgid "cannot malloc enough for ACL attribute\n"
 msgstr ""
 
-#: .././repair/phase5.c:2552
-msgid "cannot alloc sb_ifree_ag buffers\n"
+#: .././repair/attr_repair.c:1127
+msgid "SKIPPING this ACL\n"
 msgstr ""
 
-#: .././repair/phase5.c:2556
-msgid "cannot alloc sb_fdblocks_ag buffers\n"
+#: .././repair/incore_ino.c:47
+msgid "could not allocate nlink array\n"
 msgstr ""
 
-#: .././repair/phase5.c:2560
-msgid "cannot alloc lost block slab\n"
+#: .././repair/incore_ino.c:225
+msgid "could not allocate ftypes array\n"
 msgstr ""
 
-#: .././repair/phase5.c:2579
-msgid "        - generate realtime summary info and bitmap...\n"
+#: .././repair/incore_ino.c:251
+msgid "inode map malloc failed\n"
 msgstr ""
 
-#: .././repair/phase5.c:2584
-msgid "        - reset superblock...\n"
+#: .././repair/incore_ino.c:367
+msgid "add_aginode_uncertain - duplicate inode range\n"
 msgstr ""
 
-#: .././repair/phase5.c:2593
-msgid "Unable to reinsert lost blocks into filesystem.\n"
+#: .././repair/incore_ino.c:462
+msgid "add_inode - duplicate inode range\n"
 msgstr ""
 
-#: .././repair/dino_chunks.c:57
+#: .././repair/incore_ino.c:556
 #, c-format
-msgid "cannot read agbno (%u/%u), disk block %<PRId64>\n"
+msgid "good inode list is --\n"
 msgstr ""
 
-#: .././repair/dino_chunks.c:150
+#: .././repair/incore_ino.c:559
 #, c-format
-msgid "uncertain inode block %d/%d already known\n"
+msgid "uncertain inode list is --\n"
 msgstr ""
 
-#: .././repair/dino_chunks.c:166 .././repair/dino_chunks.c:438
-#: .././repair/dino_chunks.c:497
+#: .././repair/incore_ino.c:564
 #, c-format
-msgid "inode block %d/%d multiply claimed, (state %d)\n"
+msgid "agno %d -- no inodes\n"
 msgstr ""
 
-#: .././repair/dino_chunks.c:173 .././repair/dino_chunks.c:502
+#: .././repair/incore_ino.c:568
 #, c-format
-msgid "inode block %d/%d bad state, (state %d)\n"
+msgid "agno %d\n"
 msgstr ""
 
-#: .././repair/dino_chunks.c:445
+#: .././repair/incore_ino.c:572
 #, c-format
-msgid "uncertain inode block overlap, agbno = %d, ino = %<PRIu64>\n"
+msgid "\tptr = %lx, start = 0x%x, free = 0x%llx, confirmed = 0x%llx\n"
 msgstr ""
 
-#: .././repair/dino_chunks.c:484
-#, c-format
-msgid "uncertain inode block %<PRIu64> already known\n"
+#: .././repair/incore_ino.c:623
+msgid "couldn't malloc parent list table\n"
 msgstr ""
 
-#: .././repair/dino_chunks.c:578
-#, c-format
-msgid "bad state in block map %d\n"
+#: .././repair/incore_ino.c:634 .././repair/incore_ino.c:680
+msgid "couldn't memalign pentries table\n"
 msgstr ""
 
-#: .././repair/dino_chunks.c:583
-#, c-format
-msgid "inode block %<PRIu64> multiply claimed, state was %d\n"
+#: .././repair/incore_ino.c:738
+msgid "could not malloc inode extra data\n"
 msgstr ""
 
-#: .././repair/dino_chunks.c:654
-#, c-format
-msgid "failed to allocate %zd bytes of memory\n"
+#: .././repair/incore_ino.c:804
+msgid "couldn't malloc inode tree descriptor table\n"
 msgstr ""
 
-#: .././repair/dino_chunks.c:678
-#, c-format
-msgid "cannot read inode %<PRIu64>, disk block %<PRId64>, cnt %d\n"
+#: .././repair/incore_ino.c:808
+msgid "couldn't malloc uncertain ino tree descriptor table\n"
 msgstr ""
 
-#: .././repair/dino_chunks.c:834
-#, c-format
-msgid "imap claims in-use inode %<PRIu64> is free, "
+#: .././repair/incore_ino.c:813
+msgid "couldn't malloc inode tree descriptor\n"
 msgstr ""
 
-#: .././repair/dino_chunks.c:839
-msgid "correcting imap\n"
+#: .././repair/incore_ino.c:817
+msgid "couldn't malloc uncertain ino tree descriptor\n"
 msgstr ""
 
-#: .././repair/dino_chunks.c:841
-msgid "would correct imap\n"
+#: .././repair/incore_ino.c:825
+msgid "couldn't malloc uncertain inode cache area\n"
 msgstr ""
 
-#: .././repair/dino_chunks.c:896
+#: .././repair/phase2.c:79
 #, c-format
-msgid "cleared root inode %<PRIu64>\n"
+msgid "zero_log: cannot find log head/tail (xlog_find_tail=%d)\n"
 msgstr ""
 
-#: .././repair/dino_chunks.c:900
-#, c-format
-msgid "would clear root inode %<PRIu64>\n"
+#: .././repair/phase2.c:83
+msgid ""
+"ERROR: The log head and/or tail cannot be discovered. Attempt to mount the\n"
+"filesystem to replay the log or use the -L option to destroy the log and\n"
+"attempt a repair.\n"
 msgstr ""
 
-#: .././repair/dino_chunks.c:908
+#: .././repair/phase2.c:90
 #, c-format
-msgid "cleared realtime bitmap inode %<PRIu64>\n"
+msgid "zero_log: head block %<PRId64> tail block %<PRId64>\n"
 msgstr ""
 
-#: .././repair/dino_chunks.c:912
-#, c-format
-msgid "would clear realtime bitmap inode %<PRIu64>\n"
+#: .././repair/phase2.c:96
+msgid ""
+"ALERT: The filesystem has valuable metadata changes in a log which is being\n"
+"destroyed because the -L option was used.\n"
 msgstr ""
 
-#: .././repair/dino_chunks.c:920
-#, c-format
-msgid "cleared realtime summary inode %<PRIu64>\n"
+#: .././repair/phase2.c:100
+msgid ""
+"ALERT: The filesystem has valuable metadata changes in a log which is being\n"
+"ignored because the -n option was used.  Expect spurious inconsistencies\n"
+"which may be resolved by first mounting the filesystem to replay the log.\n"
 msgstr ""
 
-#: .././repair/dino_chunks.c:924
-#, c-format
-msgid "would clear realtime summary inode %<PRIu64>\n"
+#: .././repair/phase2.c:105
+msgid ""
+"ERROR: The filesystem has valuable metadata changes in a log which needs to\n"
+"be replayed.  Mount the filesystem to replay the log, and unmount it before\n"
+"re-running xfs_repair.  If you are unable to mount the filesystem, then use\n"
+"the -L option to destroy the log and attempt a repair.\n"
+"Note that destroying the log may cause corruption -- please attempt a mount\n"
+"of the filesystem before doing this.\n"
 msgstr ""
 
-#: .././repair/dino_chunks.c:928
-#, c-format
-msgid "cleared inode %<PRIu64>\n"
+#: .././repair/phase2.c:133
+msgid "failed to clear log"
+msgstr ""
+
+#: .././repair/phase2.c:167
+msgid ""
+"This filesystem has an external log.  Specify log device with the -l "
+"option.\n"
 msgstr ""
 
-#: .././repair/dino_chunks.c:931
+#: .././repair/phase2.c:170
 #, c-format
-msgid "would have cleared inode %<PRIu64>\n"
+msgid "Phase 2 - using external log on %s\n"
 msgstr ""
 
-#: .././repair/dino_chunks.c:1122 .././repair/dino_chunks.c:1157
-#: .././repair/dino_chunks.c:1271
-msgid "found inodes not in the inode allocation tree\n"
+#: .././repair/phase2.c:172
+msgid "Phase 2 - using internal log\n"
 msgstr ""
 
-#: .././repair/dinode.c:54
-msgid "real-time"
+#: .././repair/phase2.c:175
+msgid "        - zero log...\n"
 msgstr ""
 
-#: .././repair/dinode.c:55
-msgid "regular"
+#: .././repair/phase2.c:178
+msgid "        - scan filesystem freespace and inode maps...\n"
 msgstr ""
 
-#: .././repair/dinode.c:78
-#, c-format
-msgid "clearing inode %<PRIu64> attributes\n"
+#: .././repair/phase2.c:194
+msgid "root inode chunk not found\n"
 msgstr ""
 
-#: .././repair/dinode.c:81
-#, c-format
-msgid "would have cleared inode %<PRIu64> attributes\n"
+#: .././repair/phase2.c:213
+msgid "        - found root inode chunk\n"
 msgstr ""
 
-#: .././repair/dinode.c:444
-#, c-format
-msgid ""
-"inode %<PRIu64> - bad rt extent start block number %<PRIu64>, offset %"
-"<PRIu64>\n"
+#: .././repair/phase2.c:219
+msgid "root inode marked free, "
 msgstr ""
 
-#: .././repair/dinode.c:452
-#, c-format
-msgid ""
-"inode %<PRIu64> - bad rt extent last block number %<PRIu64>, offset %"
-"<PRIu64>\n"
+#: .././repair/phase2.c:228
+msgid "realtime bitmap inode marked free, "
 msgstr ""
 
-#: .././repair/dinode.c:460
+#: .././repair/phase2.c:237
+msgid "realtime summary inode marked free, "
+msgstr ""
+
+#: .././repair/phase4.c:165
 #, c-format
 msgid ""
-"inode %<PRIu64> - bad rt extent overflows - start %<PRIu64>, end %<PRIu64>, "
-"offset %<PRIu64>\n"
+"unable to finish adding attr/data fork reverse-mapping data for AG %u.\n"
 msgstr ""
 
-#: .././repair/dinode.c:477
+#: .././repair/phase4.c:181
 #, c-format
-msgid "malformed rt inode extent [%<PRIu64> %<PRIu64>] (fs rtext size = %u)\n"
+msgid "unable to add AG %u metadata reverse-mapping data.\n"
 msgstr ""
 
-#: .././repair/dinode.c:498
+#: .././repair/phase4.c:186
 #, c-format
-msgid ""
-"data fork in rt ino %<PRIu64> claims dup rt extent,off - %<PRIu64>, start - %"
-"<PRIu64>, count %<PRIu64>\n"
+msgid "unable to merge AG %u metadata reverse-mapping data.\n"
 msgstr ""
 
-#: .././repair/dinode.c:517
+#: .././repair/phase4.c:191
 #, c-format
-msgid "bad state in rt block map %<PRIu64>\n"
+msgid "%s while checking reverse-mappings"
 msgstr ""
 
-#: .././repair/dinode.c:523
+#: .././repair/phase4.c:206
 #, c-format
-msgid ""
-"data fork in rt inode %<PRIu64> found metadata block %<PRIu64> in rt bmap\n"
+msgid "%s while computing reference count records.\n"
 msgstr ""
 
-#: .././repair/dinode.c:531
+#: .././repair/phase4.c:221
 #, c-format
-msgid "data fork in rt inode %<PRIu64> claims used rt block %<PRIu64>\n"
+msgid "%s while fixing inode reflink flags.\n"
 msgstr ""
 
-#: .././repair/dinode.c:537
+#: .././repair/phase4.c:236
 #, c-format
-msgid "illegal state %d in rt block map %<PRIu64>\n"
+msgid "%s while checking reference counts"
 msgstr ""
 
-#: .././repair/dinode.c:600
-#, c-format
-msgid ""
-"bmap rec out of order, inode %<PRIu64> entry %d [o s c] [%<PRIu64> %<PRIu64> "
-"%<PRIu64>], %d [%<PRIu64> %<PRIu64> %<PRIu64>]\n"
+#: .././repair/phase4.c:290
+msgid "Phase 4 - check for duplicate blocks...\n"
 msgstr ""
 
-#: .././repair/dinode.c:616
-#, c-format
-msgid ""
-"zero length extent (off = %<PRIu64>, fsbno = %<PRIu64>) in ino %<PRIu64>\n"
+#: .././repair/phase4.c:291
+msgid "        - setting up duplicate extent list...\n"
 msgstr ""
 
-#: .././repair/dinode.c:647
-#, c-format
-msgid ""
-"inode %<PRIu64> - bad extent starting block number %<PRIu64>, offset %"
-"<PRIu64>\n"
+#: .././repair/phase4.c:305
+msgid "root inode would be lost\n"
 msgstr ""
 
-#: .././repair/dinode.c:655
-#, c-format
-msgid ""
-"inode %<PRIu64> - bad extent last block number %<PRIu64>, offset %<PRIu64>\n"
+#: .././repair/phase4.c:307
+msgid "root inode lost\n"
 msgstr ""
 
-#: .././repair/dinode.c:663
+#: .././repair/phase4.c:324
 #, c-format
-msgid ""
-"inode %<PRIu64> - bad extent overflows - start %<PRIu64>, end %<PRIu64>, "
-"offset %<PRIu64>\n"
+msgid "unknown block state, ag %d, block %d\n"
 msgstr ""
 
-#: .././repair/dinode.c:675
+#: .././repair/phase4.c:357
 #, c-format
-msgid ""
-"inode %<PRIu64> - extent exceeds max offset - start %<PRIu64>, count %"
-"<PRIu64>, physical block %<PRIu64>\n"
+msgid "unknown rt extent state, extent %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/dinode.c:696
-#, c-format
-msgid ""
-"Fatal error: inode %<PRIu64> - blkmap_set_ext(): %s\n"
-"\t%s fork, off - %<PRIu64>, start - %<PRIu64>, cnt %<PRIu64>\n"
+#: .././repair/phase4.c:406
+msgid "        - check for inodes claiming duplicate blocks...\n"
 msgstr ""
 
-#: .././repair/dinode.c:729
-#, c-format
-msgid ""
-"%s fork in ino %<PRIu64> claims dup extent, off - %<PRIu64>, start - %"
-"<PRIu64>, cnt %<PRIu64>\n"
+#: .././repair/phase5.c:223
+msgid "could not set up btree block array\n"
+msgstr ""
+
+#: .././repair/phase5.c:244
+msgid "error - not enough free space in filesystem\n"
 msgstr ""
 
-#: .././repair/dinode.c:748
+#: .././repair/phase5.c:259
 #, c-format
-msgid "%s fork in ino %<PRIu64> claims free block %<PRIu64>\n"
+msgid "could not set up btree rmaps: %s\n"
 msgstr ""
 
-#: .././repair/dinode.c:757
+#: .././repair/phase5.c:475
 #, c-format
-msgid "bad state in block map %<PRIu64>\n"
-msgstr ""
-
-#: .././repair/dinode.c:762
-msgid "rmap claims metadata use!\n"
+msgid "can't rebuild fs trees -- not enough free space on ag %u\n"
 msgstr ""
 
-#: .././repair/dinode.c:768
+#: .././repair/phase5.c:498
 #, c-format
-msgid "%s fork in inode %<PRIu64> claims metadata block %<PRIu64>\n"
+msgid "ag %u - not enough free space to build freespace btrees\n"
 msgstr ""
 
-#: .././repair/dinode.c:779
+#: .././repair/phase5.c:533
 #, c-format
-msgid "%s fork in %s inode %<PRIu64> claims used block %<PRIu64>\n"
+msgid "not enough free blocks left to describe all free blocks in AG %u\n"
 msgstr ""
 
-#: .././repair/dinode.c:785
-#, c-format
-msgid "illegal state %d in block map %<PRIu64>\n"
+#: .././repair/phase5.c:1584
+msgid "Insufficient memory to construct reverse-map cursor."
 msgstr ""
 
-#: .././repair/dinode.c:793
-msgid "couldn't add reverse mapping\n"
+#: .././repair/phase5.c:1887
+msgid "Insufficient memory to construct refcount cursor."
 msgstr ""
 
-#: .././repair/dinode.c:805
-#, c-format
-msgid "correcting nextents for inode %<PRIu64>\n"
+#: .././repair/phase5.c:2097 .././repair/phase5.c:2105
+msgid "Insufficient memory saving lost blocks.\n"
 msgstr ""
 
-#: .././repair/dinode.c:897
-#, c-format
-msgid "cannot read inode (%u/%u), disk block %<PRIu64>\n"
+#: .././repair/phase5.c:2160 .././repair/xfs_repair.c:1052
+msgid "couldn't get superblock\n"
 msgstr ""
 
-#: .././repair/dinode.c:965
+#: .././repair/phase5.c:2240
 #, c-format
-msgid "bad level %d in inode %<PRIu64> bmap btree root block\n"
+msgid "unable to rebuild AG %u.  Not enough free space in on-disk AG.\n"
 msgstr ""
 
-#: .././repair/dinode.c:971
+#: .././repair/phase5.c:2292
 #, c-format
-msgid "bad numrecs 0 in inode %<PRIu64> bmap btree root block\n"
+msgid "unable to rebuild AG %u.  No free space.\n"
 msgstr ""
 
-#: .././repair/dinode.c:980
+#: .././repair/phase5.c:2413
 #, c-format
-msgid ""
-"indicated size of %s btree root (%d bytes) greater than space in inode %"
-"<PRIu64> %s fork\n"
+msgid "unable to add AG %u reverse-mapping data to btree.\n"
 msgstr ""
 
-#: .././repair/dinode.c:1001
-#, c-format
-msgid "bad bmap btree ptr 0x%<PRIx64> in ino %<PRIu64>\n"
+#: .././repair/phase5.c:2473
+msgid "Phase 5 - rebuild AG headers and trees...\n"
 msgstr ""
 
-#: .././repair/dinode.c:1021
-#, c-format
-msgid ""
-"correcting key in bmbt root (was %<PRIu64>, now %<PRIu64>) in inode %"
-"<PRIu64> %s fork\n"
+#: .././repair/phase5.c:2502
+msgid "cannot alloc sb_icount_ag buffers\n"
 msgstr ""
 
-#: .././repair/dinode.c:1033
-#, c-format
-msgid ""
-"bad key in bmbt root (is %<PRIu64>, would reset to %<PRIu64>) in inode %"
-"<PRIu64> %s fork\n"
+#: .././repair/phase5.c:2506
+msgid "cannot alloc sb_ifree_ag buffers\n"
 msgstr ""
 
-#: .././repair/dinode.c:1049
-#, c-format
-msgid "out of order bmbt root key %<PRIu64> in inode %<PRIu64> %s fork\n"
+#: .././repair/phase5.c:2510
+msgid "cannot alloc sb_fdblocks_ag buffers\n"
 msgstr ""
 
-#: .././repair/dinode.c:1066
-#, c-format
-msgid ""
-"extent count for ino %<PRIu64> %s fork too low (%<PRIu64>) for file format\n"
+#: .././repair/phase5.c:2514
+msgid "cannot alloc lost block slab\n"
 msgstr ""
 
-#: .././repair/dinode.c:1077
-#, c-format
-msgid "bad fwd (right) sibling pointer (saw %<PRIu64> should be NULLFSBLOCK)\n"
+#: .././repair/phase5.c:2533
+msgid "        - generate realtime summary info and bitmap...\n"
 msgstr ""
 
-#: .././repair/dinode.c:1080
-#, c-format
-msgid "\tin inode %<PRIu64> (%s fork) bmap btree block %<PRIu64>\n"
+#: .././repair/phase5.c:2538
+msgid "        - reset superblock...\n"
 msgstr ""
 
-#: .././repair/dinode.c:1162
-#, c-format
-msgid "local inode %<PRIu64> data fork is too large (size = %lld, max = %d)\n"
+#: .././repair/phase5.c:2547
+msgid "Unable to reinsert lost blocks into filesystem.\n"
 msgstr ""
 
-#: .././repair/dinode.c:1170
-#, c-format
-msgid "local inode %<PRIu64> attr fork too large (size %d, max = %d)\n"
+#: .././repair/sb.c:125
+msgid "error finding secondary superblock -- failed to memalign buffer\n"
 msgstr ""
 
-#: .././repair/dinode.c:1177
-#, c-format
-msgid "local inode %<PRIu64> attr too small (size = %d, min size = %zd)\n"
+#: .././repair/sb.c:162
+msgid "found candidate secondary superblock...\n"
 msgstr ""
 
-#: .././repair/dinode.c:1201
-#, c-format
-msgid ""
-"mismatch between format (%d) and size (%<PRId64>) in symlink ino %<PRIu64>\n"
+#: .././repair/sb.c:174
+msgid "verified secondary superblock...\n"
 msgstr ""
 
-#: .././repair/dinode.c:1208
-#, c-format
-msgid ""
-"mismatch between format (%d) and size (%<PRId64>) in symlink inode %"
-"<PRIu64>\n"
+#: .././repair/sb.c:179
+msgid "unable to verify superblock, continuing...\n"
 msgstr ""
 
-#: .././repair/dinode.c:1223
-#, c-format
-msgid "bad number of extents (%d) in symlink %<PRIu64> data fork\n"
+#: .././repair/sb.c:229
+msgid ""
+"\n"
+"attempting to find secondary superblock...\n"
 msgstr ""
 
-#: .././repair/dinode.c:1235
-#, c-format
-msgid "bad extent #%d offset (%<PRIu64>) in symlink %<PRIu64> data fork\n"
+#: .././repair/sb.c:517
+msgid "failed to memalign superblock buffer\n"
 msgstr ""
 
-#: .././repair/dinode.c:1241
-#, c-format
-msgid "bad extent #%d count (%<PRIu64>) in symlink %<PRIu64> data fork\n"
+#: .././repair/sb.c:524
+msgid "couldn't seek to offset 0 in filesystem\n"
 msgstr ""
 
-#: .././repair/dinode.c:1299
-#, c-format
-msgid "cannot read inode %<PRIu64>, file block %d, NULL disk block\n"
+#: .././repair/sb.c:534
+msgid "primary superblock write failed!\n"
 msgstr ""
 
-#: .././repair/dinode.c:1321
+#: .././repair/sb.c:552
 #, c-format
-msgid "cannot read inode %<PRIu64>, file block %d, disk block %<PRIu64>\n"
+msgid "error reading superblock %u -- failed to memalign buffer\n"
 msgstr ""
 
-#: .././repair/dinode.c:1327
+#: .././repair/sb.c:563
 #, c-format
-msgid ""
-"Bad symlink buffer CRC, block %<PRIu64>, inode %<PRIu64>.\n"
-"Correcting CRC, but symlink may be bad.\n"
+msgid "error reading superblock %u -- seek to offset %<PRId64> failed\n"
 msgstr ""
 
-#: .././repair/dinode.c:1340
+#: .././repair/sb.c:572
 #, c-format
-msgid "bad symlink header ino %<PRIu64>, file block %d, disk block %<PRIu64>\n"
+msgid "superblock read failed, offset %<PRId64>, size %d, ag %u, rval %d\n"
 msgstr ""
 
-#: .././repair/dinode.c:1383
-#, c-format
-msgid "symlink in inode %<PRIu64> too long (%llu chars)\n"
+#: .././repair/sb.c:619
+msgid "couldn't malloc geometry structure\n"
 msgstr ""
 
-#: .././repair/dinode.c:1415
-#, c-format
-msgid "found illegal null character in symlink inode %<PRIu64>\n"
+#: .././repair/sb.c:773
+msgid ""
+"Only two AGs detected and they do not match - cannot validate filesystem "
+"geometry.\n"
+"Use the -o force_geometry option to proceed.\n"
 msgstr ""
 
-#: .././repair/dinode.c:1440
-#, c-format
-msgid "inode %<PRIu64> has bad inode type (IFMNT)\n"
+#: .././repair/sb.c:789
+msgid ""
+"Only one AG detected - cannot validate filesystem geometry.\n"
+"Use the -o force_geometry option to proceed.\n"
 msgstr ""
 
-#: .././repair/dinode.c:1451
-#, c-format
-msgid "size of character device inode %<PRIu64> != 0 (%<PRId64> bytes)\n"
+#: .././repair/sb.c:804
+msgid "Not enough matching superblocks - cannot proceed.\n"
 msgstr ""
 
-#: .././repair/dinode.c:1456
-#, c-format
-msgid "size of block device inode %<PRIu64> != 0 (%<PRId64> bytes)\n"
+#: .././repair/sb.c:819
+msgid "could not read superblock\n"
 msgstr ""
 
-#: .././repair/dinode.c:1461
+#: .././repair/xfs_repair.c:85
 #, c-format
-msgid "size of socket inode %<PRIu64> != 0 (%<PRId64> bytes)\n"
+msgid ""
+"Usage: %s [options] device\n"
+"\n"
+"Options:\n"
+"  -f           The device is a file\n"
+"  -L           Force log zeroing. Do this as a last resort.\n"
+"  -l logdev    Specifies the device where the external log resides.\n"
+"  -m maxmem    Maximum amount of memory to be used in megabytes.\n"
+"  -n           No modify mode, just checks the filesystem for damage.\n"
+"  -P           Disables prefetching.\n"
+"  -r rtdev     Specifies the device where the realtime section resides.\n"
+"  -v           Verbose output.\n"
+"  -c subopts   Change filesystem parameters - use xfs_admin.\n"
+"  -o subopts   Override default behaviour, refer to man page.\n"
+"  -t interval  Reporting interval in seconds.\n"
+"  -d           Repair dangerously.\n"
+"  -V           Reports version and exits.\n"
 msgstr ""
 
-#: .././repair/dinode.c:1466
-#, c-format
-msgid "size of fifo inode %<PRIu64> != 0 (%<PRId64> bytes)\n"
+#: .././repair/xfs_repair.c:111
+msgid "no error"
 msgstr ""
 
-#: .././repair/dinode.c:1470
-#, c-format
-msgid "Internal error - process_misc_ino_types, illegal type %d\n"
+#: .././repair/xfs_repair.c:112
+msgid "bad magic number"
 msgstr ""
 
-#: .././repair/dinode.c:1497
-#, c-format
-msgid "size of character device inode %<PRIu64> != 0 (%<PRIu64> blocks)\n"
+#: .././repair/xfs_repair.c:113
+msgid "bad blocksize field"
 msgstr ""
 
-#: .././repair/dinode.c:1502
-#, c-format
-msgid "size of block device inode %<PRIu64> != 0 (%<PRIu64> blocks)\n"
+#: .././repair/xfs_repair.c:114
+msgid "bad blocksize log field"
 msgstr ""
 
-#: .././repair/dinode.c:1507
-#, c-format
-msgid "size of socket inode %<PRIu64> != 0 (%<PRIu64> blocks)\n"
+#: .././repair/xfs_repair.c:115
+msgid "bad or unsupported version"
 msgstr ""
 
-#: .././repair/dinode.c:1512
-#, c-format
-msgid "size of fifo inode %<PRIu64> != 0 (%<PRIu64> blocks)\n"
+#: .././repair/xfs_repair.c:117
+msgid "filesystem mkfs-in-progress bit set"
 msgstr ""
 
-#: .././repair/dinode.c:1590
-#, c-format
-msgid "root inode %<PRIu64> has bad type 0x%x\n"
+#: .././repair/xfs_repair.c:119
+msgid "inconsistent filesystem geometry information"
 msgstr ""
 
-#: .././repair/dinode.c:1594
-msgid "resetting to directory\n"
+#: .././repair/xfs_repair.c:121
+msgid "bad inode size or inconsistent with number of inodes/block"
 msgstr ""
 
-#: .././repair/dinode.c:1598
-msgid "would reset to directory\n"
+#: .././repair/xfs_repair.c:122
+msgid "bad sector size"
 msgstr ""
 
-#: .././repair/dinode.c:1604
-#, c-format
-msgid "user quota inode %<PRIu64> has bad type 0x%x\n"
+#: .././repair/xfs_repair.c:124
+msgid "AGF geometry info conflicts with filesystem geometry"
 msgstr ""
 
-#: .././repair/dinode.c:1613
-#, c-format
-msgid "group quota inode %<PRIu64> has bad type 0x%x\n"
+#: .././repair/xfs_repair.c:126
+msgid "AGI geometry info conflicts with filesystem geometry"
 msgstr ""
 
-#: .././repair/dinode.c:1622
-#, c-format
-msgid "project quota inode %<PRIu64> has bad type 0x%x\n"
+#: .././repair/xfs_repair.c:128
+msgid "AG superblock geometry info conflicts with filesystem geometry"
 msgstr ""
 
-#: .././repair/dinode.c:1632
-#, c-format
-msgid "realtime summary inode %<PRIu64> has bad type 0x%x, "
+#: .././repair/xfs_repair.c:129
+msgid "attempted to perform I/O beyond EOF"
 msgstr ""
 
-#: .././repair/dinode.c:1635 .././repair/dinode.c:1656
-msgid "resetting to regular file\n"
+#: .././repair/xfs_repair.c:131
+msgid "inconsistent filesystem geometry in realtime filesystem component"
 msgstr ""
 
-#: .././repair/dinode.c:1639 .././repair/dinode.c:1660
-msgid "would reset to regular file\n"
+#: .././repair/xfs_repair.c:133
+msgid "maximum indicated percentage of inodes > 100%"
 msgstr ""
 
-#: .././repair/dinode.c:1644
-#, c-format
-msgid "bad # of extents (%u) for realtime summary inode %<PRIu64>\n"
+#: .././repair/xfs_repair.c:135
+msgid "inconsistent inode alignment value"
 msgstr ""
 
-#: .././repair/dinode.c:1653
-#, c-format
-msgid "realtime bitmap inode %<PRIu64> has bad type 0x%x, "
+#: .././repair/xfs_repair.c:137
+msgid "not enough secondary superblocks with matching geometry"
 msgstr ""
 
-#: .././repair/dinode.c:1665
-#, c-format
-msgid "bad # of extents (%u) for realtime bitmap inode %<PRIu64>\n"
+#: .././repair/xfs_repair.c:139
+msgid "bad stripe unit in superblock"
 msgstr ""
 
-#: .././repair/dinode.c:1700
-#, c-format
-msgid ""
-"mismatch between format (%d) and size (%<PRId64>) in directory ino %"
-"<PRIu64>\n"
+#: .././repair/xfs_repair.c:141
+msgid "bad stripe width in superblock"
 msgstr ""
 
-#: .././repair/dinode.c:1706
-#, c-format
-msgid "directory inode %<PRIu64> has bad size %<PRId64>\n"
+#: .././repair/xfs_repair.c:143
+msgid "bad shared version number in superblock"
 msgstr ""
 
-#: .././repair/dinode.c:1714
-#, c-format
-msgid "bad data fork in symlink %<PRIu64>\n"
+#: .././repair/xfs_repair.c:145
+msgid "bad CRC in superblock"
 msgstr ""
 
-#: .././repair/dinode.c:1735
-#, c-format
-msgid "found inode %<PRIu64> claiming to be a real-time file\n"
+#: .././repair/xfs_repair.c:147
+msgid "inconsistent directory geometry information"
 msgstr ""
 
-#: .././repair/dinode.c:1744
+#: .././repair/xfs_repair.c:152
 #, c-format
-msgid ""
-"realtime bitmap inode %<PRIu64> has bad size %<PRId64> (should be %"
-"<PRIu64>)\n"
+msgid "bad error code - %d\n"
 msgstr ""
 
-#: .././repair/dinode.c:1755
+#: .././repair/xfs_repair.c:160
 #, c-format
-msgid ""
-"realtime summary inode %<PRIu64> has bad size %<PRId64> (should be %d)\n"
+msgid "-%c %s option cannot have a value\n"
 msgstr ""
 
-#: .././repair/dinode.c:1783
-#, c-format
-msgid "bad attr fork offset %d in dev inode %<PRIu64>, should be %d\n"
+#: .././repair/xfs_repair.c:250
+msgid "-o ihash option has been removed and will be ignored\n"
 msgstr ""
 
-#: .././repair/dinode.c:1795
-#, c-format
-msgid "bad attr fork offset %d in inode %<PRIu64>, max=%d\n"
+#: .././repair/xfs_repair.c:255
+msgid "-o bhash option cannot be used with -m option\n"
 msgstr ""
 
-#: .././repair/dinode.c:1802
-#, c-format
-msgid "unexpected inode format %d\n"
+#: .././repair/xfs_repair.c:307
+msgid "-m option cannot be used with -o bhash option\n"
 msgstr ""
 
-#: .././repair/dinode.c:1823
+#: .././repair/xfs_repair.c:349
 #, c-format
-msgid "correcting nblocks for inode %<PRIu64>, was %llu - counted %<PRIu64>\n"
+msgid ""
+"\n"
+"fatal error -- "
 msgstr ""
 
-#: .././repair/dinode.c:1830
+#: .././repair/xfs_repair.c:476
 #, c-format
-msgid "bad nblocks %llu for inode %<PRIu64>, would reset to %<PRIu64>\n"
+msgid "sb root inode value %<PRIu64> %sinconsistent with calculated value %u\n"
 msgstr ""
 
-#: .././repair/dinode.c:1838
+#: .././repair/xfs_repair.c:483
 #, c-format
-msgid "too many data fork extents (%<PRIu64>) in inode %<PRIu64>\n"
+msgid "resetting superblock root inode pointer to %u\n"
 msgstr ""
 
-#: .././repair/dinode.c:1845
+#: .././repair/xfs_repair.c:487
 #, c-format
-msgid "correcting nextents for inode %<PRIu64>, was %d - counted %<PRIu64>\n"
+msgid "would reset superblock root inode pointer to %u\n"
 msgstr ""
 
-#: .././repair/dinode.c:1853
+#: .././repair/xfs_repair.c:499
 #, c-format
-msgid "bad nextents %d for inode %<PRIu64>, would reset to %<PRIu64>\n"
+msgid ""
+"sb realtime bitmap inode %<PRIu64> %sinconsistent with calculated value %u\n"
 msgstr ""
 
-#: .././repair/dinode.c:1861
+#: .././repair/xfs_repair.c:506
 #, c-format
-msgid "too many attr fork extents (%<PRIu64>) in inode %<PRIu64>\n"
+msgid "resetting superblock realtime bitmap ino pointer to %u\n"
 msgstr ""
 
-#: .././repair/dinode.c:1868
+#: .././repair/xfs_repair.c:510
 #, c-format
-msgid "correcting anextents for inode %<PRIu64>, was %d - counted %<PRIu64>\n"
+msgid "would reset superblock realtime bitmap ino pointer to %u\n"
 msgstr ""
 
-#: .././repair/dinode.c:1875
+#: .././repair/xfs_repair.c:522
 #, c-format
-msgid "bad anextents %d for inode %<PRIu64>, would reset to %<PRIu64>\n"
+msgid ""
+"sb realtime summary inode %<PRIu64> %sinconsistent with calculated value %u\n"
 msgstr ""
 
-#: .././repair/dinode.c:1887
+#: .././repair/xfs_repair.c:529
 #, c-format
-msgid "nblocks (%<PRIu64>) smaller than nextents for inode %<PRIu64>\n"
+msgid "resetting superblock realtime summary ino pointer to %u\n"
 msgstr ""
 
-#: .././repair/dinode.c:1952 .././repair/dinode.c:1990
+#: .././repair/xfs_repair.c:533
 #, c-format
-msgid "unknown format %d, ino %<PRIu64> (mode = %d)\n"
+msgid "would reset superblock realtime summary ino pointer to %u\n"
 msgstr ""
 
-#: .././repair/dinode.c:1957
+#: .././repair/xfs_repair.c:589
 #, c-format
-msgid "bad data fork in inode %<PRIu64>\n"
+msgid "Maximum metadata LSN (%d:%d) is ahead of log (%d:%d).\n"
 msgstr ""
 
-#: .././repair/dinode.c:2028
+#: .././repair/xfs_repair.c:593
 #, c-format
-msgid "bad attribute format %d in inode %<PRIu64>, "
+msgid "Would format log to cycle %d.\n"
 msgstr ""
 
-#: .././repair/dinode.c:2031
-msgid "resetting value\n"
+#: .././repair/xfs_repair.c:597
+#, c-format
+msgid "Format log to cycle %d.\n"
 msgstr ""
 
-#: .././repair/dinode.c:2035
-msgid "would reset value\n"
+#: .././repair/xfs_repair.c:647
+msgid ""
+"Cannot get host filesystem geometry.\n"
+"Repair may fail if there is a sector size mismatch between\n"
+"the image and the host filesystem.\n"
 msgstr ""
 
-#: .././repair/dinode.c:2065 .././repair/attr_repair.c:1170
-#, c-format
-msgid "illegal attribute format %d, ino %<PRIu64>\n"
+#: .././repair/xfs_repair.c:657
+msgid ""
+"Sector size on host filesystem larger than image sector size.\n"
+"Cannot turn off direct IO, so exiting.\n"
 msgstr ""
 
-#: .././repair/dinode.c:2080
+#: .././repair/xfs_repair.c:700
 #, c-format
-msgid "bad attribute fork in inode %<PRIu64>"
+msgid "%s: couldn't stat \"%s\"\n"
 msgstr ""
 
-#: .././repair/dinode.c:2084
-msgid ", clearing attr fork\n"
+#: .././repair/xfs_repair.c:718
+msgid ""
+"Primary superblock would have been modified.\n"
+"Cannot proceed further in no_modify mode.\n"
+"Exiting now.\n"
 msgstr ""
 
-#: .././repair/dinode.c:2093
-msgid ", would clear attr fork\n"
+#: .././repair/xfs_repair.c:726
+msgid ""
+"Primary superblock bad after phase 1!\n"
+"Exiting now.\n"
 msgstr ""
 
-#: .././repair/dinode.c:2121
+#: .././repair/xfs_repair.c:748
 #, c-format
-msgid "illegal attribute fmt %d, ino %<PRIu64>\n"
+msgid "%s: cannot repair this filesystem.  Sorry.\n"
 msgstr ""
 
-#: .././repair/dinode.c:2141
+#: .././repair/xfs_repair.c:824
 #, c-format
-msgid "problem with attribute contents in inode %<PRIu64>\n"
-msgstr ""
-
-#: .././repair/dinode.c:2149
-msgid "would clear attr fork\n"
+msgid "        - reporting progress in intervals of %s\n"
 msgstr ""
 
-#: .././repair/dinode.c:2182
+#: .././repair/xfs_repair.c:869
 #, c-format
 msgid ""
-"clearing obsolete nlink field in version 2 inode %<PRIu64>, was %d, now 0\n"
+"        - max_mem = %lu, icount = %<PRIu64>, imem = %<PRIu64>, dblock = "
+"%<PRIu64>, dmem = %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/dinode.c:2188
+#: .././repair/xfs_repair.c:878
 #, c-format
 msgid ""
-"would clear obsolete nlink field in version 2 inode %<PRIu64>, currently %d\n"
+"Required memory for repair is greater that the maximum specified\n"
+"with the -m option. Please increase it to at least %lu.\n"
 msgstr ""
 
-#: .././repair/dinode.c:2267
+#: .././repair/xfs_repair.c:883
 #, c-format
-msgid "bad CRC for inode %<PRIu64>%c"
+msgid ""
+"Memory available for repair (%luMB) may not be sufficient.\n"
+"At least %luMB is needed to repair this filesystem efficiently\n"
+"If repair fails due to lack of memory, please\n"
 msgstr ""
 
-#: .././repair/dinode.c:2271
-msgid " will rewrite\n"
+#: .././repair/xfs_repair.c:889
+msgid "turn prefetching off (-P) to reduce the memory footprint.\n"
 msgstr ""
 
-#: .././repair/dinode.c:2274
-msgid " would rewrite\n"
+#: .././repair/xfs_repair.c:892
+#, c-format
+msgid "increase system RAM and/or swap space to at least %luMB.\n"
 msgstr ""
 
-#: .././repair/dinode.c:2281
+#: .././repair/xfs_repair.c:907
 #, c-format
-msgid "bad magic number 0x%x on inode %<PRIu64>%c"
+msgid "        - block cache size set to %d entries\n"
 msgstr ""
 
-#: .././repair/dinode.c:2286
-msgid " resetting magic number\n"
+#: .././repair/xfs_repair.c:932
+msgid "Found unsupported filesystem features.  Exiting now.\n"
 msgstr ""
 
-#: .././repair/dinode.c:2290
-msgid " would reset magic number\n"
+#: .././repair/xfs_repair.c:950
+#, c-format
+msgid "No modify flag set, skipping phase 5\n"
 msgstr ""
 
-#: .././repair/dinode.c:2297
-#, c-format
-msgid "bad version number 0x%x on inode %<PRIu64>%c"
+#: .././repair/xfs_repair.c:970
+msgid "Inode allocation btrees are too corrupted, skipping phases 6 and 7\n"
 msgstr ""
 
-#: .././repair/dinode.c:2302
-msgid " resetting version number\n"
+#: .././repair/xfs_repair.c:976
+msgid "Warning:  no quota inodes were found.  Quotas disabled.\n"
 msgstr ""
 
-#: .././repair/dinode.c:2307
-msgid " would reset version number\n"
+#: .././repair/xfs_repair.c:979
+msgid "Warning:  no quota inodes were found.  Quotas would be disabled.\n"
 msgstr ""
 
-#: .././repair/dinode.c:2320
-#, c-format
-msgid "inode identifier %llu mismatch on inode %<PRIu64>\n"
+#: .././repair/xfs_repair.c:984
+msgid "Warning:  quota inodes were cleared.  Quotas disabled.\n"
 msgstr ""
 
-#: .././repair/dinode.c:2330
-#, c-format
-msgid "UUID mismatch on inode %<PRIu64>\n"
+#: .././repair/xfs_repair.c:987
+msgid "Warning:  quota inodes would be cleared.  Quotas would be disabled.\n"
 msgstr ""
 
-#: .././repair/dinode.c:2343
-#, c-format
-msgid "bad (negative) size %<PRId64> on inode %<PRIu64>\n"
+#: .././repair/xfs_repair.c:993
+msgid ""
+"Warning:  user quota information was cleared.\n"
+"User quotas can not be enforced until limit information is recreated.\n"
 msgstr ""
 
-#: .././repair/dinode.c:2376
-#, c-format
-msgid "imap claims a free inode %<PRIu64> is in use, "
+#: .././repair/xfs_repair.c:997
+msgid ""
+"Warning:  user quota information would be cleared.\n"
+"User quotas could not be enforced until limit information was recreated.\n"
 msgstr ""
 
-#: .././repair/dinode.c:2378
-msgid "correcting imap and clearing inode\n"
+#: .././repair/xfs_repair.c:1005
+msgid ""
+"Warning:  group quota information was cleared.\n"
+"Group quotas can not be enforced until limit information is recreated.\n"
 msgstr ""
 
-#: .././repair/dinode.c:2382
-msgid "would correct imap and clear inode\n"
+#: .././repair/xfs_repair.c:1009
+msgid ""
+"Warning:  group quota information would be cleared.\n"
+"Group quotas could not be enforced until limit information was recreated.\n"
 msgstr ""
 
-#: .././repair/dinode.c:2399
-#, c-format
-msgid "bad inode format in inode %<PRIu64>\n"
+#: .././repair/xfs_repair.c:1017
+msgid ""
+"Warning:  project quota information was cleared.\n"
+"Project quotas can not be enforced until limit information is recreated.\n"
 msgstr ""
 
-#: .././repair/dinode.c:2415
-#, c-format
-msgid "Bad flags set in inode %<PRIu64>\n"
+#: .././repair/xfs_repair.c:1021
+msgid ""
+"Warning:  project quota information would be cleared.\n"
+"Project quotas could not be enforced until limit information was recreated.\n"
 msgstr ""
 
-#: .././repair/dinode.c:2426
-#, c-format
-msgid "inode %<PRIu64> has RT flag set but there is no RT device\n"
+#: .././repair/xfs_repair.c:1038
+msgid "No modify flag set, skipping filesystem flush and exiting.\n"
 msgstr ""
 
-#: .././repair/dinode.c:2438
-#, c-format
-msgid "inode %<PRIu64> not rt bitmap\n"
+#: .././repair/xfs_repair.c:1057
+msgid "Note - quota info will be regenerated on next quota mount.\n"
 msgstr ""
 
-#: .././repair/dinode.c:2452
+#: .././repair/xfs_repair.c:1064
 #, c-format
-msgid "directory flags set on non-directory inode %<PRIu64>\n"
+msgid ""
+"Note - stripe unit (%d) and width (%d) were copied from a backup "
+"superblock.\n"
+"Please reset with mount -o sunit=<value>,swidth=<value> if necessary\n"
 msgstr ""
 
-#: .././repair/dinode.c:2466
-#, c-format
-msgid "file flags set on non-file inode %<PRIu64>\n"
+#: .././repair/xfs_repair.c:1088
+msgid "done\n"
 msgstr ""
 
-#: .././repair/dinode.c:2475
-msgid "fixing bad flags.\n"
+#: .././repair/xfs_repair.c:1092
+msgid "Repair of readonly mount complete.  Immediate reboot encouraged.\n"
 msgstr ""
 
-#: .././repair/dinode.c:2479
-msgid "would fix bad flags.\n"
+#: .././repair/init.c:46
+#, c-format
+msgid "getrlimit(RLIMIT_FSIZE) failed!\n"
 msgstr ""
 
-#: .././repair/dinode.c:2494
+#: .././repair/init.c:54
 #, c-format
-msgid "Bad flags2 set in inode %<PRIu64>\n"
+msgid "setrlimit failed - current: %lld, max: %lld\n"
 msgstr ""
 
-#: .././repair/dinode.c:2504
+#: .././repair/init.c:107
 #, c-format
 msgid ""
-"inode %<PRIu64> is marked reflinked but file system does not support "
-"reflink\n"
+"Unmount or use the dangerous (-d) option to repair a read-only mounted "
+"filesystem\n"
 msgstr ""
 
-#: .././repair/dinode.c:2515
-#, c-format
-msgid "reflink flag set on non-file inode %<PRIu64>\n"
+#: .././repair/init.c:109
+msgid "couldn't initialize XFS library\n"
 msgstr ""
 
-#: .././repair/dinode.c:2526
-#, c-format
-msgid "Cannot have a reflinked realtime inode %<PRIu64>\n"
+#: .././repair/rmap.c:84
+msgid "couldn't allocate per-AG reverse map roots\n"
 msgstr ""
 
-#: .././repair/dinode.c:2536
-#, c-format
-msgid ""
-"inode %<PRIu64> has CoW extent size hint but file system does not support "
-"reflink\n"
+#: .././repair/rmap.c:91
+msgid "Insufficient memory while allocating reverse mapping slabs."
 msgstr ""
 
-#: .././repair/dinode.c:2547
-#, c-format
-msgid "CoW extent size flag set on non-file, non-directory inode %<PRIu64>\n"
+#: .././repair/rmap.c:96 .././repair/rmap.c:335
+msgid ""
+"Insufficient memory while allocating raw metadata reverse mapping slabs."
 msgstr ""
 
-#: .././repair/dinode.c:2558
-#, c-format
-msgid "Cannot have CoW extent size hint on a realtime inode %<PRIu64>\n"
+#: .././repair/rmap.c:102
+msgid "Insufficient memory while allocating refcount item slabs."
 msgstr ""
 
-#: .././repair/dinode.c:2566
-msgid "fixing bad flags2.\n"
+#: .././repair/rmap.c:708
+msgid "Insufficient memory while recreating refcount tree."
 msgstr ""
 
-#: .././repair/dinode.c:2570
-msgid "would fix bad flags2.\n"
+#: .././repair/rmap.c:965
+msgid "would rebuild corrupt rmap btrees.\n"
 msgstr ""
 
-#: .././repair/dinode.c:2621
+#: .././repair/rmap.c:1008
 #, c-format
-msgid "bad inode type %#o inode %<PRIu64>\n"
+msgid ""
+"Missing reverse-mapping record for (%u/%u) %slen %u owner %<PRId64> %s%soff "
+"%<PRIu64>\n"
 msgstr ""
 
-#: .././repair/dinode.c:2645
-#, c-format
-msgid "bad non-zero extent size %u for non-realtime/extsize inode %<PRIu64>, "
+#: .././repair/rmap.c:1012 .././repair/rmap.c:1030 .././repair/rmap.c:1040
+msgid "unwritten "
 msgstr ""
 
-#: .././repair/dinode.c:2648 .././repair/dinode.c:2671
-msgid "resetting to zero\n"
+#: .././repair/rmap.c:1016 .././repair/rmap.c:1034 .././repair/rmap.c:1044
+msgid "attr "
 msgstr ""
 
-#: .././repair/dinode.c:2652 .././repair/dinode.c:2675
-msgid "would reset to zero\n"
+#: .././repair/rmap.c:1018 .././repair/rmap.c:1036 .././repair/rmap.c:1046
+msgid "bmbt "
 msgstr ""
 
-#: .././repair/dinode.c:2668
+#: .././repair/rmap.c:1026
 #, c-format
 msgid ""
-"Cannot have non-zero CoW extent size %u on non-cowextsize inode %<PRIu64>, "
+"Incorrect reverse-mapping: saw (%u/%u) %slen %u owner %<PRId64> %s%soff "
+"%<PRIu64>; should be (%u/%u) %slen %u owner %<PRId64> %s%soff %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/dinode.c:2734
+#: .././repair/rmap.c:1161
 #, c-format
-msgid "problem with directory contents in inode %<PRIu64>\n"
+msgid "setting reflink flag on inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/dinode.c:2742
+#: .././repair/rmap.c:1165
 #, c-format
-msgid "problem with symbolic link in inode %<PRIu64>\n"
+msgid "clearing reflink flag on inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/dinode.c:2837
+#: .././repair/rmap.c:1236
 #, c-format
-msgid "processing inode %d/%d\n"
-msgstr ""
-
-#: .././repair/incore_ino.c:47
-msgid "could not allocate nlink array\n"
-msgstr ""
-
-#: .././repair/incore_ino.c:225
-msgid "could not allocate ftypes array\n"
-msgstr ""
-
-#: .././repair/incore_ino.c:251
-msgid "inode map malloc failed\n"
-msgstr ""
-
-#: .././repair/incore_ino.c:367
-msgid "add_aginode_uncertain - duplicate inode range\n"
+msgid "Unable to fix reflink flag on inode %<PRIu64>.\n"
 msgstr ""
 
-#: .././repair/incore_ino.c:462
-msgid "add_inode - duplicate inode range\n"
+#: .././repair/rmap.c:1297
+msgid "would rebuild corrupt refcount btrees.\n"
 msgstr ""
 
-#: .././repair/incore_ino.c:556
+#: .././repair/rmap.c:1330 .././repair/rmap.c:1341
 #, c-format
-msgid "good inode list is --\n"
+msgid "Missing reference count record for (%u/%u) len %u count %u\n"
 msgstr ""
 
-#: .././repair/incore_ino.c:559
+#: .././repair/rmap.c:1352
 #, c-format
-msgid "uncertain inode list is --\n"
+msgid ""
+"Incorrect reference count: saw (%u/%u) len %u nlinks %u; should be (%u/%u) "
+"len %u nlinks %u\n"
 msgstr ""
 
-#: .././repair/incore_ino.c:564
+#: .././repair/rmap.c:1395 .././repair/rmap.c:1426
 #, c-format
-msgid "agno %d -- no inodes\n"
+msgid "failed to fix AGFL on AG %d, error %d\n"
 msgstr ""
 
-#: .././repair/incore_ino.c:568
+#: .././repair/bmap.c:53
 #, c-format
-msgid "agno %d\n"
+msgid ""
+"Number of extents requested in blkmap_alloc (%d) overflows 32 bits.\n"
+"If this is not a corruption, then you will need a 64 bit system\n"
+"to repair this filesystem.\n"
 msgstr ""
 
-#: .././repair/incore_ino.c:572
+#: .././repair/bmap.c:66
 #, c-format
-msgid "\tptr = %lx, start = 0x%x, free = 0x%llx, confirmed = 0x%llx\n"
-msgstr ""
-
-#: .././repair/incore_ino.c:623
-msgid "couldn't malloc parent list table\n"
+msgid "malloc failed in blkmap_alloc (%zu bytes)\n"
 msgstr ""
 
-#: .././repair/incore_ino.c:634 .././repair/incore_ino.c:680
-msgid "couldn't memalign pentries table\n"
+#: .././repair/bmap.c:189
+#, c-format
+msgid "blkmap_getn malloc failed (%<PRIu64> bytes)\n"
 msgstr ""
 
-#: .././repair/incore_ino.c:738
-msgid "could not malloc inode extra data\n"
+#: .././repair/bmap.c:296
+#, c-format
+msgid ""
+"Number of extents requested in blkmap_grow (%d) overflows 32 bits.\n"
+"You need a 64 bit system to repair this filesystem.\n"
 msgstr ""
 
-#: .././repair/incore_ino.c:804
-msgid "couldn't malloc inode tree descriptor table\n"
+#: .././repair/bmap.c:304
+#, c-format
+msgid ""
+"Number of extents requested in blkmap_grow (%d) overflowed the\n"
+"maximum number of supported extents (%d).\n"
 msgstr ""
 
-#: .././repair/incore_ino.c:808
-msgid "couldn't malloc uncertain ino tree descriptor table\n"
+#: .././repair/bmap.c:312
+msgid "realloc failed in blkmap_grow\n"
 msgstr ""
 
-#: .././repair/incore_ino.c:813
-msgid "couldn't malloc inode tree descriptor\n"
+#: .././repair/scan.c:85 .././repair/scan.c:140
+#, c-format
+msgid "can't read btree block %d/%d\n"
 msgstr ""
 
-#: .././repair/incore_ino.c:817
-msgid "couldn't malloc uncertain ino tree descriptor\n"
+#: .././repair/scan.c:89 .././repair/scan.c:152
+#, c-format
+msgid "btree block %d/%d is suspect, error %d\n"
 msgstr ""
 
-#: .././repair/incore_ino.c:825
-msgid "couldn't malloc uncertain inode cache area\n"
+#: .././repair/scan.c:213
+#, c-format
+msgid "bad magic # %#x in inode %<PRIu64> (%s fork) bmbt block %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/phase4.c:165
+#: .././repair/scan.c:219
 #, c-format
 msgid ""
-"unable to finish adding attr/data fork reverse-mapping data for AG %u.\n"
+"expected level %d got %d in inode %<PRIu64>, (%s fork) bmbt block %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/phase4.c:181
+#: .././repair/scan.c:229
 #, c-format
-msgid "unable to add AG %u metadata reverse-mapping data.\n"
+msgid "expected owner inode %<PRIu64>, got %llu, bmbt block %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/phase4.c:186
+#: .././repair/scan.c:239
 #, c-format
-msgid "unable to merge AG %u metadata reverse-mapping data.\n"
+msgid "expected block %<PRIu64>, got %llu, bmbt block %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/phase4.c:191
+#: .././repair/scan.c:249
 #, c-format
-msgid "%s while checking reverse-mappings"
+msgid "wrong FS UUID, bmbt block %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/phase4.c:206
+#: .././repair/scan.c:269
 #, c-format
-msgid "%s while computing reference count records.\n"
+msgid ""
+"bad fwd (right) sibling pointer (saw %<PRIu64> parent block says %<PRIu64>)\n"
+"\tin inode %<PRIu64> (%s fork) bmap btree block %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/phase4.c:221
+#: .././repair/scan.c:279
 #, c-format
-msgid "%s while fixing inode reflink flags.\n"
+msgid ""
+"bad back (left) sibling pointer (saw %llu parent block says %<PRIu64>)\n"
+"\tin inode %<PRIu64> (%s fork) bmap btree block %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/phase4.c:236
+#: .././repair/scan.c:294
 #, c-format
-msgid "%s while checking reference counts"
+msgid ""
+"bad back (left) sibling pointer (saw %llu should be NULL (0))\n"
+"\tin inode %<PRIu64> (%s fork) bmap btree block %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/phase4.c:290
-msgid "Phase 4 - check for duplicate blocks...\n"
+#: .././repair/scan.c:342
+#, c-format
+msgid "inode 0x%<PRIx64>bmap block 0x%<PRIx64> claimed, state is %d\n"
 msgstr ""
 
-#: .././repair/phase4.c:291
-msgid "        - setting up duplicate extent list...\n"
+#: .././repair/scan.c:349
+#, c-format
+msgid "inode 0x%<PRIx64> bmap block 0x%<PRIx64> claimed, state is %d\n"
 msgstr ""
 
-#: .././repair/phase4.c:305
-msgid "root inode would be lost\n"
+#: .././repair/scan.c:364
+#, c-format
+msgid "bad state %d, inode %<PRIu64> bmap block 0x%<PRIx64>\n"
 msgstr ""
 
-#: .././repair/phase4.c:307
-msgid "root inode lost\n"
+#: .././repair/scan.c:395
+#, c-format
+msgid "couldn't add inode %<PRIu64> bmbt block %<PRIu64> reverse-mapping data."
 msgstr ""
 
-#: .././repair/phase4.c:324
+#: .././repair/scan.c:403 .././repair/scan.c:454
 #, c-format
-msgid "unknown block state, ag %d, block %d\n"
+msgid "inode %<PRIu64> bad # of bmap records (%u, min - %u, max - %u)\n"
 msgstr ""
 
-#: .././repair/phase4.c:357
+#: .././repair/scan.c:433
 #, c-format
-msgid "unknown rt extent state, extent %<PRIu64>\n"
+msgid ""
+"out-of-order bmap key (file offset) in inode %<PRIu64>, %s fork, fsbno "
+"%<PRIu64>\n"
 msgstr ""
 
-#: .././repair/phase4.c:406
-msgid "        - check for inodes claiming duplicate blocks...\n"
+#: .././repair/scan.c:471
+#, c-format
+msgid "bad bmap btree ptr 0x%llx in ino %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/attr_repair.c:70
+#: .././repair/scan.c:499
 #, c-format
-msgid "bad range claimed [%d, %d) in da block\n"
+msgid ""
+"correcting bt key (was %llu, now %<PRIu64>) in inode %<PRIu64>\n"
+"\t\t%s fork, btree block %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/attr_repair.c:77
+#: .././repair/scan.c:511
 #, c-format
-msgid "byte range end [%d %d) in da block larger than blocksize %d\n"
+msgid ""
+"bad btree key (is %llu, should be %<PRIu64>) in inode %<PRIu64>\n"
+"\t\t%s fork, btree block %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/attr_repair.c:84
+#: .././repair/scan.c:529
 #, c-format
-msgid "multiply claimed byte %d in da block\n"
+msgid ""
+"bad fwd (right) sibling pointer (saw %<PRIu64> should be NULLFSBLOCK)\n"
+"\tin inode %<PRIu64> (%s fork) bmap btree block %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/attr_repair.c:164
-msgid "No memory for ACL check!\n"
+#: .././repair/scan.c:587 .././repair/scan.c:964
+#, c-format
+msgid "bad magic # %#x in bt%s block %d/%d\n"
 msgstr ""
 
-#: .././repair/attr_repair.c:172
+#: .././repair/scan.c:605 .././repair/scan.c:983
+#, c-format
+msgid "expected level %d got %d in bt%s block %d/%d\n"
+msgstr ""
+
+#: .././repair/scan.c:619
+#, c-format
 msgid ""
-"entry contains illegal value in attribute named SGI_ACL_FILE or "
-"SGI_ACL_DEFAULT\n"
+"%s freespace btree block claimed (state %d), agno %d, bno %d, suspect %d\n"
 msgstr ""
 
-#: .././repair/attr_repair.c:198
-msgid "entry contains illegal value in attribute named SGI_MAC_LABEL\n"
+#: .././repair/scan.c:639 .././repair/scan.c:740 .././repair/scan.c:1014
+#: .././repair/scan.c:1158
+#, c-format
+msgid "bad btree nrecs (%u, min=%u, max=%u) in bt%s block %u/%u\n"
 msgstr ""
 
-#: .././repair/attr_repair.c:204
-msgid "entry contains illegal value in attribute named SGI_CAP_FILE\n"
+#: .././repair/scan.c:657 .././repair/scan.c:1049 .././repair/scan.c:1335
+#, c-format
+msgid "invalid start block %u in record %u of %s btree block %u/%u\n"
 msgstr ""
 
-#: .././repair/attr_repair.c:244
+#: .././repair/scan.c:663 .././repair/scan.c:1055 .././repair/scan.c:1341
 #, c-format
-msgid "there are no attributes in the fork for inode %<PRIu64>\n"
+msgid "invalid length %u in record %u of %s btree block %u/%u\n"
 msgstr ""
 
-#: .././repair/attr_repair.c:252
+#: .././repair/scan.c:710
 #, c-format
-msgid "would junk the attribute fork since count is 0 for inode %<PRIu64>\n"
+msgid "block (%d,%d-%d) multiply claimed by %s space tree, state - %d\n"
 msgstr ""
 
-#: .././repair/attr_repair.c:272
-msgid "zero length name entry in attribute fork,"
+#: .././repair/scan.c:839
+#, c-format
+msgid ""
+"Static meta block (%d,%d-%d) mismatch in %s tree, state - %d,%<PRIx64>\n"
 msgstr ""
 
-#: .././repair/attr_repair.c:275 .././repair/attr_repair.c:295
+#: .././repair/scan.c:848
 #, c-format
-msgid " truncating attributes for inode %<PRIu64> to %d\n"
+msgid "AG meta block (%d,%d-%d) mismatch in %s tree, state - %d,%<PRIx64>\n"
 msgstr ""
 
-#: .././repair/attr_repair.c:280 .././repair/attr_repair.c:301
+#: .././repair/scan.c:856
 #, c-format
-msgid " would truncate attributes for inode %<PRIu64> to %d\n"
+msgid "inode block (%d,%d-%d) mismatch in %s tree, state - %d,%<PRIx64>\n"
 msgstr ""
 
-#: .././repair/attr_repair.c:292
-msgid "name or value attribute lengths are too large,\n"
+#: .././repair/scan.c:864
+#, c-format
+msgid ""
+"AG refcount block (%d,%d-%d) mismatch in %s tree, state - %d,%<PRIx64>\n"
 msgstr ""
 
-#: .././repair/attr_repair.c:314
-msgid "entry contains illegal character in shortform attribute name\n"
+#: .././repair/scan.c:873
+#, c-format
+msgid "in use block (%d,%d-%d) mismatch in %s tree, state - %d,%<PRIx64>\n"
 msgstr ""
 
-#: .././repair/attr_repair.c:320
-msgid "entry has INCOMPLETE flag on in shortform attribute\n"
+#: .././repair/scan.c:895
+#, c-format
+msgid "unknown block (%d,%d-%d) mismatch on %s tree, state - %d,%<PRIx64>\n"
 msgstr ""
 
-#: .././repair/attr_repair.c:338
+#: .././repair/scan.c:995
 #, c-format
-msgid "removing attribute entry %d for inode %<PRIu64>\n"
+msgid "%s rmap btree block claimed (state %d), agno %d, bno %d, suspect %d\n"
 msgstr ""
 
-#: .././repair/attr_repair.c:350
+#: .././repair/scan.c:1039
 #, c-format
-msgid "would remove attribute entry %d for inode %<PRIu64>\n"
+msgid "invalid flags in record %u of %s btree block %u/%u\n"
 msgstr ""
 
-#: .././repair/attr_repair.c:365
+#: .././repair/scan.c:1068
 #, c-format
-msgid ""
-"would have corrected attribute entry count in inode %<PRIu64> from %d to %d\n"
+msgid "invalid owner in rmap btree record %d (%<PRId64> %u) block %u/%u\n"
 msgstr ""
 
-#: .././repair/attr_repair.c:369
+#: .././repair/scan.c:1075
 #, c-format
-msgid "corrected attribute entry count in inode %<PRIu64>, was %d, now %d\n"
+msgid ""
+"record %d of block (%u/%u) in %s btree cannot have non-inode owner with "
+"flags\n"
 msgstr ""
 
-#: .././repair/attr_repair.c:380
+#: .././repair/scan.c:1079
 #, c-format
 msgid ""
-"would have corrected attribute totsize in inode %<PRIu64> from %d to %d\n"
+"record %d of block (%u/%u) in %s btree cannot have non-inode owner with "
+"offset\n"
 msgstr ""
 
-#: .././repair/attr_repair.c:385
+#: .././repair/scan.c:1100
 #, c-format
-msgid "corrected attribute entry totsize in inode %<PRIu64>, was %d, now %d\n"
+msgid ""
+"out-of-order rmap btree record %d (%u %<PRId64> %<PRIx64> %u) block %u/%u\n"
 msgstr ""
 
-#: .././repair/attr_repair.c:419
+#: .././repair/scan.c:1109 .././repair/scan.c:1387
 #, c-format
-msgid "remote block for attributes of inode %<PRIu64> is missing\n"
+msgid ""
+"record %d in block (%u/%u) of %s tree should be merged with previous record\n"
 msgstr ""
 
-#: .././repair/attr_repair.c:428
+#: .././repair/scan.c:1124
 #, c-format
-msgid "can't read remote block for attributes of inode %<PRIu64>\n"
+msgid "record %d greater than high key of block (%u/%u) in %s tree\n"
 msgstr ""
 
-#: .././repair/attr_repair.c:435
+#: .././repair/scan.c:1180
 #, c-format
-msgid "Corrupt remote block for attributes of inode %<PRIu64>\n"
+msgid "invalid flags in key %u of %s btree block %u/%u\n"
 msgstr ""
 
-#: .././repair/attr_repair.c:476
+#: .././repair/scan.c:1186
 #, c-format
-msgid ""
-"attribute entry %d in attr block %u, inode %<PRIu64> has bad name (namelen = "
-"%d)\n"
+msgid "key %d greater than high key of block (%u/%u) in %s tree\n"
 msgstr ""
 
-#: .././repair/attr_repair.c:493
+#: .././repair/scan.c:1212
 #, c-format
-msgid ""
-"bad hashvalue for attribute entry %d in attr block %u, inode %<PRIu64>\n"
+msgid "invalid flags in high key %u of %s btree block %u/%u\n"
 msgstr ""
 
-#: .././repair/attr_repair.c:503
+#: .././repair/scan.c:1263
 #, c-format
-msgid ""
-"bad security value for attribute entry %d in attr block %u, inode %<PRIu64>\n"
+msgid "bad magic # %#x in %s btree block %d/%d\n"
 msgstr ""
 
-#: .././repair/attr_repair.c:536
+#: .././repair/scan.c:1271
 #, c-format
-msgid ""
-"inconsistent remote attribute entry %d in attr block %u, ino %<PRIu64>\n"
+msgid "expected level %d got %d in %s btree block %d/%d\n"
 msgstr ""
 
-#: .././repair/attr_repair.c:546
+#: .././repair/scan.c:1285
 #, c-format
-msgid "cannot malloc enough for remotevalue attribute for inode %<PRIu64>\n"
+msgid "%s btree block claimed (state %d), agno %d, bno %d, suspect %d\n"
 msgstr ""
 
-#: .././repair/attr_repair.c:548
-msgid "SKIPPING this remote attribute\n"
+#: .././repair/scan.c:1304 .././repair/scan.c:1421
+#, c-format
+msgid "bad btree nrecs (%u, min=%u, max=%u) in %s btree block %u/%u\n"
 msgstr ""
 
-#: .././repair/attr_repair.c:554
+#: .././repair/scan.c:1322
 #, c-format
-msgid "remote attribute get failed for entry %d, inode %<PRIu64>\n"
+msgid ""
+"leftover CoW extent has incorrect refcount in record %u of %s btree block %u/"
+"%u\n"
 msgstr ""
 
-#: .././repair/attr_repair.c:561
+#: .././repair/scan.c:1327
 #, c-format
-msgid "remote attribute value check failed for entry %d, inode %<PRIu64>\n"
+msgid ""
+"leftover CoW extent has invalid startblock in record %u of %s btree block %u/"
+"%u\n"
 msgstr ""
 
-#: .././repair/attr_repair.c:600
+#: .././repair/scan.c:1362
 #, c-format
-msgid "bad attribute count %d in attr block %u, inode %<PRIu64>\n"
+msgid "extent (%u/%u) len %u claimed, state is %d\n"
 msgstr ""
 
-#: .././repair/attr_repair.c:615
+#: .././repair/scan.c:1369
 #, c-format
-msgid "bad attribute nameidx %d in attr block %u, inode %<PRIu64>\n"
+msgid "invalid reference count %u in record %u of %s btree block %u/%u\n"
 msgstr ""
 
-#: .././repair/attr_repair.c:624
+#: .././repair/scan.c:1376
 #, c-format
-msgid "attribute entry #%d in attr block %u, inode %<PRIu64> is INCOMPLETE\n"
+msgid "out-of-order %s btree record %d (%u %u) block %u/%u\n"
 msgstr ""
 
-#: .././repair/attr_repair.c:635
+#: .././repair/scan.c:1502
 #, c-format
-msgid ""
-"attribute entry %d in attr block %u, inode %<PRIu64> claims already used "
-"space\n"
+msgid "badly aligned %s rec (starting inode = %<PRIu64>)\n"
 msgstr ""
 
-#: .././repair/attr_repair.c:658
+#: .././repair/scan.c:1516
 #, c-format
-msgid ""
-"attribute entry %d in attr block %u, inode %<PRIu64> claims used space\n"
+msgid "bad starting inode # (%<PRIu64> (0x%x 0x%x)) in %s rec, skipping rec\n"
 msgstr ""
 
-#: .././repair/attr_repair.c:682
+#: .././repair/scan.c:1525
 #, c-format
-msgid ""
-"- resetting first used heap value from %d to %d in block %u of attribute "
-"fork of inode %<PRIu64>\n"
+msgid "bad ending inode # (%<PRIu64> (0x%x 0x%zx)) in %s rec, skipping rec\n"
 msgstr ""
 
-#: .././repair/attr_repair.c:690
+#: .././repair/scan.c:1590
 #, c-format
 msgid ""
-"- would reset first used value from %d to %d in block %u of attribute fork "
-"of inode %<PRIu64>\n"
+"ir_holemask/ir_free mismatch, %s chunk %d/%u, holemask 0x%x free 0x%llx\n"
 msgstr ""
 
-#: .././repair/attr_repair.c:700
+#: .././repair/scan.c:1677
 #, c-format
 msgid ""
-"- resetting usedbytes cnt from %d to %d in block %u of attribute fork of "
-"inode %<PRIu64>\n"
+"inode chunk claims used block, inobt block - agno %d, bno %d, inopb %d\n"
 msgstr ""
 
-#: .././repair/attr_repair.c:708
+#: .././repair/scan.c:1695
 #, c-format
 msgid ""
-"- would reset usedbytes cnt from %d to %d in block %u of attribute fork of %"
-"<PRIu64>\n"
+"inode rec for ino %<PRIu64> (%d/%d) overlaps existing rec (start %d/%d)\n"
 msgstr ""
 
-#: .././repair/attr_repair.c:770
+#: .././repair/scan.c:1719
 #, c-format
-msgid "can't map block %u for attribute fork for inode %<PRIu64>\n"
+msgid "ir_freecount/free mismatch, inode chunk %d/%u, freecount %d nfree %d\n"
 msgstr ""
 
-#: .././repair/attr_repair.c:780
+#: .././repair/scan.c:1727 .././repair/scan.c:1917
 #, c-format
-msgid ""
-"can't read file block %u (fsbno %<PRIu64>) for attribute fork of inode %"
-"<PRIu64>\n"
+msgid "invalid inode count, inode chunk %d/%u, count %d ninodes %d\n"
 msgstr ""
 
-#: .././repair/attr_repair.c:792
+#: .././repair/scan.c:1781
 #, c-format
-msgid "bad attribute leaf magic %#x for inode %<PRIu64>\n"
+msgid ""
+"sparse inode chunk claims inode block, finobt block - agno %d, bno %d, inopb "
+"%d\n"
 msgstr ""
 
-#: .././repair/attr_repair.c:823
+#: .././repair/scan.c:1796 .././repair/scan.c:1808
 #, c-format
 msgid ""
-"bad sibling back pointer for block %u in attribute fork for inode %<PRIu64>\n"
+"inode chunk claims untracked block, finobt block - agno %d, bno %d, inopb "
+"%d\n"
 msgstr ""
 
-#: .././repair/attr_repair.c:858
+#: .././repair/scan.c:1818
 #, c-format
-msgid "bad hash path in attribute fork for inode %<PRIu64>\n"
+msgid ""
+"inode chunk claims used block, finobt block - agno %d, bno %d, inopb %d\n"
 msgstr ""
 
-#: .././repair/attr_repair.c:940
+#: .././repair/scan.c:1840
 #, c-format
-msgid "expected owner inode %<PRIu64>, got %llu, attr block %<PRIu64>\n"
+msgid ""
+"finobt rec for ino %<PRIu64> (%d/%u) does not match existing rec (%d/%d)\n"
 msgstr ""
 
-#: .././repair/attr_repair.c:947
+#: .././repair/scan.c:1882
 #, c-format
-msgid "expected block %<PRIu64>, got %llu, inode %<PRIu64>attr block\n"
+msgid "undiscovered finobt record, ino %<PRIu64> (%d/%u)\n"
 msgstr ""
 
-#: .././repair/attr_repair.c:954
+#: .././repair/scan.c:1904
 #, c-format
-msgid "wrong FS UUID, inode %<PRIu64> attr block %<PRIu64>\n"
+msgid ""
+"finobt ir_freecount/free mismatch, inode chunk %d/%u, freecount %d nfree %d\n"
 msgstr ""
 
-#: .././repair/attr_repair.c:996
+#: .././repair/scan.c:1910
 #, c-format
-msgid "block 0 of inode %<PRIu64> attribute fork is missing\n"
+msgid "finobt record with no free inodes, inode chunk %d/%u\n"
 msgstr ""
 
-#: .././repair/attr_repair.c:1003
+#: .././repair/scan.c:1963
 #, c-format
-msgid "agno of attribute fork of inode %<PRIu64> out of regular partition\n"
+msgid "bad magic # %#x in inobt block %d/%d\n"
 msgstr ""
 
-#: .././repair/attr_repair.c:1011
+#: .././repair/scan.c:1971
 #, c-format
-msgid "can't read block 0 of inode %<PRIu64> attribute fork\n"
+msgid "expected level %d got %d in inobt block %d/%d\n"
 msgstr ""
 
-#: .././repair/attr_repair.c:1035
+#: .././repair/scan.c:1994
 #, c-format
-msgid ""
-"clearing forw/back pointers in block 0 for attributes in inode %<PRIu64>\n"
+msgid "inode btree block claimed (state %d), agno %d, bno %d, suspect %d\n"
 msgstr ""
 
-#: .././repair/attr_repair.c:1044
+#: .././repair/scan.c:2017
 #, c-format
-msgid ""
-"would clear forw/back pointers in block 0 for attributes in inode %<PRIu64>\n"
+msgid "dubious inode btree block header %d/%d\n"
 msgstr ""
 
-#: .././repair/attr_repair.c:1080
+#: .././repair/scan.c:2135
 #, c-format
-msgid "bad attribute leaf magic # %#x for dir ino %<PRIu64>\n"
+msgid "can't read agfl block for ag %d\n"
 msgstr ""
 
-#: .././repair/attr_repair.c:1110
+#: .././repair/scan.c:2139
 #, c-format
-msgid "Too many ACL entries, count %d\n"
+msgid "agfl has bad CRC for ag %d\n"
 msgstr ""
 
-#: .././repair/attr_repair.c:1119
-msgid "cannot malloc enough for ACL attribute\n"
+#: .././repair/scan.c:2160
+#, c-format
+msgid "bad agbno %u in agfl, agno %d\n"
 msgstr ""
 
-#: .././repair/attr_repair.c:1120
-msgid "SKIPPING this ACL\n"
+#: .././repair/scan.c:2169
+#, c-format
+msgid "freeblk count %d != flcount %d in ag %d\n"
 msgstr ""
 
-#: .././repair/prefetch.c:543
-msgid "prefetch corruption\n"
+#: .././repair/scan.c:2195
+#, c-format
+msgid "bad agbno %u for btbno root, agno %d\n"
 msgstr ""
 
-#: .././repair/prefetch.c:704 .././repair/prefetch.c:817
+#: .././repair/scan.c:2207
 #, c-format
-msgid "failed to create prefetch thread: %s\n"
+msgid "bad agbno %u for btbcnt root, agno %d\n"
 msgstr ""
 
-#: .././repair/prefetch.c:854
-msgid "failed to initialize prefetch mutex\n"
+#: .././repair/scan.c:2226
+#, c-format
+msgid "bad rmapbt block count %u, saw %u\n"
 msgstr ""
 
-#: .././repair/prefetch.c:856 .././repair/prefetch.c:858
-msgid "failed to initialize prefetch cond var\n"
+#: .././repair/scan.c:2230
+#, c-format
+msgid "bad agbno %u for rmapbt root, agno %d\n"
 msgstr ""
 
-#: .././repair/rmap.c:112
-msgid "couldn't allocate per-AG reverse map roots\n"
+#: .././repair/scan.c:2247
+#, c-format
+msgid "bad refcountbt block count %u, saw %u\n"
 msgstr ""
 
-#: .././repair/rmap.c:119
-msgid "Insufficient memory while allocating reverse mapping slabs."
+#: .././repair/scan.c:2251
+#, c-format
+msgid "bad agbno %u for refcntbt root, agno %d\n"
 msgstr ""
 
-#: .././repair/rmap.c:124 .././repair/rmap.c:363
-msgid ""
-"Insufficient memory while allocating raw metadata reverse mapping slabs."
+#: .././repair/scan.c:2269
+#, c-format
+msgid "agf_btreeblks %u, counted %<PRIu64> in ag %u\n"
 msgstr ""
 
-#: .././repair/rmap.c:130
-msgid "Insufficient memory while allocating refcount item slabs."
+#: .././repair/scan.c:2293
+#, c-format
+msgid "bad agbno %u for inobt root, agno %d\n"
 msgstr ""
 
-#: .././repair/rmap.c:736
-msgid "Insufficient memory while recreating refcount tree."
+#: .././repair/scan.c:2306
+#, c-format
+msgid "bad agbno %u for finobt root, agno %d\n"
 msgstr ""
 
-#: .././repair/rmap.c:993
-msgid "would rebuild corrupt rmap btrees.\n"
+#: .././repair/scan.c:2323
+#, c-format
+msgid "agi_freecount %u, counted %u in ag %u finobt\n"
 msgstr ""
 
-#: .././repair/rmap.c:1036
+#: .././repair/scan.c:2333
 #, c-format
-msgid ""
-"Missing reverse-mapping record for (%u/%u) %slen %u owner %<PRId64> %s%soff %"
-"<PRIu64>\n"
+msgid "agi unlinked bucket %d is %u in ag %u (inode=%<PRIu64>)\n"
 msgstr ""
 
-#: .././repair/rmap.c:1040 .././repair/rmap.c:1058 .././repair/rmap.c:1068
-msgid "unwritten "
+#: .././repair/scan.c:2364
+msgid "can't allocate memory for superblock\n"
 msgstr ""
 
-#: .././repair/rmap.c:1044 .././repair/rmap.c:1062 .././repair/rmap.c:1072
-msgid "attr "
+#: .././repair/scan.c:2371
+msgid "root superblock"
 msgstr ""
 
-#: .././repair/rmap.c:1046 .././repair/rmap.c:1064 .././repair/rmap.c:1074
-msgid "bmbt "
+#: .././repair/scan.c:2380
+msgid "agf block"
 msgstr ""
 
-#: .././repair/rmap.c:1054
-#, c-format
-msgid ""
-"Incorrect reverse-mapping: saw (%u/%u) %slen %u owner %<PRId64> %s%soff %"
-"<PRIu64>; should be (%u/%u) %slen %u owner %<PRId64> %s%soff %<PRIu64>\n"
+#: .././repair/scan.c:2389
+msgid "agi block"
 msgstr ""
 
-#: .././repair/rmap.c:1189
+#: .././repair/scan.c:2410
 #, c-format
-msgid "setting reflink flag on inode %<PRIu64>\n"
+msgid "reset bad sb for ag %d\n"
 msgstr ""
 
-#: .././repair/rmap.c:1193
+#: .././repair/scan.c:2413
 #, c-format
-msgid "clearing reflink flag on inode %<PRIu64>\n"
+msgid "would reset bad sb for ag %d\n"
 msgstr ""
 
-#: .././repair/rmap.c:1264
+#: .././repair/scan.c:2418
 #, c-format
-msgid "Unable to fix reflink flag on inode %<PRIu64>.\n"
-msgstr ""
-
-#: .././repair/rmap.c:1325
-msgid "would rebuild corrupt refcount btrees.\n"
+msgid "reset bad agf for ag %d\n"
 msgstr ""
 
-#: .././repair/rmap.c:1358 .././repair/rmap.c:1369
+#: .././repair/scan.c:2421
 #, c-format
-msgid "Missing reference count record for (%u/%u) len %u count %u\n"
+msgid "would reset bad agf for ag %d\n"
 msgstr ""
 
-#: .././repair/rmap.c:1380
+#: .././repair/scan.c:2426
 #, c-format
-msgid ""
-"Incorrect reference count: saw (%u/%u) len %u nlinks %u; should be (%u/%u) "
-"len %u nlinks %u\n"
+msgid "reset bad agi for ag %d\n"
 msgstr ""
 
-#: .././repair/rmap.c:1422 .././repair/rmap.c:1453
+#: .././repair/scan.c:2429
 #, c-format
-msgid "failed to fix AGFL on AG %d, error %d\n"
+msgid "would reset bad agi for ag %d\n"
 msgstr ""
 
-#: .././repair/xfs_repair.c:85
+#: .././repair/scan.c:2434
 #, c-format
-msgid ""
-"Usage: %s [options] device\n"
-"\n"
-"Options:\n"
-"  -f           The device is a file\n"
-"  -L           Force log zeroing. Do this as a last resort.\n"
-"  -l logdev    Specifies the device where the external log resides.\n"
-"  -m maxmem    Maximum amount of memory to be used in megabytes.\n"
-"  -n           No modify mode, just checks the filesystem for damage.\n"
-"  -P           Disables prefetching.\n"
-"  -r rtdev     Specifies the device where the realtime section resides.\n"
-"  -v           Verbose output.\n"
-"  -c subopts   Change filesystem parameters - use xfs_admin.\n"
-"  -o subopts   Override default behaviour, refer to man page.\n"
-"  -t interval  Reporting interval in seconds.\n"
-"  -d           Repair dangerously.\n"
-"  -V           Reports version and exits.\n"
-msgstr ""
-
-#: .././repair/xfs_repair.c:111
-msgid "no error"
+msgid "bad uncorrected agheader %d, skipping ag...\n"
 msgstr ""
 
-#: .././repair/xfs_repair.c:112
-msgid "bad magic number"
+#: .././repair/scan.c:2497
+#, c-format
+msgid "can't get %s for ag %d\n"
 msgstr ""
 
-#: .././repair/xfs_repair.c:113
-msgid "bad blocksize field"
+#: .././repair/scan.c:2517
+msgid "no memory for ag header counts\n"
 msgstr ""
 
-#: .././repair/xfs_repair.c:114
-msgid "bad blocksize log field"
+#: .././repair/scan.c:2543
+#, c-format
+msgid "sb_icount %<PRIu64>, counted %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/xfs_repair.c:115
-msgid "bad or unsupported version"
+#: .././repair/scan.c:2548
+#, c-format
+msgid "sb_ifree %<PRIu64>, counted %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/xfs_repair.c:117
-msgid "filesystem mkfs-in-progress bit set"
+#: .././repair/scan.c:2553
+#, c-format
+msgid "sb_fdblocks %<PRIu64>, counted %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/xfs_repair.c:119
-msgid "inconsistent filesystem geometry information"
+#: .././repair/scan.c:2559
+#, c-format
+msgid "used blocks %<PRIu64>, counted %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/xfs_repair.c:121
-msgid "bad inode size or inconsistent with number of inodes/block"
+#: .././repair/versions.c:68
+#, c-format
+msgid "bogus quota flags 0x%x set in superblock"
 msgstr ""
 
-#: .././repair/xfs_repair.c:122
-msgid "bad sector size"
+#: .././repair/versions.c:74
+msgid ", bogus flags will be cleared\n"
 msgstr ""
 
-#: .././repair/xfs_repair.c:124
-msgid "AGF geometry info conflicts with filesystem geometry"
+#: .././repair/versions.c:76
+msgid ", bogus flags would be cleared\n"
 msgstr ""
 
-#: .././repair/xfs_repair.c:126
-msgid "AGI geometry info conflicts with filesystem geometry"
+#: .././repair/versions.c:115 .././repair/versions.c:120
+#: .././repair/versions.c:125
+msgid "Shared Version bit set. Not supported. Ever.\n"
 msgstr ""
 
-#: .././repair/xfs_repair.c:128
-msgid "AG superblock geometry info conflicts with filesystem geometry"
+#: .././repair/versions.c:138
+msgid "This filesystem has uninitialized extent flags.\n"
 msgstr ""
 
-#: .././repair/xfs_repair.c:129
-msgid "attempted to perform I/O beyond EOF"
+#: .././repair/versions.c:144
+msgid ""
+"This filesystem uses feature(s) not yet supported in this release.\n"
+"Please run a more recent version of xfs_repair.\n"
 msgstr ""
 
-#: .././repair/xfs_repair.c:131
-msgid "inconsistent filesystem geometry in realtime filesystem component"
+#: .././repair/versions.c:150
+#, c-format
+msgid "WARNING:  unknown superblock version %d\n"
 msgstr ""
 
-#: .././repair/xfs_repair.c:133
-msgid "maximum indicated percentage of inodes > 100%"
+#: .././repair/versions.c:153
+msgid "This filesystem contains features not understood by this program.\n"
 msgstr ""
 
-#: .././repair/xfs_repair.c:135
-msgid "inconsistent inode alignment value"
+#: .././repair/versions.c:161
+msgid ""
+"WARNING:  you have disallowed superblock-feature-bits-allowed\n"
+"\tbut this superblock has feature bits.  The superblock\n"
+"\twill be downgraded.  This may cause loss of filesystem meta-data\n"
 msgstr ""
 
-#: .././repair/xfs_repair.c:137
-msgid "not enough secondary superblocks with matching geometry"
+#: .././repair/versions.c:166
+msgid ""
+"WARNING:  you have disallowed superblock-feature-bits-allowed\n"
+"\tbut this superblock has feature bits.  The superblock\n"
+"\twould be downgraded.  This might cause loss of filesystem\n"
+"\tmeta-data.\n"
 msgstr ""
 
-#: .././repair/xfs_repair.c:139
-msgid "bad stripe unit in superblock"
+#: .././repair/versions.c:182
+#, c-format
+msgid ""
+"Superblock has unknown compat/rocompat/incompat features (0x%x/0x%x/0x%x).\n"
+"Using a more recent xfs_repair is recommended.\n"
 msgstr ""
 
-#: .././repair/xfs_repair.c:141
-msgid "bad stripe width in superblock"
+#: .././repair/versions.c:194
+msgid ""
+"WARNING:  you have disallowed attributes but this filesystem\n"
+"\thas attributes.  The filesystem will be downgraded and\n"
+"\tall attributes will be removed.\n"
 msgstr ""
 
-#: .././repair/xfs_repair.c:143
-msgid "bad shared version number in superblock"
+#: .././repair/versions.c:199
+msgid ""
+"WARNING:  you have disallowed attributes but this filesystem\n"
+"\thas attributes.  The filesystem would be downgraded and\n"
+"\tall attributes would be removed.\n"
 msgstr ""
 
-#: .././repair/xfs_repair.c:145
-msgid "bad CRC in superblock"
+#: .././repair/versions.c:212
+msgid ""
+"WARNING:  you have disallowed attr2 attributes but this filesystem\n"
+"\thas attributes.  The filesystem will be downgraded and\n"
+"\tall attr2 attributes will be removed.\n"
 msgstr ""
 
-#: .././repair/xfs_repair.c:150
-#, c-format
-msgid "bad error code - %d\n"
+#: .././repair/versions.c:217
+msgid ""
+"WARNING:  you have disallowed attr2 attributes but this filesystem\n"
+"\thas attributes.  The filesystem would be downgraded and\n"
+"\tall attr2 attributes would be removed.\n"
 msgstr ""
 
-#: .././repair/xfs_repair.c:158
-#, c-format
-msgid "-%c %s option cannot have a value\n"
+#: .././repair/versions.c:229
+msgid ""
+"WARNING: you have a V1 inode filesystem. It will be converted to a\n"
+"\tversion 2 inode filesystem. If you do not want this, run an older\n"
+"\tversion of xfs_repair.\n"
 msgstr ""
 
-#: .././repair/xfs_repair.c:248
-msgid "-o ihash option has been removed and will be ignored\n"
+#: .././repair/versions.c:234
+msgid ""
+"WARNING: you have a V1 inode filesystem. It would be converted to a\n"
+"\tversion 2 inode filesystem. If you do not want this, run an older\n"
+"\tversion of xfs_repair.\n"
 msgstr ""
 
-#: .././repair/xfs_repair.c:253
-msgid "-o bhash option cannot be used with -m option\n"
+#: .././repair/versions.c:244
+msgid ""
+"WARNING:  you have disallowed quotas but this filesystem\n"
+"\thas quotas.  The filesystem will be downgraded and\n"
+"\tall quota information will be removed.\n"
 msgstr ""
 
-#: .././repair/xfs_repair.c:305
-msgid "-m option cannot be used with -o bhash option\n"
+#: .././repair/versions.c:249
+msgid ""
+"WARNING:  you have disallowed quotas but this filesystem\n"
+"\thas quotas.  The filesystem would be downgraded and\n"
+"\tall quota information would be removed.\n"
 msgstr ""
 
-#: .././repair/xfs_repair.c:347
-#, c-format
+#: .././repair/versions.c:277
 msgid ""
-"\n"
-"fatal error -- "
+"WARNING:  you have disallowed aligned inodes but this filesystem\n"
+"\thas aligned inodes.  The filesystem will be downgraded.\n"
+"\tThis will permanently degrade the performance of this filesystem.\n"
 msgstr ""
 
-#: .././repair/xfs_repair.c:474
-#, c-format
-msgid "sb root inode value %<PRIu64> %sinconsistent with calculated value %u\n"
+#: .././repair/versions.c:282
+msgid ""
+"WARNING:  you have disallowed aligned inodes but this filesystem\n"
+"\thas aligned inodes.  The filesystem would be downgraded.\n"
+"\tThis would permanently degrade the performance of this filesystem.\n"
 msgstr ""
 
-#: .././repair/xfs_repair.c:481
+#: .././repair/dino_chunks.c:57
 #, c-format
-msgid "resetting superblock root inode pointer to %u\n"
+msgid "cannot read agbno (%u/%u), disk block %<PRId64>\n"
 msgstr ""
 
-#: .././repair/xfs_repair.c:485
+#: .././repair/dino_chunks.c:150
 #, c-format
-msgid "would reset superblock root inode pointer to %u\n"
+msgid "uncertain inode block %d/%d already known\n"
 msgstr ""
 
-#: .././repair/xfs_repair.c:497
+#: .././repair/dino_chunks.c:166 .././repair/dino_chunks.c:438
+#: .././repair/dino_chunks.c:497
 #, c-format
-msgid ""
-"sb realtime bitmap inode %<PRIu64> %sinconsistent with calculated value %u\n"
+msgid "inode block %d/%d multiply claimed, (state %d)\n"
 msgstr ""
 
-#: .././repair/xfs_repair.c:504
+#: .././repair/dino_chunks.c:173 .././repair/dino_chunks.c:502
 #, c-format
-msgid "resetting superblock realtime bitmap ino pointer to %u\n"
+msgid "inode block %d/%d bad state, (state %d)\n"
 msgstr ""
 
-#: .././repair/xfs_repair.c:508
+#: .././repair/dino_chunks.c:445
 #, c-format
-msgid "would reset superblock realtime bitmap ino pointer to %u\n"
+msgid "uncertain inode block overlap, agbno = %d, ino = %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/xfs_repair.c:520
+#: .././repair/dino_chunks.c:484
 #, c-format
-msgid ""
-"sb realtime summary inode %<PRIu64> %sinconsistent with calculated value %u\n"
+msgid "uncertain inode block %<PRIu64> already known\n"
 msgstr ""
 
-#: .././repair/xfs_repair.c:527
+#: .././repair/dino_chunks.c:578
 #, c-format
-msgid "resetting superblock realtime summary ino pointer to %u\n"
+msgid "bad state in block map %d\n"
 msgstr ""
 
-#: .././repair/xfs_repair.c:531
+#: .././repair/dino_chunks.c:583
 #, c-format
-msgid "would reset superblock realtime summary ino pointer to %u\n"
+msgid "inode block %<PRIu64> multiply claimed, state was %d\n"
 msgstr ""
 
-#: .././repair/xfs_repair.c:587
+#: .././repair/dino_chunks.c:654
 #, c-format
-msgid "Maximum metadata LSN (%d:%d) is ahead of log (%d:%d).\n"
+msgid "failed to allocate %zd bytes of memory\n"
 msgstr ""
 
-#: .././repair/xfs_repair.c:591
+#: .././repair/dino_chunks.c:678
 #, c-format
-msgid "Would format log to cycle %d.\n"
+msgid "cannot read inode %<PRIu64>, disk block %<PRId64>, cnt %d\n"
 msgstr ""
 
-#: .././repair/xfs_repair.c:595
+#: .././repair/dino_chunks.c:832
 #, c-format
-msgid "Format log to cycle %d.\n"
+msgid "imap claims in-use inode %<PRIu64> is free, "
 msgstr ""
 
-#: .././repair/xfs_repair.c:663
-msgid ""
-"Primary superblock would have been modified.\n"
-"Cannot proceed further in no_modify mode.\n"
-"Exiting now.\n"
+#: .././repair/dino_chunks.c:837
+msgid "correcting imap\n"
 msgstr ""
 
-#: .././repair/xfs_repair.c:671
-msgid ""
-"Primary superblock bad after phase 1!\n"
-"Exiting now.\n"
+#: .././repair/dino_chunks.c:839
+msgid "would correct imap\n"
 msgstr ""
 
-#: .././repair/xfs_repair.c:682
+#: .././repair/dino_chunks.c:892
 #, c-format
-msgid "%s: couldn't stat \"%s\"\n"
+msgid "cleared root inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/xfs_repair.c:699
-msgid ""
-"Cannot get host filesystem geometry.\n"
-"Repair may fail if there is a sector size mismatch between\n"
-"the image and the host filesystem.\n"
+#: .././repair/dino_chunks.c:896
+#, c-format
+msgid "would clear root inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/xfs_repair.c:711
-msgid ""
-"Sector size on host filesystem larger than image sector size.\n"
-"Cannot turn off direct IO, so exiting.\n"
+#: .././repair/dino_chunks.c:904
+#, c-format
+msgid "cleared realtime bitmap inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/xfs_repair.c:728
+#: .././repair/dino_chunks.c:908
 #, c-format
-msgid "%s: cannot repair this filesystem.  Sorry.\n"
+msgid "would clear realtime bitmap inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/xfs_repair.c:804
+#: .././repair/dino_chunks.c:916
 #, c-format
-msgid "        - reporting progress in intervals of %s\n"
+msgid "cleared realtime summary inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/xfs_repair.c:849
+#: .././repair/dino_chunks.c:920
 #, c-format
-msgid ""
-"        - max_mem = %lu, icount = %<PRIu64>, imem = %<PRIu64>, dblock = %"
-"<PRIu64>, dmem = %<PRIu64>\n"
+msgid "would clear realtime summary inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/xfs_repair.c:858
+#: .././repair/dino_chunks.c:924
 #, c-format
-msgid ""
-"Required memory for repair is greater that the maximum specified\n"
-"with the -m option. Please increase it to at least %lu.\n"
+msgid "cleared inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/xfs_repair.c:863
+#: .././repair/dino_chunks.c:927
 #, c-format
-msgid ""
-"Memory available for repair (%luMB) may not be sufficient.\n"
-"At least %luMB is needed to repair this filesystem efficiently\n"
-"If repair fails due to lack of memory, please\n"
+msgid "would have cleared inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/xfs_repair.c:869
-msgid "turn prefetching off (-P) to reduce the memory footprint.\n"
+#: .././repair/dino_chunks.c:1118 .././repair/dino_chunks.c:1153
+#: .././repair/dino_chunks.c:1267
+msgid "found inodes not in the inode allocation tree\n"
+msgstr ""
+
+#: .././repair/da_util.c:105
+msgid "attribute"
 msgstr ""
 
-#: .././repair/xfs_repair.c:872
+#: .././repair/da_util.c:164 .././repair/da_util.c:585
 #, c-format
-msgid "increase system RAM and/or swap space to at least %luMB.\n"
+msgid "can't read %s block %u for inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/xfs_repair.c:887
+#: .././repair/da_util.c:177
 #, c-format
-msgid "        - block cache size set to %d entries\n"
+msgid "found non-root LEAFN node in inode %<PRIu64> bno = %u\n"
 msgstr ""
 
-#: .././repair/xfs_repair.c:912
-msgid "Found unsupported filesystem features.  Exiting now.\n"
+#: .././repair/da_util.c:188
+#, c-format
+msgid "bad %s magic number 0x%x in inode %<PRIu64> bno = %u\n"
 msgstr ""
 
-#: .././repair/xfs_repair.c:930
+#: .././repair/da_util.c:199
 #, c-format
-msgid "No modify flag set, skipping phase 5\n"
+msgid "corrupt %s tree block %u for inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/xfs_repair.c:950
-msgid "Inode allocation btrees are too corrupted, skipping phases 6 and 7\n"
+#: .././repair/da_util.c:207
+#, c-format
+msgid "bad %s record count in inode %<PRIu64>, count = %d, max = %d\n"
 msgstr ""
 
-#: .././repair/xfs_repair.c:956
-msgid "Warning:  no quota inodes were found.  Quotas disabled.\n"
+#: .././repair/da_util.c:221
+#, c-format
+msgid "bad header depth for directory inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/xfs_repair.c:959
-msgid "Warning:  no quota inodes were found.  Quotas would be disabled.\n"
+#: .././repair/da_util.c:232
+#, c-format
+msgid "bad %s btree for inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/xfs_repair.c:964
-msgid "Warning:  quota inodes were cleared.  Quotas disabled.\n"
+#: .././repair/da_util.c:282
+#, c-format
+msgid "release_da_cursor_int got unexpected non-null bp, dabno = %u\n"
 msgstr ""
 
-#: .././repair/xfs_repair.c:967
-msgid "Warning:  quota inodes would be cleared.  Quotas would be disabled.\n"
+#: .././repair/da_util.c:360
+#, c-format
+msgid "%s block used/count inconsistency - %d/%hu\n"
 msgstr ""
 
-#: .././repair/xfs_repair.c:973
-msgid ""
-"Warning:  user quota information was cleared.\n"
-"User quotas can not be enforced until limit information is recreated.\n"
+#: .././repair/da_util.c:370
+#, c-format
+msgid "%s block hashvalue inconsistency, expected > %u / saw %u\n"
 msgstr ""
 
-#: .././repair/xfs_repair.c:977
-msgid ""
-"Warning:  user quota information would be cleared.\n"
-"User quotas could not be enforced until limit information was recreated.\n"
+#: .././repair/da_util.c:378
+#, c-format
+msgid "bad %s forward block pointer, expected 0, saw %u\n"
 msgstr ""
 
-#: .././repair/xfs_repair.c:985
-msgid ""
-"Warning:  group quota information was cleared.\n"
-"Group quotas can not be enforced until limit information is recreated.\n"
+#: .././repair/da_util.c:383
+#, c-format
+msgid "bad %s block in inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/xfs_repair.c:989
+#: .././repair/da_util.c:413
+#, c-format
 msgid ""
-"Warning:  group quota information would be cleared.\n"
-"Group quotas could not be enforced until limit information was recreated.\n"
+"correcting bad hashval in non-leaf %s block\n"
+"\tin (level %d) in inode %<PRIu64>.\n"
 msgstr ""
 
-#: .././repair/xfs_repair.c:997
+#: .././repair/da_util.c:421
+#, c-format
 msgid ""
-"Warning:  project quota information was cleared.\n"
-"Project quotas can not be enforced until limit information is recreated.\n"
+"would correct bad hashval in non-leaf %s block\n"
+"\tin (level %d) in inode %<PRIu64>.\n"
 msgstr ""
 
-#: .././repair/xfs_repair.c:1001
-msgid ""
-"Warning:  project quota information would be cleared.\n"
-"Project quotas could not be enforced until limit information was recreated.\n"
+#: .././repair/da_util.c:574
+#, c-format
+msgid "can't get map info for %s block %u of inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/xfs_repair.c:1018
-msgid "No modify flag set, skipping filesystem flush and exiting.\n"
+#: .././repair/da_util.c:602
+#, c-format
+msgid "bad magic number %x in %s block %u for inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/xfs_repair.c:1037
-msgid "Note - quota info will be regenerated on next quota mount.\n"
+#: .././repair/da_util.c:609
+#, c-format
+msgid "bad back pointer in %s block %u for inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/xfs_repair.c:1044
+#: .././repair/da_util.c:615
 #, c-format
-msgid ""
-"Note - stripe unit (%d) and width (%d) were copied from a backup "
-"superblock.\n"
-"Please reset with mount -o sunit=<value>,swidth=<value> if necessary\n"
+msgid "entry count %d too large in %s block %u for inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/xfs_repair.c:1068
-msgid "done\n"
+#: .././repair/da_util.c:622
+#, c-format
+msgid "bad level %d in %s block %u for inode %<PRIu64>\n"
 msgstr ""
 
-#: .././repair/xfs_repair.c:1072
-msgid "Repair of readonly mount complete.  Immediate reboot encouraged.\n"
+#: .././repair/da_util.c:686
+#, c-format
+msgid ""
+"correcting bad hashval in interior %s block\n"
+"\tin (level %d) in inode %<PRIu64>.\n"
+msgstr ""
+
+#: .././repair/da_util.c:694
+#, c-format
+msgid ""
+"would correct bad hashval in interior %s block\n"
+"\tin (level %d) in inode %<PRIu64>.\n"
 msgstr ""
 
 #: .././rtcp/xfs_rtcp.c:30
@@ -13043,3 +13515,137 @@ msgstr ""
 #, c-format
 msgid "%s: could not open %s: %s\n"
 msgstr ""
+
+#: .././spaceman/file.c:40
+#, c-format
+msgid "%c%03d%c %-14s\n"
+msgstr ""
+
+#: .././spaceman/file.c:80
+#, c-format
+msgid "%s: cannot find mount point."
+msgstr ""
+
+#: .././spaceman/file.c:135
+msgid "list current open files"
+msgstr ""
+
+#: .././spaceman/freesp.c:58
+#, c-format
+msgid "Too many histogram buckets.\n"
+msgstr ""
+
+#: .././spaceman/freesp.c:177
+#, c-format
+msgid "%s: fsmap malloc failed.\n"
+msgstr ""
+
+#: .././spaceman/freesp.c:202
+#, c-format
+msgid "%s: FS_IOC_GETFSMAP [\"%s\"]: %s\n"
+msgstr ""
+
+#: .././spaceman/freesp.c:236
+#, c-format
+msgid "     rtdev %10llu %10llu\n"
+msgstr ""
+
+#: .././spaceman/freesp.c:239
+#, c-format
+msgid "%10u %10llu %10llu\n"
+msgstr ""
+
+#: .././spaceman/freesp.c:254
+#, c-format
+msgid "Unrecognized AG number: %s\n"
+msgstr ""
+
+#: .././spaceman/freesp.c:355
+#, c-format
+msgid "        AG    extents     blocks\n"
+msgstr ""
+
+#: .././spaceman/freesp.c:381
+#, c-format
+msgid ""
+"\n"
+"Examine filesystem free space\n"
+"\n"
+" -a agno  -- Scan only the given AG agno.\n"
+" -b       -- binary histogram bin size\n"
+" -d       -- debug output\n"
+" -e bsize -- Use fixed histogram bin size of bsize\n"
+" -g       -- Print only a per-AG summary.\n"
+" -h hbsz  -- Use custom histogram bin size of h1.\n"
+"             Multiple specifications are allowed.\n"
+" -m bmult -- Use histogram bin size multiplier of bmult.\n"
+" -r       -- Display realtime device free space information.\n"
+" -s       -- Emit freespace summary information.\n"
+"\n"
+"Only one of -b, -e, -h, or -m may be specified.\n"
+"\n"
+msgstr ""
+
+#: .././spaceman/freesp.c:410
+msgid "Examine filesystem free space"
+msgstr ""
+
+#: .././spaceman/init.c:33
+#, c-format
+msgid "Usage: %s [-c cmd] file\n"
+msgstr ""
+
+#: .././spaceman/init.c:102
+#, c-format
+msgid "Not an XFS filesystem!\n"
+msgstr ""
+
+#: .././spaceman/prealloc.c:79
+#, c-format
+msgid "%s: XFS_IOC_FREE_EOFBLOCKS on %s: %s\n"
+msgstr ""
+
+#: .././spaceman/prealloc.c:89
+#, c-format
+msgid ""
+"\n"
+"Remove speculative preallocation\n"
+"\n"
+" -g gid    -- remove prealloc on files matching group <gid>\n"
+" -m minlen -- only consider files larger than <minlen>\n"
+" -p prid   -- remove prealloc on files matching project <prid>\n"
+" -s        -- wait for removal to complete\n"
+" -u uid    -- remove prealloc on files matching user <uid>\n"
+"\n"
+"If none of -u, -g, or -p are specified, this command acts on all files.\n"
+"minlen can take units.\n"
+"\n"
+msgstr ""
+
+#: .././spaceman/prealloc.c:114
+msgid "Remove speculative preallocation"
+msgstr ""
+
+#: .././spaceman/trim.c:53
+#, c-format
+msgid "bad agno value %s\n"
+msgstr ""
+
+#: .././spaceman/trim.c:104
+#, c-format
+msgid ""
+"\n"
+"Discard filesystem free space\n"
+"\n"
+" -a agno       -- trim all the freespace in the given AG agno\n"
+" -f            -- trim all the freespace in the entire filesystem\n"
+" offset length -- trim the freespace in the range {offset, length}\n"
+" -m minlen     -- skip freespace extents smaller than minlen\n"
+"\n"
+"One of -a, -f, or the offset/length pair are required.\n"
+"\n"
+msgstr ""
+
+#: .././spaceman/trim.c:127
+msgid "Discard filesystem free space"
+msgstr ""
diff -urpN xfsprogs-4.9.0/quota/edit.c xfsprogs-4.14.0/quota/edit.c
--- xfsprogs-4.9.0/quota/edit.c	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/quota/edit.c	2017-11-20 01:14:14.000000000 +0100
@@ -115,16 +115,16 @@ warn_help(void)
 
 static void
 set_limits(
-	__uint32_t	id,
+	uint32_t	id,
 	uint		type,
 	uint		mask,
 	char		*dev,
-	__uint64_t	*bsoft,
-	__uint64_t	*bhard,
-	__uint64_t	*isoft,
-	__uint64_t	*ihard,
-	__uint64_t	*rtbsoft,
-	__uint64_t	*rtbhard)
+	uint64_t	*bsoft,
+	uint64_t	*bhard,
+	uint64_t	*isoft,
+	uint64_t	*ihard,
+	uint64_t	*rtbsoft,
+	uint64_t	*rtbhard)
 {
 	fs_disk_quota_t	d;
 
@@ -152,12 +152,12 @@ set_user_limits(
 	char		*name,
 	uint		type,
 	uint		mask,
-	__uint64_t	*bsoft,
-	__uint64_t	*bhard,
-	__uint64_t	*isoft,
-	__uint64_t	*ihard,
-	__uint64_t	*rtbsoft,
-	__uint64_t	*rtbhard)
+	uint64_t	*bsoft,
+	uint64_t	*bhard,
+	uint64_t	*isoft,
+	uint64_t	*ihard,
+	uint64_t	*rtbsoft,
+	uint64_t	*rtbhard)
 {
 	uid_t		uid = uid_from_string(name);
 
@@ -175,12 +175,12 @@ set_group_limits(
 	char		*name,
 	uint		type,
 	uint		mask,
-	__uint64_t	*bsoft,
-	__uint64_t	*bhard,
-	__uint64_t	*isoft,
-	__uint64_t	*ihard,
-	__uint64_t	*rtbsoft,
-	__uint64_t	*rtbhard)
+	uint64_t	*bsoft,
+	uint64_t	*bhard,
+	uint64_t	*isoft,
+	uint64_t	*ihard,
+	uint64_t	*rtbsoft,
+	uint64_t	*rtbhard)
 {
 	gid_t		gid = gid_from_string(name);
 
@@ -198,12 +198,12 @@ set_project_limits(
 	char		*name,
 	uint		type,
 	uint		mask,
-	__uint64_t	*bsoft,
-	__uint64_t	*bhard,
-	__uint64_t	*isoft,
-	__uint64_t	*ihard,
-	__uint64_t	*rtbsoft,
-	__uint64_t	*rtbhard)
+	uint64_t	*bsoft,
+	uint64_t	*bhard,
+	uint64_t	*isoft,
+	uint64_t	*ihard,
+	uint64_t	*rtbsoft,
+	uint64_t	*rtbhard)
 {
 	prid_t		prid = prid_from_string(name);
 
@@ -224,7 +224,7 @@ extractb(
 	int		length,
 	uint		blocksize,
 	uint		sectorsize,
-	__uint64_t	*value)
+	uint64_t	*value)
 {
 	long long	v;
 	char		*s = string;
@@ -238,7 +238,7 @@ extractb(
 				progname, s);
 			return 0;
 		}
-		*value = (__uint64_t)v >> 9;	/* syscalls use basic blocks */
+		*value = (uint64_t)v >> 9;	/* syscalls use basic blocks */
 		if (v > 0 && *value == 0)
 			fprintf(stderr, _("%s: Warning: `%s' in quota blocks is 0 (unlimited).\n"), progname, s);
 		return 1;
@@ -252,7 +252,7 @@ extracti(
 	char		*string,
 	const char	*prefix,
 	int		length,
-	__uint64_t	*value)
+	uint64_t	*value)
 {
 	char		*sp, *s = string;
 
@@ -270,7 +270,7 @@ limit_f(
 	char		**argv)
 {
 	char		*name;
-	__uint64_t	bsoft, bhard, isoft, ihard, rtbsoft, rtbhard;
+	uint64_t	bsoft, bhard, isoft, ihard, rtbsoft, rtbhard;
 	int		c, type = 0, mask = 0, flags = 0;
 	uint		bsize, ssize, endoptions;
 
@@ -384,8 +384,8 @@ restore_file(
 	char		*dev = NULL;
 	uint		mask;
 	int		cnt;
-	__uint32_t	id;
-	__uint64_t	bsoft, bhard, isoft, ihard, rtbsoft, rtbhard;
+	uint32_t	id;
+	uint64_t	bsoft, bhard, isoft, ihard, rtbsoft, rtbhard;
 
 	while (fgets(buffer, sizeof(buffer), fp) != NULL) {
 		if (strncmp("fs = ", buffer, 5) == 0) {
@@ -546,7 +546,7 @@ timer_f(
 
 static void
 set_warnings(
-	__uint32_t	id,
+	uint32_t	id,
 	uint		type,
 	uint		mask,
 	char		*dev,
diff -urpN xfsprogs-4.9.0/quota/free.c xfsprogs-4.14.0/quota/free.c
--- xfsprogs-4.9.0/quota/free.c	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/quota/free.c	2017-11-20 01:14:14.000000000 +0100
@@ -49,20 +49,20 @@ free_help(void)
 static int
 mount_free_space_data(
 	struct fs_path		*mount,
-	__uint64_t		*bcount,
-	__uint64_t		*bused,
-	__uint64_t		*bfree,
-	__uint64_t		*icount,
-	__uint64_t		*iused,
-	__uint64_t		*ifree,
-	__uint64_t		*rcount,
-	__uint64_t		*rused,
-	__uint64_t		*rfree)
+	uint64_t		*bcount,
+	uint64_t		*bused,
+	uint64_t		*bfree,
+	uint64_t		*icount,
+	uint64_t		*iused,
+	uint64_t		*ifree,
+	uint64_t		*rcount,
+	uint64_t		*rused,
+	uint64_t		*rfree)
 {
 	struct xfs_fsop_counts	fscounts;
 	struct xfs_fsop_geom	fsgeo;
 	struct statfs		st;
-	__uint64_t		logsize, count, free;
+	uint64_t		logsize, count, free;
 	int			fd;
 
 	if ((fd = open(mount->fs_dir, O_RDONLY)) < 0) {
@@ -132,15 +132,15 @@ mount_free_space_data(
 static int
 projects_free_space_data(
 	struct fs_path		*path,
-	__uint64_t		*bcount,
-	__uint64_t		*bused,
-	__uint64_t		*bfree,
-	__uint64_t		*icount,
-	__uint64_t		*iused,
-	__uint64_t		*ifree,
-	__uint64_t		*rcount,
-	__uint64_t		*rused,
-	__uint64_t		*rfree)
+	uint64_t		*bcount,
+	uint64_t		*bused,
+	uint64_t		*bfree,
+	uint64_t		*icount,
+	uint64_t		*iused,
+	uint64_t		*ifree,
+	uint64_t		*rcount,
+	uint64_t		*rused,
+	uint64_t		*rfree)
 {
 	fs_quota_stat_t		qfs;
 	fs_disk_quota_t		d;
@@ -226,9 +226,9 @@ free_space(
 	fs_path_t	*path,
 	uint		flags)
 {
-	__uint64_t	bcount, bused, bfree;
-	__uint64_t	icount, iused, ifree;
-	__uint64_t	rcount, rused, rfree;
+	uint64_t	bcount, bused, bfree;
+	uint64_t	icount, iused, ifree;
+	uint64_t	rcount, rused, rfree;
 	char		a[8], s[8], u[8], p[8];
 	int		count;
 
diff -urpN xfsprogs-4.9.0/quota/init.c xfsprogs-4.14.0/quota/init.c
--- xfsprogs-4.9.0/quota/init.c	2017-01-05 18:41:55.000000000 +0100
+++ xfsprogs-4.14.0/quota/init.c	2017-11-20 01:14:14.000000000 +0100
@@ -75,8 +75,13 @@ init_commands(void)
 	state_init();
 }
 
+/*
+ * This function allows xfs_quota commands to iterate across all discovered
+ * quota enabled filesystems. Commands that should not iterate all filesystems
+ * should specify CMD_FLAG_ONESHOT in their command flags.
+ */
 static int
-init_args_command(
+filesystem_iterator(
 	int	index)
 {
 	if (index >= fs_count)
@@ -112,10 +117,6 @@ init_check_command(
 	if (!fs_path)
 		return 1;
 
-	/* Always run commands that are valid for all fs types. */
-	if (ct->flags & CMD_ALL_FSTYPES)
-		return 1;
-
 	/* If it's an XFS filesystem, always run the command. */
 	if (!(fs_path->fs_flags & FS_FOREIGN))
 		return 1;
@@ -189,7 +190,7 @@ init(
 	free(projopts);
 
 	init_commands();
-	add_args_command(init_args_command);
+	add_command_iterator(filesystem_iterator);
 	add_check_command(init_check_command);
 
 	/*
diff -urpN xfsprogs-4.9.0/quota/init.h xfsprogs-4.14.0/quota/init.h
--- xfsprogs-4.9.0/quota/init.h	2017-01-05 18:41:55.000000000 +0100
+++ xfsprogs-4.14.0/quota/init.h	2017-11-20 01:14:14.000000000 +0100
@@ -31,5 +31,3 @@ extern void	report_init(void);
 extern void	state_init(void);
 
 extern void init_cvtnum(unsigned int *, unsigned int *);
-
-#define CMD_ALL_FSTYPES	(1<<0) /* command is always available */
diff -urpN xfsprogs-4.9.0/quota/path.c xfsprogs-4.14.0/quota/path.c
--- xfsprogs-4.9.0/quota/path.c	2017-01-05 18:41:55.000000000 +0100
+++ xfsprogs-4.14.0/quota/path.c	2017-11-20 01:14:14.000000000 +0100
@@ -141,7 +141,7 @@ path_init(void)
 	path_cmd.cfunc = path_f;
 	path_cmd.argmin = 0;
 	path_cmd.argmax = 1;
-	path_cmd.flags = CMD_FLAG_GLOBAL | CMD_FLAG_FOREIGN_OK;
+	path_cmd.flags = CMD_FLAG_ONESHOT | CMD_FLAG_FOREIGN_OK;
 	path_cmd.oneline = _("set current path, or show the list of paths");
 
 	print_cmd.name = "print";
@@ -149,7 +149,7 @@ path_init(void)
 	print_cmd.cfunc = print_f;
 	print_cmd.argmin = 0;
 	print_cmd.argmax = 0;
-	print_cmd.flags = CMD_FLAG_GLOBAL | CMD_FLAG_FOREIGN_OK;
+	print_cmd.flags = CMD_FLAG_ONESHOT | CMD_FLAG_FOREIGN_OK;
 	print_cmd.oneline = _("list known mount points and projects");
 
 	if (expert)
diff -urpN xfsprogs-4.9.0/quota/quot.c xfsprogs-4.14.0/quota/quot.c
--- xfsprogs-4.9.0/quota/quot.c	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/quota/quot.c	2017-11-20 01:14:14.000000000 +0100
@@ -26,17 +26,17 @@
 
 typedef struct du {
 	struct du	*next;
-	__uint64_t	blocks;
-	__uint64_t	blocks30;
-	__uint64_t	blocks60;
-	__uint64_t	blocks90;
-	__uint64_t	nfiles;
-	__uint32_t	id;
+	uint64_t	blocks;
+	uint64_t	blocks30;
+	uint64_t	blocks60;
+	uint64_t	blocks90;
+	uint64_t	nfiles;
+	uint32_t	id;
 } du_t;
 
 #define	TSIZE		500
-static __uint64_t	sizes[TSIZE];
-static __uint64_t	overflow;
+static uint64_t	sizes[TSIZE];
+static uint64_t	overflow;
 
 #define	NDU		60000
 #define	DUHASH		8209
@@ -84,8 +84,8 @@ quot_bulkstat_add(
 {
 	du_t		*dp;
 	du_t		**hp;
-	__uint64_t	size;
-	__uint32_t	i, id;
+	uint64_t	size;
+	uint32_t	i, id;
 
 	if ((p->bs_mode & S_IFMT) == 0)
 		return;
@@ -203,7 +203,7 @@ qcompare(
 	return 0;
 }
 
-typedef char *(*idtoname_t)(__uint32_t);
+typedef char *(*idtoname_t)(uint32_t);
 
 static void
 quot_report_mount_any_type(
@@ -291,7 +291,7 @@ quot_histogram_mount(
 	fs_path_t	*mount,
 	uint		flags)
 {
-	__uint64_t	t = 0;
+	uint64_t	t = 0;
 	int		i;
 
 	fprintf(fp, _("%s (%s):\n"), mount->fs_name, mount->fs_dir);
diff -urpN xfsprogs-4.9.0/quota/quota.c xfsprogs-4.14.0/quota/quota.c
--- xfsprogs-4.9.0/quota/quota.c	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/quota/quota.c	2017-11-20 01:14:14.000000000 +0100
@@ -52,7 +52,7 @@ quota_help(void)
 static int
 quota_mount(
 	FILE		*fp,
-	__uint32_t	id,
+	uint32_t	id,
 	char		*name,
 	uint		form,
 	uint		type,
@@ -181,7 +181,7 @@ quota_mount(
 static void
 quota(
 	FILE		*fp,
-	__uint32_t	id,
+	uint32_t	id,
 	char		*name,
 	uint		form,
 	uint		type,
diff -urpN xfsprogs-4.9.0/quota/quota.h xfsprogs-4.14.0/quota/quota.h
--- xfsprogs-4.9.0/quota/quota.h	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/quota/quota.h	2017-11-20 01:14:14.000000000 +0100
@@ -53,9 +53,9 @@ enum {
 extern char *type_to_string(uint __type);
 extern char *form_to_string(uint __form);
 extern char *time_to_string(time_t __time, uint __flags);
-extern char *bbs_to_string(__uint64_t __v, char *__c, uint __size);
-extern char *num_to_string(__uint64_t __v, char *__c, uint __size);
-extern char *pct_to_string(__uint64_t __v, __uint64_t __t, char *__c, uint __s);
+extern char *bbs_to_string(uint64_t __v, char *__c, uint __size);
+extern char *num_to_string(uint64_t __v, char *__c, uint __size);
+extern char *pct_to_string(uint64_t __v, uint64_t __t, char *__c, uint __s);
 
 extern FILE *fopen_write_secure(char *__filename);
 
@@ -81,7 +81,7 @@ enum {
  * Identifier (uid/gid/prid) cache routines
  */
 #define NMAX 32
-extern char *uid_to_name(__uint32_t __uid);
-extern char *gid_to_name(__uint32_t __gid);
-extern char *prid_to_name(__uint32_t __prid);
+extern char *uid_to_name(uint32_t __uid);
+extern char *gid_to_name(uint32_t __gid);
+extern char *prid_to_name(uint32_t __prid);
 extern bool isdigits_only(const char *);
diff -urpN xfsprogs-4.9.0/quota/report.c xfsprogs-4.14.0/quota/report.c
--- xfsprogs-4.9.0/quota/report.c	2017-01-05 18:42:06.000000000 +0100
+++ xfsprogs-4.14.0/quota/report.c	2017-11-20 01:14:14.000000000 +0100
@@ -333,9 +333,9 @@ report_header(
 static int
 report_mount(
 	FILE		*fp,
-	__uint32_t	id,
+	uint32_t	id,
 	char		*name,
-	__uint32_t	*oid,
+	uint32_t	*oid,
 	uint		form,
 	uint		type,
 	fs_path_t	*mount,
@@ -778,7 +778,7 @@ report_init(void)
 	report_cmd.args = _("[-bir] [-gpu] [-ahnt] [-f file]");
 	report_cmd.oneline = _("report filesystem quota information");
 	report_cmd.help = report_help;
-	report_cmd.flags = CMD_FLAG_GLOBAL | CMD_FLAG_FOREIGN_OK;
+	report_cmd.flags = CMD_FLAG_ONESHOT | CMD_FLAG_FOREIGN_OK;
 
 	if (expert) {
 		add_command(&dump_cmd);
diff -urpN xfsprogs-4.9.0/quota/state.c xfsprogs-4.14.0/quota/state.c
--- xfsprogs-4.9.0/quota/state.c	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/quota/state.c	2017-11-20 01:14:14.000000000 +0100
@@ -135,7 +135,7 @@ static void
 state_timelimit(
 	FILE		*fp,
 	uint		form,
-	__uint32_t	timelimit)
+	uint32_t	timelimit)
 {
 	fprintf(fp, _("%s grace time: %s\n"),
 		form_to_string(form),
diff -urpN xfsprogs-4.9.0/quota/util.c xfsprogs-4.14.0/quota/util.c
--- xfsprogs-4.9.0/quota/util.c	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/quota/util.c	2017-11-20 01:14:14.000000000 +0100
@@ -94,8 +94,8 @@ round_snprintf(
 	size_t		size,
 	const char	*fmt_round,
 	const char	*fmt_not_round,
-	__uint64_t	value,
-	__uint64_t	divisor)
+	uint64_t	value,
+	uint64_t	divisor)
 {
 	double		v = (double)value / divisor;
 
@@ -107,23 +107,23 @@ round_snprintf(
 }
 
 /* Basic blocks (512) bytes are returned from quotactl */
-#define BBS_TO_EXABYTES(bbs)	((__uint64_t)(bbs)>>51)
-#define BBS_TO_PETABYTES(bbs)	((__uint64_t)(bbs)>>41)
-#define BBS_TO_TERABYTES(bbs)	((__uint64_t)(bbs)>>31)
-#define BBS_TO_GIGABYTES(bbs)	((__uint64_t)(bbs)>>21)
-#define BBS_TO_MEGABYTES(bbs)	((__uint64_t)(bbs)>>11)
-#define BBS_TO_KILOBYTES(bbs)	((__uint64_t)(bbs)>>1)
-
-#define BBEXABYTE		((__uint64_t)1<<51)
-#define BBPETABYTE		((__uint64_t)1<<41)
-#define BBTERABYTE		((__uint64_t)1<<31)
-#define BBGIGABYTE		((__uint64_t)1<<21)
-#define BBMEGABYTE		((__uint64_t)1<<11)
-#define BBKILOBYTE		((__uint64_t)1<< 1)
+#define BBS_TO_EXABYTES(bbs)	((uint64_t)(bbs)>>51)
+#define BBS_TO_PETABYTES(bbs)	((uint64_t)(bbs)>>41)
+#define BBS_TO_TERABYTES(bbs)	((uint64_t)(bbs)>>31)
+#define BBS_TO_GIGABYTES(bbs)	((uint64_t)(bbs)>>21)
+#define BBS_TO_MEGABYTES(bbs)	((uint64_t)(bbs)>>11)
+#define BBS_TO_KILOBYTES(bbs)	((uint64_t)(bbs)>>1)
+
+#define BBEXABYTE		((uint64_t)1<<51)
+#define BBPETABYTE		((uint64_t)1<<41)
+#define BBTERABYTE		((uint64_t)1<<31)
+#define BBGIGABYTE		((uint64_t)1<<21)
+#define BBMEGABYTE		((uint64_t)1<<11)
+#define BBKILOBYTE		((uint64_t)1<< 1)
 
 char *
 bbs_to_string(
-	__uint64_t	v,
+	uint64_t	v,
 	char		*sp,
 	uint		size)
 {
@@ -146,17 +146,17 @@ bbs_to_string(
 	return sp;
 }
 
-#define THOUSAND		((__uint64_t)1000)
-#define MILLION			((__uint64_t)1000*1000)
-#define BILLION			((__uint64_t)1000*1000*1000)
-#define TRILLION		((__uint64_t)1000*1000*1000*1000)
-#define GAZILLION		((__uint64_t)1000*1000*1000*1000*1000)
-#define RIDICULOUS		((__uint64_t)1000*1000*1000*1000*1000*1000)
-#define STOPALREADY		((__uint64_t)1000*1000*1000*1000*1000*1000*1000)
+#define THOUSAND		((uint64_t)1000)
+#define MILLION			((uint64_t)1000*1000)
+#define BILLION			((uint64_t)1000*1000*1000)
+#define TRILLION		((uint64_t)1000*1000*1000*1000)
+#define GAZILLION		((uint64_t)1000*1000*1000*1000*1000)
+#define RIDICULOUS		((uint64_t)1000*1000*1000*1000*1000*1000)
+#define STOPALREADY		((uint64_t)1000*1000*1000*1000*1000*1000*1000)
 
 char *
 num_to_string(
-	__uint64_t	v,
+	uint64_t	v,
 	char		*sp,
 	uint		size)
 {
@@ -183,8 +183,8 @@ num_to_string(
 
 char *
 pct_to_string(
-	__uint64_t	portion,
-	__uint64_t	whole,
+	uint64_t	portion,
+	uint64_t	whole,
 	char		*buf,
 	uint		size)
 {
@@ -237,7 +237,7 @@ type_to_string(
 #define IDMASK		(NID-1)
 
 typedef struct {
-	__uint32_t	id;
+	uint32_t	id;
 	char		name[NMAX+1];
 } idcache_t;
 
@@ -250,7 +250,7 @@ static int		pentriesleft = NID;
 
 static idcache_t *
 getnextpwent(
-	__uint32_t	id,
+	uint32_t	id,
 	int		byid)
 {
 	struct passwd	*pw;
@@ -266,7 +266,7 @@ getnextpwent(
 
 static idcache_t *
 getnextgrent(
-	__uint32_t	id,
+	uint32_t	id,
 	int		byid)
 {
 	struct group	*gr;
@@ -281,7 +281,7 @@ getnextgrent(
 
 static idcache_t *
 getnextprent(
-	__uint32_t	id,
+	uint32_t	id,
 	int		byid)
 {
 	fs_project_t	*pr;
@@ -296,7 +296,7 @@ getnextprent(
 
 char *
 uid_to_name(
-	__uint32_t	id)
+	uint32_t	id)
 {
 	idcache_t	*ncp, *idp;
 
@@ -333,7 +333,7 @@ uid_to_name(
 
 char *
 gid_to_name(
-	__uint32_t	id)
+	uint32_t	id)
 {
 	idcache_t	*ncp, *idp;
 
@@ -370,7 +370,7 @@ gid_to_name(
 
 char *
 prid_to_name(
-	__uint32_t	id)
+	uint32_t	id)
 {
 	idcache_t	*ncp, *idp;
 
diff -urpN xfsprogs-4.9.0/repair/README xfsprogs-4.14.0/repair/README
--- xfsprogs-4.9.0/repair/README	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/repair/README	2017-11-20 01:14:14.000000000 +0100
@@ -189,7 +189,7 @@ D - 0) look at usage of XFS_MAKE_IPTR().
 
 
 D - 0) look at references to XFS_INODES_PER_CHUNK.  change the
-	ones that really mean sizeof(__uint64_t)*NBBY to
+	ones that really mean sizeof(uint64_t)*NBBY to
 	something else (like that only defined as a constant
 	INOS_PER_IREC. this isn't as important since
 	XFS_INODES_PER_CHUNK will never chang
diff -urpN xfsprogs-4.9.0/repair/agheader.h xfsprogs-4.14.0/repair/agheader.h
--- xfsprogs-4.9.0/repair/agheader.h	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/repair/agheader.h	2017-11-20 01:14:14.000000000 +0100
@@ -20,7 +20,7 @@ typedef struct fs_geometry  {
 	/*
 	 * these types should match the superblock types
 	 */
-	__uint32_t	sb_blocksize;	/* blocksize (bytes) */
+	uint32_t	sb_blocksize;	/* blocksize (bytes) */
 	xfs_rfsblock_t	sb_dblocks;	/* # data blocks */
 	xfs_rfsblock_t	sb_rblocks;	/* # realtime blocks */
 	xfs_rtblock_t	sb_rextents;	/* # realtime extents */
@@ -30,9 +30,9 @@ typedef struct fs_geometry  {
 	xfs_agnumber_t	sb_agcount;	/* # of ags */
 	xfs_extlen_t	sb_rbmblocks;	/* # of rt bitmap blocks */
 	xfs_extlen_t	sb_logblocks;	/* # of log blocks */
-	__uint16_t	sb_sectsize;	/* volume sector size (bytes) */
-	__uint16_t	sb_inodesize;	/* inode size (bytes) */
-	__uint8_t	sb_imax_pct;	/* max % of fs for inode space */
+	uint16_t	sb_sectsize;	/* volume sector size (bytes) */
+	uint16_t	sb_inodesize;	/* inode size (bytes) */
+	uint8_t		sb_imax_pct;	/* max % of fs for inode space */
 
 	/*
 	 * these don't have to match the superblock types but are placed
@@ -49,10 +49,10 @@ typedef struct fs_geometry  {
 	/*
 	 * fields after this point have to be checked manually in compare_sb()
 	 */
-	__uint8_t	sb_shared_vn;	/* shared version number */
+	uint8_t		sb_shared_vn;	/* shared version number */
 	xfs_extlen_t	sb_inoalignmt;	/* inode chunk alignment, fsblocks */
-	__uint32_t	sb_unit;	/* stripe or raid unit */
-	__uint32_t	sb_width;	/* stripe or width unit */
+	uint32_t	sb_unit;	/* stripe or raid unit */
+	uint32_t	sb_width;	/* stripe or width unit */
 
 	/*
 	 * these don't have to match, they track superblock properties
diff -urpN xfsprogs-4.9.0/repair/attr_repair.c xfsprogs-4.14.0/repair/attr_repair.c
--- xfsprogs-4.9.0/repair/attr_repair.c	2017-01-05 18:42:06.000000000 +0100
+++ xfsprogs-4.14.0/repair/attr_repair.c	2017-11-27 17:57:55.000000000 +0100
@@ -754,17 +754,22 @@ process_leaf_attr_level(xfs_mount_t	*mp,
 
 	da_bno = da_cursor->level[0].bno;
 	ino = da_cursor->ino;
+	/*
+	 * 0 is the root block and no block
+	 * pointer can point to the root block of the btree
+	 */
+	if (da_bno == 0) {
+		do_warn(
+	_("btree cycle detected in attribute fork for inode %" PRIu64 "\n"),
+			ino);
+		goto error_out;
+	}
+
 	prev_bno = 0;
 
 	do {
 		repair = 0;
 		dev_bno = blkmap_get(da_cursor->blkmap, da_bno);
-		/*
-		 * 0 is the root block and no block
-		 * pointer can point to the root block of the btree
-		 */
-		ASSERT(da_bno != 0);
-
 		if (dev_bno == NULLFSBLOCK) {
 			do_warn(
 	_("can't map block %u for attribute fork for inode %" PRIu64 "\n"),
@@ -938,14 +943,16 @@ __check_attr_header(
 	if (be64_to_cpu(info->owner) != ino) {
 		do_warn(
 _("expected owner inode %" PRIu64 ", got %llu, attr block %" PRIu64 "\n"),
-			ino, be64_to_cpu(info->owner), bp->b_bn);
+			ino, (unsigned long long)be64_to_cpu(info->owner),
+			bp->b_bn);
 		return 1;
 	}
 	/* verify block number */
 	if (be64_to_cpu(info->blkno) != bp->b_bn) {
 		do_warn(
 _("expected block %" PRIu64 ", got %llu, inode %" PRIu64 "attr block\n"),
-			bp->b_bn, be64_to_cpu(info->blkno), ino);
+			bp->b_bn, (unsigned long long)be64_to_cpu(info->blkno),
+			ino);
 		return 1;
 	}
 	/* verify uuid */
diff -urpN xfsprogs-4.9.0/repair/attr_repair.h xfsprogs-4.14.0/repair/attr_repair.h
--- xfsprogs-4.9.0/repair/attr_repair.h	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/repair/attr_repair.h	2017-11-20 01:14:14.000000000 +0100
@@ -32,10 +32,10 @@
 #define ACL_WRITE	02
 #define ACL_EXECUTE	01
 
-typedef __uint16_t	xfs_acl_perm_t;
-typedef __int32_t	xfs_acl_type_t;
-typedef __int32_t	xfs_acl_tag_t;
-typedef __int32_t	xfs_acl_id_t;
+typedef uint16_t	xfs_acl_perm_t;
+typedef int32_t		xfs_acl_type_t;
+typedef int32_t		xfs_acl_tag_t;
+typedef int32_t		xfs_acl_id_t;
 
 /*
  * "icacl" = in-core ACL. There is no equivalent in the XFS kernel code,
@@ -50,7 +50,7 @@ struct xfs_icacl_entry {
 };
 
 struct xfs_icacl {
-	__int32_t		acl_cnt;
+	int32_t			acl_cnt;
 	struct xfs_icacl_entry	acl_entry[0];
 };
 
@@ -59,14 +59,14 @@ struct xfs_icacl {
  */
 #define XFS_MAC_MAX_SETS	250
 typedef struct xfs_mac_label {
-	__uint8_t       ml_msen_type;	/* MSEN label type */
-	__uint8_t       ml_mint_type;	/* MINT label type */
-	__uint8_t       ml_level;	/* Hierarchical level */
-	__uint8_t       ml_grade;	/* Hierarchical grade */
-	__uint16_t      ml_catcount;	/* Category count */
-	__uint16_t      ml_divcount;	/* Division count */
+	uint8_t       ml_msen_type;	/* MSEN label type */
+	uint8_t       ml_mint_type;	/* MINT label type */
+	uint8_t       ml_level;	/* Hierarchical level */
+	uint8_t       ml_grade;	/* Hierarchical grade */
+	uint16_t      ml_catcount;	/* Category count */
+	uint16_t      ml_divcount;	/* Division count */
 					/* Category set, then Division set */
-	__uint16_t      ml_list[XFS_MAC_MAX_SETS];
+	uint16_t      ml_list[XFS_MAC_MAX_SETS];
 } xfs_mac_label_t;
 
 /* MSEN label type names. Choose an upper case ASCII character.  */
@@ -93,7 +93,7 @@ typedef struct xfs_mac_label {
 /*
  * Capabilities (IRIX)
  */
-typedef __uint64_t xfs_cap_value_t;
+typedef uint64_t xfs_cap_value_t;
 
 typedef struct xfs_cap_set {
 	xfs_cap_value_t	cap_effective;  /* use in capability checks */
diff -urpN xfsprogs-4.9.0/repair/avl64.c xfsprogs-4.14.0/repair/avl64.c
--- xfsprogs-4.9.0/repair/avl64.c	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/repair/avl64.c	2017-11-20 01:14:14.000000000 +0100
@@ -70,8 +70,8 @@ avl64_checktree(
 	avl64node_t *root)
 {
 	avl64node_t *nlast, *nnext, *np;
-	__uint64_t offset = 0;
-	__uint64_t end;
+	uint64_t offset = 0;
+	uint64_t end;
 
 	nlast = nnext = root;
 
@@ -583,8 +583,8 @@ attach:
 avl64node_t *
 avl64_findanyrange(
 	avl64tree_desc_t *tree,
-	__uint64_t start,
-	__uint64_t end,
+	uint64_t start,
+	uint64_t end,
 	int	checklen)
 {
 	avl64node_t *np = tree->avl_root;
@@ -655,7 +655,7 @@ avl64_findanyrange(
 avl64node_t *
 avl64_findrange(
 	avl64tree_desc_t *tree,
-	__uint64_t value)
+	uint64_t value)
 {
 	avl64node_t *np = tree->avl_root;
 
@@ -682,10 +682,10 @@ avl64_findrange(
 avl64node_t *
 avl64_find(
 	avl64tree_desc_t *tree,
-	__uint64_t value)
+	uint64_t value)
 {
 	avl64node_t *np = tree->avl_root;
-	__uint64_t nvalue;
+	uint64_t nvalue;
 
 	while (np) {
 		nvalue = AVL_START(tree, np);
@@ -909,8 +909,8 @@ static
 avl64node_t *
 avl64_insert_find_growth(
 		avl64tree_desc_t *tree,
-		__uint64_t start,	/* range start at start, */
-		__uint64_t end,	/* exclusive */
+		uint64_t start,	/* range start at start, */
+		uint64_t end,	/* exclusive */
 		int   *growthp)	/* OUT */
 {
 	avl64node_t *root = tree->avl_root;
@@ -963,7 +963,7 @@ avl64_insert_grow(
 	int growth)
 {
 	avl64node_t *nnext;
-	__uint64_t start = AVL_START(tree, newnode);
+	uint64_t start = AVL_START(tree, newnode);
 
 	if (growth == AVL_BACK) {
 
@@ -1005,8 +1005,8 @@ avl64_insert(
 	avl64node_t *newnode)
 {
 	avl64node_t *np;
-	__uint64_t start = AVL_START(tree, newnode);
-	__uint64_t end = AVL_END(tree, newnode);
+	uint64_t start = AVL_START(tree, newnode);
+	uint64_t end = AVL_END(tree, newnode);
 	int growth;
 
 	ASSERT(newnode);
@@ -1159,16 +1159,16 @@ avl64ops_t avl_debug_ops = {
 	avl_debug_end,
 }
 
-static __uint64_t
+static uint64_t
 avl64_debug_start(avl64node_t *node)
 {
-	return (__uint64_t)(struct avl_debug_node *)node->avl_start;
+	return (uint64_t)(struct avl_debug_node *)node->avl_start;
 }
 
-static __uint64_t
+static uint64_t
 avl64_debug_end(avl64node_t *node)
 {
-	return (__uint64_t)
+	return (uint64_t)
 		((struct avl_debug_node *)node->avl_start +
 		 (struct avl_debug_node *)node->avl_size);
 }
@@ -1304,7 +1304,7 @@ main()
 avl64node_t *
 avl64_findadjacent(
 	avl64tree_desc_t *tree,
-	__uint64_t value,
+	uint64_t value,
 	int		dir)
 {
 	avl64node_t *np = tree->avl_root;
@@ -1378,8 +1378,8 @@ avl64_findadjacent(
 void
 avl64_findranges(
 	avl64tree_desc_t *tree,
-	__uint64_t start,
-	__uint64_t end,
+	uint64_t start,
+	uint64_t end,
 	avl64node_t	        **startp,
 	avl64node_t		**endp)
 {
diff -urpN xfsprogs-4.9.0/repair/avl64.h xfsprogs-4.14.0/repair/avl64.h
--- xfsprogs-4.9.0/repair/avl64.h	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/repair/avl64.h	2017-11-20 01:14:14.000000000 +0100
@@ -32,8 +32,8 @@ typedef struct	avl64node {
  * avl-tree operations
  */
 typedef struct avl64ops {
-	__uint64_t	(*avl_start)(avl64node_t *);
-	__uint64_t	(*avl_end)(avl64node_t *);
+	uint64_t	(*avl_start)(avl64node_t *);
+	uint64_t	(*avl_end)(avl64node_t *);
 } avl64ops_t;
 
 /*
@@ -89,32 +89,32 @@ avl64_init_tree(
 avl64node_t *
 avl64_findrange(
 	avl64tree_desc_t *tree,
-	__uint64_t value);
+	uint64_t value);
 
 avl64node_t *
 avl64_find(
 	avl64tree_desc_t *tree,
-	__uint64_t value);
+	uint64_t value);
 
 avl64node_t *
 avl64_findanyrange(
 	avl64tree_desc_t *tree,
-	__uint64_t	start,
-	__uint64_t	end,
+	uint64_t	start,
+	uint64_t	end,
 	int     checklen);
 
 
 avl64node_t *
 avl64_findadjacent(
 	avl64tree_desc_t *tree,
-	__uint64_t	value,
+	uint64_t	value,
 	int		dir);
 
 void
 avl64_findranges(
 	avl64tree_desc_t *tree,
-	__uint64_t	start,
-	__uint64_t	end,
+	uint64_t	start,
+	uint64_t	end,
 	avl64node_t	        **startp,
 	avl64node_t		**endp);
 
diff -urpN xfsprogs-4.9.0/repair/dino_chunks.c xfsprogs-4.14.0/repair/dino_chunks.c
--- xfsprogs-4.9.0/repair/dino_chunks.c	2016-12-13 21:07:15.000000000 +0100
+++ xfsprogs-4.14.0/repair/dino_chunks.c	2017-11-20 01:14:14.000000000 +0100
@@ -826,8 +826,6 @@ next_readbuf:
 		 * we do now, this is where to start.
 		 */
 		if (is_used)  {
-			__uint16_t	di_mode;
-
 			if (is_inode_free(ino_rec, irec_offset))  {
 				if (verbose || no_modify)  {
 					do_warn(
@@ -846,10 +844,8 @@ next_readbuf:
 			 * store the on-disk file type for comparing in
 			 * phase 6.
 			 */
-			di_mode = be16_to_cpu(dino->di_mode);
-			di_mode = (di_mode & S_IFMT) >> S_SHIFT;
 			set_inode_ftype(ino_rec, irec_offset,
-					xfs_mode_to_ftype[di_mode]);
+				xfs_mode_to_ftype(be16_to_cpu(dino->di_mode)));
 
 			/*
 			 * store on-disk nlink count for comparing in phase 7
diff -urpN xfsprogs-4.9.0/repair/dinode.c xfsprogs-4.14.0/repair/dinode.c
--- xfsprogs-4.9.0/repair/dinode.c	2016-12-13 21:07:15.000000000 +0100
+++ xfsprogs-4.14.0/repair/dinode.c	2017-11-27 17:57:55.000000000 +0100
@@ -746,7 +746,7 @@ _("%s fork in ino %" PRIu64 " claims dup
 			case XR_E_FREE1:
 				do_warn(
 _("%s fork in ino %" PRIu64 " claims free block %" PRIu64 "\n"),
-					forkname, ino, (__uint64_t) b);
+					forkname, ino, (uint64_t) b);
 				/* fall through ... */
 			case XR_E_INUSE1:	/* seen by rmap */
 			case XR_E_UNKNOWN:
@@ -764,6 +764,7 @@ _("%s fork in ino %" PRIu64 " claims fre
 			case XR_E_FS_MAP:
 			case XR_E_INO:
 			case XR_E_INUSE_FS:
+			case XR_E_REFC:
 				do_warn(
 _("%s fork in inode %" PRIu64 " claims metadata block %" PRIu64 "\n"),
 					forkname, ino, b);
@@ -780,6 +781,12 @@ _("%s fork in %s inode %" PRIu64 " claim
 					forkname, ftype, ino, b);
 				goto done;
 
+			case XR_E_COW:
+				do_warn(
+_("%s fork in %s inode %" PRIu64 " claims CoW block %" PRIu64 "\n"),
+					forkname, ftype, ino, b);
+				goto done;
+
 			default:
 				do_error(
 _("illegal state %d in block map %" PRIu64 "\n"),
@@ -923,7 +930,7 @@ process_btinode(
 	int			type,
 	int			*dirty,
 	xfs_rfsblock_t		*tot,
-	__uint64_t		*nex,
+	uint64_t		*nex,
 	blkmap_t		**blkmapp,
 	int			whichfork,
 	int			check_dups)
@@ -939,7 +946,7 @@ process_btinode(
 	int			level;
 	int			numrecs;
 	bmap_cursor_t		cursor;
-	__uint64_t		magic;
+	uint64_t		magic;
 
 	dib = (xfs_bmdr_block_t *)XFS_DFORK_PTR(dip, whichfork);
 	lino = XFS_AGINO_TO_INO(mp, agno, ino);
@@ -1098,7 +1105,7 @@ process_exinode(
 	int			type,
 	int			*dirty,
 	xfs_rfsblock_t		*tot,
-	__uint64_t		*nex,
+	uint64_t		*nex,
 	blkmap_t		**blkmapp,
 	int			whichfork,
 	int			check_dups)
@@ -1200,14 +1207,14 @@ process_symlink_extlist(xfs_mount_t *mp,
 		do_warn(
 _("mismatch between format (%d) and size (%" PRId64 ") in symlink ino %" PRIu64 "\n"),
 			dino->di_format,
-			(__int64_t)be64_to_cpu(dino->di_size), lino);
+			(int64_t)be64_to_cpu(dino->di_size), lino);
 		return 1;
 	}
 	if (dino->di_format == XFS_DINODE_FMT_LOCAL) {
 		do_warn(
 _("mismatch between format (%d) and size (%" PRId64 ") in symlink inode %" PRIu64 "\n"),
 			dino->di_format,
-			(__int64_t)be64_to_cpu(dino->di_size), lino);
+			(int64_t)be64_to_cpu(dino->di_size), lino);
 		return 1;
 	}
 
@@ -1259,7 +1266,7 @@ null_check(char *name, int length)
 {
 	int i;
 
-	ASSERT(length < MAXPATHLEN);
+	ASSERT(length < XFS_SYMLINK_MAXLEN);
 
 	for (i = 0; i < length; i++, name++)  {
 		if (*name == '\0')
@@ -1371,7 +1378,7 @@ process_symlink(
 	blkmap_t 	*blkmap)
 {
 	char			*symlink;
-	char			data[MAXPATHLEN];
+	char			data[XFS_SYMLINK_MAXLEN];
 
 	/*
 	 * check size against kernel symlink limits.  we know
@@ -1379,12 +1386,17 @@ process_symlink(
 	 * the inode is structurally ok so we don't have to check
 	 * for that
 	 */
-	if (be64_to_cpu(dino->di_size) >= MAXPATHLEN)  {
+	if (be64_to_cpu(dino->di_size) >= XFS_SYMLINK_MAXLEN)  {
 	       do_warn(_("symlink in inode %" PRIu64 " too long (%llu chars)\n"),
 		       lino, (unsigned long long) be64_to_cpu(dino->di_size));
 		return(1);
 	}
 
+	if (be64_to_cpu(dino->di_size) == 0) {
+		do_warn(_("zero size symlink in inode %" PRIu64 "\n"), lino);
+		return 1;
+	}
+
 	/*
 	 * have to check symlink component by component.
 	 * get symlink contents into data area
@@ -1449,22 +1461,22 @@ _("inode %" PRIu64 " has bad inode type
 		case XR_INO_CHRDEV:
 			do_warn(
 _("size of character device inode %" PRIu64 " != 0 (%" PRId64 " bytes)\n"), lino,
-				(__int64_t)be64_to_cpu(dino->di_size));
+				(int64_t)be64_to_cpu(dino->di_size));
 			break;
 		case XR_INO_BLKDEV:
 			do_warn(
 _("size of block device inode %" PRIu64 " != 0 (%" PRId64 " bytes)\n"), lino,
-				(__int64_t)be64_to_cpu(dino->di_size));
+				(int64_t)be64_to_cpu(dino->di_size));
 			break;
 		case XR_INO_SOCK:
 			do_warn(
 _("size of socket inode %" PRIu64 " != 0 (%" PRId64 " bytes)\n"), lino,
-				(__int64_t)be64_to_cpu(dino->di_size));
+				(int64_t)be64_to_cpu(dino->di_size));
 			break;
 		case XR_INO_FIFO:
 			do_warn(
 _("size of fifo inode %" PRIu64 " != 0 (%" PRId64 " bytes)\n"), lino,
-				(__int64_t)be64_to_cpu(dino->di_size));
+				(int64_t)be64_to_cpu(dino->di_size));
 			break;
 		default:
 			do_warn(_("Internal error - process_misc_ino_types, "
@@ -1738,12 +1750,12 @@ _("found inode %" PRIu64 " claiming to b
 		break;
 
 	case XR_INO_RTBITMAP:
-		if (size != (__int64_t)mp->m_sb.sb_rbmblocks *
+		if (size != (int64_t)mp->m_sb.sb_rbmblocks *
 					mp->m_sb.sb_blocksize) {
 			do_warn(
 _("realtime bitmap inode %" PRIu64 " has bad size %" PRId64 " (should be %" PRIu64 ")\n"),
 				lino, size,
-				(__int64_t) mp->m_sb.sb_rbmblocks *
+				(int64_t) mp->m_sb.sb_rbmblocks *
 					mp->m_sb.sb_blocksize);
 			return 1;
 		}
@@ -1812,8 +1824,8 @@ static int
 process_inode_blocks_and_extents(
 	xfs_dinode_t	*dino,
 	xfs_rfsblock_t	nblocks,
-	__uint64_t	nextents,
-	__uint64_t	anextents,
+	uint64_t	nextents,
+	uint64_t	anextents,
 	xfs_ino_t	lino,
 	int		*dirty)
 {
@@ -1903,7 +1915,7 @@ process_inode_data_fork(
 	int		type,
 	int		*dirty,
 	xfs_rfsblock_t	*totblocks,
-	__uint64_t	*nextents,
+	uint64_t	*nextents,
 	blkmap_t	**dblkmap,
 	int		check_dups)
 {
@@ -2012,7 +2024,7 @@ process_inode_attr_fork(
 	int		type,
 	int		*dirty,
 	xfs_rfsblock_t	*atotblocks,
-	__uint64_t	*anextents,
+	uint64_t	*anextents,
 	int		check_dups,
 	int		extra_attr_check,
 	int		*retval)
@@ -2223,8 +2235,8 @@ process_dinode_int(xfs_mount_t *mp,
 	int			di_mode;
 	int			type;
 	int			retval = 0;
-	__uint64_t		nextents;
-	__uint64_t		anextents;
+	uint64_t		nextents;
+	uint64_t		anextents;
 	xfs_ino_t		lino;
 	const int		is_free = 0;
 	const int		is_used = 1;
@@ -2318,7 +2330,8 @@ process_dinode_int(xfs_mount_t *mp,
 			if (!uncertain)
 				do_warn(
 _("inode identifier %llu mismatch on inode %" PRIu64 "\n"),
-					be64_to_cpu(dino->di_ino), lino);
+					(unsigned long long)be64_to_cpu(dino->di_ino),
+					lino);
 			if (verify_mode)
 				return 1;
 			goto clear_bad_out;
@@ -2341,7 +2354,7 @@ _("inode identifier %llu mismatch on ino
 		if (!uncertain)
 			do_warn(
 _("bad (negative) size %" PRId64 " on inode %" PRIu64 "\n"),
-				(__int64_t)be64_to_cpu(dino->di_size),
+				(int64_t)be64_to_cpu(dino->di_size),
 				lino);
 		if (verify_mode)
 			return 1;
@@ -2497,6 +2510,18 @@ _("bad (negative) size %" PRId64 " on in
 			flags2 &= XFS_DIFLAG2_ANY;
 		}
 
+		if (flags2 & XFS_DIFLAG2_DAX) {
+			/* must be a file or dir */
+			if (di_mode && !(S_ISREG(di_mode) || S_ISDIR(di_mode))) {
+				if (!uncertain) {
+					do_warn(
+	_("DAX flag set on special inode %" PRIu64 "\n"),
+						lino);
+				}
+				flags2 &= ~XFS_DIFLAG2_DAX;
+			}
+		}
+
 		if ((flags2 & XFS_DIFLAG2_REFLINK) &&
 		    !xfs_sb_version_hasreflink(&mp->m_sb)) {
 			if (!uncertain) {
@@ -2669,6 +2694,7 @@ _("Cannot have non-zero CoW extent size
 					be32_to_cpu(dino->di_cowextsize), lino);
 			if (!no_modify)  {
 				do_warn(_("resetting to zero\n"));
+				dino->di_flags2 &= ~cpu_to_be64(XFS_DIFLAG2_COWEXTSIZE);
 				dino->di_cowextsize = 0;
 				*dirty = 1;
 			} else
@@ -2676,6 +2702,24 @@ _("Cannot have non-zero CoW extent size
 		}
 	}
 
+	/*
+	 * Can't have the COWEXTSIZE flag set with no hint.
+	 */
+	if (dino->di_version >= 3 &&
+	    be32_to_cpu(dino->di_cowextsize) == 0 &&
+	    (be64_to_cpu(dino->di_flags2) & XFS_DIFLAG2_COWEXTSIZE)) {
+		do_warn(
+_("Cannot have CoW extent size of zero on cowextsize inode %" PRIu64 ", "),
+				lino);
+		if (!no_modify)  {
+			do_warn(_("clearing cowextsize flag\n"));
+			dino->di_flags2 &= ~cpu_to_be64(XFS_DIFLAG2_COWEXTSIZE);
+			*dirty = 1;
+		} else {
+			do_warn(_("would clear cowextsize flag\n"));
+		}
+	}
+
 	/*
 	 * general size/consistency checks:
 	 */
diff -urpN xfsprogs-4.9.0/repair/dinode.h xfsprogs-4.14.0/repair/dinode.h
--- xfsprogs-4.9.0/repair/dinode.h	2016-12-13 21:07:15.000000000 +0100
+++ xfsprogs-4.14.0/repair/dinode.h	2017-11-20 01:14:14.000000000 +0100
@@ -46,8 +46,8 @@ process_bmbt_reclist(xfs_mount_t	*mp,
 		xfs_ino_t		ino,
 		xfs_rfsblock_t		*tot,
 		struct blkmap		**blkmapp,
-		__uint64_t		*first_key,
-		__uint64_t		*last_key,
+		uint64_t		*first_key,
+		uint64_t		*last_key,
 		int			whichfork);
 
 int
diff -urpN xfsprogs-4.9.0/repair/dir2.c xfsprogs-4.14.0/repair/dir2.c
--- xfsprogs-4.9.0/repair/dir2.c	2017-01-05 18:41:55.000000000 +0100
+++ xfsprogs-4.14.0/repair/dir2.c	2017-11-20 01:14:14.000000000 +0100
@@ -160,7 +160,7 @@ process_sf_dir2(
 	int			bad_sfnamelen;
 	int			i;
 	int			i8;
-	__int64_t		ino_dir_size;
+	int64_t			ino_dir_size;
 	int			ino_off;
 	ino_tree_node_t		*irec_p;
 	int			junkit;
@@ -921,8 +921,8 @@ _("bad bestfree table in block %u in dir
 			da_bno, ino);
 		if (!no_modify) {
 			do_warn(_("repairing table\n"));
-			libxfs_dir2_data_freescan(mp->m_dir_geo, M_DIROPS(mp),
-						  d, &i);
+			libxfs_dir2_data_freescan_int(mp->m_dir_geo,
+					M_DIROPS(mp), d, &i);
 			*dirty = 1;
 		} else {
 			do_warn(_("would repair table\n"));
diff -urpN xfsprogs-4.9.0/repair/globals.h xfsprogs-4.14.0/repair/globals.h
--- xfsprogs-4.9.0/repair/globals.h	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/repair/globals.h	2017-11-20 01:14:14.000000000 +0100
@@ -50,7 +50,8 @@
 #define XR_BAD_SB_WIDTH		18	/* bad stripe width */
 #define XR_BAD_SVN		19	/* bad shared version number */
 #define XR_BAD_CRC		20	/* Bad CRC */
-#define XR_BAD_ERR_CODE		21	/* Bad error code */
+#define XR_BAD_DIR_SIZE_DATA	21	/* Bad directory geometry */
+#define XR_BAD_ERR_CODE		22	/* Bad error code */
 
 /* XFS filesystem (il)legal values */
 
@@ -140,7 +141,7 @@ EXTERN int		inodes_per_cluster;
 EXTERN unsigned int	glob_agcount;
 EXTERN int		chunks_pblock;	/* # of 64-ino chunks per allocation */
 EXTERN int		max_symlink_blocks;
-EXTERN __int64_t	fs_max_file_offset;
+EXTERN int64_t		fs_max_file_offset;
 
 /* realtime info */
 
@@ -160,24 +161,24 @@ EXTERN int		full_ino_ex_data;/*
 
 /* superblock counters */
 
-EXTERN __uint64_t	sb_icount;	/* allocated (made) inodes */
-EXTERN __uint64_t	sb_ifree;	/* free inodes */
-EXTERN __uint64_t	sb_fdblocks;	/* free data blocks */
-EXTERN __uint64_t	sb_frextents;	/* free realtime extents */
+EXTERN uint64_t	sb_icount;	/* allocated (made) inodes */
+EXTERN uint64_t	sb_ifree;	/* free inodes */
+EXTERN uint64_t	sb_fdblocks;	/* free data blocks */
+EXTERN uint64_t	sb_frextents;	/* free realtime extents */
 
 /* superblock geometry info */
 
 EXTERN xfs_extlen_t	sb_inoalignmt;
-EXTERN __uint32_t	sb_unit;
-EXTERN __uint32_t	sb_width;
+EXTERN uint32_t	sb_unit;
+EXTERN uint32_t	sb_width;
 
 struct aglock {
 	pthread_mutex_t	lock __attribute__((__aligned__(64)));
 };
 EXTERN struct aglock	*ag_locks;
 
-EXTERN int 		report_interval;
-EXTERN __uint64_t 	*prog_rpt_done;
+EXTERN int		report_interval;
+EXTERN uint64_t		*prog_rpt_done;
 
 EXTERN int		ag_stride;
 EXTERN int		thread_count;
diff -urpN xfsprogs-4.9.0/repair/incore.c xfsprogs-4.14.0/repair/incore.c
--- xfsprogs-4.9.0/repair/incore.c	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/repair/incore.c	2017-11-20 01:14:14.000000000 +0100
@@ -179,7 +179,7 @@ get_bmap_ext(
 static uint64_t		*rt_bmap;
 static size_t		rt_bmap_size;
 
-/* block records fit into __uint64_t's units */
+/* block records fit into uint64_t's units */
 #define XR_BB_UNIT	64			/* number of bits/unit */
 #define XR_BB		4			/* bits per block record */
 #define XR_BB_NUM	(XR_BB_UNIT/XR_BB)	/* number of records per unit */
@@ -203,8 +203,8 @@ set_rtbmap(
 {
 	*(rt_bmap + bno / XR_BB_NUM) =
 	 ((*(rt_bmap + bno / XR_BB_NUM) &
-	  (~((__uint64_t) XR_BB_MASK << ((bno % XR_BB_NUM) * XR_BB)))) |
-	 (((__uint64_t) state) << ((bno % XR_BB_NUM) * XR_BB)));
+	  (~((uint64_t) XR_BB_MASK << ((bno % XR_BB_NUM) * XR_BB)))) |
+	 (((uint64_t) state) << ((bno % XR_BB_NUM) * XR_BB)));
 }
 
 static void
@@ -222,9 +222,9 @@ init_rt_bmap(
 		return;
 
 	rt_bmap_size = roundup(mp->m_sb.sb_rextents / (NBBY / XR_BB),
-			       sizeof(__uint64_t));
+			       sizeof(uint64_t));
 
-	rt_bmap = memalign(sizeof(__uint64_t), rt_bmap_size);
+	rt_bmap = memalign(sizeof(uint64_t), rt_bmap_size);
 	if (!rt_bmap) {
 		do_error(
 	_("couldn't allocate realtime block map, size = %" PRIu64 "\n"),
diff -urpN xfsprogs-4.9.0/repair/incore.h xfsprogs-4.14.0/repair/incore.h
--- xfsprogs-4.9.0/repair/incore.h	2016-12-13 21:07:15.000000000 +0100
+++ xfsprogs-4.14.0/repair/incore.h	2017-11-20 01:14:14.000000000 +0100
@@ -257,7 +257,7 @@ typedef xfs_ino_t parent_entry_t;
 struct nlink_ops;
 
 typedef struct parent_list  {
-	__uint64_t		pmask;
+	uint64_t		pmask;
 	parent_entry_t		*pentries;
 #ifdef DEBUG
 	short			cnt;
@@ -265,14 +265,14 @@ typedef struct parent_list  {
 } parent_list_t;
 
 union ino_nlink {
-	__uint8_t	*un8;
-	__uint16_t	*un16;
-	__uint32_t	*un32;
+	uint8_t		*un8;
+	uint16_t	*un16;
+	uint32_t	*un32;
 };
 
 typedef struct ino_ex_data  {
-	__uint64_t		ino_reached;	/* bit == 1 if reached */
-	__uint64_t		ino_processed;	/* reference checked bit mask */
+	uint64_t		ino_reached;	/* bit == 1 if reached */
+	uint64_t		ino_processed;	/* reference checked bit mask */
 	parent_list_t		*parents;
 	union ino_nlink		counted_nlinks;/* counted nlinks in P6 */
 } ino_ex_data_t;
@@ -281,22 +281,22 @@ typedef struct ino_tree_node  {
 	avlnode_t		avl_node;
 	xfs_agino_t		ino_startnum;	/* starting inode # */
 	xfs_inofree_t		ir_free;	/* inode free bit mask */
-	__uint64_t		ir_sparse;	/* sparse inode bitmask */
-	__uint64_t		ino_confirmed;	/* confirmed bitmask */
-	__uint64_t		ino_isa_dir;	/* bit == 1 if a directory */
-	__uint64_t		ino_was_rl;	/* bit == 1 if reflink flag set */
-	__uint64_t		ino_is_rl;	/* bit == 1 if reflink flag should be set */
-	__uint8_t		nlink_size;
+	uint64_t		ir_sparse;	/* sparse inode bitmask */
+	uint64_t		ino_confirmed;	/* confirmed bitmask */
+	uint64_t		ino_isa_dir;	/* bit == 1 if a directory */
+	uint64_t		ino_was_rl;	/* bit == 1 if reflink flag set */
+	uint64_t		ino_is_rl;	/* bit == 1 if reflink flag should be set */
+	uint8_t			nlink_size;
 	union ino_nlink		disk_nlinks;	/* on-disk nlinks, set in P3 */
 	union  {
 		ino_ex_data_t	*ex_data;	/* phases 6,7 */
 		parent_list_t	*plist;		/* phases 2-5 */
 	} ino_un;
-	__uint8_t		*ftypes;	/* phases 3,6 */
+	uint8_t			*ftypes;	/* phases 3,6 */
 } ino_tree_node_t;
 
-#define INOS_PER_IREC	(sizeof(__uint64_t) * NBBY)
-#define	IREC_MASK(i)	((__uint64_t)1 << (i))
+#define INOS_PER_IREC	(sizeof(uint64_t) * NBBY)
+#define	IREC_MASK(i)	((uint64_t)1 << (i))
 
 void		add_ino_ex_data(xfs_mount_t *mp);
 
@@ -543,10 +543,10 @@ static inline int inode_is_rl(struct ino
  */
 void add_inode_ref(struct ino_tree_node *irec, int offset);
 void drop_inode_ref(struct ino_tree_node *irec, int offset);
-__uint32_t num_inode_references(struct ino_tree_node *irec, int offset);
+uint32_t num_inode_references(struct ino_tree_node *irec, int offset);
 
-void set_inode_disk_nlinks(struct ino_tree_node *irec, int offset, __uint32_t nlinks);
-__uint32_t get_inode_disk_nlinks(struct ino_tree_node *irec, int offset);
+void set_inode_disk_nlinks(struct ino_tree_node *irec, int offset, uint32_t nlinks);
+uint32_t get_inode_disk_nlinks(struct ino_tree_node *irec, int offset);
 
 static inline int is_inode_reached(struct ino_tree_node *irec, int offset)
 {
@@ -567,13 +567,13 @@ static inline void add_inode_reached(str
 static inline void
 set_inode_ftype(struct ino_tree_node *irec,
 	int		ino_offset,
-	__uint8_t	ftype)
+	uint8_t		ftype)
 {
 	if (irec->ftypes)
 		irec->ftypes[ino_offset] = ftype;
 }
 
-static inline __uint8_t
+static inline uint8_t
 get_inode_ftype(
 	struct ino_tree_node *irec,
 	int		ino_offset)
@@ -606,11 +606,11 @@ typedef struct bm_level_state  {
 	xfs_fsblock_t		fsbno;
 	xfs_fsblock_t		left_fsbno;
 	xfs_fsblock_t		right_fsbno;
-	__uint64_t		first_key;
-	__uint64_t		last_key;
+	uint64_t		first_key;
+	uint64_t		last_key;
 /*
 	int			level;
-	__uint64_t		prev_last_key;
+	uint64_t		prev_last_key;
 	xfs_buf_t		*bp;
 	xfs_bmbt_block_t	*block;
 */
diff -urpN xfsprogs-4.9.0/repair/incore_ext.c xfsprogs-4.14.0/repair/incore_ext.c
--- xfsprogs-4.9.0/repair/incore_ext.c	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/repair/incore_ext.c	2017-11-20 01:14:14.000000000 +0100
@@ -721,13 +721,13 @@ search_rt_dup_extent(xfs_mount_t *mp, xf
 	return(ret);
 }
 
-static __uint64_t
+static uint64_t
 avl64_rt_ext_start(avl64node_t *node)
 {
 	return(((rt_extent_tree_node_t *) node)->rt_startblock);
 }
 
-static __uint64_t
+static uint64_t
 avl64_ext_end(avl64node_t *node)
 {
 	return(((rt_extent_tree_node_t *) node)->rt_startblock +
@@ -834,7 +834,7 @@ count_extents(xfs_agnumber_t agno, avltr
 int
 count_bno_extents_blocks(xfs_agnumber_t agno, uint *numblocks)
 {
-	__uint64_t nblocks;
+	uint64_t nblocks;
 	extent_tree_node_t *node;
 	int i = 0;
 
diff -urpN xfsprogs-4.9.0/repair/incore_ino.c xfsprogs-4.14.0/repair/incore_ino.c
--- xfsprogs-4.9.0/repair/incore_ino.c	2016-12-13 21:07:15.000000000 +0100
+++ xfsprogs-4.14.0/repair/incore_ino.c	2017-11-20 01:14:14.000000000 +0100
@@ -38,7 +38,7 @@ static avltree_desc_t	**inode_uncertain_
 /* memory optimised nlink counting for all inodes */
 
 static void *
-alloc_nlink_array(__uint8_t nlink_size)
+alloc_nlink_array(uint8_t nlink_size)
 {
 	void *ptr;
 
@@ -51,10 +51,10 @@ alloc_nlink_array(__uint8_t nlink_size)
 static void
 nlink_grow_8_to_16(ino_tree_node_t *irec)
 {
-	__uint16_t	*new_nlinks;
+	uint16_t	*new_nlinks;
 	int		i;
 
-	irec->nlink_size = sizeof(__uint16_t);
+	irec->nlink_size = sizeof(uint16_t);
 
 	new_nlinks = alloc_nlink_array(irec->nlink_size);
 	for (i = 0; i < XFS_INODES_PER_CHUNK; i++)
@@ -76,10 +76,10 @@ nlink_grow_8_to_16(ino_tree_node_t *irec
 static void
 nlink_grow_16_to_32(ino_tree_node_t *irec)
 {
-	__uint32_t	*new_nlinks;
+	uint32_t	*new_nlinks;
 	int		i;
 
-	irec->nlink_size = sizeof(__uint32_t);
+	irec->nlink_size = sizeof(uint32_t);
 
 	new_nlinks = alloc_nlink_array(irec->nlink_size);
 	for (i = 0; i < XFS_INODES_PER_CHUNK; i++)
@@ -104,21 +104,21 @@ void add_inode_ref(struct ino_tree_node
 	ASSERT(irec->ino_un.ex_data != NULL);
 
 	switch (irec->nlink_size) {
-	case sizeof(__uint8_t):
+	case sizeof(uint8_t):
 		if (irec->ino_un.ex_data->counted_nlinks.un8[ino_offset] < 0xff) {
 			irec->ino_un.ex_data->counted_nlinks.un8[ino_offset]++;
 			break;
 		}
 		nlink_grow_8_to_16(irec);
 		/*FALLTHRU*/
-	case sizeof(__uint16_t):
+	case sizeof(uint16_t):
 		if (irec->ino_un.ex_data->counted_nlinks.un16[ino_offset] < 0xffff) {
 			irec->ino_un.ex_data->counted_nlinks.un16[ino_offset]++;
 			break;
 		}
 		nlink_grow_16_to_32(irec);
 		/*FALLTHRU*/
-	case sizeof(__uint32_t):
+	case sizeof(uint32_t):
 		irec->ino_un.ex_data->counted_nlinks.un32[ino_offset]++;
 		break;
 	default:
@@ -128,20 +128,20 @@ void add_inode_ref(struct ino_tree_node
 
 void drop_inode_ref(struct ino_tree_node *irec, int ino_offset)
 {
-	__uint32_t	refs = 0;
+	uint32_t	refs = 0;
 
 	ASSERT(irec->ino_un.ex_data != NULL);
 
 	switch (irec->nlink_size) {
-	case sizeof(__uint8_t):
+	case sizeof(uint8_t):
 		ASSERT(irec->ino_un.ex_data->counted_nlinks.un8[ino_offset] > 0);
 		refs = --irec->ino_un.ex_data->counted_nlinks.un8[ino_offset];
 		break;
-	case sizeof(__uint16_t):
+	case sizeof(uint16_t):
 		ASSERT(irec->ino_un.ex_data->counted_nlinks.un16[ino_offset] > 0);
 		refs = --irec->ino_un.ex_data->counted_nlinks.un16[ino_offset];
 		break;
-	case sizeof(__uint32_t):
+	case sizeof(uint32_t):
 		ASSERT(irec->ino_un.ex_data->counted_nlinks.un32[ino_offset] > 0);
 		refs = --irec->ino_un.ex_data->counted_nlinks.un32[ino_offset];
 		break;
@@ -153,16 +153,16 @@ void drop_inode_ref(struct ino_tree_node
 		irec->ino_un.ex_data->ino_reached &= ~IREC_MASK(ino_offset);
 }
 
-__uint32_t num_inode_references(struct ino_tree_node *irec, int ino_offset)
+uint32_t num_inode_references(struct ino_tree_node *irec, int ino_offset)
 {
 	ASSERT(irec->ino_un.ex_data != NULL);
 
 	switch (irec->nlink_size) {
-	case sizeof(__uint8_t):
+	case sizeof(uint8_t):
 		return irec->ino_un.ex_data->counted_nlinks.un8[ino_offset];
-	case sizeof(__uint16_t):
+	case sizeof(uint16_t):
 		return irec->ino_un.ex_data->counted_nlinks.un16[ino_offset];
-	case sizeof(__uint32_t):
+	case sizeof(uint32_t):
 		return irec->ino_un.ex_data->counted_nlinks.un32[ino_offset];
 	default:
 		ASSERT(0);
@@ -171,24 +171,24 @@ __uint32_t num_inode_references(struct i
 }
 
 void set_inode_disk_nlinks(struct ino_tree_node *irec, int ino_offset,
-		__uint32_t nlinks)
+		uint32_t nlinks)
 {
 	switch (irec->nlink_size) {
-	case sizeof(__uint8_t):
+	case sizeof(uint8_t):
 		if (nlinks < 0xff) {
 			irec->disk_nlinks.un8[ino_offset] = nlinks;
 			break;
 		}
 		nlink_grow_8_to_16(irec);
 		/*FALLTHRU*/
-	case sizeof(__uint16_t):
+	case sizeof(uint16_t):
 		if (nlinks < 0xffff) {
 			irec->disk_nlinks.un16[ino_offset] = nlinks;
 			break;
 		}
 		nlink_grow_16_to_32(irec);
 		/*FALLTHRU*/
-	case sizeof(__uint32_t):
+	case sizeof(uint32_t):
 		irec->disk_nlinks.un32[ino_offset] = nlinks;
 		break;
 	default:
@@ -196,14 +196,14 @@ void set_inode_disk_nlinks(struct ino_tr
 	}
 }
 
-__uint32_t get_inode_disk_nlinks(struct ino_tree_node *irec, int ino_offset)
+uint32_t get_inode_disk_nlinks(struct ino_tree_node *irec, int ino_offset)
 {
 	switch (irec->nlink_size) {
-	case sizeof(__uint8_t):
+	case sizeof(uint8_t):
 		return irec->disk_nlinks.un8[ino_offset];
-	case sizeof(__uint16_t):
+	case sizeof(uint16_t):
 		return irec->disk_nlinks.un16[ino_offset];
-	case sizeof(__uint32_t):
+	case sizeof(uint32_t):
 		return irec->disk_nlinks.un32[ino_offset];
 	default:
 		ASSERT(0);
@@ -211,11 +211,11 @@ __uint32_t get_inode_disk_nlinks(struct
 	return 0;
 }
 
-static __uint8_t *
+static uint8_t *
 alloc_ftypes_array(
 	struct xfs_mount *mp)
 {
-	__uint8_t	*ptr;
+	uint8_t		*ptr;
 
 	if (!xfs_sb_version_hasftype(&mp->m_sb))
 		return NULL;
@@ -262,23 +262,23 @@ alloc_ino_node(
 	irec->ir_free = (xfs_inofree_t) - 1;
 	irec->ir_sparse = 0;
 	irec->ino_un.ex_data = NULL;
-	irec->nlink_size = sizeof(__uint8_t);
+	irec->nlink_size = sizeof(uint8_t);
 	irec->disk_nlinks.un8 = alloc_nlink_array(irec->nlink_size);
 	irec->ftypes = alloc_ftypes_array(mp);
 	return irec;
 }
 
 static void
-free_nlink_array(union ino_nlink nlinks, __uint8_t nlink_size)
+free_nlink_array(union ino_nlink nlinks, uint8_t nlink_size)
 {
 	switch (nlink_size) {
-	case sizeof(__uint8_t):
+	case sizeof(uint8_t):
 		free(nlinks.un8);
 		break;
-	case sizeof(__uint16_t):
+	case sizeof(uint16_t):
 		free(nlinks.un16);
 		break;
-	case sizeof(__uint32_t):
+	case sizeof(uint32_t):
 		free(nlinks.un32);
 		break;
 	default:
@@ -609,7 +609,7 @@ set_inode_parent(
 	int			i;
 	int			cnt;
 	int			target;
-	__uint64_t		bitmask;
+	uint64_t		bitmask;
 	parent_entry_t		*tmp;
 
 	if (full_ino_ex_data)
@@ -699,7 +699,7 @@ set_inode_parent(
 xfs_ino_t
 get_inode_parent(ino_tree_node_t *irec, int offset)
 {
-	__uint64_t	bitmask;
+	uint64_t	bitmask;
 	parent_list_t	*ptbl;
 	int		i;
 	int		target;
@@ -740,15 +740,15 @@ alloc_ex_data(ino_tree_node_t *irec)
 	irec->ino_un.ex_data->parents = ptbl;
 
 	switch (irec->nlink_size) {
-	case sizeof(__uint8_t):
+	case sizeof(uint8_t):
 		irec->ino_un.ex_data->counted_nlinks.un8 =
 			alloc_nlink_array(irec->nlink_size);
 		break;
-	case sizeof(__uint16_t):
+	case sizeof(uint16_t):
 		irec->ino_un.ex_data->counted_nlinks.un16 =
 			alloc_nlink_array(irec->nlink_size);
 		break;
-	case sizeof(__uint32_t):
+	case sizeof(uint32_t):
 		irec->ino_un.ex_data->counted_nlinks.un32 =
 			alloc_nlink_array(irec->nlink_size);
 		break;
diff -urpN xfsprogs-4.9.0/repair/phase1.c xfsprogs-4.14.0/repair/phase1.c
--- xfsprogs-4.9.0/repair/phase1.c	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/repair/phase1.c	2017-11-20 01:14:14.000000000 +0100
@@ -138,6 +138,13 @@ _("Cannot disable lazy-counters on V5 fs
 		}
 	}
 
+	/* shared_vn should be zero */
+	if (sb->sb_shared_vn) {
+		do_warn(_("resetting shared_vn to zero\n"));
+		sb->sb_shared_vn = 0;
+		primary_sb_modified = 1;
+	}
+
 	if (primary_sb_modified)  {
 		if (!no_modify)  {
 			do_warn(_("writing modified primary superblock\n"));
diff -urpN xfsprogs-4.9.0/repair/phase2.c xfsprogs-4.14.0/repair/phase2.c
--- xfsprogs-4.9.0/repair/phase2.c	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/repair/phase2.c	2017-11-20 01:14:14.000000000 +0100
@@ -86,15 +86,20 @@ zero_log(
 			exit(2);
 	} else {
 		if (verbose) {
-			do_warn(
+			do_log(
 	_("zero_log: head block %" PRId64 " tail block %" PRId64 "\n"),
 				head_blk, tail_blk);
 		}
-		if (!no_modify && head_blk != tail_blk) {
-			if (zap_log) {
+		if (head_blk != tail_blk) {
+			if (!no_modify && zap_log) {
 				do_warn(_(
 "ALERT: The filesystem has valuable metadata changes in a log which is being\n"
 "destroyed because the -L option was used.\n"));
+			} else if (no_modify) {
+				do_warn(_(
+"ALERT: The filesystem has valuable metadata changes in a log which is being\n"
+"ignored because the -n option was used.  Expect spurious inconsistencies\n"
+"which may be resolved by first mounting the filesystem to replay the log.\n"));
 			} else {
 				do_warn(_(
 "ERROR: The filesystem has valuable metadata changes in a log which needs to\n"
@@ -174,7 +179,7 @@ phase2(
 
 	bad_ino_btree = 0;
 
-	set_progress_msg(PROG_FMT_SCAN_AG, (__uint64_t) glob_agcount);
+	set_progress_msg(PROG_FMT_SCAN_AG, (uint64_t) glob_agcount);
 
 	scan_ags(mp, scan_threads);
 
diff -urpN xfsprogs-4.9.0/repair/phase3.c xfsprogs-4.14.0/repair/phase3.c
--- xfsprogs-4.9.0/repair/phase3.c	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/repair/phase3.c	2017-11-20 01:14:14.000000000 +0100
@@ -122,7 +122,7 @@ phase3(
 	else
 		do_log(_("        - scan (but don't clear) agi unlinked lists...\n"));
 
-	set_progress_msg(PROG_FMT_AGI_UNLINKED, (__uint64_t) glob_agcount);
+	set_progress_msg(PROG_FMT_AGI_UNLINKED, (uint64_t) glob_agcount);
 
 	/* first clear the agi unlinked AGI list */
 	if (!no_modify) {
@@ -142,7 +142,7 @@ phase3(
 	do_log(_(
 	    "        - process known inodes and perform inode discovery...\n"));
 
-	set_progress_msg(PROG_FMT_PROCESS_INO, (__uint64_t) mp->m_sb.sb_icount);
+	set_progress_msg(PROG_FMT_PROCESS_INO, (uint64_t) mp->m_sb.sb_icount);
 
 	process_ags(mp);
 
@@ -152,7 +152,7 @@ phase3(
 	 * process newly discovered inode chunks
 	 */
 	do_log(_("        - process newly discovered inodes...\n"));
-	set_progress_msg(PROG_FMT_NEW_INODES, (__uint64_t) glob_agcount);
+	set_progress_msg(PROG_FMT_NEW_INODES, (uint64_t) glob_agcount);
 
 	counts = calloc(sizeof(*counts), mp->m_sb.sb_agcount);
 	if (!counts) {
diff -urpN xfsprogs-4.9.0/repair/phase4.c xfsprogs-4.14.0/repair/phase4.c
--- xfsprogs-4.9.0/repair/phase4.c	2016-12-13 21:07:15.000000000 +0100
+++ xfsprogs-4.14.0/repair/phase4.c	2017-11-20 01:14:14.000000000 +0100
@@ -290,7 +290,7 @@ phase4(xfs_mount_t *mp)
 	do_log(_("Phase 4 - check for duplicate blocks...\n"));
 	do_log(_("        - setting up duplicate extent list...\n"));
 
-	set_progress_msg(PROG_FMT_DUP_EXTENT, (__uint64_t) glob_agcount);
+	set_progress_msg(PROG_FMT_DUP_EXTENT, (uint64_t) glob_agcount);
 
 	irec = find_inode_rec(mp, XFS_INO_TO_AGNO(mp, mp->m_sb.sb_rootino),
 				XFS_INO_TO_AGINO(mp, mp->m_sb.sb_rootino));
@@ -404,7 +404,7 @@ phase4(xfs_mount_t *mp)
 	reset_bmaps(mp);
 
 	do_log(_("        - check for inodes claiming duplicate blocks...\n"));
-	set_progress_msg(PROG_FMT_DUP_BLOCKS, (__uint64_t) mp->m_sb.sb_icount);
+	set_progress_msg(PROG_FMT_DUP_BLOCKS, (uint64_t) mp->m_sb.sb_icount);
 
 	/*
 	 * ok, now process the inodes -- signal 2-pass check per inode.
diff -urpN xfsprogs-4.9.0/repair/phase5.c xfsprogs-4.14.0/repair/phase5.c
--- xfsprogs-4.9.0/repair/phase5.c	2017-01-05 18:42:06.000000000 +0100
+++ xfsprogs-4.14.0/repair/phase5.c	2017-11-20 01:14:14.000000000 +0100
@@ -86,9 +86,9 @@ struct agi_stat {
 	xfs_agino_t		freecount;
 };
 
-static __uint64_t	*sb_icount_ag;		/* allocated inodes per ag */
-static __uint64_t	*sb_ifree_ag;		/* free inodes per ag */
-static __uint64_t	*sb_fdblocks_ag;	/* free data blocks per ag */
+static uint64_t	*sb_icount_ag;		/* allocated inodes per ag */
+static uint64_t	*sb_ifree_ag;		/* free inodes per ag */
+static uint64_t	*sb_fdblocks_ag;	/* free data blocks per ag */
 
 static int
 mk_incore_fstree(xfs_mount_t *mp, xfs_agnumber_t agno)
@@ -630,19 +630,15 @@ calculate_freespace_cursor(xfs_mount_t *
 static void
 prop_freespace_cursor(xfs_mount_t *mp, xfs_agnumber_t agno,
 		bt_status_t *btree_curs, xfs_agblock_t startblock,
-		xfs_extlen_t blockcount, int level, __uint32_t magic)
+		xfs_extlen_t blockcount, int level, xfs_btnum_t btnum)
 {
 	struct xfs_btree_block	*bt_hdr;
 	xfs_alloc_key_t		*bt_key;
 	xfs_alloc_ptr_t		*bt_ptr;
 	xfs_agblock_t		agbno;
 	bt_stat_level_t		*lptr;
-	__uint32_t		crc_magic;
 
-	if (magic == XFS_ABTB_MAGIC)
-		crc_magic = XFS_ABTB_CRC_MAGIC;
-	else
-		crc_magic = XFS_ABTC_CRC_MAGIC;
+	ASSERT(btnum == XFS_BTNUM_BNO || btnum == XFS_BTNUM_CNT);
 
 	level++;
 
@@ -658,7 +654,7 @@ prop_freespace_cursor(xfs_mount_t *mp, x
 		 * left-hand side of the tree.
 		 */
 		prop_freespace_cursor(mp, agno, btree_curs, startblock,
-				blockcount, level, magic);
+				blockcount, level, btnum);
 	}
 
 	if (be16_to_cpu(bt_hdr->bb_numrecs) ==
@@ -694,12 +690,8 @@ prop_freespace_cursor(xfs_mount_t *mp, x
 		lptr->buf_p->b_ops = &xfs_allocbt_buf_ops;
 		bt_hdr = XFS_BUF_TO_BLOCK(lptr->buf_p);
 		memset(bt_hdr, 0, mp->m_sb.sb_blocksize);
-		if (xfs_sb_version_hascrc(&mp->m_sb))
-			libxfs_btree_init_block(mp, lptr->buf_p, crc_magic, level,
-						0, agno, XFS_BTREE_CRC_BLOCKS);
-		else
-			libxfs_btree_init_block(mp, lptr->buf_p, magic, level,
-						0, agno, 0);
+		libxfs_btree_init_block(mp, lptr->buf_p, btnum, level,
+					0, agno, 0);
 
 		bt_hdr->bb_u.s.bb_leftsib = cpu_to_be32(lptr->prev_agbno);
 
@@ -707,7 +699,7 @@ prop_freespace_cursor(xfs_mount_t *mp, x
 		 * propagate extent record for first extent in new block up
 		 */
 		prop_freespace_cursor(mp, agno, btree_curs, startblock,
-				blockcount, level, magic);
+				blockcount, level, btnum);
 	}
 	/*
 	 * add extent info to current block
@@ -726,13 +718,13 @@ prop_freespace_cursor(xfs_mount_t *mp, x
 }
 
 /*
- * rebuilds a freespace tree given a cursor and magic number of type
+ * rebuilds a freespace tree given a cursor and type
  * of tree to build (bno or bcnt).  returns the number of free blocks
  * represented by the tree.
  */
 static xfs_extlen_t
 build_freespace_tree(xfs_mount_t *mp, xfs_agnumber_t agno,
-		bt_status_t *btree_curs, __uint32_t magic)
+		bt_status_t *btree_curs, xfs_btnum_t btnum)
 {
 	xfs_agnumber_t		i;
 	xfs_agblock_t		j;
@@ -743,7 +735,8 @@ build_freespace_tree(xfs_mount_t *mp, xf
 	extent_tree_node_t	*ext_ptr;
 	bt_stat_level_t		*lptr;
 	xfs_extlen_t		freeblks;
-	__uint32_t		crc_magic;
+
+	ASSERT(btnum == XFS_BTNUM_BNO || btnum == XFS_BTNUM_CNT);
 
 #ifdef XR_BLD_FREE_TRACE
 	fprintf(stderr, "in build_freespace_tree, agno = %d\n", agno);
@@ -752,10 +745,6 @@ build_freespace_tree(xfs_mount_t *mp, xf
 	freeblks = 0;
 
 	ASSERT(level > 0);
-	if (magic == XFS_ABTB_MAGIC)
-		crc_magic = XFS_ABTB_CRC_MAGIC;
-	else
-		crc_magic = XFS_ABTC_CRC_MAGIC;
 
 	/*
 	 * initialize the first block on each btree level
@@ -780,12 +769,7 @@ build_freespace_tree(xfs_mount_t *mp, xf
 		lptr->buf_p->b_ops = &xfs_allocbt_buf_ops;
 		bt_hdr = XFS_BUF_TO_BLOCK(lptr->buf_p);
 		memset(bt_hdr, 0, mp->m_sb.sb_blocksize);
-		if (xfs_sb_version_hascrc(&mp->m_sb))
-			libxfs_btree_init_block(mp, lptr->buf_p, crc_magic, i,
-						0, agno, XFS_BTREE_CRC_BLOCKS);
-		else
-			libxfs_btree_init_block(mp, lptr->buf_p, magic, i,
-						0, agno, 0);
+		libxfs_btree_init_block(mp, lptr->buf_p, btnum, i, 0, agno, 0);
 	}
 	/*
 	 * run along leaf, setting up records.  as we have to switch
@@ -793,7 +777,7 @@ build_freespace_tree(xfs_mount_t *mp, xf
 	 * pointers for the parent.  that can recurse up to the root
 	 * if required.  set the sibling pointers for leaf level here.
 	 */
-	if (magic == XFS_ABTB_MAGIC)
+	if (btnum == XFS_BTNUM_BNO)
 		ext_ptr = findfirst_bno_extent(agno);
 	else
 		ext_ptr = findfirst_bcnt_extent(agno);
@@ -812,12 +796,7 @@ build_freespace_tree(xfs_mount_t *mp, xf
 		lptr->buf_p->b_ops = &xfs_allocbt_buf_ops;
 		bt_hdr = XFS_BUF_TO_BLOCK(lptr->buf_p);
 		memset(bt_hdr, 0, mp->m_sb.sb_blocksize);
-		if (xfs_sb_version_hascrc(&mp->m_sb))
-			libxfs_btree_init_block(mp, lptr->buf_p, crc_magic, 0,
-						0, agno, XFS_BTREE_CRC_BLOCKS);
-		else
-			libxfs_btree_init_block(mp, lptr->buf_p, magic, 0,
-						0, agno, 0);
+		libxfs_btree_init_block(mp, lptr->buf_p, btnum, 0, 0, agno, 0);
 
 		bt_hdr->bb_u.s.bb_leftsib = cpu_to_be32(lptr->prev_agbno);
 		bt_hdr->bb_numrecs = cpu_to_be16(lptr->num_recs_pb +
@@ -838,7 +817,7 @@ build_freespace_tree(xfs_mount_t *mp, xf
 			prop_freespace_cursor(mp, agno, btree_curs,
 					ext_ptr->ex_startblock,
 					ext_ptr->ex_blockcount,
-					0, magic);
+					0, btnum);
 
 		bt_rec = (xfs_alloc_rec_t *)
 			  ((char *)bt_hdr + XFS_ALLOC_BLOCK_LEN(mp));
@@ -849,7 +828,7 @@ build_freespace_tree(xfs_mount_t *mp, xf
 			bt_rec[j].ar_blockcount = cpu_to_be32(
 							ext_ptr->ex_blockcount);
 			freeblks += ext_ptr->ex_blockcount;
-			if (magic == XFS_ABTB_MAGIC)
+			if (btnum == XFS_BTNUM_BNO)
 				ext_ptr = findnext_bno_extent(ext_ptr);
 			else
 				ext_ptr = findnext_bcnt_extent(agno, ext_ptr);
@@ -907,10 +886,10 @@ build_freespace_tree(xfs_mount_t *mp, xf
  */
 static void
 init_ino_cursor(xfs_mount_t *mp, xfs_agnumber_t agno, bt_status_t *btree_curs,
-		__uint64_t *num_inos, __uint64_t *num_free_inos, int finobt)
+		uint64_t *num_inos, uint64_t *num_free_inos, int finobt)
 {
-	__uint64_t		ninos;
-	__uint64_t		nfinos;
+	uint64_t		ninos;
+	uint64_t		nfinos;
 	int			rec_nfinos;
 	int			rec_ninos;
 	ino_tree_node_t		*ino_rec;
@@ -1074,13 +1053,8 @@ prop_ino_cursor(xfs_mount_t *mp, xfs_agn
 		lptr->buf_p->b_ops = &xfs_inobt_buf_ops;
 		bt_hdr = XFS_BUF_TO_BLOCK(lptr->buf_p);
 		memset(bt_hdr, 0, mp->m_sb.sb_blocksize);
-		if (xfs_sb_version_hascrc(&mp->m_sb))
-			libxfs_btree_init_block(mp, lptr->buf_p, XFS_IBT_CRC_MAGIC,
-						level, 0, agno,
-						XFS_BTREE_CRC_BLOCKS);
-		else
-			libxfs_btree_init_block(mp, lptr->buf_p, XFS_IBT_MAGIC,
-						level, 0, agno, 0);
+		libxfs_btree_init_block(mp, lptr->buf_p, XFS_BTNUM_INO,
+					level, 0, agno, 0);
 
 		bt_hdr->bb_u.s.bb_leftsib = cpu_to_be32(lptr->prev_agbno);
 
@@ -1157,8 +1131,8 @@ build_agi(xfs_mount_t *mp, xfs_agnumber_
  */
 static void
 build_ino_tree(xfs_mount_t *mp, xfs_agnumber_t agno,
-		bt_status_t *btree_curs, __uint32_t magic,
-		struct agi_stat *agi_stat, int finobt)
+		bt_status_t *btree_curs, xfs_btnum_t btnum,
+		struct agi_stat *agi_stat)
 {
 	xfs_agnumber_t		i;
 	xfs_agblock_t		j;
@@ -1178,6 +1152,8 @@ build_ino_tree(xfs_mount_t *mp, xfs_agnu
 	uint64_t		sparse;
 	uint16_t		holemask;
 
+	ASSERT(btnum == XFS_BTNUM_INO || btnum == XFS_BTNUM_FINO);
+
 	for (i = 0; i < level; i++)  {
 		lptr = &btree_curs->level[i];
 
@@ -1199,13 +1175,7 @@ build_ino_tree(xfs_mount_t *mp, xfs_agnu
 		lptr->buf_p->b_ops = &xfs_inobt_buf_ops;
 		bt_hdr = XFS_BUF_TO_BLOCK(lptr->buf_p);
 		memset(bt_hdr, 0, mp->m_sb.sb_blocksize);
-		if (xfs_sb_version_hascrc(&mp->m_sb))
-			libxfs_btree_init_block(mp, lptr->buf_p, magic,
-						i, 0, agno,
-						XFS_BTREE_CRC_BLOCKS);
-		else
-			libxfs_btree_init_block(mp, lptr->buf_p, magic,
-						i, 0, agno, 0);
+		libxfs_btree_init_block(mp, lptr->buf_p, btnum, i, 0, agno, 0);
 	}
 
 	/*
@@ -1214,7 +1184,7 @@ build_ino_tree(xfs_mount_t *mp, xfs_agnu
 	 * pointers for the parent.  that can recurse up to the root
 	 * if required.  set the sibling pointers for leaf level here.
 	 */
-	if (finobt)
+	if (btnum == XFS_BTNUM_FINO)
 		ino_rec = findfirst_free_inode_rec(agno);
 	else
 		ino_rec = findfirst_inode_rec(agno);
@@ -1233,13 +1203,7 @@ build_ino_tree(xfs_mount_t *mp, xfs_agnu
 		lptr->buf_p->b_ops = &xfs_inobt_buf_ops;
 		bt_hdr = XFS_BUF_TO_BLOCK(lptr->buf_p);
 		memset(bt_hdr, 0, mp->m_sb.sb_blocksize);
-		if (xfs_sb_version_hascrc(&mp->m_sb))
-			libxfs_btree_init_block(mp, lptr->buf_p, magic,
-						0, 0, agno,
-						XFS_BTREE_CRC_BLOCKS);
-		else
-			libxfs_btree_init_block(mp, lptr->buf_p, magic,
-						0, 0, agno, 0);
+		libxfs_btree_init_block(mp, lptr->buf_p, btnum, 0, 0, agno, 0);
 
 		bt_hdr->bb_u.s.bb_leftsib = cpu_to_be32(lptr->prev_agbno);
 		bt_hdr->bb_numrecs = cpu_to_be16(lptr->num_recs_pb +
@@ -1303,7 +1267,7 @@ nextrec:
 			freecount += finocnt;
 			count += inocnt;
 
-			if (finobt)
+			if (btnum == XFS_BTNUM_FINO)
 				ino_rec = next_free_ino_rec(ino_rec);
 			else
 				ino_rec = next_ino_rec(ino_rec);
@@ -1492,9 +1456,8 @@ prop_rmap_cursor(
 		lptr->buf_p->b_ops = &xfs_rmapbt_buf_ops;
 		bt_hdr = XFS_BUF_TO_BLOCK(lptr->buf_p);
 		memset(bt_hdr, 0, mp->m_sb.sb_blocksize);
-		libxfs_btree_init_block(mp, lptr->buf_p, XFS_RMAP_CRC_MAGIC,
-					level, 0, agno,
-					XFS_BTREE_CRC_BLOCKS);
+		libxfs_btree_init_block(mp, lptr->buf_p, XFS_BTNUM_RMAP,
+					level, 0, agno, 0);
 
 		bt_hdr->bb_u.s.bb_leftsib = cpu_to_be32(lptr->prev_agbno);
 
@@ -1605,9 +1568,8 @@ build_rmap_tree(
 		lptr->buf_p->b_ops = &xfs_rmapbt_buf_ops;
 		bt_hdr = XFS_BUF_TO_BLOCK(lptr->buf_p);
 		memset(bt_hdr, 0, mp->m_sb.sb_blocksize);
-		libxfs_btree_init_block(mp, lptr->buf_p, XFS_RMAP_CRC_MAGIC,
-					i, 0, agno,
-					XFS_BTREE_CRC_BLOCKS);
+		libxfs_btree_init_block(mp, lptr->buf_p, XFS_BTNUM_RMAP,
+					i, 0, agno, 0);
 	}
 
 	/*
@@ -1633,9 +1595,8 @@ _("Insufficient memory to construct reve
 		lptr->buf_p->b_ops = &xfs_rmapbt_buf_ops;
 		bt_hdr = XFS_BUF_TO_BLOCK(lptr->buf_p);
 		memset(bt_hdr, 0, mp->m_sb.sb_blocksize);
-		libxfs_btree_init_block(mp, lptr->buf_p, XFS_RMAP_CRC_MAGIC,
-					0, 0, agno,
-					XFS_BTREE_CRC_BLOCKS);
+		libxfs_btree_init_block(mp, lptr->buf_p, XFS_BTNUM_RMAP,
+					0, 0, agno, 0);
 
 		bt_hdr->bb_u.s.bb_leftsib = cpu_to_be32(lptr->prev_agbno);
 		bt_hdr->bb_numrecs = cpu_to_be16(numrecs);
@@ -1843,9 +1804,8 @@ prop_refc_cursor(
 		lptr->buf_p->b_ops = &xfs_refcountbt_buf_ops;
 		bt_hdr = XFS_BUF_TO_BLOCK(lptr->buf_p);
 		memset(bt_hdr, 0, mp->m_sb.sb_blocksize);
-		libxfs_btree_init_block(mp, lptr->buf_p, XFS_REFC_CRC_MAGIC,
-					level, 0, agno,
-					XFS_BTREE_CRC_BLOCKS);
+		libxfs_btree_init_block(mp, lptr->buf_p, XFS_BTNUM_REFC,
+					level, 0, agno, 0);
 
 		bt_hdr->bb_u.s.bb_leftsib = cpu_to_be32(lptr->prev_agbno);
 
@@ -1911,9 +1871,8 @@ build_refcount_tree(
 		lptr->buf_p->b_ops = &xfs_refcountbt_buf_ops;
 		bt_hdr = XFS_BUF_TO_BLOCK(lptr->buf_p);
 		memset(bt_hdr, 0, mp->m_sb.sb_blocksize);
-		libxfs_btree_init_block(mp, lptr->buf_p, XFS_REFC_CRC_MAGIC,
-					i, 0, agno,
-					XFS_BTREE_CRC_BLOCKS);
+		libxfs_btree_init_block(mp, lptr->buf_p, XFS_BTNUM_REFC,
+					i, 0, agno, 0);
 	}
 
 	/*
@@ -1939,9 +1898,8 @@ _("Insufficient memory to construct refc
 		lptr->buf_p->b_ops = &xfs_refcountbt_buf_ops;
 		bt_hdr = XFS_BUF_TO_BLOCK(lptr->buf_p);
 		memset(bt_hdr, 0, mp->m_sb.sb_blocksize);
-		libxfs_btree_init_block(mp, lptr->buf_p, XFS_REFC_CRC_MAGIC,
-					0, 0, agno,
-					XFS_BTREE_CRC_BLOCKS);
+		libxfs_btree_init_block(mp, lptr->buf_p, XFS_BTNUM_REFC,
+					0, 0, agno, 0);
 
 		bt_hdr->bb_u.s.bb_leftsib = cpu_to_be32(lptr->prev_agbno);
 		bt_hdr->bb_numrecs = cpu_to_be16(numrecs);
@@ -2235,10 +2193,10 @@ phase5_func(
 	xfs_agnumber_t	agno,
 	struct xfs_slab	*lost_fsb)
 {
-	__uint64_t	num_inos;
-	__uint64_t	num_free_inos;
-	__uint64_t	finobt_num_inos;
-	__uint64_t	finobt_num_free_inos;
+	uint64_t	num_inos;
+	uint64_t	num_free_inos;
+	uint64_t	finobt_num_inos;
+	uint64_t	finobt_num_free_inos;
 	bt_status_t	bno_btree_curs;
 	bt_status_t	bcnt_btree_curs;
 	bt_status_t	ino_btree_curs;
@@ -2252,7 +2210,6 @@ phase5_func(
 	xfs_extlen_t	freeblks2;
 #endif
 	xfs_agblock_t	num_extents;
-	__uint32_t	magic;
 	struct agi_stat	agi_stat = {0,};
 	int		error;
 
@@ -2379,7 +2336,7 @@ phase5_func(
 		 * now rebuild the freespace trees
 		 */
 		freeblks1 = build_freespace_tree(mp, agno,
-					&bno_btree_curs, XFS_ABTB_MAGIC);
+					&bno_btree_curs, XFS_BTNUM_BNO);
 #ifdef XR_BLD_FREE_TRACE
 		fprintf(stderr, "# of free blocks == %d\n", freeblks1);
 #endif
@@ -2387,10 +2344,10 @@ phase5_func(
 
 #ifdef DEBUG
 		freeblks2 = build_freespace_tree(mp, agno,
-					&bcnt_btree_curs, XFS_ABTC_MAGIC);
+					&bcnt_btree_curs, XFS_BTNUM_CNT);
 #else
 		(void) build_freespace_tree(mp, agno,
-					&bcnt_btree_curs, XFS_ABTC_MAGIC);
+					&bcnt_btree_curs, XFS_BTNUM_CNT);
 #endif
 		write_cursor(&bcnt_btree_curs);
 
@@ -2417,19 +2374,16 @@ phase5_func(
 		/*
 		 * build inode allocation tree.
 		 */
-		magic = xfs_sb_version_hascrc(&mp->m_sb) ?
-				XFS_IBT_CRC_MAGIC : XFS_IBT_MAGIC;
-		build_ino_tree(mp, agno, &ino_btree_curs, magic, &agi_stat, 0);
+		build_ino_tree(mp, agno, &ino_btree_curs, XFS_BTNUM_INO,
+				&agi_stat);
 		write_cursor(&ino_btree_curs);
 
 		/*
 		 * build free inode tree
 		 */
 		if (xfs_sb_version_hasfinobt(&mp->m_sb)) {
-			magic = xfs_sb_version_hascrc(&mp->m_sb) ?
-					XFS_FIBT_CRC_MAGIC : XFS_FIBT_MAGIC;
-			build_ino_tree(mp, agno, &fino_btree_curs, magic,
-					NULL, 1);
+			build_ino_tree(mp, agno, &fino_btree_curs,
+					XFS_BTNUM_FINO, NULL);
 			write_cursor(&fino_btree_curs);
 		}
 
@@ -2517,7 +2471,7 @@ phase5(xfs_mount_t *mp)
 	int			error;
 
 	do_log(_("Phase 5 - rebuild AG headers and trees...\n"));
-	set_progress_msg(PROG_FMT_REBUILD_AG, (__uint64_t )glob_agcount);
+	set_progress_msg(PROG_FMT_REBUILD_AG, (uint64_t)glob_agcount);
 
 #ifdef XR_BLD_FREE_TRACE
 	fprintf(stderr, "inobt level 1, maxrec = %d, minrec = %d\n",
@@ -2543,15 +2497,15 @@ phase5(xfs_mount_t *mp)
 	keep_fsinos(mp);
 
 	/* allocate per ag counters */
-	sb_icount_ag = calloc(mp->m_sb.sb_agcount, sizeof(__uint64_t));
+	sb_icount_ag = calloc(mp->m_sb.sb_agcount, sizeof(uint64_t));
 	if (sb_icount_ag == NULL)
 		do_error(_("cannot alloc sb_icount_ag buffers\n"));
 
-	sb_ifree_ag = calloc(mp->m_sb.sb_agcount, sizeof(__uint64_t));
+	sb_ifree_ag = calloc(mp->m_sb.sb_agcount, sizeof(uint64_t));
 	if (sb_ifree_ag == NULL)
 		do_error(_("cannot alloc sb_ifree_ag buffers\n"));
 
-	sb_fdblocks_ag = calloc(mp->m_sb.sb_agcount, sizeof(__uint64_t));
+	sb_fdblocks_ag = calloc(mp->m_sb.sb_agcount, sizeof(uint64_t));
 	if (sb_fdblocks_ag == NULL)
 		do_error(_("cannot alloc sb_fdblocks_ag buffers\n"));
 
diff -urpN xfsprogs-4.9.0/repair/phase6.c xfsprogs-4.14.0/repair/phase6.c
--- xfsprogs-4.9.0/repair/phase6.c	2017-01-05 18:41:55.000000000 +0100
+++ xfsprogs-4.14.0/repair/phase6.c	2017-11-27 17:57:55.000000000 +0100
@@ -82,7 +82,7 @@ typedef struct dir_hash_ent {
 	struct dir_hash_ent	*nextbyhash;	/* next in name bucket */
 	struct dir_hash_ent	*nextbyorder;	/* next in order added */
 	xfs_dahash_t		hashval;	/* hash value of name */
-	__uint32_t		address;	/* offset of data entry */
+	uint32_t		address;	/* offset of data entry */
 	xfs_ino_t 		inum;		/* inode num of entry */
 	short			junkit;		/* name starts with / */
 	short			seen;		/* have seen leaf entry */
@@ -170,11 +170,11 @@ static int
 dir_hash_add(
 	xfs_mount_t		*mp,
 	dir_hash_tab_t		*hashtab,
-	__uint32_t		addr,
+	uint32_t		addr,
 	xfs_ino_t		inum,
 	int			namelen,
 	unsigned char		*name,
-	__uint8_t		ftype)
+	uint8_t			ftype)
 {
 	xfs_dahash_t		hash = 0;
 	int			byaddr;
@@ -357,7 +357,7 @@ static void
 dir_hash_update_ftype(
 	dir_hash_tab_t		*hashtab,
 	xfs_dir2_dataptr_t	addr,
-	__uint8_t		ftype)
+	uint8_t			ftype)
 {
 	int			i;
 	dir_hash_ent_t		*p;
@@ -434,12 +434,10 @@ bmap_next_offset(
 	int		whichfork)		/* data or attr fork */
 {
 	xfs_fileoff_t	bno;			/* current block */
-	int		eof;			/* hit end of file */
 	int		error;			/* error return value */
 	xfs_bmbt_irec_t got;			/* current extent value */
 	xfs_ifork_t	*ifp;			/* inode fork pointer */
-	xfs_extnum_t	lastx;			/* last extent used */
-	xfs_bmbt_irec_t prev;			/* previous extent value */
+	xfs_extnum_t	idx;			/* last extent used */
 
 	if (XFS_IFORK_FORMAT(ip, whichfork) != XFS_DINODE_FMT_BTREE &&
 	    XFS_IFORK_FORMAT(ip, whichfork) != XFS_DINODE_FMT_EXTENTS &&
@@ -454,9 +452,7 @@ bmap_next_offset(
 	    (error = -libxfs_iread_extents(tp, ip, whichfork)))
 		return error;
 	bno = *bnop + 1;
-	libxfs_bmap_search_extents(ip, bno, whichfork, &eof, &lastx,
-				   &got, &prev);
-	if (eof)
+	if (!libxfs_iext_lookup_extent(ip, ifp, bno, &idx, &got))
 		*bnop = NULLFILEOFF;
 	else
 		*bnop = got.br_startoff < bno ? bno : got.br_startoff;
@@ -569,7 +565,8 @@ mk_rbmino(xfs_mount_t *mp)
 			bno += ep->br_blockcount;
 		}
 	}
-	error = -libxfs_defer_finish(&tp, &dfops, ip);
+	libxfs_defer_ijoin(&dfops, ip);
+	error = -libxfs_defer_finish(&tp, &dfops);
 	if (error) {
 		do_error(
 		_("allocation of the realtime bitmap failed, error = %d\n"),
@@ -821,7 +818,8 @@ mk_rsumino(xfs_mount_t *mp)
 			bno += ep->br_blockcount;
 		}
 	}
-	error = -libxfs_defer_finish(&tp, &dfops, ip);
+	libxfs_defer_ijoin(&dfops, ip);
+	error = -libxfs_defer_finish(&tp, &dfops);
 	if (error) {
 		do_error(
 	_("allocation of the realtime summary ino failed, error = %d\n"),
@@ -1025,7 +1023,8 @@ mk_orphanage(xfs_mount_t *mp)
 	libxfs_dir_init(tp, ip, pip);
 	libxfs_trans_log_inode(tp, ip, XFS_ILOG_CORE);
 
-	error = -libxfs_defer_finish(&tp, &dfops, ip);
+	libxfs_defer_ijoin(&dfops, ip);
+	error = -libxfs_defer_finish(&tp, &dfops);
 	if (error) {
 		do_error(_("%s directory creation failed -- bmapf error %d\n"),
 			ORPHANAGE, error);
@@ -1082,7 +1081,7 @@ mv_orphanage(
 	if ((err = -libxfs_iget(mp, NULL, ino, 0, &ino_p)))
 		do_error(_("%d - couldn't iget disconnected inode\n"), err);
 
-	xname.type = xfs_mode_to_ftype[(VFS_I(ino_p)->i_mode & S_IFMT)>>S_SHIFT];
+	xname.type = xfs_mode_to_ftype(VFS_I(ino_p)->i_mode);
 
 	if (isa_dir)  {
 		irec = find_inode_rec(mp, XFS_INO_TO_AGNO(mp, orphanage_ino),
@@ -1131,7 +1130,8 @@ mv_orphanage(
 			inc_nlink(VFS_I(ino_p));
 			libxfs_trans_log_inode(tp, ino_p, XFS_ILOG_CORE);
 
-			err = -libxfs_defer_finish(&tp, &dfops, ino_p);
+			libxfs_defer_ijoin(&dfops, ino_p);
+			err = -libxfs_defer_finish(&tp, &dfops);
 			if (err)
 				do_error(
 	_("bmap finish failed (err - %d), filesystem may be out of space\n"),
@@ -1178,7 +1178,8 @@ mv_orphanage(
 						err);
 			}
 
-			err = -libxfs_defer_finish(&tp, &dfops, ino_p);
+			libxfs_defer_ijoin(&dfops, ino_p);
+			err = -libxfs_defer_finish(&tp, &dfops);
 			if (err)
 				do_error(
 	_("bmap finish failed (%d), filesystem may be out of space\n"),
@@ -1217,7 +1218,8 @@ mv_orphanage(
 		set_nlink(VFS_I(ino_p), 1);
 		libxfs_trans_log_inode(tp, ino_p, XFS_ILOG_CORE);
 
-		err = -libxfs_defer_finish(&tp, &dfops, ino_p);
+		libxfs_defer_ijoin(&dfops, ino_p);
+		err = -libxfs_defer_finish(&tp, &dfops);
 		if (err)
 			do_error(
 	_("bmap finish failed (%d), filesystem may be out of space\n"),
@@ -1317,7 +1319,8 @@ longform_dir2_rebuild(
 		goto out_bmap_cancel;
 	}
 
-	error = -libxfs_defer_finish(&tp, &dfops, ip);
+	libxfs_defer_ijoin(&dfops, ip);
+	error = -libxfs_defer_finish(&tp, &dfops);
 
 	libxfs_trans_commit(tp);
 
@@ -1351,7 +1354,8 @@ _("name create failed in ino %" PRIu64 "
 			goto out_bmap_cancel;
 		}
 
-		error = -libxfs_defer_finish(&tp, &dfops, ip);
+		libxfs_defer_ijoin(&dfops, ip);
+		error = -libxfs_defer_finish(&tp, &dfops);
 		if (error) {
 			do_warn(
 	_("bmap finish failed (%d), filesystem may be out of space\n"),
@@ -1411,7 +1415,8 @@ dir2_kill_block(
 	if (error)
 		do_error(_("shrink_inode failed inode %" PRIu64 " block %u\n"),
 			ip->i_ino, da_bno);
-	libxfs_defer_finish(&tp, &dfops, ip);
+	libxfs_defer_ijoin(&dfops, ip);
+	libxfs_defer_finish(&tp, &dfops);
 	libxfs_trans_commit(tp);
 }
 
@@ -1795,8 +1800,8 @@ longform_dir2_entry_check_data(
 
 		/* validate ftype field if supported */
 		if (xfs_sb_version_hasftype(&mp->m_sb)) {
-			__uint8_t dir_ftype;
-			__uint8_t ino_ftype;
+			uint8_t dir_ftype;
+			uint8_t ino_ftype;
 
 			dir_ftype = M_DIROPS(mp)->data_get_ftype(dep);
 			ino_ftype = get_inode_ftype(irec, ino_offset);
@@ -1883,10 +1888,12 @@ _("entry \"%s\" in dir inode %" PRIu64 "
 	}
 	*num_illegal += nbad;
 	if (needscan)
-		libxfs_dir2_data_freescan(mp->m_dir_geo, M_DIROPS(mp), d, &i);
+		libxfs_dir2_data_freescan_int(mp->m_dir_geo, M_DIROPS(mp),
+				d, &i);
 	if (needlog)
 		libxfs_dir2_data_log_header(&da, bp);
-	libxfs_defer_finish(&tp, &dfops, ip);
+	libxfs_defer_ijoin(&dfops, ip);
+	libxfs_defer_finish(&tp, &dfops);
 	libxfs_trans_commit(tp);
 
 	/* record the largest free space in the freetab for later checking */
@@ -1910,14 +1917,14 @@ __check_dir3_header(
 	if (be64_to_cpu(owner) != ino) {
 		do_warn(
 _("expected owner inode %" PRIu64 ", got %llu, directory block %" PRIu64 "\n"),
-			ino, be64_to_cpu(owner), bp->b_bn);
+			ino, (unsigned long long)be64_to_cpu(owner), bp->b_bn);
 		return 1;
 	}
 	/* verify block number */
 	if (be64_to_cpu(blkno) != bp->b_bn) {
 		do_warn(
 _("expected block %" PRIu64 ", got %llu, directory inode %" PRIu64 "\n"),
-			bp->b_bn, be64_to_cpu(blkno), ino);
+			bp->b_bn, (unsigned long long)be64_to_cpu(blkno), ino);
 		return 1;
 	}
 	/* verify uuid */
@@ -2706,8 +2713,8 @@ _("entry \"%s\" (ino %" PRIu64 ") in dir
 
 		/* validate ftype field if supported */
 		if (xfs_sb_version_hasftype(&mp->m_sb)) {
-			__uint8_t dir_ftype;
-			__uint8_t ino_ftype;
+			uint8_t dir_ftype;
+			uint8_t ino_ftype;
 
 			dir_ftype = M_DIROPS(mp)->sf_get_ftype(sfep);
 			ino_ftype = get_inode_ftype(irec, ino_offset);
@@ -2949,7 +2956,8 @@ process_dir_inode(
 
 		libxfs_trans_log_inode(tp, ip, XFS_ILOG_CORE);
 
-		error = -libxfs_defer_finish(&tp, &dfops, ip);
+		libxfs_defer_ijoin(&dfops, ip);
+		error = -libxfs_defer_finish(&tp, &dfops);
 		ASSERT(error == 0);
 		libxfs_trans_commit(tp);
 
@@ -3007,7 +3015,8 @@ process_dir_inode(
 
 			libxfs_trans_log_inode(tp, ip, XFS_ILOG_CORE);
 
-			error = -libxfs_defer_finish(&tp, &dfops, ip);
+			libxfs_defer_ijoin(&dfops, ip);
+			error = -libxfs_defer_finish(&tp, &dfops);
 			ASSERT(error == 0);
 			libxfs_trans_commit(tp);
 		}
@@ -3028,8 +3037,6 @@ mark_standalone_inodes(xfs_mount_t *mp)
 	irec = find_inode_rec(mp, XFS_INO_TO_AGNO(mp, mp->m_sb.sb_rbmino),
 			XFS_INO_TO_AGINO(mp, mp->m_sb.sb_rbmino));
 
-	ASSERT(irec != NULL);
-
 	offset = XFS_INO_TO_AGINO(mp, mp->m_sb.sb_rbmino) -
 			irec->ino_startnum;
 
@@ -3041,8 +3048,6 @@ mark_standalone_inodes(xfs_mount_t *mp)
 	offset = XFS_INO_TO_AGINO(mp, mp->m_sb.sb_rsumino) -
 			irec->ino_startnum;
 
-	ASSERT(irec != NULL);
-
 	add_inode_reached(irec, offset);
 
 	if (fs_quotas)  {
diff -urpN xfsprogs-4.9.0/repair/phase7.c xfsprogs-4.14.0/repair/phase7.c
--- xfsprogs-4.9.0/repair/phase7.c	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/repair/phase7.c	2017-11-20 01:14:14.000000000 +0100
@@ -32,7 +32,7 @@ static void
 update_inode_nlinks(
 	xfs_mount_t 		*mp,
 	xfs_ino_t		ino,
-	__uint32_t		nlinks)
+	uint32_t		nlinks)
 {
 	xfs_trans_t		*tp;
 	xfs_inode_t		*ip;
@@ -104,7 +104,7 @@ do_link_updates(
 {
 	ino_tree_node_t		*irec;
 	int			j;
-	__uint32_t		nrefs;
+	uint32_t		nrefs;
 
 	for (irec = findfirst_inode_rec(agno); irec;
 	     irec = next_ino_rec(irec)) {
@@ -143,7 +143,7 @@ phase7(
 	else
 		do_log(_("Phase 7 - verify link counts...\n"));
 
-	set_progress_msg(PROGRESS_FMT_CORR_LINK, (__uint64_t) glob_agcount);
+	set_progress_msg(PROGRESS_FMT_CORR_LINK, (uint64_t) glob_agcount);
 
 	create_work_queue(&wq, mp, scan_threads);
 
diff -urpN xfsprogs-4.9.0/repair/prefetch.c xfsprogs-4.14.0/repair/prefetch.c
--- xfsprogs-4.9.0/repair/prefetch.c	2016-12-21 06:36:07.000000000 +0100
+++ xfsprogs-4.14.0/repair/prefetch.c	2017-11-20 01:14:14.000000000 +0100
@@ -679,11 +679,32 @@ static int
 pf_create_prefetch_thread(
 	prefetch_args_t		*args);
 
+/*
+ * If we fail to create the queuing thread or can't create even one
+ * prefetch thread, we need to let processing continue without it.
+ */
+static void
+pf_skip_prefetch_thread(prefetch_args_t *args)
+{
+	prefetch_args_t *next;
+
+	pthread_mutex_lock(&args->lock);
+	args->prefetch_done = 1;
+	pf_start_processing(args);
+	next = args->next_args;
+	args->next_args = NULL;
+	pthread_mutex_unlock(&args->lock);
+
+	if (next)
+		pf_create_prefetch_thread(next);
+}
+
 static void *
 pf_queuing_worker(
 	void			*param)
 {
 	prefetch_args_t		*args = param;
+	prefetch_args_t		*next_args;
 	int			num_inos;
 	ino_tree_node_t		*irec;
 	ino_tree_node_t		*cur_irec;
@@ -703,8 +724,11 @@ pf_queuing_worker(
 		if (err != 0) {
 			do_warn(_("failed to create prefetch thread: %s\n"),
 				strerror(err));
+			pftrace("failed to create prefetch thread for AG %d: %s",
+				args->agno, strerror(err));
+			args->io_threads[i] = 0;
 			if (i == 0) {
-				pf_start_processing(args);
+				pf_skip_prefetch_thread(args);
 				return NULL;
 			}
 			/*
@@ -795,11 +819,13 @@ pf_queuing_worker(
 	ASSERT(btree_is_empty(args->io_queue));
 
 	args->prefetch_done = 1;
-	if (args->next_args)
-		pf_create_prefetch_thread(args->next_args);
-
+	next_args = args->next_args;
+	args->next_args = NULL;
 	pthread_mutex_unlock(&args->lock);
 
+	if (next_args)
+		pf_create_prefetch_thread(next_args);
+
 	return NULL;
 }
 
@@ -816,7 +842,10 @@ pf_create_prefetch_thread(
 	if (err != 0) {
 		do_warn(_("failed to create prefetch thread: %s\n"),
 			strerror(err));
-		cleanup_inode_prefetch(args);
+		pftrace("failed to create prefetch thread for AG %d: %s",
+			args->agno, strerror(err));
+		args->queuing_thread = 0;
+		pf_skip_prefetch_thread(args);
 	}
 
 	return err == 0;
@@ -878,11 +907,15 @@ start_inode_prefetch(
 	} else {
 		pthread_mutex_lock(&prev_args->lock);
 		if (prev_args->prefetch_done) {
+			pthread_mutex_unlock(&prev_args->lock);
 			if (!pf_create_prefetch_thread(args))
 				args = NULL;
-		} else
+		} else {
 			prev_args->next_args = args;
-		pthread_mutex_unlock(&prev_args->lock);
+			pftrace("queued AG %d after AG %d",
+				args->agno, prev_args->agno);
+			pthread_mutex_unlock(&prev_args->lock);
+		}
 	}
 
 	return args;
@@ -1057,6 +1090,8 @@ cleanup_inode_prefetch(
 
 	pftrace("AG %d prefetch done", args->agno);
 
+	ASSERT(args->next_args == NULL);
+
 	pthread_mutex_destroy(&args->lock);
 	pthread_cond_destroy(&args->start_reading);
 	pthread_cond_destroy(&args->start_processing);
diff -urpN xfsprogs-4.9.0/repair/progress.c xfsprogs-4.14.0/repair/progress.c
--- xfsprogs-4.9.0/repair/progress.c	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/repair/progress.c	2017-11-20 01:14:14.000000000 +0100
@@ -85,8 +85,8 @@ pthread_t	report_thread;
 typedef struct msg_block_s {
 	pthread_mutex_t	mutex;
 	progress_rpt_t	*format;
-	__uint64_t	*done;
-	__uint64_t	*total;
+	uint64_t	*done;
+	uint64_t	*total;
 	int		count;
 	int		interval;
 } msg_block_t;
@@ -96,14 +96,14 @@ typedef struct phase_times_s {
 	time_t		start;
 	time_t		end;
 	time_t		duration;
-	__uint64_t	item_counts[4];
+	uint64_t	item_counts[4];
 } phase_times_t;
 static phase_times_t phase_times[8];
 
 static void *progress_rpt_thread(void *);
 static int current_phase;
 static int running;
-static __uint64_t prog_rpt_total;
+static uint64_t prog_rpt_total;
 
 void
 init_progress_rpt (void)
@@ -113,11 +113,11 @@ init_progress_rpt (void)
 	 *  allocate the done vector
 	 */
 
-	if ((prog_rpt_done = (__uint64_t *)
-		malloc(sizeof(__uint64_t)*glob_agcount)) == NULL ) {
+	if ((prog_rpt_done = (uint64_t *)
+		malloc(sizeof(uint64_t)*glob_agcount)) == NULL) {
 		do_error(_("cannot malloc pointer to done vector\n"));
 	}
-	bzero(prog_rpt_done, sizeof(__uint64_t)*glob_agcount);
+	bzero(prog_rpt_done, sizeof(uint64_t)*glob_agcount);
 
 	/*
 	 *  Setup comm block, start the thread
@@ -165,10 +165,10 @@ progress_rpt_thread (void *p)
 	timer_t timerid;
 	struct itimerspec timespec;
 	char *msgbuf;
-	__uint64_t *donep;
-	__uint64_t sum;
+	uint64_t *donep;
+	uint64_t sum;
 	msg_block_t *msgp = (msg_block_t *)p;
-	__uint64_t percent;
+	uint64_t percent;
 
 	/* It's possible to get here very early w/ no progress msg set */
 	if (!msgp->format)
@@ -286,7 +286,7 @@ progress_rpt_thread (void *p)
 }
 
 int
-set_progress_msg (int report, __uint64_t total)
+set_progress_msg(int report, uint64_t total)
 {
 
 	if (!ag_stride)
@@ -300,7 +300,7 @@ set_progress_msg (int report, __uint64_t
 
 	/* reset all the accumulative totals */
 	if (prog_rpt_done)
-		bzero(prog_rpt_done, sizeof(__uint64_t)*glob_agcount);
+		bzero(prog_rpt_done, sizeof(uint64_t)*glob_agcount);
 
 	if (pthread_mutex_unlock(&global_msgs.mutex))
 		do_error(_("set_progress_msg: cannot unlock progress mutex\n"));
@@ -308,14 +308,14 @@ set_progress_msg (int report, __uint64_t
 	return (0);
 }
 
-__uint64_t
+uint64_t
 print_final_rpt(void)
 {
 	int i;
 	struct tm *tmp;
 	time_t now;
-	__uint64_t *donep;
-	__uint64_t sum;
+	uint64_t *donep;
+	uint64_t sum;
 	msg_block_t 	*msgp = &global_msgs;
 	char		msgbuf[DURATION_BUF_SIZE];
 
diff -urpN xfsprogs-4.9.0/repair/progress.h xfsprogs-4.14.0/repair/progress.h
--- xfsprogs-4.9.0/repair/progress.h	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/repair/progress.h	2017-11-20 01:14:14.000000000 +0100
@@ -32,8 +32,8 @@
 extern void init_progress_rpt(void);
 extern void stop_progress_rpt(void);
 extern void summary_report(void);
-extern int  set_progress_msg(int report, __uint64_t total);
-extern __uint64_t print_final_rpt(void);
+extern int  set_progress_msg(int report, uint64_t total);
+extern uint64_t print_final_rpt(void);
 extern char *timestamp(int end, int phase, char *buf);
 extern char *duration(int val, char *buf);
 extern int do_parallel;
diff -urpN xfsprogs-4.9.0/repair/rmap.c xfsprogs-4.14.0/repair/rmap.c
--- xfsprogs-4.9.0/repair/rmap.c	2017-01-05 18:42:06.000000000 +0100
+++ xfsprogs-4.14.0/repair/rmap.c	2017-11-27 17:57:55.000000000 +0100
@@ -49,37 +49,9 @@ static struct xfs_ag_rmap *ag_rmaps;
 static bool rmapbt_suspect;
 static bool refcbt_suspect;
 
-/*
- * Compare rmap observations for array sorting.
- */
-static int
-rmap_compare(
-	const void		*a,
-	const void		*b)
+static inline int rmap_compare(const void *a, const void *b)
 {
-	const struct xfs_rmap_irec	*pa;
-	const struct xfs_rmap_irec	*pb;
-	__u64			oa;
-	__u64			ob;
-
-	pa = a; pb = b;
-	oa = libxfs_rmap_irec_offset_pack(pa);
-	ob = libxfs_rmap_irec_offset_pack(pb);
-
-	if (pa->rm_startblock < pb->rm_startblock)
-		return -1;
-	else if (pa->rm_startblock > pb->rm_startblock)
-		return 1;
-	else if (pa->rm_owner < pb->rm_owner)
-		return -1;
-	else if (pa->rm_owner > pb->rm_owner)
-		return 1;
-	else if (oa < ob)
-		return -1;
-	else if (oa > ob)
-		return 1;
-	else
-		return 0;
+	return libxfs_rmap_compare(a, b);
 }
 
 /*
@@ -371,7 +343,7 @@ err:
 
 static int
 find_first_zero_bit(
-	__uint64_t	mask)
+	uint64_t	mask)
 {
 	int		n;
 	int		b = 0;
@@ -384,7 +356,7 @@ find_first_zero_bit(
 
 static int
 popcnt(
-	__uint64_t	mask)
+	uint64_t	mask)
 {
 	int		n;
 	int		b = 0;
@@ -1092,14 +1064,14 @@ err:
  * Compare the key fields of two rmap records -- positive if key1 > key2,
  * negative if key1 < key2, and zero if equal.
  */
-__int64_t
+int64_t
 rmap_diffkeys(
 	struct xfs_rmap_irec	*kp1,
 	struct xfs_rmap_irec	*kp2)
 {
 	__u64			oa;
 	__u64			ob;
-	__int64_t		d;
+	int64_t			d;
 	struct xfs_rmap_irec	tmp;
 
 	tmp = *kp1;
@@ -1109,7 +1081,7 @@ rmap_diffkeys(
 	tmp.rm_flags &= ~XFS_RMAP_REC_FLAGS;
 	ob = libxfs_rmap_irec_offset_pack(&tmp);
 
-	d = (__int64_t)kp1->rm_startblock - kp2->rm_startblock;
+	d = (int64_t)kp1->rm_startblock - kp2->rm_startblock;
 	if (d)
 		return d;
 
@@ -1220,10 +1192,10 @@ fix_inode_reflink_flags(
 {
 	struct ino_tree_node	*irec;
 	int			bit;
-	__uint64_t		was;
-	__uint64_t		is;
-	__uint64_t		diff;
-	__uint64_t		mask;
+	uint64_t		was;
+	uint64_t		is;
+	uint64_t		diff;
+	uint64_t		mask;
 	int			error = 0;
 	xfs_agino_t		agino;
 
@@ -1387,7 +1359,8 @@ next_loop:
 
 err:
 	if (bt_cur)
-		libxfs_btree_del_cursor(bt_cur, XFS_BTREE_NOERROR);
+		libxfs_btree_del_cursor(bt_cur, error ? XFS_BTREE_ERROR :
+							XFS_BTREE_NOERROR);
 	if (agbp)
 		libxfs_putbuf(agbp);
 	free_slab_cursor(&rl_cur);
diff -urpN xfsprogs-4.9.0/repair/rmap.h xfsprogs-4.14.0/repair/rmap.h
--- xfsprogs-4.9.0/repair/rmap.h	2016-12-13 21:07:15.000000000 +0100
+++ xfsprogs-4.14.0/repair/rmap.h	2017-11-20 01:14:14.000000000 +0100
@@ -44,7 +44,7 @@ extern int rmap_init_cursor(xfs_agnumber
 extern void rmap_avoid_check(void);
 extern int rmaps_verify_btree(struct xfs_mount *, xfs_agnumber_t);
 
-extern __int64_t rmap_diffkeys(struct xfs_rmap_irec *kp1,
+extern int64_t rmap_diffkeys(struct xfs_rmap_irec *kp1,
 		struct xfs_rmap_irec *kp2);
 extern void rmap_high_key_from_rec(struct xfs_rmap_irec *rec,
 		struct xfs_rmap_irec *key);
diff -urpN xfsprogs-4.9.0/repair/sb.c xfsprogs-4.14.0/repair/sb.c
--- xfsprogs-4.9.0/repair/sb.c	2016-12-21 06:36:07.000000000 +0100
+++ xfsprogs-4.14.0/repair/sb.c	2017-11-20 01:14:14.000000000 +0100
@@ -40,7 +40,7 @@ copy_sb(xfs_sb_t *source, xfs_sb_t *dest
 	xfs_ino_t	uquotino;
 	xfs_ino_t	gquotino;
 	xfs_ino_t	pquotino;
-	__uint16_t	versionnum;
+	uint16_t	versionnum;
 
 	rootino = dest->sb_rootino;
 	rbmino = dest->sb_rbmino;
@@ -106,8 +106,8 @@ verify_sb_blocksize(xfs_sb_t *sb)
 static int
 __find_secondary_sb(
 	xfs_sb_t	*rsb,
-	__uint64_t	start,
-	__uint64_t	skip)
+	uint64_t	start,
+	uint64_t	skip)
 {
 	xfs_off_t	off;
 	xfs_sb_t	*sb;
@@ -187,13 +187,13 @@ __find_secondary_sb(
 
 static int
 guess_default_geometry(
-	__uint64_t		*agsize,
-	__uint64_t		*agcount,
+	uint64_t		*agsize,
+	uint64_t		*agcount,
 	libxfs_init_t		*x)
 {
 	struct fs_topology	ft;
 	int			blocklog;
-	__uint64_t		dblocks;
+	uint64_t		dblocks;
 	int			multidisk;
 
 	memset(&ft, 0, sizeof(ft));
@@ -216,9 +216,9 @@ int
 find_secondary_sb(xfs_sb_t *rsb)
 {
 	int		retval = 0;
-	__uint64_t	agcount;
-	__uint64_t	agsize;
-	__uint64_t	skip;
+	uint64_t	agcount;
+	uint64_t	agsize;
+	uint64_t	skip;
 	int		blocklog;
 
 	/*
@@ -229,7 +229,7 @@ find_secondary_sb(xfs_sb_t *rsb)
 	do_warn(_("\nattempting to find secondary superblock...\n"));
 
 	if (verify_sb_blocksize(rsb) == 0) {
-		skip = (__uint64_t)rsb->sb_agblocks * rsb->sb_blocksize;
+		skip = (uint64_t)rsb->sb_agblocks * rsb->sb_blocksize;
 		if (skip >= XFS_AG_MIN_BYTES && skip <= XFS_AG_MAX_BYTES)
 			retval = __find_secondary_sb(rsb, skip, skip);
 	}
@@ -343,7 +343,7 @@ sb_validate_ino_align(struct xfs_sb *sb)
 int
 verify_sb(char *sb_buf, xfs_sb_t *sb, int is_primary_sb)
 {
-	__uint32_t	bsize;
+	uint32_t	bsize;
 	int		i;
 	int		ret;
 
@@ -395,20 +395,22 @@ verify_sb(char *sb_buf, xfs_sb_t *sb, in
 	/* sanity check ag count, size fields against data size field */
 
 	if (sb->sb_dblocks == 0 ||
-		sb->sb_dblocks >
-			((__uint64_t)sb->sb_agcount * sb->sb_agblocks) ||
-		sb->sb_dblocks <
-			((__uint64_t)(sb->sb_agcount - 1) * sb->sb_agblocks
-			+ XFS_MIN_AG_BLOCKS))
+		sb->sb_dblocks > XFS_MAX_DBLOCKS(sb) ||
+		sb->sb_dblocks < XFS_MIN_DBLOCKS(sb))
 		return(XR_BAD_FS_SIZE_DATA);
 
-	if (sb->sb_agblklog != (__uint8_t)libxfs_log2_roundup(sb->sb_agblocks))
+	if (sb->sb_agblklog != (uint8_t)libxfs_log2_roundup(sb->sb_agblocks))
 		return(XR_BAD_FS_SIZE_DATA);
 
-	if (sb->sb_inodesize < XFS_DINODE_MIN_SIZE ||
-		sb->sb_inodesize > XFS_DINODE_MAX_SIZE ||
-		sb->sb_inopblock != howmany(sb->sb_blocksize,sb->sb_inodesize))
-		return(XR_BAD_INO_SIZE_DATA);
+	if (sb->sb_inodesize < XFS_DINODE_MIN_SIZE                     ||
+	    sb->sb_inodesize > XFS_DINODE_MAX_SIZE                     ||
+	    sb->sb_inodelog < XFS_DINODE_MIN_LOG                       ||
+	    sb->sb_inodelog > XFS_DINODE_MAX_LOG                       ||
+	    sb->sb_inodesize != (1 << sb->sb_inodelog)                 ||
+	    sb->sb_logsunit > XLOG_MAX_RECORD_BSIZE                    ||
+	    sb->sb_inopblock != howmany(sb->sb_blocksize, sb->sb_inodesize) ||
+	    (sb->sb_blocklog - sb->sb_inodelog != sb->sb_inopblog))
+		return XR_BAD_INO_SIZE_DATA;
 
 	if (xfs_sb_version_hassector(sb))  {
 
@@ -492,7 +494,12 @@ verify_sb(char *sb_buf, xfs_sb_t *sb, in
 		if ((sb->sb_unit && !sb->sb_width) ||
 		    (sb->sb_width && sb->sb_unit && sb->sb_width % sb->sb_unit))
 			return(XR_BAD_SB_WIDTH);
-	}
+	} else if (sb->sb_unit || sb->sb_width)
+		return XR_BAD_SB_WIDTH;
+
+	/* Directory block log */
+	if (sb->sb_blocklog + sb->sb_dirblklog > XFS_MAX_BLOCKSIZE_LOG)
+		return XR_BAD_DIR_SIZE_DATA;
 
 	return(XR_OK);
 }
diff -urpN xfsprogs-4.9.0/repair/scan.c xfsprogs-4.14.0/repair/scan.c
--- xfsprogs-4.9.0/repair/scan.c	2017-01-05 18:42:06.000000000 +0100
+++ xfsprogs-4.14.0/repair/scan.c	2017-11-27 17:57:55.000000000 +0100
@@ -42,13 +42,13 @@ struct aghdr_cnts {
 	xfs_agnumber_t	agno;
 	xfs_extlen_t	agffreeblks;
 	xfs_extlen_t	agflongest;
-	__uint64_t	agfbtreeblks;
-	__uint32_t	agicount;
-	__uint32_t	agifreecount;
-	__uint64_t	fdblocks;
-	__uint64_t	usedblocks;
-	__uint64_t	ifreecount;
-	__uint32_t	fibtfreecount;
+	uint64_t	agfbtreeblks;
+	uint32_t	agicount;
+	uint32_t	agifreecount;
+	uint64_t	fdblocks;
+	uint64_t	usedblocks;
+	uint64_t	ifreecount;
+	uint32_t	fibtfreecount;
 };
 
 void
@@ -70,10 +70,10 @@ scan_sbtree(
 				xfs_agnumber_t		agno,
 				int			suspect,
 				int			isroot,
-				__uint32_t		magic,
+				uint32_t		magic,
 				void			*priv),
 	int		isroot,
-	__uint32_t	magic,
+	uint32_t	magic,
 	void		*priv,
 	const struct xfs_buf_ops *ops)
 {
@@ -110,23 +110,23 @@ scan_lbtree(
 				xfs_fsblock_t		bno,
 				xfs_ino_t		ino,
 				xfs_rfsblock_t		*tot,
-				__uint64_t		*nex,
+				uint64_t		*nex,
 				blkmap_t		**blkmapp,
 				bmap_cursor_t		*bm_cursor,
 				int			isroot,
 				int			check_dups,
 				int			*dirty,
-				__uint64_t		magic),
+				uint64_t		magic),
 	int		type,
 	int		whichfork,
 	xfs_ino_t	ino,
 	xfs_rfsblock_t	*tot,
-	__uint64_t	*nex,
+	uint64_t	*nex,
 	blkmap_t	**blkmapp,
 	bmap_cursor_t	*bm_cursor,
 	int		isroot,
 	int		check_dups,
-	__uint64_t	magic,
+	uint64_t	magic,
 	const struct xfs_buf_ops *ops)
 {
 	xfs_buf_t	*bp;
@@ -179,13 +179,13 @@ scan_bmapbt(
 	xfs_fsblock_t		bno,
 	xfs_ino_t		ino,
 	xfs_rfsblock_t		*tot,
-	__uint64_t		*nex,
+	uint64_t		*nex,
 	blkmap_t		**blkmapp,
 	bmap_cursor_t		*bm_cursor,
 	int			isroot,
 	int			check_dups,
 	int			*dirty,
-	__uint64_t		magic)
+	uint64_t		magic)
 {
 	int			i;
 	int			err;
@@ -227,7 +227,9 @@ _("expected level %d got %d in inode %"
 		if (be64_to_cpu(block->bb_u.l.bb_owner) != ino) {
 			do_warn(
 _("expected owner inode %" PRIu64 ", got %llu, bmbt block %" PRIu64 "\n"),
-				ino, be64_to_cpu(block->bb_u.l.bb_owner), bno);
+				ino,
+				(unsigned long long)be64_to_cpu(block->bb_u.l.bb_owner),
+				bno);
 			return 1;
 		}
 		/* verify block number */
@@ -236,7 +238,8 @@ _("expected owner inode %" PRIu64 ", got
 			do_warn(
 _("expected block %" PRIu64 ", got %llu, bmbt block %" PRIu64 "\n"),
 				XFS_FSB_TO_DADDR(mp, bno),
-				be64_to_cpu(block->bb_u.l.bb_blkno), bno);
+				(unsigned long long)be64_to_cpu(block->bb_u.l.bb_blkno),
+				bno);
 			return 1;
 		}
 		/* verify uuid */
@@ -383,7 +386,10 @@ _("bad state %d, inode %" PRIu64 " bmap
 
 	/* Record BMBT blocks in the reverse-mapping data. */
 	if (check_dups && collect_rmaps) {
+		agno = XFS_FSB_TO_AGNO(mp, bno);
+		pthread_mutex_lock(&ag_locks[agno].lock);
 		error = rmap_add_bmbt_rec(mp, ino, whichfork, bno);
+		pthread_mutex_unlock(&ag_locks[agno].lock);
 		if (error)
 			do_error(
 _("couldn't add inode %"PRIu64" bmbt block %"PRIu64" reverse-mapping data."),
@@ -548,7 +554,7 @@ scan_allocbt(
 	xfs_agnumber_t		agno,
 	int			suspect,
 	int			isroot,
-	__uint32_t		magic,
+	uint32_t		magic,
 	void			*priv)
 {
 	struct aghdr_cnts	*agcnts = priv;
@@ -930,7 +936,7 @@ scan_rmapbt(
 	xfs_agnumber_t		agno,
 	int			suspect,
 	int			isroot,
-	__uint32_t		magic,
+	uint32_t		magic,
 	void			*priv)
 {
 	const char		*name = "rmap";
@@ -1233,7 +1239,7 @@ scan_refcbt(
 	xfs_agnumber_t		agno,
 	int			suspect,
 	int			isroot,
-	__uint32_t		magic,
+	uint32_t		magic,
 	void			*priv)
 {
 	const char		*name = "refcount";
@@ -1584,7 +1590,7 @@ import_single_ino_chunk(
 _("ir_holemask/ir_free mismatch, %s chunk %d/%u, holemask 0x%x free 0x%llx\n"),
 					inobt_name, agno, ino,
 					be16_to_cpu(rp->ir_u.sp.ir_holemask),
-					be64_to_cpu(rp->ir_free));
+					(unsigned long long)be64_to_cpu(rp->ir_free));
 				suspect++;
 			}
 			if (!suspect && ino_rec)
@@ -1939,7 +1945,7 @@ scan_inobt(
 	xfs_agnumber_t		agno,
 	int			suspect,
 	int			isroot,
-	__uint32_t		magic,
+	uint32_t		magic,
 	void			*priv)
 {
 	struct aghdr_cnts	*agcnts = priv;
@@ -2176,7 +2182,7 @@ validate_agf(
 	struct aghdr_cnts	*agcnts)
 {
 	xfs_agblock_t		bno;
-	__uint32_t		magic;
+	uint32_t		magic;
 
 	bno = be32_to_cpu(agf->agf_roots[XFS_BTNUM_BNO]);
 	if (bno != 0 && verify_agbno(mp, agno, bno)) {
@@ -2274,7 +2280,7 @@ validate_agi(
 {
 	xfs_agblock_t		bno;
 	int			i;
-	__uint32_t		magic;
+	uint32_t		magic;
 
 	bno = be32_to_cpu(agi->agi_root);
 	if (bno != 0 && verify_agbno(mp, agno, bno)) {
@@ -2499,10 +2505,10 @@ scan_ags(
 	int			scan_threads)
 {
 	struct aghdr_cnts *agcnts;
-	__uint64_t	fdblocks = 0;
-	__uint64_t	icount = 0;
-	__uint64_t	ifreecount = 0;
-	__uint64_t	usedblocks = 0;
+	uint64_t	fdblocks = 0;
+	uint64_t	icount = 0;
+	uint64_t	ifreecount = 0;
+	uint64_t	usedblocks = 0;
 	xfs_agnumber_t	i;
 	work_queue_t	wq;
 
diff -urpN xfsprogs-4.9.0/repair/scan.h xfsprogs-4.14.0/repair/scan.h
--- xfsprogs-4.9.0/repair/scan.h	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/repair/scan.h	2017-11-20 01:14:14.000000000 +0100
@@ -30,23 +30,23 @@ int scan_lbtree(
 				xfs_fsblock_t		bno,
 				xfs_ino_t		ino,
 				xfs_rfsblock_t		*tot,
-				__uint64_t		*nex,
+				uint64_t		*nex,
 				struct blkmap		**blkmapp,
 				bmap_cursor_t		*bm_cursor,
 				int			isroot,
 				int			check_dups,
 				int			*dirty,
-				__uint64_t		magic),
+				uint64_t		magic),
 	int		type,
 	int		whichfork,
 	xfs_ino_t	ino,
 	xfs_rfsblock_t	*tot,
-	__uint64_t	*nex,
+	uint64_t	*nex,
 	struct blkmap	**blkmapp,
 	bmap_cursor_t	*bm_cursor,
 	int		isroot,
 	int		check_dups,
-	__uint64_t	magic,
+	uint64_t	magic,
 	const struct xfs_buf_ops *ops);
 
 int scan_bmapbt(
@@ -57,13 +57,13 @@ int scan_bmapbt(
 	xfs_fsblock_t		bno,
 	xfs_ino_t		ino,
 	xfs_rfsblock_t		*tot,
-	__uint64_t		*nex,
+	uint64_t		*nex,
 	struct blkmap		**blkmapp,
 	bmap_cursor_t		*bm_cursor,
 	int			isroot,
 	int			check_dups,
 	int			*dirty,
-	__uint64_t		magic);
+	uint64_t		magic);
 
 void
 scan_ags(
diff -urpN xfsprogs-4.9.0/repair/slab.c xfsprogs-4.14.0/repair/slab.c
--- xfsprogs-4.9.0/repair/slab.c	2016-12-13 21:07:15.000000000 +0100
+++ xfsprogs-4.14.0/repair/slab.c	2017-11-27 17:57:55.000000000 +0100
@@ -469,7 +469,7 @@ bag_remove(
 {
 	ASSERT(nr < bag->bg_inuse);
 	memmove(&bag->bg_ptrs[nr], &bag->bg_ptrs[nr + 1],
-		(bag->bg_inuse - nr) * sizeof(void *));
+		(bag->bg_inuse - nr - 1) * sizeof(void *));
 	bag->bg_inuse--;
 	return 0;
 }
diff -urpN xfsprogs-4.9.0/repair/xfs_repair.c xfsprogs-4.14.0/repair/xfs_repair.c
--- xfsprogs-4.9.0/repair/xfs_repair.c	2017-01-05 18:42:06.000000000 +0100
+++ xfsprogs-4.14.0/repair/xfs_repair.c	2017-11-20 01:14:14.000000000 +0100
@@ -143,6 +143,8 @@ err_string(int err_code)
 			_("bad shared version number in superblock");
 		err_message[XR_BAD_CRC] =
 			_("bad CRC in superblock");
+		err_message[XR_BAD_DIR_SIZE_DATA] =
+			_("inconsistent directory geometry information");
 		done = 1;
 	}
 
@@ -625,6 +627,40 @@ is_multidisk_filesystem(
 	return true;
 }
 
+/*
+ * if the sector size of the filesystem we are trying to repair is
+ * smaller than that of the underlying filesystem (i.e. we are repairing
+ * an image), the we have to turn off direct IO because we cannot do IO
+ * smaller than the host filesystem's sector size.
+ */
+static void
+check_fs_vs_host_sectsize(
+	struct xfs_sb	*sb)
+{
+	int	fd;
+	long	old_flags;
+	struct xfs_fsop_geom_v1 geom = { 0 };
+
+	fd = libxfs_device_to_fd(x.ddev);
+
+	if (ioctl(fd, XFS_IOC_FSGEOMETRY_V1, &geom) < 0) {
+		do_log(_("Cannot get host filesystem geometry.\n"
+	"Repair may fail if there is a sector size mismatch between\n"
+	"the image and the host filesystem.\n"));
+		geom.sectsize = BBSIZE;
+	}
+
+	if (sb->sb_sectsize < geom.sectsize) {
+		old_flags = fcntl(fd, F_GETFL, 0);
+		if (fcntl(fd, F_SETFL, old_flags & ~O_DIRECT) < 0) {
+			do_warn(_(
+	"Sector size on host filesystem larger than image sector size.\n"
+	"Cannot turn off direct IO, so exiting.\n"));
+			exit(1);
+		}
+	}
+}
+
 int
 main(int argc, char **argv)
 {
@@ -655,6 +691,25 @@ main(int argc, char **argv)
 	timestamp(PHASE_START, 0, NULL);
 	timestamp(PHASE_END, 0, NULL);
 
+	/* -f forces this, but let's be nice and autodetect it, as well. */
+	if (!isa_file) {
+		int		fd = libxfs_device_to_fd(x.ddev);
+		struct stat	statbuf;
+
+		if (fstat(fd, &statbuf) < 0)
+			do_warn(_("%s: couldn't stat \"%s\"\n"),
+				progname, fs_name);
+		else if (S_ISREG(statbuf.st_mode))
+			isa_file = 1;
+	}
+
+	if (isa_file) {
+		/* Best effort attempt to validate fs vs host sector size */
+		rval = get_sb(&psb, 0, XFS_MAX_SECTORSIZE, 0);
+		if (rval == XR_OK)
+			check_fs_vs_host_sectsize(&psb);
+	}
+
 	/* do phase1 to make sure we have a superblock */
 	phase1(temp_mp);
 	timestamp(PHASE_END, 1, NULL);
@@ -673,47 +728,12 @@ main(int argc, char **argv)
 		exit(1);
 	}
 
-	/* -f forces this, but let's be nice and autodetect it, as well. */
-	if (!isa_file) {
-		int		fd = libxfs_device_to_fd(x.ddev);
-		struct stat	statbuf;
-
-		if (fstat(fd, &statbuf) < 0)
-			do_warn(_("%s: couldn't stat \"%s\"\n"),
-				progname, fs_name);
-		else if (S_ISREG(statbuf.st_mode))
-			isa_file = 1;
-	}
-
 	/*
-	 * if the sector size of the filesystem we are trying to repair is
-	 * smaller than that of the underlying filesystem (i.e. we are repairing
-	 * an image), the we have to turn off direct IO because we cannot do IO
-	 * smaller than the host filesystem's sector size.
+	 * Now that we have completely validated the superblock, geometry may
+	 * have changed; re-check geometry vs the host filesystem geometry
 	 */
-	if (isa_file) {
-		int     fd = libxfs_device_to_fd(x.ddev);
-		struct xfs_fsop_geom_v1 geom = { 0 };
-
-		if (ioctl(fd, XFS_IOC_FSGEOMETRY_V1, &geom) < 0) {
-			do_log(_("Cannot get host filesystem geometry.\n"
-		"Repair may fail if there is a sector size mismatch between\n"
-		"the image and the host filesystem.\n"));
-			geom.sectsize = BBSIZE;
-		}
-
-		if (psb.sb_sectsize < geom.sectsize) {
-			long	old_flags;
-
-			old_flags = fcntl(fd, F_GETFL, 0);
-			if (fcntl(fd, F_SETFL, old_flags & ~O_DIRECT) < 0) {
-				do_warn(_(
-		"Sector size on host filesystem larger than image sector size.\n"
-		"Cannot turn off direct IO, so exiting.\n"));
-				exit(1);
-			}
-		}
-	}
+	if (isa_file)
+		check_fs_vs_host_sectsize(&psb);
 
 	/*
 	 * Prepare the mount structure. Point the log reference to our local
@@ -741,7 +761,7 @@ main(int argc, char **argv)
 	glob_agcount = mp->m_sb.sb_agcount;
 
 	chunks_pblock = mp->m_sb.sb_inopblock / XFS_INODES_PER_CHUNK;
-	max_symlink_blocks = libxfs_symlink_blocks(mp, MAXPATHLEN);
+	max_symlink_blocks = libxfs_symlink_blocks(mp, XFS_SYMLINK_MAXLEN);
 	inodes_per_cluster = MAX(mp->m_sb.sb_inopblock,
 			mp->m_inode_cluster_size >> mp->m_sb.sb_inodelog);
 
diff -urpN xfsprogs-4.9.0/spaceman/Makefile xfsprogs-4.14.0/spaceman/Makefile
--- xfsprogs-4.9.0/spaceman/Makefile	1970-01-01 01:00:00.000000000 +0100
+++ xfsprogs-4.14.0/spaceman/Makefile	2017-11-20 01:14:14.000000000 +0100
@@ -0,0 +1,40 @@
+#
+# Copyright (c) 2012 Red Hat, Inc.  All Rights Reserved.
+#
+
+TOPDIR = ..
+include $(TOPDIR)/include/builddefs
+
+LTCOMMAND = xfs_spaceman
+HFILES = init.h space.h
+CFILES = init.c file.c prealloc.c trim.c
+
+LLDLIBS = $(LIBXCMD)
+LTDEPENDENCIES = $(LIBXCMD)
+LLDFLAGS = -static
+
+ifeq ($(ENABLE_READLINE),yes)
+LLDLIBS += $(LIBREADLINE) $(LIBTERMCAP)
+endif
+
+ifeq ($(ENABLE_EDITLINE),yes)
+LLDLIBS += $(LIBEDITLINE) $(LIBTERMCAP)
+endif
+
+# On linux we get fsmap from the system or define it ourselves
+# so include this based on platform type.  If this reverts to only
+# the autoconf check w/o local definition, change to testing HAVE_GETFSMAP
+ifeq ($(PKG_PLATFORM),linux)
+CFILES += freesp.c
+endif
+
+default: depend $(LTCOMMAND)
+
+include $(BUILDRULES)
+
+install: default
+	$(INSTALL) -m 755 -d $(PKG_SBIN_DIR)
+	$(LTINSTALL) -m 755 $(LTCOMMAND) $(PKG_SBIN_DIR)
+install-dev:
+
+-include .dep
diff -urpN xfsprogs-4.9.0/spaceman/file.c xfsprogs-4.14.0/spaceman/file.c
--- xfsprogs-4.9.0/spaceman/file.c	1970-01-01 01:00:00.000000000 +0100
+++ xfsprogs-4.14.0/spaceman/file.c	2017-11-20 01:14:14.000000000 +0100
@@ -0,0 +1,138 @@
+/*
+ * Copyright (c) 2004-2005 Silicon Graphics, Inc.
+ * Copyright (c) 2012 Red Hat, Inc.
+ * All Rights Reserved.
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License as
+ * published by the Free Software Foundation.
+ *
+ * This program is distributed in the hope that it would be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write the Free Software Foundation,
+ * Inc.,  51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
+ */
+
+#include "libxfs.h"
+#include <sys/mman.h>
+#include "command.h"
+#include "input.h"
+#include "init.h"
+#include "path.h"
+#include "space.h"
+
+static cmdinfo_t print_cmd;
+
+fileio_t	*filetable;
+int		filecount;
+fileio_t	*file;
+
+static void
+print_fileio(
+	fileio_t	*file,
+	int		index,
+	int		braces)
+{
+	printf(_("%c%03d%c %-14s\n"), braces? '[' : ' ', index,
+			braces? ']' : ' ', file->name);
+}
+
+static int
+print_f(
+	int		argc,
+	char		**argv)
+{
+	int		i;
+
+	for (i = 0; i < filecount; i++)
+		print_fileio(&filetable[i], i, &filetable[i] == file);
+	return 0;
+}
+
+int
+openfile(
+	char		*path,
+	xfs_fsop_geom_t	*geom,
+	struct fs_path	*fs_path)
+{
+	struct fs_path	*fsp;
+	int		fd;
+
+	fd = open(path, 0);
+	if (fd < 0) {
+		perror(path);
+		return -1;
+	}
+
+	if (ioctl(fd, XFS_IOC_FSGEOMETRY, geom) < 0) {
+		perror("XFS_IOC_FSGEOMETRY");
+		close(fd);
+		return -1;
+	}
+
+	if (fs_path) {
+		fsp = fs_table_lookup(path, FS_MOUNT_POINT);
+		if (!fsp) {
+			fprintf(stderr, _("%s: cannot find mount point."),
+				path);
+			close(fd);
+			return -1;
+		}
+		memcpy(fs_path, fsp, sizeof(struct fs_path));
+	}
+	return fd;
+}
+
+int
+addfile(
+	char		*name,
+	int		fd,
+	xfs_fsop_geom_t	*geometry,
+	struct fs_path	*fs_path)
+{
+	char		*filename;
+
+	filename = strdup(name);
+	if (!filename) {
+		perror("strdup");
+		close(fd);
+		return -1;
+	}
+
+	/* Extend the table of currently open files */
+	filetable = (fileio_t *)realloc(filetable,	/* growing */
+					++filecount * sizeof(fileio_t));
+	if (!filetable) {
+		perror("realloc");
+		filecount = 0;
+		free(filename);
+		close(fd);
+		return -1;
+	}
+
+	/* Finally, make this the new active open file */
+	file = &filetable[filecount - 1];
+	file->fd = fd;
+	file->name = filename;
+	file->geom = *geometry;
+	memcpy(&file->fs_path, fs_path, sizeof(file->fs_path));
+	return 0;
+}
+
+void
+print_init(void)
+{
+	print_cmd.name = "print";
+	print_cmd.altname = "p";
+	print_cmd.cfunc = print_f;
+	print_cmd.argmin = 0;
+	print_cmd.argmax = 0;
+	print_cmd.flags = CMD_FLAG_ONESHOT;
+	print_cmd.oneline = _("list current open files");
+
+	add_command(&print_cmd);
+}
diff -urpN xfsprogs-4.9.0/spaceman/freesp.c xfsprogs-4.14.0/spaceman/freesp.c
--- xfsprogs-4.9.0/spaceman/freesp.c	1970-01-01 01:00:00.000000000 +0100
+++ xfsprogs-4.14.0/spaceman/freesp.c	2017-11-20 01:14:14.000000000 +0100
@@ -0,0 +1,415 @@
+/*
+ * Copyright (c) 2000-2001,2005 Silicon Graphics, Inc.
+ * Copyright (c) 2012 Red Hat, Inc.
+ * Copyright (c) 2017 Oracle.
+ * All Rights Reserved.
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License as
+ * published by the Free Software Foundation.
+ *
+ * This program is distributed in the hope that it would be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write the Free Software Foundation,
+ * Inc.,  51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
+ */
+
+#include "libxfs.h"
+#include <linux/fiemap.h>
+#include "command.h"
+#include "init.h"
+#include "path.h"
+#include "space.h"
+#include "input.h"
+
+typedef struct histent
+{
+	long long	low;
+	long long	high;
+	long long	count;
+	long long	blocks;
+} histent_t;
+
+static int		agcount;
+static xfs_agnumber_t	*aglist;
+static histent_t	*hist;
+static int		dumpflag;
+static long long	equalsize;
+static long long	multsize;
+static int		histcount;
+static int		seen1;
+static int		summaryflag;
+static int		gflag;
+static bool		rtflag;
+static long long	totblocks;
+static long long	totexts;
+
+static cmdinfo_t freesp_cmd;
+
+static void
+addhistent(
+	long long	h)
+{
+	if (histcount == INT_MAX) {
+		printf(_("Too many histogram buckets.\n"));
+		return;
+	}
+	hist = realloc(hist, (histcount + 1) * sizeof(*hist));
+	if (h == 0)
+		h = 1;
+	hist[histcount].low = h;
+	hist[histcount].count = hist[histcount].blocks = 0;
+	histcount++;
+	if (h == 1)
+		seen1 = 1;
+}
+
+static void
+addtohist(
+	xfs_agnumber_t	agno,
+	xfs_agblock_t	agbno,
+	off64_t		len)
+{
+	long		i;
+
+	if (dumpflag)
+		printf("%8d %8d %8"PRId64"\n", agno, agbno, len);
+	totexts++;
+	totblocks += len;
+	for (i = 0; i < histcount; i++) {
+		if (hist[i].high >= len) {
+			hist[i].count++;
+			hist[i].blocks += len;
+			break;
+		}
+	}
+}
+
+static int
+hcmp(
+	const void	*a,
+	const void	*b)
+{
+	return ((histent_t *)a)->low - ((histent_t *)b)->low;
+}
+
+static void
+histinit(
+	long long	maxlen)
+{
+	long long	i;
+
+	if (equalsize) {
+		for (i = 1; i < maxlen; i += equalsize)
+			addhistent(i);
+	} else if (multsize) {
+		for (i = 1; i < maxlen; i *= multsize)
+			addhistent(i);
+	} else {
+		if (!seen1)
+			addhistent(1);
+		qsort(hist, histcount, sizeof(*hist), hcmp);
+	}
+	for (i = 0; i < histcount; i++) {
+		if (i < histcount - 1)
+			hist[i].high = hist[i + 1].low - 1;
+		else
+			hist[i].high = maxlen;
+	}
+}
+
+static void
+printhist(void)
+{
+	int	i;
+
+	printf("%7s %7s %7s %7s %6s\n",
+		_("from"), _("to"), _("extents"), _("blocks"), _("pct"));
+	for (i = 0; i < histcount; i++) {
+		if (hist[i].count)
+			printf("%7lld %7lld %7lld %7lld %6.2f\n", hist[i].low,
+				hist[i].high, hist[i].count, hist[i].blocks,
+				hist[i].blocks * 100.0 / totblocks);
+	}
+}
+
+static int
+inaglist(
+	xfs_agnumber_t	agno)
+{
+	int		i;
+
+	if (agcount == 0)
+		return 1;
+	for (i = 0; i < agcount; i++)
+		if (aglist[i] == agno)
+			return 1;
+	return 0;
+}
+
+#define NR_EXTENTS 128
+
+static void
+scan_ag(
+	xfs_agnumber_t		agno)
+{
+	struct fsmap_head	*fsmap;
+	struct fsmap		*extent;
+	struct fsmap		*l, *h;
+	struct fsmap		*p;
+	off64_t			blocksize = file->geom.blocksize;
+	off64_t			bperag;
+	off64_t			aglen;
+	xfs_agblock_t		agbno;
+	unsigned long long	freeblks = 0;
+	unsigned long long	freeexts = 0;
+	int			ret;
+	int			i;
+
+	bperag = (off64_t)file->geom.agblocks * blocksize;
+
+	fsmap = malloc(fsmap_sizeof(NR_EXTENTS));
+	if (!fsmap) {
+		fprintf(stderr, _("%s: fsmap malloc failed.\n"), progname);
+		exitcode = 1;
+		return;
+	}
+
+	memset(fsmap, 0, sizeof(*fsmap));
+	fsmap->fmh_count = NR_EXTENTS;
+	l = fsmap->fmh_keys;
+	h = fsmap->fmh_keys + 1;
+	if (agno != NULLAGNUMBER) {
+		l->fmr_physical = agno * bperag;
+		h->fmr_physical = ((agno + 1) * bperag) - 1;
+		l->fmr_device = h->fmr_device = file->fs_path.fs_datadev;
+	} else {
+		l->fmr_physical = 0;
+		h->fmr_physical = ULLONG_MAX;
+		l->fmr_device = h->fmr_device = file->fs_path.fs_rtdev;
+	}
+	h->fmr_owner = ULLONG_MAX;
+	h->fmr_flags = UINT_MAX;
+	h->fmr_offset = ULLONG_MAX;
+
+	while (true) {
+		ret = ioctl(file->fd, FS_IOC_GETFSMAP, fsmap);
+		if (ret < 0) {
+			fprintf(stderr, _("%s: FS_IOC_GETFSMAP [\"%s\"]: %s\n"),
+				progname, file->name, strerror(errno));
+			free(fsmap);
+			exitcode = 1;
+			return;
+		}
+
+		/* No more extents to map, exit */
+		if (!fsmap->fmh_entries)
+			break;
+
+		for (i = 0, extent = fsmap->fmh_recs;
+		     i < fsmap->fmh_entries;
+		     i++, extent++) {
+			if (!(extent->fmr_flags & FMR_OF_SPECIAL_OWNER) ||
+			    extent->fmr_owner != XFS_FMR_OWN_FREE)
+				continue;
+			agbno = (extent->fmr_physical - (bperag * agno)) /
+								blocksize;
+			aglen = extent->fmr_length / blocksize;
+			freeblks += aglen;
+			freeexts++;
+
+			addtohist(agno, agbno, aglen);
+		}
+
+		p = &fsmap->fmh_recs[fsmap->fmh_entries - 1];
+		if (p->fmr_flags & FMR_OF_LAST)
+			break;
+		fsmap_advance(fsmap);
+	}
+
+	if (gflag) {
+		if (agno == NULLAGNUMBER)
+			printf(_("     rtdev %10llu %10llu\n"), freeexts,
+					freeblks);
+		else
+			printf(_("%10u %10llu %10llu\n"), agno, freeexts,
+					freeblks);
+	}
+	free(fsmap);
+}
+
+static void
+aglistadd(
+	char		*a)
+{
+	xfs_agnumber_t	x;
+
+	aglist = realloc(aglist, (agcount + 1) * sizeof(*aglist));
+	x = cvt_u32(a, 0);
+	if (errno) {
+		printf(_("Unrecognized AG number: %s\n"), a);
+		return;
+	}
+	aglist[agcount] = x;
+	agcount++;
+}
+
+static int
+init(
+	int		argc,
+	char		**argv)
+{
+	long long	x;
+	int		c;
+	int		speced = 0;	/* only one of -b -e -h or -m */
+
+	agcount = dumpflag = equalsize = multsize = optind = gflag = 0;
+	histcount = seen1 = summaryflag = 0;
+	totblocks = totexts = 0;
+	aglist = NULL;
+	hist = NULL;
+	rtflag = false;
+
+	while ((c = getopt(argc, argv, "a:bde:gh:m:rs")) != EOF) {
+		switch (c) {
+		case 'a':
+			aglistadd(optarg);
+			break;
+		case 'b':
+			if (speced)
+				goto many_spec;
+			multsize = 2;
+			speced = 1;
+			break;
+		case 'd':
+			dumpflag = 1;
+			break;
+		case 'e':
+			if (speced)
+				goto many_spec;
+			equalsize = cvt_s64(optarg, 0);
+			if (errno)
+				return command_usage(&freesp_cmd);
+			speced = 1;
+			break;
+		case 'g':
+			histcount = 0;
+			gflag++;
+			break;
+		case 'h':
+			if (speced && !histcount)
+				goto many_spec;
+			/* addhistent increments histcount */
+			x = cvt_s64(optarg, 0);
+			if (errno)
+				return command_usage(&freesp_cmd);
+			addhistent(x);
+			speced = 1;
+			break;
+		case 'm':
+			if (speced)
+				goto many_spec;
+			multsize = cvt_s64(optarg, 0);
+			if (errno)
+				return command_usage(&freesp_cmd);
+			speced = 1;
+			break;
+		case 'r':
+			rtflag = true;
+			break;
+		case 's':
+			summaryflag = 1;
+			break;
+		case '?':
+		default:
+			return command_usage(&freesp_cmd);
+		}
+	}
+	if (optind != argc)
+		return 0;
+	if (!speced)
+		multsize = 2;
+	histinit(file->geom.agblocks);
+	return 1;
+many_spec:
+	return command_usage(&freesp_cmd);
+}
+
+/*
+ * Report on freespace usage in xfs filesystem.
+ */
+static int
+freesp_f(
+	int		argc,
+	char		**argv)
+{
+	xfs_agnumber_t	agno;
+
+	if (!init(argc, argv))
+		return 0;
+	if (gflag)
+		printf(_("        AG    extents     blocks\n"));
+	if (rtflag)
+		scan_ag(NULLAGNUMBER);
+	for (agno = 0; !rtflag && agno < file->geom.agcount; agno++)  {
+		if (inaglist(agno))
+			scan_ag(agno);
+	}
+	if (histcount && !gflag)
+		printhist();
+	if (summaryflag) {
+		printf(_("total free extents %lld\n"), totexts);
+		printf(_("total free blocks %lld\n"), totblocks);
+		printf(_("average free extent size %g\n"),
+			(double)totblocks / (double)totexts);
+	}
+	if (aglist)
+		free(aglist);
+	if (hist)
+		free(hist);
+	return 0;
+}
+
+static void
+freesp_help(void)
+{
+	printf(_(
+"\n"
+"Examine filesystem free space\n"
+"\n"
+" -a agno  -- Scan only the given AG agno.\n"
+" -b       -- binary histogram bin size\n"
+" -d       -- debug output\n"
+" -e bsize -- Use fixed histogram bin size of bsize\n"
+" -g       -- Print only a per-AG summary.\n"
+" -h hbsz  -- Use custom histogram bin size of h1.\n"
+"             Multiple specifications are allowed.\n"
+" -m bmult -- Use histogram bin size multiplier of bmult.\n"
+" -r       -- Display realtime device free space information.\n"
+" -s       -- Emit freespace summary information.\n"
+"\n"
+"Only one of -b, -e, -h, or -m may be specified.\n"
+"\n"));
+
+}
+
+void
+freesp_init(void)
+{
+	freesp_cmd.name = "freesp";
+	freesp_cmd.altname = "fsp";
+	freesp_cmd.cfunc = freesp_f;
+	freesp_cmd.argmin = 0;
+	freesp_cmd.argmax = -1;
+	freesp_cmd.args = "[-dgrs] [-a agno]... [ -b | -e bsize | -h h1... | -m bmult ]";
+	freesp_cmd.flags = CMD_FLAG_ONESHOT;
+	freesp_cmd.oneline = _("Examine filesystem free space");
+	freesp_cmd.help = freesp_help;
+
+	add_command(&freesp_cmd);
+}
+
diff -urpN xfsprogs-4.9.0/spaceman/init.c xfsprogs-4.14.0/spaceman/init.c
--- xfsprogs-4.9.0/spaceman/init.c	1970-01-01 01:00:00.000000000 +0100
+++ xfsprogs-4.14.0/spaceman/init.c	2017-11-20 01:14:14.000000000 +0100
@@ -0,0 +1,119 @@
+/*
+ * Copyright (c) 2012 Red Hat, Inc
+ * All Rights Reserved.
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License as
+ * published by the Free Software Foundation.
+ *
+ * This program is distributed in the hope that it would be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write the Free Software Foundation,
+ * Inc.,  51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
+ */
+
+#include "libxfs.h"
+#include "command.h"
+#include "input.h"
+#include "init.h"
+#include "path.h"
+#include "space.h"
+
+char	*progname;
+int	exitcode;
+
+void
+usage(void)
+{
+	fprintf(stderr,
+		_("Usage: %s [-c cmd] file\n"),
+		progname);
+	exit(1);
+}
+
+static void
+init_commands(void)
+{
+	print_init();
+	help_init();
+	prealloc_init();
+	quit_init();
+	trim_init();
+	freesp_init();
+}
+
+static int
+init_args_command(
+	int	index)
+{
+	if (index >= filecount)
+		return 0;
+	file = &filetable[index++];
+	return index;
+}
+
+static int
+init_check_command(
+	const cmdinfo_t	*ct)
+{
+	if (!(ct->flags & CMD_FLAG_ONESHOT))
+		return 0;
+	return 1;
+}
+
+void
+init(
+	int		argc,
+	char		**argv)
+{
+	int		c;
+	xfs_fsop_geom_t	geometry = { 0 };
+	struct fs_path	fsp;
+
+	progname = basename(argv[0]);
+	setlocale(LC_ALL, "");
+	bindtextdomain(PACKAGE, LOCALEDIR);
+	textdomain(PACKAGE);
+
+	fs_table_initialise(0, NULL, 0, NULL);
+	while ((c = getopt(argc, argv, "c:V")) != EOF) {
+		switch (c) {
+		case 'c':
+			add_user_command(optarg);
+			break;
+		case 'V':
+			printf(_("%s version %s\n"), progname, VERSION);
+			exit(0);
+		default:
+			usage();
+		}
+	}
+
+	if (optind != argc - 1)
+		usage();
+
+	if ((c = openfile(argv[optind], &geometry, &fsp)) < 0)
+		exit(1);
+	if (!platform_test_xfs_fd(c))
+		printf(_("Not an XFS filesystem!\n"));
+	if (addfile(argv[optind], c, &geometry, &fsp) < 0)
+		exit(1);
+
+	init_commands();
+	add_command_iterator(init_args_command);
+	add_check_command(init_check_command);
+}
+
+int
+main(
+	int	argc,
+	char	**argv)
+{
+	init(argc, argv);
+	command_loop();
+	return exitcode;
+}
diff -urpN xfsprogs-4.9.0/spaceman/init.h xfsprogs-4.14.0/spaceman/init.h
--- xfsprogs-4.9.0/spaceman/init.h	1970-01-01 01:00:00.000000000 +0100
+++ xfsprogs-4.14.0/spaceman/init.h	2017-11-20 01:14:14.000000000 +0100
@@ -0,0 +1,24 @@
+/*
+ * Copyright (c) 2012 Red Hat, Inc.
+ * All Rights Reserved.
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License as
+ * published by the Free Software Foundation.
+ *
+ * This program is distributed in the hope that it would be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write the Free Software Foundation,
+ * Inc.,  51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
+ */
+#ifndef XFS_SPACEMAN_INIT_H_
+#define XFS_SPACEMAN_INIT_H_
+
+extern char	*progname;
+extern int	exitcode;
+
+#endif /* XFS_SPACEMAN_INIT_H_ */
diff -urpN xfsprogs-4.9.0/spaceman/prealloc.c xfsprogs-4.14.0/spaceman/prealloc.c
--- xfsprogs-4.9.0/spaceman/prealloc.c	1970-01-01 01:00:00.000000000 +0100
+++ xfsprogs-4.14.0/spaceman/prealloc.c	2017-11-20 01:14:14.000000000 +0100
@@ -0,0 +1,119 @@
+/*
+ * Copyright (c) 2012 Red Hat, Inc.
+ * All Rights Reserved.
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License as
+ * published by the Free Software Foundation.
+ *
+ * This program is distributed in the hope that it would be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write the Free Software Foundation,
+ * Inc.,  51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
+ */
+
+#include "libxfs.h"
+#include "command.h"
+#include "input.h"
+#include "init.h"
+#include "path.h"
+#include "space.h"
+
+static cmdinfo_t prealloc_cmd;
+
+/*
+ * Control preallocation amounts.
+ */
+static int
+prealloc_f(
+	int	argc,
+	char	**argv)
+{
+	struct xfs_fs_eofblocks eofb = {0};
+	int	c;
+
+	eofb.eof_version = XFS_EOFBLOCKS_VERSION;
+
+	while ((c = getopt(argc, argv, "g:m:p:su:")) != EOF) {
+		switch (c) {
+		case 'g':
+			eofb.eof_flags |= XFS_EOF_FLAGS_GID;
+			eofb.eof_gid = cvt_u32(optarg, 10);
+			if (errno)
+				return command_usage(&prealloc_cmd);
+			break;
+		case 'u':
+			eofb.eof_flags |= XFS_EOF_FLAGS_UID;
+			eofb.eof_uid = cvt_u32(optarg, 10);
+			if (errno)
+				return command_usage(&prealloc_cmd);
+			break;
+		case 'p':
+			eofb.eof_flags |= XFS_EOF_FLAGS_PRID;
+			eofb.eof_prid = cvt_u32(optarg, 10);
+			if (errno)
+				return command_usage(&prealloc_cmd);
+			break;
+		case 's':
+			eofb.eof_flags |= XFS_EOF_FLAGS_SYNC;
+			break;
+		case 'm':
+			eofb.eof_flags |= XFS_EOF_FLAGS_MINFILESIZE;
+			eofb.eof_min_file_size = cvtnum(file->geom.blocksize,
+							file->geom.sectsize,
+							optarg);
+			break;
+		case '?':
+		default:
+			return command_usage(&prealloc_cmd);
+		}
+	}
+	if (optind != argc)
+		return command_usage(&prealloc_cmd);
+
+	if (ioctl(file->fd, XFS_IOC_FREE_EOFBLOCKS, &eofb) < 0) {
+		fprintf(stderr, _("%s: XFS_IOC_FREE_EOFBLOCKS on %s: %s\n"),
+			progname, file->name, strerror(errno));
+	}
+	return 0;
+}
+
+static void
+prealloc_help(void)
+{
+	printf(_(
+"\n"
+"Remove speculative preallocation\n"
+"\n"
+" -g gid    -- remove prealloc on files matching group <gid>\n"
+" -m minlen -- only consider files larger than <minlen>\n"
+" -p prid   -- remove prealloc on files matching project <prid>\n"
+" -s        -- wait for removal to complete\n"
+" -u uid    -- remove prealloc on files matching user <uid>\n"
+"\n"
+"If none of -u, -g, or -p are specified, this command acts on all files.\n"
+"minlen can take units.\n"
+"\n"));
+
+}
+
+void
+prealloc_init(void)
+{
+	prealloc_cmd.name = "prealloc";
+	prealloc_cmd.altname = "prealloc";
+	prealloc_cmd.cfunc = prealloc_f;
+	prealloc_cmd.argmin = 1;
+	prealloc_cmd.argmax = -1;
+	prealloc_cmd.args = "[-s] [-u id] [-g id] [-p id] [-m minlen]";
+	prealloc_cmd.flags = CMD_FLAG_ONESHOT;
+	prealloc_cmd.oneline = _("Remove speculative preallocation");
+	prealloc_cmd.help = prealloc_help;
+
+	add_command(&prealloc_cmd);
+}
+
diff -urpN xfsprogs-4.9.0/spaceman/space.h xfsprogs-4.14.0/spaceman/space.h
--- xfsprogs-4.9.0/spaceman/space.h	1970-01-01 01:00:00.000000000 +0100
+++ xfsprogs-4.14.0/spaceman/space.h	2017-11-20 01:14:14.000000000 +0100
@@ -0,0 +1,46 @@
+/*
+ * Copyright (c) 2012 Red Hat, Inc.
+ * All Rights Reserved.
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License as
+ * published by the Free Software Foundation.
+ *
+ * This program is distributed in the hope that it would be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write the Free Software Foundation,
+ * Inc.,  51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
+ */
+#ifndef XFS_SPACEMAN_SPACE_H_
+#define XFS_SPACEMAN_SPACE_H_
+
+typedef struct fileio {
+	xfs_fsop_geom_t	geom;		/* XFS filesystem geometry */
+	struct fs_path	fs_path;	/* XFS path information */
+	char		*name;		/* file name at time of open */
+	int		fd;		/* open file descriptor */
+} fileio_t;
+
+extern fileio_t		*filetable;	/* open file table */
+extern int		filecount;	/* number of open files */
+extern fileio_t		*file;		/* active file in file table */
+
+extern int	openfile(char *, xfs_fsop_geom_t *, struct fs_path *);
+extern int	addfile(char *, int , xfs_fsop_geom_t *, struct fs_path *);
+
+extern void	print_init(void);
+extern void	help_init(void);
+extern void	prealloc_init(void);
+extern void	quit_init(void);
+extern void	trim_init(void);
+#ifdef HAVE_GETFSMAP
+extern void	freesp_init(void);
+#else
+# define freesp_init()	do { } while (0)
+#endif
+
+#endif /* XFS_SPACEMAN_SPACE_H_ */
diff -urpN xfsprogs-4.9.0/spaceman/trim.c xfsprogs-4.14.0/spaceman/trim.c
--- xfsprogs-4.9.0/spaceman/trim.c	1970-01-01 01:00:00.000000000 +0100
+++ xfsprogs-4.14.0/spaceman/trim.c	2017-11-20 01:14:14.000000000 +0100
@@ -0,0 +1,132 @@
+/*
+ * Copyright (c) 2012 Red Hat, Inc.
+ * All Rights Reserved.
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License as
+ * published by the Free Software Foundation.
+ *
+ * This program is distributed in the hope that it would be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write the Free Software Foundation,
+ * Inc.,  51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
+ */
+
+#include "libxfs.h"
+#include <linux/fs.h>
+#include "command.h"
+#include "init.h"
+#include "path.h"
+#include "space.h"
+#include "input.h"
+
+static cmdinfo_t trim_cmd;
+
+/*
+ * Trim unused space in xfs filesystem.
+ */
+static int
+trim_f(
+	int		argc,
+	char		**argv)
+{
+	struct fstrim_range trim = {0};
+	xfs_agnumber_t	agno = 0;
+	off64_t		offset = 0;
+	ssize_t		length = 0;
+	ssize_t		minlen = 0;
+	int		aflag = 0;
+	int		fflag = 0;
+	int		ret;
+	int		c;
+
+	while ((c = getopt(argc, argv, "a:fm:")) != EOF) {
+		switch (c) {
+		case 'a':
+			aflag = 1;
+			agno = cvt_u32(optarg, 10);
+			if (errno) {
+				printf(_("bad agno value %s\n"), optarg);
+				return command_usage(&trim_cmd);
+			}
+			break;
+		case 'f':
+			fflag = 1;
+			break;
+		case 'm':
+			minlen = cvtnum(file->geom.blocksize,
+					file->geom.sectsize, optarg);
+			break;
+		default:
+			return command_usage(&trim_cmd);
+		}
+	}
+
+	if (aflag && fflag)
+		return command_usage(&trim_cmd);
+
+	if (optind != argc - 2 && !(aflag || fflag))
+		return command_usage(&trim_cmd);
+	if (optind != argc) {
+		offset = cvtnum(file->geom.blocksize, file->geom.sectsize,
+				argv[optind]);
+		length = cvtnum(file->geom.blocksize, file->geom.sectsize,
+				argv[optind + 1]);
+	} else if (agno) {
+		offset = (off64_t)agno * file->geom.agblocks * file->geom.blocksize;
+		length = file->geom.agblocks * file->geom.blocksize;
+	} else {
+		offset = 0;
+		length = file->geom.datablocks * file->geom.blocksize;
+	}
+
+	trim.start = offset;
+	trim.len = length;
+	trim.minlen = minlen;
+
+	ret = ioctl(file->fd, FITRIM, (unsigned long)&trim);
+	if (ret < 0) {
+		fprintf(stderr, "%s: ioctl(FITRIM) [\"%s\"]: %s\n",
+			progname, file->name, strerror(errno));
+		exitcode = 1;
+	}
+	return 0;
+}
+
+static void
+trim_help(void)
+{
+	printf(_(
+"\n"
+"Discard filesystem free space\n"
+"\n"
+" -a agno       -- trim all the freespace in the given AG agno\n"
+" -f            -- trim all the freespace in the entire filesystem\n"
+" offset length -- trim the freespace in the range {offset, length}\n"
+" -m minlen     -- skip freespace extents smaller than minlen\n"
+"\n"
+"One of -a, -f, or the offset/length pair are required.\n"
+"\n"));
+
+}
+
+void
+trim_init(void)
+{
+	trim_cmd.name = "trim";
+	trim_cmd.altname = "tr";
+	trim_cmd.cfunc = trim_f;
+	trim_cmd.argmin = 1;
+	trim_cmd.argmax = 4;
+	trim_cmd.args = "[-m minlen] ( -a agno | -f | offset length )";
+	trim_cmd.flags = CMD_FLAG_ONESHOT;
+	trim_cmd.oneline = _("Discard filesystem free space");
+	trim_cmd.help = trim_help;
+
+	add_command(&trim_cmd);
+}
+
diff -urpN xfsprogs-4.9.0/tools/find-api-violations.sh xfsprogs-4.14.0/tools/find-api-violations.sh
--- xfsprogs-4.9.0/tools/find-api-violations.sh	2016-12-13 01:41:07.000000000 +0100
+++ xfsprogs-4.14.0/tools/find-api-violations.sh	2017-11-20 01:14:14.000000000 +0100
@@ -6,7 +6,7 @@
 
 # NOTE: This script doesn't look for API violations in function parameters.
 
-tool_dirs="copy db estimate fs fsck fsr growfs io mdrestore mkfs quota repair rtcp"
+tool_dirs="copy db estimate fsck fsr growfs io logprint mdrestore mkfs quota repair rtcp"
 
 # Calls to xfs_* functions in libxfs/*.c without the libxfs_ prefix
 find_possible_api_calls() {
diff -urpN xfsprogs-4.9.0/tools/libxfs-apply xfsprogs-4.14.0/tools/libxfs-apply
--- xfsprogs-4.9.0/tools/libxfs-apply	2017-01-05 18:41:55.000000000 +0100
+++ xfsprogs-4.14.0/tools/libxfs-apply	2017-11-20 01:14:14.000000000 +0100
@@ -66,6 +66,7 @@ PATCH=
 COMMIT_ID=
 VERBOSE=
 GUILT=0
+STGIT=0
 
 while [ $# -gt 0 ]; do
 	case "$1" in
@@ -95,6 +96,12 @@ if [ $? -eq 0 ]; then
 	GUILT=1
 fi
 
+# Are we using stgit? This works even if no patch is applied.
+stg top &> /dev/null
+if [ $? -eq 0 ]; then
+	STGIT=1
+fi
+
 #this is pulled from the guilt code to handle commit ids sanely.
 # usage: munge_hash_range <hash range>
 #
@@ -281,6 +288,7 @@ apply_patch()
 	local _current_commit=$3
 	local _new_patch=`mktemp`
 	local _source="kernel"
+	local _target="xfsprogs"
 
 	# filter just the libxfs parts of the patch
 	if [ $SOURCE == "xfsprogs" ]; then
@@ -294,6 +302,7 @@ apply_patch()
 
 		filter_kernel_patch $_patch > $_new_patch
 		_source="xfsprogs"
+		_target="kernel"
 	elif [ $SOURCE == "kernel" ]; then
 
 		[ -n "$VERBOSE" ] || lsdiff $_patch | grep -q "[ab]/fs/xfs/libxfs/"
@@ -308,6 +317,13 @@ apply_patch()
 		fail "Unknown source repo type: $SOURCE"
 	fi
 
+	grep -q "Source $_target commit: " $_patch
+	if [ "$?" -eq "0" ]; then
+		echo "$_patch_name already synced up"
+		echo "$_skipping commit $_current_commit"
+		return
+	fi
+
 	# now munge the header to be in the correct format.
 	fixup_header_format $_source $_new_patch > $_new_patch.2
 
@@ -331,8 +347,29 @@ apply_patch()
 		if [ $? -eq 0 ]; then
 			guilt refresh
 		else
-			echo "Guilt push failed!"
-			read -r -p "Skip of Fail [s|F]? " response
+			echo "Guilt push of $_current_commit $_patch_name failed!"
+			read -r -p "Skip or Fail [s|F]? " response
+			if [ -z "$response" -o "$response" != "s" ]; then
+				echo "Force push patch, fix and refresh."
+				echo "Restart from commit $_current_commit"
+				fail "Manual cleanup required!"
+			else
+				echo "Skipping."
+				guilt delete -f $_patch_name
+			fi
+		fi
+	elif [ $STGIT -eq 1 ]; then
+		[ -n "$VERBOSE" ] || echo "$REPO looks like a stgit directory."
+		PATCHES=`stg series | wc -l`
+		if [ -n "$VERBOSE" -a $PATCHES -gt 0 ]; then
+			echo -n "Top patch is: "
+			stg top
+		fi
+
+		stg import -n $_patch_name $_new_patch.2
+		if [ $? -ne 0 ]; then
+			echo "stgit push failed!"
+			read -r -p "Skip or Fail [s|F]? " response
 			if [ -z "$response" -o "$response" != "s" ]; then
 				echo "Force push patch, fix and refresh."
 				echo "Restart from commit $_current_commit"
diff -urpN xfsprogs-4.9.0/tools/libxfs-diff xfsprogs-4.14.0/tools/libxfs-diff
--- xfsprogs-4.9.0/tools/libxfs-diff	1970-01-01 01:00:00.000000000 +0100
+++ xfsprogs-4.14.0/tools/libxfs-diff	2017-11-20 01:14:14.000000000 +0100
@@ -0,0 +1,25 @@
+#!/bin/bash
+
+if [ -z "$1" ] || [ ! -d "$1" ] || [ "$1" = "--help" ]; then
+	echo "Usage: $0 kernel_libxfs_dir"
+	exit 1
+fi
+
+if [ ! -d "libxfs/" ]; then
+	echo "$0: Must be run from the top level directory."
+	exit 2
+fi
+
+dir="$1"
+
+if [ ! -e "${dir}/xfs_format.h" ]; then
+	echo "${dir}: This doesn't seem to be a libxfs/ directory."
+	exit 3
+fi
+
+dir="$(readlink -m "${dir}/..")"
+
+for i in libxfs/xfs*.[ch]; do
+	kfile="${dir}/$i"
+	diff -Naurpw --label "$i" <(sed -e '/#include/d' "$i") --label "${kfile}" <(sed -e '/#include/d' "${kfile}")
+done
